<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-minimal.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Pisces',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":true},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'å¤åˆ¶',
      copy_success: 'å¤åˆ¶æˆåŠŸ',
      copy_failure: 'å¤åˆ¶å¤±è´¥'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="Dunwu&amp;apos;s Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Dunwu">
<meta property="og:url" content="https:&#x2F;&#x2F;dunwu.github.io&#x2F;blog&#x2F;page&#x2F;5&#x2F;index.html">
<meta property="og:site_name" content="Dunwu">
<meta property="og:description" content="Dunwu&amp;apos;s Blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://dunwu.github.io/blog/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Dunwu</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/blog/atom.xml" title="Dunwu" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dunwu</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">å¤§é“è‡³ç®€ï¼ŒçŸ¥æ˜“è¡Œéš¾</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾<span class="badge">40</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£<span class="badge">68</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="æœç´¢..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/dunwu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E6%BB%A5%E7%94%A8%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E6%BB%A5%E7%94%A8%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" class="post-title-link" itemprop="url">ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-13 22:48:00" itemprop="dateCreated datePublished" datetime="2018-10-13T22:48:00+08:00">2018-10-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-11-27 15:29:01" itemprop="dateModified" datetime="2019-11-27T15:29:01+08:00">2019-11-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index">
                    <span itemprop="name">è®¾è®¡</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/%E9%87%8D%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">é‡æ„</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E6%BB%A5%E7%94%A8%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="design/refactor/ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>6.5k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>6 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>ğŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œ<a href="https://github.com/dunwu/blog" target="_blank" rel="noopener">blog</a>ã€</p>
<p>ç¿»è¯‘è‡ªï¼š<a href="https://sourcemaking.com/refactoring/smells/oo-abusers" target="_blank" rel="noopener">https://sourcemaking.com/refactoring/smells/oo-abusers</a></p>
<p><strong>æ»¥ç”¨é¢å‘å¯¹è±¡(Object-Orientation Abusers)è¿™ç»„åå‘³é“æ„å‘³ç€ï¼šä»£ç éƒ¨åˆ†æˆ–å®Œå…¨åœ°è¿èƒŒäº†é¢å‘å¯¹è±¡ç¼–ç¨‹åŸåˆ™ã€‚</strong></p>
</blockquote>
<h2 id="switch-å£°æ˜"><a class="markdownIt-Anchor" href="#switch-å£°æ˜"></a> Switch å£°æ˜</h2>
<blockquote>
<p>Switch å£°æ˜(Switch Statements)</p>
<p>ä½ æœ‰ä¸€ä¸ªå¤æ‚çš„ <code>switch</code> è¯­å¥æˆ– <code>if</code> åºåˆ—è¯­å¥ã€‚</p>
</blockquote>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/switch-statements-1.png"/></div>
<h3 id="é—®é¢˜åŸå› "><a class="markdownIt-Anchor" href="#é—®é¢˜åŸå› "></a> é—®é¢˜åŸå› </h3>
<p>é¢å‘å¯¹è±¡ç¨‹åºçš„ä¸€ä¸ªæœ€æ˜æ˜¾ç‰¹å¾å°±æ˜¯ï¼šå°‘ç”¨ <code>switch</code> å’Œ <code>case</code> è¯­å¥ã€‚ä»æœ¬è´¨ä¸Šè¯´ï¼Œ<code>switch</code> è¯­å¥çš„é—®é¢˜åœ¨äºé‡å¤ï¼ˆ<code>if</code> åºåˆ—ä¹ŸåŒæ ·å¦‚æ­¤ï¼‰ã€‚ä½ å¸¸ä¼šå‘ç° <code>switch</code> è¯­å¥æ•£å¸ƒäºä¸åŒåœ°ç‚¹ã€‚å¦‚æœè¦ä¸ºå®ƒæ·»åŠ ä¸€ä¸ªæ–°çš„ <code>case</code> å­å¥ï¼Œå°±å¿…é¡»æ‰¾åˆ°æ‰€æœ‰ <code>switch</code> è¯­å¥å¹¶ä¿®æ”¹å®ƒä»¬ã€‚é¢å‘å¯¹è±¡ä¸­çš„å¤šæ€æ¦‚å¿µå¯ä¸ºæ­¤å¸¦æ¥ä¼˜é›…çš„è§£å†³åŠæ³•ã€‚</p>
<p>å¤§å¤šæ•°æ—¶å€™ï¼Œä¸€çœ‹åˆ° <code>switch</code> è¯­å¥ï¼Œå°±åº”è¯¥è€ƒè™‘ä»¥å¤šæ€æ¥æ›¿æ¢å®ƒã€‚</p>
<h3 id="è§£å†³æ–¹æ³•"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ³•"></a> è§£å†³æ–¹æ³•</h3>
<ul>
<li>é—®é¢˜æ˜¯å¤šæ€è¯¥å‡ºç°åœ¨å“ªï¼Ÿswitch è¯­å¥å¸¸å¸¸æ ¹æ®ç±»å‹ç è¿›è¡Œé€‰æ‹©ï¼Œä½ è¦çš„æ˜¯â€œä¸è¯¥ç±»å‹ç ç›¸å…³çš„å‡½æ•°æˆ–ç±»â€ï¼Œæ‰€ä»¥åº”è¯¥è¿ç”¨ <code>æç‚¼å‡½æ•°(Extract Method)</code> å°† <code>switch</code> è¯­å¥æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹å‡½æ•°ä¸­ï¼Œå†ä»¥ <code>æ¬ç§»å‡½æ•°(Move Method)</code> å°†å®ƒæ¬ç§»åˆ°éœ€è¦å¤šæ€æ€§çš„é‚£ä¸ªç±»é‡Œã€‚</li>
<li>å¦‚æœä½ çš„ <code>switch</code> æ˜¯åŸºäºç±»å‹ç æ¥è¯†åˆ«åˆ†æ”¯ï¼Œè¿™æ—¶å¯ä»¥è¿ç”¨ <code>ä»¥å­ç±»å–ä»£ç±»å‹ç (Replace Type Code with Subclass)</code> æˆ– <code>ä»¥çŠ¶æ€/ç­–ç•¥æ¨¡å¼å–ä»£ç±»å‹ç (Replace Type Code with State/Strategy)</code> ã€‚</li>
<li>ä¸€æ—¦å®Œæˆè¿™æ ·çš„ç»§æ‰¿ç»“æ„åï¼Œå°±å¯ä»¥è¿ç”¨ <code>ä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼(Replace Conditional with Polymorphism)</code> äº†ã€‚</li>
<li>å¦‚æœæ¡ä»¶åˆ†æ”¯å¹¶ä¸å¤šå¹¶ä¸”å®ƒä»¬ä½¿ç”¨ä¸åŒå‚æ•°è°ƒç”¨ç›¸åŒçš„å‡½æ•°ï¼Œå¤šæ€å°±æ²¡å¿…è¦äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥è¿ç”¨ <code>ä»¥æ˜ç¡®å‡½æ•°å–ä»£å‚æ•°(Replace Parameter with Explicit Methods)</code> ã€‚</li>
<li>å¦‚æœä½ çš„é€‰æ‹©æ¡ä»¶ä¹‹ä¸€æ˜¯ nullï¼Œå¯ä»¥è¿ç”¨ <code>å¼•å…¥ Null å¯¹è±¡(Introduce Null Object)</code> ã€‚</li>
</ul>
<h3 id="æ”¶ç›Š"><a class="markdownIt-Anchor" href="#æ”¶ç›Š"></a> æ”¶ç›Š</h3>
<ul>
<li>æå‡ä»£ç ç»„ç»‡æ€§ã€‚</li>
</ul>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/switch-statements-2.png"/></div>
<h3 id="ä½•æ—¶å¿½ç•¥"><a class="markdownIt-Anchor" href="#ä½•æ—¶å¿½ç•¥"></a> ä½•æ—¶å¿½ç•¥</h3>
<ul>
<li>å¦‚æœä¸€ä¸ª <code>switch</code> æ“ä½œåªæ˜¯æ‰§è¡Œç®€å•çš„è¡Œä¸ºï¼Œå°±æ²¡æœ‰é‡æ„çš„å¿…è¦äº†ã€‚</li>
<li><code>switch</code> å¸¸è¢«å·¥å‚è®¾è®¡æ¨¡å¼æ—ï¼ˆ<code>å·¥å‚æ–¹æ³•æ¨¡å¼(Factory Method)</code>å’Œ<code>æŠ½è±¡å·¥å‚æ¨¡å¼(Abstract Factory)</code>ï¼‰æ‰€ä½¿ç”¨ï¼Œè¿™ç§æƒ…å†µä¸‹ä¹Ÿæ²¡å¿…è¦é‡æ„ã€‚</li>
</ul>
<h3 id="é‡æ„æ–¹æ³•è¯´æ˜"><a class="markdownIt-Anchor" href="#é‡æ„æ–¹æ³•è¯´æ˜"></a> é‡æ„æ–¹æ³•è¯´æ˜</h3>
<h4 id="æç‚¼å‡½æ•°extract-method"><a class="markdownIt-Anchor" href="#æç‚¼å‡½æ•°extract-method"></a> æç‚¼å‡½æ•°(Extract Method)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ æœ‰ä¸€æ®µä»£ç å¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printOwing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  printBanner();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//print details</span></span><br><span class="line">  System.out.println(<span class="string">"name: "</span> + name);</span><br><span class="line">  System.out.println(<span class="string">"amount: "</span> + getOutstanding());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>ç§»åŠ¨è¿™æ®µä»£ç åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•°ä¸­ï¼Œä½¿ç”¨å‡½æ•°çš„è°ƒç”¨æ¥æ›¿ä»£è€ä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printOwing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  printBanner();</span><br><span class="line">  printDetails(getOutstanding());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printDetails</span><span class="params">(<span class="keyword">double</span> outstanding)</span> </span>&#123;</span><br><span class="line">  System.out.println(<span class="string">"name: "</span> + name);</span><br><span class="line">  System.out.println(<span class="string">"amount: "</span> + outstanding);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ¬ç§»å‡½æ•°move-method"><a class="markdownIt-Anchor" href="#æ¬ç§»å‡½æ•°move-method"></a> æ¬ç§»å‡½æ•°(Move Method)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ çš„ç¨‹åºä¸­ï¼Œæœ‰ä¸ªå‡½æ•°ä¸å…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»è¿›è¡Œæ›´å¤šäº¤æµï¼šè°ƒç”¨åè€…ï¼Œæˆ–è¢«åè€…è°ƒç”¨ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/move-method-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>åœ¨è¯¥å‡½æ•°æœ€å¸¸å¼•ç”¨çš„ç±»ä¸­å»ºç«‹ä¸€ä¸ªæœ‰ç€ç±»ä¼¼è¡Œä¸ºçš„æ–°å‡½æ•°ã€‚å°†æ—§å‡½æ•°å˜æˆä¸€ä¸ªå•çº¯çš„å§”æ‰˜å‡½æ•°ï¼Œæˆ–æ˜¯æ—§å‡½æ•°å®Œå…¨ç§»é™¤ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/move-method-after.png"/></div>
<h4 id="ä»¥å­ç±»å–ä»£ç±»å‹ç replace-type-code-with-subclass"><a class="markdownIt-Anchor" href="#ä»¥å­ç±»å–ä»£ç±»å‹ç replace-type-code-with-subclass"></a> ä»¥å­ç±»å–ä»£ç±»å‹ç (Replace Type Code with Subclass)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ æœ‰ä¸€ä¸ªä¸å¯å˜çš„ç±»å‹ç ï¼Œå®ƒä¼šå½±å“ç±»çš„è¡Œä¸ºã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/replace-type-code-with-subclasses-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ä»¥å­ç±»å–ä»£è¿™ä¸ªç±»å‹ç ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/replace-type-code-with-subclasses-after.png"/></div>
<h4 id="ä»¥çŠ¶æ€ç­–ç•¥æ¨¡å¼å–ä»£ç±»å‹ç replace-type-code-with-statestrategy"><a class="markdownIt-Anchor" href="#ä»¥çŠ¶æ€ç­–ç•¥æ¨¡å¼å–ä»£ç±»å‹ç replace-type-code-with-statestrategy"></a> ä»¥çŠ¶æ€/ç­–ç•¥æ¨¡å¼å–ä»£ç±»å‹ç (Replace Type Code with State/Strategy)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ æœ‰ä¸€ä¸ªç±»å‹ç ï¼Œå®ƒä¼šå½±å“ç±»çš„è¡Œä¸ºï¼Œä½†ä½ æ— æ³•é€šè¿‡ç»§æ‰¿æ¶ˆé™¤å®ƒã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/replace-type-code-with-state-strategy-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ä»¥çŠ¶æ€å¯¹è±¡å–ä»£ç±»å‹ç ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/replace-type-code-with-state-strategy-after.png"/></div>
<h4 id="ä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼replace-conditional-with-polymorphism"><a class="markdownIt-Anchor" href="#ä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼replace-conditional-with-polymorphism"></a> ä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼(Replace Conditional with Polymorphism)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ æ‰‹ä¸Šæœ‰ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œå®ƒæ ¹æ®å¯¹è±¡ç±»å‹çš„ä¸åŒè€Œé€‰æ‹©ä¸åŒçš„è¡Œä¸ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="function"><span class="keyword">double</span> <span class="title">getSpeed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">      <span class="keyword">case</span> EUROPEAN:</span><br><span class="line">        <span class="keyword">return</span> getBaseSpeed();</span><br><span class="line">      <span class="keyword">case</span> AFRICAN:</span><br><span class="line">        <span class="keyword">return</span> getBaseSpeed() - getLoadFactor() * numberOfCoconuts;</span><br><span class="line">      <span class="keyword">case</span> NORWEGIAN_BLUE:</span><br><span class="line">        <span class="keyword">return</span> (isNailed) ? <span class="number">0</span> : getBaseSpeed(voltage);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Should be unreachable"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>å°†è¿™ä¸ªæ¡ä»¶è¡¨è¾¾å¼çš„æ¯ä¸ªåˆ†æ”¯æ”¾è¿›ä¸€ä¸ªå­ç±»å†…çš„è¦†å†™å‡½æ•°ä¸­ï¼Œç„¶åå°†åŸå§‹å‡½æ•°å£°æ˜ä¸ºæŠ½è±¡å‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Bird</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="function"><span class="keyword">abstract</span> <span class="keyword">double</span> <span class="title">getSpeed</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">European</span> <span class="keyword">extends</span> <span class="title">Bird</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">double</span> <span class="title">getSpeed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getBaseSpeed();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">African</span> <span class="keyword">extends</span> <span class="title">Bird</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">double</span> <span class="title">getSpeed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getBaseSpeed() - getLoadFactor() * numberOfCoconuts;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NorwegianBlue</span> <span class="keyword">extends</span> <span class="title">Bird</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">double</span> <span class="title">getSpeed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (isNailed) ? <span class="number">0</span> : getBaseSpeed(voltage);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Somewhere in client code</span></span><br><span class="line">speed = bird.getSpeed();</span><br></pre></td></tr></table></figure>
<h4 id="ä»¥æ˜ç¡®å‡½æ•°å–ä»£å‚æ•°replace-parameter-with-explicit-methods"><a class="markdownIt-Anchor" href="#ä»¥æ˜ç¡®å‡½æ•°å–ä»£å‚æ•°replace-parameter-with-explicit-methods"></a> ä»¥æ˜ç¡®å‡½æ•°å–ä»£å‚æ•°(Replace Parameter with Explicit Methods)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä¸­å®Œå…¨å–å†³äºå‚æ•°å€¼è€Œé‡‡å–ä¸åŒçš„è¡Œä¸ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setValue</span><span class="params">(String name, <span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (name.equals(<span class="string">"height"</span>)) &#123;</span><br><span class="line">    height = value;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (name.equals(<span class="string">"width"</span>)) &#123;</span><br><span class="line">    width = value;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  Assert.shouldNeverReachHere();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>é’ˆå¯¹è¯¥å‚æ•°çš„æ¯ä¸€ä¸ªå¯èƒ½å€¼ï¼Œå»ºç«‹ä¸€ä¸ªç‹¬ç«‹å‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setHeight</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">  height = arg;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setWidth</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">  width = arg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¼•å…¥-null-å¯¹è±¡introduce-null-object"><a class="markdownIt-Anchor" href="#å¼•å…¥-null-å¯¹è±¡introduce-null-object"></a> å¼•å…¥ Null å¯¹è±¡(Introduce Null Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ éœ€è¦å†ä¸‰æ£€æŸ¥æŸå¯¹è±¡æ˜¯å¦ä¸º nullã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (customer == <span class="keyword">null</span>) &#123;</span><br><span class="line">  plan = BillingPlan.basic();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  plan = customer.getPlan();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>å°† null å€¼æ›¿æ¢ä¸º null å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NullCustomer</span> <span class="keyword">extends</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">  <span class="function">Plan <span class="title">getPlan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> NullPlan();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Some other NULL functionality.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Replace null values with Null-object.</span></span><br><span class="line">customer = (order.customer != <span class="keyword">null</span>) ? order.customer : <span class="keyword">new</span> NullCustomer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use Null-object as if it's normal subclass.</span></span><br><span class="line">plan = customer.getPlan();</span><br></pre></td></tr></table></figure>
<h2 id="ä¸´æ—¶å­—æ®µ"><a class="markdownIt-Anchor" href="#ä¸´æ—¶å­—æ®µ"></a> ä¸´æ—¶å­—æ®µ</h2>
<blockquote>
<p>ä¸´æ—¶å­—æ®µ(Temporary Field)çš„å€¼åªåœ¨ç‰¹å®šç¯å¢ƒä¸‹æœ‰æ„ä¹‰ï¼Œç¦»å¼€è¿™ä¸ªç¯å¢ƒï¼Œå®ƒä»¬å°±ä»€ä¹ˆä¹Ÿä¸æ˜¯äº†ã€‚</p>
</blockquote>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/temporary-field-1.png"/></div>
<h3 id="é—®é¢˜åŸå› -2"><a class="markdownIt-Anchor" href="#é—®é¢˜åŸå› -2"></a> é—®é¢˜åŸå› </h3>
<p>æœ‰æ—¶ä½ ä¼šçœ‹åˆ°è¿™æ ·çš„å¯¹è±¡ï¼šå…¶å†…æŸä¸ªå®ä¾‹å˜é‡ä»…ä¸ºæŸç§ç‰¹å®šæƒ…å†µè€Œè®¾ã€‚è¿™æ ·çš„ä»£ç è®©äººä¸æ˜“ç†è§£ï¼Œå› ä¸ºä½ é€šå¸¸è®¤ä¸ºå¯¹è±¡åœ¨æ‰€æœ‰æ—¶å€™éƒ½éœ€è¦å®ƒçš„æ‰€æœ‰å˜é‡ã€‚åœ¨å˜é‡æœªè¢«ä½¿ç”¨çš„æƒ…å†µä¸‹çŒœæµ‹å½“åˆè®¾ç½®ç›®çš„ï¼Œä¼šè®©ä½ å‘ç–¯ã€‚<br />
é€šå¸¸ï¼Œä¸´æ—¶å­—æ®µæ˜¯åœ¨æŸä¸€ç®—æ³•éœ€è¦å¤§é‡è¾“å…¥æ—¶è€Œåˆ›å»ºã€‚å› æ­¤ï¼Œä¸ºäº†é¿å…å‡½æ•°æœ‰è¿‡å¤šå‚æ•°ï¼Œç¨‹åºå‘˜å†³å®šåœ¨ç±»ä¸­åˆ›å»ºè¿™äº›æ•°æ®çš„ä¸´æ—¶å­—æ®µã€‚è¿™äº›ä¸´æ—¶å­—æ®µä»…ä»…åœ¨ç®—æ³•ä¸­ä½¿ç”¨ï¼Œå…¶ä»–æ—¶å€™å´æ¯«æ— ç”¨å¤„ã€‚<br />
è¿™ç§ä»£ç ä¸å¥½ç†è§£ã€‚ä½ æœŸæœ›æŸ¥çœ‹å¯¹è±¡å­—æ®µçš„æ•°æ®ï¼Œä½†æ˜¯å‡ºäºæŸç§åŸå› ï¼Œå®ƒä»¬æ€»æ˜¯ä¸ºç©ºã€‚</p>
<h3 id="è§£å†³æ–¹æ³•-2"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ³•-2"></a> è§£å†³æ–¹æ³•</h3>
<ul>
<li>å¯ä»¥é€šè¿‡ <code>æç‚¼ç±»(Extract Class)</code> å°†ä¸´æ—¶å­—æ®µå’Œæ“ä½œå®ƒä»¬çš„æ‰€æœ‰ä»£ç æç‚¼åˆ°ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸­ã€‚æ­¤å¤–ï¼Œä½ å¯ä»¥è¿ç”¨ <code>ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°(Replace Method with Method Object)</code> æ¥å®ç°åŒæ ·çš„ç›®çš„ã€‚</li>
<li><code>å¼•å…¥ Null å¯¹è±¡(Introduce Null Object)</code> åœ¨â€œå˜é‡ä¸åˆæ³•â€çš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª null å¯¹è±¡ï¼Œä»è€Œé¿å…å†™å‡ºæ¡ä»¶è¡¨è¾¾å¼ã€‚</li>
</ul>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/temporary-field-2.png"/></div>
<h3 id="æ”¶ç›Š-2"><a class="markdownIt-Anchor" href="#æ”¶ç›Š-2"></a> æ”¶ç›Š</h3>
<ul>
<li>æ›´å¥½çš„ä»£ç æ¸…æ™°åº¦å’Œç»„ç»‡æ€§ã€‚</li>
</ul>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/temporary-field-3.png"/></div>
<h3 id="é‡æ„æ–¹æ³•è¯´æ˜-2"><a class="markdownIt-Anchor" href="#é‡æ„æ–¹æ³•è¯´æ˜-2"></a> é‡æ„æ–¹æ³•è¯´æ˜</h3>
<h4 id="æç‚¼ç±»extract-class"><a class="markdownIt-Anchor" href="#æç‚¼ç±»extract-class"></a> æç‚¼ç±»(Extract Class)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>æŸä¸ªç±»åšäº†ä¸æ­¢ä¸€ä»¶äº‹ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-class-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>å»ºç«‹ä¸€ä¸ªæ–°ç±»ï¼Œå°†ç›¸å…³çš„å­—æ®µå’Œå‡½æ•°ä»æ—§ç±»æ¬ç§»åˆ°æ–°ç±»ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-class-after.png"/></div>
<h4 id="ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°replace-method-with-method-object"><a class="markdownIt-Anchor" href="#ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°replace-method-with-method-object"></a> ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°(Replace Method with Method Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ æœ‰ä¸€ä¸ªè¿‡é•¿å‡½æ•°ï¼Œå®ƒçš„å±€éƒ¨å˜é‡äº¤ç»‡åœ¨ä¸€èµ·ï¼Œä»¥è‡´äºä½ æ— æ³•åº”ç”¨æç‚¼å‡½æ•°(Extract Method) ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> primaryBasePrice;</span><br><span class="line">    <span class="keyword">double</span> secondaryBasePrice;</span><br><span class="line">    <span class="keyword">double</span> tertiaryBasePrice;</span><br><span class="line">    <span class="comment">// long computation.</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>å°†å‡½æ•°ç§»åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ç±»ä¸­ï¼Œä½¿å¾—å±€éƒ¨å˜é‡æˆäº†è¿™ä¸ªç±»çš„å­—æ®µã€‚ç„¶åï¼Œä½ å¯ä»¥å°†å‡½æ•°åˆ†å‰²æˆè¿™ä¸ªç±»ä¸­çš„å¤šä¸ªå‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PriceCalculator(<span class="keyword">this</span>).compute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriceCalculator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> primaryBasePrice;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> secondaryBasePrice;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> tertiaryBasePrice;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">PriceCalculator</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// copy relevant information from order object.</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// long computation.</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¼•å…¥-null-å¯¹è±¡introduce-null-object-2"><a class="markdownIt-Anchor" href="#å¼•å…¥-null-å¯¹è±¡introduce-null-object-2"></a> å¼•å…¥ Null å¯¹è±¡(Introduce Null Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ éœ€è¦å†ä¸‰æ£€æŸ¥æŸå¯¹è±¡æ˜¯å¦ä¸º nullã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (customer == <span class="keyword">null</span>) &#123;</span><br><span class="line">  plan = BillingPlan.basic();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  plan = customer.getPlan();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>å°† null å€¼æ›¿æ¢ä¸º null å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NullCustomer</span> <span class="keyword">extends</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">  <span class="function">Plan <span class="title">getPlan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> NullPlan();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Some other NULL functionality.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Replace null values with Null-object.</span></span><br><span class="line">customer = (order.customer != <span class="keyword">null</span>) ? order.customer : <span class="keyword">new</span> NullCustomer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use Null-object as if it's normal subclass.</span></span><br><span class="line">plan = customer.getPlan();</span><br></pre></td></tr></table></figure>
<h2 id="å¼‚æ›²åŒå·¥çš„ç±»"><a class="markdownIt-Anchor" href="#å¼‚æ›²åŒå·¥çš„ç±»"></a> å¼‚æ›²åŒå·¥çš„ç±»</h2>
<blockquote>
<p>å¼‚æ›²åŒå·¥çš„ç±»(Alternative Classes with Different Interfaces)</p>
<p>ä¸¤ä¸ªç±»ä¸­æœ‰ç€ä¸åŒçš„å‡½æ•°ï¼Œå´åœ¨åšç€åŒä¸€ä»¶äº‹ã€‚</p>
</blockquote>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/alternative-classes-with-different-interfaces-1.png"/></div>
<h3 id="é—®é¢˜åŸå› -3"><a class="markdownIt-Anchor" href="#é—®é¢˜åŸå› -3"></a> é—®é¢˜åŸå› </h3>
<p>è¿™ç§æƒ…å†µå¾€å¾€æ˜¯å› ä¸ºï¼šåˆ›å»ºè¿™ä¸ªç±»çš„ç¨‹åºå‘˜å¹¶ä¸çŸ¥é“å·²ç»æœ‰å®ç°è¿™ä¸ªåŠŸèƒ½çš„ç±»å­˜åœ¨äº†ã€‚</p>
<h3 id="è§£å†³æ–¹æ³•-3"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ³•-3"></a> è§£å†³æ–¹æ³•</h3>
<ul>
<li>å¦‚æœä¸¤ä¸ªå‡½æ•°åšåŒä¸€ä»¶äº‹ï¼Œå´æœ‰ç€ä¸åŒçš„ç­¾åï¼Œè¯·è¿ç”¨ <code>å‡½æ•°æ”¹å(Rename Method)</code> æ ¹æ®å®ƒä»¬çš„ç”¨é€”é‡æ–°å‘½åã€‚</li>
<li>è¿ç”¨ <code>æ¬ç§»å‡½æ•°(Move Method)</code> ã€ <code>æ·»åŠ å‚æ•°(Add Parameter)</code> å’Œ <code>ä»¤å‡½æ•°æºå¸¦å‚æ•°(Parameterize Method)</code> æ¥ä½¿å¾—æ–¹æ³•çš„åç§°å’Œå®ç°ä¸€è‡´ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªç±»ä»…æœ‰éƒ¨åˆ†åŠŸèƒ½æ˜¯é‡å¤çš„ï¼Œå°è¯•è¿ç”¨ <code>æç‚¼è¶…ç±»(Extract Superclass)</code> ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå·²å­˜åœ¨çš„ç±»å°±æˆäº†è¶…ç±»ã€‚</li>
<li>å½“æœ€ç»ˆé€‰æ‹©å¹¶è¿ç”¨æŸç§æ–¹æ³•æ¥é‡æ„åï¼Œä¹Ÿè®¸ä½ å°±èƒ½åˆ é™¤å…¶ä¸­ä¸€ä¸ªç±»äº†ã€‚</li>
</ul>
<h3 id="æ”¶ç›Š-3"><a class="markdownIt-Anchor" href="#æ”¶ç›Š-3"></a> æ”¶ç›Š</h3>
<ul>
<li>æ¶ˆé™¤äº†ä¸å¿…è¦çš„é‡å¤ä»£ç ï¼Œä¸ºä»£ç ç˜¦èº«äº†ã€‚</li>
<li>ä»£ç æ›´æ˜“è¯»ï¼ˆä¸å†éœ€è¦çŒœæµ‹ä¸ºä»€ä¹ˆè¦æœ‰ä¸¤ä¸ªåŠŸèƒ½ç›¸åŒçš„ç±»ï¼‰ã€‚</li>
</ul>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/alternative-classes-with-different-interfaces-2.png"/></div>
<h3 id="ä½•æ—¶å¿½ç•¥-2"><a class="markdownIt-Anchor" href="#ä½•æ—¶å¿½ç•¥-2"></a> ä½•æ—¶å¿½ç•¥</h3>
<ul>
<li>æœ‰æ—¶åˆå¹¶ç±»æ˜¯ä¸å¯èƒ½çš„ï¼Œæˆ–è€…æ˜¯å¦‚æ­¤å›°éš¾ä»¥è‡³äºæ²¡æœ‰æ„ä¹‰ã€‚ä¾‹å¦‚ï¼šä¸¤ä¸ªåŠŸèƒ½ç›¸ä¼¼çš„ç±»å­˜åœ¨äºä¸åŒçš„ lib åº“ä¸­ã€‚</li>
</ul>
<h3 id="é‡æ„æ–¹æ³•è¯´æ˜-3"><a class="markdownIt-Anchor" href="#é‡æ„æ–¹æ³•è¯´æ˜-3"></a> é‡æ„æ–¹æ³•è¯´æ˜</h3>
<h4 id="å‡½æ•°æ”¹årename-method"><a class="markdownIt-Anchor" href="#å‡½æ•°æ”¹årename-method"></a> å‡½æ•°æ”¹å(Rename Method)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>å‡½æ•°çš„åç§°æœªèƒ½æ°å½“çš„æ­ç¤ºå‡½æ•°çš„ç”¨é€”ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getsnm</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>ä¿®æ”¹å‡½æ•°åã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getSecondName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ¬ç§»å‡½æ•°move-method-2"><a class="markdownIt-Anchor" href="#æ¬ç§»å‡½æ•°move-method-2"></a> æ¬ç§»å‡½æ•°(Move Method)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ çš„ç¨‹åºä¸­ï¼Œæœ‰ä¸ªå‡½æ•°ä¸å…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»è¿›è¡Œæ›´å¤šäº¤æµï¼šè°ƒç”¨åè€…ï¼Œæˆ–è¢«åè€…è°ƒç”¨ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/move-method-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>åœ¨è¯¥å‡½æ•°æœ€å¸¸å¼•ç”¨çš„ç±»ä¸­å»ºç«‹ä¸€ä¸ªæœ‰ç€ç±»ä¼¼è¡Œä¸ºçš„æ–°å‡½æ•°ã€‚å°†æ—§å‡½æ•°å˜æˆä¸€ä¸ªå•çº¯çš„å§”æ‰˜å‡½æ•°ï¼Œæˆ–æ˜¯æ—§å‡½æ•°å®Œå…¨ç§»é™¤ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/move-method-after.png"/></div>
<h4 id="æ·»åŠ å‚æ•°add-parameter"><a class="markdownIt-Anchor" href="#æ·»åŠ å‚æ•°add-parameter"></a> æ·»åŠ å‚æ•°(Add Parameter)</h4>
<p><strong>é—®é¢˜</strong><br />
æŸä¸ªå‡½æ•°éœ€è¦ä»è°ƒç”¨ç«¯å¾—åˆ°æ›´å¤šä¿¡æ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Contact <span class="title">getContact</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong><br />
ä¸ºæ­¤å‡½æ•°æ·»åŠ ä¸€ä¸ªå¯¹è±¡å‡½æ•°ï¼Œè®©æ”¹å¯¹è±¡å¸¦è¿›å‡½æ•°æ‰€éœ€ä¿¡æ¯ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">class<span class="built_in"> Customer </span>&#123;</span><br><span class="line">  public Contact getContact(Date date);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä»¤å‡½æ•°æºå¸¦å‚æ•°parameterize-method"><a class="markdownIt-Anchor" href="#ä»¤å‡½æ•°æºå¸¦å‚æ•°parameterize-method"></a> ä»¤å‡½æ•°æºå¸¦å‚æ•°(Parameterize Method)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>è‹¥å¹²å‡½æ•°åšäº†ç±»ä¼¼çš„å·¥ä½œï¼Œä½†åœ¨å‡½æ•°æœ¬ä½“ä¸­å´åŒ…å«äº†ä¸åŒçš„å€¼ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/parameterize-method-before.png"/></div>
**è§£å†³**
<p>å»ºç«‹å•ä¸€å‡½æ•°ï¼Œä»¥å‚æ•°è¡¨è¾¾å“ªäº›ä¸åŒçš„å€¼ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/parameterize-method-after.png"/></div>
<h4 id="æç‚¼è¶…ç±»extract-superclass"><a class="markdownIt-Anchor" href="#æç‚¼è¶…ç±»extract-superclass"></a> æç‚¼è¶…ç±»(Extract Superclass)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä¸¤ä¸ªç±»æœ‰ç›¸ä¼¼ç‰¹æ€§ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-superclass-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ä¸ºè¿™ä¸¤ä¸ªç±»å»ºç«‹ä¸€ä¸ªè¶…ç±»ï¼Œå°†ç›¸åŒç‰¹æ€§ç§»è‡³è¶…ç±»ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-superclass-after.png"/></div>
<h2 id="è¢«æ‹’ç»çš„é¦ˆèµ "><a class="markdownIt-Anchor" href="#è¢«æ‹’ç»çš„é¦ˆèµ "></a> è¢«æ‹’ç»çš„é¦ˆèµ </h2>
<blockquote>
<p>è¢«æ‹’ç»çš„é¦ˆèµ (Refused Bequest)</p>
<p>å­ç±»ä»…ä»…ä½¿ç”¨çˆ¶ç±»ä¸­çš„éƒ¨åˆ†æ–¹æ³•å’Œå±æ€§ã€‚å…¶ä»–æ¥è‡ªçˆ¶ç±»çš„é¦ˆèµ æˆä¸ºäº†ç´¯èµ˜ã€‚</p>
</blockquote>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/refused-bequest-1.png"/></div>
<h3 id="é—®é¢˜åŸå› -4"><a class="markdownIt-Anchor" href="#é—®é¢˜åŸå› -4"></a> é—®é¢˜åŸå› </h3>
<p>æœ‰äº›äººä»…ä»…æ˜¯æƒ³é‡ç”¨è¶…ç±»ä¸­çš„éƒ¨åˆ†ä»£ç è€Œåˆ›å»ºäº†å­ç±»ã€‚ä½†å®é™…ä¸Šè¶…ç±»å’Œå­ç±»å®Œå…¨ä¸åŒã€‚</p>
<h3 id="è§£å†³æ–¹æ³•-4"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ³•-4"></a> è§£å†³æ–¹æ³•</h3>
<ul>
<li>å¦‚æœç»§æ‰¿æ²¡æœ‰æ„ä¹‰å¹¶ä¸”å­ç±»å’Œçˆ¶ç±»ä¹‹é—´ç¡®å®æ²¡æœ‰å…±åŒç‚¹ï¼Œå¯ä»¥è¿ç”¨ <code>ä»¥å§”æ‰˜å–ä»£ç»§æ‰¿(Replace Inheritance with Delegation)</code> æ¶ˆé™¤ç»§æ‰¿ã€‚</li>
<li>å¦‚æœç»§æ‰¿æ˜¯é€‚å½“çš„ï¼Œåˆ™å»é™¤å­ç±»ä¸­ä¸éœ€è¦çš„å­—æ®µå’Œæ–¹æ³•ã€‚è¿ç”¨ <code>æç‚¼è¶…ç±»(Extract Superclass)</code> å°†æ‰€æœ‰è¶…ç±»ä¸­å¯¹äºå­ç±»æœ‰ç”¨çš„å­—æ®µå’Œå‡½æ•°æå–å‡ºæ¥ï¼Œç½®å…¥ä¸€ä¸ªæ–°çš„è¶…ç±»ä¸­ï¼Œç„¶åè®©ä¸¤ä¸ªç±»éƒ½ç»§æ‰¿è‡ªå®ƒã€‚</li>
</ul>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/refused-bequest-2.png"/></div>
<h3 id="æ”¶ç›Š-4"><a class="markdownIt-Anchor" href="#æ”¶ç›Š-4"></a> æ”¶ç›Š</h3>
<ul>
<li>æé«˜ä»£ç çš„æ¸…æ™°åº¦å’Œç»„ç»‡æ€§ã€‚</li>
</ul>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/refused-bequest-3.png"/></div>
<h3 id="é‡æ„æ–¹æ³•è¯´æ˜-4"><a class="markdownIt-Anchor" href="#é‡æ„æ–¹æ³•è¯´æ˜-4"></a> é‡æ„æ–¹æ³•è¯´æ˜</h3>
<h4 id="ä»¥å§”æ‰˜å–ä»£ç»§æ‰¿replace-inheritance-with-delegation"><a class="markdownIt-Anchor" href="#ä»¥å§”æ‰˜å–ä»£ç»§æ‰¿replace-inheritance-with-delegation"></a> ä»¥å§”æ‰˜å–ä»£ç»§æ‰¿(Replace Inheritance with Delegation)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>æŸä¸ªå­ç±»åªä½¿ç”¨è¶…ç±»æ¥å£ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–æ˜¯æ ¹æœ¬ä¸éœ€è¦ç»§æ‰¿è€Œæ¥çš„æ•°æ®ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/replace-inheritance-with-delegation-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<ol>
<li>åœ¨å­ç±»ä¸­æ–°å»ºä¸€ä¸ªå­—æ®µç”¨ä»¥ä¿å­˜è¶…ç±»ï¼›</li>
<li>è°ƒæ•´å­ç±»å‡½æ•°ï¼Œä»¤å®ƒæ”¹è€Œå§”æ‰˜è¶…ç±»ï¼›</li>
<li>ç„¶åå»æ‰ä¸¤è€…ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ã€‚</li>
</ol>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/replace-inheritance-with-delegation-after.png"/></div>
<h4 id="æç‚¼è¶…ç±»extract-superclass-2"><a class="markdownIt-Anchor" href="#æç‚¼è¶…ç±»extract-superclass-2"></a> æç‚¼è¶…ç±»(Extract Superclass)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä¸¤ä¸ªç±»æœ‰ç›¸ä¼¼ç‰¹æ€§ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-superclass-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ä¸ºè¿™ä¸¤ä¸ªç±»å»ºç«‹ä¸€ä¸ªè¶…ç±»ï¼Œå°†ç›¸åŒç‰¹æ€§ç§»è‡³è¶…ç±»ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-superclass-after.png"/></div>
<h2 id="æ‰©å±•é˜…è¯»"><a class="markdownIt-Anchor" href="#æ‰©å±•é˜…è¯»"></a> æ‰©å±•é˜…è¯»</h2>
<ul>
<li><a href="https://github.com/dunwu/blog/blob/master/source/_posts/design/refactor/" target="_blank" rel="noopener">ä»£ç çš„åå‘³é“å’Œé‡æ„</a></li>
<li><a href="https://github.com/dunwu/blog/blob/master/source/_posts/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E4%BB%A3%E7%A0%81%E8%87%83%E8%82%BF.md" target="_blank" rel="noopener">ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿</a></li>
<li><a href="https://github.com/dunwu/blog/blob/master/source/_posts/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E6%BB%A5%E7%94%A8%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1.md" target="_blank" rel="noopener">ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡</a></li>
<li><a href="https://github.com/dunwu/blog/blob/master/source/_posts/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E5%8F%98%E9%9D%A9%E7%9A%84%E9%9A%9C%E7%A2%8D.md" target="_blank" rel="noopener">ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢</a></li>
<li><a href="https://github.com/dunwu/blog/blob/master/source/_posts/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E9%9D%9E%E5%BF%85%E8%A6%81%E7%9A%84.md" target="_blank" rel="noopener">ä»£ç åå‘³é“ä¹‹éå¿…è¦çš„</a></li>
<li><a href="https://github.com/dunwu/blog/blob/master/source/_posts/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E8%80%A6%E5%90%88.md" target="_blank" rel="noopener">ä»£ç åå‘³é“ä¹‹è€¦åˆ</a></li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://book.douban.com/subject/4262627/" target="_blank" rel="noopener">é‡æ„â€”â€”æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡</a> - by Martin Fowler</li>
<li><a href="https://sourcemaking.com/refactoring" target="_blank" rel="noopener">https://sourcemaking.com/refactoring</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E4%BB%A3%E7%A0%81%E8%87%83%E8%82%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E4%BB%A3%E7%A0%81%E8%87%83%E8%82%BF/" class="post-title-link" itemprop="url">ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-10-13 22:48:00" itemprop="dateCreated datePublished" datetime="2018-10-13T22:48:00+08:00">2018-10-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-11-27 15:29:01" itemprop="dateModified" datetime="2019-11-27T15:29:01+08:00">2019-11-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index">
                    <span itemprop="name">è®¾è®¡</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/%E9%87%8D%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">é‡æ„</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E4%BB%A3%E7%A0%81%E8%87%83%E8%82%BF/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="design/refactor/ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>8.1k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>7 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>ğŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œ<a href="https://github.com/dunwu/blog" target="_blank" rel="noopener">blog</a>ã€</p>
<p>ç¿»è¯‘è‡ªï¼š<a href="https://sourcemaking.com/refactoring/smells/bloaters" target="_blank" rel="noopener">https://sourcemaking.com/refactoring/smells/bloaters</a></p>
<p><strong>ä»£ç è‡ƒè‚¿(Bloated)è¿™ç»„åå‘³é“æ„å‘³ç€ï¼šä»£ç ä¸­çš„ç±»ã€å‡½æ•°ã€å­—æ®µæ²¡æœ‰ç»è¿‡åˆç†çš„ç»„ç»‡ï¼Œåªæ˜¯ç®€å•çš„å †ç Œèµ·æ¥ã€‚è¿™ä¸€ç±»å‹çš„é—®é¢˜é€šå¸¸åœ¨ä»£ç çš„åˆæœŸå¹¶ä¸æ˜æ˜¾ï¼Œä½†æ˜¯éšç€ä»£ç è§„æ¨¡çš„å¢é•¿è€Œé€æ¸ç§¯ç´¯ï¼ˆç‰¹åˆ«æ˜¯å½“æ²¡æœ‰äººåŠªåŠ›å»æ ¹é™¤å®ƒä»¬æ—¶ï¼‰ã€‚</strong></p>
</blockquote>
<h2 id="åŸºæœ¬ç±»å‹åæ‰§"><a class="markdownIt-Anchor" href="#åŸºæœ¬ç±»å‹åæ‰§"></a> åŸºæœ¬ç±»å‹åæ‰§</h2>
<blockquote>
<p>åŸºæœ¬ç±»å‹åæ‰§(Primitive Obsession)</p>
<ul>
<li>ä½¿ç”¨åŸºæœ¬ç±»å‹è€Œä¸æ˜¯å°å¯¹è±¡æ¥å®ç°ç®€å•ä»»åŠ¡ï¼ˆä¾‹å¦‚è´§å¸ã€èŒƒå›´ã€ç”µè¯å·ç å­—ç¬¦ä¸²ç­‰ï¼‰ã€‚</li>
<li>ä½¿ç”¨å¸¸é‡ç¼–ç ä¿¡æ¯ï¼ˆä¾‹å¦‚ä¸€ä¸ªç”¨äºå¼•ç”¨ç®¡ç†å‘˜æƒé™çš„å¸¸é‡<code>USER_ADMIN_ROLE = 1</code> ï¼‰ã€‚</li>
<li>ä½¿ç”¨å­—ç¬¦ä¸²å¸¸é‡ä½œä¸ºå­—æ®µååœ¨æ•°ç»„ä¸­ä½¿ç”¨ã€‚</li>
</ul>
</blockquote>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/primitive-obsession-1.png"/></div>
<h3 id="é—®é¢˜åŸå› "><a class="markdownIt-Anchor" href="#é—®é¢˜åŸå› "></a> é—®é¢˜åŸå› </h3>
<p>ç±»ä¼¼å…¶ä»–å¤§éƒ¨åˆ†åå‘³é“ï¼ŒåŸºæœ¬ç±»å‹åæ‰§è¯ç”Ÿäºç±»åˆå»ºçš„æ—¶å€™ã€‚ä¸€å¼€å§‹ï¼Œå¯èƒ½åªæ˜¯ä¸å¤šçš„å­—æ®µï¼Œéšç€è¡¨ç¤ºçš„ç‰¹æ€§è¶Šæ¥è¶Šå¤šï¼ŒåŸºæœ¬æ•°æ®ç±»å‹å­—æ®µä¹Ÿè¶Šæ¥è¶Šå¤šã€‚</p>
<p>åŸºæœ¬ç±»å‹å¸¸å¸¸è¢«ç”¨äºè¡¨ç¤ºæ¨¡å‹çš„ç±»å‹ã€‚ä½ æœ‰ä¸€ç»„æ•°å­—æˆ–å­—ç¬¦ä¸²ç”¨æ¥è¡¨ç¤ºæŸä¸ªå®ä½“ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªåœºæ™¯ï¼šåœ¨æ¨¡æ‹Ÿåœºæ™¯ï¼Œå¤§é‡çš„å­—ç¬¦ä¸²å¸¸é‡è¢«ç”¨äºæ•°ç»„çš„ç´¢å¼•ã€‚</p>
<h3 id="è§£å†³æ–¹æ³•"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ³•"></a> è§£å†³æ–¹æ³•</h3>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/primitive-obsession-2.png"/></div>
<p>å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½æ”¯æŒåŸºæœ¬æ•°æ®ç±»å‹å’Œç»“æ„ç±»å‹ï¼ˆç±»ã€ç»“æ„ä½“ç­‰ï¼‰ã€‚ç»“æ„ç±»å‹å…è®¸ç¨‹åºå‘˜å°†åŸºæœ¬æ•°æ®ç±»å‹ç»„ç»‡èµ·æ¥ï¼Œä»¥ä»£è¡¨æŸä¸€äº‹ç‰©çš„æ¨¡å‹ã€‚</p>
<p>åŸºæœ¬æ•°æ®ç±»å‹å¯ä»¥çœ‹æˆæ˜¯æœºæ„ç±»å‹çš„ç§¯æœ¨å—ã€‚å½“åŸºæœ¬æ•°æ®ç±»å‹æ•°é‡æˆè§„æ¨¡åï¼Œå°†å®ƒä»¬æœ‰ç»„ç»‡åœ°ç»“åˆèµ·æ¥ï¼Œå¯ä»¥æ›´æ–¹ä¾¿çš„ç®¡ç†è¿™äº›æ•°æ®ã€‚</p>
<ul>
<li>å¦‚æœä½ æœ‰å¤§é‡çš„åŸºæœ¬æ•°æ®ç±»å‹å­—æ®µï¼Œå°±æœ‰å¯èƒ½å°†å…¶ä¸­éƒ¨åˆ†å­˜åœ¨é€»è¾‘è”ç³»çš„å­—æ®µç»„ç»‡èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªç±»ã€‚æ›´è¿›ä¸€æ­¥çš„æ˜¯ï¼Œå°†ä¸è¿™äº›æ•°æ®æœ‰å…³è”çš„æ–¹æ³•ä¹Ÿä¸€å¹¶ç§»å…¥ç±»ä¸­ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œå¯ä»¥å°è¯• <code>ä»¥ç±»å–ä»£ç±»å‹ç (Replace Type Code with Class)</code> ã€‚</li>
<li>å¦‚æœåŸºæœ¬æ•°æ®ç±»å‹å­—æ®µçš„å€¼æ˜¯ç”¨äºæ–¹æ³•çš„å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ <code>å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object)</code> æˆ– <code>ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object)</code> ã€‚</li>
<li>å¦‚æœæƒ³è¦æ›¿æ¢çš„æ•°æ®å€¼æ˜¯ç±»å‹ç ï¼Œè€Œå®ƒå¹¶ä¸å½±å“è¡Œä¸ºï¼Œåˆ™å¯ä»¥è¿ç”¨ <code>ä»¥ç±»å–ä»£ç±»å‹ç (Replace Type Code with Class)</code> å°†å®ƒæ›¿æ¢æ‰ã€‚å¦‚æœä½ æœ‰ä¸ç±»å‹ç ç›¸å…³çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œå¯è¿ç”¨ <code>ä»¥å­ç±»å–ä»£ç±»å‹ç (Replace Type Code with Subclass)</code> æˆ– <code>ä»¥çŠ¶æ€/ç­–ç•¥æ¨¡å¼å–ä»£ç±»å‹ç (Replace Type Code with State/Strategy)</code> åŠ ä»¥å¤„ç†ã€‚</li>
<li>å¦‚æœä½ å‘ç°è‡ªå·±æ­£ä»æ•°ç»„ä¸­æŒ‘é€‰æ•°æ®ï¼Œå¯è¿ç”¨ <code>ä»¥å¯¹è±¡å–ä»£æ•°ç»„(Replace Array with Object)</code> ã€‚</li>
</ul>
<h3 id="æ”¶ç›Š"><a class="markdownIt-Anchor" href="#æ”¶ç›Š"></a> æ”¶ç›Š</h3>
<ul>
<li>å¤šäºäº†ä½¿ç”¨å¯¹è±¡æ›¿ä»£åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä½¿å¾—ä»£ç å˜å¾—æ›´åŠ çµæ´»ã€‚</li>
<li>ä»£ç å˜å¾—æ›´åŠ æ˜“è¯»å’Œæ›´åŠ æœ‰ç»„ç»‡ã€‚ç‰¹æ®Šæ•°æ®å¯ä»¥é›†ä¸­è¿›è¡Œæ“ä½œï¼Œè€Œä¸åƒä¹‹å‰é‚£æ ·åˆ†æ•£ã€‚ä¸ç”¨å†çŒœæµ‹è¿™äº›é™Œç”Ÿçš„å¸¸é‡çš„æ„ä¹‰ä»¥åŠå®ƒä»¬ä¸ºä»€ä¹ˆåœ¨æ•°ç»„ä¸­ã€‚</li>
<li>æ›´å®¹æ˜“å‘ç°é‡å¤ä»£ç ã€‚</li>
</ul>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/primitive-obsession-3.png"/></div>
<h3 id="é‡æ„æ–¹æ³•è¯´æ˜"><a class="markdownIt-Anchor" href="#é‡æ„æ–¹æ³•è¯´æ˜"></a> é‡æ„æ–¹æ³•è¯´æ˜</h3>
<h4 id="ä»¥ç±»å–ä»£ç±»å‹ç replace-type-code-with-class"><a class="markdownIt-Anchor" href="#ä»¥ç±»å–ä»£ç±»å‹ç replace-type-code-with-class"></a> ä»¥ç±»å–ä»£ç±»å‹ç (Replace Type Code with Class)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ç±»ä¹‹ä¸­æœ‰ä¸€ä¸ªæ•°å€¼ç±»å‹ç ï¼Œä½†å®ƒå¹¶ä¸å½±å“ç±»çš„è¡Œä¸ºã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/replace-type-code-with-class-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ä»¥ä¸€ä¸ªæ–°çš„ç±»æ›¿æ¢è¯¥æ•°å€¼ç±»å‹ç ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/replace-type-code-with-class-after.png"/></div>
<h4 id="å¼•å…¥å‚æ•°å¯¹è±¡introduce-parameter-object"><a class="markdownIt-Anchor" href="#å¼•å…¥å‚æ•°å¯¹è±¡introduce-parameter-object"></a> å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>æŸäº›å‚æ•°æ€»æ˜¯å¾ˆè‡ªç„¶åœ°åŒæ—¶å‡ºç°ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/introduce-parameter-object-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ä»¥ä¸€ä¸ªå¯¹è±¡æ¥å–ä»£è¿™äº›å‚æ•°ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/introduce-parameter-object-after.png"/></div>
<h4 id="ä¿æŒå¯¹è±¡å®Œæ•´preserve-whole-object"><a class="markdownIt-Anchor" href="#ä¿æŒå¯¹è±¡å®Œæ•´preserve-whole-object"></a> ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ ä»æŸä¸ªå¯¹è±¡ä¸­å–å‡ºè‹¥å¹²å€¼ï¼Œå°†å®ƒä»¬ä½œä¸ºæŸä¸€æ¬¡å‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> low = daysTempRange.getLow();</span><br><span class="line"><span class="keyword">int</span> high = daysTempRange.getHigh();</span><br><span class="line"><span class="keyword">boolean</span> withinPlan = plan.withinRange(low, high);</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>æ”¹ä¸ºä¼ é€’æ•´ä¸ªå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> withinPlan = plan.withinRange(daysTempRange);</span><br></pre></td></tr></table></figure>
<h4 id="ä»¥å­ç±»å–ä»£ç±»å‹ç replace-type-code-with-subclass"><a class="markdownIt-Anchor" href="#ä»¥å­ç±»å–ä»£ç±»å‹ç replace-type-code-with-subclass"></a> ä»¥å­ç±»å–ä»£ç±»å‹ç (Replace Type Code with Subclass)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ æœ‰ä¸€ä¸ªä¸å¯å˜çš„ç±»å‹ç ï¼Œå®ƒä¼šå½±å“ç±»çš„è¡Œä¸ºã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/replace-type-code-with-subclasses-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ä»¥å­ç±»å–ä»£è¿™ä¸ªç±»å‹ç ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/replace-type-code-with-subclasses-after.png"/></div>
<h4 id="ä»¥çŠ¶æ€ç­–ç•¥æ¨¡å¼å–ä»£ç±»å‹ç replace-type-code-with-statestrategy"><a class="markdownIt-Anchor" href="#ä»¥çŠ¶æ€ç­–ç•¥æ¨¡å¼å–ä»£ç±»å‹ç replace-type-code-with-statestrategy"></a> ä»¥çŠ¶æ€/ç­–ç•¥æ¨¡å¼å–ä»£ç±»å‹ç (Replace Type Code with State/Strategy)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ æœ‰ä¸€ä¸ªç±»å‹ç ï¼Œå®ƒä¼šå½±å“ç±»çš„è¡Œä¸ºï¼Œä½†ä½ æ— æ³•é€šè¿‡ç»§æ‰¿æ¶ˆé™¤å®ƒã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/replace-type-code-with-state-strategy-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ä»¥çŠ¶æ€å¯¹è±¡å–ä»£ç±»å‹ç ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/replace-type-code-with-state-strategy-after.png"/></div>
<h4 id="ä»¥å¯¹è±¡å–ä»£æ•°ç»„replace-array-with-object"><a class="markdownIt-Anchor" href="#ä»¥å¯¹è±¡å–ä»£æ•°ç»„replace-array-with-object"></a> ä»¥å¯¹è±¡å–ä»£æ•°ç»„(Replace Array with Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ å„è‡ªä»£è¡¨ä¸åŒçš„ä¸œè¥¿ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] row = <span class="keyword">new</span> String[<span class="number">3</span>];</span><br><span class="line">row[<span class="number">0</span>] = <span class="string">"Liverpool"</span>;</span><br><span class="line">row[<span class="number">1</span>] = <span class="string">"15"</span>;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>ä»¥å¯¹è±¡æ›¿æ¢æ•°ç»„ã€‚å¯¹äºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œä»¥ä¸€ä¸ªå­—æ®µæ¥è¡¨ç¤ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Performance row = <span class="keyword">new</span> Performance();</span><br><span class="line">row.setName(<span class="string">"Liverpool"</span>);</span><br><span class="line">row.setWins(<span class="string">"15"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="æ•°æ®æ³¥å›¢"><a class="markdownIt-Anchor" href="#æ•°æ®æ³¥å›¢"></a> æ•°æ®æ³¥å›¢</h2>
<blockquote>
<p>æ•°æ®æ³¥å›¢(Data Clumps)</p>
<p>æœ‰æ—¶ï¼Œä»£ç çš„ä¸åŒéƒ¨åˆ†åŒ…å«ç›¸åŒçš„å˜é‡ç»„ï¼ˆä¾‹å¦‚ç”¨äºè¿æ¥åˆ°æ•°æ®åº“çš„å‚æ•°ï¼‰ã€‚è¿™äº›ç»‘åœ¨ä¸€èµ·å‡ºç°çš„æ•°æ®åº”è¯¥æ‹¥æœ‰è‡ªå·±çš„å¯¹è±¡ã€‚</p>
</blockquote>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/data-clumps-1.png"/></div>
<h3 id="é—®é¢˜åŸå› -2"><a class="markdownIt-Anchor" href="#é—®é¢˜åŸå› -2"></a> é—®é¢˜åŸå› </h3>
<p>é€šå¸¸ï¼Œæ•°æ®æ³¥å›¢çš„å‡ºç°æ—¶å› ä¸ºç³Ÿç³•çš„ç¼–ç¨‹ç»“æ„æˆ–â€œå¤åˆ¶-ç²˜è´´å¼ç¼–ç¨‹â€ã€‚</p>
<p>æœ‰ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦æ˜¯æ•°æ®æ³¥å›¢çš„å¥½åŠæ³•ï¼šåˆ æ‰ä¼—å¤šæ•°æ®ä¸­çš„ä¸€é¡¹ã€‚è¿™ä¹ˆåšï¼Œå…¶ä»–æ•°æ®æœ‰æ²¡æœ‰å› è€Œå¤±å»æ„ä¹‰ï¼Ÿå¦‚æœå®ƒä»¬ä¸å†æœ‰æ„ä¹‰ï¼Œè¿™å°±æ˜¯ä¸ªæ˜ç¡®çš„ä¿¡å·ï¼šä½ åº”è¯¥ä¸ºå®ƒä»¬äº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p>
<h3 id="è§£å†³æ–¹æ³•-2"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ³•-2"></a> è§£å†³æ–¹æ³•</h3>
<ul>
<li>é¦–å…ˆæ‰¾å‡ºè¿™äº›æ•°æ®ä»¥å­—æ®µå½¢å¼å‡ºç°çš„åœ°æ–¹ï¼Œè¿ç”¨ <code>æç‚¼ç±»(Extract Class)</code> å°†å®ƒä»¬æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹å¯¹è±¡ä¸­ã€‚</li>
<li>å¦‚æœæ•°æ®æ³¥å›¢åœ¨å‡½æ•°çš„å‚æ•°åˆ—ä¸­å‡ºç°ï¼Œè¿ç”¨ <code>å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object)</code> å°†å®ƒä»¬ç»„ç»‡æˆä¸€ä¸ªç±»ã€‚</li>
<li>å¦‚æœæ•°æ®æ³¥å›¢çš„éƒ¨åˆ†æ•°æ®å‡ºç°åœ¨å…¶ä»–å‡½æ•°ä¸­ï¼Œè€ƒè™‘è¿ç”¨ <code>ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object)</code> å°†æ•´ä¸ªæ•°æ®å¯¹è±¡ä¼ å…¥åˆ°å‡½æ•°ä¸­ã€‚</li>
<li>æ£€è§†ä¸€ä¸‹ä½¿ç”¨è¿™äº›å­—æ®µçš„ä»£ç ï¼Œä¹Ÿè®¸ï¼Œå°†å®ƒä»¬ç§»å…¥ä¸€ä¸ªæ•°æ®ç±»æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ã€‚</li>
</ul>
<h3 id="æ”¶ç›Š-2"><a class="markdownIt-Anchor" href="#æ”¶ç›Š-2"></a> æ”¶ç›Š</h3>
<ul>
<li>æé«˜ä»£ç æ˜“è¯»æ€§å’Œç»„ç»‡æ€§ã€‚å¯¹äºç‰¹æ®Šæ•°æ®çš„æ“ä½œï¼Œå¯ä»¥é›†ä¸­è¿›è¡Œå¤„ç†ï¼Œè€Œä¸åƒä»¥å‰é‚£æ ·åˆ†æ•£ã€‚</li>
<li>å‡å°‘ä»£ç é‡ã€‚</li>
</ul>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/data-clumps-3.png"/></div>
<h3 id="ä½•æ—¶å¿½ç•¥"><a class="markdownIt-Anchor" href="#ä½•æ—¶å¿½ç•¥"></a> ä½•æ—¶å¿½ç•¥</h3>
<ul>
<li>æœ‰æ—¶ä¸ºäº†å¯¹è±¡ä¸­çš„éƒ¨åˆ†æ•°æ®è€Œå°†æ•´ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œå¯èƒ½ä¼šäº§ç”Ÿè®©ä¸¤ä¸ªç±»ä¹‹é—´ä¸æ”¶æ¬¢è¿çš„ä¾èµ–å…³ç³»ï¼Œè¿™ä¸­æƒ…å†µä¸‹å¯ä»¥ä¸ä¼ é€’æ•´ä¸ªå¯¹è±¡ã€‚</li>
</ul>
<h3 id="é‡æ„æ–¹æ³•è¯´æ˜-2"><a class="markdownIt-Anchor" href="#é‡æ„æ–¹æ³•è¯´æ˜-2"></a> é‡æ„æ–¹æ³•è¯´æ˜</h3>
<h4 id="æç‚¼ç±»extract-class"><a class="markdownIt-Anchor" href="#æç‚¼ç±»extract-class"></a> æç‚¼ç±»(Extract Class)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>æŸä¸ªç±»åšäº†ä¸æ­¢ä¸€ä»¶äº‹ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-class-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>å»ºç«‹ä¸€ä¸ªæ–°ç±»ï¼Œå°†ç›¸å…³çš„å­—æ®µå’Œå‡½æ•°ä»æ—§ç±»æ¬ç§»åˆ°æ–°ç±»ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-class-after.png"/></div>
<h4 id="å¼•å…¥å‚æ•°å¯¹è±¡introduce-parameter-object-2"><a class="markdownIt-Anchor" href="#å¼•å…¥å‚æ•°å¯¹è±¡introduce-parameter-object-2"></a> å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>æŸäº›å‚æ•°æ€»æ˜¯å¾ˆè‡ªç„¶åœ°åŒæ—¶å‡ºç°ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/introduce-parameter-object-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ä»¥ä¸€ä¸ªå¯¹è±¡æ¥å–ä»£è¿™äº›å‚æ•°ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/introduce-parameter-object-after.png"/></div>
<h4 id="ä¿æŒå¯¹è±¡å®Œæ•´preserve-whole-object-2"><a class="markdownIt-Anchor" href="#ä¿æŒå¯¹è±¡å®Œæ•´preserve-whole-object-2"></a> ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ ä»æŸä¸ªå¯¹è±¡ä¸­å–å‡ºè‹¥å¹²å€¼ï¼Œå°†å®ƒä»¬ä½œä¸ºæŸä¸€æ¬¡å‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> low = daysTempRange.getLow();</span><br><span class="line"><span class="keyword">int</span> high = daysTempRange.getHigh();</span><br><span class="line"><span class="keyword">boolean</span> withinPlan = plan.withinRange(low, high);</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>æ”¹ä¸ºä¼ é€’æ•´ä¸ªå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> withinPlan = plan.withinRange(daysTempRange);</span><br></pre></td></tr></table></figure>
<h2 id="è¿‡å¤§çš„ç±»"><a class="markdownIt-Anchor" href="#è¿‡å¤§çš„ç±»"></a> è¿‡å¤§çš„ç±»</h2>
<blockquote>
<p>è¿‡å¤§çš„ç±»(Large Class)</p>
<p>ä¸€ä¸ªç±»å«æœ‰è¿‡å¤šå­—æ®µã€å‡½æ•°ã€ä»£ç è¡Œã€‚</p>
</blockquote>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/large-class-1.png"/></div>
<h3 id="é—®é¢˜åŸå› -3"><a class="markdownIt-Anchor" href="#é—®é¢˜åŸå› -3"></a> é—®é¢˜åŸå› </h3>
<p>ç±»é€šå¸¸ä¸€å¼€å§‹å¾ˆå°ï¼Œä½†æ˜¯éšç€ç¨‹åºçš„å¢é•¿è€Œé€æ¸è†¨èƒ€ã€‚</p>
<p>ç±»ä¼¼äºè¿‡é•¿å‡½æ•°ï¼Œç¨‹åºå‘˜é€šå¸¸è§‰å¾—åœ¨ä¸€ä¸ªç°å­˜ç±»ä¸­æ·»åŠ æ–°ç‰¹æ€§æ¯”åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»è¦å®¹æ˜“ã€‚</p>
<h3 id="è§£å†³æ–¹æ³•-3"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ³•-3"></a> è§£å†³æ–¹æ³•</h3>
<p>è®¾è®¡æ¨¡å¼ä¸­æœ‰ä¸€æ¡é‡è¦åŸåˆ™ï¼šèŒè´£å•ä¸€åŸåˆ™ã€‚ä¸€ä¸ªç±»åº”è¯¥åªèµ‹äºˆå®ƒä¸€ä¸ªèŒè´£ã€‚å¦‚æœå®ƒæ‰€æ‰¿æ‹…çš„èŒè´£å¤ªå¤šï¼Œå°±è¯¥è€ƒè™‘ä¸ºå®ƒå‡å‡è´Ÿã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/large-class-2.png"/></div>
<ul>
<li>å¦‚æœè¿‡å¤§ç±»ä¸­çš„éƒ¨åˆ†è¡Œä¸ºå¯ä»¥æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>æç‚¼ç±»(Extract Class)</code>ã€‚</li>
<li>å¦‚æœè¿‡å¤§ç±»ä¸­çš„éƒ¨åˆ†è¡Œä¸ºå¯ä»¥ç”¨ä¸åŒæ–¹å¼å®ç°æˆ–ä½¿ç”¨äºç‰¹æ®Šåœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>æç‚¼å­ç±»(Extract Subclass)</code>ã€‚</li>
<li>å¦‚æœæœ‰å¿…è¦ä¸ºå®¢æˆ·ç«¯æä¾›ä¸€ç»„æ“ä½œå’Œè¡Œä¸ºï¼Œå¯ä»¥ä½¿ç”¨ <code>æç‚¼æ¥å£(Extract Interface)</code>ã€‚</li>
<li>å¦‚æœä½ çš„è¿‡å¤§ç±»æ˜¯ä¸ª GUI ç±»ï¼Œå¯èƒ½éœ€è¦æŠŠæ•°æ®å’Œè¡Œä¸ºç§»åˆ°ä¸€ä¸ªç‹¬ç«‹çš„é¢†åŸŸå¯¹è±¡å»ã€‚ä½ å¯èƒ½éœ€è¦ä¸¤è¾¹å„ä¿ç•™ä¸€äº›é‡å¤æ•°æ®ï¼Œå¹¶ä¿æŒä¸¤è¾¹åŒæ­¥ã€‚ <code>å¤åˆ¶è¢«ç›‘è§†æ•°æ®(Duplicate Observed Data)</code> å¯ä»¥å‘Šè¯‰ä½ æ€ä¹ˆåšã€‚</li>
</ul>
<h3 id="æ”¶ç›Š-3"><a class="markdownIt-Anchor" href="#æ”¶ç›Š-3"></a> æ”¶ç›Š</h3>
<ul>
<li>é‡æ„è¿‡å¤§çš„ç±»å¯ä»¥ä½¿ç¨‹åºå‘˜ä¸å¿…è®°ä½ä¸€ä¸ªç±»ä¸­å¤§é‡çš„å±æ€§ã€‚</li>
<li>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåˆ†å‰²è¿‡å¤§çš„ç±»å¯ä»¥é¿å…ä»£ç å’ŒåŠŸèƒ½çš„é‡å¤ã€‚</li>
</ul>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/large-class-3.png"/></div>
<h3 id="é‡æ„æ–¹æ³•è¯´æ˜-3"><a class="markdownIt-Anchor" href="#é‡æ„æ–¹æ³•è¯´æ˜-3"></a> é‡æ„æ–¹æ³•è¯´æ˜</h3>
<h4 id="æç‚¼ç±»extract-class-2"><a class="markdownIt-Anchor" href="#æç‚¼ç±»extract-class-2"></a> æç‚¼ç±»(Extract Class)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>æŸä¸ªç±»åšäº†ä¸æ­¢ä¸€ä»¶äº‹ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-class-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>å»ºç«‹ä¸€ä¸ªæ–°ç±»ï¼Œå°†ç›¸å…³çš„å­—æ®µå’Œå‡½æ•°ä»æ—§ç±»æ¬ç§»åˆ°æ–°ç±»ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-class-after.png"/></div>
<h4 id="æç‚¼å­ç±»extract-subclass"><a class="markdownIt-Anchor" href="#æç‚¼å­ç±»extract-subclass"></a> æç‚¼å­ç±»(Extract Subclass)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä¸€ä¸ªç±»ä¸­æœ‰äº›ç‰¹æ€§ä»…ç”¨äºç‰¹å®šåœºæ™¯ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-subclass-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œå¹¶å°†ç”¨äºç‰¹æ®Šåœºæ™¯çš„ç‰¹æ€§ç½®å…¥å…¶ä¸­ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-subclass-after.png"/></div>
<h4 id="æç‚¼æ¥å£extract-interface"><a class="markdownIt-Anchor" href="#æç‚¼æ¥å£extract-interface"></a> æç‚¼æ¥å£(Extract Interface)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>å¤šä¸ªå®¢æˆ·ç«¯ä½¿ç”¨ä¸€ä¸ªç±»éƒ¨åˆ†ç›¸åŒçš„å‡½æ•°ã€‚å¦ä¸€ä¸ªåœºæ™¯æ˜¯ä¸¤ä¸ªç±»ä¸­çš„éƒ¨åˆ†å‡½æ•°ç›¸åŒã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-interface-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ç§»åŠ¨ç›¸åŒçš„éƒ¨åˆ†å‡½æ•°åˆ°æ¥å£ä¸­ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/extract-interface-after.png"/></div>
<h4 id="å¤åˆ¶è¢«ç›‘è§†æ•°æ®duplicate-observed-data"><a class="markdownIt-Anchor" href="#å¤åˆ¶è¢«ç›‘è§†æ•°æ®duplicate-observed-data"></a> å¤åˆ¶è¢«ç›‘è§†æ•°æ®(Duplicate Observed Data)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>å¦‚æœå­˜å‚¨åœ¨ç±»ä¸­çš„æ•°æ®æ˜¯è´Ÿè´£ GUI çš„ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/duplicate-observed-data-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹æ³•æ˜¯å°†è´Ÿè´£ GUI çš„æ•°æ®æ”¾å…¥ä¸€ä¸ªç‹¬ç«‹çš„ç±»ï¼Œä»¥ç¡®ä¿ GUI æ•°æ®ä¸åŸŸç±»ä¹‹é—´çš„è¿æ¥å’ŒåŒæ­¥ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/duplicate-observed-data-after.png"/></div>
<h2 id="è¿‡é•¿å‡½æ•°"><a class="markdownIt-Anchor" href="#è¿‡é•¿å‡½æ•°"></a> è¿‡é•¿å‡½æ•°</h2>
<blockquote>
<p>è¿‡é•¿å‡½æ•°(Long Method)</p>
<p>ä¸€ä¸ªå‡½æ•°å«æœ‰å¤ªå¤šè¡Œä»£ç ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä»»ä½•å‡½æ•°è¶…è¿‡ 10 è¡Œæ—¶ï¼Œä½ å°±å¯ä»¥è€ƒè™‘æ˜¯ä¸æ˜¯è¿‡é•¿äº†ã€‚<br />
å‡½æ•°ä¸­çš„ä»£ç è¡Œæ•°åŸåˆ™ä¸Šä¸è¦è¶…è¿‡ 100 è¡Œã€‚</p>
</blockquote>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/long-method-1.png"/></div>
<h3 id="é—®é¢˜çš„åŸå› "><a class="markdownIt-Anchor" href="#é—®é¢˜çš„åŸå› "></a> é—®é¢˜çš„åŸå› </h3>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°çš„éš¾åº¦è¦å¤§äºæ·»åŠ åŠŸèƒ½åˆ°ä¸€ä¸ªå·²å­˜åœ¨çš„å‡½æ•°ã€‚å¤§éƒ¨åˆ†äººéƒ½è§‰å¾—ï¼šâ€œæˆ‘å°±æ·»åŠ è¿™ä¹ˆä¸¤è¡Œä»£ç ï¼Œä¸ºæ­¤æ–°å»ºä¸€ä¸ªå‡½æ•°å®åœ¨æ˜¯å°é¢˜å¤§åšäº†ã€‚â€äºæ˜¯ï¼Œå¼ ä¸‰åŠ ä¸¤è¡Œï¼Œæå››åŠ ä¸¤è¡Œï¼Œç‹äº”åŠ ä¸¤è¡Œã€‚ã€‚ã€‚å‡½æ•°æ—¥ç›Šåºå¤§ï¼Œæœ€ç»ˆçƒ‚çš„åƒä¸€é”…æµ†ç³Šï¼Œå†ä¹Ÿæ²¡äººèƒ½å®Œå…¨çœ‹æ‡‚äº†ã€‚äºæ˜¯å¤§å®¶å°±æ›´ä¸æ•¢è½»æ˜“åŠ¨è¿™ä¸ªå‡½æ•°äº†ï¼Œåªèƒ½æ¶æ€§å¾ªç¯çš„å¾€å…¶ä¸­æ·»åŠ ä»£ç ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çœ‹åˆ°ä¸€ä¸ªè¶…è¿‡ 200 è¡Œçš„å‡½æ•°ï¼Œé€šå¸¸éƒ½æ˜¯å¤šä¸ªç¨‹åºå‘˜ä¸œæ‹¼è¥¿å‡‘å‡ºæ¥çš„ã€‚</p>
<h3 id="è§£å†³å‡½æ•°"><a class="markdownIt-Anchor" href="#è§£å†³å‡½æ•°"></a> è§£å†³å‡½æ•°</h3>
<p>ä¸€ä¸ªå¾ˆå¥½çš„æŠ€å·§æ˜¯ï¼š<strong>å¯»æ‰¾æ³¨é‡Š</strong>ã€‚æ·»åŠ æ³¨é‡Šï¼Œä¸€èˆ¬æœ‰è¿™ä¹ˆå‡ ä¸ªåŸå› ï¼šä»£ç é€»è¾‘è¾ƒä¸ºæ™¦æ¶©æˆ–å¤æ‚ï¼›è¿™æ®µä»£ç åŠŸèƒ½ç›¸å¯¹ç‹¬ç«‹ï¼›ç‰¹æ®Šå¤„ç†ã€‚<br />
å¦‚æœä»£ç å‰æ–¹æœ‰ä¸€è¡Œæ³¨é‡Šï¼Œå°±æ˜¯åœ¨æé†’ä½ ï¼šå¯ä»¥å°†è¿™æ®µä»£ç æ›¿æ¢æˆä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸”å¯ä»¥åœ¨æ³¨é‡Šçš„åŸºç¡€ä¸Šç»™è¿™ä¸ªå‡½æ•°å‘½åã€‚å¦‚æœå‡½æ•°æœ‰ä¸€ä¸ªæè¿°æ°å½“çš„åå­—ï¼Œå°±ä¸éœ€è¦å»çœ‹å†…éƒ¨ä»£ç ç©¶ç«Ÿæ˜¯å¦‚ä½•å®ç°çš„ã€‚å°±ç®—åªæœ‰ä¸€è¡Œä»£ç ï¼Œå¦‚æœå®ƒéœ€è¦ä»¥æ³¨é‡Šæ¥è¯´æ˜ï¼Œé‚£ä¹Ÿå€¼å¾—å°†å®ƒæç‚¼åˆ°ç‹¬ç«‹å‡½æ•°ä¸­ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/long-method-2.png"/></div>
<ul>
<li>ä¸ºäº†ç»™ä¸€ä¸ªå‡½æ•°ç˜¦èº«ï¼Œå¯ä»¥ä½¿ç”¨ <code>æç‚¼å‡½æ•°(Extract Method)</code>ã€‚</li>
<li>å¦‚æœå±€éƒ¨å˜é‡å’Œå‚æ•°å¹²æ‰°æç‚¼å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ <code>ä»¥æŸ¥è¯¢å–ä»£ä¸´æ—¶å˜é‡(Replace Temp with Query)</code>ï¼Œ<code>å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object)</code> æˆ– <code>ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object)</code> ã€‚</li>
<li>å¦‚æœå‰é¢ä¸¤æ¡æ²¡æœ‰å¸®åŠ©ï¼Œå¯ä»¥é€šè¿‡ <code>ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°(Replace Method with Method Object)</code> å°è¯•ç§»åŠ¨æ•´ä¸ªå‡½æ•°åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ä¸­ã€‚</li>
<li>æ¡ä»¶è¡¨è¾¾å¼å’Œå¾ªç¯å¸¸å¸¸ä¹Ÿæ˜¯æç‚¼çš„ä¿¡å·ã€‚å¯¹äºæ¡ä»¶è¡¨è¾¾å¼ï¼Œå¯ä»¥ä½¿ç”¨ <code>åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼(Decompose Conditional)</code> ã€‚è‡³äºå¾ªç¯ï¼Œåº”è¯¥ä½¿ç”¨ <code>æç‚¼å‡½æ•°(Extract Method)</code> å°†å¾ªç¯å’Œå…¶å†…çš„ä»£ç æç‚¼åˆ°ç‹¬ç«‹å‡½æ•°ä¸­ã€‚</li>
</ul>
<h3 id="æ”¶ç›Š-4"><a class="markdownIt-Anchor" href="#æ”¶ç›Š-4"></a> æ”¶ç›Š</h3>
<ul>
<li>åœ¨æ‰€æœ‰ç±»å‹çš„é¢å‘å¯¹è±¡ä»£ç ä¸­ï¼Œå‡½æ•°æ¯”è¾ƒçŸ­å°ç²¾æ‚çš„ç±»å¾€å¾€ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ã€‚ä¸€ä¸ªå‡½æ•°è¶Šé•¿ï¼Œå°±è¶Šä¸å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚</li>
<li>æ­¤å¤–ï¼Œè¿‡é•¿å‡½æ•°ä¸­å¾€å¾€å«æœ‰éš¾ä»¥å‘ç°çš„é‡å¤ä»£ç ã€‚</li>
</ul>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/long-method-3.png"/></div>
<h3 id="æ€§èƒ½"><a class="markdownIt-Anchor" href="#æ€§èƒ½"></a> æ€§èƒ½</h3>
<p>æ˜¯å¦åƒè®¸å¤šäººè¯´çš„é‚£æ ·ï¼Œå¢åŠ å‡½æ•°çš„æ•°é‡ä¼šå½±å“æ€§èƒ½ï¼Ÿåœ¨å‡ ä¹ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§å½±å“æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒã€‚<br />
æ­¤å¤–ï¼Œç°åœ¨æœ‰äº†æ¸…æ™°å’Œæ˜“è¯»çš„ä»£ç ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ï¼Œä½ å°†æ›´å®¹æ˜“æ‰¾åˆ°çœŸæ­£æœ‰æ•ˆçš„å‡½æ•°æ¥é‡ç»„ä»£ç å’Œæé«˜æ€§èƒ½ã€‚</p>
<h3 id="é‡æ„æ–¹æ³•è¯´æ˜-4"><a class="markdownIt-Anchor" href="#é‡æ„æ–¹æ³•è¯´æ˜-4"></a> é‡æ„æ–¹æ³•è¯´æ˜</h3>
<h4 id="æç‚¼å‡½æ•°extract-method"><a class="markdownIt-Anchor" href="#æç‚¼å‡½æ•°extract-method"></a> æç‚¼å‡½æ•°(Extract Method)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ æœ‰ä¸€æ®µä»£ç å¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printOwing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  printBanner();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//print details</span></span><br><span class="line">  System.out.println(<span class="string">"name: "</span> + name);</span><br><span class="line">  System.out.println(<span class="string">"amount: "</span> + getOutstanding());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>ç§»åŠ¨è¿™æ®µä»£ç åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•°ä¸­ï¼Œä½¿ç”¨å‡½æ•°çš„è°ƒç”¨æ¥æ›¿ä»£è€ä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printOwing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  printBanner();</span><br><span class="line">  printDetails(getOutstanding());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printDetails</span><span class="params">(<span class="keyword">double</span> outstanding)</span> </span>&#123;</span><br><span class="line">  System.out.println(<span class="string">"name: "</span> + name);</span><br><span class="line">  System.out.println(<span class="string">"amount: "</span> + outstanding);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä»¥æŸ¥è¯¢å–ä»£ä¸´æ—¶å˜é‡replace-temp-with-query"><a class="markdownIt-Anchor" href="#ä»¥æŸ¥è¯¢å–ä»£ä¸´æ—¶å˜é‡replace-temp-with-query"></a> ä»¥æŸ¥è¯¢å–ä»£ä¸´æ—¶å˜é‡(Replace Temp with Query)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>å°†è¡¨è¾¾å¼çš„ç»“æœæ”¾åœ¨å±€éƒ¨å˜é‡ä¸­ï¼Œç„¶ååœ¨ä»£ç ä¸­ä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">calculateTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">double</span> basePrice = quantity * itemPrice;</span><br><span class="line">  <span class="keyword">if</span> (basePrice &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> basePrice * <span class="number">0.95</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> basePrice * <span class="number">0.98</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>å°†æ•´ä¸ªè¡¨è¾¾å¼ç§»åŠ¨åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ä¸­å¹¶è¿”å›ç»“æœã€‚ä½¿ç”¨æŸ¥è¯¢å‡½æ•°æ¥æ›¿ä»£ä½¿ç”¨å˜é‡ã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨å…¶ä»–å‡½æ•°ä¸­åˆå¹¶æ–°å‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">calculateTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (basePrice() &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> basePrice() * <span class="number">0.95</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> basePrice() * <span class="number">0.98</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">basePrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> quantity * itemPrice;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¼•å…¥å‚æ•°å¯¹è±¡introduce-parameter-object-3"><a class="markdownIt-Anchor" href="#å¼•å…¥å‚æ•°å¯¹è±¡introduce-parameter-object-3"></a> å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>æŸäº›å‚æ•°æ€»æ˜¯å¾ˆè‡ªç„¶åœ°åŒæ—¶å‡ºç°ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/introduce-parameter-object-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ä»¥ä¸€ä¸ªå¯¹è±¡æ¥å–ä»£è¿™äº›å‚æ•°ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/introduce-parameter-object-after.png"/></div>
<h4 id="ä¿æŒå¯¹è±¡å®Œæ•´preserve-whole-object-3"><a class="markdownIt-Anchor" href="#ä¿æŒå¯¹è±¡å®Œæ•´preserve-whole-object-3"></a> ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ ä»æŸä¸ªå¯¹è±¡ä¸­å–å‡ºè‹¥å¹²å€¼ï¼Œå°†å®ƒä»¬ä½œä¸ºæŸä¸€æ¬¡å‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> low = daysTempRange.getLow();</span><br><span class="line"><span class="keyword">int</span> high = daysTempRange.getHigh();</span><br><span class="line"><span class="keyword">boolean</span> withinPlan = plan.withinRange(low, high);</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>æ”¹ä¸ºä¼ é€’æ•´ä¸ªå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> withinPlan = plan.withinRange(daysTempRange);</span><br></pre></td></tr></table></figure>
<h4 id="ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°replace-method-with-method-object"><a class="markdownIt-Anchor" href="#ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°replace-method-with-method-object"></a> ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°(Replace Method with Method Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ æœ‰ä¸€ä¸ªè¿‡é•¿å‡½æ•°ï¼Œå®ƒçš„å±€éƒ¨å˜é‡äº¤ç»‡åœ¨ä¸€èµ·ï¼Œä»¥è‡´äºä½ æ— æ³•åº”ç”¨æç‚¼å‡½æ•°(Extract Method) ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> primaryBasePrice;</span><br><span class="line">    <span class="keyword">double</span> secondaryBasePrice;</span><br><span class="line">    <span class="keyword">double</span> tertiaryBasePrice;</span><br><span class="line">    <span class="comment">// long computation.</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>å°†å‡½æ•°ç§»åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ç±»ä¸­ï¼Œä½¿å¾—å±€éƒ¨å˜é‡æˆäº†è¿™ä¸ªç±»çš„å­—æ®µã€‚ç„¶åï¼Œä½ å¯ä»¥å°†å‡½æ•°åˆ†å‰²æˆè¿™ä¸ªç±»ä¸­çš„å¤šä¸ªå‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PriceCalculator(<span class="keyword">this</span>).compute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriceCalculator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> primaryBasePrice;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> secondaryBasePrice;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> tertiaryBasePrice;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">PriceCalculator</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// copy relevant information from order object.</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// long computation.</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼decompose-conditional"><a class="markdownIt-Anchor" href="#åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼decompose-conditional"></a> åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼(Decompose Conditional)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ æœ‰å¤æ‚çš„æ¡ä»¶è¡¨è¾¾å¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (date.before(SUMMER_START) || date.after(SUMMER_END)) &#123;</span><br><span class="line">  charge = quantity * winterRate + winterServiceCharge;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  charge = quantity * summerRate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>æ ¹æ®æ¡ä»¶åˆ†æ”¯å°†æ•´ä¸ªæ¡ä»¶è¡¨è¾¾å¼åˆ†è§£æˆå‡ ä¸ªå‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (notSummer(date)) &#123;</span><br><span class="line">  charge = winterCharge(quantity);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  charge = summerCharge(quantity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="è¿‡é•¿å‚æ•°åˆ—"><a class="markdownIt-Anchor" href="#è¿‡é•¿å‚æ•°åˆ—"></a> è¿‡é•¿å‚æ•°åˆ—</h2>
<blockquote>
<p>è¿‡é•¿å‚æ•°åˆ—(Long Parameter List)</p>
<p>ä¸€ä¸ªå‡½æ•°æœ‰è¶…è¿‡ 3ã€4 ä¸ªå…¥å‚ã€‚</p>
</blockquote>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/long-parameter-list-1.png"/></div>
<h3 id="é—®é¢˜åŸå› -4"><a class="markdownIt-Anchor" href="#é—®é¢˜åŸå› -4"></a> é—®é¢˜åŸå› </h3>
<p>è¿‡é•¿å‚æ•°åˆ—å¯èƒ½æ˜¯å°†å¤šä¸ªç®—æ³•å¹¶åˆ°ä¸€ä¸ªå‡½æ•°ä¸­æ—¶å‘ç”Ÿçš„ã€‚å‡½æ•°ä¸­çš„å…¥å‚å¯ä»¥ç”¨æ¥æ§åˆ¶æœ€ç»ˆé€‰ç”¨å“ªä¸ªç®—æ³•å»æ‰§è¡Œã€‚</p>
<p>è¿‡é•¿å‚æ•°åˆ—ä¹Ÿå¯èƒ½æ˜¯è§£è€¦ç±»ä¹‹é—´ä¾èµ–å…³ç³»æ—¶çš„å‰¯äº§å“ã€‚ä¾‹å¦‚ï¼Œç”¨äºåˆ›å»ºå‡½æ•°ä¸­æ‰€éœ€çš„ç‰¹å®šå¯¹è±¡çš„ä»£ç å·²ä»å‡½æ•°ç§»åŠ¨åˆ°è°ƒç”¨å‡½æ•°çš„ä»£ç å¤„ï¼Œä½†åˆ›å»ºçš„å¯¹è±¡æ˜¯ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å‡½æ•°ä¸­ã€‚å› æ­¤ï¼ŒåŸå§‹ç±»ä¸å†çŸ¥é“å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶ä¸”ä¾èµ–æ€§ä¹Ÿå·²ç»å‡å°‘ã€‚ä½†æ˜¯å¦‚æœåˆ›å»ºçš„è¿™äº›å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªéƒ½å°†éœ€è¦å®ƒè‡ªå·±çš„å‚æ•°ï¼Œè¿™æ„å‘³ç€è¿‡é•¿å‚æ•°åˆ—ã€‚</p>
<p>å¤ªé•¿çš„å‚æ•°åˆ—éš¾ä»¥ç†è§£ï¼Œå¤ªå¤šå‚æ•°ä¼šé€ æˆå‰åä¸ä¸€è‡´ã€ä¸æ˜“ä½¿ç”¨ï¼Œè€Œä¸”ä¸€æ—¦éœ€è¦æ›´å¤šæ•°æ®ï¼Œå°±ä¸å¾—ä¸ä¿®æ”¹å®ƒã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ¡ˆ"></a> è§£å†³æ–¹æ¡ˆ</h3>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/long-parameter-list-2.png"/></div>
<ul>
<li>å¦‚æœå‘å·²æœ‰çš„å¯¹è±¡å‘å‡ºä¸€æ¡è¯·æ±‚å°±å¯ä»¥å–ä»£ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆä½ åº”è¯¥ä½¿ç”¨ <code>ä»¥å‡½æ•°å–ä»£å‚æ•°(Replace Parameter with Methods)</code> ã€‚åœ¨è¿™é‡Œï¼Œï¼Œâ€œå·²æœ‰çš„å¯¹è±¡â€å¯èƒ½æ˜¯å‡½æ•°æ‰€å±ç±»é‡Œçš„ä¸€ä¸ªå­—æ®µï¼Œä¹Ÿå¯èƒ½æ˜¯å¦ä¸€ä¸ªå‚æ•°ã€‚</li>
<li>ä½ è¿˜å¯ä»¥è¿ç”¨ <code>ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object)</code> å°†æ¥è‡ªåŒä¸€å¯¹è±¡çš„ä¸€å †æ•°æ®æ”¶é›†èµ·æ¥ï¼Œå¹¶ä»¥è¯¥å¯¹è±¡æ›¿æ¢å®ƒä»¬ã€‚</li>
<li>å¦‚æœæŸäº›æ•°æ®ç¼ºä¹åˆç†çš„å¯¹è±¡å½’å±ï¼Œå¯ä½¿ç”¨ <code>å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object)</code> ä¸ºå®ƒä»¬åˆ¶é€ å‡ºä¸€ä¸ªâ€œå‚æ•°å¯¹è±¡â€ã€‚</li>
</ul>
<h3 id="æ”¶ç›Š-5"><a class="markdownIt-Anchor" href="#æ”¶ç›Š-5"></a> æ”¶ç›Š</h3>
<ul>
<li>æ›´æ˜“è¯»ï¼Œæ›´ç®€çŸ­çš„ä»£ç ã€‚</li>
<li>é‡æ„å¯èƒ½ä¼šæš´éœ²å‡ºä¹‹å‰æœªæ³¨æ„åˆ°çš„é‡å¤ä»£ç ã€‚</li>
</ul>
<h3 id="ä½•æ—¶å¿½ç•¥-2"><a class="markdownIt-Anchor" href="#ä½•æ—¶å¿½ç•¥-2"></a> ä½•æ—¶å¿½ç•¥</h3>
<ul>
<li>è¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦çš„ä¾‹å¤–ï¼šæœ‰æ—¶å€™ä½ æ˜æ˜¾ä¸æƒ³é€ æˆ&quot;è¢«è°ƒç”¨å¯¹è±¡&quot;ä¸&quot;è¾ƒå¤§å¯¹è±¡&quot;é—´çš„æŸç§ä¾èµ–å…³ç³»ã€‚è¿™æ—¶å€™å°†æ•°æ®ä»å¯¹è±¡ä¸­æ‹†è§£å‡ºæ¥å•ç‹¬ä½œä¸ºå‚æ•°ï¼Œä¹Ÿå¾ˆåˆæƒ…ç†ã€‚ä½†æ˜¯è¯·æ³¨æ„å…¶æ‰€å¼•å‘çš„ä»£ä»·ã€‚å¦‚æœå‚æ•°åˆ—å¤ªé•¿æˆ–å˜åŒ–å¤ªé¢‘ç¹ï¼Œå°±éœ€è¦é‡æ–°è€ƒè™‘è‡ªå·±çš„ä¾èµ–ç»“æ„äº†ã€‚</li>
</ul>
<h3 id="é‡æ„æ–¹æ³•è¯´æ˜-5"><a class="markdownIt-Anchor" href="#é‡æ„æ–¹æ³•è¯´æ˜-5"></a> é‡æ„æ–¹æ³•è¯´æ˜</h3>
<h4 id="ä»¥å‡½æ•°å–ä»£å‚æ•°replace-parameter-with-methods"><a class="markdownIt-Anchor" href="#ä»¥å‡½æ•°å–ä»£å‚æ•°replace-parameter-with-methods"></a> ä»¥å‡½æ•°å–ä»£å‚æ•°(Replace Parameter with Methods)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>å¯¹è±¡è°ƒç”¨æŸä¸ªå‡½æ•°ï¼Œå¹¶å°†æ‰€å¾—ç»“æœä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ã€‚è€Œæ¥å—è¯¥å‚æ•°çš„å‡½æ•°æœ¬èº«ä¹Ÿèƒ½å¤Ÿè°ƒç”¨å‰ä¸€ä¸ªå‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> basePrice = quantity * itemPrice;</span><br><span class="line"><span class="keyword">double</span> seasonDiscount = <span class="keyword">this</span>.getSeasonalDiscount();</span><br><span class="line"><span class="keyword">double</span> fees = <span class="keyword">this</span>.getFees();</span><br><span class="line"><span class="keyword">double</span> finalPrice = discountedPrice(basePrice, seasonDiscount, fees);</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>è®©å‚æ•°æ¥å—è€…å»é™¤è¯¥é¡¹å‚æ•°ï¼Œå¹¶ç›´æ¥è°ƒç”¨å‰ä¸€ä¸ªå‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> basePrice = quantity * itemPrice;</span><br><span class="line"><span class="keyword">double</span> finalPrice = discountedPrice(basePrice);</span><br></pre></td></tr></table></figure>
<h4 id="ä¿æŒå¯¹è±¡å®Œæ•´preserve-whole-object-4"><a class="markdownIt-Anchor" href="#ä¿æŒå¯¹è±¡å®Œæ•´preserve-whole-object-4"></a> ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>ä½ ä»æŸä¸ªå¯¹è±¡ä¸­å–å‡ºè‹¥å¹²å€¼ï¼Œå°†å®ƒä»¬ä½œä¸ºæŸä¸€æ¬¡å‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> low = daysTempRange.getLow();</span><br><span class="line"><span class="keyword">int</span> high = daysTempRange.getHigh();</span><br><span class="line"><span class="keyword">boolean</span> withinPlan = plan.withinRange(low, high);</span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³</strong></p>
<p>æ”¹ä¸ºä¼ é€’æ•´ä¸ªå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> withinPlan = plan.withinRange(daysTempRange);</span><br></pre></td></tr></table></figure>
<h4 id="å¼•å…¥å‚æ•°å¯¹è±¡introduce-parameter-object-4"><a class="markdownIt-Anchor" href="#å¼•å…¥å‚æ•°å¯¹è±¡introduce-parameter-object-4"></a> å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object)</h4>
<p><strong>é—®é¢˜</strong></p>
<p>æŸäº›å‚æ•°æ€»æ˜¯å¾ˆè‡ªç„¶åœ°åŒæ—¶å‡ºç°ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/introduce-parameter-object-before.png"/></div>
<p><strong>è§£å†³</strong></p>
<p>ä»¥ä¸€ä¸ªå¯¹è±¡æ¥å–ä»£è¿™äº›å‚æ•°ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/refactor/introduce-parameter-object-after.png"/></div>
<h2 id="æ‰©å±•é˜…è¯»"><a class="markdownIt-Anchor" href="#æ‰©å±•é˜…è¯»"></a> æ‰©å±•é˜…è¯»</h2>
<ul>
<li><a href="https://github.com/dunwu/blog/blob/master/source/_posts/design/refactor/" target="_blank" rel="noopener">ä»£ç çš„åå‘³é“å’Œé‡æ„</a></li>
<li><a href="https://github.com/dunwu/blog/blob/master/source/_posts/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E4%BB%A3%E7%A0%81%E8%87%83%E8%82%BF.md" target="_blank" rel="noopener">ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿</a></li>
<li><a href="https://github.com/dunwu/blog/blob/master/source/_posts/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E6%BB%A5%E7%94%A8%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1.md" target="_blank" rel="noopener">ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡</a></li>
<li><a href="https://github.com/dunwu/blog/blob/master/source/_posts/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E5%8F%98%E9%9D%A9%E7%9A%84%E9%9A%9C%E7%A2%8D.md" target="_blank" rel="noopener">ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢</a></li>
<li><a href="https://github.com/dunwu/blog/blob/master/source/_posts/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E9%9D%9E%E5%BF%85%E8%A6%81%E7%9A%84.md" target="_blank" rel="noopener">ä»£ç åå‘³é“ä¹‹éå¿…è¦çš„</a></li>
<li><a href="https://github.com/dunwu/blog/blob/master/source/_posts/design/refactor/%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E8%80%A6%E5%90%88.md" target="_blank" rel="noopener">ä»£ç åå‘³é“ä¹‹è€¦åˆ</a></li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://book.douban.com/subject/4262627/" target="_blank" rel="noopener">é‡æ„â€”â€”æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡</a> - by Martin Fowler</li>
<li><a href="https://sourcemaking.com/refactoring" target="_blank" rel="noopener">https://sourcemaking.com/refactoring</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/bigdata/Flume/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/bigdata/Flume/" class="post-title-link" itemprop="url">Flume</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-09-04 00:00:00" itemprop="dateCreated datePublished" datetime="2018-09-04T00:00:00+08:00">2018-09-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-08 18:07:48" itemprop="dateModified" datetime="2019-05-08T18:07:48+08:00">2019-05-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/bigdata/" itemprop="url" rel="index">
                    <span itemprop="name">bigdata</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/bigdata/Flume/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="bigdata/Flume/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="flume"><a class="markdownIt-Anchor" href="#flume"></a> Flume</h1>
<blockquote>
<p><strong>Sqoop æ˜¯ä¸€ä¸ªä¸»è¦åœ¨ Hadoop å’Œå…³ç³»æ•°æ®åº“ä¹‹é—´è¿›è¡Œæ‰¹é‡æ•°æ®è¿ç§»çš„å·¥å…·ã€‚</strong></p>
</blockquote>
<!-- TOC depthFrom:2 depthTo:3 -->
<ul>
<li><a href="#flume-%E7%AE%80%E4%BB%8B">Flume ç®€ä»‹</a>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-flume-">ä»€ä¹ˆæ˜¯ Flume ï¼Ÿ</a></li>
<li><a href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">åº”ç”¨åœºæ™¯</a></li>
</ul>
</li>
<li><a href="#flume-%E5%8E%9F%E7%90%86">Flume åŸç†</a>
<ul>
<li><a href="#flume-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">Flume åŸºæœ¬æ¦‚å¿µ</a></li>
<li><a href="#flume-%E5%9F%BA%E6%9C%AC%E7%BB%84%E4%BB%B6">Flume åŸºæœ¬ç»„ä»¶</a></li>
<li><a href="#flume-%E6%95%B0%E6%8D%AE%E6%B5%81">Flume æ•°æ®æµ</a></li>
</ul>
</li>
<li><a href="#%E8%B5%84%E6%BA%90">èµ„æº</a></li>
</ul>
<!-- /TOC -->
<h2 id="flume-ç®€ä»‹"><a class="markdownIt-Anchor" href="#flume-ç®€ä»‹"></a> Flume ç®€ä»‹</h2>
<h3 id="ä»€ä¹ˆæ˜¯-flume"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯-flume"></a> ä»€ä¹ˆæ˜¯ Flume ï¼Ÿ</h3>
<p>Flume æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµ·é‡æ•°æ®é‡‡é›†ã€èšåˆå’Œä¼ è¾“ç³»ç»Ÿã€‚</p>
<p>ç‰¹ç‚¹</p>
<ul>
<li>åŸºäºäº‹ä»¶çš„æµ·é‡æ•°æ®é‡‡é›†</li>
<li>æ•°æ®æµæ¨¡å‹ï¼šSource -&gt; Channel -&gt; Sink</li>
<li>äº‹åŠ¡æœºåˆ¶ï¼šæ”¯æŒé‡è¯»é‡å†™ï¼Œä¿è¯æ¶ˆæ¯ä¼ é€’çš„å¯é æ€§</li>
<li>å†…ç½®ä¸°å¯Œæ’ä»¶ï¼šè½»æ¾ä¸å„ç§å¤–éƒ¨ç³»ç»Ÿé›†æˆ</li>
<li>é«˜å¯ç”¨ï¼šAgent ä¸»å¤‡åˆ‡æ¢</li>
<li>Java å®ç°ï¼šå¼€æºï¼Œä¼˜ç§€çš„ç³»ç»Ÿè®¾è®¡</li>
</ul>
<h3 id="åº”ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#åº”ç”¨åœºæ™¯"></a> åº”ç”¨åœºæ™¯</h3>
<h2 id="flume-åŸç†"><a class="markdownIt-Anchor" href="#flume-åŸç†"></a> Flume åŸç†</h2>
<h3 id="flume-åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#flume-åŸºæœ¬æ¦‚å¿µ"></a> Flume åŸºæœ¬æ¦‚å¿µ</h3>
<ul>
<li>Eventï¼šäº‹ä»¶ï¼Œæœ€å°æ•°æ®ä¼ è¾“å•å…ƒï¼Œç”± Header å’Œ Body ç»„æˆã€‚</li>
<li>Agentï¼šä»£ç†ï¼ŒJVM è¿›ç¨‹ï¼Œæœ€å°è¿è¡Œå•å…ƒï¼Œç”± Sourceã€Channelã€Sink ä¸‰ä¸ªåŸºæœ¬ç»„ä»¶æ„æˆï¼Œè´Ÿè´£å°†å¤–éƒ¨æ•°æ®æºäº§ç”Ÿçš„æ•°æ®ä»¥ Event çš„å½¢å¼ä¼ è¾“åˆ°ç›®çš„åœ°
<ul>
<li>Sourceï¼šè´Ÿè´£å¯¹æ¥å„ç§å¤–éƒ¨æ•°æ®æºï¼Œå°†é‡‡é›†åˆ°çš„æ•°æ®å°è£…æˆ Eventï¼Œç„¶åå†™å…¥ Channel</li>
<li>Channelï¼šEvent æš‚å­˜å®¹å™¨ï¼Œè´Ÿè´£ä¿å­˜ Source å‘é€çš„ Eventï¼Œç›´è‡³è¢« Sink æˆåŠŸè¯»å–</li>
<li>Sinkï¼šè´Ÿè´£ä» Channel è¯»å– Eventï¼Œç„¶åå°†å…¶å†™å…¥å¤–éƒ¨å­˜å‚¨ï¼Œæˆ–ä¼ è¾“ç»™ä¸‹ä¸€é˜¶æ®µçš„ Agent</li>
<li>æ˜ å°„å…³ç³»ï¼š1 ä¸ª Source -&gt; å¤šä¸ª Channelï¼Œ1 ä¸ª Channel -&gt; å¤šä¸ª Sinkï¼Œ1 ä¸ª Sink -&gt; 1 ä¸ª Channel</li>
</ul>
</li>
</ul>
<h3 id="flume-åŸºæœ¬ç»„ä»¶"><a class="markdownIt-Anchor" href="#flume-åŸºæœ¬ç»„ä»¶"></a> Flume åŸºæœ¬ç»„ä»¶</h3>
<h4 id="source-ç»„ä»¶"><a class="markdownIt-Anchor" href="#source-ç»„ä»¶"></a> Source ç»„ä»¶</h4>
<ul>
<li>å¯¹æ¥å„ç§å¤–éƒ¨æ•°æ®æºï¼Œå°†é‡‡é›†åˆ°çš„æ•°æ®å°è£…æˆ Eventï¼Œç„¶åå†™å…¥ Channel</li>
<li>ä¸€ä¸ª Source å¯å‘å¤šä¸ª Channel å‘é€ Event</li>
<li>Flume å†…ç½®ç±»å‹ä¸°å¯Œçš„ Sourceï¼ŒåŒæ—¶ç”¨æˆ·å¯è‡ªå®šä¹‰ Source</li>
</ul>
<h4 id="channel-ç»„ä»¶"><a class="markdownIt-Anchor" href="#channel-ç»„ä»¶"></a> Channel ç»„ä»¶</h4>
<ul>
<li>Event ä¸­è½¬æš‚å­˜åŒºï¼Œå­˜å‚¨ Source é‡‡é›†ä½†æœªè¢« Sink è¯»å–çš„ Event</li>
<li>ä¸ºäº†å¹³è¡¡ Source é‡‡é›†ã€Sink è¯»å–çš„é€Ÿåº¦ï¼Œå¯è§†ä¸º Flume å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>çº¿ç¨‹å®‰å…¨å¹¶å…·æœ‰äº‹åŠ¡æ€§ï¼Œæ”¯æŒ Source å†™å¤±è´¥é‡å†™å’Œ Sink è¯»å¤±è´¥é‡è¯»</li>
</ul>
<h4 id="sink-ç»„ä»¶"><a class="markdownIt-Anchor" href="#sink-ç»„ä»¶"></a> Sink ç»„ä»¶</h4>
<ul>
<li>ä» Channel è¯»å– Eventï¼Œå°†å…¶å†™å…¥å¤–éƒ¨å­˜å‚¨ï¼Œæˆ–ä¼ è¾“åˆ°ä¸‹ä¸€é˜¶æ®µçš„ Agent</li>
<li>ä¸€ä¸ª Sink åªèƒ½ä»ä¸€ä¸ª Channel ä¸­è¯»å– Event</li>
<li>Sink æˆåŠŸè¯»å– Event åï¼Œå‘ Channel æäº¤äº‹åŠ¡ï¼ŒEvent è¢«åˆ é™¤ï¼Œå¦åˆ™ Channel ä¼šç­‰å¾… Sink é‡æ–°è¯»å–</li>
</ul>
<h3 id="flume-æ•°æ®æµ"><a class="markdownIt-Anchor" href="#flume-æ•°æ®æµ"></a> Flume æ•°æ®æµ</h3>
<p>å•å±‚æ¶æ„</p>
<p>ä¼˜ç‚¹ï¼šæ¶æ„ç®€å•ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œå ç”¨èµ„æºè¾ƒå°‘<br />
ç¼ºç‚¹<br />
å¦‚æœé‡‡é›†çš„æ•°æ®æºæˆ–Agentè¾ƒå¤šï¼Œå°†Eventå†™å…¥åˆ°HDFSä¼šäº§ç”Ÿå¾ˆå¤šå°æ–‡ä»¶<br />
å¤–éƒ¨å­˜å‚¨å‡çº§ç»´æŠ¤æˆ–å‘ç”Ÿæ•…éšœï¼Œéœ€å¯¹é‡‡é›†å±‚çš„æ‰€æœ‰Agentåšå¤„ç†ï¼ŒäººåŠ›æˆæœ¬è¾ƒé«˜ï¼Œç³»ç»Ÿç¨³å®šæ€§è¾ƒå·®<br />
ç³»ç»Ÿå®‰å…¨æ€§è¾ƒå·®<br />
æ•°æ®æºç®¡ç†è¾ƒæ··ä¹±</p>
<h2 id="èµ„æº"><a class="markdownIt-Anchor" href="#èµ„æº"></a> èµ„æº</h2>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/bigdata/Sqoop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/bigdata/Sqoop/" class="post-title-link" itemprop="url">Sqoop</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-09-04 00:00:00" itemprop="dateCreated datePublished" datetime="2018-09-04T00:00:00+08:00">2018-09-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-08-21 13:20:28" itemprop="dateModified" datetime="2019-08-21T13:20:28+08:00">2019-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/bigdata/" itemprop="url" rel="index">
                    <span itemprop="name">bigdata</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/bigdata/Sqoop/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="bigdata/Sqoop/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>503</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="sqoop"><a class="markdownIt-Anchor" href="#sqoop"></a> Sqoop</h1>
<blockquote>
<p><strong>Sqoop æ˜¯ä¸€ä¸ªä¸»è¦åœ¨ Hadoop å’Œå…³ç³»æ•°æ®åº“ä¹‹é—´è¿›è¡Œæ‰¹é‡æ•°æ®è¿ç§»çš„å·¥å…·ã€‚</strong></p>
</blockquote>
<!-- TOC depthFrom:2 depthTo:3 -->
<ul>
<li><a href="#sqoop-%E7%AE%80%E4%BB%8B">Sqoop ç®€ä»‹</a>
<ul>
<li><a href="#%E6%8F%90%E4%BE%9B%E5%A4%9A%E7%A7%8D-sqoop-%E8%BF%9E%E6%8E%A5%E5%99%A8">æä¾›å¤šç§ Sqoop è¿æ¥å™¨</a></li>
<li><a href="#sqoop-%E7%89%88%E6%9C%AC">Sqoop ç‰ˆæœ¬</a></li>
</ul>
</li>
<li><a href="#sqoop-%E5%8E%9F%E7%90%86">Sqoop åŸç†</a>
<ul>
<li><a href="#%E5%AF%BC%E5%85%A5">å¯¼å…¥</a></li>
<li><a href="#%E5%AF%BC%E5%87%BA">å¯¼å‡º</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="sqoop-ç®€ä»‹"><a class="markdownIt-Anchor" href="#sqoop-ç®€ä»‹"></a> Sqoop ç®€ä»‹</h2>
<p><strong>Sqoop æ˜¯ä¸€ä¸ªä¸»è¦åœ¨ Hadoop å’Œå…³ç³»æ•°æ®åº“ä¹‹é—´è¿›è¡Œæ‰¹é‡æ•°æ®è¿ç§»çš„å·¥å…·ã€‚</strong></p>
<ul>
<li>Hadoopï¼šHDFSã€Hiveã€HBaseã€Inceptorã€Hyperbase</li>
<li>é¢å‘å¤§æ•°æ®é›†çš„æ‰¹é‡å¯¼å…¥å¯¼å‡º</li>
<li>å°†è¾“å…¥æ•°æ®é›†åˆ†ä¸º N ä¸ªåˆ‡ç‰‡ï¼Œç„¶åå¯åŠ¨ N ä¸ª Map ä»»åŠ¡å¹¶è¡Œä¼ è¾“</li>
<li>æ”¯æŒå…¨é‡ã€å¢é‡ä¸¤ç§ä¼ è¾“æ–¹å¼</li>
</ul>
<h3 id="æä¾›å¤šç§-sqoop-è¿æ¥å™¨"><a class="markdownIt-Anchor" href="#æä¾›å¤šç§-sqoop-è¿æ¥å™¨"></a> æä¾›å¤šç§ Sqoop è¿æ¥å™¨</h3>
<h4 id="å†…ç½®è¿æ¥å™¨"><a class="markdownIt-Anchor" href="#å†…ç½®è¿æ¥å™¨"></a> å†…ç½®è¿æ¥å™¨</h4>
<ul>
<li>ç»è¿‡ä¼˜åŒ–çš„ä¸“ç”¨ RDBMS è¿æ¥å™¨ï¼šMySQLã€PostgreSQLã€Oracleã€DB2ã€SQL Serverã€Netzza ç­‰</li>
<li>é€šç”¨çš„ JDBC è¿æ¥å™¨ï¼šæ”¯æŒ JDBC åè®®çš„æ•°æ®åº“</li>
</ul>
<h4 id="ç¬¬ä¸‰æ–¹è¿æ¥å™¨"><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰æ–¹è¿æ¥å™¨"></a> ç¬¬ä¸‰æ–¹è¿æ¥å™¨</h4>
<ul>
<li>æ•°æ®ä»“åº“ï¼šTeradata</li>
<li>NoSQL æ•°æ®åº“ï¼šCouchbase</li>
</ul>
<h3 id="sqoop-ç‰ˆæœ¬"><a class="markdownIt-Anchor" href="#sqoop-ç‰ˆæœ¬"></a> Sqoop ç‰ˆæœ¬</h3>
<h4 id="sqoop-1-ä¼˜ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#sqoop-1-ä¼˜ç¼ºç‚¹"></a> Sqoop 1 ä¼˜ç¼ºç‚¹</h4>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/bigdata/Sqoop/sqoop-architecture.png"/></div>
<p>ä¼˜ç‚¹</p>
<ul>
<li>æ¶æ„ç®€å•</li>
<li>éƒ¨ç½²ç®€å•</li>
<li>åŠŸèƒ½å…¨é¢</li>
<li>ç¨³å®šæ€§è¾ƒé«˜</li>
<li>é€Ÿåº¦è¾ƒå¿«</li>
</ul>
<p>ç¼ºç‚¹</p>
<ul>
<li>è®¿é—®æ–¹å¼å•ä¸€</li>
<li>å‘½ä»¤è¡Œæ–¹å¼å®¹æ˜“å‡ºé”™ï¼Œæ ¼å¼ç´§è€¦åˆ</li>
<li>å®‰å…¨æœºåˆ¶ä¸å¤Ÿå®Œå–„ï¼Œå­˜åœ¨å¯†ç æ³„éœ²é£é™©</li>
</ul>
<h4 id="sqoop-2-ä¼˜ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#sqoop-2-ä¼˜ç¼ºç‚¹"></a> Sqoop 2 ä¼˜ç¼ºç‚¹</h4>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/bigdata/Sqoop/sqoop-v2-architecture.png"/></div>
<p>ä¼˜ç‚¹</p>
<ul>
<li>è®¿é—®æ–¹å¼å¤šæ ·</li>
<li>é›†ä¸­ç®¡ç†è¿æ¥å™¨</li>
<li>å®‰å…¨æœºåˆ¶è¾ƒå®Œå–„</li>
<li>æ”¯æŒå¤šç”¨æˆ·</li>
</ul>
<p>ç¼ºç‚¹</p>
<ul>
<li>æ¶æ„è¾ƒå¤æ‚</li>
<li>éƒ¨ç½²è¾ƒç¹ç</li>
<li>ç¨³å®šæ€§ä¸€èˆ¬</li>
<li>é€Ÿåº¦ä¸€èˆ¬</li>
</ul>
<h2 id="sqoop-åŸç†"><a class="markdownIt-Anchor" href="#sqoop-åŸç†"></a> Sqoop åŸç†</h2>
<h3 id="å¯¼å…¥"><a class="markdownIt-Anchor" href="#å¯¼å…¥"></a> å¯¼å…¥</h3>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/bigdata/Sqoop/sqoop-import.png"/></div>
<h3 id="å¯¼å‡º"><a class="markdownIt-Anchor" href="#å¯¼å‡º"></a> å¯¼å‡º</h3>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/bigdata/Sqoop/sqoop-export.png"/></div>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/bigdata/Spark/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/bigdata/Spark/" class="post-title-link" itemprop="url">Spark</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-09-03 00:00:00" itemprop="dateCreated datePublished" datetime="2018-09-03T00:00:00+08:00">2018-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-08 18:07:48" itemprop="dateModified" datetime="2019-05-08T18:07:48+08:00">2019-05-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/bigdata/" itemprop="url" rel="index">
                    <span itemprop="name">bigdata</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/bigdata/Spark/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="bigdata/Spark/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>1 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="spark"><a class="markdownIt-Anchor" href="#spark"></a> Spark</h1>
<!-- TOC depthFrom:2 depthTo:3 -->
<ul>
<li><a href="#spark-%E7%AE%80%E4%BB%8B">Spark ç®€ä»‹</a>
<ul>
<li><a href="#spark-%E6%A6%82%E5%BF%B5">Spark æ¦‚å¿µ</a></li>
<li><a href="#spark-%E7%89%B9%E7%82%B9">Spark ç‰¹ç‚¹</a></li>
</ul>
</li>
<li><a href="#spark-%E5%8E%9F%E7%90%86">Spark åŸç†</a>
<ul>
<li><a href="#%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B">ç¼–ç¨‹æ¨¡å‹</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="spark-ç®€ä»‹"><a class="markdownIt-Anchor" href="#spark-ç®€ä»‹"></a> Spark ç®€ä»‹</h2>
<h3 id="spark-æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#spark-æ¦‚å¿µ"></a> Spark æ¦‚å¿µ</h3>
<ul>
<li>å¤§è§„æ¨¡åˆ†å¸ƒå¼é€šç”¨è®¡ç®—å¼•æ“
<ul>
<li>Spark Coreï¼šæ ¸å¿ƒè®¡ç®—æ¡†æ¶</li>
<li>Spark SQLï¼šç»“æ„åŒ–æ•°æ®æŸ¥è¯¢</li>
<li>Spark Streamingï¼šå®æ—¶æµå¤„ç†</li>
<li>Spark MLibï¼šæœºå™¨å­¦ä¹ </li>
<li>Spark GraphXï¼šå›¾è®¡ç®—</li>
</ul>
</li>
<li>å…·æœ‰é«˜ååã€ä½å»¶æ—¶ã€é€šç”¨æ˜“æ‰©å±•ã€é«˜å®¹é”™ç­‰ç‰¹ç‚¹</li>
<li>é‡‡ç”¨ Scala è¯­è¨€å¼€å‘</li>
<li>æä¾›å¤šç§è¿è¡Œæ¨¡å¼</li>
</ul>
<h3 id="spark-ç‰¹ç‚¹"><a class="markdownIt-Anchor" href="#spark-ç‰¹ç‚¹"></a> Spark ç‰¹ç‚¹</h3>
<ul>
<li>è®¡ç®—é«˜æ•ˆ
<ul>
<li>åˆ©ç”¨å†…å­˜è®¡ç®—ã€Cache ç¼“å­˜æœºåˆ¶ï¼Œæ”¯æŒè¿­ä»£è®¡ç®—å’Œæ•°æ®å…±äº«ï¼Œå‡å°‘æ•°æ®è¯»å–çš„ IO å¼€é”€</li>
<li>åˆ©ç”¨ DAG å¼•æ“ï¼Œå‡å°‘ä¸­é—´è®¡ç®—ç»“æœå†™å…¥ HDFS çš„å¼€é”€</li>
<li>åˆ©ç”¨å¤šçº¿ç¨‹æ± æ¨¡å‹ï¼Œå‡å°‘ä»»åŠ¡å¯åŠ¨å¼€é”€ï¼Œé¿å… Shuffle ä¸­ä¸å¿…è¦çš„æ’åºå’Œç£ç›˜ IO æ“ä½œ</li>
</ul>
</li>
<li>é€šç”¨æ˜“ç”¨
<ul>
<li>é€‚ç”¨äºæ‰¹å¤„ç†ã€æµå¤„ç†ã€äº¤äº’å¼è®¡ç®—ã€æœºå™¨å­¦ä¹ ç®—æ³•ç­‰åœºæ™¯</li>
<li>æä¾›äº†ä¸°å¯Œçš„å¼€å‘ APIï¼Œæ”¯æŒ Scalaã€Javaã€Pythonã€R ç­‰</li>
</ul>
</li>
<li>è¿è¡Œæ¨¡å¼å¤šæ ·
<ul>
<li>Local æ¨¡å¼</li>
<li>Standalone æ¨¡å¼</li>
<li>YARN/Mesos æ¨¡å¼</li>
</ul>
</li>
<li>è®¡ç®—é«˜æ•ˆ
<ul>
<li>åˆ©ç”¨å†…å­˜è®¡ç®—ã€Cache ç¼“å­˜æœºåˆ¶ï¼Œæ”¯æŒè¿­ä»£è®¡ç®—å’Œæ•°æ®å…±äº«ï¼Œå‡å°‘æ•°æ®è¯»å–çš„ IO å¼€é”€</li>
<li>åˆ©ç”¨ DAG å¼•æ“ï¼Œå‡å°‘ä¸­é—´è®¡ç®—ç»“æœå†™å…¥ HDFS çš„å¼€é”€</li>
<li>åˆ©ç”¨å¤šçº¿ç¨‹æ± æ¨¡å‹ï¼Œå‡å°‘ä»»åŠ¡å¯åŠ¨å¼€é”€ï¼Œé¿å… Shuffle ä¸­ä¸å¿…è¦çš„æ’åºå’Œç£ç›˜ IO æ“ä½œ</li>
</ul>
</li>
<li>é€šç”¨æ˜“ç”¨
<ul>
<li>é€‚ç”¨äºæ‰¹å¤„ç†ã€æµå¤„ç†ã€äº¤äº’å¼è®¡ç®—ã€æœºå™¨å­¦ä¹ ç­‰åœºæ™¯</li>
<li>æä¾›äº†ä¸°å¯Œçš„å¼€å‘ APIï¼Œæ”¯æŒ Scalaã€Javaã€Pythonã€R ç­‰</li>
</ul>
</li>
</ul>
<h2 id="spark-åŸç†"><a class="markdownIt-Anchor" href="#spark-åŸç†"></a> Spark åŸç†</h2>
<h3 id="ç¼–ç¨‹æ¨¡å‹"><a class="markdownIt-Anchor" href="#ç¼–ç¨‹æ¨¡å‹"></a> ç¼–ç¨‹æ¨¡å‹</h3>
<h4 id="rdd"><a class="markdownIt-Anchor" href="#rdd"></a> RDD</h4>
<ul>
<li>å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼ˆResilient Distributed Datesetsï¼‰
<ul>
<li>åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­çš„åªè¯»å¯¹è±¡é›†åˆ</li>
<li>ç”±å¤šä¸ª Partition ç»„æˆ</li>
<li>é€šè¿‡è½¬æ¢æ“ä½œæ„é€ </li>
<li>å¤±æ•ˆåè‡ªåŠ¨é‡æ„ï¼ˆå¼¹æ€§ï¼‰</li>
<li>å­˜å‚¨åœ¨å†…å­˜æˆ–ç£ç›˜ä¸­</li>
</ul>
</li>
<li>Spark åŸºäº RDD è¿›è¡Œè®¡ç®—</li>
</ul>
<h4 id="rdd-æ“ä½œoperator"><a class="markdownIt-Anchor" href="#rdd-æ“ä½œoperator"></a> RDD æ“ä½œï¼ˆOperatorï¼‰</h4>
<ul>
<li>Transformationï¼ˆè½¬æ¢ï¼‰
<ul>
<li>å°† Scala é›†åˆæˆ– Hadoop è¾“å…¥æ•°æ®æ„é€ æˆä¸€ä¸ªæ–° RDD</li>
<li>é€šè¿‡å·²æœ‰çš„ RDD äº§ç”Ÿæ–° RDD</li>
<li>æƒ°æ€§æ‰§è¡Œï¼šåªè®°å½•è½¬æ¢å…³ç³»ï¼Œä¸è§¦å‘è®¡ç®—</li>
<li>ä¾‹å¦‚ï¼šmapã€filterã€flatmapã€unionã€distinctã€sortbykey</li>
</ul>
</li>
<li>Actionï¼ˆåŠ¨ä½œï¼‰
<ul>
<li>é€šè¿‡ RDD è®¡ç®—å¾—åˆ°ä¸€ä¸ªå€¼æˆ–ä¸€ç»„å€¼</li>
<li>çœŸæ­£è§¦å‘è®¡ç®—</li>
<li>ä¾‹å¦‚ï¼šfirstã€countã€collectã€foreachã€saveAsTextFile</li>
</ul>
</li>
</ul>
<h4 id="rdd-ä¾èµ–dependency"><a class="markdownIt-Anchor" href="#rdd-ä¾èµ–dependency"></a> RDD ä¾èµ–ï¼ˆDependencyï¼‰</h4>
<ul>
<li>çª„ä¾èµ–ï¼ˆNarrow Dependencyï¼‰
<ul>
<li>çˆ¶ RDD ä¸­çš„åˆ†åŒºæœ€å¤šåªèƒ½è¢«ä¸€ä¸ªå­ RDD çš„ä¸€ä¸ªåˆ†åŒºä½¿ç”¨</li>
<li>å­ RDD å¦‚æœæœ‰éƒ¨åˆ†åˆ†åŒºæ•°æ®ä¸¢å¤±æˆ–æŸåï¼Œåªéœ€ä»å¯¹åº”çš„çˆ¶ RDD é‡æ–°è®¡ç®—æ¢å¤</li>
<li>ä¾‹å¦‚ï¼šmapã€filterã€union</li>
</ul>
</li>
<li>å®½ä¾èµ–ï¼ˆShuffle/Wide Dependency ï¼‰
<ul>
<li>å­ RDD åˆ†åŒºä¾èµ–çˆ¶ RDD çš„æ‰€æœ‰åˆ†åŒº</li>
<li>å­ RDD å¦‚æœéƒ¨åˆ†æˆ–å…¨éƒ¨åˆ†åŒºæ•°æ®ä¸¢å¤±æˆ–æŸåï¼Œå¿…é¡»ä»æ‰€æœ‰çˆ¶ RDD åˆ†åŒºé‡æ–°è®¡ç®—</li>
<li>ç›¸å¯¹äºçª„ä¾èµ–ï¼Œå®½ä¾èµ–ä»˜å‡ºçš„ä»£ä»·è¦é«˜å¾ˆå¤šï¼Œå°½é‡é¿å…ä½¿ç”¨</li>
<li>ä¾‹å¦‚ï¼šgroupByKeyã€reduceByKeyã€sortByKey</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/bigdata/overview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/bigdata/overview/" class="post-title-link" itemprop="url">å¤§æ•°æ®ç®€ä»‹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-09-03 00:00:00" itemprop="dateCreated datePublished" datetime="2018-09-03T00:00:00+08:00">2018-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-08 18:07:48" itemprop="dateModified" datetime="2019-05-08T18:07:48+08:00">2019-05-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/bigdata/" itemprop="url" rel="index">
                    <span itemprop="name">bigdata</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/bigdata/overview/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="bigdata/overview/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>2k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>2 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å¤§æ•°æ®ç®€ä»‹"><a class="markdownIt-Anchor" href="#å¤§æ•°æ®ç®€ä»‹"></a> å¤§æ•°æ®ç®€ä»‹</h1>
<!-- TOC depthFrom:2 depthTo:3 -->
<ul>
<li><a href="#%E7%AE%80%E4%BB%8B">ç®€ä»‹</a>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%A4%A7%E6%95%B0%E6%8D%AE">ä»€ä¹ˆæ˜¯å¤§æ•°æ®</a></li>
<li><a href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">åº”ç”¨åœºæ™¯</a></li>
<li><a href="#hadoop-%E7%BC%96%E5%B9%B4%E5%8F%B2">Hadoop ç¼–å¹´å²</a></li>
</ul>
</li>
<li><a href="#%E6%8A%80%E6%9C%AF%E4%BD%93%E7%B3%BB">æŠ€æœ¯ä½“ç³»</a>
<ul>
<li><a href="#hdfs">HDFS</a></li>
<li><a href="#mapreduce">MapReduce</a></li>
<li><a href="#spark">Spark</a></li>
<li><a href="#yarn">YARN</a></li>
<li><a href="#hive">Hive</a></li>
<li><a href="#hbase">HBase</a></li>
<li><a href="#elasticsearch">ElasticSearch</a></li>
</ul>
</li>
<li><a href="#%E6%9C%AF%E8%AF%AD">æœ¯è¯­</a></li>
<li><a href="#%E8%B5%84%E6%BA%90">èµ„æº</a></li>
</ul>
<!-- /TOC -->
<h2 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h2>
<h3 id="ä»€ä¹ˆæ˜¯å¤§æ•°æ®"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯å¤§æ•°æ®"></a> ä»€ä¹ˆæ˜¯å¤§æ•°æ®</h3>
<p>å¤§æ•°æ®æ˜¯æŒ‡è¶…å‡ºä¼ ç»Ÿæ•°æ®åº“å·¥å…·æ”¶é›†ã€å­˜å‚¨ã€ç®¡ç†å’Œåˆ†æèƒ½åŠ›çš„æ•°æ®é›†ã€‚ä¸æ­¤åŒæ—¶ï¼ŒåŠæ—¶é‡‡é›†ã€å­˜å‚¨ã€èšåˆã€ç®¡ç†æ•°æ®ï¼Œä»¥åŠå¯¹æ•°æ®æ·±åº¦åˆ†æçš„æ–°æŠ€æœ¯å’Œæ–°èƒ½åŠ›ï¼Œæ­£åœ¨å¿«é€Ÿå¢é•¿ï¼Œå°±åƒé¢„æµ‹è®¡ç®—èŠ¯ç‰‡å¢é•¿é€Ÿåº¦çš„æ‘©å°”å®šå¾‹ä¸€æ ·ã€‚</p>
<ul>
<li><strong>Volume</strong> - æ•°æ®è§„æ¨¡å·¨å¤§</li>
<li><strong>Velocity</strong> - ç”Ÿæˆå’Œå¤„ç†é€Ÿåº¦æå¿«</li>
<li><strong>Variety</strong> - æ•°æ®è§„æ¨¡å·¨å¤§</li>
<li><strong>Value</strong> - ç”Ÿæˆå’Œå¤„ç†é€Ÿåº¦æå¿«</li>
</ul>
<h3 id="åº”ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#åº”ç”¨åœºæ™¯"></a> åº”ç”¨åœºæ™¯</h3>
<p>åŸºäºå¤§æ•°æ®çš„æ•°æ®ä»“åº“</p>
<p>åŸºäºå¤§æ•°æ®çš„å®æ—¶æµå¤„ç†</p>
<h3 id="hadoop-ç¼–å¹´å²"><a class="markdownIt-Anchor" href="#hadoop-ç¼–å¹´å²"></a> Hadoop ç¼–å¹´å²</h3>
<table>
<thead>
<tr>
<th style="text-align:left">æ—¶é—´</th>
<th style="text-align:left">äº‹ä»¶</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">2003.01</td>
<td style="text-align:left">Googleå‘è¡¨äº†Google File Systemè®ºæ–‡</td>
</tr>
<tr>
<td style="text-align:left">2004.01</td>
<td style="text-align:left">Googleå‘è¡¨äº†MapReduceè®ºæ–‡</td>
</tr>
<tr>
<td style="text-align:left">2006.02</td>
<td style="text-align:left">Apache Hadoopé¡¹ç›®æ­£å¼å¯åŠ¨ï¼Œå¹¶æ”¯æŒMapReduceå’ŒHDFSç‹¬ç«‹å‘å±•</td>
</tr>
<tr>
<td style="text-align:left">2006.11</td>
<td style="text-align:left">Googleå‘è¡¨äº†Bigtableè®ºæ–‡</td>
</tr>
<tr>
<td style="text-align:left">2008.01</td>
<td style="text-align:left">Hadoopæˆä¸ºApacheé¡¶çº§é¡¹ç›®</td>
</tr>
<tr>
<td style="text-align:left">2009.03</td>
<td style="text-align:left">Clouderaæ¨å‡ºä¸–ç•Œä¸Šé¦–ä¸ªHadoopå‘è¡Œç‰ˆâ€”â€”CDHï¼Œå¹¶å®Œå…¨å¼€æ”¾æºç </td>
</tr>
<tr>
<td style="text-align:left">2012.03</td>
<td style="text-align:left">HDFS NameNode HAåŠ å…¥Hadoopä¸»ç‰ˆæœ¬</td>
</tr>
<tr>
<td style="text-align:left">2014.02</td>
<td style="text-align:left">Sparkä»£æ›¿MapReduceæˆä¸ºHadoopçš„ç¼ºçœè®¡ç®—å¼•æ“ï¼Œå¹¶æˆä¸ºApacheé¡¶çº§é¡¹ç›®</td>
</tr>
</tbody>
</table>
<h2 id="æŠ€æœ¯ä½“ç³»"><a class="markdownIt-Anchor" href="#æŠ€æœ¯ä½“ç³»"></a> æŠ€æœ¯ä½“ç³»</h2>
<h3 id="hdfs"><a class="markdownIt-Anchor" href="#hdfs"></a> HDFS</h3>
<p><strong>æ¦‚å¿µ</strong></p>
<ul>
<li>Hadoop åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆHadoop Distributed File Systemï¼‰</li>
<li>åœ¨å¼€æºå¤§æ•°æ®æŠ€æœ¯ä½“ç³»ä¸­ï¼Œåœ°ä½æ— å¯æ›¿ä»£</li>
</ul>
<p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>é«˜å®¹é”™ï¼šæ•°æ®å¤šå‰¯æœ¬ï¼Œå‰¯æœ¬ä¸¢å¤±åè‡ªåŠ¨æ¢å¤</li>
<li>é«˜å¯ç”¨ï¼šNameNode HAï¼Œå®‰å…¨æ¨¡å¼</li>
<li>é«˜æ‰©å±•ï¼š10K èŠ‚ç‚¹è§„æ¨¡</li>
<li>ç®€å•ä¸€è‡´æ€§æ¨¡å‹ï¼šä¸€æ¬¡å†™å…¥å¤šæ¬¡è¯»å–ï¼Œæ”¯æŒè¿½åŠ ï¼Œä¸å…è®¸ä¿®æ”¹</li>
<li>æµå¼æ•°æ®è®¿é—®ï¼šæ‰¹é‡è¯»è€Œééšæœºè¯»ï¼Œå…³æ³¨ååé‡è€Œéæ—¶é—´</li>
<li>å¤§è§„æ¨¡æ•°æ®é›†ï¼šå…¸å‹æ–‡ä»¶å¤§å° GB~TB çº§ï¼Œç™¾ä¸‡ä»¥ä¸Šæ–‡ä»¶æ•°é‡ï¼Œ PB ä»¥ä¸Šæ•°æ®è§„æ¨¡</li>
<li>æ„å»ºæˆæœ¬ä½ä¸”å®‰å…¨å¯é ï¼šè¿è¡Œåœ¨å¤§é‡çš„å»‰ä»·å•†ç”¨æœºå™¨ä¸Šï¼Œç¡¬ä»¶é”™è¯¯æ˜¯å¸¸æ€ï¼Œæä¾›å®¹é”™æœºåˆ¶</li>
</ul>
<h3 id="mapreduce"><a class="markdownIt-Anchor" href="#mapreduce"></a> MapReduce</h3>
<p><strong>æ¦‚å¿µ</strong></p>
<ul>
<li>é¢å‘æ‰¹å¤„ç†çš„åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶</li>
<li>ç¼–ç¨‹æ¨¡å‹ï¼šå°† MapReduce ç¨‹åºåˆ†ä¸º Mapã€Reduce ä¸¤ä¸ªé˜¶æ®µ</li>
</ul>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong></p>
<ul>
<li>åˆ†è€Œæ²»ä¹‹ï¼Œåˆ†å¸ƒå¼è®¡ç®—</li>
<li>ç§»åŠ¨è®¡ç®—ï¼Œè€Œéç§»åŠ¨æ•°æ®</li>
</ul>
<p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>é«˜å®¹é”™ï¼šä»»åŠ¡å¤±è´¥ï¼Œè‡ªåŠ¨è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹é‡æ–°æ‰§è¡Œ</li>
<li>é«˜æ‰©å±•ï¼šè®¡ç®—èƒ½åŠ›éšç€èŠ‚ç‚¹æ•°å¢åŠ ï¼Œè¿‘ä¼¼çº¿æ€§é€’å¢</li>
<li>é€‚ç”¨äºæµ·é‡æ•°æ®çš„ç¦»çº¿æ‰¹å¤„ç†</li>
<li>é™ä½äº†åˆ†å¸ƒå¼ç¼–ç¨‹çš„é—¨æ§›</li>
</ul>
<h3 id="spark"><a class="markdownIt-Anchor" href="#spark"></a> Spark</h3>
<p>é«˜æ€§èƒ½åˆ†å¸ƒå¼é€šç”¨è®¡ç®—å¼•æ“</p>
<ul>
<li>Spark Core - åŸºç¡€è®¡ç®—æ¡†æ¶ï¼ˆæ‰¹å¤„ç†ã€äº¤äº’å¼åˆ†æï¼‰</li>
<li>Spark SQL - SQL å¼•æ“ï¼ˆæµ·é‡ç»“æ„åŒ–æ•°æ®çš„é«˜æ€§èƒ½æŸ¥è¯¢ï¼‰</li>
<li>Spark Streaming - å®æ—¶æµå¤„ç†ï¼ˆå¾®æ‰¹ï¼‰</li>
<li>Spark MLlib - æœºå™¨å­¦ä¹ </li>
<li>Spark GraphX - å›¾è®¡ç®—</li>
</ul>
<p>é‡‡ç”¨ Scala è¯­è¨€å¼€å‘</p>
<p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>è®¡ç®—é«˜æ•ˆ - å†…å­˜è®¡ç®—ã€Cache ç¼“å­˜æœºåˆ¶ã€DAG å¼•æ“ã€å¤šçº¿ç¨‹æ± æ¨¡å‹</li>
<li>é€šç”¨æ˜“ç”¨ - é€‚ç”¨äºæ‰¹å¤„ç†ã€äº¤äº’å¼è®¡ç®—ã€æµå¤„ç†ã€æœºå™¨å­¦ä¹ ã€å›¾è®¡ç®—ç­‰å¤šç§åœºæ™¯</li>
<li>è¿è¡Œæ¨¡å¼å¤šæ · - Localã€Standaloneã€YARN/Mesos</li>
</ul>
<h3 id="yarn"><a class="markdownIt-Anchor" href="#yarn"></a> YARN</h3>
<p><strong>æ¦‚å¿µ</strong></p>
<ul>
<li>Yet Another Resource Negotiatorï¼Œå¦ä¸€ç§èµ„æºç®¡ç†å™¨</li>
<li>ä¸ºäº†è§£å†³ Hadoop 1.x ä¸­ MapReduce çš„å…ˆå¤©ç¼ºé™·</li>
<li>åˆ†å¸ƒå¼é€šç”¨èµ„æºç®¡ç†ç³»ç»Ÿ</li>
<li>è´Ÿè´£é›†ç¾¤èµ„æºçš„ç»Ÿä¸€ç®¡ç†</li>
<li>ä» Hadoop 2.x å¼€å§‹ï¼ŒYARN æˆä¸º Hadoop çš„æ ¸å¿ƒç»„ä»¶</li>
</ul>
<p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>ä¸“æ³¨äºèµ„æºç®¡ç†å’Œä½œä¸šè°ƒåº¦</li>
<li>é€šç”¨ - é€‚ç”¨å„ç§è®¡ç®—æ¡†æ¶ï¼Œå¦‚ - MapReduceã€Spark</li>
<li>é«˜å¯ç”¨ - ResourceManager é«˜å¯ç”¨ã€HDFS é«˜å¯ç”¨</li>
<li>é«˜æ‰©å±•</li>
</ul>
<h3 id="hive"><a class="markdownIt-Anchor" href="#hive"></a> Hive</h3>
<p><strong>æ¦‚å¿µ</strong></p>
<ul>
<li>Hadoop æ•°æ®ä»“åº“ - ä¼ä¸šå†³ç­–æ”¯æŒ</li>
<li>SQL å¼•æ“ - å¯¹æµ·é‡ç»“æ„åŒ–æ•°æ®è¿›è¡Œé«˜æ€§èƒ½çš„ SQL æŸ¥è¯¢</li>
<li>é‡‡ç”¨ HDFS æˆ– HBase ä¸ºæ•°æ®å­˜å‚¨</li>
<li>é‡‡ç”¨ MapReduce æˆ– Spark ä¸ºè®¡ç®—æ¡†æ¶</li>
</ul>
<p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>æä¾›ç±» SQL æŸ¥è¯¢è¯­è¨€</li>
<li>æ”¯æŒå‘½ä»¤è¡Œæˆ– JDBC/ODBC</li>
<li>æä¾›çµæ´»çš„æ‰©å±•æ€§</li>
<li>æä¾›å¤æ‚æ•°æ®ç±»å‹ã€æ‰©å±•å‡½æ•°ã€è„šæœ¬ç­‰</li>
</ul>
<h3 id="hbase"><a class="markdownIt-Anchor" href="#hbase"></a> HBase</h3>
<p><strong>æ¦‚å¿µ</strong></p>
<ul>
<li>Hadoop Database</li>
<li>Google BigTable çš„å¼€æºå®ç°</li>
<li>åˆ†å¸ƒå¼ NoSQL æ•°æ®åº“</li>
<li>åˆ—å¼å­˜å‚¨ - ä¸»è¦ç”¨äºåŠç»“æ„åŒ–ã€éç»“æ„åŒ–æ•°æ®</li>
<li>é‡‡ç”¨ HDFS ä¸ºæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ</li>
</ul>
<p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>é«˜æ€§èƒ½ - æ”¯æŒé«˜å¹¶å‘å†™å…¥å’ŒæŸ¥è¯¢</li>
<li>é«˜å¯ç”¨ - HDFS é«˜å¯ç”¨ã€Region é«˜å¯ç”¨</li>
<li>é«˜æ‰©å±• - æ•°æ®è‡ªåŠ¨åˆ‡åˆ†å’Œåˆ†å¸ƒï¼Œå¯åŠ¨æ€æ‰©å®¹ï¼Œæ— éœ€åœæœº</li>
<li>æµ·é‡å­˜å‚¨ - å•è¡¨å¯å®¹çº³æ•°åäº¿è¡Œï¼Œä¸Šç™¾ä¸‡åˆ—</li>
</ul>
<h3 id="elasticsearch"><a class="markdownIt-Anchor" href="#elasticsearch"></a> ElasticSearch</h3>
<ul>
<li>å¼€æºçš„åˆ†å¸ƒå¼å…¨æ–‡æ£€ç´¢å¼•æ“</li>
<li>åŸºäº Lucene å®ç°å…¨æ–‡æ•°æ®çš„å¿«é€Ÿå­˜å‚¨ã€æœç´¢å’Œåˆ†æ</li>
<li>å¤„ç†å¤§è§„æ¨¡æ•°æ® - PB çº§ä»¥ä¸Š</li>
<li>å…·æœ‰è¾ƒå¼ºçš„æ‰©å±•æ€§ï¼Œé›†ç¾¤è§„æ¨¡å¯è¾¾ä¸Šç™¾å°</li>
<li>é¦–é€‰çš„åˆ†å¸ƒå¼æœç´¢å¼•æ“</li>
</ul>
<h2 id="æœ¯è¯­"><a class="markdownIt-Anchor" href="#æœ¯è¯­"></a> æœ¯è¯­</h2>
<p><strong>æ•°æ®ä»“åº“ï¼ˆData Warehouseï¼‰</strong> - æ•°æ®ä»“åº“ï¼Œæ˜¯ä¸ºä¼ä¸šæ‰€æœ‰çº§åˆ«çš„å†³ç­–åˆ¶å®šè¿‡ç¨‹ï¼Œæä¾›æ‰€æœ‰ç±»å‹æ•°æ®æ”¯æŒçš„æˆ˜ç•¥é›†åˆã€‚å®ƒæ˜¯å•ä¸ªæ•°æ®å­˜å‚¨ï¼Œå‡ºäºåˆ†ææ€§æŠ¥å‘Šå’Œå†³ç­–æ”¯æŒç›®çš„è€Œåˆ›å»ºã€‚ ä¸ºéœ€è¦ä¸šåŠ¡æ™ºèƒ½çš„ä¼ä¸šï¼Œæä¾›æŒ‡å¯¼ä¸šåŠ¡æµç¨‹æ”¹è¿›ã€ç›‘è§†æ—¶é—´ã€æˆæœ¬ã€è´¨é‡ä»¥åŠæ§åˆ¶ã€‚</p>
<h2 id="èµ„æº"><a class="markdownIt-Anchor" href="#èµ„æº"></a> èµ„æº</h2>
<ul>
<li><a href="https://github.com/onurakpolat/awesome-bigdata" target="_blank" rel="noopener">awesome-bigdata</a></li>
<li><a href="http://hadoop.apache.org/" target="_blank" rel="noopener">Hadoop</a></li>
<li><a href="http://hbase.apache.org/" target="_blank" rel="noopener">HBase</a></li>
<li><a href="http://hive.apache.org/" target="_blank" rel="noopener">Hive</a></li>
<li><a href="http://impala.apache.org/" target="_blank" rel="noopener">Impala</a></li>
<li><a href="http://flume.apache.org/" target="_blank" rel="noopener">Flume</a></li>
<li><a href="http://kafka.apache.org/" target="_blank" rel="noopener">Kafka</a></li>
<li><a href="http://spark.apache.org/" target="_blank" rel="noopener">Spark</a></li>
<li><a href="http://sqoop.apache.org/" target="_blank" rel="noopener">Sqoop</a></li>
<li><a href="https://www.elastic.co/guide/index.html" target="_blank" rel="noopener">ElasticSearch</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/bigdata/YARN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/bigdata/YARN/" class="post-title-link" itemprop="url">YARN</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-09-03 00:00:00" itemprop="dateCreated datePublished" datetime="2018-09-03T00:00:00+08:00">2018-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-08 18:07:49" itemprop="dateModified" datetime="2019-05-08T18:07:49+08:00">2019-05-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/bigdata/" itemprop="url" rel="index">
                    <span itemprop="name">bigdata</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/bigdata/YARN/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="bigdata/YARN/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>2k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>2 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="yarn"><a class="markdownIt-Anchor" href="#yarn"></a> YARN</h1>
<blockquote>
<p>YARN çš„ç›®æ ‡æ˜¯è§£å†³ MapReduce çš„ç¼ºé™·ã€‚</p>
</blockquote>
<!-- TOC depthFrom:2 depthTo:3 -->
<ul>
<li><a href="#mapreduce-%E7%9A%84%E7%BC%BA%E9%99%B7hadoop-1x">MapReduce çš„ç¼ºé™·ï¼ˆHadoop 1.xï¼‰</a></li>
<li><a href="#yarn-%E7%AE%80%E4%BB%8B">YARN ç®€ä»‹</a></li>
<li><a href="#yarn-%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84">YARN ç³»ç»Ÿæ¶æ„</a>
<ul>
<li><a href="#resourcemanagerrm">ResourceManagerï¼ˆRMï¼‰</a></li>
<li><a href="#nodemanagernm">NodeManagerï¼ˆNMï¼‰</a></li>
<li><a href="#applicationmasteram">ApplicationMasterï¼ˆAMï¼‰</a></li>
<li><a href="#container">Container</a></li>
</ul>
</li>
<li><a href="#yarn-%E9%AB%98%E5%8F%AF%E7%94%A8">YARN é«˜å¯ç”¨</a></li>
<li><a href="#yarn-%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5">YARN èµ„æºè°ƒåº¦ç­–ç•¥</a>
<ul>
<li><a href="#fifo-scheduler%E5%85%88%E8%BF%9B%E5%85%88%E5%87%BA%E8%B0%83%E5%BA%A6%E5%99%A8">FIFO Schedulerï¼ˆå…ˆè¿›å…ˆå‡ºè°ƒåº¦å™¨ï¼‰</a></li>
<li><a href="#capacity-scheduler%E5%AE%B9%E9%87%8F%E8%B0%83%E5%BA%A6%E5%99%A8">Capacity Schedulerï¼ˆå®¹é‡è°ƒåº¦å™¨ï¼‰</a></li>
<li><a href="#fair-scheduler%E5%85%AC%E5%B9%B3%E8%B0%83%E5%BA%A6%E5%99%A8">Fair Schedulerï¼ˆå…¬å¹³è°ƒåº¦å™¨ï¼‰</a></li>
</ul>
</li>
<li><a href="#%E8%B5%84%E6%BA%90">èµ„æº</a></li>
</ul>
<!-- /TOC -->
<h2 id="mapreduce-çš„ç¼ºé™·hadoop-1x"><a class="markdownIt-Anchor" href="#mapreduce-çš„ç¼ºé™·hadoop-1x"></a> MapReduce çš„ç¼ºé™·ï¼ˆHadoop 1.xï¼‰</h2>
<ul>
<li>èº«å…¼ä¸¤èŒï¼šè®¡ç®—æ¡†æ¶ + èµ„æºç®¡ç†æ¡†æ¶</li>
<li>JobTracker
<ul>
<li>æ—¢åšèµ„æºç®¡ç†ï¼Œåˆåšä»»åŠ¡è°ƒåº¦</li>
<li>ä»»åŠ¡å¤ªé‡ï¼Œå¼€é”€è¿‡å¤§</li>
<li>å­˜åœ¨å•ç‚¹æ•…éšœ</li>
</ul>
</li>
<li>èµ„æºæè¿°æ¨¡å‹è¿‡äºç®€å•ï¼Œèµ„æºåˆ©ç”¨ç‡è¾ƒä½
<ul>
<li>ä»…æŠŠ Task æ•°é‡çœ‹ä½œèµ„æºï¼Œæ²¡æœ‰è€ƒè™‘ CPU å’Œå†…å­˜</li>
<li>å¼ºåˆ¶æŠŠèµ„æºåˆ†æˆ Map Task Slot å’Œ Reduce Task Slot</li>
</ul>
</li>
<li>æ‰©å±•æ€§è¾ƒå·®ï¼Œé›†ç¾¤è§„æ¨¡ä¸Šé™ 4K</li>
<li>æºç éš¾äºç†è§£ï¼Œå‡çº§ç»´æŠ¤å›°éš¾</li>
</ul>
<h2 id="yarn-ç®€ä»‹"><a class="markdownIt-Anchor" href="#yarn-ç®€ä»‹"></a> YARN ç®€ä»‹</h2>
<p>YARN(Yet Another Resource Negotiatorï¼Œå¦ä¸€ç§èµ„æºç®¡ç†å™¨)æ˜¯ä¸€ä¸ª<strong>åˆ†å¸ƒå¼é€šç”¨èµ„æºç®¡ç†ç³»ç»Ÿ</strong>ã€‚</p>
<p>è®¾è®¡ç›®æ ‡ï¼šèšç„¦èµ„æºç®¡ç†ã€é€šç”¨ï¼ˆé€‚ç”¨å„ç§è®¡ç®—æ¡†æ¶ï¼‰ã€é«˜å¯ç”¨ã€é«˜æ‰©å±•ã€‚</p>
<h2 id="yarn-ç³»ç»Ÿæ¶æ„"><a class="markdownIt-Anchor" href="#yarn-ç³»ç»Ÿæ¶æ„"></a> YARN ç³»ç»Ÿæ¶æ„</h2>
<ul>
<li>ä¸»ä»ç»“æ„ï¼ˆmaster/slaveï¼‰</li>
<li>å°† JobTracker çš„èµ„æºç®¡ç†ã€ä»»åŠ¡è°ƒåº¦åŠŸèƒ½åˆ†ç¦»</li>
<li>ä¸‰ç§è§’è‰²ï¼š
<ul>
<li>ResourceManagerï¼ˆMasterï¼‰ - é›†ç¾¤èµ„æºçš„ç»Ÿä¸€ç®¡ç†å’Œåˆ†é…</li>
<li>NodeManagerï¼ˆSlaveï¼‰ - ç®¡ç†èŠ‚ç‚¹èµ„æºï¼Œä»¥åŠå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>ApplicationMasterï¼ˆæ–°è§’è‰²ï¼‰ - ç®¡ç†åº”ç”¨ç¨‹åºå®ä¾‹ï¼ŒåŒ…æ‹¬ä»»åŠ¡è°ƒåº¦å’Œèµ„æºç”³è¯·</li>
</ul>
</li>
</ul>
<h3 id="resourcemanagerrm"><a class="markdownIt-Anchor" href="#resourcemanagerrm"></a> ResourceManagerï¼ˆRMï¼‰</h3>
<p><strong>ä¸»è¦åŠŸèƒ½</strong></p>
<ul>
<li>ç»Ÿä¸€ç®¡ç†é›†ç¾¤çš„æ‰€æœ‰èµ„æº</li>
<li>å°†èµ„æºæŒ‰ç…§ä¸€å®šç­–ç•¥åˆ†é…ç»™å„ä¸ªåº”ç”¨ï¼ˆApplicationMasterï¼‰</li>
<li>æ¥æ”¶ NodeManager çš„èµ„æºä¸ŠæŠ¥ä¿¡æ¯</li>
</ul>
<p><strong>æ ¸å¿ƒç»„ä»¶</strong></p>
<ul>
<li>ç”¨æˆ·äº¤äº’æœåŠ¡ï¼ˆUser Serviceï¼‰</li>
<li>NodeManager ç®¡ç†</li>
<li>ApplicationMaster ç®¡ç†</li>
<li>Application ç®¡ç†</li>
<li>å®‰å…¨ç®¡ç†</li>
<li>èµ„æºç®¡ç†</li>
</ul>
<h3 id="nodemanagernm"><a class="markdownIt-Anchor" href="#nodemanagernm"></a> NodeManagerï¼ˆNMï¼‰</h3>
<p><strong>ä¸»è¦åŠŸèƒ½</strong></p>
<ul>
<li>ç®¡ç†å•ä¸ªèŠ‚ç‚¹çš„èµ„æº</li>
<li>å‘ ResourceManager æ±‡æŠ¥èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ</li>
<li>ç®¡ç† Container çš„ç”Ÿå‘½å‘¨æœŸ</li>
</ul>
<p><strong>æ ¸å¿ƒç»„ä»¶</strong></p>
<ul>
<li>NodeStatusUpdater</li>
<li>ContainerManager</li>
<li>ContainerExecutor</li>
<li>NodeHealthCheckerService</li>
<li>Security</li>
<li>WebServer</li>
</ul>
<h3 id="applicationmasteram"><a class="markdownIt-Anchor" href="#applicationmasteram"></a> ApplicationMasterï¼ˆAMï¼‰</h3>
<p><strong>ä¸»è¦åŠŸèƒ½</strong></p>
<ul>
<li>ç®¡ç†åº”ç”¨ç¨‹åºå®ä¾‹</li>
<li>å‘ ResourceManager ç”³è¯·ä»»åŠ¡æ‰§è¡Œæ‰€éœ€çš„èµ„æº</li>
<li>ä»»åŠ¡è°ƒåº¦å’Œç›‘ç®¡</li>
</ul>
<p><strong>å®ç°æ–¹å¼</strong></p>
<ul>
<li>éœ€è¦ä¸ºæ¯ä¸ªåº”ç”¨å¼€å‘ä¸€ä¸ª AM ç»„ä»¶</li>
<li>YARN æä¾› MapReduce çš„ ApplicationMaster å®ç°</li>
<li>é‡‡ç”¨åŸºäºäº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œç”±ä¸­å¤®äº‹ä»¶è°ƒåº¦å™¨ç»Ÿä¸€ç®¡ç†æ‰€æœ‰äº‹ä»¶</li>
<li>æ¯ç§ç»„ä»¶éƒ½æ˜¯ä¸€ç§äº‹ä»¶å¤„ç†å™¨ï¼Œåœ¨ä¸­å¤®äº‹ä»¶è°ƒåº¦å™¨ä¸­æ³¨å†Œ</li>
</ul>
<h3 id="container"><a class="markdownIt-Anchor" href="#container"></a> Container</h3>
<ul>
<li>æ¦‚å¿µï¼šContainer å°è£…äº†èŠ‚ç‚¹ä¸Šè¿›ç¨‹çš„ç›¸å…³èµ„æºï¼Œæ˜¯ YARN ä¸­èµ„æºçš„æŠ½è±¡</li>
<li>åˆ†ç±»ï¼šè¿è¡Œ ApplicationMaster çš„ Container ã€è¿è¡Œåº”ç”¨ä»»åŠ¡çš„ Container</li>
</ul>
<h2 id="yarn-é«˜å¯ç”¨"><a class="markdownIt-Anchor" href="#yarn-é«˜å¯ç”¨"></a> YARN é«˜å¯ç”¨</h2>
<p>ResourceManager é«˜å¯ç”¨</p>
<ul>
<li>1 ä¸ª Active RMã€å¤šä¸ª Standby RM</li>
<li>å®•æœºåè‡ªåŠ¨å®ç°ä¸»å¤‡åˆ‡æ¢</li>
<li>ZooKeeper çš„æ ¸å¿ƒä½œç”¨
<ul>
<li>Active èŠ‚ç‚¹é€‰ä¸¾</li>
<li>æ¢å¤ Active RM çš„åŸæœ‰çŠ¶æ€ä¿¡æ¯</li>
</ul>
</li>
<li>é‡å¯ AMï¼Œæ€æ­»æ‰€æœ‰è¿è¡Œä¸­çš„ Container</li>
<li>åˆ‡æ¢æ–¹å¼ï¼šæ‰‹åŠ¨ã€è‡ªåŠ¨</li>
</ul>
<h2 id="yarn-èµ„æºè°ƒåº¦ç­–ç•¥"><a class="markdownIt-Anchor" href="#yarn-èµ„æºè°ƒåº¦ç­–ç•¥"></a> YARN èµ„æºè°ƒåº¦ç­–ç•¥</h2>
<h3 id="fifo-schedulerå…ˆè¿›å…ˆå‡ºè°ƒåº¦å™¨"><a class="markdownIt-Anchor" href="#fifo-schedulerå…ˆè¿›å…ˆå‡ºè°ƒåº¦å™¨"></a> FIFO Schedulerï¼ˆå…ˆè¿›å…ˆå‡ºè°ƒåº¦å™¨ï¼‰</h3>
<p><strong>è°ƒåº¦ç­–ç•¥</strong></p>
<p>å°†æ‰€æœ‰ä»»åŠ¡æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…ˆè¿›é˜Ÿåˆ—çš„å…ˆè·å¾—èµ„æºï¼Œæ’åœ¨åé¢çš„ä»»åŠ¡åªæœ‰ç­‰å¾…</p>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li>èµ„æºåˆ©ç”¨ç‡ä½ï¼Œæ— æ³•äº¤å‰è¿è¡Œä»»åŠ¡</li>
<li>çµæ´»æ€§å·®ï¼Œå¦‚ï¼šç´§æ€¥ä»»åŠ¡æ— æ³•æ’é˜Ÿï¼Œè€—æ—¶é•¿çš„ä»»åŠ¡æ‹–æ…¢è€—æ—¶çŸ­çš„ä»»åŠ¡</li>
</ul>
<h3 id="capacity-schedulerå®¹é‡è°ƒåº¦å™¨"><a class="markdownIt-Anchor" href="#capacity-schedulerå®¹é‡è°ƒåº¦å™¨"></a> Capacity Schedulerï¼ˆå®¹é‡è°ƒåº¦å™¨ï¼‰</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong> - æå‰<strong>åšé¢„ç®—</strong>ï¼Œåœ¨é¢„ç®—æŒ‡å¯¼ä¸‹åˆ†äº«é›†ç¾¤èµ„æºã€‚</p>
<p><strong>è°ƒåº¦ç­–ç•¥</strong></p>
<ul>
<li>é›†ç¾¤èµ„æºç”±å¤šä¸ªé˜Ÿåˆ—åˆ†äº«</li>
<li>æ¯ä¸ªé˜Ÿåˆ—éƒ½è¦é¢„è®¾èµ„æºåˆ†é…çš„æ¯”ä¾‹ï¼ˆæå‰åšé¢„ç®—ï¼‰</li>
<li>ç©ºé—²èµ„æºä¼˜å…ˆåˆ†é…ç»™â€œå®é™…èµ„æº/é¢„ç®—èµ„æºâ€æ¯”å€¼æœ€ä½çš„é˜Ÿåˆ—</li>
<li>é˜Ÿåˆ—å†…éƒ¨é‡‡ç”¨ FIFO è°ƒåº¦ç­–ç•¥</li>
</ul>
<p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>å±‚æ¬¡åŒ–çš„é˜Ÿåˆ—è®¾è®¡ï¼šå­é˜Ÿåˆ—å¯ä½¿ç”¨çˆ¶é˜Ÿåˆ—èµ„æº</li>
<li>å®¹é‡ä¿è¯ï¼šæ¯ä¸ªé˜Ÿåˆ—éƒ½è¦é¢„è®¾èµ„æºå æ¯”ï¼Œé˜²æ­¢èµ„æºç‹¬å </li>
<li>å¼¹æ€§åˆ†é…ï¼šç©ºé—²èµ„æºå¯ä»¥åˆ†é…ç»™ä»»ä½•é˜Ÿåˆ—ï¼Œå½“å¤šä¸ªé˜Ÿåˆ—äº‰ç”¨æ—¶ï¼Œä¼šæŒ‰æ¯”ä¾‹è¿›è¡Œå¹³è¡¡</li>
<li>æ”¯æŒåŠ¨æ€ç®¡ç†ï¼šå¯ä»¥åŠ¨æ€è°ƒæ•´é˜Ÿåˆ—çš„å®¹é‡ã€æƒé™ç­‰å‚æ•°ï¼Œä¹Ÿå¯åŠ¨æ€å¢åŠ ã€æš‚åœé˜Ÿåˆ—</li>
<li>è®¿é—®æ§åˆ¶ï¼šç”¨æˆ·åªèƒ½å‘è‡ªå·±çš„é˜Ÿåˆ—ä¸­æäº¤ä»»åŠ¡ï¼Œä¸èƒ½è®¿é—®å…¶ä»–é˜Ÿåˆ—</li>
<li>å¤šç§Ÿæˆ·ï¼šå¤šç”¨æˆ·å…±äº«é›†ç¾¤èµ„æº</li>
</ul>
<h3 id="fair-schedulerå…¬å¹³è°ƒåº¦å™¨"><a class="markdownIt-Anchor" href="#fair-schedulerå…¬å¹³è°ƒåº¦å™¨"></a> Fair Schedulerï¼ˆå…¬å¹³è°ƒåº¦å™¨ï¼‰</h3>
<p><strong>è°ƒåº¦ç­–ç•¥</strong></p>
<ul>
<li>å¤šé˜Ÿåˆ—å…¬å¹³å…±äº«é›†ç¾¤èµ„æº</li>
<li>é€šè¿‡å¹³åˆ†çš„æ–¹å¼ï¼ŒåŠ¨æ€åˆ†é…èµ„æºï¼Œæ— éœ€é¢„å…ˆè®¾å®šèµ„æºåˆ†é…æ¯”ä¾‹</li>
<li>é˜Ÿåˆ—å†…éƒ¨å¯é…ç½®è°ƒåº¦ç­–ç•¥ï¼šFIFOã€Fairï¼ˆé»˜è®¤ï¼‰</li>
</ul>
<p><strong>èµ„æºæŠ¢å </strong></p>
<ul>
<li>ç»ˆæ­¢å…¶ä»–é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œä½¿å…¶è®©å‡ºæ‰€å èµ„æºï¼Œç„¶åå°†èµ„æºåˆ†é…ç»™å ç”¨èµ„æºé‡å°‘äºæœ€å°èµ„æºé‡é™åˆ¶çš„é˜Ÿåˆ—</li>
</ul>
<p><strong>é˜Ÿåˆ—æƒé‡</strong></p>
<ul>
<li>å½“é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡ç­‰å¾…ï¼Œå¹¶ä¸”é›†ç¾¤ä¸­æœ‰ç©ºé—²èµ„æºæ—¶ï¼Œæ¯ä¸ªé˜Ÿåˆ—å¯ä»¥æ ¹æ®æƒé‡è·å¾—ä¸åŒæ¯”ä¾‹çš„ç©ºé—²èµ„æº</li>
</ul>
<h2 id="èµ„æº"><a class="markdownIt-Anchor" href="#èµ„æº"></a> èµ„æº</h2>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/bigdata/HDFS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/bigdata/HDFS/" class="post-title-link" itemprop="url">HDFS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-09-03 00:00:00" itemprop="dateCreated datePublished" datetime="2018-09-03T00:00:00+08:00">2018-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-08-21 13:20:27" itemprop="dateModified" datetime="2019-08-21T13:20:27+08:00">2019-08-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/bigdata/" itemprop="url" rel="index">
                    <span itemprop="name">bigdata</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/bigdata/HDFS/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="bigdata/HDFS/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>4.1k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>4 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="hdfs"><a class="markdownIt-Anchor" href="#hdfs"></a> HDFS</h1>
<blockquote>
<p><strong>HDFS æ˜¯ Hadoop åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚</strong></p>
<p>å…³é”®è¯ï¼šåˆ†å¸ƒå¼ã€æ–‡ä»¶ç³»ç»Ÿ</p>
</blockquote>
<!-- TOC depthFrom:2 depthTo:3 -->
<ul>
<li><a href="#%E6%A6%82%E8%BF%B0">æ¦‚è¿°</a>
<ul>
<li><a href="#hdfs-%E7%9A%84%E7%89%B9%E7%82%B9">HDFS çš„ç‰¹ç‚¹</a></li>
</ul>
</li>
<li><a href="#hdfs-%E7%9A%84%E6%A6%82%E5%BF%B5">HDFS çš„æ¦‚å¿µ</a>
<ul>
<li><a href="#namenode">NameNode</a></li>
<li><a href="#datanode">DataNode</a></li>
<li><a href="#block-%E6%95%B0%E6%8D%AE%E5%9D%97">Block æ•°æ®å—</a></li>
<li><a href="#client">Client</a></li>
</ul>
</li>
<li><a href="#block-%E5%89%AF%E6%9C%AC%E7%AD%96%E7%95%A5">Block å‰¯æœ¬ç­–ç•¥</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%B5%81">æ•°æ®æµ</a>
<ul>
<li><a href="#hdfs-%E8%AF%BB%E6%96%87%E4%BB%B6">HDFS è¯»æ–‡ä»¶</a></li>
<li><a href="#hdfs-%E5%86%99%E6%96%87%E4%BB%B6">HDFS å†™æ–‡ä»¶</a></li>
</ul>
</li>
<li><a href="#hdfs-%E5%AE%89%E5%85%A8%E6%A8%A1%E5%BC%8F">HDFS å®‰å…¨æ¨¡å¼</a>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%89%E5%85%A8%E6%A8%A1%E5%BC%8F">ä»€ä¹ˆæ˜¯å®‰å…¨æ¨¡å¼ï¼Ÿ</a></li>
<li><a href="#%E4%BD%95%E6%97%B6%E6%AD%A3%E5%B8%B8%E7%A6%BB%E5%BC%80%E5%AE%89%E5%85%A8%E6%A8%A1%E5%BC%8F">ä½•æ—¶æ­£å¸¸ç¦»å¼€å®‰å…¨æ¨¡å¼</a></li>
<li><a href="#%E8%A7%A6%E5%8F%91%E5%AE%89%E5%85%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8E%9F%E5%9B%A0">è§¦å‘å®‰å…¨æ¨¡å¼çš„åŸå› </a></li>
<li><a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5">æ•…éšœæ’æŸ¥</a></li>
</ul>
</li>
<li><a href="#hdfs-%E9%AB%98%E5%8F%AF%E7%94%A8">HDFS é«˜å¯ç”¨</a>
<ul>
<li><a href="#namenode-%E7%9A%84-ha-%E6%9C%BA%E5%88%B6">NameNode çš„ HA æœºåˆ¶</a></li>
<li><a href="#%E5%88%A9%E7%94%A8-qjm-%E5%AE%9E%E7%8E%B0%E5%85%83%E6%95%B0%E6%8D%AE%E9%AB%98%E5%8F%AF%E7%94%A8">åˆ©ç”¨ QJM å®ç°å…ƒæ•°æ®é«˜å¯ç”¨</a></li>
</ul>
</li>
<li><a href="#%E8%B5%84%E6%BA%90">èµ„æº</a></li>
</ul>
<!-- /TOC -->
<h2 id="æ¦‚è¿°"><a class="markdownIt-Anchor" href="#æ¦‚è¿°"></a> æ¦‚è¿°</h2>
<blockquote>
<p>HDFS æ˜¯ Hadoop çš„æ ¸å¿ƒå­é¡¹ç›®ã€‚</p>
<p><strong>HDFS</strong> æ˜¯ <strong>Hadoop Distributed File System</strong> çš„ç¼©å†™ï¼Œå³ Hadoop åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>HDFS æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨å…·æœ‰æµæ•°æ®è®¿é—®æ¨¡å¼çš„è¶…å¤§æ–‡ä»¶çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒè¿è¡Œåœ¨å»‰ä»·çš„æœºå™¨é›†ç¾¤ä¸Šã€‚</p>
</blockquote>
<h3 id="hdfs-çš„ç‰¹ç‚¹"><a class="markdownIt-Anchor" href="#hdfs-çš„ç‰¹ç‚¹"></a> HDFS çš„ç‰¹ç‚¹</h3>
<p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li><strong>é«˜å®¹é”™</strong> - æ•°æ®å†—ä½™å¤šå‰¯æœ¬ï¼Œå‰¯æœ¬ä¸¢å¤±åè‡ªåŠ¨æ¢å¤</li>
<li><strong>é«˜å¯ç”¨</strong> - NameNode HAã€å®‰å…¨æ¨¡å¼</li>
<li><strong>é«˜æ‰©å±•</strong> - èƒ½å¤Ÿå¤„ç† 10K èŠ‚ç‚¹çš„è§„æ¨¡ï¼›å¤„ç†æ•°æ®è¾¾åˆ° GBã€TBã€ç”šè‡³ PB çº§åˆ«çš„æ•°æ®ï¼›èƒ½å¤Ÿå¤„ç†ç™¾ä¸‡è§„æ¨¡ä»¥ä¸Šçš„æ–‡ä»¶æ•°é‡ï¼Œæ•°é‡ç›¸å½“ä¹‹å¤§ã€‚</li>
<li><strong>æ‰¹å¤„ç†</strong> - æµå¼æ•°æ®è®¿é—®ï¼›æ•°æ®ä½ç½®æš´éœ²ç»™è®¡ç®—æ¡†æ¶</li>
<li><strong>æ„å»ºåœ¨å»‰ä»·å•†ç”¨æœºå™¨ä¸Š</strong> - æä¾›äº†å®¹é”™å’Œæ¢å¤æœºåˆ¶</li>
</ul>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li><strong>ä¸é€‚åˆä½å»¶è¿Ÿæ•°æ®è®¿é—®</strong> - é€‚åˆé«˜ååç‡çš„åœºæ™¯ï¼Œå°±æ˜¯åœ¨æŸä¸€æ—¶é—´å†…å†™å…¥å¤§é‡çš„æ•°æ®ã€‚ä½†æ˜¯å®ƒåœ¨ä½å»¶æ—¶çš„æƒ…å†µä¸‹æ˜¯ä¸è¡Œçš„ï¼Œæ¯”å¦‚æ¯«ç§’çº§ä»¥å†…è¯»å–æ•°æ®ï¼Œå®ƒæ˜¯å¾ˆéš¾åšåˆ°çš„ã€‚</li>
<li><strong>ä¸é€‚åˆå¤§é‡å°æ–‡ä»¶å­˜å‚¨</strong>
<ul>
<li>å­˜å‚¨å¤§é‡å°æ–‡ä»¶(è¿™é‡Œçš„å°æ–‡ä»¶æ˜¯æŒ‡å°äº HDFS ç³»ç»Ÿçš„ Block å¤§å°çš„æ–‡ä»¶ï¼ˆé»˜è®¤ 64Mï¼‰)çš„è¯ï¼Œå®ƒä¼šå ç”¨ NameNode å¤§é‡çš„å†…å­˜æ¥å­˜å‚¨æ–‡ä»¶ã€ç›®å½•å’Œå—ä¿¡æ¯ã€‚è¿™æ ·æ˜¯ä¸å¯å–çš„ï¼Œå› ä¸º NameNode çš„å†…å­˜æ€»æ˜¯æœ‰é™çš„ã€‚</li>
<li>ç£ç›˜å¯»é“æ—¶é—´è¶…è¿‡è¯»å–æ—¶é—´</li>
</ul>
</li>
<li><strong>ä¸æ”¯æŒå¹¶å‘å†™å…¥</strong> - ä¸€ä¸ªæ–‡ä»¶åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªå†™å…¥è€…</li>
<li><strong>ä¸æ”¯æŒæ–‡ä»¶éšæœºä¿®æ”¹</strong> - ä»…æ”¯æŒè¿½åŠ å†™å…¥</li>
</ul>
<h2 id="hdfs-çš„æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#hdfs-çš„æ¦‚å¿µ"></a> HDFS çš„æ¦‚å¿µ</h2>
<p>HDFS é‡‡ç”¨ Master/Slave æ¶æ„ã€‚</p>
<p>ä¸€ä¸ª HDFS é›†ç¾¤æ˜¯ç”±ä¸€ä¸ª Namenode å’Œä¸€å®šæ•°ç›®çš„ Datanodes ç»„æˆã€‚Namenode æ˜¯ä¸€ä¸ªä¸­å¿ƒæœåŠ¡å™¨ï¼Œè´Ÿè´£ç®¡ç†æ–‡ä»¶ç³»ç»Ÿçš„åå­—ç©ºé—´(namespace)ä»¥åŠå®¢æˆ·ç«¯å¯¹æ–‡ä»¶çš„è®¿é—®ã€‚é›†ç¾¤ä¸­çš„ Datanode ä¸€èˆ¬æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ä¸€ä¸ªï¼Œè´Ÿè´£ç®¡ç†å®ƒæ‰€åœ¨èŠ‚ç‚¹ä¸Šçš„å­˜å‚¨ã€‚HDFS æš´éœ²äº†æ–‡ä»¶ç³»ç»Ÿçš„åå­—ç©ºé—´ï¼Œç”¨æˆ·èƒ½å¤Ÿä»¥æ–‡ä»¶çš„å½¢å¼åœ¨ä¸Šé¢å­˜å‚¨æ•°æ®ã€‚ä»å†…éƒ¨çœ‹ï¼Œä¸€ä¸ªæ–‡ä»¶å…¶å®è¢«åˆ†æˆä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å—ï¼Œè¿™äº›å—å­˜å‚¨åœ¨ä¸€ç»„ Datanode ä¸Šã€‚Namenode æ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿçš„åå­—ç©ºé—´æ“ä½œï¼Œæ¯”å¦‚æ‰“å¼€ã€å…³é—­ã€é‡å‘½åæ–‡ä»¶æˆ–ç›®å½•ã€‚å®ƒä¹Ÿè´Ÿè´£ç¡®å®šæ•°æ®å—åˆ°å…·ä½“ Datanode èŠ‚ç‚¹çš„æ˜ å°„ã€‚Datanode è´Ÿè´£å¤„ç†æ–‡ä»¶ç³»ç»Ÿå®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€‚åœ¨ Namenode çš„ç»Ÿä¸€è°ƒåº¦ä¸‹è¿›è¡Œæ•°æ®å—çš„åˆ›å»ºã€åˆ é™¤å’Œå¤åˆ¶ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/bigdata/hdfs/hdfs-architecture.png"/></div>
<h3 id="namenode"><a class="markdownIt-Anchor" href="#namenode"></a> NameNode</h3>
<p><strong>NameNode å°±æ˜¯ master å·¥ä½œèŠ‚ç‚¹ã€‚</strong></p>
<ul>
<li>ç®¡ç†å‘½åç©ºé—´</li>
<li>ç®¡ç†å…ƒæ•°æ®ï¼šæ–‡ä»¶çš„ä½ç½®ã€æ‰€æœ‰è€…ã€æƒé™ã€æ•°æ®å—ç­‰</li>
<li>ç®¡ç† Block å‰¯æœ¬ç­–ç•¥ï¼šé»˜è®¤ 3 ä¸ªå‰¯æœ¬</li>
<li>å¤„ç†å®¢æˆ·ç«¯è¯»å†™è¯·æ±‚ï¼Œä¸º DataNode åˆ†é…ä»»åŠ¡</li>
</ul>
<h4 id="active-namenode-å’Œ-standby-namenode"><a class="markdownIt-Anchor" href="#active-namenode-å’Œ-standby-namenode"></a> Active NameNode å’Œ Standby NameNode</h4>
<p>NameNode é€šè¿‡ HA æœºåˆ¶æ¥å®¹é”™ã€‚</p>
<ul>
<li><strong>Active NameNode</strong> - æ˜¯æ­£åœ¨å·¥ä½œçš„ NameNodeï¼›</li>
<li><strong>Standby NameNode</strong> - æ˜¯å¤‡ä»½çš„ NameNodeã€‚</li>
</ul>
<p>Active NameNode å®•æœºåï¼ŒStandby NameNode å¿«é€Ÿå‡çº§ä¸ºæ–°çš„ Active NameNodeã€‚</p>
<p>Standby NameNode å‘¨æœŸæ€§åŒæ­¥ edits ç¼–è¾‘æ—¥å¿—ï¼Œå®šæœŸåˆå¹¶ fsimage ä¸ edits åˆ°æœ¬åœ°ç£ç›˜ã€‚</p>
<p>Hadoop 3.0 å…è®¸é…ç½®å¤šä¸ª Standby NameNodeã€‚</p>
<h4 id="å…ƒæ•°æ®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#å…ƒæ•°æ®æ–‡ä»¶"></a> å…ƒæ•°æ®æ–‡ä»¶</h4>
<ul>
<li><strong>editsï¼ˆç¼–è¾‘æ—¥å¿—æ–‡ä»¶ï¼‰</strong> - ä¿å­˜äº†è‡ªæœ€æ–°æ£€æŸ¥ç‚¹ï¼ˆCheckpointï¼‰ä¹‹åçš„æ‰€æœ‰æ–‡ä»¶æ›´æ–°æ“ä½œã€‚</li>
<li><strong>fsimageï¼ˆå…ƒæ•°æ®æ£€æŸ¥ç‚¹é•œåƒæ–‡ä»¶ï¼‰</strong> - ä¿å­˜äº†æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰çš„ç›®å½•å’Œæ–‡ä»¶ä¿¡æ¯ï¼Œå¦‚ï¼šæŸä¸ªç›®å½•ä¸‹æœ‰å“ªäº›å­ç›®å½•å’Œæ–‡ä»¶ï¼Œä»¥åŠæ–‡ä»¶åã€æ–‡ä»¶å‰¯æœ¬æ•°ã€æ–‡ä»¶ç”±å“ªäº› Block ç»„æˆç­‰ã€‚</li>
</ul>
<p>Active NameNode å†…å­˜ä¸­æœ‰ä¸€ä»½æœ€æ–°çš„å…ƒæ•°æ®ï¼ˆ= fsimage + editsï¼‰ã€‚</p>
<p>Standby NameNode åœ¨æ£€æŸ¥ç‚¹å®šæœŸå°†å†…å­˜ä¸­çš„å…ƒæ•°æ®ä¿å­˜åˆ° fsimage æ–‡ä»¶ä¸­ã€‚</p>
<h3 id="datanode"><a class="markdownIt-Anchor" href="#datanode"></a> DataNode</h3>
<p>**DataNode å°±æ˜¯ slave å·¥ä½œèŠ‚ç‚¹ã€‚**NameNode ä¸‹è¾¾å‘½ä»¤ï¼ŒDataNode æ‰§è¡Œå®é™…çš„æ“ä½œã€‚</p>
<ul>
<li>å­˜å‚¨ Block å’Œæ•°æ®æ ¡éªŒå’Œ</li>
<li>æ‰§è¡Œå®¢æˆ·ç«¯å‘é€çš„è¯»å†™æ“ä½œ</li>
<li>é€šè¿‡å¿ƒè·³æœºåˆ¶å®šæœŸï¼ˆé»˜è®¤ 3 ç§’ï¼‰å‘ NameNode æ±‡æŠ¥è¿è¡ŒçŠ¶æ€å’Œ Block åˆ—è¡¨ä¿¡æ¯</li>
<li>é›†ç¾¤å¯åŠ¨æ—¶ï¼ŒDataNode å‘ NameNode æä¾› Block åˆ—è¡¨ä¿¡æ¯</li>
</ul>
<h3 id="block-æ•°æ®å—"><a class="markdownIt-Anchor" href="#block-æ•°æ®å—"></a> Block æ•°æ®å—</h3>
<ul>
<li>HDFS æœ€å°å­˜å‚¨å•å…ƒ</li>
<li>æ–‡ä»¶å†™å…¥ HDFS ä¼šè¢«åˆ‡åˆ†æˆè‹¥å¹²ä¸ª Block</li>
<li>Block å¤§å°å›ºå®šï¼Œé»˜è®¤ä¸º 128MBï¼Œå¯è‡ªå®šä¹‰</li>
<li>è‹¥ä¸€ä¸ª Block çš„å¤§å°å°äºè®¾å®šå€¼ï¼Œä¸ä¼šå ç”¨æ•´ä¸ªå—ç©ºé—´</li>
<li>é»˜è®¤æƒ…å†µä¸‹æ¯ä¸ª Block æœ‰ 3 ä¸ªå‰¯æœ¬</li>
</ul>
<h3 id="client"><a class="markdownIt-Anchor" href="#client"></a> Client</h3>
<ul>
<li>å°†æ–‡ä»¶åˆ‡åˆ†ä¸º Block æ•°æ®å—</li>
<li>ä¸ NameNode äº¤äº’ï¼Œè·å–æ–‡ä»¶å…ƒæ•°æ®</li>
<li>ä¸ DataNode äº¤äº’ï¼Œè¯»å–æˆ–å†™å…¥æ•°æ®</li>
<li>ç®¡ç† HDFS</li>
</ul>
<h2 id="block-å‰¯æœ¬ç­–ç•¥"><a class="markdownIt-Anchor" href="#block-å‰¯æœ¬ç­–ç•¥"></a> Block å‰¯æœ¬ç­–ç•¥</h2>
<p>HDFS è¢«è®¾è®¡æˆèƒ½å¤Ÿåœ¨ä¸€ä¸ªå¤§é›†ç¾¤ä¸­è·¨æœºå™¨å¯é åœ°å­˜å‚¨è¶…å¤§æ–‡ä»¶ã€‚å®ƒå°†æ¯ä¸ªæ–‡ä»¶å­˜å‚¨æˆä¸€ç³»åˆ—çš„æ•°æ®å—ï¼Œé™¤äº†æœ€åä¸€ä¸ªï¼Œæ‰€æœ‰çš„æ•°æ®å—éƒ½æ˜¯åŒæ ·å¤§å°çš„ã€‚ä¸ºäº†å®¹é”™ï¼Œæ–‡ä»¶çš„æ‰€æœ‰æ•°æ®å—éƒ½ä¼šæœ‰å‰¯æœ¬ã€‚æ¯ä¸ªæ–‡ä»¶çš„æ•°æ®å—å¤§å°å’Œå‰¯æœ¬ç³»æ•°éƒ½æ˜¯å¯é…ç½®çš„ã€‚åº”ç”¨ç¨‹åºå¯ä»¥æŒ‡å®šæŸä¸ªæ–‡ä»¶çš„å‰¯æœ¬æ•°ç›®ã€‚å‰¯æœ¬ç³»æ•°å¯ä»¥åœ¨æ–‡ä»¶åˆ›å»ºçš„æ—¶å€™æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨ä¹‹åæ”¹å˜ã€‚HDFS ä¸­çš„æ–‡ä»¶éƒ½æ˜¯ä¸€æ¬¡æ€§å†™å…¥çš„ï¼Œå¹¶ä¸”ä¸¥æ ¼è¦æ±‚åœ¨ä»»ä½•æ—¶å€™åªèƒ½æœ‰ä¸€ä¸ªå†™å…¥è€…ã€‚</p>
<p><strong>Namenode å…¨æƒç®¡ç†æ•°æ®å—çš„å¤åˆ¶</strong>ï¼Œå®ƒå‘¨æœŸæ€§åœ°ä»é›†ç¾¤ä¸­çš„æ¯ä¸ª Datanode æ¥æ”¶å¿ƒè·³ä¿¡å·å’Œå—çŠ¶æ€æŠ¥å‘Š(Blockreport)ã€‚æ¥æ”¶åˆ°å¿ƒè·³ä¿¡å·æ„å‘³ç€è¯¥ Datanode èŠ‚ç‚¹å·¥ä½œæ­£å¸¸ã€‚å—çŠ¶æ€æŠ¥å‘ŠåŒ…å«äº†ä¸€ä¸ªè¯¥ Datanode ä¸Šæ‰€æœ‰æ•°æ®å—çš„åˆ—è¡¨ã€‚</p>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/bigdata/hdfs/hdfs-replica.png"/></div>
<ul>
<li>å‰¯æœ¬ 1ï¼šæ”¾åœ¨ Client æ‰€åœ¨èŠ‚ç‚¹
<ul>
<li>å¯¹äºè¿œç¨‹ Clientï¼Œç³»ç»Ÿä¼šéšæœºé€‰æ‹©èŠ‚ç‚¹</li>
</ul>
</li>
<li>å‰¯æœ¬ 2ï¼šæ”¾åœ¨ä¸åŒçš„æœºæ¶èŠ‚ç‚¹ä¸Š</li>
<li>å‰¯æœ¬ 3ï¼šæ”¾åœ¨ä¸ç¬¬äºŒä¸ªå‰¯æœ¬åŒä¸€æœºæ¶çš„ä¸åŒèŠ‚ç‚¹ä¸Š</li>
<li>å‰¯æœ¬ Nï¼šéšæœºé€‰æ‹©</li>
<li>èŠ‚ç‚¹é€‰æ‹©ï¼šåŒç­‰æ¡ä»¶ä¸‹ä¼˜å…ˆé€‰æ‹©ç©ºé—²èŠ‚ç‚¹</li>
</ul>
<h2 id="æ•°æ®æµ"><a class="markdownIt-Anchor" href="#æ•°æ®æµ"></a> æ•°æ®æµ</h2>
<h3 id="hdfs-è¯»æ–‡ä»¶"><a class="markdownIt-Anchor" href="#hdfs-è¯»æ–‡ä»¶"></a> HDFS è¯»æ–‡ä»¶</h3>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/bigdata/hdfs/hdfs-read.png"/></div>
<ol>
<li>å®¢æˆ·ç«¯è°ƒç”¨ FileSyste å¯¹è±¡çš„ open() æ–¹æ³•åœ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸­<strong>æ‰“å¼€è¦è¯»å–çš„æ–‡ä»¶</strong>ã€‚</li>
<li>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿé€šè¿‡ä½¿ç”¨ RPCï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰æ¥è°ƒç”¨ namenodeï¼Œ<strong>ç¡®å®šæ–‡ä»¶èµ·å§‹å—çš„ä½ç½®</strong>ã€‚</li>
<li>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„ DistributedFileSystem ç±»è¿”å›ä¸€ä¸ªæ”¯æŒæ–‡ä»¶å®šä½çš„è¾“å…¥æµ FSDataInputStream å¯¹è±¡ï¼ŒFSDataInputStream å¯¹è±¡æ¥ç€å°è£… DFSInputStream å¯¹è±¡ï¼ˆ<strong>å­˜å‚¨ç€æ–‡ä»¶èµ·å§‹å‡ ä¸ªå—çš„ datanode åœ°å€</strong>ï¼‰ï¼Œå®¢æˆ·ç«¯å¯¹è¿™ä¸ªè¾“å…¥æµè°ƒç”¨ read()æ–¹æ³•ã€‚</li>
<li>DFSInputStream è¿æ¥è·ç¦»æœ€è¿‘çš„ datanodeï¼Œé€šè¿‡åå¤è°ƒç”¨ read æ–¹æ³•ï¼Œ<strong>å°†æ•°æ®ä» datanode ä¼ è¾“åˆ°å®¢æˆ·ç«¯</strong>ã€‚</li>
<li>åˆ°è¾¾å—çš„æœ«ç«¯æ—¶ï¼ŒDFSInputStream å…³é—­ä¸è¯¥ datanode çš„è¿æ¥ï¼Œ<strong>å¯»æ‰¾ä¸‹ä¸€ä¸ªå—çš„æœ€ä½³ datanode</strong>ã€‚</li>
<li>å®¢æˆ·ç«¯å®Œæˆè¯»å–ï¼Œå¯¹ FSDataInputStream è°ƒç”¨ close()æ–¹æ³•<strong>å…³é—­è¿æ¥</strong>ã€‚</li>
</ol>
<h3 id="hdfs-å†™æ–‡ä»¶"><a class="markdownIt-Anchor" href="#hdfs-å†™æ–‡ä»¶"></a> HDFS å†™æ–‡ä»¶</h3>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/bigdata/hdfs/hdfs-write.png"/></div>
<ol>
<li>å®¢æˆ·ç«¯é€šè¿‡å¯¹ DistributedFileSystem å¯¹è±¡è°ƒç”¨ create() å‡½æ•°æ¥<strong>æ–°å»ºæ–‡ä»¶</strong>ã€‚</li>
<li>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå¯¹ namenod åˆ›å»ºä¸€ä¸ª RPC è°ƒç”¨ï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿçš„<strong>å‘½åç©ºé—´ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶</strong>ã€‚</li>
<li>Namenode å¯¹æ–°å»ºæ–‡ä»¶è¿›è¡Œæ£€æŸ¥æ— è¯¯åï¼Œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿè¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ª FSDataOutputStream å¯¹è±¡ï¼ŒFSDataOutputStream å¯¹è±¡å°è£…ä¸€ä¸ª DFSoutPutstream å¯¹è±¡ï¼Œè´Ÿè´£å¤„ç† namenode å’Œ datanode ä¹‹é—´çš„é€šä¿¡ï¼Œ<strong>å®¢æˆ·ç«¯å¼€å§‹å†™å…¥æ•°æ®</strong>ã€‚</li>
<li>FSDataOutputStream å°†<strong>æ•°æ®åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„æ•°æ®åŒ…ï¼Œå†™å…¥å†…éƒ¨é˜Ÿåˆ—â€œæ•°æ®é˜Ÿåˆ—â€</strong>ï¼ŒDataStreamer è´Ÿè´£å°†æ•°æ®åŒ…ä¾æ¬¡æµå¼ä¼ è¾“åˆ°ç”±ä¸€ç»„ namenode æ„æˆçš„ç®¡çº¿ä¸­ã€‚</li>
<li>DFSOutputStream ç»´æŠ¤ç€ç¡®è®¤é˜Ÿåˆ—æ¥ç­‰å¾… datanode æ”¶åˆ°ç¡®è®¤å›æ‰§ï¼Œ<strong>æ”¶åˆ°ç®¡é“ä¸­æ‰€æœ‰ datanode ç¡®è®¤åï¼Œæ•°æ®åŒ…ä»ç¡®è®¤é˜Ÿåˆ—åˆ </strong>é™¤ã€‚</li>
<li><strong>å®¢æˆ·ç«¯å®Œæˆæ•°æ®çš„å†™å…¥</strong>ï¼Œå¯¹æ•°æ®æµè°ƒç”¨ close() æ–¹æ³•ã€‚</li>
<li>namenode <strong>ç¡®è®¤å®Œæˆ</strong>ã€‚</li>
</ol>
<h2 id="hdfs-å®‰å…¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#hdfs-å®‰å…¨æ¨¡å¼"></a> HDFS å®‰å…¨æ¨¡å¼</h2>
<h3 id="ä»€ä¹ˆæ˜¯å®‰å…¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯å®‰å…¨æ¨¡å¼"></a> ä»€ä¹ˆæ˜¯å®‰å…¨æ¨¡å¼ï¼Ÿ</h3>
<ul>
<li>å®‰å…¨æ¨¡å¼æ˜¯ HDFS çš„ä¸€ç§ç‰¹æ®ŠçŠ¶æ€ï¼Œåœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼ŒHDFS åªæ¥æ”¶è¯»æ•°æ®è¯·æ±‚ï¼Œè€Œä¸æ¥æ”¶å†™å…¥ã€åˆ é™¤ã€ä¿®æ”¹ç­‰å˜æ›´è¯·æ±‚ã€‚</li>
<li>å®‰å…¨æ¨¡å¼æ˜¯ HDFS ç¡®ä¿ Block æ•°æ®å®‰å…¨çš„ä¸€ç§ä¿æŠ¤æœºåˆ¶ã€‚</li>
<li>Active NameNode å¯åŠ¨æ—¶ï¼ŒHDFS ä¼šè¿›å…¥å®‰å…¨æ¨¡å¼ï¼ŒDataNode ä¸»åŠ¨å‘ NameNode æ±‡æŠ¥å¯ç”¨ Block åˆ—è¡¨ç­‰ä¿¡æ¯ï¼Œåœ¨ç³»ç»Ÿè¾¾åˆ°å®‰å…¨æ ‡å‡†å‰ï¼ŒHDFS ä¸€ç›´å¤„äºâ€œåªè¯»â€çŠ¶æ€ã€‚</li>
</ul>
<h3 id="ä½•æ—¶æ­£å¸¸ç¦»å¼€å®‰å…¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#ä½•æ—¶æ­£å¸¸ç¦»å¼€å®‰å…¨æ¨¡å¼"></a> ä½•æ—¶æ­£å¸¸ç¦»å¼€å®‰å…¨æ¨¡å¼</h3>
<ul>
<li>Block ä¸ŠæŠ¥ç‡ï¼šDataNode ä¸ŠæŠ¥çš„å¯ç”¨ Block ä¸ªæ•° / NameNode å…ƒæ•°æ®è®°å½•çš„ Block ä¸ªæ•°</li>
<li>å½“ Block ä¸ŠæŠ¥ç‡ &gt;= é˜ˆå€¼æ—¶ï¼ŒHDFS æ‰èƒ½ç¦»å¼€å®‰å…¨æ¨¡å¼ï¼Œé»˜è®¤é˜ˆå€¼ä¸º 0.999</li>
<li>ä¸å»ºè®®æ‰‹åŠ¨å¼ºåˆ¶é€€å‡ºå®‰å…¨æ¨¡å¼</li>
</ul>
<h3 id="è§¦å‘å®‰å…¨æ¨¡å¼çš„åŸå› "><a class="markdownIt-Anchor" href="#è§¦å‘å®‰å…¨æ¨¡å¼çš„åŸå› "></a> è§¦å‘å®‰å…¨æ¨¡å¼çš„åŸå› </h3>
<ul>
<li>NameNode é‡å¯</li>
<li>NameNode ç£ç›˜ç©ºé—´ä¸è¶³</li>
<li>Block ä¸ŠæŠ¥ç‡ä½äºé˜ˆå€¼</li>
<li>DataNode æ— æ³•æ­£å¸¸å¯åŠ¨</li>
<li>æ—¥å¿—ä¸­å‡ºç°ä¸¥é‡å¼‚å¸¸</li>
<li>ç”¨æˆ·æ“ä½œä¸å½“ï¼Œå¦‚ï¼š<strong>å¼ºåˆ¶å…³æœºï¼ˆç‰¹åˆ«æ³¨æ„ï¼ï¼‰</strong></li>
</ul>
<h3 id="æ•…éšœæ’æŸ¥"><a class="markdownIt-Anchor" href="#æ•…éšœæ’æŸ¥"></a> æ•…éšœæ’æŸ¥</h3>
<ul>
<li>æ‰¾åˆ° DataNode ä¸èƒ½æ­£å¸¸å¯åŠ¨çš„åŸå› ï¼Œé‡å¯ DataNode</li>
<li>æ¸…ç† NameNode ç£ç›˜</li>
<li>è°¨æ…æ“ä½œï¼Œæœ‰é—®é¢˜æ‰¾æ˜Ÿç¯ï¼Œä»¥å…ä¸¢å¤±æ•°æ®</li>
</ul>
<h2 id="hdfs-é«˜å¯ç”¨"><a class="markdownIt-Anchor" href="#hdfs-é«˜å¯ç”¨"></a> HDFS é«˜å¯ç”¨</h2>
<h3 id="namenode-çš„-ha-æœºåˆ¶"><a class="markdownIt-Anchor" href="#namenode-çš„-ha-æœºåˆ¶"></a> NameNode çš„ HA æœºåˆ¶</h3>
<p>Active NameNode å’Œ Standby NameNode å®ç°ä¸»å¤‡ã€‚</p>
<h3 id="åˆ©ç”¨-qjm-å®ç°å…ƒæ•°æ®é«˜å¯ç”¨"><a class="markdownIt-Anchor" href="#åˆ©ç”¨-qjm-å®ç°å…ƒæ•°æ®é«˜å¯ç”¨"></a> åˆ©ç”¨ QJM å®ç°å…ƒæ•°æ®é«˜å¯ç”¨</h3>
<blockquote>
<p>åŸºäº Paxos ç®—æ³•</p>
</blockquote>
<p>QJM æœºåˆ¶ï¼ˆQuorum Journal Managerï¼‰</p>
<p>åªè¦ä¿è¯ Quorumï¼ˆæ³•å®šäººæ•°ï¼‰æ•°é‡çš„æ“ä½œæˆåŠŸï¼Œå°±è®¤ä¸ºè¿™æ˜¯ä¸€æ¬¡æœ€ç»ˆæˆåŠŸçš„æ“ä½œ</p>
<p>QJM å…±äº«å­˜å‚¨ç³»ç»Ÿ</p>
<ul>
<li>éƒ¨ç½²å¥‡æ•°ï¼ˆ2N+1ï¼‰ä¸ª JournalNode</li>
<li>JournalNode è´Ÿè´£å­˜å‚¨ edits ç¼–è¾‘æ—¥å¿—</li>
<li>å†™ edits çš„æ—¶å€™ï¼Œåªè¦è¶…è¿‡åŠæ•°ï¼ˆï‚³N+1ï¼‰çš„ JournalNode è¿”å›æˆåŠŸï¼Œå°±ä»£è¡¨æœ¬æ¬¡å†™å…¥æˆåŠŸ</li>
<li>æœ€å¤šå¯å®¹å¿ N ä¸ª JournalNode å®•æœº</li>
</ul>
<p>åˆ©ç”¨ ZooKeeper å®ç° Active èŠ‚ç‚¹é€‰ä¸¾ã€‚</p>
<h2 id="èµ„æº"><a class="markdownIt-Anchor" href="#èµ„æº"></a> èµ„æº</h2>
<ul>
<li><a href="http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html" target="_blank" rel="noopener">HDFS å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://www.cnblogs.com/caiyisen/p/7395843.html" target="_blank" rel="noopener">HDFS çŸ¥è¯†ç‚¹æ€»ç»“</a></li>
<li><a href="http://shop.oreilly.com/product/0636920033448.do" target="_blank" rel="noopener">ã€ŠHadoop: The Definitive Guide, Fourth Editionã€‹</a> by Tom White</li>
<li><a href="http://hadoop.apache.org/docs/r1.0.4/cn/hdfs_design.html" target="_blank" rel="noopener">http://hadoop.apache.org/docs/r1.0.4/cn/hdfs_design.html</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/bigdata/MapReduce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/bigdata/MapReduce/" class="post-title-link" itemprop="url">MapReduce</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-09-03 00:00:00" itemprop="dateCreated datePublished" datetime="2018-09-03T00:00:00+08:00">2018-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-05-08 18:07:48" itemprop="dateModified" datetime="2019-05-08T18:07:48+08:00">2019-05-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/bigdata/" itemprop="url" rel="index">
                    <span itemprop="name">bigdata</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/bigdata/MapReduce/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="bigdata/MapReduce/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>1.8k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>2 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="mapreduce"><a class="markdownIt-Anchor" href="#mapreduce"></a> MapReduce</h1>
<!-- TOC depthFrom:2 depthTo:3 -->
<ul>
<li><a href="#mapreduce-%E7%AE%80%E4%BB%8B">MapReduce ç®€ä»‹</a>
<ul>
<li><a href="#%E6%A6%82%E5%BF%B5">æ¦‚å¿µ</a></li>
<li><a href="#%E6%80%9D%E6%83%B3">æ€æƒ³</a></li>
<li><a href="#%E7%89%B9%E7%82%B9">ç‰¹ç‚¹</a></li>
<li><a href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">é€‚ç”¨åœºæ™¯</a></li>
<li><a href="#%E4%B8%8D%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">ä¸é€‚ç”¨åœºæ™¯</a></li>
</ul>
</li>
<li><a href="#mapreduce-%E5%8E%9F%E7%90%86">MapReduce åŸç†</a>
<ul>
<li><a href="#job--task%E4%BD%9C%E4%B8%9A%E4%B8%8E%E4%BB%BB%E5%8A%A1">Job &amp; Taskï¼ˆä½œä¸šä¸ä»»åŠ¡ï¼‰</a></li>
<li><a href="#split%E5%88%87%E7%89%87">Splitï¼ˆåˆ‡ç‰‡ï¼‰</a></li>
<li><a href="#map-%E9%98%B6%E6%AE%B5%E6%98%A0%E5%B0%84">Map é˜¶æ®µï¼ˆæ˜ å°„ï¼‰</a></li>
<li><a href="#reduce-%E9%98%B6%E6%AE%B5%E5%8C%96%E7%AE%80">Reduce é˜¶æ®µï¼ˆåŒ–ç®€ï¼‰</a></li>
<li><a href="#shuffle-%E9%98%B6%E6%AE%B5%E6%B4%97%E7%89%8C">Shuffle é˜¶æ®µï¼ˆæ´—ç‰Œï¼‰</a></li>
</ul>
</li>
<li><a href="#shuffle-%E8%AF%A6%E8%A7%A3">Shuffle è¯¦è§£</a>
<ul>
<li><a href="#map-%E7%AB%AF">Map ç«¯</a></li>
<li><a href="#reduce-%E7%AB%AF">Reduce ç«¯</a></li>
</ul>
</li>
<li><a href="#%E4%BD%9C%E4%B8%9A%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%BC%8F">ä½œä¸šè¿è¡Œæ¨¡å¼</a>
<ul>
<li><a href="#jobtrackertasktracker-%E6%A8%A1%E5%BC%8Fhadoop-1x">JobTracker/TaskTracker æ¨¡å¼ï¼ˆHadoop 1.Xï¼‰</a></li>
<li><a href="#yarn-%E6%A8%A1%E5%BC%8Fhadoop-2x">YARN æ¨¡å¼ï¼ˆHadoop 2.Xï¼‰</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="mapreduce-ç®€ä»‹"><a class="markdownIt-Anchor" href="#mapreduce-ç®€ä»‹"></a> MapReduce ç®€ä»‹</h2>
<h3 id="æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#æ¦‚å¿µ"></a> æ¦‚å¿µ</h3>
<p>MapReduce æ˜¯ä¸€ä¸ªé¢å‘æ‰¹å¤„ç†çš„åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ã€‚</p>
<p>ç¼–ç¨‹æ¨¡å‹ï¼šMapReduce ç¨‹åºè¢«åˆ†ä¸º Mapï¼ˆæ˜ å°„ï¼‰é˜¶æ®µå’Œ Reduceï¼ˆåŒ–ç®€ï¼‰é˜¶æ®µã€‚</p>
<h3 id="æ€æƒ³"><a class="markdownIt-Anchor" href="#æ€æƒ³"></a> æ€æƒ³</h3>
<p>åˆ†è€Œæ²»ä¹‹ï¼Œå¹¶è¡Œè®¡ç®—<br />
ç§»åŠ¨è®¡ç®—ï¼Œè€Œéç§»åŠ¨æ•°æ®</p>
<h3 id="ç‰¹ç‚¹"><a class="markdownIt-Anchor" href="#ç‰¹ç‚¹"></a> ç‰¹ç‚¹</h3>
<ul>
<li>è®¡ç®—è·Ÿç€æ•°æ®èµ°</li>
<li>è‰¯å¥½çš„æ‰©å±•æ€§ï¼šè®¡ç®—èƒ½åŠ›éšç€èŠ‚ç‚¹æ•°å¢åŠ ï¼Œè¿‘ä¼¼çº¿æ€§é€’å¢</li>
<li>é«˜å®¹é”™</li>
<li>çŠ¶æ€ç›‘æ§</li>
<li>é€‚åˆæµ·é‡æ•°æ®çš„ç¦»çº¿æ‰¹å¤„ç†</li>
<li>é™ä½äº†åˆ†å¸ƒå¼ç¼–ç¨‹çš„é—¨æ§›</li>
</ul>
<h3 id="é€‚ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#é€‚ç”¨åœºæ™¯"></a> é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>æ•°æ®ç»Ÿè®¡ï¼Œå¦‚ï¼šç½‘ç«™çš„ PVã€UV ç»Ÿè®¡</li>
<li>æœç´¢å¼•æ“æ„å»ºç´¢å¼•</li>
<li>æµ·é‡æ•°æ®æŸ¥è¯¢</li>
</ul>
<h3 id="ä¸é€‚ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#ä¸é€‚ç”¨åœºæ™¯"></a> ä¸é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>OLAP
<ul>
<li>è¦æ±‚æ¯«ç§’æˆ–ç§’çº§è¿”å›ç»“æœ</li>
</ul>
</li>
<li>æµè®¡ç®—
<ul>
<li>æµè®¡ç®—çš„è¾“å…¥æ•°æ®é›†æ˜¯åŠ¨æ€çš„ï¼Œè€Œ MapReduce æ˜¯é™æ€çš„</li>
</ul>
</li>
<li>DAG è®¡ç®—
<ul>
<li>å¤šä¸ªä½œä¸šå­˜åœ¨ä¾èµ–å…³ç³»ï¼Œåä¸€ä¸ªçš„è¾“å…¥æ˜¯å‰ä¸€ä¸ªçš„è¾“å‡ºï¼Œæ„æˆæœ‰å‘æ— ç¯å›¾ DAG</li>
<li>æ¯ä¸ª MapReduce ä½œä¸šçš„è¾“å‡ºç»“æœéƒ½ä¼šè½ç›˜ï¼Œé€ æˆå¤§é‡ç£ç›˜ IOï¼Œå¯¼è‡´æ€§èƒ½éå¸¸ä½ä¸‹</li>
</ul>
</li>
</ul>
<h2 id="mapreduce-åŸç†"><a class="markdownIt-Anchor" href="#mapreduce-åŸç†"></a> MapReduce åŸç†</h2>
<h3 id="job-taskä½œä¸šä¸ä»»åŠ¡"><a class="markdownIt-Anchor" href="#job-taskä½œä¸šä¸ä»»åŠ¡"></a> Job &amp; Taskï¼ˆä½œä¸šä¸ä»»åŠ¡ï¼‰</h3>
<ul>
<li>ä½œä¸šæ˜¯å®¢æˆ·ç«¯è¯·æ±‚æ‰§è¡Œçš„ä¸€ä¸ªå·¥ä½œå•å…ƒ
<ul>
<li>åŒ…æ‹¬è¾“å…¥æ•°æ®ã€MapReduce ç¨‹åºã€é…ç½®ä¿¡æ¯</li>
</ul>
</li>
<li>ä»»åŠ¡æ˜¯å°†ä½œä¸šåˆ†è§£åå¾—åˆ°çš„ç»†åˆ†å·¥ä½œå•å…ƒ
<ul>
<li>åˆ†ä¸º Map ä»»åŠ¡å’Œ Reduce ä»»åŠ¡</li>
</ul>
</li>
</ul>
<h3 id="splitåˆ‡ç‰‡"><a class="markdownIt-Anchor" href="#splitåˆ‡ç‰‡"></a> Splitï¼ˆåˆ‡ç‰‡ï¼‰</h3>
<ul>
<li>è¾“å…¥æ•°æ®è¢«åˆ’åˆ†æˆç­‰é•¿çš„å°æ•°æ®å—ï¼Œç§°ä¸ºè¾“å…¥åˆ‡ç‰‡ï¼ˆInput Splitï¼‰ï¼Œç®€ç§°åˆ‡ç‰‡</li>
<li>Split æ˜¯é€»è¾‘æ¦‚å¿µï¼Œä»…åŒ…å«å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚ï¼šæ•°æ®çš„èµ·å§‹ä½ç½®ã€é•¿åº¦ã€æ‰€åœ¨èŠ‚ç‚¹ç­‰</li>
<li>æ¯ä¸ª Split äº¤ç»™ä¸€ä¸ª Map ä»»åŠ¡å¤„ç†ï¼ŒSplit çš„æ•°é‡å†³å®š Map ä»»åŠ¡çš„æ•°é‡</li>
<li>Split çš„åˆ’åˆ†æ–¹å¼ç”±ç¨‹åºè®¾å®šï¼ŒSplit ä¸ HDFS Block æ²¡æœ‰ä¸¥æ ¼çš„å¯¹åº”å…³ç³»</li>
<li>Split çš„å¤§å°é»˜è®¤ç­‰äº Block å¤§å°</li>
<li>Split è¶Šå°ï¼Œè´Ÿè½½è¶Šå‡è¡¡ï¼Œä½†é›†ç¾¤çš„å¼€é”€è¶Šå¤§</li>
</ul>
<h3 id="map-é˜¶æ®µæ˜ å°„"><a class="markdownIt-Anchor" href="#map-é˜¶æ®µæ˜ å°„"></a> Map é˜¶æ®µï¼ˆæ˜ å°„ï¼‰</h3>
<ul>
<li>ç”±è‹¥å¹² Map ä»»åŠ¡ç»„æˆï¼Œä»»åŠ¡æ•°é‡ç”± Split æ•°é‡å†³å®š</li>
<li>è¾“å…¥ï¼šSplit åˆ‡ç‰‡ï¼ˆkey-valueï¼‰ï¼Œè¾“å‡ºï¼šä¸­é—´è®¡ç®—ç»“æœï¼ˆkey-valueï¼‰</li>
</ul>
<h3 id="reduce-é˜¶æ®µåŒ–ç®€"><a class="markdownIt-Anchor" href="#reduce-é˜¶æ®µåŒ–ç®€"></a> Reduce é˜¶æ®µï¼ˆåŒ–ç®€ï¼‰</h3>
<ul>
<li>ç”±è‹¥å¹² Reduce ä»»åŠ¡ç»„æˆï¼Œä»»åŠ¡æ•°é‡ç”±ç¨‹åºæŒ‡å®š</li>
<li>è¾“å…¥ï¼šMap é˜¶æ®µè¾“å‡ºçš„ä¸­é—´ç»“æœï¼ˆkey-valueï¼‰ï¼Œè¾“å‡ºï¼šæœ€ç»ˆç»“æœï¼ˆkey-valueï¼‰</li>
</ul>
<h3 id="shuffle-é˜¶æ®µæ´—ç‰Œ"><a class="markdownIt-Anchor" href="#shuffle-é˜¶æ®µæ´—ç‰Œ"></a> Shuffle é˜¶æ®µï¼ˆæ´—ç‰Œï¼‰</h3>
<ul>
<li>Mapã€Reduce é˜¶æ®µçš„ä¸­é—´ç¯èŠ‚ï¼Œè´Ÿè´£æ‰§è¡Œ Partitionï¼ˆåˆ†åŒºï¼‰ã€Sortï¼ˆæ’åºï¼‰ã€Spillï¼ˆæº¢å†™ï¼‰ã€Mergeï¼ˆåˆå¹¶ï¼‰ã€æŠ“å–ï¼ˆFetchï¼‰ç­‰å·¥ä½œ</li>
<li>Partition å†³å®šäº† Map ä»»åŠ¡è¾“å‡ºçš„æ¯æ¡æ•°æ®æ”¾å…¥å“ªä¸ªåˆ†åŒºï¼Œäº¤ç»™å“ªä¸ª Reduce ä»»åŠ¡å¤„ç†</li>
<li>Reduce ä»»åŠ¡çš„æ•°é‡å†³å®šäº† Partition æ•°é‡</li>
<li>Partition ç¼–å· = Reduce ä»»åŠ¡ç¼–å· =â€œkey hashcode % reduce task numberâ€</li>
<li>é¿å…å’Œå‡å°‘ Shuffle æ˜¯ MapReduce ç¨‹åºè°ƒä¼˜çš„é‡ç‚¹</li>
</ul>
<h2 id="shuffle-è¯¦è§£"><a class="markdownIt-Anchor" href="#shuffle-è¯¦è§£"></a> Shuffle è¯¦è§£</h2>
<h3 id="map-ç«¯"><a class="markdownIt-Anchor" href="#map-ç«¯"></a> Map ç«¯</h3>
<p>Map ä»»åŠ¡å°†ä¸­é—´ç»“æœå†™å…¥ä¸“ç”¨å†…å­˜ç¼“å†²åŒº Bufferï¼ˆé»˜è®¤ 100Mï¼‰ï¼ŒåŒæ—¶è¿›è¡Œ Partition å’Œ Sortï¼ˆå…ˆæŒ‰â€œkey hashcode % reduce task numberâ€å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œåˆ†åŒºå†…å†æŒ‰ key æ’åºï¼‰<br />
å½“ Buffer çš„æ•°æ®é‡è¾¾åˆ°é˜ˆå€¼ï¼ˆé»˜è®¤ 80%ï¼‰æ—¶ï¼Œå°†æ•°æ®æº¢å†™ï¼ˆSpillï¼‰åˆ°ç£ç›˜çš„ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶å†…æ•°æ®å…ˆåˆ†åŒºåæ’åº<br />
Map ä»»åŠ¡ç»“æŸå‰ï¼Œå°†å¤šä¸ªä¸´æ—¶æ–‡ä»¶åˆå¹¶ï¼ˆMergeï¼‰ä¸ºä¸€ä¸ª Map è¾“å‡ºæ–‡ä»¶ï¼Œæ–‡ä»¶å†…æ•°æ®å…ˆåˆ†åŒºåæ’åº</p>
<h3 id="reduce-ç«¯"><a class="markdownIt-Anchor" href="#reduce-ç«¯"></a> Reduce ç«¯</h3>
<p>Reduce ä»»åŠ¡ä»å¤šä¸ª Map è¾“å‡ºæ–‡ä»¶ä¸­ä¸»åŠ¨æŠ“å–ï¼ˆFetchï¼‰å±äºè‡ªå·±çš„åˆ†åŒºæ•°æ®ï¼Œå…ˆå†™å…¥ Bufferï¼Œæ•°æ®é‡è¾¾åˆ°é˜ˆå€¼åï¼Œæº¢å†™åˆ°ç£ç›˜çš„ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­<br />
æ•°æ®æŠ“å–å®Œæˆåï¼Œå°†å¤šä¸ªä¸´æ—¶æ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ª Reduce è¾“å…¥æ–‡ä»¶ï¼Œæ–‡ä»¶å†…æ•°æ®æŒ‰ key æ’åº</p>
<h2 id="ä½œä¸šè¿è¡Œæ¨¡å¼"><a class="markdownIt-Anchor" href="#ä½œä¸šè¿è¡Œæ¨¡å¼"></a> ä½œä¸šè¿è¡Œæ¨¡å¼</h2>
<h3 id="jobtrackertasktracker-æ¨¡å¼hadoop-1x"><a class="markdownIt-Anchor" href="#jobtrackertasktracker-æ¨¡å¼hadoop-1x"></a> JobTracker/TaskTracker æ¨¡å¼ï¼ˆHadoop 1.Xï¼‰</h3>
<p><strong>JobTracker èŠ‚ç‚¹ï¼ˆMasterï¼‰</strong></p>
<ul>
<li>è°ƒåº¦ä»»åŠ¡åœ¨ TaskTracker ä¸Šè¿è¡Œ</li>
<li>è‹¥ä»»åŠ¡å¤±è´¥ï¼ŒæŒ‡å®šæ–° TaskTracker é‡æ–°è¿è¡Œ</li>
</ul>
<p><strong>TaskTracker èŠ‚ç‚¹ï¼ˆSlaveï¼‰</strong></p>
<ul>
<li>æ‰§è¡Œä»»åŠ¡ï¼Œå‘é€è¿›åº¦æŠ¥å‘Š</li>
</ul>
<p><strong>å­˜åœ¨çš„é—®é¢˜</strong></p>
<ul>
<li>JobTracker å­˜åœ¨å•ç‚¹æ•…éšœ</li>
<li>JobTracker è´Ÿè½½å¤ªé‡ï¼ˆä¸Šé™ 4000 èŠ‚ç‚¹ï¼‰</li>
<li>JobTracker ç¼ºå°‘å¯¹èµ„æºçš„å…¨é¢ç®¡ç†</li>
<li>TaskTracker å¯¹èµ„æºçš„æè¿°è¿‡äºç®€å•</li>
<li>æºç å¾ˆéš¾ç†è§£</li>
</ul>
<h3 id="yarn-æ¨¡å¼hadoop-2x"><a class="markdownIt-Anchor" href="#yarn-æ¨¡å¼hadoop-2x"></a> YARN æ¨¡å¼ï¼ˆHadoop 2.Xï¼‰</h3>
<ul>
<li>æäº¤ä½œä¸š</li>
<li>æŸ¥çœ‹ä½œä¸š</li>
<li>ç»ˆæ­¢ä½œä¸š</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dunwu.github.io/blog/blog/design/theory/system-theory-interview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Zhang Peng">
      <meta itemprop="description" content="Dunwu's Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dunwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/design/theory/system-theory-interview/" class="post-title-link" itemprop="url">ç³»ç»ŸåŸç†é¢è¯•é¢˜</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2018-07-10 16:02:00" itemprop="dateCreated datePublished" datetime="2018-07-10T16:02:00+08:00">2018-07-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2019-11-27 16:27:25" itemprop="dateModified" datetime="2019-11-27T16:27:25+08:00">2019-11-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index">
                    <span itemprop="name">è®¾è®¡</span>
                  </a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/" itemprop="url" rel="index">
                    <span itemprop="name">ç³»ç»ŸåŸç†</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/blog/design/theory/system-theory-interview/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="design/theory/system-theory-interview/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>10 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ç³»ç»ŸåŸç†é¢è¯•é¢˜"><a class="markdownIt-Anchor" href="#ç³»ç»ŸåŸç†é¢è¯•é¢˜"></a> ç³»ç»ŸåŸç†é¢è¯•é¢˜</h1>
<h2 id="1-åˆ†å¸ƒå¼ç¼“å­˜"><a class="markdownIt-Anchor" href="#1-åˆ†å¸ƒå¼ç¼“å­˜"></a> 1. åˆ†å¸ƒå¼ç¼“å­˜</h2>
<h3 id="11-redis-æœ‰ä»€ä¹ˆæ•°æ®ç±»å‹åˆ†åˆ«ç”¨äºä»€ä¹ˆåœºæ™¯"><a class="markdownIt-Anchor" href="#11-redis-æœ‰ä»€ä¹ˆæ•°æ®ç±»å‹åˆ†åˆ«ç”¨äºä»€ä¹ˆåœºæ™¯"></a> 1.1. Redis æœ‰ä»€ä¹ˆæ•°æ®ç±»å‹ï¼Ÿåˆ†åˆ«ç”¨äºä»€ä¹ˆåœºæ™¯</h3>
<table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>å¯ä»¥å­˜å‚¨çš„å€¼</th>
<th>æ“ä½œ</th>
</tr>
</thead>
<tbody>
<tr>
<td>STRING</td>
<td>å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°</td>
<td>å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œ</br> å¯¹æ•´æ•°å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢æˆ–è€…è‡ªå‡æ“ä½œ</td>
</tr>
<tr>
<td>LIST</td>
<td>åˆ—è¡¨</td>
<td>ä»ä¸¤ç«¯å‹å…¥æˆ–è€…å¼¹å‡ºå…ƒç´ </br> è¯»å–å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ </br> è¿›è¡Œä¿®å‰ªï¼Œåªä¿ç•™ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´ </td>
</tr>
<tr>
<td>SET</td>
<td>æ— åºé›†åˆ</td>
<td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´ </br> æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­</br> è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†</br> ä»é›†åˆé‡Œé¢éšæœºè·å–å…ƒç´ </td>
</tr>
<tr>
<td>HASH</td>
<td>åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨</td>
<td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªé”®å€¼å¯¹</br> è·å–æ‰€æœ‰é”®å€¼å¯¹</br> æ£€æŸ¥æŸä¸ªé”®æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td>ZSET</td>
<td>æœ‰åºé›†åˆ</td>
<td>æ·»åŠ ã€è·å–ã€åˆ é™¤å…ƒç´ </br> æ ¹æ®åˆ†å€¼èŒƒå›´æˆ–è€…æˆå‘˜æ¥è·å–å…ƒç´ </br> è®¡ç®—ä¸€ä¸ªé”®çš„æ’å</td>
</tr>
</tbody>
</table>
<blockquote>
<p><a href="https://redislabs.com/ebook/part-1-getting-started/chapter-1-getting-to-know-redis/1-2-what-redis-data-structures-look-like/" target="_blank" rel="noopener">What Redis data structures look like</a></p>
</blockquote>
<h3 id="12-redis-çš„ä¸»ä»å¤åˆ¶æ˜¯å¦‚ä½•å®ç°çš„"><a class="markdownIt-Anchor" href="#12-redis-çš„ä¸»ä»å¤åˆ¶æ˜¯å¦‚ä½•å®ç°çš„"></a> 1.2. Redis çš„ä¸»ä»å¤åˆ¶æ˜¯å¦‚ä½•å®ç°çš„</h3>
<ol>
<li>ä»æœåŠ¡å™¨è¿æ¥ä¸»æœåŠ¡å™¨ï¼Œå‘é€ SYNC å‘½ä»¤ï¼›</li>
<li>ä¸»æœåŠ¡å™¨æ¥æ”¶åˆ° SYNC å‘½ååï¼Œå¼€å§‹æ‰§è¡Œ BGSAVE å‘½ä»¤ç”Ÿæˆ RDB æ–‡ä»¶å¹¶ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ­¤åæ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ï¼›</li>
<li>ä¸»æœåŠ¡å™¨ BGSAVE æ‰§è¡Œå®Œåï¼Œå‘æ‰€æœ‰ä»æœåŠ¡å™¨å‘é€å¿«ç…§æ–‡ä»¶ï¼Œå¹¶åœ¨å‘é€æœŸé—´ç»§ç»­è®°å½•è¢«æ‰§è¡Œçš„å†™å‘½ä»¤ï¼›</li>
<li>ä»æœåŠ¡å™¨æ”¶åˆ°å¿«ç…§æ–‡ä»¶åä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥æ”¶åˆ°çš„å¿«ç…§ï¼›</li>
<li>ä¸»æœåŠ¡å™¨å¿«ç…§å‘é€å®Œæ¯•åå¼€å§‹å‘ä»æœåŠ¡å™¨å‘é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ï¼›</li>
<li>ä»æœåŠ¡å™¨å®Œæˆå¯¹å¿«ç…§çš„è½½å…¥ï¼Œå¼€å§‹æ¥æ”¶å‘½ä»¤è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ¥è‡ªä¸»æœåŠ¡å™¨ç¼“å†²åŒºçš„å†™å‘½ä»¤ï¼›</li>
</ol>
<h3 id="13-redis-çš„-key-æ˜¯å¦‚ä½•å¯»å€çš„"><a class="markdownIt-Anchor" href="#13-redis-çš„-key-æ˜¯å¦‚ä½•å¯»å€çš„"></a> 1.3. Redis çš„ key æ˜¯å¦‚ä½•å¯»å€çš„</h3>
<h4 id="131-èƒŒæ™¯"><a class="markdownIt-Anchor" href="#131-èƒŒæ™¯"></a> 1.3.1. èƒŒæ™¯</h4>
<p>ï¼ˆ1ï¼‰redis ä¸­çš„æ¯ä¸€ä¸ªæ•°æ®åº“ï¼Œéƒ½ç”±ä¸€ä¸ª redisDb çš„ç»“æ„å­˜å‚¨ã€‚å…¶ä¸­ï¼š</p>
<ul>
<li><a href="http://redisDb.id" target="_blank" rel="noopener">redisDb.id</a> å­˜å‚¨ç€ redis æ•°æ®åº“ä»¥æ•´æ•°è¡¨ç¤ºçš„å·ç ã€‚</li>
<li>redisDb.dict å­˜å‚¨ç€è¯¥åº“æ‰€æœ‰çš„é”®å€¼å¯¹æ•°æ®ã€‚</li>
<li>redisDb.expires ä¿å­˜ç€æ¯ä¸€ä¸ªé”®çš„è¿‡æœŸæ—¶é—´ã€‚</li>
</ul>
<p>ï¼ˆ2ï¼‰å½“ redis æœåŠ¡å™¨åˆå§‹åŒ–æ—¶ï¼Œä¼šé¢„å…ˆåˆ†é… 16 ä¸ªæ•°æ®åº“ï¼ˆè¯¥æ•°é‡å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®ï¼‰ï¼Œæ‰€æœ‰æ•°æ®åº“ä¿å­˜åˆ°ç»“æ„ redisServer çš„ä¸€ä¸ªæˆå‘˜ redisServer.db æ•°ç»„ä¸­ã€‚å½“æˆ‘ä»¬é€‰æ‹©æ•°æ®åº“ select number æ—¶ï¼Œç¨‹åºç›´æ¥é€šè¿‡ redisServer.db[number] æ¥åˆ‡æ¢æ•°æ®åº“ã€‚æœ‰æ—¶å€™å½“ç¨‹åºéœ€è¦çŸ¥é“è‡ªå·±æ˜¯åœ¨å“ªä¸ªæ•°æ®åº“æ—¶ï¼Œç›´æ¥è¯»å– <a href="http://redisDb.id" target="_blank" rel="noopener">redisDb.id</a> å³å¯ã€‚</p>
<p>ï¼ˆ3ï¼‰redis çš„å­—å…¸ä½¿ç”¨å“ˆå¸Œè¡¨ä½œä¸ºå…¶åº•å±‚å®ç°ã€‚dict ç±»å‹ä½¿ç”¨çš„ä¸¤ä¸ªæŒ‡å‘å“ˆå¸Œè¡¨çš„æŒ‡é’ˆï¼Œå…¶ä¸­ 0 å·å“ˆå¸Œè¡¨ï¼ˆht[0]ï¼‰ä¸»è¦ç”¨äºå­˜å‚¨æ•°æ®åº“çš„æ‰€æœ‰é”®å€¼ï¼Œè€Œ 1 å·å“ˆå¸Œè¡¨ä¸»è¦ç”¨äºç¨‹åºå¯¹ 0 å·å“ˆå¸Œè¡¨è¿›è¡Œ rehash æ—¶ä½¿ç”¨ï¼Œrehash ä¸€èˆ¬æ˜¯åœ¨æ·»åŠ æ–°å€¼æ—¶ä¼šè§¦å‘ï¼Œè¿™é‡Œä¸åšè¿‡å¤šçš„èµ˜è¿°ã€‚æ‰€ä»¥ redis ä¸­æŸ¥æ‰¾ä¸€ä¸ª keyï¼Œå…¶å®å°±æ˜¯å¯¹è¿›è¡Œè¯¥ dict ç»“æ„ä¸­çš„ ht[0] è¿›è¡ŒæŸ¥æ‰¾æ“ä½œã€‚</p>
<p>ï¼ˆ4ï¼‰æ—¢ç„¶æ˜¯å“ˆå¸Œï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“å°±ä¼šæœ‰å“ˆå¸Œç¢°æ’ï¼Œé‚£ä¹ˆå½“å¤šä¸ªé”®å“ˆå¸Œä¹‹åä¸ºåŒä¸€ä¸ªå€¼æ€ä¹ˆåŠå‘¢ï¼Ÿredis é‡‡å–é“¾è¡¨çš„æ–¹å¼æ¥å­˜å‚¨å¤šä¸ªå“ˆå¸Œç¢°æ’çš„é”®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ ¹æ® key çš„å“ˆå¸Œå€¼æ‰¾åˆ°è¯¥åˆ—è¡¨åï¼Œå¦‚æœåˆ—è¡¨çš„é•¿åº¦å¤§äº 1ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦éå†è¯¥é“¾è¡¨æ¥æ‰¾åˆ°æˆ‘ä»¬æ‰€æŸ¥æ‰¾çš„ keyã€‚å½“ç„¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹é“¾è¡¨é•¿åº¦éƒ½ä¸ºæ˜¯ 1ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦å¯çœ‹ä½œ o(1)ã€‚</p>
<h4 id="132-å¯»å€-key-çš„æ­¥éª¤"><a class="markdownIt-Anchor" href="#132-å¯»å€-key-çš„æ­¥éª¤"></a> 1.3.2. å¯»å€ key çš„æ­¥éª¤</h4>
<ol>
<li>å½“æ‹¿åˆ°ä¸€ä¸ª key åï¼Œredis å…ˆåˆ¤æ–­å½“å‰åº“çš„ 0 å·å“ˆå¸Œè¡¨æ˜¯å¦ä¸ºç©ºï¼Œå³ï¼šif (dict-&gt;ht[0].size == 0)ã€‚å¦‚æœä¸º true ç›´æ¥è¿”å› NULLã€‚</li>
<li>åˆ¤æ–­è¯¥ 0 å·å“ˆå¸Œè¡¨æ˜¯å¦éœ€è¦ rehashï¼Œå› ä¸ºå¦‚æœåœ¨è¿›è¡Œ rehashï¼Œé‚£ä¹ˆä¸¤ä¸ªè¡¨ä¸­è€…æœ‰å¯èƒ½å­˜å‚¨è¯¥ keyã€‚å¦‚æœæ­£åœ¨è¿›è¡Œ rehashï¼Œå°†è°ƒç”¨ä¸€æ¬¡<code>_dictRehashStep</code> æ–¹æ³•ï¼Œ<code>_dictRehashStep</code> ç”¨äºå¯¹æ•°æ®åº“å­—å…¸ã€ä»¥åŠå“ˆå¸Œé”®çš„å­—å…¸è¿›è¡Œè¢«åŠ¨ rehashï¼Œè¿™é‡Œä¸ä½œèµ˜è¿°ã€‚</li>
<li>è®¡ç®—å“ˆå¸Œè¡¨ï¼Œæ ¹æ®å½“å‰å­—å…¸ä¸ key è¿›è¡Œå“ˆå¸Œå€¼çš„è®¡ç®—ã€‚</li>
<li>æ ¹æ®å“ˆå¸Œå€¼ä¸å½“å‰å­—å…¸è®¡ç®—å“ˆå¸Œè¡¨çš„ç´¢å¼•å€¼ã€‚</li>
<li>æ ¹æ®ç´¢å¼•å€¼åœ¨å“ˆå¸Œè¡¨ä¸­å–å‡ºé“¾è¡¨ï¼Œéå†è¯¥é“¾è¡¨æ‰¾åˆ° key çš„ä½ç½®ã€‚ä¸€èˆ¬æƒ…å†µï¼Œè¯¥é“¾è¡¨é•¿åº¦ä¸º 1ã€‚</li>
<li>å½“ ht[0] æŸ¥æ‰¾å®Œäº†ä¹‹åï¼Œå†è¿›è¡Œäº†æ¬¡ rehash åˆ¤æ–­ï¼Œå¦‚æœæœªåœ¨ rehashingï¼Œåˆ™ç›´æ¥ç»“æŸï¼Œå¦åˆ™å¯¹ ht[1]é‡å¤ 345 æ­¥éª¤ã€‚</li>
</ol>
<h3 id="14-redis-çš„é›†ç¾¤æ¨¡å¼æ˜¯å¦‚ä½•å®ç°çš„"><a class="markdownIt-Anchor" href="#14-redis-çš„é›†ç¾¤æ¨¡å¼æ˜¯å¦‚ä½•å®ç°çš„"></a> 1.4. Redis çš„é›†ç¾¤æ¨¡å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3>
<p>Redis Cluster æ˜¯ Redis çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œåœ¨ Redis 3.0 ç‰ˆæœ¬æ­£å¼æ¨å‡ºçš„ã€‚</p>
<p>Redis Cluster å»ä¸­å¿ƒåŒ–ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¿å­˜æ•°æ®å’Œæ•´ä¸ªé›†ç¾¤çŠ¶æ€ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å’Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹è¿æ¥ã€‚</p>
<h4 id="141-redis-cluster-èŠ‚ç‚¹åˆ†é…"><a class="markdownIt-Anchor" href="#141-redis-cluster-èŠ‚ç‚¹åˆ†é…"></a> 1.4.1. Redis Cluster èŠ‚ç‚¹åˆ†é…</h4>
<p>Redis Cluster ç‰¹ç‚¹ï¼š</p>
<ol>
<li>æ‰€æœ‰çš„ redis èŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONG æœºåˆ¶)ï¼Œå†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½ã€‚</li>
<li>èŠ‚ç‚¹çš„ fail æ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆã€‚</li>
<li>å®¢æˆ·ç«¯ä¸ redis èŠ‚ç‚¹ç›´è¿,ä¸éœ€è¦ä¸­é—´ proxy å±‚ã€‚å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚</li>
<li>redis-cluster æŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383] å“ˆå¸Œæ§½ (hash slot)ä¸Šï¼ˆä¸ä¸€å®šæ˜¯å¹³å‡åˆ†é…ï¼‰,cluster è´Ÿè´£ç»´æŠ¤ node&lt;-&gt;slot&lt;-&gt;valueã€‚</li>
<li>Redis é›†ç¾¤é¢„åˆ†å¥½ 16384 ä¸ªæ¡¶ï¼Œå½“éœ€è¦åœ¨ Redis é›†ç¾¤ä¸­æ”¾ç½®ä¸€ä¸ª key-value æ—¶ï¼Œæ ¹æ® CRC16(key) mod 16384 çš„å€¼ï¼Œå†³å®šå°†ä¸€ä¸ª key æ”¾åˆ°å“ªä¸ªæ¡¶ä¸­ã€‚</li>
</ol>
<h4 id="142-redis-cluster-ä¸»ä»æ¨¡å¼"><a class="markdownIt-Anchor" href="#142-redis-cluster-ä¸»ä»æ¨¡å¼"></a> 1.4.2. Redis Cluster ä¸»ä»æ¨¡å¼</h4>
<p>Redis Cluster ä¸ºäº†ä¿è¯æ•°æ®çš„é«˜å¯ç”¨æ€§ï¼ŒåŠ å…¥äº†ä¸»ä»æ¨¡å¼ã€‚</p>
<p>ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹æä¾›æ•°æ®å­˜å–ï¼Œä»èŠ‚ç‚¹åˆ™æ˜¯ä»ä¸»èŠ‚ç‚¹æ‹‰å–æ•°æ®å¤‡ä»½ã€‚å½“è¿™ä¸ªä¸»èŠ‚ç‚¹æŒ‚æ‰åï¼Œå°±ä¼šæœ‰è¿™ä¸ªä»èŠ‚ç‚¹é€‰å–ä¸€ä¸ªæ¥å……å½“ä¸»èŠ‚ç‚¹ï¼Œä»è€Œä¿è¯é›†ç¾¤ä¸ä¼šæŒ‚æ‰ã€‚æ‰€ä»¥ï¼Œåœ¨é›†ç¾¤å»ºç«‹çš„æ—¶å€™ï¼Œä¸€å®šè¦ä¸ºæ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½æ·»åŠ äº†ä»èŠ‚ç‚¹ã€‚</p>
<h4 id="143-redis-sentinel"><a class="markdownIt-Anchor" href="#143-redis-sentinel"></a> 1.4.3. Redis Sentinel</h4>
<p>Redis Sentinel ç”¨äºç®¡ç†å¤šä¸ª Redis æœåŠ¡å™¨ï¼Œå®ƒæœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼š</p>
<ul>
<li><strong>ç›‘æ§ï¼ˆMonitoringï¼‰</strong> - Sentinel ä¼šä¸æ–­åœ°æ£€æŸ¥ä½ çš„ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚</li>
<li><strong>æé†’ï¼ˆNotificationï¼‰</strong> - å½“è¢«ç›‘æ§çš„æŸä¸ª Redis æœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œ Sentinel å¯ä»¥é€šè¿‡ API å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚</li>
<li><strong>è‡ªåŠ¨æ•…éšœè¿ç§»ï¼ˆAutomatic failoverï¼‰</strong> - å½“ä¸€ä¸ªä¸»æœåŠ¡å™¨ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œ Sentinel ä¼šå¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»æ“ä½œï¼Œ å®ƒä¼šå°†å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä¸­ä¸€ä¸ªä»æœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ï¼Œ å¹¶è®©å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä»–ä»æœåŠ¡å™¨æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»æœåŠ¡å™¨ï¼› å½“å®¢æˆ·ç«¯è¯•å›¾è¿æ¥å¤±æ•ˆçš„ä¸»æœåŠ¡å™¨æ—¶ï¼Œ é›†ç¾¤ä¹Ÿä¼šå‘å®¢æˆ·ç«¯è¿”å›æ–°ä¸»æœåŠ¡å™¨çš„åœ°å€ï¼Œ ä½¿å¾—é›†ç¾¤å¯ä»¥ä½¿ç”¨æ–°ä¸»æœåŠ¡å™¨ä»£æ›¿å¤±æ•ˆæœåŠ¡å™¨ã€‚</li>
</ul>
<p>Redis é›†ç¾¤ä¸­åº”è¯¥æœ‰å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥è‡³å°‘æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ã€‚</p>
<p>å“¨å…µç›‘æ§é›†ç¾¤ä¸­çš„ä¸»æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶ï¼Œéœ€è¦æ ¹æ® quorum é€‰ä¸¾å‡ºä¸€ä¸ªå“¨å…µæ¥æ‰§è¡Œæ•…éšœè½¬ç§»ã€‚é€‰ä¸¾éœ€è¦ majorityï¼Œå³å¤§å¤šæ•°å“¨å…µæ˜¯è¿è¡Œçš„ï¼ˆ2 ä¸ªå“¨å…µçš„ majority=2ï¼Œ3 ä¸ªå“¨å…µçš„ majority=2ï¼Œ5 ä¸ªå“¨å…µçš„ majority=3ï¼Œ4 ä¸ªå“¨å…µçš„ majority=2ï¼‰ã€‚</p>
<p>å‡è®¾é›†ç¾¤ä»…ä»…éƒ¨ç½² 2 ä¸ªèŠ‚ç‚¹</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">+----+         +----+</span><br><span class="line">|<span class="string"> M1 </span>|<span class="string">---------</span>|<span class="string"> R1 </span>|</span><br><span class="line">|<span class="string"> S1 </span>|<span class="string">         </span>|<span class="string"> S2 </span>|</span><br><span class="line">+----+         +----+</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ M1 å’Œ S1 æ‰€åœ¨æœåŠ¡å™¨å®•æœºï¼Œåˆ™å“¨å…µåªæœ‰ 1 ä¸ªï¼Œæ— æ³•æ»¡è¶³ majority æ¥è¿›è¡Œé€‰ä¸¾ï¼Œå°±ä¸èƒ½æ‰§è¡Œæ•…éšœè½¬ç§»ã€‚</p>
<h3 id="15-redis-å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”zookeeper-å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”æ¯”è¾ƒäºŒè€…ä¼˜åŠ£"><a class="markdownIt-Anchor" href="#15-redis-å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”zookeeper-å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”æ¯”è¾ƒäºŒè€…ä¼˜åŠ£"></a> 1.5. Redis å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”ï¼ŸZooKeeper å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”ï¼Ÿæ¯”è¾ƒäºŒè€…ä¼˜åŠ£ï¼Ÿ</h3>
<p>åˆ†å¸ƒå¼é”çš„ä¸‰ç§å®ç°ï¼š</p>
<ul>
<li>åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”ï¼›</li>
<li>åŸºäºç¼“å­˜ï¼ˆRedis ç­‰ï¼‰å®ç°åˆ†å¸ƒå¼é”ï¼›</li>
<li>åŸºäº Zookeeper å®ç°åˆ†å¸ƒå¼é”ï¼›</li>
</ul>
<h4 id="151-æ•°æ®åº“å®ç°"><a class="markdownIt-Anchor" href="#151-æ•°æ®åº“å®ç°"></a> 1.5.1. æ•°æ®åº“å®ç°</h4>
<h4 id="152-redis-å®ç°"><a class="markdownIt-Anchor" href="#152-redis-å®ç°"></a> 1.5.2. Redis å®ç°</h4>
<ol>
<li>è·å–é”çš„æ—¶å€™ï¼Œä½¿ç”¨ setnx åŠ é”ï¼Œå¹¶ä½¿ç”¨ expire å‘½ä»¤ä¸ºé”æ·»åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´åˆ™è‡ªåŠ¨é‡Šæ”¾é”ï¼Œé”çš„ value å€¼ä¸ºä¸€ä¸ªéšæœºç”Ÿæˆçš„ UUIDï¼Œé€šè¿‡æ­¤åœ¨é‡Šæ”¾é”çš„æ—¶å€™è¿›è¡Œåˆ¤æ–­ã€‚</li>
<li>è·å–é”çš„æ—¶å€™è¿˜è®¾ç½®ä¸€ä¸ªè·å–çš„è¶…æ—¶æ—¶é—´ï¼Œè‹¥è¶…è¿‡è¿™ä¸ªæ—¶é—´åˆ™æ”¾å¼ƒè·å–é”ã€‚</li>
<li>é‡Šæ”¾é”çš„æ—¶å€™ï¼Œé€šè¿‡ UUID åˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥é”ï¼Œè‹¥æ˜¯è¯¥é”ï¼Œåˆ™æ‰§è¡Œ delete è¿›è¡Œé”é‡Šæ”¾ã€‚</li>
</ol>
<h4 id="153-zookeeper-å®ç°"><a class="markdownIt-Anchor" href="#153-zookeeper-å®ç°"></a> 1.5.3. ZooKeeper å®ç°</h4>
<ol>
<li>åˆ›å»ºä¸€ä¸ªç›®å½• mylockï¼›</li>
<li>çº¿ç¨‹ A æƒ³è·å–é”å°±åœ¨ mylock ç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼›</li>
<li>è·å– mylock ç›®å½•ä¸‹æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œç„¶åè·å–æ¯”è‡ªå·±å°çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜å½“å‰çº¿ç¨‹é¡ºåºå·æœ€å°ï¼Œè·å¾—é”ï¼›</li>
<li>çº¿ç¨‹ B è·å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œåˆ¤æ–­è‡ªå·±ä¸æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œè®¾ç½®ç›‘å¬æ¯”è‡ªå·±æ¬¡å°çš„èŠ‚ç‚¹ï¼›</li>
<li>çº¿ç¨‹ A å¤„ç†å®Œï¼Œåˆ é™¤è‡ªå·±çš„èŠ‚ç‚¹ï¼Œçº¿ç¨‹ B ç›‘å¬åˆ°å˜æ›´äº‹ä»¶ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è·å¾—é”ã€‚</li>
</ol>
<h4 id="154-å®ç°å¯¹æ¯”"><a class="markdownIt-Anchor" href="#154-å®ç°å¯¹æ¯”"></a> 1.5.4. å®ç°å¯¹æ¯”</h4>
<p>ZooKeeper å…·å¤‡é«˜å¯ç”¨ã€å¯é‡å…¥ã€é˜»å¡é”ç‰¹æ€§ï¼Œå¯è§£å†³å¤±æ•ˆæ­»é”é—®é¢˜ã€‚<br />
ä½† ZooKeeper å› ä¸ºéœ€è¦é¢‘ç¹çš„åˆ›å»ºå’Œåˆ é™¤èŠ‚ç‚¹ï¼Œæ€§èƒ½ä¸Šä¸å¦‚ Redis æ–¹å¼ã€‚</p>
<h3 id="16-redis-çš„æŒä¹…åŒ–æ–¹å¼æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹æŒä¹…åŒ–å®ç°åŸç†"><a class="markdownIt-Anchor" href="#16-redis-çš„æŒä¹…åŒ–æ–¹å¼æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹æŒä¹…åŒ–å®ç°åŸç†"></a> 1.6. Redis çš„æŒä¹…åŒ–æ–¹å¼ï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼ŸæŒä¹…åŒ–å®ç°åŸç†ï¼Ÿ</h3>
<h4 id="161-rdb-å¿«ç…§snapshot"><a class="markdownIt-Anchor" href="#161-rdb-å¿«ç…§snapshot"></a> 1.6.1. RDB å¿«ç…§ï¼ˆsnapshotï¼‰</h4>
<p>å°†å­˜åœ¨äºæŸä¸€æ—¶åˆ»çš„æ‰€æœ‰æ•°æ®éƒ½å†™å…¥åˆ°ç¡¬ç›˜ä¸­ã€‚</p>
<h5 id="å¿«ç…§çš„åŸç†"><a class="markdownIt-Anchor" href="#å¿«ç…§çš„åŸç†"></a> å¿«ç…§çš„åŸç†</h5>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedis å°†æ•°æ®åº“å¿«ç…§ä¿å­˜åœ¨åå­—ä¸º dump.rdb çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚ä½ å¯ä»¥å¯¹ Redis è¿›è¡Œè®¾ç½®ï¼Œ è®©å®ƒåœ¨â€œN ç§’å†…æ•°æ®é›†è‡³å°‘æœ‰ M ä¸ªæ”¹åŠ¨â€è¿™ä¸€æ¡ä»¶è¢«æ»¡è¶³æ—¶ï¼Œ è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡æ•°æ®é›†ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ SAVE æˆ–è€… BGSAVEï¼Œæ‰‹åŠ¨è®© Redis è¿›è¡Œæ•°æ®é›†ä¿å­˜æ“ä½œã€‚è¿™ç§æŒä¹…åŒ–æ–¹å¼è¢«ç§°ä¸ºå¿«ç…§ã€‚</p>
<p>å½“ Redis éœ€è¦ä¿å­˜ dump.rdb æ–‡ä»¶æ—¶ï¼Œ æœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p>
<ul>
<li>Redis åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ã€‚</li>
<li>å­è¿›ç¨‹å°†æ•°æ®é›†å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶å¿«ç…§æ–‡ä»¶ä¸­ã€‚</li>
<li>å½“å­è¿›ç¨‹å®Œæˆå¯¹æ–°å¿«ç…§æ–‡ä»¶çš„å†™å…¥æ—¶ï¼ŒRedis ç”¨æ–°å¿«ç…§æ–‡ä»¶æ›¿æ¢åŸæ¥çš„å¿«ç…§æ–‡ä»¶ï¼Œå¹¶åˆ é™¤æ—§çš„å¿«ç…§æ–‡ä»¶ã€‚</li>
</ul>
<p>è¿™ç§å·¥ä½œæ–¹å¼ä½¿å¾— Redis å¯ä»¥ä»å†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼‰æœºåˆ¶ä¸­è·ç›Šã€‚</p>
<h5 id="å¿«ç…§çš„ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#å¿«ç…§çš„ä¼˜ç‚¹"></a> å¿«ç…§çš„ä¼˜ç‚¹</h5>
<ul>
<li>å®ƒä¿å­˜äº†æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®é›†ï¼Œéå¸¸é€‚ç”¨äºæ•°æ®é›†çš„å¤‡ä»½ã€‚</li>
<li>å¾ˆæ–¹ä¾¿ä¼ é€åˆ°å¦ä¸€ä¸ªè¿œç«¯æ•°æ®ä¸­å¿ƒæˆ–è€…äºšé©¬é€Šçš„ S3ï¼ˆå¯èƒ½åŠ å¯†ï¼‰ï¼Œéå¸¸é€‚ç”¨äºç¾éš¾æ¢å¤ã€‚</li>
<li>å¿«ç…§åœ¨ä¿å­˜ RDB æ–‡ä»¶æ—¶çˆ¶è¿›ç¨‹å”¯ä¸€éœ€è¦åšçš„å°±æ˜¯ fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œæ¥ä¸‹æ¥çš„å·¥ä½œå…¨éƒ¨ç”±å­è¿›ç¨‹æ¥åšï¼Œçˆ¶è¿›ç¨‹ä¸éœ€è¦å†åšå…¶ä»– IO æ“ä½œï¼Œæ‰€ä»¥å¿«ç…§æŒä¹…åŒ–æ–¹å¼å¯ä»¥æœ€å¤§åŒ– redis çš„æ€§èƒ½ã€‚</li>
<li>ä¸ AOF ç›¸æ¯”ï¼Œåœ¨æ¢å¤å¤§çš„æ•°æ®é›†çš„æ—¶å€™ï¼ŒDB æ–¹å¼ä¼šæ›´å¿«ä¸€äº›ã€‚</li>
</ul>
<h5 id="å¿«ç…§çš„ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#å¿«ç…§çš„ç¼ºç‚¹"></a> å¿«ç…§çš„ç¼ºç‚¹</h5>
<ul>
<li>å¦‚æœä½ å¸Œæœ›åœ¨ redis æ„å¤–åœæ­¢å·¥ä½œï¼ˆä¾‹å¦‚ç”µæºä¸­æ–­ï¼‰çš„æƒ…å†µä¸‹ä¸¢å¤±çš„æ•°æ®æœ€å°‘çš„è¯ï¼Œé‚£ä¹ˆå¿«ç…§ä¸é€‚åˆä½ ã€‚</li>
<li>å¿«ç…§éœ€è¦ç»å¸¸ fork å­è¿›ç¨‹æ¥ä¿å­˜æ•°æ®é›†åˆ°ç¡¬ç›˜ä¸Šã€‚å½“æ•°æ®é›†æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œfork çš„è¿‡ç¨‹æ˜¯éå¸¸è€—æ—¶çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ Redis åœ¨ä¸€äº›æ¯«ç§’çº§å†…ä¸èƒ½å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</li>
</ul>
<h4 id="162-aof"><a class="markdownIt-Anchor" href="#162-aof"></a> 1.6.2. AOF</h4>
<p>AOF æŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨æ‰§è¡Œçš„å†™æ“ä½œã€‚å½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®ã€‚</p>
<h4 id="163-aof-çš„åŸç†"><a class="markdownIt-Anchor" href="#163-aof-çš„åŸç†"></a> 1.6.3. AOF çš„åŸç†</h4>
<ul>
<li>Redis åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ã€‚</li>
<li>å­è¿›ç¨‹å¼€å§‹å°†æ–° AOF æ–‡ä»¶çš„å†…å®¹å†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ã€‚</li>
<li>å¯¹äºæ‰€æœ‰æ–°æ‰§è¡Œçš„å†™å…¥å‘½ä»¤ï¼Œçˆ¶è¿›ç¨‹ä¸€è¾¹å°†å®ƒä»¬ç´¯ç§¯åˆ°ä¸€ä¸ªå†…å­˜ç¼“å­˜ä¸­ï¼Œä¸€è¾¹å°†è¿™äº›æ”¹åŠ¨è¿½åŠ åˆ°ç°æœ‰ AOF æ–‡ä»¶çš„æœ«å°¾ï¼Œè¿™æ ·æ ·å³ä½¿åœ¨é‡å†™çš„ä¸­é€”å‘ç”Ÿåœæœºï¼Œç°æœ‰çš„ AOF æ–‡ä»¶ä¹Ÿè¿˜æ˜¯å®‰å…¨çš„ã€‚</li>
<li>å½“å­è¿›ç¨‹å®Œæˆé‡å†™å·¥ä½œæ—¶ï¼Œå®ƒç»™çˆ¶è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œçˆ¶è¿›ç¨‹åœ¨æ¥æ”¶åˆ°ä¿¡å·ä¹‹åï¼Œå°†å†…å­˜ç¼“å­˜ä¸­çš„æ‰€æœ‰æ•°æ®è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶çš„æœ«å°¾ã€‚</li>
<li>æå®šï¼ç°åœ¨ Redis åŸå­åœ°ç”¨æ–°æ–‡ä»¶æ›¿æ¢æ—§æ–‡ä»¶ï¼Œä¹‹åæ‰€æœ‰å‘½ä»¤éƒ½ä¼šç›´æ¥è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶çš„æœ«å°¾ã€‚</li>
</ul>
<h4 id="164-aof-çš„ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#164-aof-çš„ä¼˜ç‚¹"></a> 1.6.4. AOF çš„ä¼˜ç‚¹</h4>
<ul>
<li>ä½¿ç”¨é»˜è®¤çš„æ¯ç§’ fsync ç­–ç•¥ï¼ŒRedis çš„æ€§èƒ½ä¾ç„¶å¾ˆå¥½(fsync æ˜¯ç”±åå°çº¿ç¨‹è¿›è¡Œå¤„ç†çš„,ä¸»çº¿ç¨‹ä¼šå°½åŠ›å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚)ï¼Œä¸€æ—¦å‡ºç°æ•…éšœï¼Œä½¿ç”¨ AOF ï¼Œä½ æœ€å¤šä¸¢å¤± 1 ç§’çš„æ•°æ®ã€‚</li>
<li>AOF æ–‡ä»¶æ˜¯ä¸€ä¸ªåªè¿›è¡Œè¿½åŠ çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸éœ€è¦å†™å…¥ seekï¼Œå³ä½¿ç”±äºæŸäº›åŸå› (ç£ç›˜ç©ºé—´å·²æ»¡ï¼Œå†™çš„è¿‡ç¨‹ä¸­å®•æœºç­‰ç­‰)æœªæ‰§è¡Œå®Œæ•´çš„å†™å…¥å‘½ä»¤ï¼Œä½ ä¹Ÿä¹Ÿå¯ä½¿ç”¨ redis-check-aof å·¥å…·ä¿®å¤è¿™äº›é—®é¢˜ã€‚</li>
<li>Redis å¯ä»¥åœ¨ AOF æ–‡ä»¶ä½“ç§¯å˜å¾—è¿‡å¤§æ—¶ï¼Œè‡ªåŠ¨åœ°åœ¨åå°å¯¹ AOF è¿›è¡Œé‡å†™ï¼šé‡å†™åçš„æ–° AOF æ–‡ä»¶åŒ…å«äº†æ¢å¤å½“å‰æ•°æ®é›†æ‰€éœ€çš„æœ€å°å‘½ä»¤é›†åˆã€‚æ•´ä¸ªé‡å†™æ“ä½œæ˜¯ç»å¯¹å®‰å…¨çš„ã€‚</li>
<li>AOF æ–‡ä»¶æœ‰åºåœ°ä¿å­˜äº†å¯¹æ•°æ®åº“æ‰§è¡Œçš„æ‰€æœ‰å†™å…¥æ“ä½œï¼Œè¿™äº›å†™å…¥æ“ä½œä»¥ Redis åè®®çš„æ ¼å¼ä¿å­˜ã€‚å› æ­¤ AOF æ–‡ä»¶çš„å†…å®¹éå¸¸å®¹æ˜“è¢«äººè¯»æ‡‚ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œåˆ†æï¼ˆparseï¼‰ä¹Ÿå¾ˆè½»æ¾ã€‚</li>
</ul>
<h4 id="165-aof-çš„ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#165-aof-çš„ç¼ºç‚¹"></a> 1.6.5. AOF çš„ç¼ºç‚¹</h4>
<ul>
<li>å¯¹äºç›¸åŒçš„æ•°æ®é›†æ¥è¯´ï¼ŒAOF æ–‡ä»¶çš„ä½“ç§¯é€šå¸¸è¦å¤§äº RDB æ–‡ä»¶çš„ä½“ç§¯ã€‚</li>
<li>æ ¹æ®æ‰€ä½¿ç”¨çš„ fsync ç­–ç•¥ï¼ŒAOF çš„é€Ÿåº¦å¯èƒ½ä¼šæ…¢äºå¿«ç…§ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ç§’ fsync çš„æ€§èƒ½ä¾ç„¶éå¸¸é«˜ï¼Œè€Œå…³é—­ fsync å¯ä»¥è®© AOF çš„é€Ÿåº¦å’Œå¿«ç…§ä¸€æ ·å¿«ï¼Œå³ä½¿åœ¨é«˜è´Ÿè·ä¹‹ä¸‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸è¿‡åœ¨å¤„ç†å·¨å¤§çš„å†™å…¥è½½å…¥æ—¶ï¼Œå¿«ç…§å¯ä»¥æä¾›æ›´æœ‰ä¿è¯çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ï¼ˆlatencyï¼‰ã€‚</li>
</ul>
<h3 id="17-redis-è¿‡æœŸç­–ç•¥æœ‰å“ªäº›"><a class="markdownIt-Anchor" href="#17-redis-è¿‡æœŸç­–ç•¥æœ‰å“ªäº›"></a> 1.7. Redis è¿‡æœŸç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h3>
<ul>
<li><strong>noeviction</strong> - å½“å†…å­˜ä½¿ç”¨è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œæ‰€æœ‰å¼•èµ·ç”³è¯·å†…å­˜çš„å‘½ä»¤ä¼šæŠ¥é”™ã€‚</li>
<li><strong>allkeys-lru</strong> - åœ¨ä¸»é”®ç©ºé—´ä¸­ï¼Œä¼˜å…ˆç§»é™¤æœ€è¿‘æœªä½¿ç”¨çš„ keyã€‚</li>
<li><strong>allkeys-random</strong> - åœ¨ä¸»é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ª keyã€‚</li>
<li><strong>volatile-lru</strong> - åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œä¼˜å…ˆç§»é™¤æœ€è¿‘æœªä½¿ç”¨çš„ keyã€‚</li>
<li><strong>volatile-random</strong> - åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ª keyã€‚</li>
<li><strong>volatile-ttl</strong> - åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œå…·æœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„ key ä¼˜å…ˆç§»é™¤ã€‚</li>
</ul>
<h3 id="18-redis-å’Œ-memcached-æœ‰ä»€ä¹ˆåŒºåˆ«"><a class="markdownIt-Anchor" href="#18-redis-å’Œ-memcached-æœ‰ä»€ä¹ˆåŒºåˆ«"></a> 1.8. Redis å’Œ Memcached æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p>ä¸¤è€…éƒ½æ˜¯éå…³ç³»å‹å†…å­˜é”®å€¼æ•°æ®åº“ã€‚æœ‰ä»¥ä¸‹ä¸»è¦ä¸åŒï¼š</p>
<p><strong>æ•°æ®ç±»å‹</strong></p>
<ul>
<li>Memcached ä»…æ”¯æŒå­—ç¬¦ä¸²ç±»å‹ï¼›</li>
<li>è€Œ Redis æ”¯æŒäº”ç§ä¸åŒç§ç±»çš„æ•°æ®ç±»å‹ï¼Œä½¿å¾—å®ƒå¯ä»¥æ›´çµæ´»åœ°è§£å†³é—®é¢˜ã€‚</li>
</ul>
<p><strong>æ•°æ®æŒä¹…åŒ–</strong></p>
<ul>
<li>Memcached ä¸æ”¯æŒæŒä¹…åŒ–ï¼›</li>
<li>Redis æ”¯æŒä¸¤ç§æŒä¹…åŒ–ç­–ç•¥ï¼šRDB å¿«ç…§å’Œ AOF æ—¥å¿—ã€‚</li>
</ul>
<p><strong>åˆ†å¸ƒå¼</strong></p>
<ul>
<li>Memcached ä¸æ”¯æŒåˆ†å¸ƒå¼ï¼Œåªèƒ½é€šè¿‡åœ¨å®¢æˆ·ç«¯ä½¿ç”¨åƒä¸€è‡´æ€§å“ˆå¸Œè¿™æ ·çš„åˆ†å¸ƒå¼ç®—æ³•æ¥å®ç°åˆ†å¸ƒå¼å­˜å‚¨ï¼Œè¿™ç§æ–¹å¼åœ¨å­˜å‚¨å’ŒæŸ¥è¯¢æ—¶éƒ½éœ€è¦å…ˆåœ¨å®¢æˆ·ç«¯è®¡ç®—ä¸€æ¬¡æ•°æ®æ‰€åœ¨çš„èŠ‚ç‚¹ã€‚</li>
<li>Redis Cluster å®ç°äº†åˆ†å¸ƒå¼çš„æ”¯æŒã€‚</li>
</ul>
<p><strong>å†…å­˜ç®¡ç†æœºåˆ¶</strong></p>
<ul>
<li>Memcached å°†å†…å­˜åˆ†å‰²æˆç‰¹å®šé•¿åº¦çš„å—æ¥å­˜å‚¨æ•°æ®ï¼Œä»¥å®Œå…¨è§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä¼šä½¿å¾—å†…å­˜çš„åˆ©ç”¨ç‡ä¸é«˜ï¼Œä¾‹å¦‚å—çš„å¤§å°ä¸º 128 bytesï¼Œåªå­˜å‚¨ 100 bytes çš„æ•°æ®ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ 28 bytes å°±æµªè´¹æ‰äº†ã€‚</li>
<li>åœ¨ Redis ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½ä¸€ç›´å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥å°†ä¸€äº›å¾ˆä¹…æ²¡ç”¨çš„ value äº¤æ¢åˆ°ç£ç›˜ã€‚è€Œ Memcached çš„æ•°æ®åˆ™ä¼šä¸€ç›´åœ¨å†…å­˜ä¸­ã€‚</li>
</ul>
<h3 id="19-ä¸ºä»€ä¹ˆå•çº¿ç¨‹çš„-redis-æ€§èƒ½åè€Œä¼˜äºå¤šçº¿ç¨‹çš„-memcached"><a class="markdownIt-Anchor" href="#19-ä¸ºä»€ä¹ˆå•çº¿ç¨‹çš„-redis-æ€§èƒ½åè€Œä¼˜äºå¤šçº¿ç¨‹çš„-memcached"></a> 1.9. ä¸ºä»€ä¹ˆå•çº¿ç¨‹çš„ Redis æ€§èƒ½åè€Œä¼˜äºå¤šçº¿ç¨‹çš„ Memcachedï¼Ÿ</h3>
<p>Redis å¿«é€Ÿçš„åŸå› ï¼š</p>
<ol>
<li>ç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼ˆéå¸¸å¿«é€Ÿï¼‰</li>
<li>é‡‡ç”¨å•çº¿ç¨‹,é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶</li>
<li>éé˜»å¡ IO</li>
</ol>
<p>å†…éƒ¨å®ç°é‡‡ç”¨ epollï¼Œé‡‡ç”¨äº† epoll+è‡ªå·±å®ç°çš„ç®€å•çš„äº‹ä»¶æ¡†æ¶ã€‚epoll ä¸­çš„è¯»ã€å†™ã€å…³é—­ã€è¿æ¥éƒ½è½¬åŒ–æˆäº†äº‹ä»¶ï¼Œç„¶ååˆ©ç”¨ epoll çš„å¤šè·¯å¤ç”¨ç‰¹æ€§ï¼Œç»ä¸åœ¨ io ä¸Šæµªè´¹ä¸€ç‚¹æ—¶é—´ã€‚</p>
<h2 id="2-åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—mq"><a class="markdownIt-Anchor" href="#2-åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—mq"></a> 2. åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰</h2>
<h3 id="21-ä¸ºä»€ä¹ˆä½¿ç”¨-mq"><a class="markdownIt-Anchor" href="#21-ä¸ºä»€ä¹ˆä½¿ç”¨-mq"></a> 2.1. ä¸ºä»€ä¹ˆä½¿ç”¨ MQï¼Ÿ</h3>
<ul>
<li>å¼‚æ­¥å¤„ç† - ç›¸æ¯”äºä¼ ç»Ÿçš„ä¸²è¡Œã€å¹¶è¡Œæ–¹å¼ï¼Œæé«˜äº†ç³»ç»Ÿååé‡ã€‚</li>
<li>åº”ç”¨è§£è€¦ - ç³»ç»Ÿé—´é€šè¿‡æ¶ˆæ¯é€šä¿¡ï¼Œä¸ç”¨å…³å¿ƒå…¶ä»–ç³»ç»Ÿçš„å¤„ç†ã€‚</li>
<li>æµé‡å‰Šé”‹ - å¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦æ§åˆ¶è¯·æ±‚é‡ï¼›å¯ä»¥ç¼“è§£çŸ­æ—¶é—´å†…çš„é«˜å¹¶å‘è¯·æ±‚ã€‚</li>
<li>æ—¥å¿—å¤„ç† - è§£å†³å¤§é‡æ—¥å¿—ä¼ è¾“ã€‚</li>
<li>æ¶ˆæ¯é€šè®¯ - æ¶ˆæ¯é˜Ÿåˆ—ä¸€èˆ¬éƒ½å†…ç½®äº†é«˜æ•ˆçš„é€šä¿¡æœºåˆ¶ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç”¨åœ¨çº¯çš„æ¶ˆæ¯é€šè®¯ã€‚æ¯”å¦‚å®ç°ç‚¹å¯¹ç‚¹æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ–è€…èŠå¤©å®¤ç­‰ã€‚</li>
</ul>
<h3 id="22-å¦‚ä½•ä¿è¯-mq-çš„é«˜å¯ç”¨"><a class="markdownIt-Anchor" href="#22-å¦‚ä½•ä¿è¯-mq-çš„é«˜å¯ç”¨"></a> 2.2. å¦‚ä½•ä¿è¯ MQ çš„é«˜å¯ç”¨ï¼Ÿ</h3>
<h4 id="221-æ•°æ®å¤åˆ¶"><a class="markdownIt-Anchor" href="#221-æ•°æ®å¤åˆ¶"></a> 2.2.1. æ•°æ®å¤åˆ¶</h4>
<ol>
<li>å°†æ‰€æœ‰ Broker å’Œå¾…åˆ†é…çš„ Partition æ’åº</li>
<li>å°†ç¬¬ i ä¸ª Partition åˆ†é…åˆ°ç¬¬ï¼ˆi mod nï¼‰ä¸ª Broker ä¸Š</li>
<li>å°†ç¬¬ i ä¸ª Partition çš„ç¬¬ j ä¸ª Replica åˆ†é…åˆ°ç¬¬ï¼ˆ(i + j) mode nï¼‰ä¸ª Broker ä¸Š</li>
</ol>
<h4 id="222-é€‰ä¸¾ä¸»æœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#222-é€‰ä¸¾ä¸»æœåŠ¡å™¨"></a> 2.2.2. é€‰ä¸¾ä¸»æœåŠ¡å™¨</h4>
<h3 id="23-mq-æœ‰å“ªäº›å¸¸è§é—®é¢˜å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜"><a class="markdownIt-Anchor" href="#23-mq-æœ‰å“ªäº›å¸¸è§é—®é¢˜å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜"></a> 2.3. MQ æœ‰å“ªäº›å¸¸è§é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ</h3>
<p>MQ çš„å¸¸è§é—®é¢˜æœ‰ï¼š</p>
<ol>
<li>æ¶ˆæ¯çš„é¡ºåºé—®é¢˜</li>
<li>æ¶ˆæ¯çš„é‡å¤é—®é¢˜</li>
</ol>
<h4 id="231-æ¶ˆæ¯çš„é¡ºåºé—®é¢˜"><a class="markdownIt-Anchor" href="#231-æ¶ˆæ¯çš„é¡ºåºé—®é¢˜"></a> 2.3.1. æ¶ˆæ¯çš„é¡ºåºé—®é¢˜</h4>
<p>æ¶ˆæ¯æœ‰åºæŒ‡çš„æ˜¯å¯ä»¥æŒ‰ç…§æ¶ˆæ¯çš„å‘é€é¡ºåºæ¥æ¶ˆè´¹ã€‚</p>
<p>å‡å¦‚ç”Ÿäº§è€…äº§ç”Ÿäº† 2 æ¡æ¶ˆæ¯ï¼šM1ã€M2ï¼Œå‡å®š M1 å‘é€åˆ° S1ï¼ŒM2 å‘é€åˆ° S2ï¼Œå¦‚æœè¦ä¿è¯ M1 å…ˆäº M2 è¢«æ¶ˆè´¹ï¼Œæ€ä¹ˆåšï¼Ÿ</p>
<div align="center"><img src="http://upload-images.jianshu.io/upload_images/3101171-23145c8b554a0f2f.jpg"/></div>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>ï¼ˆ1ï¼‰ä¿è¯ç”Ÿäº§è€… - MQServer - æ¶ˆè´¹è€…æ˜¯ä¸€å¯¹ä¸€å¯¹ä¸€çš„å…³ç³»</p>
<div align="center"><img src="http://upload-images.jianshu.io/upload_images/3101171-034106d7e04c062d.jpg"/></div>
<p>ç¼ºé™·ï¼š</p>
<ul>
<li>å¹¶è¡Œåº¦å°±ä¼šæˆä¸ºæ¶ˆæ¯ç³»ç»Ÿçš„ç“¶é¢ˆï¼ˆååé‡ä¸å¤Ÿï¼‰</li>
<li>æ›´å¤šçš„å¼‚å¸¸å¤„ç†ï¼Œæ¯”å¦‚ï¼šåªè¦æ¶ˆè´¹ç«¯å‡ºç°é—®é¢˜ï¼Œå°±ä¼šå¯¼è‡´æ•´ä¸ªå¤„ç†æµç¨‹é˜»å¡ï¼Œæˆ‘ä»¬ä¸å¾—ä¸èŠ±è´¹æ›´å¤šçš„ç²¾åŠ›æ¥è§£å†³é˜»å¡çš„é—®é¢˜ã€‚</li>
</ul>
<p>ï¼ˆ2ï¼‰é€šè¿‡åˆç†çš„è®¾è®¡æˆ–è€…å°†é—®é¢˜åˆ†è§£æ¥è§„é¿ã€‚</p>
<ul>
<li>ä¸å…³æ³¨ä¹±åºçš„åº”ç”¨å®é™…å¤§é‡å­˜åœ¨</li>
<li>é˜Ÿåˆ—æ— åºå¹¶ä¸æ„å‘³ç€æ¶ˆæ¯æ— åº</li>
</ul>
<p>æ‰€ä»¥ä»ä¸šåŠ¡å±‚é¢æ¥ä¿è¯æ¶ˆæ¯çš„é¡ºåºè€Œä¸ä»…ä»…æ˜¯ä¾èµ–äºæ¶ˆæ¯ç³»ç»Ÿï¼Œæ˜¯ä¸€ç§æ›´åˆç†çš„æ–¹å¼ã€‚</p>
<h4 id="232-æ¶ˆæ¯çš„é‡å¤é—®é¢˜"><a class="markdownIt-Anchor" href="#232-æ¶ˆæ¯çš„é‡å¤é—®é¢˜"></a> 2.3.2. æ¶ˆæ¯çš„é‡å¤é—®é¢˜</h4>
<p>é€ æˆæ¶ˆæ¯é‡å¤çš„æ ¹æœ¬åŸå› æ˜¯ï¼šç½‘ç»œä¸å¯è¾¾ã€‚</p>
<p>æ‰€ä»¥è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•å°±æ˜¯ç»•è¿‡è¿™ä¸ªé—®é¢˜ã€‚é‚£ä¹ˆé—®é¢˜å°±å˜æˆäº†ï¼šå¦‚æœæ¶ˆè´¹ç«¯æ”¶åˆ°ä¸¤æ¡ä¸€æ ·çš„æ¶ˆæ¯ï¼Œåº”è¯¥æ€æ ·å¤„ç†ï¼Ÿ</p>
<p>æ¶ˆè´¹ç«¯å¤„ç†æ¶ˆæ¯çš„ä¸šåŠ¡é€»è¾‘ä¿æŒå¹‚ç­‰æ€§ã€‚åªè¦ä¿æŒå¹‚ç­‰æ€§ï¼Œä¸ç®¡æ¥å¤šå°‘æ¡é‡å¤æ¶ˆæ¯ï¼Œæœ€åå¤„ç†çš„ç»“æœéƒ½ä¸€æ ·ã€‚<br />
ä¿è¯æ¯æ¡æ¶ˆæ¯éƒ½æœ‰å”¯ä¸€ç¼–å·ä¸”ä¿è¯æ¶ˆæ¯å¤„ç†æˆåŠŸä¸å»é‡è¡¨çš„æ—¥å¿—åŒæ—¶å‡ºç°ã€‚åˆ©ç”¨ä¸€å¼ æ—¥å¿—è¡¨æ¥è®°å½•å·²ç»å¤„ç†æˆåŠŸçš„æ¶ˆæ¯çš„ IDï¼Œå¦‚æœæ–°åˆ°çš„æ¶ˆæ¯ ID å·²ç»åœ¨æ—¥å¿—è¡¨ä¸­ï¼Œé‚£ä¹ˆå°±ä¸å†å¤„ç†è¿™æ¡æ¶ˆæ¯ã€‚</p>
<h3 id="24-kafka-activemq-rabbitmq-rocketmq-å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#24-kafka-activemq-rabbitmq-rocketmq-å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹"></a> 2.4. Kafka, ActiveMQ, RabbitMQ, RocketMQ å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</h3>
<div align="center"><img src="http://upload-images.jianshu.io/upload_images/3101171-c26f4a3048c38af4.jpg"/></div>
<h2 id="3-åˆ†å¸ƒå¼æœåŠ¡rpc"><a class="markdownIt-Anchor" href="#3-åˆ†å¸ƒå¼æœåŠ¡rpc"></a> 3. åˆ†å¸ƒå¼æœåŠ¡ï¼ˆRPCï¼‰</h2>
<h3 id="31-dubbo-çš„å®ç°è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#31-dubbo-çš„å®ç°è¿‡ç¨‹"></a> 3.1. Dubbo çš„å®ç°è¿‡ç¨‹ï¼Ÿ</h3>
<div align="center">
<img src="http://dunwu.test.upcdn.net/cs/java/javaweb/distributed/rpc/dubbo/dubboåŸºæœ¬æ¶æ„.png!zp" width="500"/>
</div>
<p>èŠ‚ç‚¹è§’è‰²ï¼š</p>
<table>
<thead>
<tr>
<th>èŠ‚ç‚¹</th>
<th>è§’è‰²è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Provider</td>
<td>æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹</td>
</tr>
<tr>
<td>Consumer</td>
<td>è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹</td>
</tr>
<tr>
<td>Registry</td>
<td>æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ</td>
</tr>
<tr>
<td>Monitor</td>
<td>ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ</td>
</tr>
<tr>
<td>Container</td>
<td>æœåŠ¡è¿è¡Œå®¹å™¨</td>
</tr>
</tbody>
</table>
<p>è°ƒç”¨å…³ç³»ï¼š</p>
<ol>
<li>åŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚</li>
<li>æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚</li>
<li>æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚</li>
</ol>
<h3 id="32-dubbo-è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›"><a class="markdownIt-Anchor" href="#32-dubbo-è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›"></a> 3.2. Dubbo è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h3>
<h5 id="random"><a class="markdownIt-Anchor" href="#random"></a> Random</h5>
<ul>
<li>éšæœºï¼ŒæŒ‰æƒé‡è®¾ç½®éšæœºæ¦‚ç‡ã€‚</li>
<li>åœ¨ä¸€ä¸ªæˆªé¢ä¸Šç¢°æ’çš„æ¦‚ç‡é«˜ï¼Œä½†è°ƒç”¨é‡è¶Šå¤§åˆ†å¸ƒè¶Šå‡åŒ€ï¼Œè€Œä¸”æŒ‰æ¦‚ç‡ä½¿ç”¨æƒé‡åä¹Ÿæ¯”è¾ƒå‡åŒ€ï¼Œæœ‰åˆ©äºåŠ¨æ€è°ƒæ•´æä¾›è€…æƒé‡ã€‚</li>
</ul>
<h5 id="roundrobin"><a class="markdownIt-Anchor" href="#roundrobin"></a> RoundRobin</h5>
<ul>
<li>è½®å¾ªï¼ŒæŒ‰å…¬çº¦åçš„æƒé‡è®¾ç½®è½®å¾ªæ¯”ç‡ã€‚</li>
<li>å­˜åœ¨æ…¢çš„æä¾›è€…ç´¯ç§¯è¯·æ±‚çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šç¬¬äºŒå°æœºå™¨å¾ˆæ…¢ï¼Œä½†æ²¡æŒ‚ï¼Œå½“è¯·æ±‚è°ƒåˆ°ç¬¬äºŒå°æ—¶å°±å¡åœ¨é‚£ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¡åœ¨è°ƒåˆ°ç¬¬äºŒå°ä¸Šã€‚</li>
</ul>
<h5 id="leastactive"><a class="markdownIt-Anchor" href="#leastactive"></a> LeastActive</h5>
<ul>
<li>æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°ï¼Œç›¸åŒæ´»è·ƒæ•°çš„éšæœºï¼Œæ´»è·ƒæ•°æŒ‡è°ƒç”¨å‰åè®¡æ•°å·®ã€‚</li>
<li>ä½¿æ…¢çš„æä¾›è€…æ”¶åˆ°æ›´å°‘è¯·æ±‚ï¼Œå› ä¸ºè¶Šæ…¢çš„æä¾›è€…çš„è°ƒç”¨å‰åè®¡æ•°å·®ä¼šè¶Šå¤§ã€‚</li>
</ul>
<h5 id="consistenthash"><a class="markdownIt-Anchor" href="#consistenthash"></a> ConsistentHash</h5>
<ul>
<li>ä¸€è‡´æ€§ Hashï¼Œç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚</li>
<li>å½“æŸä¸€å°æä¾›è€…æŒ‚æ—¶ï¼ŒåŸæœ¬å‘å¾€è¯¥æä¾›è€…çš„è¯·æ±‚ï¼ŒåŸºäºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹³æ‘Šåˆ°å…¶å®ƒæä¾›è€…ï¼Œä¸ä¼šå¼•èµ·å‰§çƒˆå˜åŠ¨ã€‚</li>
<li>ç®—æ³•å‚è§ï¼š<a href="http://en.wikipedia.org/wiki/Consistent_hashing" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/Consistent_hashing</a></li>
<li>ç¼ºçœåªå¯¹ç¬¬ä¸€ä¸ªå‚æ•° Hashï¼Œå¦‚æœè¦ä¿®æ”¹ï¼Œè¯·é…ç½® <code>&lt;dubbo:parameter key=&quot;hash.arguments&quot; value=&quot;0,1&quot; /&gt;</code></li>
<li>ç¼ºçœç”¨ 160 ä»½è™šæ‹ŸèŠ‚ç‚¹ï¼Œå¦‚æœè¦ä¿®æ”¹ï¼Œè¯·é…ç½® <code>&lt;dubbo:parameter key=&quot;hash.nodes&quot; value=&quot;320&quot; /&gt;</code></li>
</ul>
<h3 id="33-dubbo-é›†ç¾¤å®¹é”™ç­–ç•¥"><a class="markdownIt-Anchor" href="#33-dubbo-é›†ç¾¤å®¹é”™ç­–ç•¥"></a> 3.3. Dubbo é›†ç¾¤å®¹é”™ç­–ç•¥ ï¼Ÿ</h3>
<div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/distributed/rpc/dubbo/dubbo%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99.jpg!zp"/></div>
<ul>
<li><strong>Failover</strong> - å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“å‡ºç°å¤±è´¥ï¼Œé‡è¯•å…¶å®ƒæœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äºè¯»æ“ä½œï¼Œä½†é‡è¯•ä¼šå¸¦æ¥æ›´é•¿å»¶è¿Ÿã€‚å¯é€šè¿‡ retries=â€œ2â€ æ¥è®¾ç½®é‡è¯•æ¬¡æ•°(ä¸å«ç¬¬ä¸€æ¬¡)ã€‚</li>
<li><strong>Failfast</strong> - å¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥ç«‹å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºéå¹‚ç­‰æ€§çš„å†™æ“ä½œï¼Œæ¯”å¦‚æ–°å¢è®°å½•ã€‚</li>
<li><strong>Failsafe</strong> - å¤±è´¥å®‰å…¨ï¼Œå‡ºç°å¼‚å¸¸æ—¶ï¼Œç›´æ¥å¿½ç•¥ã€‚é€šå¸¸ç”¨äºå†™å…¥å®¡è®¡æ—¥å¿—ç­‰æ“ä½œã€‚</li>
<li><strong>Failback</strong> - å¤±è´¥è‡ªåŠ¨æ¢å¤ï¼Œåå°è®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘ã€‚é€šå¸¸ç”¨äºæ¶ˆæ¯é€šçŸ¥æ“ä½œã€‚</li>
<li><strong>Forking</strong> - å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›ã€‚é€šå¸¸ç”¨äºå®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¯»æ“ä½œï¼Œä½†éœ€è¦æµªè´¹æ›´å¤šæœåŠ¡èµ„æºã€‚å¯é€šè¿‡ forks=â€œ2â€ æ¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°ã€‚</li>
<li><strong>Broadcast</strong> - æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…ï¼Œé€ä¸ªè°ƒç”¨ï¼Œä»»æ„ä¸€å°æŠ¥é”™åˆ™æŠ¥é”™ã€‚é€šå¸¸ç”¨äºé€šçŸ¥æ‰€æœ‰æä¾›è€…æ›´æ–°ç¼“å­˜æˆ–æ—¥å¿—ç­‰æœ¬åœ°èµ„æºä¿¡æ¯ã€‚</li>
</ul>
<h3 id="34-åŠ¨æ€ä»£ç†ç­–ç•¥"><a class="markdownIt-Anchor" href="#34-åŠ¨æ€ä»£ç†ç­–ç•¥"></a> 3.4. åŠ¨æ€ä»£ç†ç­–ç•¥ï¼Ÿ</h3>
<p>Dubbo ä½œä¸º RPC æ¡†æ¶ï¼Œé¦–å…ˆè¦å®Œæˆçš„å°±æ˜¯è·¨ç³»ç»Ÿï¼Œè·¨ç½‘ç»œçš„æœåŠ¡è°ƒç”¨ã€‚æ¶ˆè´¹æ–¹ä¸æä¾›æ–¹éµå¾ªç»Ÿä¸€çš„æ¥å£å®šä¹‰ï¼Œæ¶ˆè´¹æ–¹è°ƒç”¨æ¥å£æ—¶ï¼ŒDubbo å°†å…¶è½¬æ¢æˆç»Ÿä¸€æ ¼å¼çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œæä¾›æ–¹æ ¹æ®è§„åˆ™æ‰¾åˆ°æ¥å£å®ç°ï¼Œé€šè¿‡åå°„å®Œæˆè°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆè´¹æ–¹è·å–çš„æ˜¯å¯¹è¿œç¨‹æœåŠ¡çš„ä¸€ä¸ªä»£ç†(Proxy)ï¼Œè€Œæä¾›æ–¹å› ä¸ºè¦æ”¯æŒä¸åŒçš„æ¥å£å®ç°ï¼Œéœ€è¦ä¸€ä¸ªåŒ…è£…å±‚(Wrapper)ã€‚è°ƒç”¨çš„è¿‡ç¨‹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<div align="center"><img src="https://oscimg.oschina.net/oscnet/bef19cd5a31b5ae13aff35a8cb4898faaf0.jpg"/></div>
<p>æ¶ˆè´¹æ–¹çš„ Proxy å’Œæä¾›æ–¹çš„ Wrapper å¾—ä»¥è®© Dubbo æ„å»ºå‡ºå¤æ‚ã€ç»Ÿä¸€çš„ä½“ç³»ã€‚è€Œè¿™ç§åŠ¨æ€ä»£ç†ä¸åŒ…è£…ä¹Ÿæ˜¯é€šè¿‡åŸºäº SPI çš„æ’ä»¶æ–¹å¼å®ç°çš„ï¼Œå®ƒçš„æ¥å£å°±æ˜¯<strong>ProxyFactory</strong>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SPI</span>(<span class="string">"javassist"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProxyFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Adaptive</span>(&#123;Constants.PROXY_KEY&#125;)</span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">getProxy</span><span class="params">(Invoker&lt;T&gt; invoker)</span> <span class="keyword">throws</span> RpcException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Adaptive</span>(&#123;Constants.PROXY_KEY&#125;)</span><br><span class="line">    &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">getInvoker</span><span class="params">(T proxy, Class&lt;T&gt; type, URL url)</span> <span class="keyword">throws</span> RpcException</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ProxyFactory æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œä¸€ç§æ˜¯åŸºäº JDK çš„ä»£ç†å®ç°ï¼Œä¸€ç§æ˜¯åŸºäº javassist çš„å®ç°ã€‚ProxyFactory æ¥å£ä¸Šå®šä¹‰äº†@SPI(â€œjavassistâ€)ï¼Œé»˜è®¤ä¸º javassist çš„å®ç°ã€‚</p>
<h3 id="35-dubbo-æ”¯æŒå“ªäº›åºåˆ—åŒ–åè®®hessianhessian-çš„æ•°æ®ç»“æ„"><a class="markdownIt-Anchor" href="#35-dubbo-æ”¯æŒå“ªäº›åºåˆ—åŒ–åè®®hessianhessian-çš„æ•°æ®ç»“æ„"></a> 3.5. Dubbo æ”¯æŒå“ªäº›åºåˆ—åŒ–åè®®ï¼ŸHessianï¼ŸHessian çš„æ•°æ®ç»“æ„ï¼Ÿ</h3>
<ol>
<li>dubbo åºåˆ—åŒ–ï¼Œé˜¿é‡Œå°šä¸æˆç†Ÿçš„ java åºåˆ—åŒ–å®ç°ã€‚</li>
<li>hessian2 åºåˆ—åŒ–ï¼šhessian æ˜¯ä¸€ç§è·¨è¯­è¨€çš„é«˜æ•ˆäºŒè¿›åˆ¶çš„åºåˆ—åŒ–æ–¹å¼ï¼Œä½†è¿™é‡Œå®é™…ä¸æ˜¯åŸç”Ÿçš„ hessian2 åºåˆ—åŒ–ï¼Œè€Œæ˜¯é˜¿é‡Œä¿®æ”¹è¿‡çš„ hessian liteï¼Œå®ƒæ˜¯ dubbo RPC é»˜è®¤å¯ç”¨çš„åºåˆ—åŒ–æ–¹å¼ã€‚</li>
<li>json åºåˆ—åŒ–ï¼šç›®å‰æœ‰ä¸¤ç§å®ç°ï¼Œä¸€ç§æ˜¯é‡‡ç”¨çš„é˜¿é‡Œçš„ fastjson åº“ï¼Œå¦ä¸€ç§æ˜¯é‡‡ç”¨ dubbo ä¸­è‡ªå·²å®ç°çš„ç®€å• json åº“ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œjson è¿™ç§æ–‡æœ¬åºåˆ—åŒ–æ€§èƒ½ä¸å¦‚äºŒè¿›åˆ¶åºåˆ—åŒ–ã€‚</li>
<li>java åºåˆ—åŒ–ï¼šä¸»è¦æ˜¯é‡‡ç”¨ JDK è‡ªå¸¦çš„ java åºåˆ—åŒ–å®ç°ï¼Œæ€§èƒ½å¾ˆä¸ç†æƒ³ã€‚</li>
<li>Kryo å’Œ FSTï¼šKryo å’Œ FST çš„æ€§èƒ½ä¾ç„¶æ™®éä¼˜äº hessian å’Œ dubbo åºåˆ—åŒ–ã€‚</li>
</ol>
<p>Hessian åºåˆ—åŒ–ä¸ Java é»˜è®¤çš„åºåˆ—åŒ–åŒºåˆ«ï¼Ÿ</p>
<p>Hessian æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ remoting on http å·¥å…·ï¼Œé‡‡ç”¨çš„æ˜¯ Binary RPC åè®®ï¼Œæ‰€ä»¥å®ƒå¾ˆé€‚åˆäºå‘é€äºŒè¿›åˆ¶æ•°æ®ï¼ŒåŒæ—¶åˆå…·æœ‰é˜²ç«å¢™ç©¿é€èƒ½åŠ›ã€‚</p>
<ol>
<li>Hessian æ”¯æŒè·¨è¯­è¨€ä¸²è¡Œ</li>
<li>æ¯” java åºåˆ—åŒ–å…·æœ‰æ›´å¥½çš„æ€§èƒ½å’Œæ˜“ç”¨æ€§</li>
<li>æ”¯æŒçš„è¯­è¨€æ¯”è¾ƒå¤š</li>
</ol>
<h3 id="36-protoco-buffer-æ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#36-protoco-buffer-æ˜¯ä»€ä¹ˆ"></a> 3.6. Protoco Buffer æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>Protocol Buffer æ˜¯ Google å‡ºå“çš„ä¸€ç§è½»é‡ &amp; é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œæ€§èƒ½æ¯” Jsonã€XML çœŸçš„å¼ºï¼å¤ªï¼å¤šï¼</p>
<p>Protocol Buffer çš„åºåˆ—åŒ– &amp; ååºåˆ—åŒ–ç®€å• &amp; é€Ÿåº¦å¿«çš„åŸå› æ˜¯ï¼š</p>
<ol>
<li>ç¼–ç  / è§£ç  æ–¹å¼ç®€å•ï¼ˆåªéœ€è¦ç®€å•çš„æ•°å­¦è¿ç®— = ä½ç§»ç­‰ç­‰ï¼‰</li>
<li>é‡‡ç”¨ Protocol Buffer è‡ªèº«çš„æ¡†æ¶ä»£ç  å’Œ ç¼–è¯‘å™¨ å…±åŒå®Œæˆ</li>
</ol>
<p>Protocol Buffer çš„æ•°æ®å‹ç¼©æ•ˆæœå¥½ï¼ˆå³åºåˆ—åŒ–åçš„æ•°æ®é‡ä½“ç§¯å°ï¼‰çš„åŸå› æ˜¯ï¼š</p>
<ol>
<li>é‡‡ç”¨äº†ç‹¬ç‰¹çš„ç¼–ç æ–¹å¼ï¼Œå¦‚ Varintã€Zigzag ç¼–ç æ–¹å¼ç­‰ç­‰</li>
<li>é‡‡ç”¨ T - L - V çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼šå‡å°‘äº†åˆ†éš”ç¬¦çš„ä½¿ç”¨ &amp; æ•°æ®å­˜å‚¨å¾—ç´§å‡‘</li>
</ol>
<h3 id="37-æ³¨å†Œä¸­å¿ƒæŒ‚äº†å¯ä»¥ç»§ç»­é€šä¿¡å—"><a class="markdownIt-Anchor" href="#37-æ³¨å†Œä¸­å¿ƒæŒ‚äº†å¯ä»¥ç»§ç»­é€šä¿¡å—"></a> 3.7. æ³¨å†Œä¸­å¿ƒæŒ‚äº†å¯ä»¥ç»§ç»­é€šä¿¡å—ï¼Ÿ</h3>
<p>å¯ä»¥ã€‚Dubbo æ¶ˆè´¹è€…åœ¨åº”ç”¨å¯åŠ¨æ—¶ä¼šä»æ³¨å†Œä¸­å¿ƒæ‹‰å–å·²æ³¨å†Œçš„ç”Ÿäº§è€…çš„åœ°å€æ¥å£ï¼Œå¹¶ç¼“å­˜åœ¨æœ¬åœ°ã€‚æ¯æ¬¡è°ƒç”¨æ—¶ï¼ŒæŒ‰ç…§æœ¬åœ°å­˜å‚¨çš„åœ°å€è¿›è¡Œè°ƒç”¨ã€‚</p>
<h3 id="38-zookeeper-åŸç†æ˜¯ä»€ä¹ˆzookeeper-æœ‰ä»€ä¹ˆç”¨"><a class="markdownIt-Anchor" href="#38-zookeeper-åŸç†æ˜¯ä»€ä¹ˆzookeeper-æœ‰ä»€ä¹ˆç”¨"></a> 3.8. ZooKeeper åŸç†æ˜¯ä»€ä¹ˆï¼ŸZooKeeper æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h3>
<p>ZooKeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨åè°ƒç³»ç»Ÿï¼Œå·²ç»ç”¨åˆ°äº†è®¸å¤šåˆ†å¸ƒå¼é¡¹ç›®ä¸­ï¼Œç”¨æ¥å®Œæˆç»Ÿä¸€å‘½åæœåŠ¡ã€çŠ¶æ€åŒæ­¥æœåŠ¡ã€é›†ç¾¤ç®¡ç†ã€åˆ†å¸ƒå¼åº”ç”¨é…ç½®é¡¹çš„ç®¡ç†ç­‰å·¥ä½œã€‚</p>
<div align="center">
<img src="http://dunwu.test.upcdn.net/cs/java/javaweb/distributed/rpc/zookeeper/zookeeper-service.png!zp" />
</div>
<ol>
<li>æ¯ä¸ª Server åœ¨å†…å­˜ä¸­å­˜å‚¨äº†ä¸€ä»½æ•°æ®ï¼›</li>
<li>Zookeeper å¯åŠ¨æ—¶ï¼Œå°†ä»å®ä¾‹ä¸­é€‰ä¸¾ä¸€ä¸ª leaderï¼ˆPaxos åè®®ï¼‰ï¼›</li>
<li>Leader è´Ÿè´£å¤„ç†æ•°æ®æ›´æ–°ç­‰æ“ä½œï¼ˆZab åè®®ï¼‰ï¼›</li>
<li>ä¸€ä¸ªæ›´æ–°æ“ä½œæˆåŠŸï¼Œå½“ä¸”ä»…å½“å¤§å¤šæ•° Server åœ¨å†…å­˜ä¸­æˆåŠŸä¿®æ”¹æ•°æ®ã€‚</li>
</ol>
<h3 id="39-netty-æœ‰ä»€ä¹ˆç”¨niobioaio-æœ‰ä»€ä¹ˆç”¨æœ‰ä»€ä¹ˆåŒºåˆ«"><a class="markdownIt-Anchor" href="#39-netty-æœ‰ä»€ä¹ˆç”¨niobioaio-æœ‰ä»€ä¹ˆç”¨æœ‰ä»€ä¹ˆåŒºåˆ«"></a> 3.9. Netty æœ‰ä»€ä¹ˆç”¨ï¼ŸNIO/BIO/AIO æœ‰ä»€ä¹ˆç”¨ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p>Netty æ˜¯ä¸€ä¸ªâ€œç½‘ç»œé€šè®¯æ¡†æ¶â€ã€‚</p>
<p>Netty è¿›è¡Œäº‹ä»¶å¤„ç†çš„æµç¨‹ã€‚<code>Channel</code>æ˜¯è¿æ¥çš„é€šé“ï¼Œæ˜¯ ChannelEvent çš„äº§ç”Ÿè€…ï¼Œè€Œ<code>ChannelPipeline</code>å¯ä»¥ç†è§£ä¸º ChannelHandler çš„é›†åˆã€‚</p>
<div align="center"><img src="https://camo.githubusercontent.com/5f7331d15c79fba29474c5be6e9e86db465637c3/687474703a2f2f7374617469632e6f736368696e612e6e65742f75706c6f6164732f73706163652f323031332f303932312f3137343033325f313872625f3139303539312e706e67"/></div>
<blockquote>
<p>å‚è€ƒï¼š<a href="https://github.com/code4craft/netty-learning/blob/master/posts/ch1-overview.md" target="_blank" rel="noopener">https://github.com/code4craft/netty-learning/blob/master/posts/ch1-overview.md</a></p>
</blockquote>
<p>IO çš„æ–¹å¼é€šå¸¸åˆ†ä¸ºå‡ ç§ï¼š</p>
<ul>
<li>åŒæ­¥é˜»å¡çš„ BIO</li>
<li>åŒæ­¥éé˜»å¡çš„ NIO</li>
<li>å¼‚æ­¥éé˜»å¡çš„ AIO</li>
</ul>
<p>åœ¨ä½¿ç”¨åŒæ­¥ I/O çš„ç½‘ç»œåº”ç”¨ä¸­ï¼Œå¦‚æœè¦åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼Œæˆ–æ˜¯åœ¨å®¢æˆ·ç«¯è¦åŒæ—¶å’Œå¤šä¸ªæœåŠ¡å™¨è¿›è¡Œé€šè®¯ï¼Œå°±å¿…é¡»ä½¿ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†ã€‚</p>
<p>NIO åŸºäº Reactorï¼Œå½“ socket æœ‰æµå¯è¯»æˆ–å¯å†™å…¥ socket æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šç›¸åº”çš„é€šçŸ¥å¼•ç”¨ç¨‹åºè¿›è¡Œå¤„ç†ï¼Œåº”ç”¨å†å°†æµè¯»å–åˆ°ç¼“å†²åŒºæˆ–å†™å…¥æ“ä½œç³»ç»Ÿã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå·²ç»ä¸æ˜¯ä¸€ä¸ªè¿æ¥å°±è¦å¯¹åº”ä¸€ä¸ªå¤„ç†çº¿ç¨‹äº†ï¼Œè€Œæ˜¯æœ‰æ•ˆçš„è¯·æ±‚ï¼Œå¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“è¿æ¥æ²¡æœ‰æ•°æ®æ—¶ï¼Œæ˜¯æ²¡æœ‰å·¥ä½œçº¿ç¨‹æ¥å¤„ç†çš„ã€‚</p>
<p>ä¸ NIO ä¸åŒï¼Œå½“è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œåªé¡»ç›´æ¥è°ƒç”¨ API çš„ read æˆ– write æ–¹æ³•å³å¯ã€‚è¿™ä¸¤ç§æ–¹æ³•å‡ä¸ºå¼‚æ­¥çš„ï¼Œå¯¹äºè¯»æ“ä½œè€Œè¨€ï¼Œå½“æœ‰æµå¯è¯»å–æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†å¯è¯»çš„æµä¼ å…¥ read æ–¹æ³•çš„ç¼“å†²åŒºï¼Œå¹¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼›å¯¹äºå†™æ“ä½œè€Œè¨€ï¼Œå½“æ“ä½œç³»ç»Ÿå°† write æ–¹æ³•ä¼ é€’çš„æµå†™å…¥å®Œæ¯•æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸»åŠ¨é€šçŸ¥åº”ç”¨ç¨‹åºã€‚ å³å¯ä»¥ç†è§£ä¸ºï¼Œread/write æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå®Œæˆåä¼šä¸»åŠ¨è°ƒç”¨å›è°ƒå‡½æ•°ã€‚</p>
<blockquote>
<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/skiof007/article/details/52873421" target="_blank" rel="noopener">https://blog.csdn.net/skiof007/article/details/52873421</a></p>
</blockquote>
<h3 id="310-ä¸ºä»€ä¹ˆè¦è¿›è¡Œç³»ç»Ÿæ‹†åˆ†æ‹†åˆ†ä¸ç”¨-dubbo-å¯ä»¥å—"><a class="markdownIt-Anchor" href="#310-ä¸ºä»€ä¹ˆè¦è¿›è¡Œç³»ç»Ÿæ‹†åˆ†æ‹†åˆ†ä¸ç”¨-dubbo-å¯ä»¥å—"></a> 3.10. ä¸ºä»€ä¹ˆè¦è¿›è¡Œç³»ç»Ÿæ‹†åˆ†ï¼Ÿæ‹†åˆ†ä¸ç”¨ Dubbo å¯ä»¥å—ï¼Ÿ</h3>
<p>ç³»ç»Ÿæ‹†åˆ†ä»èµ„æºè§’åº¦åˆ†ä¸ºï¼šåº”ç”¨æ‹†åˆ†å’Œæ•°æ®åº“æ‹†åˆ†ã€‚</p>
<p>ä»é‡‡ç”¨çš„å…ˆåé¡ºåºå¯åˆ†ä¸ºï¼šæ°´å¹³æ‰©å±•ã€å‚ç›´æ‹†åˆ†ã€ä¸šåŠ¡æ‹†åˆ†ã€æ°´å¹³æ‹†åˆ†ã€‚</p>
<div align="center"><img src="http://misc.linkedkeeper.com/misc/img/blog/201804/linkedkeeper0_9c2ed2ed-6156-40f7-ad08-20af067047ca.jpg"/></div>
<p>æ˜¯å¦ä½¿ç”¨æœåŠ¡ä¾æ®å®é™…ä¸šåŠ¡åœºæ™¯æ¥å†³å®šã€‚</p>
<p>å½“å‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒï¼Œä½¿å‰ç«¯åº”ç”¨èƒ½æ›´å¿«é€Ÿçš„å“åº”å¤šå˜çš„å¸‚åœºéœ€æ±‚ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜ä¸šåŠ¡å¤ç”¨åŠæ•´åˆçš„åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶(RPC)æ˜¯å…³é”®ã€‚</p>
<p>å½“æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå®¹é‡çš„è¯„ä¼°ï¼Œå°æœåŠ¡èµ„æºçš„æµªè´¹ç­‰é—®é¢˜é€æ¸æ˜¾ç°ï¼Œæ­¤æ—¶éœ€å¢åŠ ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒåŸºäºè®¿é—®å‹åŠ›å®æ—¶ç®¡ç†é›†ç¾¤å®¹é‡ï¼Œæé«˜é›†ç¾¤åˆ©ç”¨ç‡ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜æœºå™¨åˆ©ç”¨ç‡çš„èµ„æºè°ƒåº¦å’Œæ²»ç†ä¸­å¿ƒ(SOA)æ˜¯å…³é”®ã€‚</p>
<h3 id="311-dubbo-å’Œ-thrift-æœ‰ä»€ä¹ˆåŒºåˆ«"><a class="markdownIt-Anchor" href="#311-dubbo-å’Œ-thrift-æœ‰ä»€ä¹ˆåŒºåˆ«"></a> 3.11. Dubbo å’Œ Thrift æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<ul>
<li>Thrift æ˜¯è·¨è¯­è¨€çš„ RPC æ¡†æ¶ã€‚</li>
<li>Dubbo æ”¯æŒæœåŠ¡æ²»ç†ï¼Œè€Œ Thrift ä¸æ”¯æŒã€‚</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/4/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/blog/page/6/">6</a><a class="page-number" href="/blog/page/7/">7</a><a class="extend next" rel="next" href="/blog/page/6/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Zhang Peng"
    src="/blog/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Zhang Peng</p>
  <div class="site-description" itemprop="description">Dunwu's Blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">68</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/dunwu" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;dunwu" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/blog/mailto:forbreak@163.com" title="E-Mail &amp;rarr; mailto:forbreak@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/blog/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2015 â€“ 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-paper-plane"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang Peng</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">351k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">5:19</span>
</div>

        












        
      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>
<script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script>
<script src="/blog/js/schemes/pisces.js"></script>
<script src="/blog/js/next-boot.js"></script><script src="/blog/js/bookmark.js"></script>



  




  <script src="/blog/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://blog-ajay4qmfci.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
