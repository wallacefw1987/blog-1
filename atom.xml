<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Dunwu</title>
  
  <subtitle>å¤§é“è‡³ç®€ï¼ŒçŸ¥æ˜“è¡Œéš¾</subtitle>
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="https://dunwu.github.io/blog/"/>
  <updated>2020-01-27T15:30:00.166Z</updated>
  <id>https://dunwu.github.io/blog/</id>
  
  <author>
    <name>Zhang Peng</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Markdown Cheat Sheet</title>
    <link href="https://dunwu.github.io/blog/efficiency/style/markdown-cheatsheet/"/>
    <id>https://dunwu.github.io/blog/efficiency/style/markdown-cheatsheet/</id>
    <published>2021-01-26T16:00:00.000Z</published>
    <updated>2020-01-27T15:30:00.166Z</updated>
    
    <content type="html"><![CDATA[<h1 id="markdown-cheat-sheet"><a class="markdownIt-Anchor" href="#markdown-cheat-sheet"></a> Markdown Cheat Sheet</h1><blockquote><p>ğŸ“¦ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œ<a href="https://github.com/dunwu/blog" target="_blank" rel="noopener">blog</a>ã€</p></blockquote><h2 id="ç›®å½•"><a class="markdownIt-Anchor" href="#ç›®å½•"></a> ç›®å½•</h2><!-- TOC depthFrom:2 depthTo:2 --><ul><li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></li><li><a href="#%E6%A0%87%E9%A2%98">æ ‡é¢˜</a></li><li><a href="#%E6%96%87%E6%9C%AC%E6%A0%B7%E5%BC%8F">æ–‡æœ¬æ ·å¼</a></li><li><a href="#%E5%88%97%E8%A1%A8">åˆ—è¡¨</a></li><li><a href="#%E5%88%86%E5%89%B2%E7%BA%BF">åˆ†å‰²çº¿</a></li><li><a href="#%E9%93%BE%E6%8E%A5">é“¾æ¥</a></li><li><a href="#%E5%BC%95%E7%94%A8">å¼•ç”¨</a></li><li><a href="#%E4%BB%A3%E7%A0%81%E9%AB%98%E4%BA%AE">ä»£ç é«˜äº®</a></li><li><a href="#%E8%A1%A8%E6%A0%BC">è¡¨æ ¼</a></li><li><a href="#emoji-%E8%A1%A8%E6%83%85">Emoji è¡¨æƒ…</a></li><li><a href="#%E6%B3%A8%E8%84%9A">æ³¨è„š</a></li><li><a href="#%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F">æ•°å­¦å…¬å¼</a></li><li><a href="#diff">Diff</a></li><li><a href="#%E6%B5%81%E7%A8%8B%E5%9B%BE">æµç¨‹å›¾</a></li><li><a href="#html">HTML</a></li><li><a href="#%E7%BC%96%E8%BE%91%E5%99%A8">ç¼–è¾‘å™¨</a></li><li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li></ul><!-- /TOC --><h2 id="æ ‡é¢˜"><a class="markdownIt-Anchor" href="#æ ‡é¢˜"></a> æ ‡é¢˜</h2><p>Markdown æ”¯æŒå…­ä¸ªçº§åˆ«çš„æ ‡é¢˜ã€‚</p><figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">è¯­æ³•ï¼š</span><br><span class="line"># ä¸€çº§æ ‡é¢˜</span><br><span class="line">## äºŒçº§æ ‡é¢˜</span><br><span class="line">### ä¸‰çº§æ ‡é¢˜</span><br><span class="line">#### å››çº§æ ‡é¢˜</span><br><span class="line">##### äº”çº§æ ‡é¢˜</span><br><span class="line">###### å…­çº§æ ‡é¢˜</span><br></pre></td></tr></table></figure><h2 id="æ–‡æœ¬æ ·å¼"><a class="markdownIt-Anchor" href="#æ–‡æœ¬æ ·å¼"></a> æ–‡æœ¬æ ·å¼</h2><blockquote><p>ğŸ’¡ ç²—ä½“ã€æ–œä½“ã€åˆ é™¤çº¿å¯ä»¥æ··åˆä½¿ç”¨ã€‚</p><p>åœ¨ Markdown ä¸­ï¼Œç²—ä½“æ–‡æœ¬ã€æ–œä½“æ–‡æœ¬å¯ä»¥ä½¿ç”¨ <code>*</code> æˆ– <code>_</code> ç¬¦å·æ ‡è®°ã€‚å»ºè®®ç»Ÿä¸€é£æ ¼ï¼Œå§‹ç»ˆåªç”¨ä¸€ç§ç¬¦å·ã€‚</p></blockquote><table><thead><tr><th>è¯­æ³•</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>æ™®é€šæ–‡æœ¬</td><td>æ™®é€šæ–‡æœ¬</td></tr><tr><td><code>*æ–œä½“æ–‡æœ¬*</code> <code>_æ–œä½“æ–‡æœ¬_</code></td><td><em>æ–œä½“æ–‡æœ¬</em> <em>æ–œä½“æ–‡æœ¬</em></td></tr><tr><td><code>**ç²—ä½“æ–‡æœ¬**</code> <code>__ç²—ä½“æ–‡æœ¬__</code></td><td><strong>ç²—ä½“æ–‡æœ¬</strong> <strong>ç²—ä½“æ–‡æœ¬</strong></td></tr><tr><td><code>~~åˆ é™¤æ–‡æœ¬~~</code></td><td><s>åˆ é™¤æ–‡æœ¬</s></td></tr><tr><td><code>***ç²—æ–œä½“æ–‡æœ¬***</code> <code>___ç²—æ–œä½“æ–‡æœ¬___</code></td><td><em><strong>ç²—æ–œä½“æ–‡æœ¬</strong></em> <em><strong>ç²—æ–œä½“æ–‡æœ¬</strong></em></td></tr></tbody></table><h2 id="åˆ—è¡¨"><a class="markdownIt-Anchor" href="#åˆ—è¡¨"></a> åˆ—è¡¨</h2><h3 id="æ— åºåˆ—è¡¨"><a class="markdownIt-Anchor" href="#æ— åºåˆ—è¡¨"></a> æ— åºåˆ—è¡¨</h3><ul><li>RED</li><li>YELLOW</li><li>BLUE</li></ul><h3 id="æœ‰åºåˆ—è¡¨"><a class="markdownIt-Anchor" href="#æœ‰åºåˆ—è¡¨"></a> æœ‰åºåˆ—è¡¨</h3><ol><li>ç¬¬ä¸€æ­¥</li><li>ç¬¬äºŒæ­¥</li><li>ç¬¬ä¸‰æ­¥</li></ol><h3 id="ä»»åŠ¡åˆ—è¡¨"><a class="markdownIt-Anchor" href="#ä»»åŠ¡åˆ—è¡¨"></a> ä»»åŠ¡åˆ—è¡¨</h3><ul><li>[x] å®Œæˆä»»åŠ¡</li><li>[ ] è®¡åˆ’ä»»åŠ¡</li></ul><h3 id="å¤šçº§åˆ—è¡¨"><a class="markdownIt-Anchor" href="#å¤šçº§åˆ—è¡¨"></a> å¤šçº§åˆ—è¡¨</h3><ul><li>æ•°æ®ç»“æ„<ul><li>çº¿æ€§è¡¨<ul><li>é¡ºåºè¡¨</li><li>é“¾è¡¨<ul><li>å•é“¾è¡¨</li><li>åŒé“¾è¡¨</li></ul></li></ul></li><li>æ ‘<ul><li>äºŒå‰æ ‘<ul><li>äºŒå‰å¹³è¡¡æ ‘</li></ul></li></ul></li></ul></li></ul><h2 id="åˆ†å‰²çº¿"><a class="markdownIt-Anchor" href="#åˆ†å‰²çº¿"></a> åˆ†å‰²çº¿</h2><p><code>***</code>ã€<code>---</code>ã€<code>___</code> éƒ½å¯ä»¥ä½œä¸ºåˆ†å‰²çº¿ã€‚</p><hr /><hr /><hr /><h2 id="é“¾æ¥"><a class="markdownIt-Anchor" href="#é“¾æ¥"></a> é“¾æ¥</h2><h3 id="æ™®é€šé“¾æ¥"><a class="markdownIt-Anchor" href="#æ™®é€šé“¾æ¥"></a> æ™®é€šé“¾æ¥</h3><p>è¯­æ³•ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">[<span class="string">æˆ‘çš„åšå®¢</span>](<span class="link">https://dunwu.github.io/blog/</span>)</span><br></pre></td></tr></table></figure><ul><li><code>[]</code> ä¸­æ ‡è®°é“¾æ¥åã€‚ç±»ä¼¼ HTML ä¸­ <code>&lt;a&gt;</code> å…ƒç´ çš„ <code>title</code> å±æ€§ã€‚</li><li><code>()</code> ä¸­æ ‡è®°é“¾æ¥çš„ urlï¼Œä¹Ÿæ”¯æŒç›¸å¯¹è·¯å¾„ï¼ˆå‰ææ˜¯èµ„æºå¯ä»¥è®¿é—®ï¼‰ã€‚ç±»ä¼¼ HTML ä¸­ <code>&lt;a&gt;</code> å…ƒç´ çš„ <code>href</code> å±æ€§ã€‚</li></ul><p>æ•ˆæœï¼š</p><ul><li><a href="https://dunwu.github.io/blog/" title="blog">æˆ‘çš„åšå®¢</a></li></ul><h3 id="å›¾ç‰‡"><a class="markdownIt-Anchor" href="#å›¾ç‰‡"></a> å›¾ç‰‡</h3><p>Markdown å¼•ç”¨å›¾ç‰‡çš„è¯­æ³•ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">![<span class="string">alt</span>](<span class="link">url title</span>)</span><br></pre></td></tr></table></figure><p>alt å’Œ title å³å¯¹åº” HTML ä¸­ img å…ƒç´ çš„ alt å’Œ title å±æ€§ï¼ˆéƒ½å¯çœç•¥ï¼‰ï¼š</p><ul><li><p>alt - è¡¨ç¤ºå›¾ç‰‡æ˜¾ç¤ºå¤±è´¥æ—¶çš„æ›¿æ¢æ–‡æœ¬ã€‚</p></li><li><p>title - è¡¨ç¤ºé¼ æ ‡æ‚¬åœåœ¨å›¾ç‰‡æ—¶çš„æ˜¾ç¤ºæ–‡æœ¬ï¼ˆæ³¨æ„è¿™é‡Œè¦åŠ å¼•å·ï¼‰</p></li><li><p>url - å³å›¾ç‰‡çš„ url åœ°å€</p></li></ul><p><img src="http://dunwu.test.upcdn.net/common/logo/zp.png" alt="logo" title="logo" /></p><h3 id="å›¾ç‰‡é“¾æ¥"><a class="markdownIt-Anchor" href="#å›¾ç‰‡é“¾æ¥"></a> å›¾ç‰‡é“¾æ¥</h3><p>å¯ä»¥å°†å›¾ç‰‡å’Œé“¾æ¥æ··åˆä½¿ç”¨ã€‚</p><p><a href="https://dunwu.github.io/blog/"><img src="http://dunwu.test.upcdn.net/common/logo/zp.png" alt="logo" title="logo" /></a></p><h3 id="é”šç‚¹"><a class="markdownIt-Anchor" href="#é”šç‚¹"></a> é”šç‚¹</h3><p>å…¶å®å‘¢ï¼Œæ¯ä¸€ä¸ªæ ‡é¢˜éƒ½æ˜¯ä¸€ä¸ªé”šç‚¹ï¼Œå’Œ HTML çš„é”šç‚¹ï¼ˆ<code>#</code>ï¼‰ç±»ä¼¼ï¼Œæ¯”å¦‚ï¼š<a href="#Markdown-%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97">å›åˆ°é¡¶éƒ¨</a></p><h2 id="å¼•ç”¨"><a class="markdownIt-Anchor" href="#å¼•ç”¨"></a> å¼•ç”¨</h2><p>æ™®é€šå¼•ç”¨ï¼š</p><blockquote><p>â“ ä»€ä¹ˆæ˜¯ <code>Markdown</code></p><p><strong>Markdown</strong>æ˜¯ä¸€ç§<a href="https://zh.wikipedia.org/wiki/%E8%BD%BB%E9%87%8F%E7%BA%A7%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80" target="_blank" rel="noopener">è½»é‡çº§æ ‡è®°è¯­è¨€</a>ï¼Œåˆ›å§‹äººä¸º<a href="https://zh.wikipedia.org/wiki/%E7%B4%84%E7%BF%B0%C2%B7%E6%A0%BC%E9%AD%AF%E4%BC%AF" target="_blank" rel="noopener">çº¦ç¿°Â·æ ¼é²ä¼¯</a>ï¼ˆè‹±è¯­ï¼šJohn Gruberï¼‰ã€‚å®ƒå…è®¸äººä»¬â€œä½¿ç”¨æ˜“è¯»æ˜“å†™çš„çº¯æ–‡æœ¬æ ¼å¼ç¼–å†™æ–‡æ¡£ï¼Œç„¶åè½¬æ¢æˆæœ‰æ•ˆçš„<a href="https://zh.wikipedia.org/wiki/XHTML" target="_blank" rel="noopener">XHTML</a>ï¼ˆæˆ–è€…<a href="https://zh.wikipedia.org/wiki/HTML" target="_blank" rel="noopener">HTML</a>ï¼‰æ–‡æ¡£â€ã€‚[<a href="https://zh.wikipedia.org/wiki/Markdown#cite_note-md-4" target="_blank" rel="noopener">4]</a>è¿™ç§è¯­è¨€å¸æ”¶äº†å¾ˆå¤šåœ¨<a href="https://zh.wikipedia.org/wiki/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6" target="_blank" rel="noopener">ç”µå­é‚®ä»¶</a>ä¸­å·²æœ‰çš„çº¯æ–‡æœ¬æ ‡è®°çš„ç‰¹æ€§ã€‚ â€”â€” æ‘˜è‡ª Wiki</p></blockquote><p>åµŒå¥—å¼•ç”¨ï¼š</p><blockquote><p>æ•°æ®ç»“æ„</p><blockquote><p>æ ‘</p><blockquote><p>äºŒå‰æ ‘</p><blockquote><p>å¹³è¡¡äºŒå‰æ ‘</p><blockquote><p>æ»¡äºŒå‰æ ‘</p></blockquote></blockquote></blockquote></blockquote></blockquote><h2 id="ä»£ç é«˜äº®"><a class="markdownIt-Anchor" href="#ä»£ç é«˜äº®"></a> ä»£ç é«˜äº®</h2><h3 id="æ ‡ç­¾"><a class="markdownIt-Anchor" href="#æ ‡ç­¾"></a> æ ‡ç­¾</h3><p>è¯­æ³•ï¼š</p><figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line">`Markdown` `Doc`</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><p><code>Markdown</code>, <code>Doc</code></p><h3 id="ä»£ç å—"><a class="markdownIt-Anchor" href="#ä»£ç å—"></a> ä»£ç å—</h3><p>è¯­æ³•ä¸€ï¼šåœ¨æ–‡æœ¬å‰åéƒ½ä½¿ç”¨ä¸‰ä¸ªåå¼•å·è¿›è¡Œæ ‡è®°ã€‚ã€âœ”ï¸ æ¨èã€‘</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬å—ã€‚</span><br><span class="line">è¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬å—ã€‚</span><br><span class="line">è¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬å—ã€‚</span><br></pre></td></tr></table></figure><p>è¯­æ³•äºŒï¼šåœ¨è¿ç»­å‡ è¡Œçš„æ–‡æœ¬å¼€å¤´åŠ å…¥ 1 ä¸ª Tab æˆ–è€… 4 ä¸ªç©ºæ ¼ã€‚ã€âŒ ä¸æ¨èã€‘</p><pre><code>è¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬å—ã€‚è¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬å—ã€‚è¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬å—ã€‚</code></pre><h3 id="è¯­æ³•"><a class="markdownIt-Anchor" href="#è¯­æ³•"></a> è¯­æ³•</h3><p>åœ¨ä¸‰ä¸ªåå¼•å·åé¢åŠ ä¸Šç¼–ç¨‹è¯­è¨€çš„åå­—ï¼Œå¦èµ·ä¸€è¡Œå¼€å§‹å†™ä»£ç ï¼Œæœ€åä¸€è¡Œå†åŠ ä¸Šä¸‰ä¸ªåå¼•å·ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[]args)</span></span>&#123;&#125; <span class="comment">//Java</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> <span class="comment">//C</span></span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"hello GitHub"</span> <span class="comment">#Bash</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'myH1'</span>).innerHTML = <span class="string">'Welcome to my Homepage'</span> <span class="comment">//javascipt</span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">string</span> &amp;<span class="keyword">operator</span>+(<span class="keyword">const</span> <span class="built_in">string</span>&amp; A,<span class="keyword">const</span> <span class="built_in">string</span>&amp; B) <span class="comment">//cpp</span></span><br></pre></td></tr></table></figure><h2 id="è¡¨æ ¼"><a class="markdownIt-Anchor" href="#è¡¨æ ¼"></a> è¡¨æ ¼</h2><p>ä¸€èˆ¬è¡¨æ ¼ï¼š</p><table><thead><tr><th>è¡¨å¤´ 1</th><th>è¡¨å¤´ 2</th></tr></thead><tbody><tr><td>è¡¨æ ¼å•å…ƒ</td><td>è¡¨æ ¼å•å…ƒ</td></tr><tr><td>è¡¨æ ¼å•å…ƒ</td><td>è¡¨æ ¼å•å…ƒ</td></tr></tbody></table><p>è¡¨æ ¼å¯ä»¥æŒ‡å®šå¯¹é½æ–¹å¼ï¼š</p><table><thead><tr><th style="text-align:center">åºå·</th><th style="text-align:left">å•†å“</th><th style="text-align:right">ä»·æ ¼</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:left">ç”µè„‘</td><td style="text-align:right">6000.0</td></tr><tr><td style="text-align:center">2</td><td style="text-align:left">é¼ æ ‡</td><td style="text-align:right">100.0</td></tr><tr><td style="text-align:center">3</td><td style="text-align:left">é”®ç›˜</td><td style="text-align:right">200.0</td></tr></tbody></table><h2 id="emoji-è¡¨æƒ…"><a class="markdownIt-Anchor" href="#emoji-è¡¨æƒ…"></a> Emoji è¡¨æƒ…</h2><p>Markdown å¼•æ“ä¸€èˆ¬éƒ½æ”¯æŒ Emojiã€‚</p><p>åˆç†ä½¿ç”¨ Emoji è¡¨æƒ…ï¼Œå¾€å¾€å¯ä»¥ä½¿å¾—æ–‡ç« å†…å®¹æ›´åŠ ä¸°å¯Œç”ŸåŠ¨ã€‚ä¾‹å¦‚ï¼šâœ”ï¸ âŒ ğŸ’¡ ğŸ”” â—ï¸ â“</p><blockquote><p>æ›´å¤š Emoji è¡¨æƒ…è¯·å‚è€ƒï¼š</p><ul><li><a href="http://emojihomepage.com/" target="_blank" rel="noopener">http://emojihomepage.com/</a></li><li><a href="http://www.emoji-cheat-sheet.com" target="_blank" rel="noopener">http://www.emoji-cheat-sheet.com</a></li></ul></blockquote><h2 id="æ³¨è„š"><a class="markdownIt-Anchor" href="#æ³¨è„š"></a> æ³¨è„š</h2><p>ä¸€ä¸ªå…·æœ‰æ³¨è„šçš„æ–‡æœ¬ã€‚<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p><h2 id="æ•°å­¦å…¬å¼"><a class="markdownIt-Anchor" href="#æ•°å­¦å…¬å¼"></a> æ•°å­¦å…¬å¼</h2><p>å¾ˆå¤šæ–‡æ¡£ä¸­ï¼Œéœ€è¦å¼•å…¥ä¸€äº›æ•°å­¦ç¬¦å·ã€ç‰¹æ®Šç¬¦å·ï¼Œå…¶æ’ç‰ˆé—®é¢˜æ¯”è¾ƒå¤´ç–¼ã€‚è¿™ç§é—®é¢˜ï¼Œå¯ä»¥ç”¨ Latex æ¥è§£å†³ï¼Œå¤§éƒ¨åˆ† Markdown å¼•æ“éƒ½æ”¯æŒ Latexã€‚</p><p>Latex å¯ä»¥ä½¿ç”¨ <code>$</code> ç¬¦å·æ¥æ ‡è®° Latex è¡¨è¾¾å¼ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ•°å­¦å…¬å¼ç¤ºä¾‹ï¼š</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Î“</mi><mo stretchy="false">(</mo><mi>z</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mo>âˆ«</mo><mn>0</mn><mi mathvariant="normal">âˆ</mi></msubsup><msup><mi>t</mi><mrow><mi>z</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>t</mi></mrow></msup><mi>d</mi><mi>t</mi><mtext>â€‰</mtext><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">\Gamma(z) = \int_0^\infty t^{z-1}e^{-t}dt\,.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Î“</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.326242em;vertical-align:-0.9119499999999999em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">âˆ«</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.414292em;"><span style="top:-1.7880500000000001em;margin-left:-0.44445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.8129000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">âˆ</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9119499999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.843556em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">t</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">d</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span></span></span></span></span></p><p>åˆ—ä¸¾ä¸€äº›å¸¸ç”¨æ•°å­¦ç¬¦å·ï¼š</p><table><thead><tr><th style="text-align:center">ç¬¦å·</th><th>è¯­æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>â‰¤</mo></mrow><annotation encoding="application/x-tex">\leq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mrel">â‰¤</span></span></span></span></td><td><code>$\leq$</code></td><td>å°äºç­‰äº</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>â‰¥</mo></mrow><annotation encoding="application/x-tex">\geq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mrel">â‰¥</span></span></span></span></td><td><code>$\geq$</code></td><td>å¤§äºç­‰äº</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">â‰ </mi></mrow><annotation encoding="application/x-tex">\neq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel">î€ </span></span><span class="fix"></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span></span></span></span></td><td><code>$\neq$</code></td><td>ä¸ç­‰äº</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>â‰ˆ</mo></mrow><annotation encoding="application/x-tex">\approx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.48312em;vertical-align:0em;"></span><span class="mrel">â‰ˆ</span></span></span></span></td><td><code>$\approx$</code></td><td>çº¦ç­‰äº</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ</mi></mrow><annotation encoding="application/x-tex">\infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord">âˆ</span></span></span></span></td><td><code>$\infty$</code></td><td>æ— ç©·</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mo>âˆ</mo><mi>x</mi><mi>y</mi></msubsup></mrow><annotation encoding="application/x-tex">\prod_{x}^{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.104002em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span style="top:-3.2029000000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span></span></span></span></td><td><code>$\prod_{x}^{y}$</code></td><td>ç´¯ä¹˜</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></msubsup></mrow><annotation encoding="application/x-tex">\sum_{i=0}^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.104002em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span></span></span></span></td><td><code>$\sum_{i=0}^n$</code></td><td>æ±‚å’Œ</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>âˆ«</mo></mrow><annotation encoding="application/x-tex">\int</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.11112em;vertical-align:-0.30612em;"></span><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0005599999999999772em;">âˆ«</span></span></span></span></td><td><code>$\int$</code></td><td>ç§¯åˆ†</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>âˆ¬</mo></mrow><annotation encoding="application/x-tex">\iint</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.111em;vertical-align:-0.306em;"></span><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0004999999999999727em;">âˆ¬</span></span></span></span></td><td><code>$\iint$</code></td><td>åŒé‡ç§¯åˆ†</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mo><mi>log</mi><mo>â¡</mo></mo><mi>x</mi></msub><mi>y</mi></mrow><annotation encoding="application/x-tex">\log_x{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span></span></td><td><code>$\log_x{y}$</code></td><td>å¯¹æ•°</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>x</mi><mrow><mi>y</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">x^{y+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></td><td><code>$x^{y+1}$</code></td><td>ä¸Šæ ‡</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mrow><mi>y</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">x_{y+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></td><td><code>$x_{y+1}$</code></td><td>ä¸‹æ ‡</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mi>x</mi><mi>y</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{x}{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1764999999999999em;vertical-align:-0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.481108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></td><td><code>$\frac{x}{y}$</code></td><td>åˆ†æ•°</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mroot><mi>x</mi><mi>y</mi></mroot></mrow><annotation encoding="application/x-tex">\sqrt[y]{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.23972em;"></span><span class="mord sqrt"><span class="root"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5516160000000001em;"><span style="top:-2.836336em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size6 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span></span></span></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8002800000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathdefault">x</span></span></span><span style="top:-2.76028em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.23972em;"><span></span></span></span></span></span></span></span></span></td><td><code>$\sqrt[y]{x}$</code></td><td>å¼€æ–¹</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>sin</mi><mo>â¡</mo></mrow><annotation encoding="application/x-tex">\sin</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66786em;vertical-align:0em;"></span><span class="mop">sin</span></span></span></span></td><td><code>$\sin$</code></td><td>æ­£å¼¦</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>cos</mi><mo>â¡</mo></mrow><annotation encoding="application/x-tex">\cos</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mop">cos</span></span></span></span></td><td><code>$\cos$</code></td><td>ä½™å¼¦</td></tr><tr><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>tan</mi><mo>â¡</mo></mrow><annotation encoding="application/x-tex">\tan</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mop">tan</span></span></span></span></td><td><code>$\tan$</code></td><td>æ­£åˆ‡</td></tr></tbody></table><blockquote><p>æ›´å¤šæ•°å­¦ç¬¦å·æ”¯æŒè¯·å‚è€ƒï¼š</p><ul><li><a href="https://github.com/luong-komorebi/Begin-Latex-in-minutes" target="_blank" rel="noopener">Begin-Latex-in-minutes</a></li><li><a href="https://blog.csdn.net/Katherine_hsr/article/details/79179622" target="_blank" rel="noopener">Markdown æ•°å­¦ç¬¦å·&amp;å…¬å¼</a></li></ul></blockquote><h2 id="diff"><a class="markdownIt-Anchor" href="#diff"></a> Diff</h2><p>ç‰ˆæœ¬æ§åˆ¶çš„ç³»ç»Ÿä¸­éƒ½å°‘ä¸äº† diff çš„åŠŸèƒ½ï¼Œå³å±•ç¤ºä¸€ä¸ªæ–‡ä»¶å†…å®¹çš„å¢åŠ ä¸åˆ é™¤ã€‚<br />GFM ä¸­å¯ä»¥æ˜¾ç¤ºçš„å±•ç¤º diff æ•ˆæœã€‚å¯ä»¥ç”¨ <code>+</code> å¼€å¤´è¡¨ç¤ºæ–°å¢ï¼Œ<code>-</code> å¼€å¤´è¡¨ç¤ºåˆ é™¤ã€‚</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="addition">+ æ–°å¢å†…å®¹</span></span><br><span class="line"><span class="deletion">- åˆ é™¤å†…å®¹</span></span><br></pre></td></tr></table></figure><h2 id="uml-å›¾"><a class="markdownIt-Anchor" href="#uml-å›¾"></a> UML å›¾</h2><blockquote><p>éƒ¨åˆ† Markdown å¼•æ“æ”¯æŒ <a href="https://mermaid-js.github.io/mermaid/" target="_blank" rel="noopener">mermaid</a> æä¾›çš„å„ç§ UML å›¾ã€‚è¯¦æƒ…è¯·å‚è€ƒï¼š<a href="https://mermaidjs.github.io/" target="_blank" rel="noopener">mermaid æ–‡æ¡£</a></p></blockquote><h3 id="æµç¨‹å›¾"><a class="markdownIt-Anchor" href="#æµç¨‹å›¾"></a> æµç¨‹å›¾</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[Hard edge] --&gt;|Link text| B(Round edge)</span><br><span class="line">    B --&gt; C&#123;Decision&#125;</span><br><span class="line">    C --&gt;|One| D[Result one]</span><br><span class="line">    C --&gt;|Two| E[Result two]</span><br></pre></td></tr></table></figure><h3 id="æ—¶åºå›¾"><a class="markdownIt-Anchor" href="#æ—¶åºå›¾"></a> æ—¶åºå›¾</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    Alice-&gt;&gt;Bob: Hello Bob, how are you?</span><br><span class="line">    alt is sick</span><br><span class="line">        Bob-&gt;&gt;Alice: Not so good :(</span><br><span class="line">    else is well</span><br><span class="line">        Bob-&gt;&gt;Alice: Feeling fresh like a daisy</span><br><span class="line">    end</span><br><span class="line">    opt Extra response</span><br><span class="line">        Bob-&gt;&gt;Alice: Thanks for asking</span><br><span class="line">    end</span><br></pre></td></tr></table></figure><h3 id="ç”˜ç‰¹å›¾"><a class="markdownIt-Anchor" href="#ç”˜ç‰¹å›¾"></a> ç”˜ç‰¹å›¾</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gantt</span><br><span class="line">       dateFormat  YYYY-MM-DD</span><br><span class="line">       title Adding GANTT diagram functionality to mermaid</span><br><span class="line"></span><br><span class="line">       section A section</span><br><span class="line">       Completed task            :done,    des1, 2014-01-06,2014-01-08</span><br><span class="line">       Active task               :active,  des2, 2014-01-09, 3d</span><br><span class="line">       Future task               :         des3, after des2, 5d</span><br><span class="line">       Future task2              :         des4, after des3, 5d</span><br><span class="line"></span><br><span class="line">       section Critical tasks</span><br><span class="line">       Completed task in the critical line :crit, done, 2014-01-06,24h</span><br><span class="line">       Implement parser and jison          :crit, done, after des1, 2d</span><br><span class="line">       Create tests for parser             :crit, active, 3d</span><br><span class="line">       Future task in critical line        :crit, 5d</span><br><span class="line">       Create tests for renderer           :2d</span><br><span class="line">       Add to mermaid                      :1d</span><br><span class="line"></span><br><span class="line">       section Documentation</span><br><span class="line">       Describe gantt syntax               :active, a1, after des1, 3d</span><br><span class="line">       Add gantt diagram to demo page      :after a1  , 20h</span><br><span class="line">       Add another diagram to demo page    :doc1, after a1  , 48h</span><br><span class="line"></span><br><span class="line">       section Last section</span><br><span class="line">       Describe gantt syntax               :after doc1, 3d</span><br><span class="line">       Add gantt diagram to demo page      :20h</span><br><span class="line">       Add another diagram to demo page    :48h</span><br></pre></td></tr></table></figure><h2 id="html"><a class="markdownIt-Anchor" href="#html"></a> HTML</h2><p>æœ‰äº› Markdown å¼•æ“æ”¯æŒåœ¨æ–‡æ¡£ä¸­åµŒå…¥çš„ html å…ƒç´ ã€‚</p><p>æœ‰äº› Markdown è¯­æ³•æ‰€ä¸æ”¯æŒçš„ç‰¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨ html å…ƒç´ æ¥æ”¯æŒã€‚</p><h3 id="æŠ˜å "><a class="markdownIt-Anchor" href="#æŠ˜å "></a> æŠ˜å </h3><details>  <summary>æŠ˜å å†…å®¹ä¸€</summary>  <p>å±•å¼€æ‰èƒ½çœ‹åˆ°çš„å†…å®¹</p></details><details>  <summary>æŠ˜å å†…å®¹äºŒ</summary>  <p>å±•å¼€æ‰èƒ½çœ‹åˆ°çš„å†…å®¹</p></details><h3 id="å±…ä¸­"><a class="markdownIt-Anchor" href="#å±…ä¸­"></a> å±…ä¸­</h3><div align="center"><p>å±…ä¸­æ˜¾ç¤ºçš„æ–‡æœ¬</p></div>### å›¾ç‰‡å°ºå¯¸<div align="center"><img width="100px" src="http://dunwu.test.upcdn.net/common/logo/zp.png" /></div>## ç¼–è¾‘å™¨<p>æ¨è Markdown ç¼–è¾‘å™¨</p><ul><li><a href="https://www.typora.io/" target="_blank" rel="noopener">Typora</a> - ä¸ªäººè®¤ä¸ºæ˜¯åŠŸèƒ½æœ€å¼ºçš„ Markdown ç¼–è¾‘å™¨ã€‚</li><li><a href="https://github.com/microsoft/vscode" target="_blank" rel="noopener">Visual Studio Code</a> - å¯ä»¥é€šè¿‡å®‰è£…æ’ä»¶ï¼Œé‡èº«æ‰“é€  Markdown ç¼–è¾‘å™¨ã€‚</li><li><a href="https://github.com/marktext/marktext" target="_blank" rel="noopener">marktext</a> - ä¸€æ¬¾ç®€å•ä¼˜é›…çš„ Markdown ç¼–è¾‘å™¨ã€‚</li><li><a href="https://stackedit.io/" target="_blank" rel="noopener">StackEdit</a> - åœ¨çº¿ Markdown ç¼–è¾‘å™¨ã€‚</li><li><a href="https://pandao.github.io/editor.md/" target="_blank" rel="noopener">Editor.md</a> - åœ¨çº¿ Markdown ç¼–è¾‘å™¨ã€‚</li><li><a href="https://maxiang.io/" target="_blank" rel="noopener">Marxico</a> - ä¸€æ¬¾ä¸“ä¸ºå°è±¡ç¬”è®°ï¼ˆEvernoteï¼‰æ‰“é€ çš„ Markdown ç¼–è¾‘å™¨ã€‚</li></ul><blockquote><p>æƒ³äº†è§£æ›´å¤š Markdown ç¼–è¾‘å™¨å¯ä»¥å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/69210764" target="_blank" rel="noopener">ä¸»æµ Markdown ç¼–è¾‘å™¨æ¨è</a></p></blockquote><h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://zh.wikipedia.org/wiki/Markdown" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/Markdown</a></li><li><a href="https://github.com/guodongxiaren/README" target="_blank" rel="noopener">https://github.com/guodongxiaren/README</a></li><li><a href="https://github.com/tchapi/markdown-cheatsheet" target="_blank" rel="noopener">markdown-cheatsheet</a></li><li><a href="https://github.com/luong-komorebi/Begin-Latex-in-minutes" target="_blank" rel="noopener">Begin-Latex-in-minutes</a></li><li><a href="https://github.com/mermaid-js/mermaid" target="_blank" rel="noopener">https://github.com/mermaid-js/mermaid</a></li></ul><hr class="footnotes-sep" /><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>æ³¨è„šçš„è§£é‡Š <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;markdown-cheat-sheet&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#markdown-cheat-sheet&quot;&gt;&lt;/a&gt; Markdown Cheat Sheet&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ“¦ æœ¬æ–‡
      
    
    </summary>
    
    
      <category term="æ•ˆç‡æå‡" scheme="https://dunwu.github.io/blog/categories/%E6%95%88%E7%8E%87%E6%8F%90%E5%8D%87/"/>
    
      <category term="è§„èŒƒ" scheme="https://dunwu.github.io/blog/categories/%E6%95%88%E7%8E%87%E6%8F%90%E5%8D%87/%E8%A7%84%E8%8C%83/"/>
    
    
      <category term="æ•ˆç‡æå‡" scheme="https://dunwu.github.io/blog/tags/%E6%95%88%E7%8E%87%E6%8F%90%E5%8D%87/"/>
    
      <category term="è§„èŒƒ" scheme="https://dunwu.github.io/blog/tags/%E8%A7%84%E8%8C%83/"/>
    
      <category term="markdown" scheme="https://dunwu.github.io/blog/tags/markdown/"/>
    
  </entry>
  
  <entry>
    <title>é™æµåŸºæœ¬åŸç†</title>
    <link href="https://dunwu.github.io/blog/design/theory/flow-limit-theory/"/>
    <id>https://dunwu.github.io/blog/design/theory/flow-limit-theory/</id>
    <published>2020-01-20T03:06:00.000Z</published>
    <updated>2020-01-25T14:49:22.053Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é™æµåŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#é™æµåŸºæœ¬åŸç†"></a> é™æµåŸºæœ¬åŸç†</h1><!-- TOC depthFrom:2 depthTo:3 --><ul><li><a href="#%E9%99%90%E6%B5%81%E6%96%B9%E6%B3%95">é™æµæ–¹æ³•</a><ul><li><a href="#%E8%AE%A1%E6%95%B0%E5%99%A8">è®¡æ•°å™¨</a></li><li><a href="#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3">æ»‘åŠ¨çª—å£</a></li><li><a href="#%E4%BB%A4%E7%89%8C%E6%A1%B6token-bucket">ä»¤ç‰Œæ¡¶ï¼ˆToken Bucketï¼‰</a></li><li><a href="#%E6%BC%8F%E6%A1%B6">æ¼æ¡¶</a></li></ul></li><li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li></ul><!-- /TOC --><p>é™æµå¯ä»¥è®¤ä¸ºæ˜¯æœåŠ¡é™çº§çš„ä¸€ç§ã€‚é™æµå°±æ˜¯<strong>é™åˆ¶ç³»ç»Ÿçš„è¾“å…¥å’Œè¾“å‡ºæµé‡å·²è¾¾åˆ°ä¿æŠ¤ç³»ç»Ÿçš„ç›®çš„</strong>ã€‚ä¸€èˆ¬æ¥è¯´ç³»ç»Ÿçš„ååé‡æ˜¯å¯ä»¥è¢«æµ‹ç®—çš„ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œï¼Œä¸€æ—¦è¾¾åˆ°çš„éœ€è¦é™åˆ¶çš„é˜ˆå€¼ï¼Œå°±éœ€è¦é™åˆ¶æµé‡å¹¶é‡‡å–ä¸€äº›æªæ–½ä»¥å®Œæˆé™åˆ¶æµé‡çš„ç›®çš„ã€‚æ¯”å¦‚ï¼šå»¶è¿Ÿå¤„ç†ï¼Œæ‹’ç»å¤„ç†ï¼Œæˆ–è€…éƒ¨åˆ†æ‹’ç»å¤„ç†ç­‰ç­‰ã€‚</p><h2 id="é™æµæ–¹æ³•"><a class="markdownIt-Anchor" href="#é™æµæ–¹æ³•"></a> é™æµæ–¹æ³•</h2><h3 id="è®¡æ•°å™¨"><a class="markdownIt-Anchor" href="#è®¡æ•°å™¨"></a> è®¡æ•°å™¨</h3><p>æ§åˆ¶å•ä½æ—¶é—´çš„è¯·æ±‚æ•°é‡ã€‚ä½¿ç”¨ <code>AtomicInteger</code> è¿›è¡Œç»Ÿè®¡ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ€å¤§è®¿é—®æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> limit = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¿é—®æ—¶é—´å·®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> timeout = <span class="number">1000</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯·æ±‚æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> time;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰è®¡æ•°å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> AtomicInteger reqCount = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">limit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> now = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">if</span> (now &lt; time + timeout) &#123;</span><br><span class="line">            <span class="comment">// å•ä½æ—¶é—´å†…</span></span><br><span class="line">            reqCount.addAndGet(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> reqCount.get() &lt;= limit;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// è¶…å‡ºå•ä½æ—¶é—´</span></span><br><span class="line">            time = now;</span><br><span class="line">            reqCount = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ»‘åŠ¨çª—å£"><a class="markdownIt-Anchor" href="#æ»‘åŠ¨çª—å£"></a> æ»‘åŠ¨çª—å£</h3><p>æ»‘åŠ¨çª—å£æ˜¯å¯¹è®¡æ•°å™¨æ–¹å¼çš„æ”¹è¿›ï¼Œå¢åŠ ä¸€ä¸ªæ—¶é—´ç²’åº¦çš„åº¦é‡å•ä½ ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentLinkedQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeWindow</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ConcurrentLinkedQueue&lt;Long&gt; queue = <span class="keyword">new</span> ConcurrentLinkedQueue&lt;Long&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é—´éš”ç§’æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> seconds;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ€å¤§é™æµ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> max;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TimeWindow</span><span class="params">(<span class="keyword">int</span> max, <span class="keyword">int</span> seconds)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.seconds = seconds;</span><br><span class="line">        <span class="keyword">this</span>.max = max;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ°¸ç»­çº¿ç¨‹æ‰§è¡Œæ¸…ç†queue ä»»åŠ¡</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// ç­‰å¾… é—´éš”ç§’æ•°-1 æ‰§è¡Œæ¸…ç†æ“ä½œ</span></span><br><span class="line">                    Thread.sleep((seconds - <span class="number">1</span>) * <span class="number">1000L</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                clean();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> TimeWindow timeWindow = <span class="keyword">new</span> TimeWindow(<span class="number">10</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æµ‹è¯•3ä¸ªçº¿ç¨‹</span></span><br><span class="line">        IntStream.range(<span class="number">0</span>, <span class="number">3</span>).forEach((i) -&gt; &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">20</span>) * <span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    timeWindow.take();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;).start();</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä»¤ç‰Œï¼Œå¹¶ä¸”æ·»åŠ æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">take</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> size = sizeOfValid();</span><br><span class="line">            <span class="keyword">if</span> (size &gt; max) &#123;</span><br><span class="line">                System.err.println(<span class="string">"è¶…é™"</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (queue) &#123;</span><br><span class="line">                <span class="keyword">if</span> (sizeOfValid() &gt; max) &#123;</span><br><span class="line">                    System.err.println(<span class="string">"è¶…é™"</span>);</span><br><span class="line">                    System.err.println(<span class="string">"queueä¸­æœ‰ "</span> + queue.size() + <span class="string">" æœ€å¤§æ•°é‡ "</span> + max);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">this</span>.queue.offer(System.currentTimeMillis());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"queueä¸­æœ‰ "</span> + queue.size() + <span class="string">" æœ€å¤§æ•°é‡ "</span> + max);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sizeOfValid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Iterator&lt;Long&gt; it = queue.iterator();</span><br><span class="line">        Long ms = System.currentTimeMillis() - seconds * <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">long</span> t = it.next();</span><br><span class="line">            <span class="keyword">if</span> (t &gt; ms) &#123;</span><br><span class="line">                <span class="comment">// åœ¨å½“å‰çš„ç»Ÿè®¡æ—¶é—´èŒƒå›´å†…</span></span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¸…ç†è¿‡æœŸçš„æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Long c = System.currentTimeMillis() - seconds * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">        Long tl = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">while</span> ((tl = queue.peek()) != <span class="keyword">null</span> &amp;&amp; tl &lt; c) &#123;</span><br><span class="line">            System.out.println(<span class="string">"æ¸…ç†æ•°æ®"</span>);</span><br><span class="line">            queue.poll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»¤ç‰Œæ¡¶token-bucket"><a class="markdownIt-Anchor" href="#ä»¤ç‰Œæ¡¶token-bucket"></a> ä»¤ç‰Œæ¡¶ï¼ˆToken Bucketï¼‰</h3><p>è§„å®šå›ºå®šå®¹é‡çš„æ¡¶,token ä»¥å›ºå®šé€Ÿåº¦å¾€æ¡¶å†…å¡«å……,å½“æ¡¶æ»¡æ—¶ token ä¸ä¼šè¢«ç»§ç»­æ”¾å…¥,æ¯è¿‡æ¥ä¸€ä¸ªè¯·æ±‚æŠŠ token ä»æ¡¶ä¸­ç§»é™¤,å¦‚æœæ¡¶ä¸­æ²¡æœ‰ token ä¸èƒ½è¯·æ±‚ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenBucket</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> time;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ€»é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Double total;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * token æ”¾å…¥é€Ÿåº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Double rate;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰æ€»é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Double nowSize;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">limit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> now = System.currentTimeMillis();</span><br><span class="line">        nowSize = Math.min(total, nowSize + (now - time) * rate);</span><br><span class="line">        time = now;</span><br><span class="line">        <span class="keyword">if</span> (nowSize &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// æ¡¶é‡Œæ²¡æœ‰token</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å­˜åœ¨token</span></span><br><span class="line">            nowSize -= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¼æ¡¶"><a class="markdownIt-Anchor" href="#æ¼æ¡¶"></a> æ¼æ¡¶</h3><p>è§„å®šå›ºå®šå®¹é‡çš„æ¡¶ï¼Œæœ‰æ°´è¿›å…¥ï¼Œæœ‰æ°´æµå‡ºã€‚å¯¹äºæµè¿›çš„æ°´æˆ‘ä»¬æ— æ³•ä¼°è®¡è¿›æ¥çš„æ•°é‡ã€é€Ÿåº¦ï¼Œå¯¹äºæµå‡ºçš„æ°´æˆ‘ä»¬å¯ä»¥æ§åˆ¶é€Ÿåº¦ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LeakBucket</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> time;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ€»é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Double total;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ°´æµå‡ºå»çš„é€Ÿåº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Double rate;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰æ€»é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Double nowSize;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">limit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> now = System.currentTimeMillis();</span><br><span class="line">        nowSize = Math.max(<span class="number">0</span>, (nowSize - (now - time) * rate));</span><br><span class="line">        time = now;</span><br><span class="line">        <span class="keyword">if</span> ((nowSize + <span class="number">1</span>) &lt; total) &#123;</span><br><span class="line">            nowSize++;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2><ul><li>ã€Šå¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ã€‹</li><li><a href="https://www.jianshu.com/p/76cc8ba5ca91" target="_blank" rel="noopener">è°ˆè°ˆé™æµç®—æ³•çš„å‡ ç§å®ç°</a></li><li><a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/huifer-how-to-limit-current.md" target="_blank" rel="noopener">å¦‚ä½•é™æµï¼Ÿåœ¨å·¥ä½œä¸­æ˜¯æ€ä¹ˆåšçš„ï¼Ÿè¯´ä¸€ä¸‹å…·ä½“çš„å®ç°ï¼Ÿ</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;é™æµåŸºæœ¬åŸç†&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#é™æµåŸºæœ¬åŸç†&quot;&gt;&lt;/a&gt; é™æµåŸºæœ¬åŸç†&lt;/h1&gt;
&lt;!-- TOC depthFrom:2 depthTo:3 --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#%E9%99%90
      
    
    </summary>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/tags/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/tags/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
      <category term="é™æµ" scheme="https://dunwu.github.io/blog/tags/%E9%99%90%E6%B5%81/"/>
    
  </entry>
  
  <entry>
    <title>æµ‹è¯•æŠ€æœ¯åŸç†</title>
    <link href="https://dunwu.github.io/blog/design/architecture/test-architecture/"/>
    <id>https://dunwu.github.io/blog/design/architecture/test-architecture/</id>
    <published>2019-12-10T09:00:00.000Z</published>
    <updated>2019-12-10T09:44:07.210Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æµ‹è¯•æŠ€æœ¯åŸç†"><a class="markdownIt-Anchor" href="#æµ‹è¯•æŠ€æœ¯åŸç†"></a> æµ‹è¯•æŠ€æœ¯åŸç†</h1><blockquote><p>è½¯ä»¶æµ‹è¯•æè¿°ä¸€ç§ç”¨æ¥ä¿ƒè¿›é‰´å®šè½¯ä»¶çš„æ­£ç¡®æ€§ã€å®Œæ•´æ€§ã€å®‰å…¨æ€§å’Œè´¨é‡çš„è¿‡ç¨‹ã€‚è½¯ä»¶æµ‹è¯•çš„ç»å…¸å®šä¹‰æ˜¯ï¼šåœ¨è§„å®šçš„æ¡ä»¶ä¸‹å¯¹ç¨‹åºè¿›è¡Œæ“ä½œï¼Œä»¥å‘ç°ç¨‹åºé”™è¯¯ï¼Œè¡¡é‡è½¯ä»¶è´¨é‡ï¼Œå¹¶å¯¹å…¶æ˜¯å¦èƒ½æ»¡è¶³è®¾è®¡è¦æ±‚è¿›è¡Œè¯„ä¼°çš„è¿‡ç¨‹ã€‚</p><p>ç°ä»£è½¯ä»¶å¼€å‘é¡¹ç›®ä¸­ï¼Œåˆ†å·¥æ˜ç¡®ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šæœ‰ç ”å‘ã€æµ‹è¯•ã€QA ç­‰è§’è‰²ã€‚ä¸åŒè§’è‰²ç”±äºå…³æ³¨çš„è§†è§’ä¸åŒï¼Œæµ‹è¯•ç›®æ ‡å’Œæµ‹è¯•æ–¹æ³•ä¹Ÿä¸å®Œå…¨ç›¸åŒã€‚æœ¬æ–‡ä¸»è¦ä»ç ”å‘ã€æµ‹è¯•çš„è§†è§’å»è€ƒé‡è½¯ä»¶æµ‹è¯•æŠ€æœ¯ã€‚</p><p>æ³¨æ„ï¼š</p><ul><li>ä¸ºäº†æ–¹ä¾¿ï¼Œåªæœ‰æµ‹è¯•äººå‘˜éœ€è¦å…³æ³¨çš„æµ‹è¯•ç‚¹ç”¨ã€æµ‹è¯•ã€‘æ ‡æ³¨ï¼›</li><li>è€Œåªæœ‰ç ”å‘äººå‘˜éœ€è¦å…³æ³¨çš„æµ‹è¯•ç‚¹ç”¨ã€ç ”å‘ã€‘æ ‡æ³¨ï¼›</li><li>éƒ½éœ€è¦å…³æ³¨çš„æµ‹è¯•ç‚¹åˆ™ä¸ä½œæ ‡æ³¨ã€‚</li></ul></blockquote><h2 id="æµ‹è¯•æ–¹æ³•åˆ†ç±»"><a class="markdownIt-Anchor" href="#æµ‹è¯•æ–¹æ³•åˆ†ç±»"></a> æµ‹è¯•æ–¹æ³•åˆ†ç±»</h2><h3 id="ä»æµ‹è¯•è®¾è®¡æ–¹æ³•åˆ†ç±»"><a class="markdownIt-Anchor" href="#ä»æµ‹è¯•è®¾è®¡æ–¹æ³•åˆ†ç±»"></a> ä»æµ‹è¯•è®¾è®¡æ–¹æ³•åˆ†ç±»</h3><ul><li><strong>é»‘ç›’æµ‹è¯•ã€æµ‹è¯•ã€‘</strong> - æŠŠè½¯ä»¶ç³»ç»Ÿå½“ä½œä¸€ä¸ªâ€œé»‘ç®±â€ï¼Œæ— æ³•äº†è§£æˆ–ä½¿ç”¨ç³»ç»Ÿçš„å†…éƒ¨ç»“æ„åŠçŸ¥è¯†ã€‚ä»è½¯ä»¶çš„è¡Œä¸ºï¼Œè€Œä¸æ˜¯å†…éƒ¨ç»“æ„å‡ºå‘æ¥è®¾è®¡æµ‹è¯•ã€‚</li><li><strong>ç™½ç›’æµ‹è¯•ã€ç ”å‘ã€‘</strong> - è®¾è®¡è€…å¯ä»¥çœ‹åˆ°è½¯ä»¶ç³»ç»Ÿçš„å†…éƒ¨ç»“æ„ï¼Œå¹¶ä¸”ä½¿ç”¨è½¯ä»¶çš„å†…éƒ¨çŸ¥è¯†æ¥æŒ‡å¯¼æµ‹è¯•æ•°æ®åŠæ–¹æ³•çš„é€‰æ‹©ã€‚</li><li><strong>ç°ç›’æµ‹è¯•</strong> - ä»‹äºé»‘ç›’å’Œç™½ç›’ä¹‹é—´ã€‚</li></ul><blockquote><p>å°ç»“ï¼š</p><ul><li>é»‘æ²³æµ‹è¯•é€šå¸¸é’ˆå¯¹çš„æ˜¯è½¯ä»¶çš„è¡Œä¸ºæˆ–åŠŸèƒ½ï¼Œä¸€èˆ¬æ˜¯æµ‹è¯•äººå‘˜ä¸»è¦å…³æ³¨çš„ã€‚</li><li>ç™½ç›’æµ‹è¯•é€šå¸¸åˆ™éœ€è¦å¯¹è½¯ä»¶æœ‰ä¸€å®šç¨‹åº¦çš„äº†è§£ï¼Œä¸€èˆ¬æ˜¯å¼€å‘äººå‘˜æ‰€å…³æ³¨çš„ã€‚</li><li>ç°ç›’æµ‹è¯•é€šå¸¸æ˜¯ä¸ºäº†æµ‹è¯•è½¯ä»¶åœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹çš„è¡¨ç°ï¼Œè€Œéä¸»åœºæ™¯ã€‚</li></ul></blockquote><h3 id="ä»æµ‹è¯•çš„ç›®çš„åˆ†ç±»"><a class="markdownIt-Anchor" href="#ä»æµ‹è¯•çš„ç›®çš„åˆ†ç±»"></a> ä»æµ‹è¯•çš„ç›®çš„åˆ†ç±»</h3><h4 id="åŠŸèƒ½æµ‹è¯•"><a class="markdownIt-Anchor" href="#åŠŸèƒ½æµ‹è¯•"></a> åŠŸèƒ½æµ‹è¯•</h4><ul><li><strong>å•å…ƒæµ‹è¯•ï¼ˆUnit Testï¼‰</strong> - åœ¨æœ€ä½ç²’åº¦çš„åŠŸèƒ½/å‚æ•°ä¸ŠéªŒè¯ç¨‹åºçš„å‡†ç¡®æ€§ï¼Œæ¯”å¦‚æµ‹è¯•ä¸€ä¸ªå‡½æ•°çš„æ­£ç¡®æ€§ã€‚ã€ç ”å‘ã€‘<ul><li>å¸¸ç”¨æŠ€æœ¯ï¼š<a href="https://github.com/junit-team/junit4" target="_blank" rel="noopener"><strong>junit4</strong></a>ã€<a href="https://github.com/junit-team/junit5" target="_blank" rel="noopener"><strong>junit5</strong></a>ã€<a href="https://github.com/mockito/mockito" target="_blank" rel="noopener"><strong>mockito</strong></a>ã€<a href="https://github.com/joel-costigliola/assertj-core" target="_blank" rel="noopener"><strong>assertj-core</strong></a></li></ul></li><li><strong>åŠŸèƒ½æµ‹è¯•ï¼ˆFunctional Testï¼‰</strong> - éªŒè¯æ¨¡å—çš„åŠŸèƒ½ã€‚ã€æµ‹è¯•ã€‘</li><li><strong>é›†æˆæµ‹è¯•ï¼ˆIntegration Testï¼‰</strong> - éªŒè¯å‡ ä¸ªäº’ç›¸æœ‰ä¾èµ–å…³ç³»çš„æ¨¡å—çš„åŠŸèƒ½ã€‚ã€æµ‹è¯•ã€‘</li><li><strong>åœºæ™¯æµ‹è¯•ï¼ˆScenario Testï¼‰</strong>- éªŒè¯å‡ ä¸ªæ¨¡å—æ˜¯å¦èƒ½å®Œæˆä¸€ä¸ªç”¨æˆ·åœºæ™¯ã€‚ã€æµ‹è¯•ã€‘</li><li><strong>ç³»ç»Ÿæµ‹è¯•ï¼ˆSystem Testï¼‰</strong> - å¯¹äºæ•´ä¸ªç³»ç»ŸåŠŸèƒ½çš„æµ‹è¯•ã€‚ã€æµ‹è¯•ã€‘</li><li><strong>Alpha æµ‹è¯•</strong> - è½¯ä»¶æµ‹è¯•äººå‘˜åœ¨çœŸå®ç”¨æˆ·ç¯å¢ƒä¸­å¯¹è½¯ä»¶è¿›è¡Œå…¨é¢çš„æµ‹è¯•ã€‚ã€æµ‹è¯•ã€‘</li><li><strong>Beta æµ‹è¯•</strong> - ä¹Ÿå«å…¬æµ‹ï¼Œæ˜¯çœŸå®çš„ç”¨æˆ·åœ¨çœŸå®çš„ç¯å¢ƒä¸­è¿›è¡Œçš„æµ‹è¯•ã€‚</li></ul><h4 id="éåŠŸèƒ½æµ‹è¯•"><a class="markdownIt-Anchor" href="#éåŠŸèƒ½æµ‹è¯•"></a> éåŠŸèƒ½æµ‹è¯•</h4><ul><li><strong>å‹åŠ›æµ‹è¯•ï¼ˆStress testï¼‰</strong> - éªŒè¯è½¯ä»¶åœ¨è¶…è¿‡è´Ÿè½½è®¾è®¡çš„æƒ…å†µä¸‹ä»èƒ½è¿”å›æ­£ç¡®çš„ç»“æœï¼Œæ²¡æœ‰å´©æºƒ</li><li><strong>è´Ÿè½½æµ‹è¯•ï¼ˆLoad testï¼‰</strong> - æµ‹è¯•è½¯ä»¶åœ¨è´Ÿè½½æƒ…å†µä¸‹èƒ½å¦æ­£å¸¸å·¥ä½œ</li><li><strong>æ€§èƒ½æµ‹è¯•ï¼ˆPerformance testï¼‰</strong> - æµ‹è¯•è½¯ä»¶çš„æ•ˆèƒ½ï¼Œæ˜¯å¦æä¾›æ»¡æ„çš„æœåŠ¡è´¨é‡ã€‚<ul><li>å¸¸ç”¨æŠ€æœ¯ï¼š<a href="https://jmeter.apache.org/" target="_blank" rel="noopener"><strong>JMeter</strong></a>ã€JMHã€‚</li></ul></li><li><strong>è½¯ä»¶è¾…åŠ©åŠŸèƒ½æµ‹è¯•ï¼ˆAccessibility test</strong>ï¼‰ - æµ‹è¯•è½¯ä»¶æ˜¯å¦å‘æ®‹ç–¾ç”¨æˆ·æä¾›è¶³å¤Ÿçš„è¾…åŠ©åŠŸèƒ½</li><li><strong>æœ¬åœ°åŒ–/å…¨çƒåŒ–æµ‹è¯•ï¼ˆLocalization/Globalization</strong>ï¼‰</li><li><strong>å…¼å®¹æ€§æµ‹è¯•ï¼ˆCompatibility Testï¼‰</strong></li><li><strong>é…ç½®æµ‹è¯•ï¼ˆConfiguration Testï¼‰</strong> - æµ‹è¯•è½¯ä»¶åœ¨å„ç§é…ç½®ä¸‹èƒ½å¦æ­£å¸¸å·¥ä½œ</li><li><strong>å¯ç”¨æ€§æµ‹è¯•ï¼ˆUsability Testï¼‰</strong> â€“ æµ‹è¯•è½¯ä»¶æ˜¯å¦å¥½ç”¨</li><li><strong>å®‰å…¨æ€§æµ‹è¯•ï¼ˆSecurity Testï¼‰</strong></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://www.cnblogs.com/TankXiao/archive/2012/02/20/2347016.html" target="_blank" rel="noopener">è½¯ä»¶æµ‹è¯• (ä¸€) è½¯ä»¶æµ‹è¯•æ–¹æ³•å¤§æ±‡æ€»</a></li><li><a href="https://www.xncoding.com/2018/01/07/java/jmh.html" target="_blank" rel="noopener">Javaå¾®åŸºå‡†æµ‹è¯•æ¡†æ¶JMH</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;æµ‹è¯•æŠ€æœ¯åŸç†&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#æµ‹è¯•æŠ€æœ¯åŸç†&quot;&gt;&lt;/a&gt; æµ‹è¯•æŠ€æœ¯åŸç†&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;è½¯ä»¶æµ‹è¯•æè¿°ä¸€ç§ç”¨æ¥ä¿ƒè¿›é‰´å®šè½¯ä»¶çš„æ­£ç¡®æ€§ã€å®Œæ•´æ€§ã€å®‰å…¨æ€§å’Œè´¨é‡çš„è¿‡ç¨‹ã€‚è½¯ä»¶æµ‹è¯•çš„ç»å…¸å®šä¹‰æ˜¯ï¼šåœ¨
      
    
    </summary>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/tags/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/tags/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
      <category term="æµ‹è¯•" scheme="https://dunwu.github.io/blog/tags/%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>design/architecture/system-architecture-interview</title>
    <link href="https://dunwu.github.io/blog/design/architecture/system-architecture-interview/"/>
    <id>https://dunwu.github.io/blog/design/architecture/system-architecture-interview/</id>
    <published>2019-10-25T06:31:53.508Z</published>
    <updated>2019-12-03T11:01:16.940Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç³»ç»Ÿæ¶æ„é¢è¯•"><a class="markdownIt-Anchor" href="#ç³»ç»Ÿæ¶æ„é¢è¯•"></a> ç³»ç»Ÿæ¶æ„é¢è¯•</h1><h2 id="å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿ"></a> å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿï¼Ÿ</h2><h3 id="ç§’æ€ç³»ç»Ÿçš„æŒ‘æˆ˜"><a class="markdownIt-Anchor" href="#ç§’æ€ç³»ç»Ÿçš„æŒ‘æˆ˜"></a> ç§’æ€ç³»ç»Ÿçš„æŒ‘æˆ˜</h3><p>ç§’æ€çš„æ ¸å¿ƒé—®é¢˜å°±æ˜¯<strong>æé«˜å¹¶å‘å¤„ç†</strong>ï¼Œç”±äºç³»ç»Ÿè¦åœ¨ç¬æ—¶æ‰¿å—å¹³æ—¶æ•°åå€ç”šè‡³ä¸Šç™¾å€çš„æµé‡ï¼Œè¿™å¾€å¾€è¶…å‡ºç³»ç»Ÿä¸Šé™ï¼Œå› æ­¤å¤„ç†ç§’æ€çš„<strong>æ ¸å¿ƒæ€è·¯æ˜¯é™æµå’Œç¼“å­˜</strong>ã€‚</p><h3 id="ç§’æ€ç³»ç»Ÿçš„è§£å†³æ€è·¯"><a class="markdownIt-Anchor" href="#ç§’æ€ç³»ç»Ÿçš„è§£å†³æ€è·¯"></a> ç§’æ€ç³»ç»Ÿçš„è§£å†³æ€è·¯</h3><ul><li>ç³»ç»Ÿä¸Šæœ‰æ‹¦æˆªæµé‡ï¼šå°½å¯èƒ½åœ¨ä¸Šæ¸¸æ‹¦æˆªå’Œé™åˆ¶è¯·æ±‚ï¼Œé™åˆ¶æµå…¥åç«¯çš„é‡ï¼Œä¿è¯åç«¯ç³»ç»Ÿæ­£å¸¸ã€‚ å› ä¸ºæ— è®ºå¤šå°‘äººå‚ä¸ç§’æ€ï¼Œå®é™…æˆäº¤å¾€å¾€æ˜¯æœ‰é™çš„ï¼Œè€Œä¸”è¿œå°äºå‚åŠ ç§’æ€çš„äººæ•°ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å‰ç«¯ç³»ç»Ÿè¿›è¡Œæ‹¦æˆªï¼Œé™åˆ¶æœ€ç»ˆæµå…¥ç³»ç»Ÿçš„è¯·æ±‚æ•°é‡ï¼Œæ¥ä¿è¯ç³»ç»Ÿæ­£å¸¸è¿›è¡Œã€‚</li><li>å……åˆ†åˆ©ç”¨ç¼“å­˜ï¼šè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„è¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯ï¼ˆä¸€è¶Ÿç«è½¦å…¶å®åªæœ‰2000å¼ ç¥¨ï¼Œ200wä¸ªäººæ¥ä¹°ï¼Œæœ€å¤š2000ä¸ªäººä¸‹å•æˆåŠŸï¼Œå…¶ä»–äººéƒ½æ˜¯æŸ¥è¯¢åº“å­˜ï¼Œå†™æ¯”ä¾‹åªæœ‰0.1%ï¼Œè¯»æ¯”ä¾‹å 99.9%ï¼‰ï¼Œéå¸¸é€‚åˆä½¿ç”¨ç¼“å­˜ã€‚</li></ul><h3 id="ç§’æ€ç³»ç»Ÿçš„è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#ç§’æ€ç³»ç»Ÿçš„è§£å†³æ–¹æ¡ˆ"></a> ç§’æ€ç³»ç»Ÿçš„è§£å†³æ–¹æ¡ˆ</h3><p>ç§’æ€ç³»ç»Ÿå…·ä½“æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><p><strong>ï¼ˆ1ï¼‰æµè§ˆå™¨ã€å®¢æˆ·ç«¯æ‹¦æˆªé‡å¤è¯·æ±‚</strong></p><ul><li>ç”¨æˆ·ç‚¹å‡»æŸ¥è¯¢æˆ–è´­ä¹°æŒ‰é’®åï¼Œç¦ç”¨æŒ‰é’®ï¼Œé¿å…ç”¨æˆ·é‡å¤æäº¤è¯·æ±‚ã€‚</li><li>JS ä»£ç ä¸­é™åˆ¶ç”¨æˆ·åœ¨é™å®šæ—¶é—´å†…åªå…è®¸æäº¤ä¸€æ¬¡è¯·æ±‚</li></ul><p>åŸºäºæ­¤ï¼Œå¤§éƒ¨åˆ†æµé‡å·²è¢«æ‹¦æˆªã€‚</p><p><strong>ï¼ˆ2ï¼‰åº”ç”¨å±‚æ‹¦æˆªè¯·æ±‚</strong></p><p>æµè§ˆå™¨ã€å®¢æˆ·ç«¯æ‹¦æˆªé‡å¤è¯·æ±‚åªèƒ½åº”ä»˜é€šè¿‡æµè§ˆå™¨è®¿é—®çš„ç”¨æˆ·ã€‚å¦‚æœæœ‰äººé€šè¿‡ç¨‹åºå‘é€ http è¯·æ±‚ï¼Œåˆ™æ— æ³•æ‹¦æˆªã€‚é’ˆå¯¹è¿™ç§æƒ…å†µçš„æ–¹æ¡ˆæ˜¯ï¼š</p><p>ä»¥é¡µé¢ç¼“å­˜çš„æ–¹å¼ï¼Œé’ˆå¯¹çŸ­æ—¶é—´å†…çš„åŒä¸€ä¸ªè®¿é—®æºï¼ˆå¦‚åŒä¸€ä¸ªIPã€åŒä¸€ä¸ª Sessionã€åŒä¸€ä¸ªç”¨æˆ· IDå¤šæ¬¡å‘é€HTTPè¯·æ±‚ï¼‰æˆ–åŒæ ·çš„æŸ¥è¯¢è¯·æ±‚ï¼ˆå¦‚å¤§é‡è¯·æ±‚éƒ½æ˜¯æŸ¥è¯¢æŸç±»å•†å“çš„åº“å­˜ï¼‰ï¼Œéƒ½è¿”å›ç›¸åŒçš„å±•ç¤ºé¡µé¢ã€‚</p><p>å¦‚æ­¤é™æµï¼Œåˆæœ‰å¤§éƒ¨åˆ†çš„æµé‡è¢«æ‹¦æˆª</p><p>ï¼ˆ3ï¼‰æœåŠ¡å±‚è¯·æ±‚æ‹¦æˆªä¸æ•°æ®ç¼“å­˜</p><p>åŠ å…¥æœ‰é»‘å®¢ï¼Œæ§åˆ¶äº†10wå°è‚‰é¸¡ï¼ˆå¹¶ä¸”å‡è®¾ä¹°ç¥¨ä¸éœ€è¦å®åè®¤è¯ï¼‰ï¼Œå‰é¢çš„çš„é™åˆ¶éƒ½ä¸èµ·ä½œç”¨äº†ã€‚è¿™æ—¶åº”è¯¥æ€ä¹ˆåŠï¼Ÿ</p><ul><li><p>è¯»è¯·æ±‚ï¼ˆæŸ¥åº“å­˜ï¼‰ - å¯¹äºè¯»è¯·æ±‚ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜å³å¯ï¼Œä¸€èˆ¬ç¼“å­˜æœåŠ¡å™¨å•æœºå¤„ç†æ¯ç§’10wä¸ªè¯·æ±‚åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p></li><li><p>å†™è¯·æ±‚ï¼ˆä¸‹å•ï¼‰ - ç”±äºæœåŠ¡å±‚æ¸…æ¥šçš„çŸ¥é“åº“å­˜æ•°é‡ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥æ ¹æ®åº“å­˜æ•°é‡è¿›è¡Œé™æµã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯æŠŠæ‰€æœ‰ä¸‹å•è¯·æ±‚éƒ½ä¸¢è¯¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæ¯æ¬¡åªå–æœ‰é™çš„å†™è¯·æ±‚å»æ•°æ®å±‚å¤„ç†ã€‚å½“è¿™äº›å†™è¯·æ±‚å¤„ç†å®Œï¼Œæ›´æ–°ä¸€ä¸‹ç¼“å­˜ä¸­çš„åº“å­˜æ•°ï¼Œå†å»å–ä¸‹ä¸€æ‰¹å†™è¯·æ±‚ï¼Œå¦‚æœåº“å­˜æ•°ä¸å¤Ÿï¼Œåˆ™æ¶ˆæ¯é˜Ÿåˆ—çš„å†™è¯·æ±‚å…¨éƒ¨è¿”å›&quot;å·²å”®ç½„&quot;çš„ç»“æœã€‚</p></li></ul><blockquote><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.zhihu.com/question/54895548/answer/146924420" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡ç§’æ€ç³»ç»Ÿï¼Ÿ - é˜¿é‡Œäº‘äº‘æ –ç¤¾åŒºçš„å›ç­” - çŸ¥ä¹</a></li><li><a href="https://www.zhihu.com/question/54895548/answer/259218876" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡ç§’æ€ç³»ç»Ÿï¼Ÿ - ç½‘æ˜“äº‘çš„å›ç­” - çŸ¥ä¹</a></li></ul></blockquote><h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://www.zhihu.com/question/54895548/answer/146924420" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡ç§’æ€ç³»ç»Ÿï¼Ÿ - é˜¿é‡Œäº‘äº‘æ –ç¤¾åŒºçš„å›ç­” - çŸ¥ä¹</a></li><li><a href="https://www.zhihu.com/question/54895548/answer/259218876" target="_blank" rel="noopener">å¦‚ä½•è®¾è®¡ç§’æ€ç³»ç»Ÿï¼Ÿ - ç½‘æ˜“äº‘çš„å›ç­” - çŸ¥ä¹</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ç³»ç»Ÿæ¶æ„é¢è¯•&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#ç³»ç»Ÿæ¶æ„é¢è¯•&quot;&gt;&lt;/a&gt; ç³»ç»Ÿæ¶æ„é¢è¯•&lt;/h1&gt;
&lt;h2 id=&quot;å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿ&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>bigdata/README</title>
    <link href="https://dunwu.github.io/blog/bigdata/README/"/>
    <id>https://dunwu.github.io/blog/bigdata/README/</id>
    <published>2019-10-25T06:31:53.460Z</published>
    <updated>2019-10-21T09:38:25.519Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¤§æ•°æ®"><a class="markdownIt-Anchor" href="#å¤§æ•°æ®"></a> å¤§æ•°æ®</h1><h2 id="çŸ¥è¯†ç‚¹"><a class="markdownIt-Anchor" href="#çŸ¥è¯†ç‚¹"></a> ğŸ“ çŸ¥è¯†ç‚¹</h2><ul><li><a href="MapReduce.md">MapReduce</a></li><li><a href="HDFS.md">HDFS</a></li><li><a href="YARN.md">YARN</a></li><li><a href="hbase">HBase</a><ul><li><a href="hbase/hbase-cli.md">HBase å‘½ä»¤</a></li><li><a href="hbase/hbase-ops.md">HBase é…ç½®</a></li></ul></li></ul><h2 id="å­¦ä¹ èµ„æº"><a class="markdownIt-Anchor" href="#å­¦ä¹ èµ„æº"></a> ğŸ“š å­¦ä¹ èµ„æº</h2><h3 id="ä¹¦"><a class="markdownIt-Anchor" href="#ä¹¦"></a> ä¹¦</h3><p><a href="https://book.douban.com/subject/6523762/" target="_blank" rel="noopener">Hadoop æƒå¨æŒ‡å—</a></p><h2 id="ä¼ é€é—¨"><a class="markdownIt-Anchor" href="#ä¼ é€é—¨"></a> ğŸšª ä¼ é€é—¨</h2><p>| <a href="https://github.com/dunwu/blog" target="_blank" rel="noopener">å›é¦–é </a> |</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å¤§æ•°æ®&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#å¤§æ•°æ®&quot;&gt;&lt;/a&gt; å¤§æ•°æ®&lt;/h1&gt;
&lt;h2 id=&quot;çŸ¥è¯†ç‚¹&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#çŸ¥è¯†ç‚¹&quot;&gt;&lt;/a&gt; ğŸ“ çŸ¥è¯†ç‚¹&lt;/h2&gt;
&lt;
      
    
    </summary>
    
    
    
      <category term="hide" scheme="https://dunwu.github.io/blog/tags/hide/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†åº“åˆ†è¡¨åŸºæœ¬åŸç†</title>
    <link href="https://dunwu.github.io/blog/design/theory/sharding-theory/"/>
    <id>https://dunwu.github.io/blog/design/theory/sharding-theory/</id>
    <published>2019-10-16T12:54:00.000Z</published>
    <updated>2019-11-27T07:59:25.224Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆ†åº“åˆ†è¡¨åŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#åˆ†åº“åˆ†è¡¨åŸºæœ¬åŸç†"></a> åˆ†åº“åˆ†è¡¨åŸºæœ¬åŸç†</h1><p>åˆ†ç‰‡ï¼ˆShardingï¼‰çš„åŸºæœ¬æ€æƒ³å°±è¦æŠŠä¸€ä¸ªæ•°æ®åº“åˆ‡åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œå­˜å‚¨åœ¨ä¸åŒçš„æ•°æ®åº“(server)ä¸Šï¼Œä»è€Œç¼“è§£å•ä¸€æ•°æ®åº“çš„æ€§èƒ½é—®é¢˜ã€‚</p><h2 id="1-æ•°æ®åˆ†ç‰‡"><a class="markdownIt-Anchor" href="#1-æ•°æ®åˆ†ç‰‡"></a> 1. æ•°æ®åˆ†ç‰‡</h2><p>æ•°æ®åˆ†ç‰‡æŒ‡æŒ‰ç…§æŸä¸ªç»´åº¦å°†å­˜æ”¾åœ¨å•ä¸€æ•°æ®åº“ä¸­çš„æ•°æ®åˆ†æ•£åœ°å­˜æ”¾è‡³å¤šä¸ªæ•°æ®åº“æˆ–è¡¨ä¸­ä»¥è¾¾åˆ°æå‡æ€§èƒ½ç“¶é¢ˆä»¥åŠå¯ç”¨æ€§çš„æ•ˆæœã€‚ æ•°æ®åˆ†ç‰‡çš„æœ‰æ•ˆæ‰‹æ®µæ˜¯å¯¹å…³ç³»å‹æ•°æ®åº“è¿›è¡Œåˆ†åº“å’Œåˆ†è¡¨ã€‚åˆ†åº“å’Œåˆ†è¡¨å‡å¯ä»¥æœ‰æ•ˆçš„é¿å…ç”±æ•°æ®é‡è¶…è¿‡å¯æ‰¿å—é˜ˆå€¼è€Œäº§ç”Ÿçš„æŸ¥è¯¢ç“¶é¢ˆã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œåˆ†åº“è¿˜èƒ½å¤Ÿç”¨äºæœ‰æ•ˆçš„åˆ†æ•£å¯¹æ•°æ®åº“å•ç‚¹çš„è®¿é—®é‡ï¼›åˆ†è¡¨è™½ç„¶æ— æ³•ç¼“è§£æ•°æ®åº“å‹åŠ›ï¼Œä½†å´èƒ½å¤Ÿæä¾›å°½é‡å°†åˆ†å¸ƒå¼äº‹åŠ¡è½¬åŒ–ä¸ºæœ¬åœ°äº‹åŠ¡çš„å¯èƒ½ï¼Œä¸€æ—¦æ¶‰åŠåˆ°è·¨åº“çš„æ›´æ–°æ“ä½œï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å¾€å¾€ä¼šä½¿é—®é¢˜å˜å¾—å¤æ‚ã€‚ ä½¿ç”¨å¤šä¸»å¤šä»çš„åˆ†ç‰‡æ–¹å¼ï¼Œå¯ä»¥æœ‰æ•ˆçš„é¿å…æ•°æ®å•ç‚¹ï¼Œä»è€Œæå‡æ•°æ®æ¶æ„çš„å¯ç”¨æ€§ã€‚</p><p>é€šè¿‡åˆ†åº“å’Œåˆ†è¡¨è¿›è¡Œæ•°æ®çš„æ‹†åˆ†æ¥ä½¿å¾—å„ä¸ªè¡¨çš„æ•°æ®é‡ä¿æŒåœ¨é˜ˆå€¼ä»¥ä¸‹ï¼Œä»¥åŠå¯¹æµé‡è¿›è¡Œç–å¯¼åº”å¯¹é«˜è®¿é—®é‡ï¼Œæ˜¯åº”å¯¹é«˜å¹¶å‘å’Œæµ·é‡æ•°æ®ç³»ç»Ÿçš„æœ‰æ•ˆæ‰‹æ®µã€‚ æ•°æ®åˆ†ç‰‡çš„æ‹†åˆ†æ–¹å¼åˆåˆ†ä¸ºå‚ç›´åˆ†ç‰‡å’Œæ°´å¹³åˆ†ç‰‡ã€‚</p><h3 id="11-å‚ç›´åˆ†ç‰‡"><a class="markdownIt-Anchor" href="#11-å‚ç›´åˆ†ç‰‡"></a> 1.1. å‚ç›´åˆ†ç‰‡</h3><p><strong>æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†çš„æ–¹å¼ç§°ä¸ºå‚ç›´åˆ†ç‰‡</strong>ï¼Œåˆç§°ä¸ºçºµå‘æ‹†åˆ†ï¼Œå®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ä¸“åº“ä¸“ç”¨ã€‚</p><p>åœ¨æ‹†åˆ†ä¹‹å‰ï¼Œä¸€ä¸ªæ•°æ®åº“ç”±å¤šä¸ªæ•°æ®è¡¨æ„æˆï¼Œæ¯ä¸ªè¡¨å¯¹åº”ç€ä¸åŒçš„ä¸šåŠ¡ã€‚è€Œæ‹†åˆ†ä¹‹åï¼Œåˆ™æ˜¯<strong>æŒ‰ç…§ä¸šåŠ¡å°†è¡¨è¿›è¡Œå½’ç±»ï¼Œåˆ†å¸ƒåˆ°ä¸åŒçš„æ•°æ®åº“ä¸­</strong>ï¼Œä»è€Œå°†å‹åŠ›åˆ†æ•£è‡³ä¸åŒçš„æ•°æ®åº“ã€‚ä¸‹å›¾å±•ç¤ºäº†æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œå°†ç”¨æˆ·è¡¨å’Œè®¢å•è¡¨å‚ç›´åˆ†ç‰‡åˆ°ä¸åŒçš„æ•°æ®åº“çš„æ–¹æ¡ˆã€‚</p><p><img src="https://shardingsphere.apache.org/document/current/img/sharding/vertical_sharding.png" alt="å‚ç›´åˆ†ç‰‡" /></p><p>å‚ç›´åˆ†ç‰‡å¾€å¾€éœ€è¦å¯¹æ¶æ„å’Œè®¾è®¡è¿›è¡Œè°ƒæ•´ã€‚é€šå¸¸æ¥è®²ï¼Œæ˜¯æ¥ä¸åŠåº”å¯¹äº’è”ç½‘ä¸šåŠ¡éœ€æ±‚å¿«é€Ÿå˜åŒ–çš„ï¼›è€Œä¸”ï¼Œå®ƒä¹Ÿå¹¶æ— æ³•çœŸæ­£çš„è§£å†³å•ç‚¹ç“¶é¢ˆã€‚<strong>å‚ç›´æ‹†åˆ†å¯ä»¥ç¼“è§£æ•°æ®é‡å’Œè®¿é—®é‡å¸¦æ¥çš„é—®é¢˜ï¼Œä½†æ— æ³•æ ¹æ²»ã€‚å¦‚æœå‚ç›´æ‹†åˆ†ä¹‹åï¼Œè¡¨ä¸­çš„æ•°æ®é‡ä¾ç„¶è¶…è¿‡å•èŠ‚ç‚¹æ‰€èƒ½æ‰¿è½½çš„é˜ˆå€¼ï¼Œåˆ™éœ€è¦æ°´å¹³åˆ†ç‰‡æ¥è¿›ä¸€æ­¥å¤„ç†</strong>ã€‚</p><h3 id="12-æ°´å¹³åˆ†ç‰‡"><a class="markdownIt-Anchor" href="#12-æ°´å¹³åˆ†ç‰‡"></a> 1.2. æ°´å¹³åˆ†ç‰‡</h3><p>æ°´å¹³åˆ†ç‰‡åˆç§°ä¸ºæ¨ªå‘æ‹†åˆ†ã€‚ ç›¸å¯¹äºå‚ç›´åˆ†ç‰‡ï¼Œ<strong>æ°´å¹³åˆ†ç‰‡ä¸å†å°†æ•°æ®æ ¹æ®ä¸šåŠ¡é€»è¾‘åˆ†ç±»ï¼Œè€Œæ˜¯é€šè¿‡æŸä¸ªå­—æ®µï¼ˆæˆ–æŸå‡ ä¸ªå­—æ®µï¼‰ï¼Œæ ¹æ®æŸç§è§„åˆ™å°†æ•°æ®åˆ†æ•£è‡³å¤šä¸ªåº“æˆ–è¡¨ä¸­ï¼Œæ¯ä¸ªåˆ†ç‰‡ä»…åŒ…å«æ•°æ®çš„ä¸€éƒ¨åˆ†</strong>ã€‚ ä¾‹å¦‚ï¼šæ ¹æ®ä¸»é”®åˆ†ç‰‡ï¼Œå¶æ•°ä¸»é”®çš„è®°å½•æ”¾å…¥ 0 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œå¥‡æ•°ä¸»é”®çš„è®°å½•æ”¾å…¥ 1 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://shardingsphere.apache.org/document/current/img/sharding/horizontal_sharding.png" alt="æ°´å¹³åˆ†ç‰‡" /></p><p><strong>æ°´å¹³åˆ†ç‰‡ä»ç†è®ºä¸Šçªç ´äº†å•æœºæ•°æ®é‡å¤„ç†çš„ç“¶é¢ˆï¼Œå¹¶ä¸”æ‰©å±•ç›¸å¯¹è‡ªç”±ï¼Œæ˜¯åˆ†åº“åˆ†è¡¨çš„æ ‡å‡†è§£å†³æ–¹æ¡ˆ</strong>ã€‚</p><h2 id="2-åˆ†åº“åˆ†è¡¨çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#2-åˆ†åº“åˆ†è¡¨çš„é—®é¢˜"></a> 2. åˆ†åº“åˆ†è¡¨çš„é—®é¢˜</h2><h3 id="21-äº‹åŠ¡é—®é¢˜"><a class="markdownIt-Anchor" href="#21-äº‹åŠ¡é—®é¢˜"></a> 2.1. äº‹åŠ¡é—®é¢˜</h3><p>è§£å†³äº‹åŠ¡é—®é¢˜ç›®å‰æœ‰ä¸¤ç§å¯è¡Œçš„æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼äº‹åŠ¡å’Œé€šè¿‡åº”ç”¨ç¨‹åºä¸æ•°æ®åº“å…±åŒæ§åˆ¶å®ç°äº‹åŠ¡ä¸‹é¢å¯¹ä¸¤å¥—æ–¹æ¡ˆè¿›è¡Œä¸€ä¸ªç®€å•çš„å¯¹æ¯”ã€‚</p><ul><li>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡<ul><li>ä¼˜ç‚¹ï¼šäº¤ç”±æ•°æ®åº“ç®¡ç†ï¼Œç®€å•æœ‰æ•ˆ</li><li>ç¼ºç‚¹ï¼šæ€§èƒ½ä»£ä»·é«˜ï¼Œç‰¹åˆ«æ˜¯ sharding è¶Šæ¥è¶Šå¤šæ—¶</li></ul></li><li>æ–¹æ¡ˆäºŒï¼šç”±åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“å…±åŒæ§åˆ¶<ul><li>åŸç†ï¼šå°†ä¸€ä¸ªè·¨å¤šä¸ªæ•°æ®åº“çš„åˆ†å¸ƒå¼äº‹åŠ¡åˆ†æ‹†æˆå¤šä¸ªä»…å¤„äºå•ä¸ªæ•°æ®åº“ä¸Šé¢çš„å°äº‹åŠ¡ï¼Œå¹¶é€šè¿‡åº”ç”¨ç¨‹åºæ¥æ€»æ§å„ä¸ªå°äº‹åŠ¡ã€‚</li><li>ä¼˜ç‚¹ï¼šæ€§èƒ½ä¸Šæœ‰ä¼˜åŠ¿</li><li>ç¼ºç‚¹ï¼šéœ€è¦åº”ç”¨ç¨‹åºåœ¨äº‹åŠ¡æ§åˆ¶ä¸Šåšçµæ´»è®¾è®¡ã€‚å¦‚æœä½¿ç”¨ äº†<a href="http://lib.csdn.net/base/javaee" target="_blank" rel="noopener">spring</a>çš„äº‹åŠ¡ç®¡ç†ï¼Œæ”¹åŠ¨èµ·æ¥ä¼šé¢ä¸´ä¸€å®šçš„å›°éš¾ã€‚</li></ul></li></ul><p>è·¨åº“äº‹åŠ¡ä¹Ÿæ˜¯åˆ†å¸ƒå¼çš„æ•°æ®åº“é›†ç¾¤è¦é¢å¯¹çš„æ£˜æ‰‹äº‹æƒ…ã€‚ åˆç†é‡‡ç”¨åˆ†è¡¨ï¼Œå¯ä»¥åœ¨é™ä½å•è¡¨æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼Œå°½é‡ä½¿ç”¨æœ¬åœ°äº‹åŠ¡ï¼Œå–„äºä½¿ç”¨åŒåº“ä¸åŒè¡¨å¯æœ‰æ•ˆé¿å…åˆ†å¸ƒå¼äº‹åŠ¡å¸¦æ¥çš„éº»çƒ¦ã€‚åœ¨ä¸èƒ½é¿å…è·¨åº“äº‹åŠ¡çš„åœºæ™¯ï¼Œæœ‰äº›ä¸šåŠ¡ä»ç„¶éœ€è¦ä¿æŒäº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚ è€ŒåŸºäº XA çš„åˆ†å¸ƒå¼äº‹åŠ¡ç”±äºåœ¨å¹¶å‘åº¦é«˜çš„åœºæ™¯ä¸­æ€§èƒ½æ— æ³•æ»¡è¶³éœ€è¦ï¼Œå¹¶æœªè¢«äº’è”ç½‘å·¨å¤´å¤§è§„æ¨¡ä½¿ç”¨ï¼Œä»–ä»¬å¤§å¤šé‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§çš„æŸ”æ€§äº‹åŠ¡ä»£æ›¿å¼ºä¸€è‡´äº‹åŠ¡ã€‚</p><h3 id="22-è·¨èŠ‚ç‚¹-join-çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#22-è·¨èŠ‚ç‚¹-join-çš„é—®é¢˜"></a> 2.2. è·¨èŠ‚ç‚¹ Join çš„é—®é¢˜</h3><p>åªè¦æ˜¯è¿›è¡Œåˆ‡åˆ†ï¼Œè·¨èŠ‚ç‚¹ Join çš„é—®é¢˜æ˜¯ä¸å¯é¿å…çš„ã€‚ä½†æ˜¯è‰¯å¥½çš„è®¾è®¡å’Œåˆ‡åˆ†å´å¯ä»¥å‡å°‘æ­¤ç±»æƒ…å†µçš„å‘ç”Ÿã€‚è§£å†³è¿™ä¸€é—®é¢˜çš„æ™®éåšæ³•æ˜¯åˆ†ä¸¤æ¬¡æŸ¥è¯¢å®ç°ã€‚åœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœé›†ä¸­æ‰¾å‡ºå…³è”æ•°æ®çš„ idï¼Œæ ¹æ®è¿™äº› id å‘èµ·ç¬¬äºŒæ¬¡è¯·æ±‚å¾—åˆ°å…³è”æ•°æ®ã€‚</p><h3 id="23-è·¨èŠ‚ç‚¹çš„-countorder-bygroup-by-ä»¥åŠèšåˆå‡½æ•°é—®é¢˜"><a class="markdownIt-Anchor" href="#23-è·¨èŠ‚ç‚¹çš„-countorder-bygroup-by-ä»¥åŠèšåˆå‡½æ•°é—®é¢˜"></a> 2.3. è·¨èŠ‚ç‚¹çš„ count,order by,group by ä»¥åŠèšåˆå‡½æ•°é—®é¢˜</h3><p>è¿™äº›æ˜¯ä¸€ç±»é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬éƒ½éœ€è¦åŸºäºå…¨éƒ¨æ•°æ®é›†åˆè¿›è¡Œè®¡ç®—ã€‚å¤šæ•°çš„ä»£ç†éƒ½ä¸ä¼šè‡ªåŠ¨å¤„ç†åˆå¹¶å·¥ä½œã€‚è§£å†³æ–¹æ¡ˆï¼šä¸è§£å†³è·¨èŠ‚ç‚¹ join é—®é¢˜çš„ç±»ä¼¼ï¼Œåˆ†åˆ«åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šå¾—åˆ°ç»“æœååœ¨åº”ç”¨ç¨‹åºç«¯è¿›è¡Œåˆå¹¶ã€‚å’Œ join ä¸åŒçš„æ˜¯æ¯ä¸ªç»“ç‚¹çš„æŸ¥è¯¢å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œå› æ­¤å¾ˆå¤šæ—¶å€™å®ƒçš„é€Ÿåº¦è¦æ¯”å•ä¸€å¤§è¡¨å¿«å¾ˆå¤šã€‚ä½†å¦‚æœç»“æœé›†å¾ˆå¤§ï¼Œå¯¹åº”ç”¨ç¨‹åºå†…å­˜çš„æ¶ˆè€—æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p><h3 id="24-æ•°æ®è¿ç§»å®¹é‡è§„åˆ’æ‰©å®¹ç­‰é—®é¢˜"><a class="markdownIt-Anchor" href="#24-æ•°æ®è¿ç§»å®¹é‡è§„åˆ’æ‰©å®¹ç­‰é—®é¢˜"></a> 2.4. æ•°æ®è¿ç§»ï¼Œå®¹é‡è§„åˆ’ï¼Œæ‰©å®¹ç­‰é—®é¢˜</h3><p>æ¥è‡ªæ·˜å®ç»¼åˆä¸šåŠ¡å¹³å°å›¢é˜Ÿï¼Œå®ƒåˆ©ç”¨å¯¹ 2 çš„å€æ•°å–ä½™å…·æœ‰å‘å‰å…¼å®¹çš„ç‰¹æ€§ï¼ˆå¦‚å¯¹ 4 å–ä½™å¾— 1 çš„æ•°å¯¹ 2 å–ä½™ä¹Ÿæ˜¯ 1ï¼‰æ¥åˆ†é…æ•°æ®ï¼Œé¿å…äº†<strong>è¡Œçº§åˆ«çš„æ•°æ®è¿ç§»</strong>ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è¿›è¡Œ<strong>è¡¨çº§åˆ«çš„è¿ç§»</strong>ï¼ŒåŒæ—¶å¯¹æ‰©å®¹è§„æ¨¡å’Œåˆ†è¡¨æ•°é‡éƒ½æœ‰é™åˆ¶ã€‚æ€»å¾—æ¥è¯´ï¼Œè¿™äº›æ–¹æ¡ˆéƒ½ä¸æ˜¯ååˆ†çš„ç†æƒ³ï¼Œå¤šå¤šå°‘å°‘éƒ½å­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œè¿™ä¹Ÿä»ä¸€ä¸ªä¾§é¢åæ˜ å‡ºäº† Sharding æ‰©å®¹çš„éš¾åº¦ã€‚</p><h3 id="25-id-é—®é¢˜"><a class="markdownIt-Anchor" href="#25-id-é—®é¢˜"></a> 2.5. ID é—®é¢˜</h3><p>ä¸€æ—¦æ•°æ®åº“è¢«åˆ‡åˆ†åˆ°å¤šä¸ªç‰©ç†ç»“ç‚¹ä¸Šï¼Œæˆ‘ä»¬å°†ä¸èƒ½å†ä¾èµ–æ•°æ®åº“è‡ªèº«çš„ä¸»é”®ç”Ÿæˆæœºåˆ¶ã€‚ä¸€æ–¹é¢ï¼ŒæŸä¸ªåˆ†åŒºæ•°æ®åº“è‡ªç”Ÿæˆçš„ ID æ— æ³•ä¿è¯åœ¨å…¨å±€ä¸Šæ˜¯å”¯ä¸€çš„ï¼›å¦ä¸€æ–¹é¢ï¼Œåº”ç”¨ç¨‹åºåœ¨æ’å…¥æ•°æ®ä¹‹å‰éœ€è¦å…ˆè·å¾— ID,ä»¥ä¾¿è¿›è¡Œ SQL è·¯ç”±. ä¸€äº›å¸¸è§çš„ä¸»é”®ç”Ÿæˆç­–ç•¥</p><h4 id="251-uuid"><a class="markdownIt-Anchor" href="#251-uuid"></a> 2.5.1. UUID</h4><p>ä½¿ç”¨ UUID ä½œä¸»é”®æ˜¯æœ€ç®€å•çš„æ–¹æ¡ˆï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯éå¸¸æ˜æ˜¾çš„ã€‚ç”±äº UUID éå¸¸çš„é•¿ï¼Œé™¤å ç”¨å¤§é‡å­˜å‚¨ç©ºé—´å¤–ï¼Œæœ€ä¸»è¦çš„é—®é¢˜æ˜¯åœ¨ç´¢å¼•ä¸Šï¼Œåœ¨å»ºç«‹ç´¢å¼•å’ŒåŸºäºç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶éƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚</p><h4 id="252-ç»“åˆæ•°æ®åº“ç»´æŠ¤ä¸€ä¸ª-sequence-è¡¨"><a class="markdownIt-Anchor" href="#252-ç»“åˆæ•°æ®åº“ç»´æŠ¤ä¸€ä¸ª-sequence-è¡¨"></a> 2.5.2. ç»“åˆæ•°æ®åº“ç»´æŠ¤ä¸€ä¸ª Sequence è¡¨</h4><p>æ­¤æ–¹æ¡ˆçš„æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨æ•°æ®åº“ä¸­å»ºç«‹ä¸€ä¸ª Sequence è¡¨ï¼Œè¡¨çš„ç»“æ„ç±»ä¼¼äºï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`SEQUENCE`</span> (</span><br><span class="line">    <span class="string">`table_name`</span> <span class="built_in">varchar</span>(<span class="number">18</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`nextid`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`table_name`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span></span><br></pre></td></tr></table></figure><p>æ¯å½“éœ€è¦ä¸ºæŸä¸ªè¡¨çš„æ–°çºªå½•ç”Ÿæˆ ID æ—¶å°±ä» Sequence è¡¨ä¸­å–å‡ºå¯¹åº”è¡¨çš„ nextid,å¹¶å°† nextid çš„å€¼åŠ  1 åæ›´æ–°åˆ°æ•°æ®åº“ä¸­ä»¥å¤‡ä¸‹æ¬¡ä½¿ç”¨ã€‚æ­¤æ–¹æ¡ˆä¹Ÿè¾ƒç®€å•ï¼Œä½†ç¼ºç‚¹åŒæ ·æ˜æ˜¾ï¼šç”±äºæ‰€æœ‰æ’å…¥ä»»ä½•éƒ½éœ€è¦è®¿é—®è¯¥è¡¨ï¼Œè¯¥è¡¨å¾ˆå®¹æ˜“æˆä¸ºç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆï¼ŒåŒæ—¶å®ƒä¹Ÿå­˜åœ¨å•ç‚¹é—®é¢˜ï¼Œä¸€æ—¦è¯¥è¡¨æ•°æ®åº“å¤±æ•ˆï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºå°†æ— æ³•å·¥ä½œã€‚æœ‰äººæå‡ºä½¿ç”¨ Master-Slave è¿›è¡Œä¸»ä»åŒæ­¥ï¼Œä½†è¿™ä¹Ÿåªèƒ½è§£å†³å•ç‚¹é—®é¢˜ï¼Œå¹¶ä¸èƒ½è§£å†³è¯»å†™æ¯”ä¸º 1:1 çš„è®¿é—®å‹åŠ›é—®é¢˜ã€‚</p><h4 id="253-twitter-çš„åˆ†å¸ƒå¼è‡ªå¢-id-ç®—æ³•-snowflake"><a class="markdownIt-Anchor" href="#253-twitter-çš„åˆ†å¸ƒå¼è‡ªå¢-id-ç®—æ³•-snowflake"></a> 2.5.3. <a href="http://blog.sina.com.cn/s/blog_6b7c2e660102vbi2.html" target="_blank" rel="noopener">Twitter çš„åˆ†å¸ƒå¼è‡ªå¢ ID ç®—æ³• Snowflake</a></h4><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œéœ€è¦ç”Ÿæˆå…¨å±€ UID çš„åœºåˆè¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œtwitter çš„ snowflake è§£å†³äº†è¿™ç§éœ€æ±‚ï¼Œå®ç°ä¹Ÿè¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œé™¤å»é…ç½®ä¿¡æ¯ï¼Œæ ¸å¿ƒä»£ç å°±æ˜¯æ¯«ç§’çº§æ—¶é—´ 41 ä½ æœºå™¨ ID 10 ä½ æ¯«ç§’å†…åºåˆ— 12 ä½ã€‚</p><ul><li>10â€”0000000000 0000000000 0000000000 0000000000 0 â€” 00000 â€”00000 â€”000000000000 åœ¨ä¸Šé¢çš„å­—ç¬¦ä¸²ä¸­ï¼Œç¬¬ä¸€ä½ä¸ºæœªä½¿ç”¨ï¼ˆå®é™…ä¸Šä¹Ÿå¯ä½œä¸º long çš„ç¬¦å·ä½ï¼‰ï¼Œæ¥ä¸‹æ¥çš„ 41 ä½ä¸ºæ¯«ç§’çº§æ—¶é—´ï¼Œç„¶å 5 ä½ datacenter æ ‡è¯†ä½ï¼Œ5 ä½æœºå™¨ IDï¼ˆå¹¶ä¸ç®—æ ‡è¯†ç¬¦ï¼Œå®é™…æ˜¯ä¸ºçº¿ç¨‹æ ‡è¯†ï¼‰ï¼Œç„¶å 12 ä½è¯¥æ¯«ç§’å†…çš„å½“å‰æ¯«ç§’å†…çš„è®¡æ•°ï¼ŒåŠ èµ·æ¥åˆšå¥½ 64 ä½ï¼Œä¸ºä¸€ä¸ª Long å‹ã€‚</li></ul><p>è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œæ•´ä½“ä¸ŠæŒ‰ç…§æ—¶é—´è‡ªå¢æ’åºï¼Œå¹¶ä¸”æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå†…ä¸ä¼šäº§ç”Ÿ ID ç¢°æ’ï¼ˆç”± datacenter å’Œæœºå™¨ ID ä½œåŒºåˆ†ï¼‰ï¼Œå¹¶ä¸”æ•ˆç‡è¾ƒé«˜ï¼Œç»æµ‹è¯•ï¼Œsnowflake æ¯ç§’èƒ½å¤Ÿäº§ç”Ÿ 26 ä¸‡ ID å·¦å³ï¼Œå®Œå…¨æ»¡è¶³éœ€è¦ã€‚</p><h3 id="26-è·¨åˆ†ç‰‡çš„æ’åºåˆ†é¡µ"><a class="markdownIt-Anchor" href="#26-è·¨åˆ†ç‰‡çš„æ’åºåˆ†é¡µ"></a> 2.6. è·¨åˆ†ç‰‡çš„æ’åºåˆ†é¡µ</h3><p>ä¸€èˆ¬æ¥è®²ï¼Œåˆ†é¡µæ—¶éœ€è¦æŒ‰ç…§æŒ‡å®šå­—æ®µè¿›è¡Œæ’åºã€‚å½“æ’åºå­—æ®µå°±æ˜¯åˆ†ç‰‡å­—æ®µçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡åˆ†ç‰‡è§„åˆ™å¯ä»¥æ¯”è¾ƒå®¹æ˜“å®šä½åˆ°æŒ‡å®šçš„åˆ†ç‰‡ï¼Œè€Œå½“æ’åºå­—æ®µéåˆ†ç‰‡å­—æ®µçš„æ—¶å€™ï¼Œæƒ…å†µå°±ä¼šå˜å¾—æ¯”è¾ƒå¤æ‚äº†ã€‚ä¸ºäº†æœ€ç»ˆç»“æœçš„å‡†ç¡®æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸åŒçš„åˆ†ç‰‡èŠ‚ç‚¹ä¸­å°†æ•°æ®è¿›è¡Œæ’åºå¹¶è¿”å›ï¼Œå¹¶å°†ä¸åŒåˆ†ç‰‡è¿”å›çš„ç»“æœé›†è¿›è¡Œæ±‡æ€»å’Œå†æ¬¡æ’åºï¼Œæœ€åå†è¿”å›ç»™ç”¨æˆ·ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/3710706-925381b9a478c8df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/640/format/webp" alt="img" /></p><p>ä¸Šé¢å›¾ä¸­æ‰€æè¿°çš„åªæ˜¯æœ€ç®€å•çš„ä¸€ç§æƒ…å†µï¼ˆå–ç¬¬ä¸€é¡µæ•°æ®ï¼‰ï¼Œçœ‹èµ·æ¥å¯¹æ€§èƒ½çš„å½±å“å¹¶ä¸å¤§ã€‚ä½†æ˜¯ï¼Œå¦‚æœæƒ³å–å‡ºç¬¬ 10 é¡µæ•°æ®ï¼Œæƒ…å†µåˆå°†å˜å¾—å¤æ‚å¾ˆå¤šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/3710706-9a7cfbdb95bb9b70.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/640/format/webp" alt="img" /></p><p>æœ‰äº›è¯»è€…å¯èƒ½å¹¶ä¸å¤ªç†è§£ï¼Œä¸ºä»€ä¹ˆä¸èƒ½åƒè·å–ç¬¬ä¸€é¡µæ•°æ®é‚£æ ·ç®€å•å¤„ç†ï¼ˆæ’åºå–å‡ºå‰ 10 æ¡å†åˆå¹¶ã€æ’åºï¼‰ã€‚å…¶å®å¹¶ä¸éš¾ç†è§£ï¼Œå› ä¸ºå„åˆ†ç‰‡èŠ‚ç‚¹ä¸­çš„æ•°æ®å¯èƒ½æ˜¯éšæœºçš„ï¼Œä¸ºäº†æ’åºçš„å‡†ç¡®æ€§ï¼Œå¿…é¡»æŠŠæ‰€æœ‰åˆ†ç‰‡èŠ‚ç‚¹çš„å‰ N é¡µæ•°æ®éƒ½æ’åºå¥½ååšåˆå¹¶ï¼Œæœ€åå†è¿›è¡Œæ•´ä½“çš„æ’åºã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™æ ·çš„æ“ä½œæ˜¯æ¯”è¾ƒæ¶ˆè€—èµ„æºçš„ï¼Œç”¨æˆ·è¶Šå¾€åç¿»é¡µï¼Œç³»ç»Ÿæ€§èƒ½å°†ä¼šè¶Šå·®ã€‚</p><p>é‚£å¦‚ä½•è§£å†³åˆ†åº“æƒ…å†µä¸‹çš„åˆ†é¡µé—®é¢˜å‘¢ï¼Ÿæœ‰ä»¥ä¸‹å‡ ç§åŠæ³•ï¼š</p><p>å¦‚æœæ˜¯åœ¨å‰å°åº”ç”¨æä¾›åˆ†é¡µï¼Œåˆ™é™å®šç”¨æˆ·åªèƒ½çœ‹å‰é¢ n é¡µï¼Œè¿™ä¸ªé™åˆ¶åœ¨ä¸šåŠ¡ä¸Šä¹Ÿæ˜¯åˆç†çš„ï¼Œä¸€èˆ¬çœ‹åé¢çš„åˆ†é¡µæ„ä¹‰ä¸å¤§ï¼ˆå¦‚æœä¸€å®šè¦çœ‹ï¼Œå¯ä»¥è¦æ±‚ç”¨æˆ·ç¼©å°èŒƒå›´é‡æ–°æŸ¥è¯¢ï¼‰ã€‚</p><p>å¦‚æœæ˜¯åå°æ‰¹å¤„ç†ä»»åŠ¡è¦æ±‚åˆ†æ‰¹è·å–æ•°æ®ï¼Œåˆ™å¯ä»¥åŠ å¤§ page sizeï¼Œæ¯”å¦‚æ¯æ¬¡è·å– 5000 æ¡è®°å½•ï¼Œæœ‰æ•ˆå‡å°‘åˆ†é¡µæ•°ï¼ˆå½“ç„¶ç¦»çº¿è®¿é—®ä¸€èˆ¬èµ°å¤‡åº“ï¼Œé¿å…å†²å‡»ä¸»åº“ï¼‰ã€‚</p><p>åˆ†åº“è®¾è®¡æ—¶ï¼Œä¸€èˆ¬è¿˜æœ‰é…å¥—å¤§æ•°æ®å¹³å°æ±‡æ€»æ‰€æœ‰åˆ†åº“çš„è®°å½•ï¼Œæœ‰äº›åˆ†é¡µæŸ¥è¯¢å¯ä»¥è€ƒè™‘èµ°å¤§æ•°æ®å¹³å°ã€‚</p><h3 id="27-åˆ†åº“ç­–ç•¥"><a class="markdownIt-Anchor" href="#27-åˆ†åº“ç­–ç•¥"></a> 2.7. åˆ†åº“ç­–ç•¥</h3><ul><li>æ ¹æ®æ•°å€¼èŒƒå›´ï¼Œæ¯”å¦‚ç”¨æˆ· Id ä¸º 1-9999 çš„è®°å½•åˆ†åˆ°ç¬¬ä¸€ä¸ªåº“ï¼Œ10000-20000 çš„åˆ†åˆ°ç¬¬äºŒä¸ªåº“ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li><li>æ ¹æ®æ•°å€¼å–æ¨¡ï¼Œæ¯”å¦‚ç”¨æˆ· Id mod nï¼Œä½™æ•°ä¸º 0 çš„è®°å½•æ”¾åˆ°ç¬¬ä¸€ä¸ªåº“ï¼Œä½™æ•°ä¸º 1 çš„æ”¾åˆ°ç¬¬äºŒä¸ªåº“ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li></ul><p>ä¼˜åŠ£æ¯”è¾ƒï¼šè¯„ä»·æŒ‡æ ‡æŒ‰ç…§èŒƒå›´åˆ†åº“æŒ‰ç…§ Mod åˆ†åº“åº“æ•°é‡å‰æœŸæ•°ç›®æ¯”è¾ƒå°ï¼Œå¯ä»¥éšç”¨æˆ·/ä¸šåŠ¡æŒ‰éœ€å¢é•¿å‰æœŸå³æ ¹æ® mode å› å­ç¡®å®šåº“æ•°é‡ï¼Œæ•°ç›®ä¸€èˆ¬æ¯”è¾ƒå¤§è®¿é—®æ€§èƒ½å‰æœŸåº“æ•°é‡å°ï¼Œå…¨åº“æŸ¥è¯¢æ¶ˆè€—èµ„æºå°‘ï¼Œå•åº“æŸ¥è¯¢æ€§èƒ½ç•¥å·®å‰æœŸåº“æ•°é‡å¤§ï¼Œå…¨åº“æŸ¥è¯¢æ¶ˆè€—èµ„æºå¤šï¼Œå•åº“æŸ¥è¯¢æ€§èƒ½ç•¥å¥½è°ƒæ•´åº“æ•°é‡æ¯”è¾ƒå®¹æ˜“ï¼Œä¸€èˆ¬åªéœ€ä¸ºæ–°ç”¨æˆ·å¢åŠ åº“ï¼Œè€åº“æ‹†åˆ†ä¹Ÿåªå½±å“å•ä¸ªåº“å›°éš¾ï¼Œæ”¹å˜ mod å› å­å¯¼è‡´æ•°æ®åœ¨æ‰€æœ‰åº“ä¹‹é—´è¿ç§»æ•°æ®çƒ­ç‚¹æ–°æ—§ç”¨æˆ·è´­ç‰©é¢‘ç‡æœ‰å·®å¼‚ï¼Œæœ‰æ•°æ®çƒ­ç‚¹é—®é¢˜æ–°æ—§ç”¨æˆ·å‡åŒ€åˆ°åˆ†å¸ƒåˆ°å„ä¸ªåº“ï¼Œæ— çƒ­ç‚¹å®è·µä¸­ï¼Œä¸ºäº†å¤„ç†ç®€å•ï¼Œé€‰æ‹© mod åˆ†åº“çš„æ¯”è¾ƒå¤šã€‚åŒæ—¶äºŒæ¬¡åˆ†åº“æ—¶ï¼Œä¸ºäº†æ•°æ®è¿ç§»æ–¹ä¾¿ï¼Œä¸€èˆ¬æ˜¯æŒ‰å€æ•°å¢åŠ ï¼Œæ¯”å¦‚åˆå§‹ 4 ä¸ªåº“ï¼ŒäºŒæ¬¡åˆ†è£‚ä¸º 8 ä¸ªï¼Œå† 16 ä¸ªã€‚è¿™æ ·å¯¹äºæŸä¸ªåº“çš„æ•°æ®ï¼Œä¸€åŠæ•°æ®ç§»åˆ°æ–°åº“ï¼Œå‰©ä½™ä¸åŠ¨ï¼Œå¯¹æ¯”æ¯æ¬¡åªå¢åŠ ä¸€ä¸ªåº“ï¼Œæ‰€æœ‰æ•°æ®éƒ½è¦å¤§è§„æ¨¡å˜åŠ¨ã€‚è¡¥å……ä¸‹ï¼Œmod åˆ†åº“ä¸€èˆ¬æ¯ä¸ªåº“è®°å½•æ•°æ¯”è¾ƒå‡åŒ€ï¼Œä½†ä¹Ÿæœ‰äº›æ•°æ®åº“ï¼Œå­˜åœ¨è¶…çº§ Idï¼Œè¿™äº› Id çš„è®°å½•è¿œè¿œè¶…è¿‡å…¶ä»– Idï¼Œæ¯”å¦‚åœ¨å¹¿å‘Šåœºæ™¯ä¸‹ï¼ŒæŸä¸ªå¤§å¹¿å‘Šä¸»çš„å¹¿å‘Šæ•°å¯èƒ½å æ€»ä½“å¾ˆå¤§æ¯”ä¾‹ã€‚å¦‚æœæŒ‰ç…§å¹¿å‘Šä¸» Id å–æ¨¡åˆ†åº“ï¼ŒæŸäº›åº“çš„è®°å½•æ•°ä¼šç‰¹åˆ«å¤šï¼Œå¯¹äºè¿™äº›è¶…çº§ Idï¼Œéœ€è¦æä¾›å•ç‹¬åº“æ¥å­˜å‚¨è®°å½•ã€‚</p><h3 id="28-åˆ†åº“æ•°é‡"><a class="markdownIt-Anchor" href="#28-åˆ†åº“æ•°é‡"></a> 2.8. åˆ†åº“æ•°é‡</h3><p>åˆ†åº“æ•°é‡é¦–å…ˆå’Œå•åº“èƒ½å¤„ç†çš„è®°å½•æ•°æœ‰å…³ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒMysql å•åº“è¶…è¿‡ 5000 ä¸‡æ¡è®°å½•ï¼ŒOracle å•åº“è¶…è¿‡ 1 äº¿æ¡è®°å½•ï¼ŒDB å‹åŠ›å°±å¾ˆå¤§(å½“ç„¶å¤„ç†èƒ½åŠ›å’Œå­—æ®µæ•°é‡/è®¿é—®æ¨¡å¼/è®°å½•é•¿åº¦æœ‰è¿›ä¸€æ­¥å…³ç³»)ã€‚</p><p>åœ¨æ»¡è¶³ä¸Šè¿°å‰æä¸‹ï¼Œå¦‚æœåˆ†åº“æ•°é‡å°‘ï¼Œè¾¾ä¸åˆ°åˆ†æ•£å­˜å‚¨å’Œå‡è½» DB æ€§èƒ½å‹åŠ›çš„ç›®çš„ï¼›å¦‚æœåˆ†åº“çš„æ•°é‡å¤šï¼Œå¥½å¤„æ˜¯æ¯ä¸ªåº“è®°å½•å°‘ï¼Œå•åº“è®¿é—®æ€§èƒ½å¥½ï¼Œä½†å¯¹äºè·¨å¤šä¸ªåº“çš„è®¿é—®ï¼Œåº”ç”¨ç¨‹åºéœ€è¦è®¿é—®å¤šä¸ªåº“ï¼Œå¦‚æœæ˜¯å¹¶å‘æ¨¡å¼ï¼Œè¦æ¶ˆè€—å®è´µçš„çº¿ç¨‹èµ„æºï¼›å¦‚æœæ˜¯ä¸²è¡Œæ¨¡å¼ï¼Œæ‰§è¡Œæ—¶é—´ä¼šæ€¥å‰§å¢åŠ ã€‚</p><p>æœ€ååˆ†åº“æ•°é‡è¿˜ç›´æ¥å½±å“ç¡¬ä»¶çš„æŠ•å…¥ï¼Œä¸€èˆ¬æ¯ä¸ªåˆ†åº“è·‘åœ¨å•ç‹¬ç‰©ç†æœºä¸Šï¼Œå¤šä¸€ä¸ªåº“æ„å‘³å¤šä¸€å°è®¾å¤‡ã€‚æ‰€ä»¥å…·ä½“åˆ†å¤šå°‘ä¸ªåº“ï¼Œè¦ç»¼åˆè¯„ä¼°ï¼Œä¸€èˆ¬åˆæ¬¡åˆ†åº“å»ºè®®åˆ† 4-8 ä¸ªåº“ã€‚</p><h2 id="3-è¯»å†™åˆ†ç¦»"><a class="markdownIt-Anchor" href="#3-è¯»å†™åˆ†ç¦»"></a> 3. è¯»å†™åˆ†ç¦»</h2><p>é¢å¯¹æ—¥ç›Šå¢åŠ çš„ç³»ç»Ÿè®¿é—®é‡ï¼Œæ•°æ®åº“çš„ååé‡é¢ä¸´ç€å·¨å¤§ç“¶é¢ˆã€‚ å¯¹äºåŒä¸€æ—¶åˆ»æœ‰å¤§é‡å¹¶å‘è¯»æ“ä½œå’Œè¾ƒå°‘å†™æ“ä½œç±»å‹çš„åº”ç”¨ç³»ç»Ÿæ¥è¯´ï¼Œå°†æ•°æ®åº“æ‹†åˆ†ä¸ºä¸»åº“å’Œä»åº“ï¼Œä¸»åº“è´Ÿè´£å¤„ç†äº‹åŠ¡æ€§çš„å¢åˆ æ”¹æ“ä½œï¼Œä»åº“è´Ÿè´£å¤„ç†æŸ¥è¯¢æ“ä½œï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„é¿å…ç”±æ•°æ®æ›´æ–°å¯¼è‡´çš„è¡Œé”ï¼Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿçš„æŸ¥è¯¢æ€§èƒ½å¾—åˆ°æå¤§çš„æ”¹å–„ã€‚</p><p>é€šè¿‡ä¸€ä¸»å¤šä»çš„é…ç½®æ–¹å¼ï¼Œå¯ä»¥å°†æŸ¥è¯¢è¯·æ±‚å‡åŒ€çš„åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®å‰¯æœ¬ï¼Œèƒ½å¤Ÿè¿›ä¸€æ­¥çš„æå‡ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚ ä½¿ç”¨å¤šä¸»å¤šä»çš„æ–¹å¼ï¼Œä¸ä½†èƒ½å¤Ÿæå‡ç³»ç»Ÿçš„ååé‡ï¼Œè¿˜èƒ½å¤Ÿæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œå¯ä»¥è¾¾åˆ°åœ¨ä»»ä½•ä¸€ä¸ªæ•°æ®åº“å®•æœºï¼Œç”šè‡³ç£ç›˜ç‰©ç†æŸåçš„æƒ…å†µä¸‹ä»ç„¶ä¸å½±å“ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚</p><p>ä¸å°†æ•°æ®æ ¹æ®åˆ†ç‰‡é”®æ‰“æ•£è‡³å„ä¸ªæ•°æ®èŠ‚ç‚¹çš„æ°´å¹³åˆ†ç‰‡ä¸åŒï¼Œè¯»å†™åˆ†ç¦»åˆ™æ˜¯æ ¹æ® SQL è¯­ä¹‰çš„åˆ†æï¼Œå°†è¯»æ“ä½œå’Œå†™æ“ä½œåˆ†åˆ«è·¯ç”±è‡³ä¸»åº“ä¸ä»åº“ã€‚</p><p><img src="https://shardingsphere.apache.org/document/current/img/read-write-split/read-write-split.png" alt="è¯»å†™åˆ†ç¦»" /></p><p>è¯»å†™åˆ†ç¦»çš„æ•°æ®èŠ‚ç‚¹ä¸­çš„æ•°æ®å†…å®¹æ˜¯ä¸€è‡´çš„ï¼Œè€Œæ°´å¹³åˆ†ç‰‡çš„æ¯ä¸ªæ•°æ®èŠ‚ç‚¹çš„æ•°æ®å†…å®¹å´å¹¶ä¸ç›¸åŒã€‚å°†æ°´å¹³åˆ†ç‰‡å’Œè¯»å†™åˆ†ç¦»è”åˆä½¿ç”¨ï¼Œèƒ½å¤Ÿæ›´åŠ æœ‰æ•ˆçš„æå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p><h3 id="31-æŒ‘æˆ˜"><a class="markdownIt-Anchor" href="#31-æŒ‘æˆ˜"></a> 3.1. æŒ‘æˆ˜</h3><p>è¯»å†™åˆ†ç¦»è™½ç„¶å¯ä»¥æå‡ç³»ç»Ÿçš„ååé‡å’Œå¯ç”¨æ€§ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ è¿™åŒ…æ‹¬å¤šä¸ªä¸»åº“ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä»¥åŠä¸»åº“ä¸ä»åº“ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚ å¹¶ä¸”ï¼Œè¯»å†™åˆ†ç¦»ä¹Ÿå¸¦æ¥äº†ä¸æ•°æ®åˆ†ç‰‡åŒæ ·çš„é—®é¢˜ï¼Œå®ƒåŒæ ·ä¼šä½¿å¾—åº”ç”¨å¼€å‘å’Œè¿ç»´äººå‘˜å¯¹æ•°æ®åº“çš„æ“ä½œå’Œè¿ç»´å˜å¾—æ›´åŠ å¤æ‚ã€‚ ä¸‹å›¾å±•ç°äº†å°†åˆ†åº“åˆ†è¡¨ä¸è¯»å†™åˆ†ç¦»ä¸€åŒä½¿ç”¨æ—¶ï¼Œåº”ç”¨ç¨‹åºä¸æ•°æ®åº“é›†ç¾¤ä¹‹é—´çš„å¤æ‚æ‹“æ‰‘å…³ç³»ã€‚</p><p><img src="https://shardingsphere.apache.org/document/current/img/read-write-split/sharding-read-write-split.png" alt="æ•°æ®åˆ†ç‰‡ + è¯»å†™åˆ†ç¦»" /></p><h2 id="4-å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#4-å‚è€ƒèµ„æ–™"></a> 4. å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://shardingsphere.apache.org/document/current/cn/overview/" target="_blank" rel="noopener">ShardingSphere å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://juejin.im/post/5bf778ef5188251b8a26ed8b" target="_blank" rel="noopener">â€œåˆ†åº“åˆ†è¡¨&quot; ï¼Ÿé€‰å‹å’Œæµç¨‹è¦æ…é‡ï¼Œå¦åˆ™ä¼šå¤±æ§</a></li><li><a href="https://www.jianshu.com/p/32b3e91aa22c" target="_blank" rel="noopener">åˆ†åº“åˆ†è¡¨éœ€è¦è€ƒè™‘çš„é—®é¢˜åŠæ–¹æ¡ˆ</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;åˆ†åº“åˆ†è¡¨åŸºæœ¬åŸç†&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#åˆ†åº“åˆ†è¡¨åŸºæœ¬åŸç†&quot;&gt;&lt;/a&gt; åˆ†åº“åˆ†è¡¨åŸºæœ¬åŸç†&lt;/h1&gt;
&lt;p&gt;åˆ†ç‰‡ï¼ˆShardingï¼‰çš„åŸºæœ¬æ€æƒ³å°±è¦æŠŠä¸€ä¸ªæ•°æ®åº“åˆ‡åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œå­˜å‚¨åœ¨ä¸åŒçš„æ•°æ®åº“(server)ä¸Šï¼Œä»è€Œ
      
    
    </summary>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/tags/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/tags/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
      <category term="åˆ†ç‰‡" scheme="https://dunwu.github.io/blog/tags/%E5%88%86%E7%89%87/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼å­˜å‚¨åŸºæœ¬åŸç†</title>
    <link href="https://dunwu.github.io/blog/design/theory/distributed-storage-theory/"/>
    <id>https://dunwu.github.io/blog/design/theory/distributed-storage-theory/</id>
    <published>2019-08-21T03:30:00.000Z</published>
    <updated>2019-11-27T08:34:35.875Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆ†å¸ƒå¼å­˜å‚¨åŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#åˆ†å¸ƒå¼å­˜å‚¨åŸºæœ¬åŸç†"></a> åˆ†å¸ƒå¼å­˜å‚¨åŸºæœ¬åŸç†</h1><h2 id="1-åˆ†åŒºè§„åˆ™"><a class="markdownIt-Anchor" href="#1-åˆ†åŒºè§„åˆ™"></a> 1. åˆ†åŒºè§„åˆ™</h2><p><strong>åˆ†å¸ƒå¼æ•°æ®åº“</strong> é¦–å…ˆè¦è§£å†³æŠŠ <strong>æ•´ä¸ªæ•°æ®é›†</strong> æŒ‰ç…§ <strong>åˆ†åŒºè§„åˆ™</strong> æ˜ å°„åˆ° <strong>å¤šä¸ªèŠ‚ç‚¹</strong> çš„é—®é¢˜ï¼Œå³æŠŠ <strong>æ•°æ®é›†</strong> åˆ’åˆ†åˆ° <strong>å¤šä¸ªèŠ‚ç‚¹</strong> ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ <strong>æ•´ä½“æ•°æ®</strong> çš„ä¸€ä¸ª <strong>å­é›†</strong>ã€‚</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/architecture/partition-rule.png!zp" /></div><p>æ•°æ®åˆ†å¸ƒé€šå¸¸æœ‰ <strong>å“ˆå¸Œåˆ†åŒº</strong> å’Œ <strong>é¡ºåºåˆ†åŒº</strong> ä¸¤ç§æ–¹å¼ï¼Œå¯¹æ¯”å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:left">åˆ†åŒºæ–¹å¼</th><th style="text-align:left">ç‰¹ç‚¹</th><th style="text-align:left">ç›¸å…³äº§å“</th></tr></thead><tbody><tr><td style="text-align:left">å“ˆå¸Œåˆ†åŒº</td><td style="text-align:left">ç¦»æ•£ç¨‹åº¦å¥½ï¼Œæ•°æ®åˆ†å¸ƒä¸ä¸šåŠ¡æ— å…³ï¼Œæ— æ³•é¡ºåºè®¿é—®</td><td style="text-align:left">Redis Clusterï¼ŒCassandraï¼ŒDynamo</td></tr><tr><td style="text-align:left">é¡ºåºåˆ†åŒº</td><td style="text-align:left">ç¦»æ•£ç¨‹åº¦æ˜“å€¾æ–œï¼Œæ•°æ®åˆ†å¸ƒä¸ä¸šåŠ¡ç›¸å…³ï¼Œå¯ä»¥é¡ºåºè®¿é—®</td><td style="text-align:left">BigTableï¼ŒHBaseï¼ŒHypertable</td></tr></tbody></table><p>ç”±äº <code>Redis Cluster</code> é‡‡ç”¨ <strong>å“ˆå¸Œåˆ†åŒºè§„åˆ™</strong>ï¼Œè¿™é‡Œé‡ç‚¹è®¨è®º <strong>å“ˆå¸Œåˆ†åŒº</strong>ã€‚å¸¸è§çš„ <strong>å“ˆå¸Œåˆ†åŒº</strong> è§„åˆ™æœ‰å‡ ç§ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»ï¼š</p><h3 id="11-èŠ‚ç‚¹å–ä½™åˆ†åŒº"><a class="markdownIt-Anchor" href="#11-èŠ‚ç‚¹å–ä½™åˆ†åŒº"></a> 1.1. èŠ‚ç‚¹å–ä½™åˆ†åŒº</h3><p>ä½¿ç”¨ç‰¹å®šçš„æ•°æ®ï¼Œå¦‚ <code>Redis</code> çš„ <strong>é”®</strong> æˆ– <strong>ç”¨æˆ·</strong> <code>ID</code>ï¼Œå†æ ¹æ® <strong>èŠ‚ç‚¹æ•°é‡</strong> <code>N</code> ä½¿ç”¨å…¬å¼ï¼š<code>hashï¼ˆkeyï¼‰% N</code> è®¡ç®—å‡º <strong>å“ˆå¸Œå€¼</strong>ï¼Œç”¨æ¥å†³å®šæ•°æ® <strong>æ˜ å°„</strong> åˆ°å“ªä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/architecture/partition-hash-mod.png!zp" /></div><ul><li><strong>ä¼˜ç‚¹</strong></li></ul><p>è¿™ç§æ–¹å¼çš„çªå‡ºä¼˜ç‚¹æ˜¯ <strong>ç®€å•æ€§</strong>ï¼Œå¸¸ç”¨äº <strong>æ•°æ®åº“</strong> çš„ <strong>åˆ†åº“åˆ†è¡¨è§„åˆ™</strong>ã€‚ä¸€èˆ¬é‡‡ç”¨ <strong>é¢„åˆ†åŒº</strong> çš„æ–¹å¼ï¼Œæå‰æ ¹æ® <strong>æ•°æ®é‡</strong> è§„åˆ’å¥½ <strong>åˆ†åŒºæ•°</strong>ï¼Œæ¯”å¦‚åˆ’åˆ†ä¸º <code>512</code> æˆ– <code>1024</code> å¼ è¡¨ï¼Œä¿è¯å¯æ”¯æ’‘æœªæ¥ä¸€æ®µæ—¶é—´çš„ <strong>æ•°æ®å®¹é‡</strong>ï¼Œå†æ ¹æ® <strong>è´Ÿè½½æƒ…å†µ</strong> å°† <strong>è¡¨</strong> è¿ç§»åˆ°å…¶ä»– <strong>æ•°æ®åº“</strong> ä¸­ã€‚æ‰©å®¹æ—¶é€šå¸¸é‡‡ç”¨ <strong>ç¿»å€æ‰©å®¹</strong>ï¼Œé¿å… <strong>æ•°æ®æ˜ å°„</strong> å…¨éƒ¨è¢« <strong>æ‰“ä¹±</strong>ï¼Œå¯¼è‡´ <strong>å…¨é‡è¿ç§»</strong> çš„æƒ…å†µã€‚</p><ul><li><strong>ç¼ºç‚¹</strong></li></ul><p>å½“ <strong>èŠ‚ç‚¹æ•°é‡</strong> å˜åŒ–æ—¶ï¼Œå¦‚ <strong>æ‰©å®¹</strong> æˆ– <strong>æ”¶ç¼©</strong> èŠ‚ç‚¹ï¼Œæ•°æ®èŠ‚ç‚¹ <strong>æ˜ å°„å…³ç³»</strong> éœ€è¦é‡æ–°è®¡ç®—ï¼Œä¼šå¯¼è‡´æ•°æ®çš„ <strong>é‡æ–°è¿ç§»</strong>ã€‚</p><h3 id="12-ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº"><a class="markdownIt-Anchor" href="#12-ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº"></a> 1.2. ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº</h3><p><strong>ä¸€è‡´æ€§å“ˆå¸Œ</strong> å¯ä»¥å¾ˆå¥½çš„è§£å†³ <strong>ç¨³å®šæ€§é—®é¢˜</strong>ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„ <strong>å­˜å‚¨èŠ‚ç‚¹</strong> æ’åˆ—åœ¨ <strong>é¦–å°¾ç›¸æ¥</strong> çš„ <code>Hash</code> ç¯ä¸Šï¼Œæ¯ä¸ª <code>key</code> åœ¨è®¡ç®— <code>Hash</code> åä¼š <strong>é¡ºæ—¶é’ˆ</strong> æ‰¾åˆ° <strong>ä¸´æ¥</strong> çš„ <strong>å­˜å‚¨èŠ‚ç‚¹</strong> å­˜æ”¾ã€‚è€Œå½“æœ‰èŠ‚ç‚¹ <strong>åŠ å…¥</strong> æˆ– <strong>é€€å‡º</strong> æ—¶ï¼Œä»…å½±å“è¯¥èŠ‚ç‚¹åœ¨ <code>Hash</code> ç¯ä¸Š <strong>é¡ºæ—¶é’ˆç›¸é‚»</strong> çš„ <strong>åç»­èŠ‚ç‚¹</strong>ã€‚</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/architecture/partition-consistent-hash.png!zp" /></div><ul><li><strong>ä¼˜ç‚¹</strong></li></ul><p><strong>åŠ å…¥</strong> å’Œ <strong>åˆ é™¤</strong> èŠ‚ç‚¹åªå½±å“ <strong>å“ˆå¸Œç¯</strong> ä¸­ <strong>é¡ºæ—¶é’ˆæ–¹å‘</strong> çš„ <strong>ç›¸é‚»çš„èŠ‚ç‚¹</strong>ï¼Œå¯¹å…¶ä»–èŠ‚ç‚¹æ— å½±å“ã€‚</p><ul><li><strong>ç¼ºç‚¹</strong></li></ul><p><strong>åŠ å‡èŠ‚ç‚¹</strong> ä¼šé€ æˆ <strong>å“ˆå¸Œç¯</strong> ä¸­éƒ¨åˆ†æ•°æ® <strong>æ— æ³•å‘½ä¸­</strong>ã€‚å½“ä½¿ç”¨ <strong>å°‘é‡èŠ‚ç‚¹</strong> æ—¶ï¼Œ<strong>èŠ‚ç‚¹å˜åŒ–</strong> å°†å¤§èŒƒå›´å½±å“ <strong>å“ˆå¸Œç¯</strong> ä¸­ <strong>æ•°æ®æ˜ å°„</strong>ï¼Œä¸é€‚åˆ <strong>å°‘é‡æ•°æ®èŠ‚ç‚¹</strong> çš„åˆ†å¸ƒå¼æ–¹æ¡ˆã€‚<strong>æ™®é€š</strong> çš„ <strong>ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº</strong> åœ¨å¢å‡èŠ‚ç‚¹æ—¶éœ€è¦ <strong>å¢åŠ ä¸€å€</strong> æˆ– <strong>å‡å»ä¸€åŠ</strong> èŠ‚ç‚¹æ‰èƒ½ä¿è¯ <strong>æ•°æ®</strong> å’Œ <strong>è´Ÿè½½çš„å‡è¡¡</strong>ã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ï¼šå› ä¸º <strong>ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº</strong> çš„è¿™äº›ç¼ºç‚¹ï¼Œä¸€äº›åˆ†å¸ƒå¼ç³»ç»Ÿé‡‡ç”¨ <strong>è™šæ‹Ÿæ§½</strong> å¯¹ <strong>ä¸€è‡´æ€§å“ˆå¸Œ</strong> è¿›è¡Œæ”¹è¿›ï¼Œæ¯”å¦‚ <code>Dynamo</code> ç³»ç»Ÿã€‚</p></blockquote><h3 id="13-è™šæ‹Ÿæ§½åˆ†åŒº"><a class="markdownIt-Anchor" href="#13-è™šæ‹Ÿæ§½åˆ†åŒº"></a> 1.3. è™šæ‹Ÿæ§½åˆ†åŒº</h3><p><strong>è™šæ‹Ÿæ§½åˆ†åŒº</strong> å·§å¦™åœ°ä½¿ç”¨äº† <strong>å“ˆå¸Œç©ºé—´</strong>ï¼Œä½¿ç”¨ <strong>åˆ†æ•£åº¦è‰¯å¥½</strong> çš„ <strong>å“ˆå¸Œå‡½æ•°</strong> æŠŠæ‰€æœ‰æ•°æ® <strong>æ˜ å°„</strong> åˆ°ä¸€ä¸ª <strong>å›ºå®šèŒƒå›´</strong> çš„ <strong>æ•´æ•°é›†åˆ</strong> ä¸­ï¼Œæ•´æ•°å®šä¹‰ä¸º <strong>æ§½</strong>ï¼ˆ<code>slot</code>ï¼‰ã€‚è¿™ä¸ªèŒƒå›´ä¸€èˆ¬ <strong>è¿œè¿œå¤§äº</strong> èŠ‚ç‚¹æ•°ï¼Œæ¯”å¦‚ <code>Redis Cluster</code> æ§½èŒƒå›´æ˜¯ <code>0 ~ 16383</code>ã€‚<strong>æ§½</strong> æ˜¯é›†ç¾¤å†… <strong>æ•°æ®ç®¡ç†</strong> å’Œ <strong>è¿ç§»</strong> çš„ <strong>åŸºæœ¬å•ä½</strong>ã€‚é‡‡ç”¨ <strong>å¤§èŒƒå›´æ§½</strong> çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ <strong>æ•°æ®æ‹†åˆ†</strong> å’Œ <strong>é›†ç¾¤æ‰©å±•</strong>ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¼šè´Ÿè´£ <strong>ä¸€å®šæ•°é‡çš„æ§½</strong>ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/architecture/partition-hash-slot.png!zp" /></div>å½“å‰é›†ç¾¤æœ‰ `3` ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¹³å‡å¤§çº¦è´Ÿè´£ `5460` ä¸ª **æ§½**ã€‚ç”±äºé‡‡ç”¨ **é«˜è´¨é‡** çš„ **å“ˆå¸Œç®—æ³•**ï¼Œæ¯ä¸ªæ§½æ‰€æ˜ å°„çš„æ•°æ®é€šå¸¸æ¯”è¾ƒ **å‡åŒ€**ï¼Œå°†æ•°æ®å¹³å‡åˆ’åˆ†åˆ° `3` ä¸ªèŠ‚ç‚¹è¿›è¡Œ **æ•°æ®åˆ†åŒº**ã€‚`Redis Cluster` å°±æ˜¯é‡‡ç”¨ **è™šæ‹Ÿæ§½åˆ†åŒº**ã€‚<p>é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†å“ˆå¸Œæ§½ï¼Œæ¯”å¦‚é›†ç¾¤ä¸­æœ‰ï¼“ä¸ªèŠ‚ç‚¹ï¼Œåˆ™ï¼š</p><ul><li>èŠ‚ç‚¹ï¼¡å­˜å‚¨çš„å“ˆå¸Œæ§½èŒƒå›´æ˜¯ï¼š0 â€“ 5460</li><li>èŠ‚ç‚¹ï¼¢å­˜å‚¨çš„å“ˆå¸Œæ§½èŒƒå›´æ˜¯ï¼š5461 â€“ 10922</li><li>èŠ‚ç‚¹ï¼£å­˜å‚¨çš„å“ˆå¸Œæ§½èŒƒå›´æ˜¯ï¼š10923 â€“ 16383</li></ul><p>è¿™ç§ç»“æ„å¾ˆå®¹æ˜“ <strong>æ·»åŠ </strong> æˆ–è€… <strong>åˆ é™¤</strong> èŠ‚ç‚¹ã€‚å¦‚æœ <strong>å¢åŠ </strong> ä¸€ä¸ªèŠ‚ç‚¹ <code>4</code>ï¼Œå°±éœ€è¦ä»èŠ‚ç‚¹ <code>1 ~ 3</code> è·å¾—éƒ¨åˆ† <strong>æ§½</strong> åˆ†é…åˆ°èŠ‚ç‚¹ <code>4</code> ä¸Šã€‚å¦‚æœæƒ³ <strong>ç§»é™¤</strong> èŠ‚ç‚¹ <code>1</code>ï¼Œéœ€è¦å°†èŠ‚ç‚¹ <code>1</code> ä¸­çš„ <strong>æ§½</strong> ç§»åˆ°èŠ‚ç‚¹ <code>2 ~ 3</code> ä¸Šï¼Œç„¶åå°† <strong>æ²¡æœ‰ä»»ä½•æ§½</strong> çš„èŠ‚ç‚¹ <code>1</code> ä»é›†ç¾¤ä¸­ <strong>ç§»é™¤</strong> å³å¯ã€‚</p><blockquote><p>ç”±äºä»ä¸€ä¸ªèŠ‚ç‚¹å°† <strong>å“ˆå¸Œæ§½</strong> ç§»åŠ¨åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹å¹¶ä¸ä¼š <strong>åœæ­¢æœåŠ¡</strong>ï¼Œæ‰€ä»¥æ— è®º <strong>æ·»åŠ åˆ é™¤</strong> æˆ–è€… <strong>æ”¹å˜</strong> æŸä¸ªèŠ‚ç‚¹çš„ <strong>å“ˆå¸Œæ§½çš„æ•°é‡</strong> éƒ½ä¸ä¼šé€ æˆ <strong>é›†ç¾¤ä¸å¯ç”¨</strong> çš„çŠ¶æ€.</p></blockquote><h2 id="2-å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#2-å‚è€ƒèµ„æ–™"></a> 2. å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://juejin.im/post/5b8fc5536fb9a05d2d01fb11" target="_blank" rel="noopener">æ·±å…¥å‰–æ Redis ç³»åˆ—(ä¸‰) - Redis é›†ç¾¤æ¨¡å¼æ­å»ºä¸åŸç†è¯¦è§£</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;åˆ†å¸ƒå¼å­˜å‚¨åŸºæœ¬åŸç†&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#åˆ†å¸ƒå¼å­˜å‚¨åŸºæœ¬åŸç†&quot;&gt;&lt;/a&gt; åˆ†å¸ƒå¼å­˜å‚¨åŸºæœ¬åŸç†&lt;/h1&gt;
&lt;h2 id=&quot;1-åˆ†åŒºè§„åˆ™&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-
      
    
    </summary>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/tags/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/tags/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
      <category term="å­˜å‚¨" scheme="https://dunwu.github.io/blog/tags/%E5%AD%98%E5%82%A8/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼ ID åŸºæœ¬åŸç†</title>
    <link href="https://dunwu.github.io/blog/design/theory/distributed-id-theory/"/>
    <id>https://dunwu.github.io/blog/design/theory/distributed-id-theory/</id>
    <published>2019-07-24T03:55:00.000Z</published>
    <updated>2020-01-19T13:56:17.671Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆ†å¸ƒå¼-id-åŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#åˆ†å¸ƒå¼-id-åŸºæœ¬åŸç†"></a> åˆ†å¸ƒå¼ ID åŸºæœ¬åŸç†</h1><blockquote><p>ä¼ ç»Ÿæ•°æ®åº“è½¯ä»¶å¼€å‘ä¸­ï¼Œä¸»é”®è‡ªåŠ¨ç”ŸæˆæŠ€æœ¯æ˜¯åŸºæœ¬éœ€æ±‚ã€‚è€Œå„ä¸ªæ•°æ®åº“å¯¹äºè¯¥éœ€æ±‚ä¹Ÿæä¾›äº†ç›¸åº”çš„æ”¯æŒï¼Œæ¯”å¦‚ MySQL çš„è‡ªå¢é”®ï¼ŒOracle çš„è‡ªå¢åºåˆ—ç­‰ã€‚</p><p>æ•°æ®åˆ†ç‰‡åï¼Œä¸åŒæ•°æ®èŠ‚ç‚¹ç”Ÿæˆå…¨å±€å”¯ä¸€ä¸»é”®æ˜¯éå¸¸æ£˜æ‰‹çš„é—®é¢˜ã€‚åŒä¸€ä¸ªé€»è¾‘è¡¨å†…çš„ä¸åŒå®é™…è¡¨ä¹‹é—´çš„è‡ªå¢é”®ç”±äºæ— æ³•äº’ç›¸æ„ŸçŸ¥è€Œäº§ç”Ÿé‡å¤ä¸»é”®ã€‚ è™½ç„¶å¯é€šè¿‡çº¦æŸè‡ªå¢ä¸»é”®åˆå§‹å€¼å’Œæ­¥é•¿çš„æ–¹å¼é¿å…ç¢°æ’ï¼Œä½†éœ€å¼•å…¥é¢å¤–çš„è¿ç»´è§„åˆ™ï¼Œä½¿è§£å†³æ–¹æ¡ˆç¼ºä¹å®Œæ•´æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p><p>ä¸ºæ­¤ï¼Œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼ ID æ¥è§£å†³æ­¤é—®é¢˜ã€‚æœ¬æ–‡æ€»ç»“ä¸šç•Œå¸¸ç”¨çš„åˆ†å¸ƒå¼ ID è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><!-- TOC depthFrom:2 depthTo:3 --><ul><li><a href="#1-%E7%AE%80%E4%BB%8B">1. ç®€ä»‹</a></li><li><a href="#2-uuid">2. UUID</a><ul><li><a href="#21-uuid-%E7%9A%84%E4%BC%98%E7%82%B9">2.1. UUID çš„ä¼˜ç‚¹</a></li><li><a href="#22-uuid-%E7%9A%84%E7%BC%BA%E7%82%B9">2.2. UUID çš„ç¼ºç‚¹</a></li><li><a href="#23-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">2.3. é€‚ç”¨åœºæ™¯</a></li></ul></li><li><a href="#3-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%87%AA%E5%A2%9E%E9%94%AE">3. æ•°æ®åº“è‡ªå¢é”®</a><ul><li><a href="#31-%E4%BC%98%E7%82%B9">3.1. ä¼˜ç‚¹</a></li><li><a href="#32-%E7%BC%BA%E7%82%B9">3.2. ç¼ºç‚¹</a></li><li><a href="#33-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">3.3. é€‚ç”¨åœºæ™¯</a></li><li><a href="#34-%E6%94%B9%E8%BF%9B">3.4. æ”¹è¿›</a></li></ul></li><li><a href="#4-%E5%88%A9%E7%94%A8-redis-%E7%94%9F%E6%88%90%E9%94%AE">4. åˆ©ç”¨ Redis ç”Ÿæˆé”®</a><ul><li><a href="#41-%E4%BC%98%E7%82%B9">4.1. ä¼˜ç‚¹</a></li><li><a href="#42-%E7%BC%BA%E7%82%B9">4.2. ç¼ºç‚¹</a></li><li><a href="#43-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">4.3. é€‚ç”¨åœºæ™¯</a></li></ul></li><li><a href="#5-%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95snowflake">5. é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰</a><ul><li><a href="#51-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86">5.1. åŸºæœ¬åŸç†</a></li><li><a href="#52-%E4%BC%98%E7%82%B9">5.2. ä¼˜ç‚¹</a></li><li><a href="#53-%E7%BC%BA%E7%82%B9">5.3. ç¼ºç‚¹</a></li><li><a href="#54-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">5.4. é€‚ç”¨åœºæ™¯</a></li><li><a href="#55-%E9%98%B2%E6%AD%A2%E6%97%B6%E9%92%9F%E5%9B%9E%E6%8B%A8">5.5. é˜²æ­¢æ—¶é’Ÿå›æ‹¨</a></li></ul></li><li><a href="#6-leaf">6. Leaf</a><ul><li><a href="#61-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86">6.1. åŸºæœ¬åŸç†</a></li><li><a href="#62-%E4%BC%98%E7%82%B9">6.2. ä¼˜ç‚¹</a></li><li><a href="#63-%E7%BC%BA%E7%82%B9">6.3. ç¼ºç‚¹</a></li><li><a href="#64-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">6.4. é€‚ç”¨åœºæ™¯</a></li></ul></li><li><a href="#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">7. å‚è€ƒèµ„æ–™</a></li></ul><!-- /TOC --><h2 id="1-ç®€ä»‹"><a class="markdownIt-Anchor" href="#1-ç®€ä»‹"></a> 1. ç®€ä»‹</h2><p>é¦–å…ˆï¼Œåˆ†å¸ƒå¼ ID åº”è¯¥å…·å¤‡å“ªäº›ç‰¹æ€§å‘¢ï¼Ÿ</p><ol><li><strong>å…¨å±€å”¯ä¸€æ€§</strong> - ä¸èƒ½å‡ºç°é‡å¤çš„ ID å·ï¼Œæ—¢ç„¶æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„è¦æ±‚ã€‚</li><li><strong>è¶‹åŠ¿é€’å¢</strong> - åœ¨ MySQL InnoDB å¼•æ“ä¸­ä½¿ç”¨çš„æ˜¯èšé›†ç´¢å¼•ï¼Œç”±äºå¤šæ•° RDBMS ä½¿ç”¨ B-tree çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œåœ¨ä¸»é”®çš„é€‰æ‹©ä¸Šé¢æˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨æœ‰åºçš„ä¸»é”®ä¿è¯å†™å…¥æ€§èƒ½ã€‚</li><li><strong>å•è°ƒé€’å¢</strong> - ä¿è¯ä¸‹ä¸€ä¸ª ID ä¸€å®šå¤§äºä¸Šä¸€ä¸ª IDï¼Œä¾‹å¦‚äº‹åŠ¡ç‰ˆæœ¬å·ã€IM å¢é‡æ¶ˆæ¯ã€æ’åºç­‰ç‰¹æ®Šéœ€æ±‚ã€‚</li><li><strong>ä¿¡æ¯å®‰å…¨</strong> - å¦‚æœ ID æ˜¯è¿ç»­çš„ï¼Œæ¶æ„ç”¨æˆ·çš„æ‰’å–å·¥ä½œå°±éå¸¸å®¹æ˜“åšäº†ï¼Œç›´æ¥æŒ‰ç…§é¡ºåºä¸‹è½½æŒ‡å®š URL å³å¯ï¼›å¦‚æœæ˜¯è®¢å•å·å°±æ›´å±é™©äº†ï¼Œç«å¯¹å¯ä»¥ç›´æ¥çŸ¥é“æˆ‘ä»¬ä¸€å¤©çš„å•é‡ã€‚æ‰€ä»¥åœ¨ä¸€äº›åº”ç”¨åœºæ™¯ä¸‹ï¼Œä¼šéœ€è¦ ID æ— è§„åˆ™ã€ä¸è§„åˆ™ã€‚</li></ol><h2 id="2-uuid"><a class="markdownIt-Anchor" href="#2-uuid"></a> 2. UUID</h2><p>UUID æ˜¯é€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ˆUniversally Unique Identifier)çš„ç¼©å†™ï¼Œå¼€æ”¾è½¯ä»¶åŸºé‡‘ä¼š(OSF)è§„èŒƒå®šä¹‰äº†åŒ…æ‹¬ç½‘å¡ MAC åœ°å€ã€æ—¶é—´æˆ³ã€åå­—ç©ºé—´ï¼ˆNamespaceï¼‰ã€éšæœºæˆ–ä¼ªéšæœºæ•°ã€æ—¶åºç­‰å…ƒç´ ã€‚åˆ©ç”¨è¿™äº›å…ƒç´ æ¥ç”Ÿæˆ UUIDã€‚</p><p>UUID æ˜¯ç”± 128 ä½äºŒè¿›åˆ¶ç»„æˆï¼Œä¸€èˆ¬è½¬æ¢æˆåå…­è¿›åˆ¶ï¼Œç„¶åç”¨ String è¡¨ç¤ºã€‚åœ¨ java ä¸­æœ‰ä¸ª UUID ç±»,åœ¨ä»–çš„æ³¨é‡Šä¸­æˆ‘ä»¬çœ‹è§è¿™é‡Œæœ‰ 4 ç§ä¸åŒçš„ UUID çš„ç”Ÿæˆç­–ç•¥:</p><ul><li>random - åŸºäºéšæœºæ•°ç”Ÿæˆ UUIDï¼Œç”±äº Java ä¸­çš„éšæœºæ•°æ˜¯ä¼ªéšæœºæ•°ï¼Œå…¶é‡å¤çš„æ¦‚ç‡æ˜¯å¯ä»¥è¢«è®¡ç®—å‡ºæ¥çš„ã€‚è¿™ä¸ªä¸€èˆ¬æˆ‘ä»¬ç”¨ä¸‹é¢çš„ä»£ç è·å–åŸºäºéšæœºæ•°çš„ UUID:</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String id = UUID.randomUUID().toString();</span><br></pre></td></tr></table></figure><ul><li>time-based - åŸºäºæ—¶é—´çš„ UUID,è¿™ä¸ªä¸€èˆ¬æ˜¯é€šè¿‡å½“å‰æ—¶é—´ï¼Œéšæœºæ•°ï¼Œå’Œæœ¬åœ° Mac åœ°å€æ¥è®¡ç®—å‡ºæ¥ï¼Œè‡ªå¸¦çš„ JDK åŒ…å¹¶æ²¡æœ‰è¿™ä¸ªç®—æ³•çš„æˆ‘ä»¬åœ¨ä¸€äº› UUIDUtil ä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ log4j.core.utilï¼Œä¼šé‡æ–°å®šä¹‰ UUID çš„é«˜ä½å’Œä½ä½ã€‚</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UUID <span class="title">getTimeBasedUuid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> time = System.currentTimeMillis() * <span class="number">10000L</span> + <span class="number">122192928000000000L</span> + (<span class="keyword">long</span>)(COUNT.incrementAndGet() % <span class="number">10000</span>);</span><br><span class="line">    <span class="keyword">long</span> timeLow = (time &amp; <span class="number">4294967295L</span>) &lt;&lt; <span class="number">32</span>;</span><br><span class="line">    <span class="keyword">long</span> timeMid = (time &amp; <span class="number">281470681743360L</span>) &gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">long</span> timeHi = (time &amp; <span class="number">1152640029630136320L</span>) &gt;&gt; <span class="number">48</span>;</span><br><span class="line">    <span class="keyword">long</span> most = timeLow | timeMid | <span class="number">4096L</span> | timeHi;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> UUID(most, LEAST);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>DCE security - DCE å®‰å…¨çš„ UUIDã€‚</p></li><li><p>name-based - åŸºäºåå­—çš„ UUIDï¼Œé€šè¿‡è®¡ç®—åå­—å’Œåå­—ç©ºé—´çš„ MD5 æ¥è®¡ç®— UUIDã€‚</p></li></ul><h3 id="21-uuid-çš„ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#21-uuid-çš„ä¼˜ç‚¹"></a> 2.1. UUID çš„ä¼˜ç‚¹</h3><ul><li>é€šè¿‡æœ¬åœ°ç”Ÿæˆï¼Œæ²¡æœ‰ç»è¿‡ç½‘ç»œ I/Oï¼Œæ€§èƒ½è¾ƒå¿«</li></ul><h3 id="22-uuid-çš„ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#22-uuid-çš„ç¼ºç‚¹"></a> 2.2. UUID çš„ç¼ºç‚¹</h3><ul><li><strong>é•¿åº¦è¿‡é•¿</strong> - UUID å¤ªé•¿ï¼Œ16 å­—èŠ‚ 128 ä½ï¼Œé€šå¸¸ä»¥ 36 é•¿åº¦çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¾ˆå¤šåœºæ™¯ä¸é€‚ç”¨ã€‚ä¾‹å¦‚ï¼šMysql å®˜æ–¹æ˜ç¡®å»ºè®®ä¸»é”®è¶ŠçŸ­è¶Šå¥½ï¼Œ36 ä¸ªå­—ç¬¦é•¿åº¦çš„ UUID ä¸ç¬¦åˆè¦æ±‚ã€‚</li><li><strong>ä¿¡æ¯ä¸å®‰å…¨</strong> - åŸºäº MAC åœ°å€ç”Ÿæˆ UUID çš„ç®—æ³•å¯èƒ½ä¼šé€ æˆ MAC åœ°å€æ³„éœ²ï¼Œè¿™ä¸ªæ¼æ´æ›¾è¢«ç”¨äºå¯»æ‰¾æ¢…ä¸½èç—…æ¯’çš„åˆ¶ä½œè€…ä½ç½®ã€‚</li><li><strong>æ— åºæ€§</strong> - ä¸èƒ½ç”Ÿæˆé€’å¢æœ‰åºçš„æ•°å­—ã€‚è¿™å¯¹äºä¸€äº›ç‰¹å®šåœºæ™¯ä¸åˆ©ã€‚ä¾‹å¦‚ï¼šå¦‚æœä½œä¸ºæ•°æ®åº“ä¸»é”®ï¼Œåœ¨ InnoDB å¼•æ“ä¸‹ï¼ŒUUID çš„æ— åºæ€§å¯èƒ½ä¼šå¼•èµ·æ•°æ®ä½ç½®é¢‘ç¹å˜åŠ¨ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚</li></ul><h3 id="23-é€‚ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#23-é€‚ç”¨åœºæ™¯"></a> 2.3. é€‚ç”¨åœºæ™¯</h3><p>UUID çš„é€‚ç”¨åœºæ™¯å¯ä»¥ä¸ºä¸éœ€è¦æ‹…å¿ƒè¿‡å¤šçš„ç©ºé—´å ç”¨ï¼Œä»¥åŠä¸éœ€è¦ç”Ÿæˆæœ‰é€’å¢è¶‹åŠ¿çš„æ•°å­—ã€‚åœ¨ Log4j é‡Œ <code>UuidPatternConverter</code> ä¸­åŠ å…¥äº† UUID æ¥æ ‡è¯†æ¯ä¸€æ¡æ—¥å¿—ã€‚</p><h2 id="3-æ•°æ®åº“è‡ªå¢é”®"><a class="markdownIt-Anchor" href="#3-æ•°æ®åº“è‡ªå¢é”®"></a> 3. æ•°æ®åº“è‡ªå¢é”®</h2><p>æåˆ°è‡ªå¢é”®ï¼Œæœ€å…ˆæƒ³åˆ°çš„è‚¯å®šæ˜¯ç›´æ¥ä½¿ç”¨æ•°æ®åº“è‡ªå¢é”®ã€‚<em>å„æ•°æ®åº“å¯¹äºè¯¥éœ€æ±‚ä¹Ÿæä¾›äº†ç›¸åº”çš„æ”¯æŒï¼Œæ¯”å¦‚ MySQL çš„è‡ªå¢é”®ï¼ŒOracle çš„è‡ªå¢åºåˆ—ç­‰</em>ã€‚</p><h3 id="31-ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#31-ä¼˜ç‚¹"></a> 3.1. ä¼˜ç‚¹</h3><ul><li>éå¸¸ç®€å•ï¼Œåˆ©ç”¨ç°æœ‰æ•°æ®åº“çš„åŠŸèƒ½å®ç°ï¼Œæˆæœ¬å°ï¼Œæœ‰ DBA ä¸“ä¸šç»´æŠ¤</li><li>æœ‰åºé€’å¢</li><li>æ–¹ä¾¿æ’åºå’Œåˆ†é¡µ</li></ul><h3 id="32-ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#32-ç¼ºç‚¹"></a> 3.2. ç¼ºç‚¹</h3><ul><li>å¼ºä¾èµ–æ•°æ®åº“ï¼Œå½“æ•°æ®åº“å¼‚å¸¸æ—¶æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚é…ç½®ä¸»ä»å¤åˆ¶å¯ä»¥å°½å¯èƒ½çš„å¢åŠ å¯ç”¨æ€§ï¼Œä½†æ˜¯æ•°æ®ä¸€è‡´æ€§åœ¨ç‰¹æ®Šæƒ…å†µä¸‹éš¾ä»¥ä¿è¯ã€‚ä¸»ä»åˆ‡æ¢æ—¶çš„ä¸ä¸€è‡´å¯èƒ½ä¼šå¯¼è‡´é‡å¤å‘å·ã€‚</li><li>ç”Ÿæˆ ID æ€§èƒ½ç“¶é¢ˆé™åˆ¶åœ¨å•å° MySQL çš„è¯»å†™æ€§èƒ½ã€‚</li><li>ç®€å•é€’å¢å®¹æ˜“è¢«å…¶ä»–äººåˆ†æåˆ©ç”¨<ul><li>æ¯”å¦‚æ ¹æ®ç”¨æˆ· ID æ¥åˆ†ææ³¨å†Œäººæ•°ï¼ŒçŒœæµ‹å‡ºæœåŠ¡çš„ä¸€ä¸ªå¤§æ¦‚çŠ¶å†µã€‚</li></ul></li></ul><h3 id="33-é€‚ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#33-é€‚ç”¨åœºæ™¯"></a> 3.3. é€‚ç”¨åœºæ™¯</h3><p>æ•°æ®é‡ä¸å¤§ï¼Œå¹¶å‘ä¸é«˜çš„åœºæ™¯ã€‚</p><h3 id="34-æ”¹è¿›"><a class="markdownIt-Anchor" href="#34-æ”¹è¿›"></a> 3.4. æ”¹è¿›</h3><p>å¯¹äº MySQL æ€§èƒ½é—®é¢˜ï¼Œå¯ç”¨å¦‚ä¸‹æ–¹æ¡ˆè§£å†³ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æˆ‘ä»¬å¯ä»¥å¤šéƒ¨ç½²å‡ å°æœºå™¨ï¼Œæ¯å°æœºå™¨è®¾ç½®ä¸åŒçš„åˆå§‹å€¼ï¼Œä¸”æ­¥é•¿å’Œæœºå™¨æ•°ç›¸ç­‰ã€‚æ¯”å¦‚æœ‰ä¸¤å°æœºå™¨ã€‚è®¾ç½®æ­¥é•¿ step ä¸º 2ï¼ŒTicketServer1 çš„åˆå§‹å€¼ä¸º 1ï¼ˆ1ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ9ï¼Œ11â€¦ï¼‰ã€TicketServer2 çš„åˆå§‹å€¼ä¸º 2ï¼ˆ2ï¼Œ4ï¼Œ6ï¼Œ8ï¼Œ10â€¦ï¼‰ã€‚è¿™æ˜¯ Flickr å›¢é˜Ÿåœ¨ 2010 å¹´æ’°æ–‡ä»‹ç»çš„ä¸€ç§ä¸»é”®ç”Ÿæˆç­–ç•¥ï¼ˆ<a href="http://code.flickr.net/2010/02/08/ticket-servers-distributed-unique-primary-keys-on-the-cheap/" target="_blank" rel="noopener">Ticket Servers: Distributed Unique Primary Keys on the Cheap </a>ï¼‰ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸ºäº†å®ç°ä¸Šè¿°æ–¹æ¡ˆåˆ†åˆ«è®¾ç½®ä¸¤å°æœºå™¨å¯¹åº”çš„å‚æ•°ï¼ŒTicketServer1 ä» 1 å¼€å§‹å‘å·ï¼ŒTicketServer2 ä» 2 å¼€å§‹å‘å·ï¼Œä¸¤å°æœºå™¨æ¯æ¬¡å‘å·ä¹‹åéƒ½é€’å¢ 2ã€‚</p><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">TicketServer1:</span><br><span class="line">auto-<span class="keyword">increment</span>-<span class="keyword">increment</span> = <span class="number">2</span></span><br><span class="line">auto-<span class="keyword">increment</span>-offset = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">TicketServer2:</span><br><span class="line">auto-<span class="keyword">increment</span>-<span class="keyword">increment</span> = <span class="number">2</span></span><br><span class="line">auto-<span class="keyword">increment</span>-offset = <span class="number">2</span></span><br></pre></td></tr></table></figure><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2017/6d2c9ec8.png" alt="image" /></p><p>è¿™ç§æ¶æ„å­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ul><li>ç³»ç»Ÿæ°´å¹³æ‰©å±•æ¯”è¾ƒå›°éš¾ï¼Œæ¯”å¦‚å®šä¹‰å¥½äº†æ­¥é•¿å’Œæœºå™¨å°æ•°ä¹‹åï¼Œå¦‚æœè¦æ·»åŠ æœºå™¨è¯¥æ€ä¹ˆåšï¼Ÿå‡è®¾ç°åœ¨åªæœ‰ä¸€å°æœºå™¨å‘å·æ˜¯ 1,2,3,4,5ï¼ˆæ­¥é•¿æ˜¯ 1ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ‰©å®¹æœºå™¨ä¸€å°ã€‚å¯ä»¥è¿™æ ·åšï¼šæŠŠç¬¬äºŒå°æœºå™¨çš„åˆå§‹å€¼è®¾ç½®å¾—æ¯”ç¬¬ä¸€å°è¶…è¿‡å¾ˆå¤šï¼Œæ¯”å¦‚ 14ï¼ˆå‡è®¾åœ¨æ‰©å®¹æ—¶é—´ä¹‹å†…ç¬¬ä¸€å°ä¸å¯èƒ½å‘åˆ° 14ï¼‰ï¼ŒåŒæ—¶è®¾ç½®æ­¥é•¿ä¸º 2ï¼Œé‚£ä¹ˆè¿™å°æœºå™¨ä¸‹å‘çš„å·ç éƒ½æ˜¯ 14 ä»¥åçš„å¶æ•°ã€‚ç„¶åæ‘˜æ‰ç¬¬ä¸€å°ï¼ŒæŠŠ ID å€¼ä¿ç•™ä¸ºå¥‡æ•°ï¼Œæ¯”å¦‚ 7ï¼Œç„¶åä¿®æ”¹ç¬¬ä¸€å°çš„æ­¥é•¿ä¸º 2ã€‚è®©å®ƒç¬¦åˆæˆ‘ä»¬å®šä¹‰çš„å·æ®µæ ‡å‡†ï¼Œå¯¹äºè¿™ä¸ªä¾‹å­æ¥è¯´å°±æ˜¯è®©ç¬¬ä¸€å°ä»¥ååªèƒ½äº§ç”Ÿå¥‡æ•°ã€‚æ‰©å®¹æ–¹æ¡ˆçœ‹èµ·æ¥å¤æ‚å—ï¼Ÿè²Œä¼¼è¿˜å¥½ï¼Œç°åœ¨æƒ³è±¡ä¸€ä¸‹å¦‚æœæˆ‘ä»¬çº¿ä¸Šæœ‰ 100 å°æœºå™¨ï¼Œè¿™ä¸ªæ—¶å€™è¦æ‰©å®¹è¯¥æ€ä¹ˆåšï¼Ÿç®€ç›´æ˜¯å™©æ¢¦ã€‚æ‰€ä»¥ç³»ç»Ÿæ°´å¹³æ‰©å±•æ–¹æ¡ˆå¤æ‚éš¾ä»¥å®ç°ã€‚</li><li>ID æ²¡æœ‰äº†å•è°ƒé€’å¢çš„ç‰¹æ€§ï¼Œåªèƒ½è¶‹åŠ¿é€’å¢ï¼Œè¿™ä¸ªç¼ºç‚¹å¯¹äºä¸€èˆ¬ä¸šåŠ¡éœ€æ±‚ä¸æ˜¯å¾ˆé‡è¦ï¼Œå¯ä»¥å®¹å¿ã€‚</li><li>æ•°æ®åº“å‹åŠ›è¿˜æ˜¯å¾ˆå¤§ï¼Œæ¯æ¬¡è·å– ID éƒ½å¾—è¯»å†™ä¸€æ¬¡æ•°æ®åº“ï¼Œåªèƒ½é å †æœºå™¨æ¥æé«˜æ€§èƒ½ã€‚</li></ul><h2 id="4-åˆ©ç”¨-redis-ç”Ÿæˆé”®"><a class="markdownIt-Anchor" href="#4-åˆ©ç”¨-redis-ç”Ÿæˆé”®"></a> 4. åˆ©ç”¨ Redis ç”Ÿæˆé”®</h2><p>Redis ä¸­æœ‰ä¸¤ä¸ªå‘½ä»¤ <code>Incr</code>ï¼Œ<code>IncrBy</code>ã€‚</p><p>å› ä¸º Redis æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥èƒ½ä¿è¯åŸå­æ€§ã€‚</p><h3 id="41-ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#41-ä¼˜ç‚¹"></a> 4.1. ä¼˜ç‚¹</h3><ul><li>æ€§èƒ½æ¯”æ•°æ®åº“å¥½</li><li>èƒ½æ»¡è¶³æœ‰åºé€’å¢</li></ul><h3 id="42-ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#42-ç¼ºç‚¹"></a> 4.2. ç¼ºç‚¹</h3><ul><li>ç”±äº Redis æ˜¯å†…å­˜æ•°æ®åº“ï¼Œå³ä½¿æ”¯æŒæŒä¹…åŒ–ï¼ˆAOF å’Œ RDBï¼‰ï¼Œä½†æ˜¯ä¾ç„¶å¯èƒ½ä¸¢å¤±æ•°æ®ï¼Œé€ æˆ ID é‡å¤ã€‚</li><li>ä¾èµ–äº Redis ç”Ÿæˆé”®ï¼Œå¦‚æœ Redis æœåŠ¡ä¸ç¨³å®šï¼Œä¼šå½±å“ ID ç”Ÿæˆã€‚</li></ul><h3 id="43-é€‚ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#43-é€‚ç”¨åœºæ™¯"></a> 4.3. é€‚ç”¨åœºæ™¯</h3><p>Redis æ€§èƒ½æ¯”æ•°æ®åº“å¥½ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šå‡ºç° ID é‡å¤å’Œä¸ç¨³å®šã€‚å¦‚æœå¯ä»¥æ¥å—ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ¡ˆã€‚</p><h2 id="5-é›ªèŠ±ç®—æ³•snowflake"><a class="markdownIt-Anchor" href="#5-é›ªèŠ±ç®—æ³•snowflake"></a> 5. é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰</h2><p>é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰æ˜¯ç”± Twitter å…¬å¸ƒçš„åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆç®—æ³•ï¼Œ<strong>å®ƒä¼šç”Ÿæˆä¸€ä¸ª <code>64 bit</code> çš„æ•´æ•°</strong>ï¼Œå¯ä»¥ä¿è¯ä¸åŒè¿›ç¨‹ä¸»é”®çš„ä¸é‡å¤æ€§ï¼Œä»¥åŠç›¸åŒè¿›ç¨‹ä¸»é”®çš„æœ‰åºæ€§ã€‚</p><p>åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå®ƒé¦–å…ˆæ˜¯é€šè¿‡æ—¶é—´ä½ä¿è¯ä¸é‡å¤ï¼Œå¦‚æœæ—¶é—´ç›¸åŒåˆ™æ˜¯é€šè¿‡åºåˆ—ä½ä¿è¯ã€‚ åŒæ—¶ç”±äºæ—¶é—´ä½æ˜¯å•è°ƒé€’å¢çš„ï¼Œä¸”å„ä¸ªæœåŠ¡å™¨å¦‚æœå¤§ä½“åšäº†æ—¶é—´åŒæ­¥ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ä¸»é”®åœ¨åˆ†å¸ƒå¼ç¯å¢ƒå¯ä»¥è®¤ä¸ºæ˜¯æ€»ä½“æœ‰åºçš„ï¼Œè¿™å°±ä¿è¯äº†å¯¹ç´¢å¼•å­—æ®µçš„æ’å…¥çš„é«˜æ•ˆæ€§ã€‚</p><h3 id="51-åŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#51-åŸºæœ¬åŸç†"></a> 5.1. åŸºæœ¬åŸç†</h3><h4 id="é”®çš„ç»„æˆ"><a class="markdownIt-Anchor" href="#é”®çš„ç»„æˆ"></a> é”®çš„ç»„æˆ</h4><p>ä½¿ç”¨<strong>é›ªèŠ±ç®—æ³•ç”Ÿæˆçš„ä¸»é”®ï¼ŒäºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼åŒ…å« 4 éƒ¨åˆ†</strong>ï¼Œä»é«˜ä½åˆ°ä½ä½åˆ†è¡¨ä¸ºï¼š1bit ç¬¦å·ä½ã€41bit æ—¶é—´æˆ³ä½ã€10bit å·¥ä½œè¿›ç¨‹ä½ä»¥åŠ 12bit åºåˆ—å·ä½ã€‚</p><ul><li><strong>ç¬¦å·ä½(1bit)</strong></li></ul><p>é¢„ç•™çš„ç¬¦å·ä½ï¼Œæ’ä¸ºé›¶ã€‚</p><ul><li><strong>æ—¶é—´æˆ³ä½(41bit)</strong></li></ul><p>41 ä½çš„æ—¶é—´æˆ³å¯ä»¥å®¹çº³çš„æ¯«ç§’æ•°æ˜¯ 2 çš„ 41 æ¬¡å¹‚ï¼Œä¸€å¹´æ‰€ä½¿ç”¨çš„æ¯«ç§’æ•°æ˜¯ï¼š<code>365 * 24 * 60 * 60 * 1000</code>ã€‚é€šè¿‡è®¡ç®—å¯çŸ¥ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Math.pow(<span class="number">2</span>, <span class="number">41</span>) / (<span class="number">365</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000L</span>);</span><br></pre></td></tr></table></figure><p>ç»“æœçº¦ç­‰äº 69.73 å¹´ã€‚ShardingSphere çš„é›ªèŠ±ç®—æ³•çš„æ—¶é—´çºªå…ƒä» 2016 å¹´ 11 æœˆ 1 æ—¥é›¶ç‚¹å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨åˆ° 2086 å¹´ï¼Œç›¸ä¿¡èƒ½æ»¡è¶³ç»å¤§éƒ¨åˆ†ç³»ç»Ÿçš„è¦æ±‚ã€‚</p><ul><li><strong>å·¥ä½œè¿›ç¨‹ä½(10bit)</strong></li></ul><p>è¯¥æ ‡å¿—åœ¨ Java è¿›ç¨‹å†…æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼åº”ç”¨éƒ¨ç½²åº”ä¿è¯æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„ id æ˜¯ä¸åŒçš„ã€‚è¯¥å€¼é»˜è®¤ä¸º 0ï¼Œå¯é€šè¿‡å±æ€§è®¾ç½®ã€‚</p><ul><li><strong>åºåˆ—å·ä½(12bit)</strong></li></ul><p>è¯¥åºåˆ—æ˜¯ç”¨æ¥åœ¨åŒä¸€ä¸ªæ¯«ç§’å†…ç”Ÿæˆä¸åŒçš„ IDã€‚å¦‚æœåœ¨è¿™ä¸ªæ¯«ç§’å†…ç”Ÿæˆçš„æ•°é‡è¶…è¿‡ 4096(2 çš„ 12 æ¬¡å¹‚)ï¼Œé‚£ä¹ˆç”Ÿæˆå™¨ä¼šç­‰å¾…åˆ°ä¸‹ä¸ªæ¯«ç§’ç»§ç»­ç”Ÿæˆã€‚</p><p>é›ªèŠ±ç®—æ³•ä¸»é”®çš„è¯¦ç»†ç»“æ„è§ä¸‹å›¾ï¼š</p><p><img src="https://shardingsphere.apache.org/document/current/img/sharding/snowflake_cn_v2.png" alt="é›ªèŠ±ç®—æ³•" /></p><h4 id="æ—¶é’Ÿå›æ‹¨"><a class="markdownIt-Anchor" href="#æ—¶é’Ÿå›æ‹¨"></a> æ—¶é’Ÿå›æ‹¨</h4><p>æœåŠ¡å™¨æ—¶é’Ÿå›æ‹¨ä¼šå¯¼è‡´äº§ç”Ÿé‡å¤åºåˆ—ï¼Œå› æ­¤é»˜è®¤åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨æä¾›äº†ä¸€ä¸ªæœ€å¤§å®¹å¿çš„æ—¶é’Ÿå›æ‹¨æ¯«ç§’æ•°ã€‚ å¦‚æœæ—¶é’Ÿå›æ‹¨çš„æ—¶é—´è¶…è¿‡æœ€å¤§å®¹å¿çš„æ¯«ç§’æ•°é˜ˆå€¼ï¼Œåˆ™ç¨‹åºæŠ¥é”™ï¼›å¦‚æœåœ¨å¯å®¹å¿çš„èŒƒå›´å†…ï¼Œé»˜è®¤åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ä¼šç­‰å¾…æ—¶é’ŸåŒæ­¥åˆ°æœ€åä¸€æ¬¡ä¸»é”®ç”Ÿæˆçš„æ—¶é—´åå†ç»§ç»­å·¥ä½œã€‚ æœ€å¤§å®¹å¿çš„æ—¶é’Ÿå›æ‹¨æ¯«ç§’æ•°çš„é»˜è®¤å€¼ä¸º 0ï¼Œå¯é€šè¿‡å±æ€§è®¾ç½®ã€‚</p><h4 id="çµæ´»å®šåˆ¶"><a class="markdownIt-Anchor" href="#çµæ´»å®šåˆ¶"></a> çµæ´»å®šåˆ¶</h4><p>ä¸Šé¢åªæ˜¯ä¸€ä¸ªå°† <code>64bit</code> åˆ’åˆ†çš„æ ‡å‡†ï¼Œå½“ç„¶ä¹Ÿä¸ä¸€å®šè¿™ä¹ˆåšï¼Œå¯ä»¥æ ¹æ®ä¸åŒä¸šåŠ¡çš„å…·ä½“åœºæ™¯æ¥åˆ’åˆ†ï¼Œæ¯”å¦‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸šåŠ¡åœºæ™¯ï¼š</p><ul><li>æœåŠ¡ç›®å‰ QPS10 ä¸‡ï¼Œé¢„è®¡å‡ å¹´ä¹‹å†…ä¼šå‘å±•åˆ°ç™¾ä¸‡ã€‚</li><li>å½“å‰æœºå™¨ä¸‰åœ°éƒ¨ç½²ï¼Œä¸Šæµ·ï¼ŒåŒ—äº¬ï¼Œæ·±åœ³éƒ½æœ‰ã€‚</li><li>å½“å‰æœºå™¨ 10 å°å·¦å³ï¼Œé¢„è®¡æœªæ¥ä¼šå¢åŠ è‡³ç™¾å°ã€‚</li></ul><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ ¹æ®ä¸Šé¢çš„åœºæ™¯å¯ä»¥å†æ¬¡åˆç†çš„åˆ’åˆ† 62bitï¼ŒQPS å‡ å¹´ä¹‹å†…ä¼šå‘å±•åˆ°ç™¾ä¸‡ï¼Œé‚£ä¹ˆæ¯æ¯«ç§’å°±æ˜¯åƒçº§çš„è¯·æ±‚ï¼Œç›®å‰ 10 å°æœºå™¨é‚£ä¹ˆæ¯å°æœºå™¨æ‰¿æ‹…ç™¾çº§çš„è¯·æ±‚ï¼Œä¸ºäº†ä¿è¯æ‰©å±•ï¼Œåé¢çš„å¾ªç¯ä½å¯ä»¥é™åˆ¶åˆ° 1024ï¼Œä¹Ÿå°±æ˜¯ 2^10ï¼Œé‚£ä¹ˆå¾ªç¯ä½ 10 ä½å°±è¶³å¤Ÿäº†ã€‚</p><p>æœºå™¨ä¸‰åœ°éƒ¨ç½²æˆ‘ä»¬å¯ä»¥ç”¨ 3bit æ€»å…± 8 æ¥è¡¨ç¤ºæœºæˆ¿ä½ç½®ï¼Œå½“å‰çš„æœºå™¨ 10 å°ï¼Œä¸ºäº†ä¿è¯æ‰©å±•åˆ°ç™¾å°é‚£ä¹ˆå¯ä»¥ç”¨ 7bit 128 æ¥è¡¨ç¤ºï¼Œæ—¶é—´ä½ä¾ç„¶æ˜¯ 41bitï¼Œé‚£ä¹ˆè¿˜å‰©ä¸‹ 64-10-3-7-41-1 = 2bitï¼Œè¿˜å‰©ä¸‹ 2bit å¯ä»¥ç”¨æ¥è¿›è¡Œæ‰©å±•ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2018/9/29/16624909d2007c22?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="" /></p><h3 id="52-ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#52-ä¼˜ç‚¹"></a> 5.2. ä¼˜ç‚¹</h3><ul><li>ç”Ÿæˆçš„ ID éƒ½æ˜¯è¶‹åŠ¿é€’å¢çš„ã€‚</li><li>ä¸ä¾èµ–æ•°æ®åº“ç­‰ç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Œä»¥æœåŠ¡çš„æ–¹å¼éƒ¨ç½²ï¼Œç¨³å®šæ€§æ›´é«˜ï¼Œç”Ÿæˆ ID çš„æ€§èƒ½ä¹Ÿæ˜¯éå¸¸é«˜çš„ã€‚</li><li>å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹æ€§åˆ†é… bit ä½ï¼Œéå¸¸çµæ´»ã€‚</li></ul><h3 id="53-ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#53-ç¼ºç‚¹"></a> 5.3. ç¼ºç‚¹</h3><ul><li>å¼ºä¾èµ–æœºå™¨æ—¶é’Ÿï¼Œå¦‚æœæœºå™¨ä¸Šæ—¶é’Ÿå›æ‹¨ï¼Œä¼šå¯¼è‡´å‘å·é‡å¤æˆ–è€…æœåŠ¡ä¼šå¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚</li></ul><h3 id="54-é€‚ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#54-é€‚ç”¨åœºæ™¯"></a> 5.4. é€‚ç”¨åœºæ™¯</h3><p>å½“æˆ‘ä»¬éœ€è¦æ— åºä¸èƒ½è¢«çŒœæµ‹çš„ IDï¼Œå¹¶ä¸”éœ€è¦ä¸€å®šé«˜æ€§èƒ½ï¼Œä¸”éœ€è¦ long å‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬é›ªèŠ±ç®—æ³•ã€‚æ¯”å¦‚å¸¸è§çš„è®¢å• IDï¼Œç”¨é›ªèŠ±ç®—æ³•åˆ«äººå°±æ— æ³•çŒœæµ‹ä½ æ¯å¤©çš„è®¢å•é‡æ˜¯å¤šå°‘ã€‚</p><h3 id="55-é˜²æ­¢æ—¶é’Ÿå›æ‹¨"><a class="markdownIt-Anchor" href="#55-é˜²æ­¢æ—¶é’Ÿå›æ‹¨"></a> 5.5. é˜²æ­¢æ—¶é’Ÿå›æ‹¨</h3><p>é›ªèŠ±ç®—æ³•æ˜¯å¼ºä¾èµ–äºæ—¶é—´çš„ï¼Œè€Œå¦‚æœæœºå™¨æ—¶é—´å‘ç”Ÿå›æ‹¨ï¼Œæœ‰å¯èƒ½ä¼šç”Ÿæˆé‡å¤çš„ IDã€‚</p><p>æˆ‘ä»¬å¯ä»¥é’ˆå¯¹ç®—æ³•åšä¸€äº›ä¼˜åŒ–ï¼Œæ¥é˜²æ­¢æ—¶é’Ÿå›æ‹¨ç”Ÿæˆé‡å¤ IDã€‚</p><p>ç”¨å½“å‰æ—¶é—´å’Œä¸Šä¸€æ¬¡çš„æ—¶é—´è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ—¶é—´å°äºä¸Šä¸€æ¬¡çš„æ—¶é—´é‚£ä¹ˆè‚¯å®šæ˜¯å‘ç”Ÿäº†å›æ‹¨ã€‚æ™®é€šçš„ç®—æ³•ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸¤ä¸ªæƒ…å†µ:</p><ul><li>å¦‚æœæ—¶é—´å›æ‹¨æ—¶é—´è¾ƒçŸ­ï¼Œæ¯”å¦‚é…ç½® <code>5ms</code> ä»¥å†…ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œè®©æœºå™¨çš„æ—¶é—´è¿½ä¸Šæ¥ã€‚</li><li>å¦‚æœæ—¶é—´çš„å›æ‹¨æ—¶é—´è¾ƒé•¿ï¼Œæˆ‘ä»¬ä¸èƒ½æ¥å—è¿™ä¹ˆé•¿çš„é˜»å¡ç­‰å¾…ï¼Œé‚£ä¹ˆåˆæœ‰ä¸¤ä¸ªç­–ç•¥:<ul><li>ç›´æ¥æ‹’ç»ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚æ‰“æ—¥å¿—ï¼Œé€šçŸ¥ RD æ—¶é’Ÿå›æ»šã€‚</li><li>åˆ©ç”¨æ‰©å±•ä½ã€‚ä¸Šé¢æˆ‘ä»¬è®¨è®ºè¿‡ï¼Œä¸åŒä¸šåŠ¡åœºæ™¯ä½æ•°å¯èƒ½ç”¨ä¸åˆ°é‚£ä¹ˆå¤šæ¯”ç‰¹ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠæ‰©å±•ä½æ•°åˆ©ç”¨èµ·æ¥ã€‚æ¯”å¦‚ï¼šå½“è¿™ä¸ªæ—¶é—´å›æ‹¨æ¯”è¾ƒé•¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸éœ€è¦ç­‰å¾…ï¼Œç›´æ¥åœ¨æ‰©å±•ä½åŠ  1ã€‚ä¸¤ä½çš„æ‰©å±•ä½å…è®¸æˆ‘ä»¬æœ‰ä¸‰æ¬¡å¤§çš„æ—¶é’Ÿå›æ‹¨ï¼Œä¸€èˆ¬æ¥è¯´å°±å¤Ÿäº†ï¼Œå¦‚æœå…¶è¶…è¿‡ä¸‰æ¬¡æˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰“æ—¥å¿—ã€‚</li></ul></li></ul><h2 id="6-leaf"><a class="markdownIt-Anchor" href="#6-leaf"></a> 6. Leaf</h2><blockquote><p>ç¾å›¢æä¾›äº†ä¸€ç§åˆ†å¸ƒå¼ ID è§£å†³æ–¹æ¡ˆ Leafï¼Œå…¶æœ¬è´¨å¯ä»¥è§†ä¸ºæ•°æ®åº“åˆ†æ®µ+æœåŠ¡ç¼“å­˜ IDã€‚</p><p>è¯¦æƒ…å¯ä»¥å‚è€ƒ <a href="https://tech.meituan.com/2017/04/21/mt-leaf.html" target="_blank" rel="noopener">Leafâ€”â€”ç¾å›¢ç‚¹è¯„åˆ†å¸ƒå¼ ID ç”Ÿæˆç³»ç»Ÿ</a></p></blockquote><h3 id="61-åŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#61-åŸºæœ¬åŸç†"></a> 6.1. åŸºæœ¬åŸç†</h3><p>ä½¿ç”¨æ•°æ®åº“ç”Ÿæˆ IDï¼Œä½†æ˜¯åšäº†å¦‚ä¸‹æ”¹è¿›ï¼š</p><p>åŸæ–¹æ¡ˆæ¯æ¬¡è·å– ID éƒ½å¾—è¯»å†™ä¸€æ¬¡æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›å¤§ã€‚æ”¹ä¸ºåˆ©ç”¨ proxy server æ‰¹é‡è·å–ï¼Œæ¯æ¬¡è·å–ä¸€ä¸ª segment(step å†³å®šå¤§å°)å·æ®µçš„å€¼ã€‚ç”¨å®Œä¹‹åå†å»æ•°æ®åº“è·å–æ–°çš„å·æ®µï¼Œå¯ä»¥å¤§å¤§çš„å‡è½»æ•°æ®åº“çš„å‹åŠ›ã€‚ - å„ä¸ªä¸šåŠ¡ä¸åŒçš„å‘å·éœ€æ±‚ç”¨ biz_tag å­—æ®µæ¥åŒºåˆ†ï¼Œæ¯ä¸ª biz-tag çš„ ID è·å–ç›¸äº’éš”ç¦»ï¼Œäº’ä¸å½±å“ã€‚å¦‚æœä»¥åæœ‰æ€§èƒ½éœ€æ±‚éœ€è¦å¯¹æ•°æ®åº“æ‰©å®¹ï¼Œä¸éœ€è¦ä¸Šè¿°æè¿°çš„å¤æ‚çš„æ‰©å®¹æ“ä½œï¼Œåªéœ€è¦å¯¹ biz_tag åˆ†åº“åˆ†è¡¨å°±è¡Œã€‚</p><p>æ•°æ®åº“è¡¨è®¾è®¡å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">+<span class="comment">-------------+--------------+------+-----+-------------------+-----------------------------+</span></span><br><span class="line">| Field       | Type         | Null | Key | Default           | Extra                       |</span><br><span class="line">+<span class="comment">-------------+--------------+------+-----+-------------------+-----------------------------+</span></span><br><span class="line">| biz_tag     | varchar(128) | NO   | PRI |                   |                             |</span><br><span class="line">| max_id      | bigint(20)   | NO   |     | 1                 |                             |</span><br><span class="line">| step        | int(11)      | NO   |     | NULL              |                             |</span><br><span class="line">| desc        | varchar(256) | YES  |     | NULL              |                             |</span><br><span class="line">| update_time | timestamp    | NO   |     | CURRENT_TIMESTAMP | on <span class="keyword">update</span> <span class="keyword">CURRENT_TIMESTAMP</span> |</span><br><span class="line">+<span class="comment">-------------+--------------+------+-----+-------------------+-----------------------------+</span></span><br></pre></td></tr></table></figure><p>é‡è¦å­—æ®µè¯´æ˜ï¼š</p><ul><li><code>biz_tag</code> ç”¨æ¥åŒºåˆ†ä¸šåŠ¡</li><li><code>max_id</code> è¡¨ç¤ºè¯¥ <code>biz_tag</code> ç›®å‰æ‰€è¢«åˆ†é…çš„ ID å·æ®µçš„æœ€å¤§å€¼</li><li><code>step</code> è¡¨ç¤ºæ¯æ¬¡åˆ†é…çš„å·æ®µé•¿åº¦ã€‚åŸæ¥è·å– ID æ¯æ¬¡éƒ½éœ€è¦å†™æ•°æ®åº“ï¼Œç°åœ¨åªéœ€è¦æŠŠ <code>step</code> è®¾ç½®å¾—è¶³å¤Ÿå¤§ï¼Œæ¯”å¦‚ 1000ã€‚é‚£ä¹ˆåªæœ‰å½“ 1000 ä¸ªå·è¢«æ¶ˆè€—å®Œäº†ä¹‹åæ‰ä¼šå»é‡æ–°è¯»å†™ä¸€æ¬¡æ•°æ®åº“ã€‚è¯»å†™æ•°æ®åº“çš„é¢‘ç‡ä» 1 å‡å°åˆ°äº† 1/stepã€‚</li></ul><p>å¤§è‡´æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2017/5e4ff128.png" alt="image" /></p><p>test_tag åœ¨ç¬¬ä¸€å° Leaf æœºå™¨ä¸Šæ˜¯ <code>1~1000</code> çš„å·æ®µï¼Œå½“è¿™ä¸ªå·æ®µç”¨å®Œæ—¶ï¼Œä¼šå»åŠ è½½å¦ä¸€ä¸ªé•¿åº¦ä¸º step=1000 çš„å·æ®µï¼Œå‡è®¾å¦å¤–ä¸¤å°å·æ®µéƒ½æ²¡æœ‰æ›´æ–°ï¼Œè¿™ä¸ªæ—¶å€™ç¬¬ä¸€å°æœºå™¨æ–°åŠ è½½çš„å·æ®µå°±åº”è¯¥æ˜¯ <code>3001~4000</code>ã€‚åŒæ—¶æ•°æ®åº“å¯¹åº”çš„ biz_tag è¿™æ¡æ•°æ®çš„ max_id ä¼šä» 3000 è¢«æ›´æ–°æˆ 4000ï¼Œæ›´æ–°å·æ®µçš„ SQL è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Begin</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">table</span> <span class="keyword">SET</span> max_id=max_id+step <span class="keyword">WHERE</span> biz_tag=xxx</span><br><span class="line"><span class="keyword">SELECT</span> tag, max_id, step <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> biz_tag=xxx</span><br><span class="line"><span class="keyword">Commit</span></span><br></pre></td></tr></table></figure><h3 id="62-ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#62-ä¼˜ç‚¹"></a> 6.2. ä¼˜ç‚¹</h3><ul><li>æ¯”æ•°æ®åº“è‡ªå¢é”®æ€§èƒ½é«˜</li><li>èƒ½ä¿è¯é”®è¶‹åŠ¿é€’å¢ã€‚</li><li>å¦‚æœæ•°æ®åº“å®•æœºï¼Œç”±äº proxServer æœ‰ç¼“å­˜ï¼Œä¾ç„¶å¯ä»¥åšæŒä¸€æ®µæ—¶é—´ã€‚</li></ul><h3 id="63-ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#63-ç¼ºç‚¹"></a> 6.3. ç¼ºç‚¹</h3><ul><li>å’Œä¸»é”®é€’å¢ä¸€æ ·ï¼Œå®¹æ˜“è¢«äººçŒœæµ‹ã€‚</li><li>æ•°æ®åº“å®•æœºåï¼Œè™½ç„¶èƒ½æ”¯æ’‘ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯ä»ç„¶ä¼šé€ æˆç³»ç»Ÿä¸å¯ç”¨ã€‚</li></ul><h3 id="64-é€‚ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#64-é€‚ç”¨åœºæ™¯"></a> 6.4. é€‚ç”¨åœºæ™¯</h3><p>éœ€è¦è¶‹åŠ¿é€’å¢ï¼Œå¹¶ä¸” ID å¤§å°å¯æ§åˆ¶çš„ï¼Œå¯ä»¥ä½¿ç”¨è¿™å¥—æ–¹æ¡ˆã€‚</p><p>å½“ç„¶è¿™ä¸ªæ–¹æ¡ˆä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›æ‰‹æ®µé¿å…è¢«äººçŒœæµ‹ï¼ŒæŠŠ ID å˜æˆæ˜¯æ— åºçš„ï¼Œæ¯”å¦‚æŠŠæˆ‘ä»¬ç”Ÿæˆçš„æ•°æ®æ˜¯ä¸€ä¸ªé€’å¢çš„ long å‹ï¼ŒæŠŠè¿™ä¸ª Long åˆ†æˆå‡ ä¸ªéƒ¨åˆ†ï¼Œæ¯”å¦‚å¯ä»¥åˆ†æˆå‡ ç»„ä¸‰ä½æ•°ï¼Œå‡ ç»„å››ä½æ•°ï¼Œç„¶ååœ¨å»ºç«‹ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œå°†æˆ‘ä»¬çš„æ•°æ®å˜æˆæ— åºã€‚</p><h2 id="7-å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#7-å‚è€ƒèµ„æ–™"></a> 7. å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://github.com/baidu/uid-generator/blob/master/README.zh_cn.md" target="_blank" rel="noopener">ç™¾åº¦åˆ†å¸ƒå¼ ID</a></li><li><a href="https://juejin.im/post/5bb0217ef265da0ac2567b42" target="_blank" rel="noopener">å¦‚æœå†æœ‰äººé—®ä½ åˆ†å¸ƒå¼ IDï¼Œè¿™ç¯‡æ–‡ç« ä¸¢ç»™ä»–</a></li><li><a href="https://segmentfault.com/a/1190000011282426" target="_blank" rel="noopener">ç†è§£åˆ†å¸ƒå¼ id ç”Ÿæˆç®—æ³• SnowFlake</a></li><li><a href="https://tech.meituan.com/2017/04/21/mt-leaf.html" target="_blank" rel="noopener">Leafâ€”â€”ç¾å›¢ç‚¹è¯„åˆ†å¸ƒå¼ ID ç”Ÿæˆç³»ç»Ÿ</a></li><li><a href="https://www.ietf.org/rfc/rfc4122.txt" target="_blank" rel="noopener">UUID è§„èŒƒ</a></li><li><a href="https://shardingsphere.apache.org/document/current/cn/features/sharding/other-features/key-generator/" target="_blank" rel="noopener">ShardingSphere åˆ†å¸ƒå¼ä¸»é”®</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;åˆ†å¸ƒå¼-id-åŸºæœ¬åŸç†&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#åˆ†å¸ƒå¼-id-åŸºæœ¬åŸç†&quot;&gt;&lt;/a&gt; åˆ†å¸ƒå¼ ID åŸºæœ¬åŸç†&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¼ ç»Ÿæ•°æ®åº“è½¯ä»¶å¼€å‘ä¸­ï¼Œä¸»é”®è‡ªåŠ¨ç”ŸæˆæŠ€æœ¯æ˜¯åŸºæœ¬éœ€æ±‚ã€‚è€Œå„ä¸ªæ•°æ®åº“å¯¹
      
    
    </summary>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/tags/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/tags/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
      <category term="åˆ†å¸ƒå¼ ID" scheme="https://dunwu.github.io/blog/tags/%E5%88%86%E5%B8%83%E5%BC%8F-ID/"/>
    
  </entry>
  
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—åŸºæœ¬åŸç†</title>
    <link href="https://dunwu.github.io/blog/design/theory/mq-theory/"/>
    <id>https://dunwu.github.io/blog/design/theory/mq-theory/</id>
    <published>2019-07-05T07:11:00.000Z</published>
    <updated>2020-01-20T03:26:54.204Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¶ˆæ¯é˜Ÿåˆ—åŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#æ¶ˆæ¯é˜Ÿåˆ—åŸºæœ¬åŸç†"></a> æ¶ˆæ¯é˜Ÿåˆ—åŸºæœ¬åŸç†</h1><blockquote><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼Œç®€ç§° MQï¼‰æŠ€æœ¯æ˜¯åˆ†å¸ƒå¼åº”ç”¨é—´äº¤æ¢ä¿¡æ¯çš„ä¸€ç§æŠ€æœ¯ã€‚</p><p>æ¶ˆæ¯é˜Ÿåˆ—ä¸»è¦è§£å†³åº”ç”¨è€¦åˆï¼Œå¼‚æ­¥æ¶ˆæ¯ï¼Œæµé‡å‰Šé”‹ç­‰é—®é¢˜ï¼Œå®ç°é«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨ï¼Œå¯ä¼¸ç¼©å’Œæœ€ç»ˆä¸€è‡´æ€§æ¶æ„ã€‚æ˜¯å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯ç¼ºå°‘çš„ä¸­é—´ä»¶ã€‚</p><p>æ³¨æ„ï¼š<em>ä¸ºäº†ç®€ä¾¿ï¼Œä¸‹æ–‡ä¸­é™¤äº†æ–‡ç« æ ‡é¢˜ï¼Œä¸€å¾‹ä½¿ç”¨ MQ ç®€ç§°</em>ã€‚</p></blockquote><h2 id="1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-mq"><a class="markdownIt-Anchor" href="#1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-mq"></a> 1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ MQ</h2><p>MQ æ¯”è¾ƒæ ¸å¿ƒçš„ä¼˜ç‚¹æœ‰ 3 ä¸ªï¼š<strong>è§£è€¦</strong>ã€<strong>å¼‚æ­¥</strong>ã€<strong>å‰Šå³°</strong>ã€‚</p><h3 id="11-è§£è€¦"><a class="markdownIt-Anchor" href="#11-è§£è€¦"></a> 1.1. è§£è€¦</h3><p>ä¸åŒç³»ç»Ÿå¦‚æœè¦å»ºç«‹é€šä¿¡ï¼Œä¼ ç»Ÿçš„åšæ³•æ˜¯ï¼šè°ƒç”¨æ¥å£ã€‚</p><p>å¦‚æœéœ€è¦å’Œæ–°çš„ç³»ç»Ÿå»ºç«‹é€šä¿¡æˆ–åˆ é™¤å·²å»ºç«‹çš„é€šä¿¡ï¼Œéƒ½éœ€è¦ä¿®æ”¹ä»£ç ï¼Œè¿™ç§æ–¹æ¡ˆæ˜¾ç„¶è€¦åˆåº¦å¾ˆé«˜ã€‚</p><p><img src="http://dunwu.test.upcdn.net/cs/design/theory/mq/mq_1.png" alt="" /></p><p>å¦‚æœä½¿ç”¨ MQï¼Œç³»ç»Ÿé—´çš„é€šä¿¡åªéœ€è¦é€šè¿‡å‘å¸ƒ/è®¢é˜…ï¼ˆPub/Subï¼‰æ¨¡å‹å³å¯ï¼Œå½¼æ­¤æ²¡æœ‰ç›´æ¥è”ç³»ï¼Œä¹Ÿå°±ä¸éœ€è¦ç›¸äº’æ„ŸçŸ¥ï¼Œä»è€Œè¾¾åˆ° <strong>è§£è€¦</strong>ã€‚</p><p><img src="http://dunwu.test.upcdn.net/cs/design/theory/mq/mq_2.png" alt="" /></p><h3 id="12-å¼‚æ­¥"><a class="markdownIt-Anchor" href="#12-å¼‚æ­¥"></a> 1.2. å¼‚æ­¥</h3><p>å‡è®¾è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œç”¨æˆ·å‘ç³»ç»Ÿ A å‘èµ·è¯·æ±‚ï¼Œç³»ç»Ÿ A å¤„ç†è®¡ç®—åªéœ€è¦ 10 msï¼Œç„¶åé€šçŸ¥ç³»ç»Ÿ BCD å†™åº“ï¼Œç³»ç»Ÿ BCD å†™åº“è€—æ—¶åˆ†åˆ«ä¸ºï¼š100msã€200msã€300msã€‚æœ€ç»ˆæ€»è€—æ—¶ä¸ºï¼š 10+100ms+200ms+300ms=610msã€‚æ­¤å¤–ï¼ŒåŠ ä¸Šè¯·æ±‚å’Œå“åº”çš„ç½‘ç»œä¼ è¾“æ—¶é—´ï¼Œä»ç”¨æˆ·è§’åº¦çœ‹ï¼Œå¯èƒ½è¦ç­‰å¾…å°†è¿‘ 1s æ‰èƒ½å¾—åˆ°ç»“æœã€‚</p><p><img src="http://dunwu.test.upcdn.net/cs/design/theory/mq/mq_3.png" alt="" /></p><p>å¦‚æœä½¿ç”¨ MQï¼Œç³»ç»Ÿ A æ¥åˆ°è¯·æ±‚åï¼Œè€—æ—¶ 10ms å¤„ç†è®¡ç®—ï¼Œç„¶åå‘ç³»ç»Ÿ BCD è¿ç»­å‘é€æ¶ˆæ¯ï¼Œå‡è®¾è€—æ—¶ 5msã€‚é‚£ä¹ˆ è¿™ä¸€è¿‡ç¨‹çš„æ€»è€—æ—¶ä¸º 3ms + 5ms = 8msï¼Œè¿™ç›¸æ¯”äº 610 msï¼Œå¤§å¤§ç¼©çŸ­äº†å“åº”æ—¶é—´ã€‚è‡³äºç³»ç»Ÿ BCD çš„å†™åº“æ“ä½œï¼Œåªè¦è‡ªè¡Œæ¶ˆè´¹ MQ åå¤„ç†å³å¯ï¼Œç”¨æˆ·æ— éœ€å…³æ³¨ã€‚</p><p><img src="http://dunwu.test.upcdn.net/cs/design/theory/mq/mq_4.png" alt="" /></p><h3 id="13-å‰Šå³°"><a class="markdownIt-Anchor" href="#13-å‰Šå³°"></a> 1.3. å‰Šå³°</h3><p>å‡è®¾æŸä¸ªç³»ç»Ÿè¯»å†™æ•°æ®åº“çš„ç¨³å®šæ€§èƒ½ä¸ºæ¯ç§’å¤„ç† 1000 æ¡æ•°æ®ã€‚å¹³å¸¸æƒ…å†µä¸‹ï¼Œè¿œè¿œè¾¾ä¸åˆ°è¿™ä¹ˆå¤§çš„å¤„ç†é‡ã€‚å‡è®¾ï¼Œå› ä¸ºå› ä¸ºåšæ´»åŠ¨ï¼Œç³»ç»Ÿçš„ç¬æ—¶è¯·æ±‚é‡å‰§å¢ï¼Œè¾¾åˆ°æ¯ç§’ 10000 ä¸ªå¹¶å‘è¯·æ±‚ï¼Œæ•°æ®åº“æ ¹æœ¬æ‰¿å—ä¸äº†ï¼Œå¯èƒ½ç›´æ¥å°±æŠŠæ•°æ®åº“ç»™æ•´å´©æºƒäº†ï¼Œè¿™æ ·ç³»ç»ŸæœåŠ¡å°±ä¸å¯ç”¨äº†ã€‚</p><p><img src="http://dunwu.test.upcdn.net/cs/design/theory/mq/mq_5.png" alt="" /></p><p>å¦‚æœä½¿ç”¨ MQï¼Œæ¯ç§’å†™å…¥ 10000 æ¡è¯·æ±‚ï¼Œä½†æ˜¯ç³»ç»Ÿ A æ¯ç§’åªä» MQ ä¸­æ¶ˆè´¹ 1000 æ¡è¯·æ±‚ï¼Œç„¶åå†™å…¥æ•°æ®åº“ã€‚è¿™æ ·ï¼Œå°±ä¸ä¼šè¶…è¿‡æ•°æ®åº“çš„æ‰¿å—èƒ½åŠ›ï¼Œè€Œæ˜¯æŠŠè¯·æ±‚ç§¯å‹åœ¨ MQ ä¸­ã€‚åªè¦é«˜å³°æœŸä¸€è¿‡ï¼Œç³»ç»Ÿ A å°±ä¼šå¾ˆå¿«æŠŠç§¯å‹çš„æ¶ˆæ¯ç»™å¤„ç†æ‰ã€‚</p><p><img src="http://dunwu.test.upcdn.net/cs/design/theory/mq/mq_6.png" alt="" /></p><h2 id="2-mq-å¼•å…¥çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#2-mq-å¼•å…¥çš„é—®é¢˜"></a> 2. MQ å¼•å…¥çš„é—®é¢˜</h2><p>å‡¡äº‹æœ‰åˆ©æœ‰å¼Šï¼Œä½¿ç”¨ MQ ç»™ç³»ç»Ÿå¸¦æ¥å¾ˆå¤šå¥½å¤„ï¼Œä¹Ÿä¼šä»˜å‡ºä¸€å®šçš„ä»£ä»·ã€‚</p><p>å®ƒå¼•å…¥äº†ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li><strong>ç³»ç»Ÿå¯ç”¨æ€§é™ä½</strong> - å¼•å…¥äº† MQ åï¼Œé€šä¿¡éœ€è¦åŸºäº MQ å®Œæˆï¼Œå¦‚æœ MQ å®•æœºï¼Œåˆ™æœåŠ¡ä¸å¯ç”¨ã€‚å› æ­¤ï¼ŒMQ è¦ä¿è¯æ˜¯é«˜å¯ç”¨çš„ï¼Œè¯¦æƒ…å‚è€ƒï¼š<a href="#MQ-%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8">MQ çš„é«˜å¯ç”¨</a></li><li><strong>ç³»ç»Ÿå¤æ‚åº¦æé«˜</strong> - ä½¿ç”¨ MQï¼Œéœ€è¦å…³æ³¨ä¸€äº›æ–°çš„é—®é¢˜ï¼š<ul><li>å¦‚ä½•ä¿è¯æ¶ˆæ¯æ²¡æœ‰é‡å¤æ¶ˆè´¹ï¼Ÿ</li><li>å¦‚ä½•å¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„é—®é¢˜ï¼Ÿ</li><li>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¼ é€’çš„é¡ºåºæ€§ï¼Ÿ</li><li>å¦‚ä½•å¤„ç†å¤§é‡æ¶ˆæ¯ç§¯å‹çš„é—®é¢˜ï¼Ÿ</li></ul></li><li><strong>ä¸€è‡´æ€§é—®é¢˜</strong> - å‡è®¾ç³»ç»Ÿ A å¤„ç†å®Œç›´æ¥è¿”å›æˆåŠŸçš„ç»“æœç»™ç”¨æˆ·ï¼Œç”¨æˆ·è®¤ä¸ºè¯·æ±‚æˆåŠŸã€‚ä½†å¦‚æœæ­¤æ—¶ï¼Œç³»ç»Ÿ BCD ä¸­åªè¦æœ‰ä»»æ„ä¸€ä¸ªå†™åº“å¤±è´¥ï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸ä¸€è‡´äº†ã€‚è¿™ç§æƒ…å†µå¦‚ä½•å¤„ç†ï¼Ÿ</li></ul><h3 id="21-é‡å¤æ¶ˆè´¹"><a class="markdownIt-Anchor" href="#21-é‡å¤æ¶ˆè´¹"></a> 2.1. é‡å¤æ¶ˆè´¹</h3><p><strong>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹</strong> å’Œ <strong>å¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹çš„å¹‚ç­‰æ€§</strong> æ˜¯åŒä¸€ä¸ªé—®é¢˜ã€‚</p><p>å¿…é¡»å…ˆæ˜ç¡®äº§ç”Ÿé‡å¤æ¶ˆè´¹çš„åŸå› ï¼Œæ‰èƒ½å¯¹ç—‡ä¸‹è¯ã€‚</p><h4 id="211-é‡å¤æ¶ˆè´¹é—®é¢˜åŸå› "><a class="markdownIt-Anchor" href="#211-é‡å¤æ¶ˆè´¹é—®é¢˜åŸå› "></a> 2.1.1. é‡å¤æ¶ˆè´¹é—®é¢˜åŸå› </h4><p>é‡å¤æ¶ˆè´¹é—®é¢˜é€šå¸¸ä¸æ˜¯ MQ æ¥å¤„ç†ï¼Œè€Œæ˜¯ç”±å¼€å‘æ¥å¤„ç†çš„ã€‚</p><p>ä»¥ Kafka ä¸¾ä¾‹ï¼šKafka æ¯ä¸ª Partition éƒ½æ˜¯ä¸€ä¸ªæœ‰åºçš„ã€ä¸å¯å˜çš„è®°å½•åºåˆ—ï¼Œä¸æ–­è¿½åŠ åˆ°ç»“æ„åŒ–çš„æäº¤æ—¥å¿—ä¸­ã€‚Partition ä¸­çš„è®°å½•æ¯ä¸ªåˆ†é…ä¸€ä¸ªè¿ç»­çš„ id å·ï¼Œç§°ä¸ºåç§»é‡ï¼ˆOffsetï¼‰ï¼Œç”¨äºå”¯ä¸€æ ‡è¯† Partition å†…çš„æ¯æ¡è®°å½•ã€‚</p><p><img src="http://kafka.apachecn.org/10/images/log_consumer.png" alt="" /></p><p>Kafka çš„å®¢æˆ·ç«¯å’Œ Broker éƒ½ä¼šä¿å­˜ Offsetã€‚å®¢æˆ·ç«¯æ¶ˆè´¹æ¶ˆæ¯åï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå°±æŠŠå·²æ¶ˆè´¹çš„ Offset æäº¤ç»™ Kafka Brokerï¼Œè¡¨ç¤ºå·²æ¶ˆè´¹ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯åº”ç”¨æ¶ˆè´¹æ¶ˆæ¯åï¼Œå› ä¸ºå®•æœºã€é‡å¯ç­‰æƒ…å†µè€Œæ²¡æœ‰æäº¤å·²æ¶ˆè´¹çš„ Offset ã€‚å½“ç³»ç»Ÿæ¢å¤åï¼Œä¼šç»§ç»­æ¶ˆè´¹æ¶ˆæ¯ï¼Œç”±äº Offset æœªæäº¤ï¼Œå°±ä¼šå‡ºç°é‡å¤æ¶ˆè´¹çš„é—®é¢˜ã€‚</p><p><img src="http://upload-images.jianshu.io/upload_images/3101171-75abe308f9cf21f8.png" alt="" /></p><h4 id="212-é‡å¤æ¶ˆè´¹è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#212-é‡å¤æ¶ˆè´¹è§£å†³æ–¹æ¡ˆ"></a> 2.1.2. é‡å¤æ¶ˆè´¹è§£å†³æ–¹æ¡ˆ</h4><p>åº”å¯¹é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Œå°±è¦é€šè¿‡å¹‚ç­‰æ€§æ¥è§£å†³ã€‚</p><p>è¿™ä¸ªé—®é¢˜å¯ä»¥ä»ä¸šåŠ¡å±‚é¢æ¥è§£å†³ã€‚</p><p>MQ é‡å¤æ¶ˆè´¹ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯æ²¡æœ‰åº”å¯¹æœºåˆ¶ï¼Œå¯ä»¥å€Ÿé‰´çš„æ€è·¯æœ‰ï¼š</p><ul><li>å¦‚æœæ˜¯å†™åº“ï¼Œå¯ä»¥å…ˆæ ¹æ®ä¸»é”®æŸ¥è¯¢ï¼Œåˆ¤æ–­æ•°æ®æ˜¯å¦å·²å­˜åœ¨ï¼Œå­˜åœ¨åˆ™æ›´æ–°ï¼Œä¸å­˜åœ¨åˆ™æ’å…¥ï¼›</li><li>å¦‚æœæ˜¯å†™ Redisï¼Œset æ“ä½œï¼Œç”±äºå¤©ç„¶å…·æœ‰å¹‚ç­‰æ€§ï¼Œå¤§å¯æ”¾å¿ƒï¼›</li><li>å¦‚æœæ˜¯æ ¹æ®æ¶ˆæ¯åšè¾ƒå¤æ‚çš„é€»è¾‘å¤„ç†ï¼Œå¯ä»¥åœ¨æ¶ˆæ¯ä¸­åŠ å…¥å…¨å±€å”¯ä¸€ IDï¼Œä¾‹å¦‚ï¼šè®¢å• ID ç­‰ã€‚åœ¨å®¢æˆ·ç«¯å­˜å‚¨ä¸­ï¼ˆMysqlã€Redis ç­‰ï¼‰ä¿å­˜å·²æ¶ˆè´¹æ¶ˆæ¯çš„ IDã€‚ä¸€æ—¦æ¥å—åˆ°æ–°æ¶ˆæ¯ï¼Œå…ˆåˆ¤æ–­æ¶ˆæ¯ä¸­çš„ ID æ˜¯å¦åœ¨å·²æ¶ˆè´¹æ¶ˆæ¯ ID è¡¨ä¸­å­˜åœ¨ï¼Œå­˜åœ¨åˆ™ä¸å†å¤„ç†ï¼Œä¸å­˜åœ¨åˆ™å¤„ç†ã€‚</li></ul><h3 id="22-æ¶ˆæ¯ä¸¢å¤±"><a class="markdownIt-Anchor" href="#22-æ¶ˆæ¯ä¸¢å¤±"></a> 2.2. æ¶ˆæ¯ä¸¢å¤±</h3><p><strong>å¦‚ä½•å¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„é—®é¢˜</strong> å’Œ <strong>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹</strong> æ˜¯åŒä¸€ä¸ªé—®é¢˜ã€‚å…³æ³¨ç‚¹æœ‰æŒ‰ä¸ªï¼š</p><ul><li>Kafka ä¸¢å¤±æ•°æ®</li><li>æ¶ˆè´¹æ–¹ä¸¢å¤±æ•°æ®</li><li>ç”Ÿäº§æ–¹ä¸¢å¤±æ•°æ®</li></ul><h4 id="221-æ¶ˆè´¹æ–¹ä¸¢å¤±æ•°æ®"><a class="markdownIt-Anchor" href="#221-æ¶ˆè´¹æ–¹ä¸¢å¤±æ•°æ®"></a> 2.2.1. æ¶ˆè´¹æ–¹ä¸¢å¤±æ•°æ®</h4><p>å”¯ä¸€å¯èƒ½å¯¼è‡´æ¶ˆè´¹æ–¹ä¸¢å¤±æ•°æ®çš„æƒ…å†µï¼Œå°±æ˜¯ï¼šæ¶ˆè´¹æ–¹è®¾ç½®äº†<strong>è‡ªåŠ¨æäº¤ Offset</strong>ã€‚è®¾ç½®äº†è‡ªåŠ¨æäº¤ Offsetï¼Œæ¥å—åˆ°æ¶ˆæ¯åå°±ä¼šè‡ªåŠ¨æäº¤ Offset ç»™ Kafka ï¼ŒKafka å°±è®¤ä¸ºæ¶ˆæ¯å·²è¢«æ¶ˆè´¹ã€‚å¦‚æœæ­¤æ—¶ï¼Œæ¶ˆè´¹æ–¹å°šæœªæ¥å¾—åŠå¤„ç†æ¶ˆæ¯å°±æŒ‚äº†ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸¢äº†ã€‚</p><p>è§£å†³æ–¹æ³•å°±æ˜¯æ¶ˆè´¹æ–¹å…³é—­è‡ªåŠ¨æäº¤ Offsetï¼Œå¤„ç†å®Œæ¶ˆæ¯åæ‰‹åŠ¨æäº¤ Offsetã€‚ä½†è¿™ç§æƒ…å†µä¸‹å¯èƒ½ä¼šå‡ºç°é‡å¤æ¶ˆè´¹çš„æƒ…å½¢ï¼Œéœ€è¦è‡ªè¡Œä¿è¯å¹‚ç­‰æ€§ã€‚</p><h4 id="222-kafka-ä¸¢å¤±æ•°æ®"><a class="markdownIt-Anchor" href="#222-kafka-ä¸¢å¤±æ•°æ®"></a> 2.2.2. Kafka ä¸¢å¤±æ•°æ®</h4><p>å½“ Kafka æŸä¸ª Broker å®•æœºï¼Œéœ€è¦é‡æ–°é€‰ä¸¾ Partition çš„ Leaderã€‚è‹¥æ­¤æ—¶å…¶ä»–çš„ Follower å°šæœªåŒæ­¥ Leader çš„æ•°æ®ï¼Œé‚£ä¹ˆæ–°é€‰æŸä¸ª Follower ä¸º Leader åï¼Œå°±ä¸¢å¤±äº†éƒ¨åˆ†æ•°æ®ã€‚</p><p>ä¸ºæ­¤ï¼Œä¸€èˆ¬è¦æ±‚è‡³å°‘è®¾ç½® 4 ä¸ªå‚æ•°ï¼š</p><ul><li>ç»™ Topic è®¾ç½® <code>replication.factor</code> å‚æ•° - è¿™ä¸ªå€¼å¿…é¡»å¤§äº 1ï¼Œè¦æ±‚æ¯ä¸ª Partition å¿…é¡»æœ‰è‡³å°‘ 2 ä¸ªå‰¯æœ¬ã€‚</li><li>åœ¨ Kafka æœåŠ¡ç«¯è®¾ç½® <code>min.insync.replicas</code> å‚æ•° - è¿™ä¸ªå€¼å¿…é¡»å¤§äº 1ï¼Œè¿™æ˜¯è¦æ±‚ä¸€ä¸ª Leader éœ€è¦å’Œè‡³å°‘ä¸€ä¸ª Follower ä¿æŒé€šä¿¡ï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿ Leader æŒ‚äº†è¿˜æœ‰æ›¿è¡¥ã€‚</li><li>åœ¨ Producer ç«¯è®¾ç½® <code>acks=all</code> - è¿™æ„å‘³ç€ï¼šè¦æ±‚æ¯æ¡æ•°æ®ï¼Œå¿…é¡»æ˜¯<strong>å†™å…¥æ‰€æœ‰ replica ä¹‹åï¼Œæ‰èƒ½è®¤ä¸ºæ˜¯å†™æˆåŠŸäº†</strong>ã€‚</li><li>åœ¨ Producer ç«¯è®¾ç½® <code>retries=MAX</code>ï¼ˆå¾ˆå¤§å¾ˆå¤§å¾ˆå¤§çš„ä¸€ä¸ªå€¼ï¼Œæ— é™æ¬¡é‡è¯•çš„æ„æ€ï¼‰ - è¿™æ„å‘³ç€<strong>è¦æ±‚ä¸€æ—¦å†™å…¥å¤±è´¥ï¼Œå°±æ— é™é‡è¯•</strong>ï¼Œå¡åœ¨è¿™é‡Œäº†ã€‚</li></ul><h4 id="223-ç”Ÿäº§æ–¹ä¸¢å¤±æ•°æ®"><a class="markdownIt-Anchor" href="#223-ç”Ÿäº§æ–¹ä¸¢å¤±æ•°æ®"></a> 2.2.3. ç”Ÿäº§æ–¹ä¸¢å¤±æ•°æ®</h4><p>å¦‚æœæŒ‰ç…§ä¸Šè¿°çš„æ€è·¯è®¾ç½®äº† <code>acks=all</code>ï¼Œç”Ÿäº§æ–¹ä¸€å®šä¸ä¼šä¸¢æ•°æ®ã€‚</p><p>è¦æ±‚æ˜¯ï¼Œä½ çš„ Leader æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œæ‰€æœ‰çš„ Follower éƒ½åŒæ­¥åˆ°äº†æ¶ˆæ¯ä¹‹åï¼Œæ‰è®¤ä¸ºæœ¬ç”Ÿäº§æ¶ˆæ¯æˆåŠŸäº†ã€‚å¦‚æœæœªæ»¡è¶³è¿™ä¸ªæ¡ä»¶ï¼Œç”Ÿäº§è€…ä¼šè‡ªåŠ¨ä¸æ–­çš„é‡è¯•ï¼Œé‡è¯•æ— é™æ¬¡ã€‚</p><h3 id="23-æ¶ˆæ¯çš„é¡ºåºæ€§"><a class="markdownIt-Anchor" href="#23-æ¶ˆæ¯çš„é¡ºåºæ€§"></a> 2.3. æ¶ˆæ¯çš„é¡ºåºæ€§</h3><blockquote><p>ä»¥ Kafka ä¸ºä¾‹</p></blockquote><p>è¦ä¿è¯ MQ çš„é¡ºåºæ€§ï¼ŒåŠ¿å¿…è¦ä»˜å‡ºä¸€å®šçš„ä»£ä»·ï¼Œæ‰€ä»¥å®æ–½æ–¹æ¡ˆå‰ï¼Œè¦å…ˆæ˜ç¡®ä¸šåŠ¡åœºæ™¯æ˜¯ä¸æ˜¯æœ‰å¿…è¦ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚åªæœ‰é‚£äº›æ˜ç¡®å¯¹æ¶ˆæ¯å¤„ç†é¡ºåºæœ‰è¦æ±‚çš„ä¸šåŠ¡åœºæ™¯æ‰å€¼å¾—å»ä¿è¯æ¶ˆæ¯é¡ºåºæ€§ã€‚</p><p>æ–¹æ¡ˆä¸€</p><p>ä¸€ä¸ª Topicï¼Œä¸€ä¸ª Partitionï¼Œä¸€ä¸ª Consumerï¼Œå†…éƒ¨å•çº¿ç¨‹æ¶ˆè´¹ï¼Œå•çº¿ç¨‹ååé‡å¤ªä½ï¼Œä¸€èˆ¬ä¸ä¼šç”¨è¿™ä¸ªã€‚</p><p>æ–¹æ¡ˆäºŒ</p><ul><li>å†™å…¥æ•°æ®åˆ° Partition æ—¶æŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„ Keyï¼Œä¾‹å¦‚è®¢å• IDã€‚ç”±å‘é€æ–¹ä¿è¯ç›¸åŒ Key çš„æ¶ˆæ¯åªèƒ½å‘é€åˆ°åŒä¸€ä¸ª Partition å¹¶ä¸”è¿™ä¸ª Partition ä¸­çš„æ•°æ®ä¸€å®šæ˜¯é¡ºåºçš„ã€‚</li><li>åŸºäºä¸Šä¸€ç‚¹ï¼Œæ¶ˆè´¹æ–¹ä» Kafka Partition ä¸­æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œæ­¤åˆ»ä¸€å®šæ˜¯é¡ºåºçš„ã€‚ä½†å¦‚æœæ¶ˆè´¹æ–¹å¼ä»¥å¹¶å‘æ–¹å¼æ¶ˆè´¹æ¶ˆæ¯ï¼Œé¡ºåºå°±å¯èƒ½ä¼šè¢«æ‰“ä¹±ã€‚ä¸ºæ­¤ï¼Œè¿˜æœ‰åšåˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š<ul><li>æ¶ˆè´¹æ–¹ç»´æŠ¤ N ä¸ªç¼“å­˜é˜Ÿåˆ—ï¼Œå…·æœ‰ç›¸åŒ key çš„æ•°æ®éƒ½å†™å…¥åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼›</li><li>åˆ›å»º N ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åªè´Ÿè´£ä»æŒ‡å®šçš„ä¸€ä¸ªé˜Ÿåˆ—ä¸­å–æ•°æ®ã€‚</li></ul></li></ul><p><img src="http://dunwu.test.upcdn.net/cs/design/theory/mq/mq_7.png" alt="" /></p><h3 id="24-æ¶ˆæ¯ç§¯å‹"><a class="markdownIt-Anchor" href="#24-æ¶ˆæ¯ç§¯å‹"></a> 2.4. æ¶ˆæ¯ç§¯å‹</h3><p>å‡è®¾ä¸€ä¸ª MQ æ¶ˆè´¹è€…å¯ä»¥ä¸€ç§’å¤„ç† 1000 æ¡æ¶ˆæ¯ï¼Œä¸‰ä¸ª MQ æ¶ˆè´¹è€…å¯ä»¥ä¸€ç§’å¤„ç† 3000 æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆä¸€åˆ†é’Ÿçš„å¤„ç†é‡æ˜¯ 18 ä¸‡æ¡ã€‚å¦‚æœ MQ ä¸­ç§¯å‹äº†å‡ ç™¾ä¸‡åˆ°ä¸Šåƒä¸‡çš„æ•°æ®ï¼Œå³ä½¿æ¶ˆè´¹è€…æ¢å¤äº†ï¼Œä¹Ÿéœ€è¦å¤§æ¦‚å¾ˆé•¿çš„æ—¶é—´æ‰èƒ½æ¢å¤è¿‡æ¥ã€‚</p><p>å¯¹äºäº§çº¿ç¯å¢ƒæ¥è¯´ï¼Œæ¼«é•¿çš„ç­‰å¾…æ˜¯ä¸å¯æ¥å—çš„ï¼Œæ‰€ä»¥é¢ä¸´è¿™ç§çª˜å¢ƒæ—¶ï¼Œåªèƒ½ä¸´æ—¶ç´§æ€¥æ‰©å®¹ä»¥åº”å¯¹äº†ï¼Œå…·ä½“æ“ä½œæ­¥éª¤å’Œæ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>å…ˆä¿®å¤ Consumer çš„é—®é¢˜ï¼Œç¡®ä¿å…¶æ¢å¤æ¶ˆè´¹é€Ÿåº¦ï¼Œç„¶åå°†ç°æœ‰ Consumer éƒ½åœæ‰ã€‚</li><li>æ–°å»ºä¸€ä¸ª Topicï¼ŒPartition æ˜¯åŸæ¥çš„ 10 å€ï¼Œä¸´æ—¶å»ºç«‹å¥½åŸå…ˆ 10 å€çš„ Queue æ•°é‡ã€‚</li><li>ç„¶åå†™ä¸€ä¸ªä¸´æ—¶çš„åˆ†å‘æ•°æ®çš„ Consumer ç¨‹åºï¼Œè¿™ä¸ªç¨‹åºéƒ¨ç½²ä¸Šå»æ¶ˆè´¹ç§¯å‹çš„æ•°æ®ï¼Œ<strong>æ¶ˆè´¹ä¹‹åä¸åšè€—æ—¶çš„å¤„ç†</strong>ï¼Œç›´æ¥å‡åŒ€è½®è¯¢å†™å…¥ä¸´æ—¶å»ºç«‹å¥½çš„ 10 å€æ•°é‡çš„ Queueã€‚</li><li>æ¥ç€ä¸´æ—¶å¾ç”¨ 10 å€çš„æœºå™¨æ¥éƒ¨ç½² Consumer ï¼Œæ¯ä¸€æ‰¹ Consumer æ¶ˆè´¹ä¸€ä¸ªä¸´æ—¶ Queue çš„æ•°æ®ã€‚è¿™ç§åšæ³•ç›¸å½“äºæ˜¯ä¸´æ—¶å°† Queue èµ„æºå’Œ Consumer èµ„æºæ‰©å¤§ 10 å€ï¼Œä»¥æ­£å¸¸çš„ 10 å€é€Ÿåº¦æ¥æ¶ˆè´¹æ•°æ®ã€‚</li><li>ç­‰å¿«é€Ÿæ¶ˆè´¹å®Œç§¯å‹æ•°æ®ä¹‹åï¼Œ<strong>å¾—æ¢å¤åŸå…ˆéƒ¨ç½²çš„æ¶æ„</strong>ï¼Œ<strong>é‡æ–°</strong>ç”¨åŸå…ˆçš„ consumer æœºå™¨æ¥æ¶ˆè´¹æ¶ˆæ¯ã€‚</li></ul><h2 id="3-mq-çš„é«˜å¯ç”¨"><a class="markdownIt-Anchor" href="#3-mq-çš„é«˜å¯ç”¨"></a> 3. MQ çš„é«˜å¯ç”¨</h2><p>ä¸åŒ MQ å®ç°é«˜å¯ç”¨çš„åŸç†å„ä¸ç›¸åŒã€‚å› ä¸º Kafka æ¯”è¾ƒå…·æœ‰ä»£è¡¨æ€§ï¼Œæ‰€ä»¥è¿™é‡Œä»¥ Kafka ä¸ºä¾‹ã€‚</p><h3 id="31-kafka-çš„é«˜å¯ç”¨"><a class="markdownIt-Anchor" href="#31-kafka-çš„é«˜å¯ç”¨"></a> 3.1. Kafka çš„é«˜å¯ç”¨</h3><h4 id="311-kafka-çš„æ ¸å¿ƒæ¦‚å¿µ"><a class="markdownIt-Anchor" href="#311-kafka-çš„æ ¸å¿ƒæ¦‚å¿µ"></a> 3.1.1. Kafka çš„æ ¸å¿ƒæ¦‚å¿µ</h4><p>äº†è§£ Kafkaï¼Œå¿…é¡»å…ˆäº†è§£ Kafka çš„æ ¸å¿ƒæ¦‚å¿µï¼š</p><ul><li><p><strong>Broker</strong> - Kafka é›†ç¾¤åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ï¼Œè¿™ç§èŠ‚ç‚¹è¢«ç§°ä¸º Brokerã€‚</p></li><li><p><strong>Topic</strong> - æ¯æ¡å‘å¸ƒåˆ° Kafka é›†ç¾¤çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªç±»åˆ«ï¼Œè¿™ä¸ªç±»åˆ«è¢«ç§°ä¸º Topicã€‚ï¼ˆä¸åŒ Topic çš„æ¶ˆæ¯æ˜¯ç‰©ç†éš”ç¦»çš„ï¼›åŒä¸€ä¸ª Topic çš„æ¶ˆæ¯ä¿å­˜åœ¨ä¸€ä¸ªæˆ–å¤šä¸ª Broker ä¸Šï¼Œä½†ç”¨æˆ·åªéœ€æŒ‡å®šæ¶ˆæ¯çš„ Topic å³å¯ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®è€Œä¸å¿…å…³å¿ƒæ•°æ®å­˜äºä½•å¤„ï¼‰ã€‚å¯¹äºæ¯ä¸€ä¸ª Topicï¼Œ Kafka é›†ç¾¤éƒ½ä¼šç»´æŒä¸€ä¸ªåˆ†åŒºæ—¥å¿—ã€‚</p></li><li><p><strong>Partition</strong> - äº†æé«˜ Kafka çš„ååç‡ï¼Œæ¯ä¸ª Topic åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª Partitionï¼Œæ¯ä¸ª Partition åœ¨ç‰©ç†ä¸Šå¯¹åº”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹å­˜å‚¨è¿™ä¸ª Partition çš„æ‰€æœ‰æ¶ˆæ¯å’Œç´¢å¼•æ–‡ä»¶ã€‚</p><ul><li>Kafka æ—¥å¿—çš„åˆ†åŒºï¼ˆPartitionï¼‰åˆ†å¸ƒåœ¨ Kafka é›†ç¾¤çš„èŠ‚ç‚¹ä¸Šã€‚æ¯ä¸ªèŠ‚ç‚¹åœ¨å¤„ç†æ•°æ®å’Œè¯·æ±‚æ—¶ï¼Œå…±äº«è¿™äº›åˆ†åŒºã€‚æ¯ä¸€ä¸ªåˆ†åŒºéƒ½ä¼šåœ¨å·²é…ç½®çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œå¤‡ä»½ï¼Œç¡®ä¿å®¹é”™æ€§ã€‚</li></ul></li></ul><p><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/distributed/mq/kafka/kafka-cluster-roles.png" alt="" /></p><h4 id="312-kafka-çš„å‰¯æœ¬æœºåˆ¶"><a class="markdownIt-Anchor" href="#312-kafka-çš„å‰¯æœ¬æœºåˆ¶"></a> 3.1.2. Kafka çš„å‰¯æœ¬æœºåˆ¶</h4><p>Kafka æ˜¯å¦‚ä½•å®ç°é«˜å¯ç”¨çš„å‘¢ï¼Ÿ</p><p>Kafka åœ¨ 0.8 ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä¸€ä¸ª Broker å®•æœºäº†ï¼Œå…¶ä¸Šé¢çš„ Partition éƒ½ä¸èƒ½ç”¨äº†ï¼Œè¿™è‡ªç„¶ä¸æ˜¯é«˜å¯ç”¨çš„ã€‚</p><p>ä¸ºäº†å®ç°é«˜å¯ç”¨ï¼ŒKafka å¼•å…¥äº†å¤åˆ¶åŠŸèƒ½ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å‰¯æœ¬æœºåˆ¶ï¼ˆ Replicate ï¼‰ã€‚</p><p>æ¯ä¸ª Partition éƒ½æœ‰ä¸€ä¸ª Broker ä½œä¸º Leaderï¼Œé›¶ä¸ªæˆ–è€…å¤šä¸ª Broker ä½œä¸º Followerã€‚æ¯ä¸ª Broker éƒ½ä¼šæˆä¸ºæŸäº›åˆ†åŒºçš„ Leader å’ŒæŸäº›åˆ†åŒºçš„ Followerï¼Œå› æ­¤é›†ç¾¤çš„è´Ÿè½½æ˜¯å¹³è¡¡çš„ã€‚</p><ul><li><strong>Leader å¤„ç†ä¸€åˆ‡å¯¹ Partition ï¼ˆåˆ†åŒºï¼‰çš„è¯»å†™è¯·æ±‚</strong>ï¼›</li><li><strong>è€Œ Follower åªéœ€è¢«åŠ¨çš„åŒæ­¥ Leader ä¸Šçš„æ•°æ®</strong>ã€‚</li></ul><p>åŒä¸€ä¸ª Topic çš„ä¸åŒ Partition ä¼šåˆ†å¸ƒåœ¨å¤šä¸ª Broker ä¸Šï¼Œè€Œä¸”ä¸€ä¸ª Partition è¿˜ä¼šåœ¨å…¶ä»–çš„ Broker ä¸Šé¢è¿›è¡Œå¤‡ä»½ï¼ŒProducer åœ¨å‘å¸ƒæ¶ˆæ¯åˆ°æŸä¸ª Partition æ—¶ï¼Œå…ˆæ‰¾åˆ°è¯¥ Partition çš„ Leaderï¼Œç„¶åå‘è¿™ä¸ª Leader æ¨é€æ¶ˆæ¯ï¼›æ¯ä¸ª Follower éƒ½ä» Leader æ‹‰å–æ¶ˆæ¯ï¼Œæ‹‰å–æ¶ˆæ¯æˆåŠŸä¹‹åï¼Œå‘ Leader å‘é€ä¸€ä¸ª ACK ç¡®è®¤ã€‚</p><p><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/distributed/mq/kafka/kafka-replication.png" alt="" /></p><blockquote><p>FAQ</p><p>é—®ï¼šä¸ºä»€ä¹ˆè®© Leader å¤„ç†ä¸€åˆ‡å¯¹å¯¹ Partition ï¼ˆåˆ†åŒºï¼‰çš„è¯»å†™è¯·æ±‚ï¼Ÿ</p><p>ç­”ï¼šå› ä¸ºå¦‚æœå…è®¸æ‰€æœ‰ Broker éƒ½å¯ä»¥å¤„ç†è¯»å†™è¯·æ±‚ï¼Œå°±å¯èƒ½äº§ç”Ÿæ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</p></blockquote><h4 id="313-kafka-é€‰ä¸¾-leader"><a class="markdownIt-Anchor" href="#313-kafka-é€‰ä¸¾-leader"></a> 3.1.3. Kafka é€‰ä¸¾ Leader</h4><p>ç”±ä¸Šæ–‡å¯çŸ¥ï¼ŒPartition åœ¨å¤šä¸ª Broker ä¸Šå­˜åœ¨å‰¯æœ¬ã€‚</p><p>å¦‚æœæŸä¸ª Follower å®•æœºï¼Œå•¥äº‹å„¿æ²¡æœ‰ï¼Œæ­£å¸¸å·¥ä½œã€‚</p><p>å¦‚æœ Leader å®•æœºäº†ï¼Œä¼šä» Follower ä¸­<strong>é‡æ–°é€‰ä¸¾</strong>ä¸€ä¸ªæ–°çš„ Leaderã€‚</p><h2 id="4-mq-çš„é€šä¿¡æ¨¡å¼"><a class="markdownIt-Anchor" href="#4-mq-çš„é€šä¿¡æ¨¡å¼"></a> 4. MQ çš„é€šä¿¡æ¨¡å¼</h2><p>MQ å¯é©»ç•™åœ¨å†…å­˜æˆ–ç£ç›˜ä¸Šï¼Œé˜Ÿåˆ—å­˜å‚¨æ¶ˆæ¯ç›´åˆ°å®ƒä»¬è¢«åº”ç”¨ç¨‹åºè¯»å–ã€‚é€šè¿‡ MQï¼Œåº”ç”¨ç¨‹åºå¯ç‹¬ç«‹åœ°æ‰§è¡Œï¼Œå®ƒä»¬ä¸éœ€è¦çŸ¥é“å½¼æ­¤çš„ä½ç½®ï¼Œä¸éœ€è¦ç­‰å¾…æ¥æ”¶ç¨‹åºæ¥æ”¶æ­¤æ¶ˆæ¯ã€‚åœ¨åˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒä¸­ï¼Œä¸ºäº†é›†æˆåˆ†å¸ƒå¼åº”ç”¨ï¼Œå¼€å‘è€…éœ€è¦å¯¹å¼‚æ„ç½‘ç»œç¯å¢ƒä¸‹çš„åˆ†å¸ƒå¼åº”ç”¨æä¾›æœ‰æ•ˆçš„é€šä¿¡æ‰‹æ®µã€‚ä¸ºäº†ç®¡ç†éœ€è¦å…±äº«çš„ä¿¡æ¯ï¼Œå¯¹åº”ç”¨æä¾›å…¬å…±çš„ä¿¡æ¯äº¤æ¢æœºåˆ¶æ˜¯é‡è¦çš„ã€‚</p><ul><li><strong>ç‚¹å¯¹ç‚¹</strong> - ç‚¹å¯¹ç‚¹æ–¹å¼æ˜¯æœ€ä¸ºä¼ ç»Ÿå’Œå¸¸è§çš„é€šè®¯æ–¹å¼ï¼Œå®ƒæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šã€å¤šå¯¹ä¸€ç­‰å¤šç§é…ç½®æ–¹å¼ï¼Œæ”¯æŒæ ‘çŠ¶ã€ç½‘çŠ¶ç­‰å¤šç§æ‹“æ‰‘ç»“æ„ã€‚</li><li><strong>å¤šç‚¹å¹¿æ’­</strong> - MQ é€‚ç”¨äºä¸åŒç±»å‹çš„åº”ç”¨ã€‚å…¶ä¸­é‡è¦çš„ï¼Œä¹Ÿæ˜¯æ­£åœ¨å‘å±•ä¸­çš„æ˜¯&quot;å¤šç‚¹å¹¿æ’­&quot;åº”ç”¨ï¼Œå³èƒ½å¤Ÿå°†æ¶ˆæ¯å‘é€åˆ°å¤šä¸ªç›®æ ‡ç«™ç‚¹ (Destination List)ã€‚å¯ä»¥ä½¿ç”¨ä¸€æ¡ MQ æŒ‡ä»¤å°†å•ä¸€æ¶ˆæ¯å‘é€åˆ°å¤šä¸ªç›®æ ‡ç«™ç‚¹ï¼Œå¹¶ç¡®ä¿ä¸ºæ¯ä¸€ç«™ç‚¹å¯é åœ°æä¾›ä¿¡æ¯ã€‚MQ ä¸ä»…æä¾›äº†å¤šç‚¹å¹¿æ’­çš„åŠŸèƒ½ï¼Œè€Œä¸”è¿˜æ‹¥æœ‰æ™ºèƒ½æ¶ˆæ¯åˆ†å‘åŠŸèƒ½ï¼Œåœ¨å°†ä¸€æ¡æ¶ˆæ¯å‘é€åˆ°åŒä¸€ç³»ç»Ÿä¸Šçš„å¤šä¸ªç”¨æˆ·æ—¶ï¼ŒMQ å°†æ¶ˆæ¯çš„ä¸€ä¸ªå¤åˆ¶ç‰ˆæœ¬å’Œè¯¥ç³»ç»Ÿä¸Šæ¥æ”¶è€…çš„åå•å‘é€åˆ°ç›®æ ‡ MQ ç³»ç»Ÿã€‚ç›®æ ‡ MQ ç³»ç»Ÿåœ¨æœ¬åœ°å¤åˆ¶è¿™äº›æ¶ˆæ¯ï¼Œå¹¶å°†å®ƒä»¬å‘é€åˆ°åå•ä¸Šçš„é˜Ÿåˆ—ï¼Œä»è€Œå°½å¯èƒ½å‡å°‘ç½‘ç»œçš„ä¼ è¾“é‡ã€‚</li><li><strong>å‘å¸ƒ/è®¢é˜… (Publish/Subscribe)</strong> - å‘å¸ƒ/è®¢é˜…æ¨¡å¼ä½¿æ¶ˆæ¯çš„åˆ†å‘å¯ä»¥çªç ´ç›®çš„é˜Ÿåˆ—åœ°ç†ä½ç½®çš„é™åˆ¶ï¼Œä½¿æ¶ˆæ¯æŒ‰ç…§ç‰¹å®šçš„ä¸»é¢˜ç”šè‡³å†…å®¹è¿›è¡Œåˆ†å‘ï¼Œç”¨æˆ·æˆ–åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®ä¸»é¢˜æˆ–å†…å®¹æ¥æ”¶åˆ°æ‰€éœ€è¦çš„æ¶ˆæ¯ã€‚å‘å¸ƒ/è®¢é˜…æ¨¡å¼ä½¿å¾—å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»å˜å¾—æ›´ä¸ºæ¾æ•£ï¼Œå‘é€è€…ä¸å¿…å…³å¿ƒæ¥æ”¶è€…çš„ç›®çš„åœ°å€ï¼Œè€Œæ¥æ”¶è€…ä¹Ÿä¸å¿…å…³å¿ƒæ¶ˆæ¯çš„å‘é€åœ°å€ï¼Œè€Œåªæ˜¯æ ¹æ®æ¶ˆæ¯çš„ä¸»é¢˜è¿›è¡Œæ¶ˆæ¯çš„æ”¶å‘ã€‚</li><li><strong>é›†ç¾¤ (Cluster)</strong> - ä¸ºäº†ç®€åŒ–ç‚¹å¯¹ç‚¹é€šè®¯æ¨¡å¼ä¸­çš„ç³»ç»Ÿé…ç½®ï¼ŒMQ æä¾› Cluster(é›†ç¾¤) çš„è§£å†³æ–¹æ¡ˆã€‚é›†ç¾¤ç±»ä¼¼äºä¸€ä¸ªåŸŸ (Domain)ï¼Œé›†ç¾¤å†…éƒ¨çš„é˜Ÿåˆ—ç®¡ç†å™¨ä¹‹é—´é€šè®¯æ—¶ï¼Œä¸éœ€è¦ä¸¤ä¸¤ä¹‹é—´å»ºç«‹æ¶ˆæ¯é€šé“ï¼Œè€Œæ˜¯é‡‡ç”¨é›†ç¾¤ (Cluster) é€šé“ä¸å…¶å®ƒæˆå‘˜é€šè®¯ï¼Œä»è€Œå¤§å¤§ç®€åŒ–äº†ç³»ç»Ÿé…ç½®ã€‚æ­¤å¤–ï¼Œé›†ç¾¤ä¸­çš„é˜Ÿåˆ—ç®¡ç†å™¨ä¹‹é—´èƒ½å¤Ÿè‡ªåŠ¨è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå½“æŸä¸€é˜Ÿåˆ—ç®¡ç†å™¨å‡ºç°æ•…éšœæ—¶ï¼Œå…¶å®ƒé˜Ÿåˆ—ç®¡ç†å™¨å¯ä»¥æ¥ç®¡å®ƒçš„å·¥ä½œï¼Œä»è€Œå¤§å¤§æé«˜ç³»ç»Ÿçš„é«˜å¯é æ€§ã€‚</li></ul><h2 id="5-å¸¸ç”¨-mq-å¯¹æ¯”"><a class="markdownIt-Anchor" href="#5-å¸¸ç”¨-mq-å¯¹æ¯”"></a> 5. å¸¸ç”¨ MQ å¯¹æ¯”</h2><table><thead><tr><th>ç‰¹æ€§</th><th>ActiveMQ</th><th>RabbitMQ</th><th>RocketMQ</th><th>Kafka</th></tr></thead><tbody><tr><td>å•æœºååé‡</td><td>ä¸‡çº§ï¼Œæ¯” RocketMQã€Kafka ä½ä¸€ä¸ªæ•°é‡çº§</td><td>åŒ ActiveMQ</td><td>10 ä¸‡çº§ï¼Œæ”¯æ’‘é«˜åå</td><td>10 ä¸‡çº§ï¼Œé«˜ååï¼Œä¸€èˆ¬é…åˆå¤§æ•°æ®ç±»çš„ç³»ç»Ÿæ¥è¿›è¡Œå®æ—¶æ•°æ®è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯</td></tr><tr><td>topic æ•°é‡å¯¹ååé‡çš„å½±å“</td><td></td><td></td><td>topic å¯ä»¥è¾¾åˆ°å‡ ç™¾/å‡ åƒçš„çº§åˆ«ï¼Œååé‡ä¼šæœ‰è¾ƒå°å¹…åº¦çš„ä¸‹é™ï¼Œè¿™æ˜¯ RocketMQ çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œåœ¨åŒç­‰æœºå™¨ä¸‹ï¼Œå¯ä»¥æ”¯æ’‘å¤§é‡çš„ topic</td><td>topic ä»å‡ ååˆ°å‡ ç™¾ä¸ªæ—¶å€™ï¼Œååé‡ä¼šå¤§å¹…åº¦ä¸‹é™ï¼Œåœ¨åŒç­‰æœºå™¨ä¸‹ï¼ŒKafka å°½é‡ä¿è¯ topic æ•°é‡ä¸è¦è¿‡å¤šï¼Œå¦‚æœè¦æ”¯æ’‘å¤§è§„æ¨¡çš„ topicï¼Œéœ€è¦å¢åŠ æ›´å¤šçš„æœºå™¨èµ„æº</td></tr><tr><td>æ—¶æ•ˆæ€§</td><td>ms çº§</td><td>å¾®ç§’çº§ï¼Œè¿™æ˜¯ RabbitMQ çš„ä¸€å¤§ç‰¹ç‚¹ï¼Œå»¶è¿Ÿæœ€ä½</td><td>ms çº§</td><td>å»¶è¿Ÿåœ¨ ms çº§ä»¥å†…</td></tr><tr><td>å¯ç”¨æ€§</td><td>é«˜ï¼ŒåŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨</td><td>åŒ ActiveMQ</td><td>éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼æ¶æ„</td><td>éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼ï¼Œä¸€ä¸ªæ•°æ®å¤šä¸ªå‰¯æœ¬ï¼Œå°‘æ•°æœºå™¨å®•æœºï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´ä¸å¯ç”¨</td></tr><tr><td>æ¶ˆæ¯å¯é æ€§</td><td>æœ‰è¾ƒä½çš„æ¦‚ç‡ä¸¢å¤±æ•°æ®</td><td>åŸºæœ¬ä¸ä¸¢</td><td>ç»è¿‡å‚æ•°ä¼˜åŒ–é…ç½®ï¼Œå¯ä»¥åšåˆ° 0 ä¸¢å¤±</td><td>åŒ RocketMQ</td></tr><tr><td>åŠŸèƒ½æ”¯æŒ</td><td>MQ é¢†åŸŸçš„åŠŸèƒ½æå…¶å®Œå¤‡</td><td>åŸºäº erlang å¼€å‘ï¼Œå¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå¥½ï¼Œå»¶æ—¶å¾ˆä½</td><td>MQ åŠŸèƒ½è¾ƒä¸ºå®Œå–„ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰©å±•æ€§å¥½</td><td>åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ”¯æŒç®€å•çš„ MQ åŠŸèƒ½ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—é‡‡é›†è¢«å¤§è§„æ¨¡ä½¿ç”¨</td></tr></tbody></table><p>ç»¼ä¸Šï¼Œå„ç§å¯¹æ¯”ä¹‹åï¼Œæœ‰å¦‚ä¸‹å»ºè®®ï¼š</p><ul><li>ä¸€èˆ¬çš„ä¸šåŠ¡ç³»ç»Ÿè¦å¼•å…¥ MQï¼Œæœ€æ—©å¤§å®¶éƒ½ç”¨ ActiveMQï¼Œä½†æ˜¯ç°åœ¨ç¡®å®å¤§å®¶ç”¨çš„ä¸å¤šäº†ï¼Œæ²¡ç»è¿‡å¤§è§„æ¨¡ååé‡åœºæ™¯çš„éªŒè¯ï¼Œç¤¾åŒºä¹Ÿä¸æ˜¯å¾ˆæ´»è·ƒï¼Œæ‰€ä»¥å¤§å®¶è¿˜æ˜¯ç®—äº†å§ï¼Œæˆ‘ä¸ªäººä¸æ¨èç”¨è¿™ä¸ªäº†ï¼›</li><li>åæ¥å¤§å®¶å¼€å§‹ç”¨ RabbitMQï¼Œä½†æ˜¯ç¡®å® erlang è¯­è¨€é˜»æ­¢äº†å¤§é‡çš„ Java å·¥ç¨‹å¸ˆå»æ·±å…¥ç ”ç©¶å’ŒæŒæ§å®ƒï¼Œå¯¹å…¬å¸è€Œè¨€ï¼Œå‡ ä¹å¤„äºä¸å¯æ§çš„çŠ¶æ€ï¼Œä½†æ˜¯ç¡®å®äººå®¶æ˜¯å¼€æºçš„ï¼Œæ¯”è¾ƒç¨³å®šçš„æ”¯æŒï¼Œæ´»è·ƒåº¦ä¹Ÿé«˜ï¼›</li><li>ä¸è¿‡ç°åœ¨ç¡®å®è¶Šæ¥è¶Šå¤šçš„å…¬å¸ä¼šå»ç”¨ RocketMQï¼Œç¡®å®å¾ˆä¸é”™ï¼Œæ¯•ç«Ÿæ˜¯é˜¿é‡Œå‡ºå“ï¼Œä½†ç¤¾åŒºå¯èƒ½æœ‰çªç„¶é»„æ‰çš„é£é™©ï¼ˆç›®å‰ RocketMQ å·²æç»™ <a href="https://github.com/apache/rocketmq" target="_blank" rel="noopener">Apache</a>ï¼Œä½† GitHub ä¸Šçš„æ´»è·ƒåº¦å…¶å®ä¸ç®—é«˜ï¼‰å¯¹è‡ªå·±å…¬å¸æŠ€æœ¯å®åŠ›æœ‰ç»å¯¹è‡ªä¿¡çš„ï¼Œæ¨èç”¨ RocketMQï¼Œå¦åˆ™å›å»è€è€å®å®ç”¨ RabbitMQ å§ï¼Œäººå®¶æœ‰æ´»è·ƒçš„å¼€æºç¤¾åŒºï¼Œç»å¯¹ä¸ä¼šé»„ã€‚</li><li>æ‰€ä»¥<strong>ä¸­å°å‹å…¬å¸</strong>ï¼ŒæŠ€æœ¯å®åŠ›è¾ƒä¸ºä¸€èˆ¬ï¼ŒæŠ€æœ¯æŒ‘æˆ˜ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œç”¨ RabbitMQ æ˜¯ä¸é”™çš„é€‰æ‹©ï¼›<strong>å¤§å‹å…¬å¸</strong>ï¼ŒåŸºç¡€æ¶æ„ç ”å‘å®åŠ›è¾ƒå¼ºï¼Œç”¨ RocketMQ æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</li><li>å¦‚æœæ˜¯<strong>å¤§æ•°æ®é¢†åŸŸ</strong>çš„å®æ—¶è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯ï¼Œç”¨ Kafka æ˜¯ä¸šå†…æ ‡å‡†çš„ï¼Œç»å¯¹æ²¡é—®é¢˜ï¼Œç¤¾åŒºæ´»è·ƒåº¦å¾ˆé«˜ï¼Œç»å¯¹ä¸ä¼šé»„ï¼Œä½•å†µå‡ ä¹æ˜¯å…¨ä¸–ç•Œè¿™ä¸ªé¢†åŸŸçš„äº‹å®æ€§è§„èŒƒã€‚</li></ul><h2 id="6-jms"><a class="markdownIt-Anchor" href="#6-jms"></a> 6. JMS</h2><p>è°ˆ MQ å°±ä¸å¾—ä¸æä¸€ä¸‹ JMS ã€‚</p><p><strong>JMSï¼ˆJAVA Message Serviceï¼Œjava æ¶ˆæ¯æœåŠ¡ï¼‰API æ˜¯ä¸€ä¸ªæ¶ˆæ¯æœåŠ¡çš„æ ‡å‡†/è§„èŒƒï¼Œå…è®¸åº”ç”¨ç¨‹åºç»„ä»¶åŸºäº JavaEE å¹³å°åˆ›å»ºã€å‘é€ã€æ¥æ”¶å’Œè¯»å–æ¶ˆæ¯</strong>ã€‚å®ƒä½¿åˆ†å¸ƒå¼é€šä¿¡è€¦åˆåº¦æ›´ä½ï¼Œæ¶ˆæ¯æœåŠ¡æ›´åŠ å¯é ä»¥åŠå¼‚æ­¥æ€§ã€‚</p><p>åœ¨ EJB æ¶æ„ä¸­ï¼Œæœ‰æ¶ˆæ¯ bean å¯ä»¥æ— ç¼çš„ä¸ JM æ¶ˆæ¯æœåŠ¡é›†æˆã€‚åœ¨ J2EE æ¶æ„æ¨¡å¼ä¸­ï¼Œæœ‰æ¶ˆæ¯æœåŠ¡è€…æ¨¡å¼ï¼Œç”¨äºå®ç°æ¶ˆæ¯ä¸åº”ç”¨ç›´æ¥çš„è§£è€¦ã€‚</p><h3 id="61-æ¶ˆæ¯æ¨¡å‹"><a class="markdownIt-Anchor" href="#61-æ¶ˆæ¯æ¨¡å‹"></a> 6.1. æ¶ˆæ¯æ¨¡å‹</h3><p>åœ¨ JMS æ ‡å‡†ä¸­ï¼Œæœ‰ä¸¤ç§æ¶ˆæ¯æ¨¡å‹ï¼š</p><ul><li>P2P(Point to Point)</li><li>Pub/Sub(Publish/Subscribe)</li></ul><h4 id="611-p2p-æ¨¡å¼"><a class="markdownIt-Anchor" href="#611-p2p-æ¨¡å¼"></a> 6.1.1. P2P æ¨¡å¼</h4><div align="center"><img src="http://upload-images.jianshu.io/upload_images/3101171-2adc66e2367cd2c2.png"/></div>P2P æ¨¡å¼åŒ…å«ä¸‰ä¸ªè§’è‰²ï¼šMQï¼ˆQueueï¼‰ï¼Œå‘é€è€…(Sender)ï¼Œæ¥æ”¶è€…(Receiver)ã€‚æ¯ä¸ªæ¶ˆæ¯éƒ½è¢«å‘é€åˆ°ä¸€ä¸ªç‰¹å®šçš„é˜Ÿåˆ—ï¼Œæ¥æ”¶è€…ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ã€‚é˜Ÿåˆ—ä¿ç•™ç€æ¶ˆæ¯ï¼Œç›´åˆ°ä»–ä»¬è¢«æ¶ˆè´¹æˆ–è¶…æ—¶ã€‚<p>P2P çš„ç‰¹ç‚¹</p><ul><li>æ¯ä¸ªæ¶ˆæ¯åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰(å³ä¸€æ—¦è¢«æ¶ˆè´¹ï¼Œæ¶ˆæ¯å°±ä¸å†åœ¨ MQ ä¸­)</li><li>å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´åœ¨æ—¶é—´ä¸Šæ²¡æœ‰ä¾èµ–æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‘é€è€…å‘é€äº†æ¶ˆæ¯ä¹‹åï¼Œä¸ç®¡æ¥æ”¶è€…æœ‰æ²¡æœ‰æ­£åœ¨è¿è¡Œï¼Œå®ƒä¸ä¼šå½±å“åˆ°æ¶ˆæ¯è¢«å‘é€åˆ°é˜Ÿåˆ—</li><li>æ¥æ”¶è€…åœ¨æˆåŠŸæ¥æ”¶æ¶ˆæ¯ä¹‹åéœ€å‘é˜Ÿåˆ—åº”ç­”æˆåŠŸ</li></ul><p>å¦‚æœå¸Œæœ›å‘é€çš„æ¯ä¸ªæ¶ˆæ¯éƒ½ä¼šè¢«æˆåŠŸå¤„ç†çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦ P2P æ¨¡å¼ã€‚</p><h4 id="612-pubsub-æ¨¡å¼"><a class="markdownIt-Anchor" href="#612-pubsub-æ¨¡å¼"></a> 6.1.2. Pub/sub æ¨¡å¼</h4><div align="center"><img src="http://upload-images.jianshu.io/upload_images/3101171-12afe9581da889ea.png"/></div>åŒ…å«ä¸‰ä¸ªè§’è‰²ä¸»é¢˜ï¼ˆTopicï¼‰ï¼Œå‘å¸ƒè€…ï¼ˆPublisherï¼‰ï¼Œè®¢é˜…è€…ï¼ˆSubscriberï¼‰ ã€‚å¤šä¸ªå‘å¸ƒè€…å°†æ¶ˆæ¯å‘é€åˆ° Topic,ç³»ç»Ÿå°†è¿™äº›æ¶ˆæ¯ä¼ é€’ç»™å¤šä¸ªè®¢é˜…è€…ã€‚<p>Pub/Sub çš„ç‰¹ç‚¹</p><ul><li>æ¯ä¸ªæ¶ˆæ¯å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…</li><li>å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´æœ‰æ—¶é—´ä¸Šçš„ä¾èµ–æ€§ã€‚é’ˆå¯¹æŸä¸ªä¸»é¢˜ï¼ˆTopicï¼‰çš„è®¢é˜…è€…ï¼Œå®ƒå¿…é¡»åˆ›å»ºä¸€ä¸ªè®¢é˜…è€…ä¹‹åï¼Œæ‰èƒ½æ¶ˆè´¹å‘å¸ƒè€…çš„æ¶ˆæ¯ã€‚</li><li>ä¸ºäº†æ¶ˆè´¹æ¶ˆæ¯ï¼Œè®¢é˜…è€…å¿…é¡»ä¿æŒè¿è¡Œçš„çŠ¶æ€ã€‚</li></ul><p>ä¸ºäº†ç¼“å’Œè¿™æ ·ä¸¥æ ¼çš„æ—¶é—´ç›¸å…³æ€§ï¼ŒJMS å…è®¸è®¢é˜…è€…åˆ›å»ºä¸€ä¸ªå¯æŒä¹…åŒ–çš„è®¢é˜…ã€‚è¿™æ ·ï¼Œå³ä½¿è®¢é˜…è€…æ²¡æœ‰è¢«æ¿€æ´»ï¼ˆè¿è¡Œï¼‰ï¼Œå®ƒä¹Ÿèƒ½æ¥æ”¶åˆ°å‘å¸ƒè€…çš„æ¶ˆæ¯ã€‚</p><p>å¦‚æœå¸Œæœ›å‘é€çš„æ¶ˆæ¯å¯ä»¥ä¸è¢«åšä»»ä½•å¤„ç†ã€æˆ–è€…åªè¢«ä¸€ä¸ªæ¶ˆæ¯è€…å¤„ç†ã€æˆ–è€…å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…å¤„ç†çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥é‡‡ç”¨ Pub/Sub æ¨¡å‹ã€‚</p><h3 id="62-æ¶ˆæ¯æ¶ˆè´¹"><a class="markdownIt-Anchor" href="#62-æ¶ˆæ¯æ¶ˆè´¹"></a> 6.2. æ¶ˆæ¯æ¶ˆè´¹</h3><p>åœ¨ JMS ä¸­ï¼Œæ¶ˆæ¯çš„äº§ç”Ÿå’Œæ¶ˆè´¹éƒ½æ˜¯å¼‚æ­¥çš„ã€‚å¯¹äºæ¶ˆè´¹æ¥è¯´ï¼ŒJMS çš„æ¶ˆæ¯è€…å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥æ¶ˆè´¹æ¶ˆæ¯ã€‚</p><ul><li><strong>åŒæ­¥</strong> - è®¢é˜…è€…æˆ–æ¥æ”¶è€…é€šè¿‡ <code>receive</code> æ–¹æ³•æ¥æ¥æ”¶æ¶ˆæ¯ï¼Œ<code>receive</code> æ–¹æ³•åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹å‰ï¼ˆæˆ–è¶…æ—¶ä¹‹å‰ï¼‰å°†ä¸€ç›´é˜»å¡ï¼›</li><li><strong>å¼‚æ­¥</strong> - è®¢é˜…è€…æˆ–æ¥æ”¶è€…å¯ä»¥æ³¨å†Œä¸ºä¸€ä¸ªæ¶ˆæ¯ç›‘å¬å™¨ã€‚å½“æ¶ˆæ¯åˆ°è¾¾ä¹‹åï¼Œç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ç›‘å¬å™¨çš„ <code>onMessage</code> æ–¹æ³•ã€‚</li></ul><p><code>JNDI</code> - Java å‘½åå’Œç›®å½•æ¥å£,æ˜¯ä¸€ç§æ ‡å‡†çš„ Java å‘½åç³»ç»Ÿæ¥å£ã€‚å¯ä»¥åœ¨ç½‘ç»œä¸ŠæŸ¥æ‰¾å’Œè®¿é—®æœåŠ¡ã€‚é€šè¿‡æŒ‡å®šä¸€ä¸ªèµ„æºåç§°ï¼Œè¯¥åç§°å¯¹åº”äºæ•°æ®åº“æˆ–å‘½åæœåŠ¡ä¸­çš„ä¸€ä¸ªè®°å½•ï¼ŒåŒæ—¶è¿”å›èµ„æºè¿æ¥å»ºç«‹æ‰€å¿…é¡»çš„ä¿¡æ¯ã€‚</p><p>JNDI åœ¨ JMS ä¸­èµ·åˆ°æŸ¥æ‰¾å’Œè®¿é—®å‘é€ç›®æ ‡æˆ–æ¶ˆæ¯æ¥æºçš„ä½œç”¨ã€‚</p><h3 id="63-jms-ç¼–ç¨‹æ¨¡å‹"><a class="markdownIt-Anchor" href="#63-jms-ç¼–ç¨‹æ¨¡å‹"></a> 6.3. JMS ç¼–ç¨‹æ¨¡å‹</h3><h4 id="631-connectionfactory"><a class="markdownIt-Anchor" href="#631-connectionfactory"></a> 6.3.1. ConnectionFactory</h4><p>åˆ›å»º Connection å¯¹è±¡çš„å·¥å‚ï¼Œé’ˆå¯¹ä¸¤ç§ä¸åŒçš„ jms æ¶ˆæ¯æ¨¡å‹ï¼Œåˆ†åˆ«æœ‰ QueueConnectionFactory å’Œ TopicConnectionFactory ä¸¤ç§ã€‚å¯ä»¥é€šè¿‡ JNDI æ¥æŸ¥æ‰¾ ConnectionFactory å¯¹è±¡ã€‚</p><h4 id="632-destination"><a class="markdownIt-Anchor" href="#632-destination"></a> 6.3.2. Destination</h4><p>Destination çš„æ„æ€æ˜¯æ¶ˆæ¯ç”Ÿäº§è€…çš„æ¶ˆæ¯å‘é€ç›®æ ‡æˆ–è€…è¯´æ¶ˆæ¯æ¶ˆè´¹è€…çš„æ¶ˆæ¯æ¥æºã€‚å¯¹äºæ¶ˆæ¯ç”Ÿäº§è€…æ¥è¯´ï¼Œå®ƒçš„ Destination æ˜¯æŸä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰æˆ–æŸä¸ªä¸»é¢˜ï¼ˆTopicï¼‰;å¯¹äºæ¶ˆæ¯æ¶ˆè´¹è€…æ¥è¯´ï¼Œå®ƒçš„ Destination ä¹Ÿæ˜¯æŸä¸ªé˜Ÿåˆ—æˆ–ä¸»é¢˜ï¼ˆå³æ¶ˆæ¯æ¥æºï¼‰ã€‚</p><p>æ‰€ä»¥ï¼ŒDestination å®é™…ä¸Šå°±æ˜¯ä¸¤ç§ç±»å‹çš„å¯¹è±¡ï¼šQueueã€Topicã€‚å¯ä»¥é€šè¿‡ JNDI æ¥æŸ¥æ‰¾ Destinationã€‚</p><h4 id="633-3-connection"><a class="markdownIt-Anchor" href="#633-3-connection"></a> 6.3.3. (3) Connection</h4><p>Connection è¡¨ç¤ºåœ¨å®¢æˆ·ç«¯å’Œ JMS ç³»ç»Ÿä¹‹é—´å»ºç«‹çš„é“¾æ¥ï¼ˆå¯¹ TCP/IP socket çš„åŒ…è£…ï¼‰ã€‚Connection å¯ä»¥äº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ª Sessionã€‚è·Ÿ ConnectionFactory ä¸€æ ·ï¼ŒConnection ä¹Ÿæœ‰ä¸¤ç§ç±»å‹ï¼šQueueConnection å’Œ TopicConnectionã€‚</p><h4 id="634-4-session"><a class="markdownIt-Anchor" href="#634-4-session"></a> 6.3.4. (4) Session</h4><p>Session æ˜¯æ“ä½œæ¶ˆæ¯çš„æ¥å£ã€‚å¯ä»¥é€šè¿‡ session åˆ›å»ºç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€æ¶ˆæ¯ç­‰ã€‚Session æä¾›äº†äº‹åŠ¡çš„åŠŸèƒ½ã€‚å½“éœ€è¦ä½¿ç”¨ session å‘é€/æ¥æ”¶å¤šä¸ªæ¶ˆæ¯æ—¶ï¼Œå¯ä»¥å°†è¿™äº›å‘é€/æ¥æ”¶åŠ¨ä½œæ”¾åˆ°ä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚åŒæ ·ï¼Œä¹Ÿåˆ† QueueSession å’Œ TopicSessionã€‚</p><h4 id="635-æ¶ˆæ¯çš„ç”Ÿäº§è€…"><a class="markdownIt-Anchor" href="#635-æ¶ˆæ¯çš„ç”Ÿäº§è€…"></a> 6.3.5. æ¶ˆæ¯çš„ç”Ÿäº§è€…</h4><p>æ¶ˆæ¯ç”Ÿäº§è€…ç”± Session åˆ›å»ºï¼Œå¹¶ç”¨äºå°†æ¶ˆæ¯å‘é€åˆ° Destinationã€‚åŒæ ·ï¼Œæ¶ˆæ¯ç”Ÿäº§è€…åˆ†ä¸¤ç§ç±»å‹ï¼šQueueSender å’Œ TopicPublisherã€‚å¯ä»¥è°ƒç”¨æ¶ˆæ¯ç”Ÿäº§è€…çš„æ–¹æ³•ï¼ˆsend æˆ– publish æ–¹æ³•ï¼‰å‘é€æ¶ˆæ¯ã€‚</p><h4 id="636-æ¶ˆæ¯æ¶ˆè´¹è€…"><a class="markdownIt-Anchor" href="#636-æ¶ˆæ¯æ¶ˆè´¹è€…"></a> 6.3.6. æ¶ˆæ¯æ¶ˆè´¹è€…</h4><p>æ¶ˆæ¯æ¶ˆè´¹è€…ç”± Session åˆ›å»ºï¼Œç”¨äºæ¥æ”¶è¢«å‘é€åˆ° Destination çš„æ¶ˆæ¯ã€‚ä¸¤ç§ç±»å‹ï¼šQueueReceiver å’Œ TopicSubscriberã€‚å¯åˆ†åˆ«é€šè¿‡ session çš„ createReceiver(Queue)æˆ– createSubscriber(Topic)æ¥åˆ›å»ºã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ session çš„ creatDurableSubscriber æ–¹æ³•æ¥åˆ›å»ºæŒä¹…åŒ–çš„è®¢é˜…è€…ã€‚</p><h4 id="637-messagelistener"><a class="markdownIt-Anchor" href="#637-messagelistener"></a> 6.3.7. MessageListener</h4><p>æ¶ˆæ¯ç›‘å¬å™¨ã€‚å¦‚æœæ³¨å†Œäº†æ¶ˆæ¯ç›‘å¬å™¨ï¼Œä¸€æ—¦æ¶ˆæ¯åˆ°è¾¾ï¼Œå°†è‡ªåŠ¨è°ƒç”¨ç›‘å¬å™¨çš„ onMessage æ–¹æ³•ã€‚EJB ä¸­çš„ MDBï¼ˆMessage-Driven Beanï¼‰å°±æ˜¯ä¸€ç§ MessageListenerã€‚</p><p>æ·±å…¥å­¦ä¹  JMS å¯¹æŒæ¡ JAVA æ¶æ„ï¼ŒEJB æ¶æ„æœ‰å¾ˆå¥½çš„å¸®åŠ©ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶ä¹Ÿæ˜¯å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿå¿…é¡»çš„ç»„ä»¶ã€‚æœ¬æ¬¡åˆ†äº«ä¸»è¦åšå…¨å±€æ€§ä»‹ç»ï¼Œå…·ä½“çš„æ·±å…¥éœ€è¦å¤§å®¶å­¦ä¹ ï¼Œå®è·µï¼Œæ€»ç»“ï¼Œé¢†ä¼šã€‚</p><h2 id="7-å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#7-å‚è€ƒèµ„æ–™"></a> 7. å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://www.cnblogs.com/itfly8/p/5155983.html" target="_blank" rel="noopener">å¤§å‹ç½‘ç«™æ¶æ„ç³»åˆ—ï¼šåˆ†å¸ƒå¼ MQï¼ˆä¸€ï¼‰</a></li><li><a href="https://www.cnblogs.com/itfly8/p/5156155.html" target="_blank" rel="noopener">å¤§å‹ç½‘ç«™æ¶æ„ç³»åˆ—ï¼šMQï¼ˆäºŒï¼‰</a></li><li><a href="https://www.jianshu.com/p/453c6e7ff81c" target="_blank" rel="noopener">åˆ†å¸ƒå¼å¼€æ”¾ MQ(RocketMQ)çš„åŸç†ä¸å®è·µ</a></li><li><a href="https://juejin.im/entry/5a0abfb5f265da43062a4a91" target="_blank" rel="noopener">é˜¿é‡Œ RocketMQ ä¼˜åŠ¿å¯¹æ¯”</a></li><li><a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/mq-interview.md" target="_blank" rel="noopener">advanced-java ä¹‹ MQ</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;æ¶ˆæ¯é˜Ÿåˆ—åŸºæœ¬åŸç†&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#æ¶ˆæ¯é˜Ÿåˆ—åŸºæœ¬åŸç†&quot;&gt;&lt;/a&gt; æ¶ˆæ¯é˜Ÿåˆ—åŸºæœ¬åŸç†&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼Œç®€ç§° MQï¼‰æŠ€æœ¯æ˜¯åˆ†å¸ƒå¼åº”ç”¨é—´äº¤æ¢ä¿¡æ¯çš„ä¸€ç§
      
    
    </summary>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/tags/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/tags/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
      <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://dunwu.github.io/blog/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>ç¼“å­˜åŸºæœ¬åŸç†</title>
    <link href="https://dunwu.github.io/blog/design/theory/cache-theory/"/>
    <id>https://dunwu.github.io/blog/design/theory/cache-theory/</id>
    <published>2019-06-27T07:36:00.000Z</published>
    <updated>2020-01-25T14:48:34.959Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç¼“å­˜åŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#ç¼“å­˜åŸºæœ¬åŸç†"></a> ç¼“å­˜åŸºæœ¬åŸç†</h1><!-- TOC depthFrom:2 depthTo:3 --><ul><li><a href="#1-%E7%BC%93%E5%AD%98%E6%A6%82%E8%BF%B0">1. ç¼“å­˜æ¦‚è¿°</a><ul><li><a href="#11-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BC%93%E5%AD%98">1.1. ä»€ä¹ˆæ˜¯ç¼“å­˜</a></li><li><a href="#12-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BC%95%E5%85%A5%E7%BC%93%E5%AD%98">1.2. ä¸ºä»€ä¹ˆå¼•å…¥ç¼“å­˜</a></li><li><a href="#13-%E7%BC%93%E5%AD%98%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86">1.3. ç¼“å­˜çš„åŸºæœ¬åŸç†</a></li><li><a href="#14-%E7%BC%93%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AE%97%E6%B3%95">1.4. ç¼“å­˜æ·˜æ±°ç®—æ³•</a></li><li><a href="#15-%E7%BC%93%E5%AD%98%E7%9A%84%E5%88%86%E7%B1%BB">1.5. ç¼“å­˜çš„åˆ†ç±»</a></li><li><a href="#16-%E7%BC%93%E5%AD%98%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84">1.6. ç¼“å­˜æ•´ä½“æ¶æ„</a></li></ul></li><li><a href="#2-cdn-%E7%BC%93%E5%AD%98">2. CDN ç¼“å­˜</a><ul><li><a href="#21-cdn-%E5%8E%9F%E7%90%86">2.1. CDN åŸç†</a></li><li><a href="#22-cdn-%E7%89%B9%E7%82%B9">2.2. CDN ç‰¹ç‚¹</a></li></ul></li><li><a href="#3-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E7%BC%93%E5%AD%98">3. åå‘ä»£ç†ç¼“å­˜</a><ul><li><a href="#31-%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86">3.1. ç¼“å­˜åŸç†</a></li><li><a href="#32-%E4%BB%A3%E7%90%86%E7%BC%93%E5%AD%98%E6%AF%94%E8%BE%83">3.2. ä»£ç†ç¼“å­˜æ¯”è¾ƒ</a></li></ul></li><li><a href="#4-%E8%BF%9B%E7%A8%8B%E5%86%85%E7%BC%93%E5%AD%98">4. è¿›ç¨‹å†…ç¼“å­˜</a><ul><li><a href="#41-concurrenthashmap">4.1. ConcurrentHashMap</a></li><li><a href="#42-lruhashmap">4.2. LRUHashMap</a></li><li><a href="#43-guava-cache">4.3. Guava Cache</a></li><li><a href="#44-caffeine">4.4. Caffeine</a></li><li><a href="#45-%E9%80%89%E6%8B%A9%E8%BF%9B%E7%A8%8B%E5%86%85%E7%BC%93%E5%AD%98">4.5. é€‰æ‹©è¿›ç¨‹å†…ç¼“å­˜</a></li></ul></li><li><a href="#5-%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98">5. åˆ†å¸ƒå¼ç¼“å­˜</a><ul><li><a href="#51-memcache">5.1. Memcache</a></li><li><a href="#52-redis">5.2. Redis</a></li><li><a href="#53-%E9%80%89%E6%8B%A9%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98">5.3. é€‰æ‹©åˆ†å¸ƒå¼ç¼“å­˜</a></li></ul></li><li><a href="#6-%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98">6. å¤šçº§ç¼“å­˜</a><ul><li><a href="#61-%E4%BD%BF%E7%94%A8%E8%BF%9B%E7%A8%8B%E5%86%85%E7%BC%93%E5%AD%98">6.1. ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜</a></li><li><a href="#62-%E4%BD%BF%E7%94%A8%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98">6.2. ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜</a></li><li><a href="#63-%E4%BD%BF%E7%94%A8%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98">6.3. ä½¿ç”¨å¤šçº§ç¼“å­˜</a></li></ul></li><li><a href="#7-%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98">7. ç¼“å­˜é—®é¢˜</a><ul><li><a href="#71-%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9">7.1. ç¼“å­˜é›ªå´©</a></li><li><a href="#72-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F">7.2. ç¼“å­˜ç©¿é€</a></li><li><a href="#73-%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF">7.3. ç¼“å­˜å‡»ç©¿</a></li><li><a href="#74-%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0">7.4. ç¼“å­˜æ›´æ–°</a></li><li><a href="#75-%E7%BC%93%E5%AD%98%E9%A2%84%E7%83%AD">7.5. ç¼“å­˜é¢„çƒ­</a></li><li><a href="#76-%E7%BC%93%E5%AD%98%E9%99%8D%E7%BA%A7">7.6. ç¼“å­˜é™çº§</a></li></ul></li><li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li></ul><!-- /TOC --><h2 id="1-ç¼“å­˜æ¦‚è¿°"><a class="markdownIt-Anchor" href="#1-ç¼“å­˜æ¦‚è¿°"></a> 1. ç¼“å­˜æ¦‚è¿°</h2><h3 id="11-ä»€ä¹ˆæ˜¯ç¼“å­˜"><a class="markdownIt-Anchor" href="#11-ä»€ä¹ˆæ˜¯ç¼“å­˜"></a> 1.1. ä»€ä¹ˆæ˜¯ç¼“å­˜</h3><p><strong>ç¼“å­˜å°±æ˜¯æ•°æ®äº¤æ¢çš„ç¼“å†²åŒº</strong>ã€‚</p><p>ç¼“å­˜æ˜¯ç”¨äºå­˜å‚¨æ•°æ®çš„ç¡¬ä»¶æˆ–è½¯ä»¶çš„ç»„æˆéƒ¨åˆ†ï¼Œä»¥ä½¿å¾—åç»­æ›´å¿«è®¿é—®ç›¸åº”çš„æ•°æ®ã€‚ç¼“å­˜ä¸­çš„æ•°æ®å¯èƒ½æ˜¯æå‰è®¡ç®—å¥½çš„ç»“æœã€æ•°æ®çš„å‰¯æœ¬ç­‰ã€‚å…¸å‹çš„åº”ç”¨åœºæ™¯ï¼šæœ‰ cpu cache, ç£ç›˜ cache ç­‰ã€‚æœ¬æ–‡ä¸­æåŠåˆ°ç¼“å­˜ä¸»è¦æ˜¯æŒ‡äº’è”ç½‘åº”ç”¨ä¸­æ‰€ä½¿ç”¨çš„ç¼“å­˜ç»„ä»¶ã€‚</p><h3 id="12-ä¸ºä»€ä¹ˆå¼•å…¥ç¼“å­˜"><a class="markdownIt-Anchor" href="#12-ä¸ºä»€ä¹ˆå¼•å…¥ç¼“å­˜"></a> 1.2. ä¸ºä»€ä¹ˆå¼•å…¥ç¼“å­˜</h3><p>ä¼ ç»Ÿçš„åç«¯ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œè®¿é—®é‡ä»¥åŠå¯¹å“åº”æ—¶é—´çš„è¦æ±‚å‡ä¸é«˜ï¼Œé€šå¸¸åªä½¿ç”¨æ•°æ®åº“å³å¯æ»¡è¶³è¦æ±‚ã€‚è¿™ç§æ¶æ„ç®€å•ï¼Œä¾¿äºå¿«é€Ÿéƒ¨ç½²ï¼Œå¾ˆå¤šç½‘ç«™å‘å±•åˆæœŸå‡è€ƒè™‘ä½¿ç”¨è¿™ç§æ¶æ„ã€‚ä½†æ˜¯éšç€è®¿é—®é‡çš„ä¸Šå‡ï¼Œä»¥åŠå¯¹å“åº”æ—¶é—´çš„è¦æ±‚æå‡ï¼Œä¸€ä¸ªæ•°æ®åº“æœåŠ¡å·²æ— æ³•å†æ»¡è¶³è¦æ±‚ã€‚è¿™æ—¶å€™é€šå¸¸ä¼šè€ƒè™‘æ•°æ®åº“æ‹†åˆ†(sharding)ã€è¯»å†™åˆ†ç¦»ã€ç”šè‡³ç¡¬ä»¶å‡çº§(SSD)ç­‰ä»¥æ»¡è¶³æ–°çš„ä¸šåŠ¡éœ€æ±‚ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä»ç„¶ä¼šé¢ä¸´å¾ˆå¤šé—®é¢˜ï¼Œä¸»è¦ä½“ç°åœ¨ï¼š</p><ul><li>æ€§èƒ½æå‡æœ‰é™ï¼Œå¾ˆéš¾è¾¾åˆ°æ•°é‡çº§ä¸Šçš„æå‡ï¼Œå°¤å…¶åœ¨äº’è”ç½‘ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œéšç€ç½‘ç«™çš„å‘å±•ï¼Œè®¿é—®é‡ç»å¸¸ä¼šé¢ä¸´åå€ã€ç™¾å€çš„ä¸Šæ¶¨ã€‚</li><li>æˆæœ¬é«˜æ˜‚ï¼Œä¸ºäº†æ‰¿è½½ N å€çš„è®¿é—®é‡ï¼Œé€šå¸¸éœ€è¦ N å€çš„æœºå™¨ï¼Œè¿™ä¸ªä»£ä»·éš¾ä»¥æ¥å—ã€‚</li></ul><p>åœ¨æ•°æ®å±‚å¼•å…¥ç¼“å­˜ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š</p><ul><li>æå‡æ•°æ®è¯»å–é€Ÿåº¦ã€‚</li><li>æå‡ç³»ç»Ÿæ‰©å±•èƒ½åŠ›ï¼Œé€šè¿‡æ‰©å±•ç¼“å­˜ï¼Œæå‡ç³»ç»Ÿæ‰¿è½½èƒ½åŠ›ã€‚</li><li>é™ä½å­˜å‚¨æˆæœ¬ï¼ŒCache+DB çš„æ–¹å¼å¯ä»¥æ‰¿æ‹…åŸæœ‰éœ€è¦å¤šå° DB æ‰èƒ½æ‰¿æ‹…çš„è¯·æ±‚é‡ï¼ŒèŠ‚çœæœºå™¨æˆæœ¬ã€‚</li></ul><p>æ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œé€šå¸¸ç¼“å­˜æœ‰ä»¥ä¸‹å‡ ç§ä½¿ç”¨æ–¹å¼ï¼š</p><ul><li>æ‡’æ±‰å¼(è¯»æ—¶è§¦å‘)ï¼šå†™å…¥ DB å, ç„¶åæŠŠç›¸å…³çš„æ•°æ®ä¹Ÿå†™å…¥ Cacheã€‚</li><li>é¥¥é¥¿å¼(å†™æ—¶è§¦å‘)ï¼šå…ˆæŸ¥è¯¢ DB é‡Œçš„æ•°æ®, ç„¶åæŠŠç›¸å…³çš„æ•°æ®å†™å…¥ Cacheã€‚</li><li>å®šæœŸåˆ·æ–°ï¼šé€‚åˆå‘¨æœŸæ€§çš„è·‘æ•°æ®çš„ä»»åŠ¡ï¼Œæˆ–è€…åˆ—è¡¨å‹çš„æ•°æ®ï¼Œè€Œä¸”ä¸è¦æ±‚ç»å¯¹å®æ—¶æ€§ã€‚</li></ul><h3 id="13-ç¼“å­˜çš„åŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#13-ç¼“å­˜çš„åŸºæœ¬åŸç†"></a> 1.3. ç¼“å­˜çš„åŸºæœ¬åŸç†</h3><ol><li>å°†æ•°æ®å†™å…¥/è¯»å–é€Ÿåº¦æ›´å¿«çš„å­˜å‚¨ï¼ˆè®¾å¤‡ï¼‰ï¼›</li><li>å°†æ•°æ®ç¼“å­˜åˆ°ç¦»åº”ç”¨æœ€è¿‘çš„ä½ç½®ï¼›</li><li>å°†æ•°æ®ç¼“å­˜åˆ°ç¦»ç”¨æˆ·æœ€è¿‘çš„ä½ç½®ã€‚</li></ol><h3 id="14-ç¼“å­˜æ·˜æ±°ç®—æ³•"><a class="markdownIt-Anchor" href="#14-ç¼“å­˜æ·˜æ±°ç®—æ³•"></a> 1.4. ç¼“å­˜æ·˜æ±°ç®—æ³•</h3><p>å¸¸è§çš„ç¼“å­˜æ·˜æ±°ç®—æ³•æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li><strong>FIFO</strong> - å…ˆè¿›å…ˆå‡ºï¼Œåœ¨è¿™ç§æ·˜æ±°ç®—æ³•ä¸­ï¼Œå…ˆè¿›å…¥ç¼“å­˜çš„ä¼šå…ˆè¢«æ·˜æ±°ã€‚è¿™ç§å¯è°“æ˜¯æœ€ç®€å•çš„äº†ï¼Œä½†æ˜¯ä¼šå¯¼è‡´æˆ‘ä»¬å‘½ä¸­ç‡å¾ˆä½ã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬å¦‚æœæœ‰ä¸ªè®¿é—®é¢‘ç‡å¾ˆé«˜çš„æ•°æ®æ˜¯æ‰€æœ‰æ•°æ®ç¬¬ä¸€ä¸ªè®¿é—®çš„ï¼Œè€Œé‚£äº›ä¸æ˜¯å¾ˆé«˜çš„æ˜¯åé¢å†è®¿é—®çš„ï¼Œé‚£è¿™æ ·å°±ä¼šæŠŠæˆ‘ä»¬çš„é¦–ä¸ªæ•°æ®ä½†æ˜¯ä»–çš„è®¿é—®é¢‘ç‡å¾ˆé«˜ç»™æŒ¤å‡ºã€‚</li><li><strong>LRU</strong> - æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ã€‚åœ¨è¿™ç§ç®—æ³•ä¸­é¿å…äº†ä¸Šé¢çš„é—®é¢˜ï¼Œæ¯æ¬¡è®¿é—®æ•°æ®éƒ½ä¼šå°†å…¶æ”¾åœ¨æˆ‘ä»¬çš„é˜Ÿå°¾ï¼Œå¦‚æœéœ€è¦æ·˜æ±°æ•°æ®ï¼Œå°±åªéœ€è¦æ·˜æ±°é˜Ÿé¦–å³å¯ã€‚ä½†æ˜¯è¿™ä¸ªä¾ç„¶æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæœ‰ä¸ªæ•°æ®åœ¨ 1 ä¸ªå°æ—¶çš„å‰ 59 åˆ†é’Ÿè®¿é—®äº† 1 ä¸‡æ¬¡(å¯è§è¿™æ˜¯ä¸ªçƒ­ç‚¹æ•°æ®),å†åä¸€åˆ†é’Ÿæ²¡æœ‰è®¿é—®è¿™ä¸ªæ•°æ®ï¼Œä½†æ˜¯æœ‰å…¶ä»–çš„æ•°æ®è®¿é—®ï¼Œå°±å¯¼è‡´äº†æˆ‘ä»¬è¿™ä¸ªçƒ­ç‚¹æ•°æ®è¢«æ·˜æ±°ã€‚</li><li><strong>LFU</strong> - æœ€è¿‘æœ€å°‘é¢‘ç‡ä½¿ç”¨ã€‚åœ¨è¿™ç§ç®—æ³•ä¸­åˆå¯¹ä¸Šé¢è¿›è¡Œäº†ä¼˜åŒ–ï¼Œåˆ©ç”¨é¢å¤–çš„ç©ºé—´è®°å½•æ¯ä¸ªæ•°æ®çš„ä½¿ç”¨é¢‘ç‡ï¼Œç„¶åé€‰å‡ºé¢‘ç‡æœ€ä½è¿›è¡Œæ·˜æ±°ã€‚è¿™æ ·å°±é¿å…äº† LRU ä¸èƒ½å¤„ç†æ—¶é—´æ®µçš„é—®é¢˜ã€‚</li></ul><p>è¿™ä¸‰ç§ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼Œå®ç°å¤æ‚åº¦ä¸€ä¸ªæ¯”ä¸€ä¸ªé«˜ï¼ŒåŒæ ·çš„å‘½ä¸­ç‡ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”ä¸€ä¸ªå¥½ã€‚è€Œæˆ‘ä»¬ä¸€èˆ¬æ¥è¯´é€‰æ‹©çš„æ–¹æ¡ˆå±…ä¸­å³å¯ï¼Œå³å®ç°æˆæœ¬ä¸æ˜¯å¤ªé«˜ï¼Œè€Œå‘½ä¸­ç‡ä¹Ÿè¿˜è¡Œçš„ LRUã€‚</p><h3 id="15-ç¼“å­˜çš„åˆ†ç±»"><a class="markdownIt-Anchor" href="#15-ç¼“å­˜çš„åˆ†ç±»"></a> 1.5. ç¼“å­˜çš„åˆ†ç±»</h3><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç¼“å­˜çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œä»éƒ¨ç½²è§’åº¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„ç¼“å­˜åº”ç”¨ã€‚</p><ul><li><strong>CDN ç¼“å­˜</strong> - å­˜æ”¾ HTMLã€CSSã€JS ç­‰é™æ€èµ„æºã€‚</li><li><strong>åå‘ä»£ç†ç¼“å­˜</strong> - åŠ¨é™åˆ†ç¦»ï¼Œåªç¼“å­˜ç”¨æˆ·è¯·æ±‚çš„é™æ€èµ„æºã€‚</li><li><strong>è¿›ç¨‹å†…ç¼“å­˜</strong> - ç¼“å­˜åº”ç”¨å­—å…¸ç­‰å¸¸ç”¨æ•°æ®ã€‚</li><li><strong>åˆ†å¸ƒå¼ç¼“å­˜</strong> - ç¼“å­˜æ•°æ®åº“ä¸­çš„çƒ­ç‚¹æ•°æ®ã€‚</li></ul><h3 id="16-ç¼“å­˜æ•´ä½“æ¶æ„"><a class="markdownIt-Anchor" href="#16-ç¼“å­˜æ•´ä½“æ¶æ„"></a> 1.6. ç¼“å­˜æ•´ä½“æ¶æ„</h3><p>é€šå¸¸ï¼Œç½‘ç«™çš„ç¼“å­˜æ•´ä½“æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/technology/cache/ç¼“å­˜æ•´ä½“æ¶æ„.png!zp" /></div>è¯·æ±‚è¿‡ç¨‹ï¼š<ol><li>æµè§ˆå™¨å‘å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œå¦‚æœ CDN æœ‰ç¼“å­˜åˆ™ç›´æ¥è¿”å›ï¼›</li><li>å¦‚æœ CDN æ— ç¼“å­˜ï¼Œåˆ™è®¿é—®åå‘ä»£ç†æœåŠ¡å™¨ï¼›</li><li>å¦‚æœåå‘ä»£ç†æœåŠ¡å™¨æœ‰ç¼“å­˜åˆ™ç›´æ¥è¿”å›ï¼›</li><li>å¦‚æœåå‘ä»£ç†æœåŠ¡å™¨æ— ç¼“å­˜æˆ–åŠ¨æ€è¯·æ±‚ï¼Œåˆ™è®¿é—®åº”ç”¨æœåŠ¡å™¨ï¼›</li><li>åº”ç”¨æœåŠ¡å™¨è®¿é—®è¿›ç¨‹å†…ç¼“å­˜ï¼›å¦‚æœæœ‰ç¼“å­˜ï¼Œåˆ™è¿”å›ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶ç¼“å­˜æ•°æ®ï¼›ï¼ˆåŠ¨æ€è¯·æ±‚ä¸ç¼“å­˜ï¼‰</li><li>å¦‚æœè¿›ç¨‹å†…ç¼“å­˜æ— æ•°æ®ï¼Œåˆ™è¯»å–åˆ†å¸ƒå¼ç¼“å­˜ï¼›å¹¶è¿”å›åº”ç”¨æœåŠ¡å™¨ï¼›åº”ç”¨æœåŠ¡å™¨å°†æ•°æ®ç¼“å­˜åˆ°æœ¬åœ°ç¼“å­˜ï¼ˆéƒ¨åˆ†ï¼‰ï¼›</li><li>å¦‚æœåˆ†å¸ƒå¼ç¼“å­˜æ— æ•°æ®ï¼Œåˆ™åº”ç”¨ç¨‹åºè¯»å–æ•°æ®åº“æ•°æ®ï¼Œå¹¶æ”¾å…¥åˆ†å¸ƒå¼ç¼“å­˜ï¼›</li></ol><h2 id="2-cdn-ç¼“å­˜"><a class="markdownIt-Anchor" href="#2-cdn-ç¼“å­˜"></a> 2. CDN ç¼“å­˜</h2><blockquote><p><strong>CDN å°†æ•°æ®ç¼“å­˜åˆ°ç¦»ç”¨æˆ·ç‰©ç†è·ç¦»æœ€è¿‘çš„æœåŠ¡å™¨ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥å°±è¿‘è·å–è¯·æ±‚å†…å®¹ã€‚CDN ä¸€èˆ¬ç¼“å­˜é™æ€èµ„æºæ–‡ä»¶ï¼ˆé¡µé¢ï¼Œè„šæœ¬ï¼Œå›¾ç‰‡ï¼Œè§†é¢‘ï¼Œæ–‡ä»¶ç­‰ï¼‰</strong>ã€‚</p><p>å›½å†…ç½‘ç»œå¼‚å¸¸å¤æ‚ï¼Œè·¨è¿è¥å•†çš„ç½‘ç»œè®¿é—®ä¼šå¾ˆæ…¢ã€‚ä¸ºäº†è§£å†³è·¨è¿è¥å•†æˆ–å„åœ°ç”¨æˆ·è®¿é—®é—®é¢˜ï¼Œå¯ä»¥åœ¨é‡è¦çš„åŸå¸‚ï¼Œéƒ¨ç½² CDN åº”ç”¨ã€‚ä½¿ç”¨æˆ·å°±è¿‘è·å–æ‰€éœ€å†…å®¹ï¼Œé™ä½ç½‘ç»œæ‹¥å¡ï¼Œæé«˜ç”¨æˆ·è®¿é—®å“åº”é€Ÿåº¦å’Œå‘½ä¸­ç‡ã€‚</p></blockquote><div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559138689425.png!zp"/></div>### 2.1. CDN åŸç†<p>CDN çš„åŸºæœ¬åŸç†æ˜¯å¹¿æ³›é‡‡ç”¨å„ç§ç¼“å­˜æœåŠ¡å™¨ï¼Œå°†è¿™äº›ç¼“å­˜æœåŠ¡å™¨åˆ†å¸ƒåˆ°ç”¨æˆ·è®¿é—®ç›¸å¯¹é›†ä¸­çš„åœ°åŒºæˆ–ç½‘ç»œä¸­ï¼Œåœ¨ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶ï¼Œåˆ©ç”¨å…¨å±€è´Ÿè½½æŠ€æœ¯å°†ç”¨æˆ·çš„è®¿é—®æŒ‡å‘è·ç¦»æœ€è¿‘çš„å·¥ä½œæ­£å¸¸çš„ç¼“å­˜æœåŠ¡å™¨ä¸Šï¼Œç”±ç¼“å­˜æœåŠ¡å™¨ç›´æ¥å“åº”ç”¨æˆ·è¯·æ±‚ã€‚</p><p>ï¼ˆ1ï¼‰æœªéƒ¨ç½² CDN åº”ç”¨å‰çš„ç½‘ç»œè·¯å¾„ï¼š</p><ul><li>è¯·æ±‚ï¼šæœ¬æœºç½‘ç»œï¼ˆå±€åŸŸç½‘ï¼‰=&gt; è¿è¥å•†ç½‘ç»œ =&gt; åº”ç”¨æœåŠ¡å™¨æœºæˆ¿</li><li>å“åº”ï¼šåº”ç”¨æœåŠ¡å™¨æœºæˆ¿ =&gt; è¿è¥å•†ç½‘ç»œ =&gt; æœ¬æœºç½‘ç»œï¼ˆå±€åŸŸç½‘ï¼‰</li></ul><p>åœ¨ä¸è€ƒè™‘å¤æ‚ç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œä»è¯·æ±‚åˆ°å“åº”éœ€è¦ç»è¿‡ 3 ä¸ªèŠ‚ç‚¹ï¼Œ6 ä¸ªæ­¥éª¤å®Œæˆä¸€æ¬¡ç”¨æˆ·è®¿é—®æ“ä½œã€‚</p><p>ï¼ˆ2ï¼‰éƒ¨ç½² CDN åº”ç”¨åç½‘ç»œè·¯å¾„ï¼š</p><ul><li>è¯·æ±‚ï¼šæœ¬æœºç½‘ç»œï¼ˆå±€åŸŸç½‘ï¼‰ =&gt; è¿è¥å•†ç½‘ç»œ</li><li>å“åº”ï¼šè¿è¥å•†ç½‘ç»œ =&gt; æœ¬æœºç½‘ç»œï¼ˆå±€åŸŸç½‘ï¼‰</li></ul><p>åœ¨ä¸è€ƒè™‘å¤æ‚ç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œä»è¯·æ±‚åˆ°å“åº”éœ€è¦ç»è¿‡ 2 ä¸ªèŠ‚ç‚¹ï¼Œ2 ä¸ªæ­¥éª¤å®Œæˆä¸€æ¬¡ç”¨æˆ·è®¿é—®æ“ä½œã€‚</p><p>ä¸ä¸éƒ¨ç½² CDN æœåŠ¡ç›¸æ¯”ï¼Œå‡å°‘äº† 1 ä¸ªèŠ‚ç‚¹ï¼Œ4 ä¸ªæ­¥éª¤çš„è®¿é—®ã€‚æå¤§çš„æé«˜çš„ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚</p><h3 id="22-cdn-ç‰¹ç‚¹"><a class="markdownIt-Anchor" href="#22-cdn-ç‰¹ç‚¹"></a> 2.2. CDN ç‰¹ç‚¹</h3><ul><li><strong>ä¼˜ç‚¹</strong><ul><li><strong>æœ¬åœ° Cache åŠ é€Ÿ</strong> - æå‡è®¿é—®é€Ÿåº¦ï¼Œå°¤å…¶å«æœ‰å¤§é‡å›¾ç‰‡å’Œé™æ€é¡µé¢ç«™ç‚¹ï¼›</li><li><strong>é•œåƒæœåŠ¡</strong> - æ¶ˆé™¤äº†ä¸åŒè¿è¥å•†ä¹‹é—´äº’è”çš„ç“¶é¢ˆé€ æˆçš„å½±å“ï¼Œå®ç°äº†è·¨è¿è¥å•†çš„ç½‘ç»œåŠ é€Ÿï¼Œä¿è¯ä¸åŒç½‘ç»œä¸­çš„ç”¨æˆ·éƒ½èƒ½å¾—åˆ°è‰¯å¥½çš„è®¿é—®è´¨é‡ï¼›</li><li><strong>è¿œç¨‹åŠ é€Ÿ</strong> - è¿œç¨‹è®¿é—®ç”¨æˆ·æ ¹æ® DNS è´Ÿè½½å‡è¡¡æŠ€æœ¯æ™ºèƒ½è‡ªåŠ¨é€‰æ‹© Cache æœåŠ¡å™¨ï¼Œé€‰æ‹©æœ€å¿«çš„ Cache æœåŠ¡å™¨ï¼ŒåŠ å¿«è¿œç¨‹è®¿é—®çš„é€Ÿåº¦ï¼›</li><li><strong>å¸¦å®½ä¼˜åŒ–</strong> - è‡ªåŠ¨ç”ŸæˆæœåŠ¡å™¨çš„è¿œç¨‹ Mirrorï¼ˆé•œåƒï¼‰cache æœåŠ¡å™¨ï¼Œè¿œç¨‹ç”¨æˆ·è®¿é—®æ—¶ä» cache æœåŠ¡å™¨ä¸Šè¯»å–æ•°æ®ï¼Œå‡å°‘è¿œç¨‹è®¿é—®çš„å¸¦å®½ã€åˆ†æ‹…ç½‘ç»œæµé‡ã€å‡è½»åŸç«™ç‚¹ WEB æœåŠ¡å™¨è´Ÿè½½ç­‰åŠŸèƒ½ã€‚</li><li><strong>é›†ç¾¤æŠ—æ”»å‡»</strong> - å¹¿æ³›åˆ†å¸ƒçš„ CDN èŠ‚ç‚¹åŠ ä¸ŠèŠ‚ç‚¹ä¹‹é—´çš„æ™ºèƒ½å†—ä½™æœºåˆ¶ï¼Œå¯ä»¥æœ‰æ•ˆåœ°é¢„é˜²é»‘å®¢å…¥ä¾µä»¥åŠé™ä½å„ç§ D.D.o.S æ”»å‡»å¯¹ç½‘ç«™çš„å½±å“ï¼ŒåŒæ—¶ä¿è¯è¾ƒå¥½çš„æœåŠ¡è´¨é‡ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong><ul><li><strong>ä¸é€‚å®œç¼“å­˜åŠ¨æ€èµ„æº</strong><ul><li>è§£å†³æ–¹æ¡ˆï¼šä¸»è¦ç¼“å­˜é™æ€èµ„æºï¼ŒåŠ¨æ€èµ„æºå»ºç«‹å¤šçº§ç¼“å­˜æˆ–å‡†å®æ—¶åŒæ­¥ï¼›</li></ul></li><li><strong>å­˜åœ¨æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜</strong><ul><li>è§£å†³æ–¹æ¡ˆï¼ˆä¸»è¦æ˜¯åœ¨æ€§èƒ½å’Œæ•°æ®ä¸€è‡´æ€§äºŒè€…é—´å¯»æ‰¾ä¸€ä¸ªå¹³è¡¡ï¼‰<ul><li>è®¾ç½®ç¼“å­˜å¤±æ•ˆæ—¶é—´ï¼ˆ1 ä¸ªå°æ—¶ï¼Œè¿‡æœŸååŒæ­¥æ•°æ®ï¼‰ã€‚</li><li>é’ˆå¯¹èµ„æºè®¾ç½®ç‰ˆæœ¬å·ã€‚</li></ul></li></ul></li></ul></li></ul><h2 id="3-åå‘ä»£ç†ç¼“å­˜"><a class="markdownIt-Anchor" href="#3-åå‘ä»£ç†ç¼“å­˜"></a> 3. åå‘ä»£ç†ç¼“å­˜</h2><blockquote><p><strong>åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å— internet ä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™ internet ä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚</strong></p></blockquote><div align="center"><img src="http://dunwu.test.upcdn.net/cs/web/nginx/reverse-proxy.png!zp"/></div>### 3.1. ç¼“å­˜åŸç†<p>åå‘ä»£ç†ä½äºåº”ç”¨æœåŠ¡å™¨åŒä¸€ç½‘ç»œï¼Œå¤„ç†æ‰€æœ‰å¯¹ WEB æœåŠ¡å™¨çš„è¯·æ±‚ã€‚</p><p>åå‘ä»£ç†ç¼“å­˜çš„åŸç†ï¼š</p><ul><li>å¦‚æœç”¨æˆ·è¯·æ±‚çš„é¡µé¢åœ¨ä»£ç†æœåŠ¡å™¨ä¸Šæœ‰ç¼“å­˜çš„è¯ï¼Œä»£ç†æœåŠ¡å™¨ç›´æ¥å°†ç¼“å­˜å†…å®¹å‘é€ç»™ç”¨æˆ·ã€‚</li><li>å¦‚æœæ²¡æœ‰ç¼“å­˜åˆ™å…ˆå‘ WEB æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå–å›æ•°æ®ï¼Œæœ¬åœ°ç¼“å­˜åå†å‘é€ç»™ç”¨æˆ·ã€‚</li></ul><p>è¿™ç§æ–¹å¼é€šè¿‡é™ä½å‘ WEB æœåŠ¡å™¨çš„è¯·æ±‚æ•°ï¼Œä»è€Œé™ä½äº† WEB æœåŠ¡å™¨çš„è´Ÿè½½ã€‚</p><p><strong>åå‘ä»£ç†ç¼“å­˜ä¸€èˆ¬é’ˆå¯¹çš„æ˜¯é™æ€èµ„æºï¼Œè€Œå°†åŠ¨æ€èµ„æºè¯·æ±‚è½¬å‘åˆ°åº”ç”¨æœåŠ¡å™¨å¤„ç†</strong>ã€‚å¸¸ç”¨çš„ç¼“å­˜åº”ç”¨æœåŠ¡å™¨æœ‰ Varnishï¼ŒNgnixï¼ŒSquidã€‚</p><h3 id="32-ä»£ç†ç¼“å­˜æ¯”è¾ƒ"><a class="markdownIt-Anchor" href="#32-ä»£ç†ç¼“å­˜æ¯”è¾ƒ"></a> 3.2. ä»£ç†ç¼“å­˜æ¯”è¾ƒ</h3><p>å¸¸ç”¨çš„ä»£ç†ç¼“å­˜æœ‰ Varnishï¼ŒSquidï¼ŒNgnixï¼Œç®€å•æ¯”è¾ƒå¦‚ä¸‹ï¼š</p><ul><li>Varnish å’Œ Squid æ˜¯ä¸“ä¸šçš„ cache æœåŠ¡ï¼ŒNgnix éœ€è¦ç¬¬ä¸‰æ–¹æ¨¡å—æ”¯æŒï¼›</li><li>Varnish é‡‡ç”¨å†…å­˜å‹ç¼“å­˜ï¼Œé¿å…äº†é¢‘ç¹åœ¨å†…å­˜ã€ç£ç›˜ä¸­äº¤æ¢æ–‡ä»¶ï¼Œæ€§èƒ½æ¯” Squid é«˜ï¼›</li><li>Varnish ç”±äºæ˜¯å†…å­˜ cacheï¼Œæ‰€ä»¥å¯¹å°æ–‡ä»¶å¦‚ cssã€jsã€å°å›¾ç‰‡çš„æ”¯æŒå¾ˆæ£’ï¼Œåç«¯çš„æŒä¹…åŒ–ç¼“å­˜å¯ä»¥é‡‡ç”¨çš„æ˜¯ Squid æˆ– ATSï¼›</li><li>Squid åŠŸèƒ½å…¨è€Œå¤§ï¼Œé€‚åˆäºå„ç§é™æ€çš„æ–‡ä»¶ç¼“å­˜ï¼Œä¸€èˆ¬ä¼šåœ¨å‰ç«¯æŒ‚ä¸€ä¸ª HAProxy æˆ– Ngnix åšè´Ÿè½½å‡è¡¡è·‘å¤šä¸ªå®ä¾‹ï¼›</li><li>Nginx é‡‡ç”¨ç¬¬ä¸‰æ–¹æ¨¡å— ncache åšçš„ç¼“å†²ï¼Œæ€§èƒ½åŸºæœ¬è¾¾åˆ° Varnishï¼Œä¸€èˆ¬ä½œä¸ºåå‘ä»£ç†ä½¿ç”¨ï¼Œå¯ä»¥å®ç°ç®€å•çš„ç¼“å­˜ã€‚</li></ul><h2 id="4-è¿›ç¨‹å†…ç¼“å­˜"><a class="markdownIt-Anchor" href="#4-è¿›ç¨‹å†…ç¼“å­˜"></a> 4. è¿›ç¨‹å†…ç¼“å­˜</h2><blockquote><p>è¿›ç¨‹å†…ç¼“å­˜æ˜¯æŒ‡åº”ç”¨å†…éƒ¨çš„ç¼“å­˜ï¼Œæ ‡å‡†çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¸€èˆ¬æœ‰å¤šçº§ç¼“å­˜æ„æˆã€‚æœ¬åœ°ç¼“å­˜æ˜¯ç¦»åº”ç”¨æœ€è¿‘çš„ç¼“å­˜ï¼Œä¸€èˆ¬å¯ä»¥å°†æ•°æ®ç¼“å­˜åˆ°ç¡¬ç›˜æˆ–å†…å­˜ã€‚</p></blockquote><ul><li><code>ç¡¬ç›˜ç¼“å­˜</code> - å°†æ•°æ®ç¼“å­˜åˆ°ç¡¬ç›˜åˆ°ï¼Œè¯»å–æ—¶ä»ç¡¬ç›˜è¯»å–ã€‚åŸç†æ˜¯ç›´æ¥è¯»å–æœ¬æœºæ–‡ä»¶ï¼Œå‡å°‘äº†ç½‘ç»œä¼ è¾“æ¶ˆè€—ï¼Œæ¯”é€šè¿‡ç½‘ç»œè¯»å–æ•°æ®åº“é€Ÿåº¦æ›´å¿«ã€‚å¯ä»¥åº”ç”¨åœ¨å¯¹é€Ÿåº¦è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œä½†éœ€è¦å¤§é‡ç¼“å­˜å­˜å‚¨çš„åœºæ™¯ã€‚</li><li><code>å†…å­˜ç¼“å­˜</code> - ç›´æ¥å°†æ•°æ®å­˜å‚¨åˆ°æœ¬æœºå†…å­˜ä¸­ï¼Œé€šè¿‡ç¨‹åºç›´æ¥ç»´æŠ¤ç¼“å­˜å¯¹è±¡ï¼Œæ˜¯è®¿é—®é€Ÿåº¦æœ€å¿«çš„æ–¹å¼ã€‚</li></ul><p>å¸¸è§çš„æœ¬åœ°ç¼“å­˜å®ç°æ–¹æ¡ˆï¼šHashMapã€Guava Cacheã€Caffeineã€Ehcacheã€‚</p><h3 id="41-concurrenthashmap"><a class="markdownIt-Anchor" href="#41-concurrenthashmap"></a> 4.1. ConcurrentHashMap</h3><p>æœ€ç®€å•çš„è¿›ç¨‹å†…ç¼“å­˜å¯ä»¥é€šè¿‡ JDK è‡ªå¸¦çš„ <code>HashMap</code> æˆ– <code>ConcurrentHashMap</code> å®ç°ã€‚</p><p>é€‚ç”¨åœºæ™¯ï¼šä¸éœ€è¦æ·˜æ±°çš„ç¼“å­˜æ•°æ®ã€‚</p><p>ç¼ºç‚¹ï¼šæ— æ³•è¿›è¡Œç¼“å­˜æ·˜æ±°ï¼Œå†…å­˜ä¼šæ— é™åˆ¶çš„å¢é•¿ã€‚</p><h3 id="42-lruhashmap"><a class="markdownIt-Anchor" href="#42-lruhashmap"></a> 4.2. LRUHashMap</h3><p>å¯ä»¥é€šè¿‡ç»§æ‰¿ <code>LinkedHashMap</code> æ¥å®ç°ä¸€ä¸ªç®€å•çš„ <code>LRUHashMap</code>ã€‚é‡å†™ <code>removeEldestEntry</code> æ–¹æ³•ï¼Œå³å¯å®Œæˆä¸€ä¸ªç®€å•çš„æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ã€‚</p><ul><li>ç¼ºç‚¹ï¼š<ul><li>é”ç«äº‰ä¸¥é‡ï¼Œæ€§èƒ½æ¯”è¾ƒä½ã€‚</li><li>ä¸æ”¯æŒè¿‡æœŸæ—¶é—´</li><li>ä¸æ”¯æŒè‡ªåŠ¨åˆ·æ–°</li></ul></li></ul><h3 id="43-guava-cache"><a class="markdownIt-Anchor" href="#43-guava-cache"></a> 4.3. Guava Cache</h3><p>è§£å†³äº† <code>LRUHashMap</code> ä¸­çš„å‡ ä¸ªç¼ºç‚¹ã€‚</p><p>Guava Cache é‡‡ç”¨äº†ç±»ä¼¼ <code>ConcurrentHashMap</code> çš„æ€æƒ³ï¼Œåˆ†æ®µåŠ é”ï¼Œå‡å°‘é”ç«äº‰ã€‚</p><p>Guava Cache å¯¹äºè¿‡æœŸçš„ Entry å¹¶æ²¡æœ‰é©¬ä¸Šè¿‡æœŸ(ä¹Ÿå°±æ˜¯å¹¶æ²¡æœ‰åå°çº¿ç¨‹ä¸€ç›´åœ¨æ‰«)ï¼Œè€Œæ˜¯é€šè¿‡è¿›è¡Œè¯»å†™æ“ä½œçš„æ—¶å€™è¿›è¡Œè¿‡æœŸå¤„ç†ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯é¿å…åå°çº¿ç¨‹æ‰«æçš„æ—¶å€™è¿›è¡Œå…¨å±€åŠ é”ã€‚</p><p>ç›´æ¥é€šè¿‡æŸ¥è¯¢ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ»¡è¶³åˆ·æ–°æ¡ä»¶ï¼Œè¿›è¡Œåˆ·æ–°ã€‚</p><h3 id="44-caffeine"><a class="markdownIt-Anchor" href="#44-caffeine"></a> 4.4. Caffeine</h3><p>Caffeine å®ç°äº† W-TinyLFU(LFU+LRU ç®—æ³•çš„å˜ç§)ï¼Œå…¶å‘½ä¸­ç‡å’Œè¯»å†™ååé‡å¤§å¤§ä¼˜äº Guava Cacheã€‚</p><p>å…¶å®ç°åŸç†è¾ƒå¤æ‚ï¼Œå¯ä»¥å‚è€ƒ<a href="https://juejin.im/post/5b7593496fb9a009b62904fa#comment" target="_blank" rel="noopener">ä½ åº”è¯¥çŸ¥é“çš„ç¼“å­˜è¿›åŒ–å²</a>ã€‚</p><h3 id="45-é€‰æ‹©è¿›ç¨‹å†…ç¼“å­˜"><a class="markdownIt-Anchor" href="#45-é€‰æ‹©è¿›ç¨‹å†…ç¼“å­˜"></a> 4.5. é€‰æ‹©è¿›ç¨‹å†…ç¼“å­˜</h3><table><thead><tr><th>æ¯”è¾ƒé¡¹</th><th>ConcurrentHashMap</th><th>LRUMap</th><th>Ehcache</th><th>Guava Cache</th><th>Caffeine</th></tr></thead><tbody><tr><td>è¯»å†™æ€§èƒ½</td><td>å¾ˆå¥½ï¼Œåˆ†æ®µé”</td><td>ä¸€èˆ¬ï¼Œå…¨å±€åŠ é”</td><td>å¥½</td><td>å¥½ï¼Œéœ€è¦åšæ·˜æ±°æ“ä½œ</td><td>å¾ˆå¥½</td></tr><tr><td>æ·˜æ±°ç®—æ³•</td><td>æ— </td><td>LRUï¼Œä¸€èˆ¬</td><td>æ”¯æŒå¤šç§æ·˜æ±°ç®—æ³•,LRU,LFU,FIFO</td><td>LRUï¼Œä¸€èˆ¬</td><td>W-TinyLFU, å¾ˆå¥½</td></tr><tr><td>åŠŸèƒ½ä¸°å¯Œç¨‹åº¦</td><td>åŠŸèƒ½æ¯”è¾ƒç®€å•</td><td>åŠŸèƒ½æ¯”è¾ƒå•ä¸€</td><td>åŠŸèƒ½å¾ˆä¸°å¯Œ</td><td>åŠŸèƒ½å¾ˆä¸°å¯Œï¼Œæ”¯æŒåˆ·æ–°å’Œè™šå¼•ç”¨ç­‰</td><td>åŠŸèƒ½å’Œ Guava Cache ç±»ä¼¼</td></tr><tr><td>å·¥å…·å¤§å°</td><td>jdk è‡ªå¸¦ç±»ï¼Œå¾ˆå°</td><td>åŸºäº LinkedHashMapï¼Œè¾ƒå°</td><td>å¾ˆå¤§ï¼Œæœ€æ–°ç‰ˆæœ¬ 1.4MB</td><td>æ˜¯ Guava å·¥å…·ç±»ä¸­çš„ä¸€ä¸ªå°éƒ¨åˆ†ï¼Œè¾ƒå°</td><td>ä¸€èˆ¬ï¼Œæœ€æ–°ç‰ˆæœ¬ 644KB</td></tr><tr><td>æ˜¯å¦æŒä¹…åŒ–</td><td>å¦</td><td>å¦</td><td>æ˜¯</td><td>å¦</td><td>å¦</td></tr><tr><td>æ˜¯å¦æ”¯æŒé›†ç¾¤</td><td>å¦</td><td>å¦</td><td>æ˜¯</td><td>å¦</td><td>å¦</td></tr></tbody></table><ul><li><strong><code>ConcurrentHashMap</code></strong> - æ¯”è¾ƒé€‚åˆç¼“å­˜æ¯”è¾ƒå›ºå®šä¸å˜çš„å…ƒç´ ï¼Œä¸”ç¼“å­˜çš„æ•°é‡è¾ƒå°çš„ã€‚è™½ç„¶ä»ä¸Šé¢è¡¨æ ¼ä¸­æ¯”èµ·æ¥æœ‰ç‚¹é€Šè‰²ï¼Œä½†æ˜¯å…¶ç”±äºæ˜¯ JDK è‡ªå¸¦çš„ç±»ï¼Œåœ¨å„ç§æ¡†æ¶ä¸­ä¾ç„¶æœ‰å¤§é‡çš„ä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç”¨æ¥ç¼“å­˜æˆ‘ä»¬åå°„çš„ Methodï¼ŒField ç­‰ç­‰ï¼›ä¹Ÿå¯ä»¥ç¼“å­˜ä¸€äº›é“¾æ¥ï¼Œé˜²æ­¢å…¶é‡å¤å»ºç«‹ã€‚åœ¨ Caffeine ä¸­ä¹Ÿæ˜¯ä½¿ç”¨çš„ <code>ConcurrentHashMap</code> æ¥å­˜å‚¨å…ƒç´ ã€‚</li><li><strong><code>LRUMap</code></strong> - å¦‚æœä¸æƒ³å¼•å…¥ç¬¬ä¸‰æ–¹åŒ…ï¼Œåˆæƒ³ä½¿ç”¨æ·˜æ±°ç®—æ³•æ·˜æ±°æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªã€‚</li><li><strong><code>Ehcache</code></strong> - ç”±äºå…¶ jar åŒ…å¾ˆå¤§ï¼Œè¾ƒé‡é‡çº§ã€‚å¯¹äºéœ€è¦æŒä¹…åŒ–å’Œé›†ç¾¤çš„ä¸€äº›åŠŸèƒ½çš„ï¼Œå¯ä»¥é€‰æ‹© Ehcacheã€‚ç¬”è€…æ²¡æ€ä¹ˆä½¿ç”¨è¿‡è¿™ä¸ªç¼“å­˜ï¼Œå¦‚æœè¦é€‰æ‹©çš„è¯ï¼Œå¯ä»¥é€‰æ‹©åˆ†å¸ƒå¼ç¼“å­˜æ¥æ›¿ä»£ Ehcacheã€‚</li><li><strong><code>Guava Cache</code></strong> - Guava è¿™ä¸ª jar åŒ…åœ¨å¾ˆå¤š Java åº”ç”¨ç¨‹åºä¸­éƒ½æœ‰å¤§é‡çš„å¼•å…¥ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™å…¶å®æ˜¯ç›´æ¥ç”¨å°±å¥½äº†ï¼Œå¹¶ä¸”å…¶æœ¬èº«æ˜¯è½»é‡çº§çš„è€Œä¸”åŠŸèƒ½è¾ƒä¸ºä¸°å¯Œï¼Œåœ¨ä¸äº†è§£ Caffeine çš„æƒ…å†µä¸‹å¯ä»¥é€‰æ‹© Guava Cacheã€‚</li><li><strong><code>Caffeine</code></strong> - å…¶åœ¨å‘½ä¸­ç‡ï¼Œè¯»å†™æ€§èƒ½ä¸Šéƒ½æ¯” Guava Cache å¥½å¾ˆå¤šï¼Œå¹¶ä¸”å…¶ API å’Œ Guava cache åŸºæœ¬ä¸€è‡´ï¼Œç”šè‡³ä¼šå¤šä¸€ç‚¹ã€‚åœ¨çœŸå®ç¯å¢ƒä¸­ä½¿ç”¨ Caffeineï¼Œå–å¾—è¿‡ä¸é”™çš„æ•ˆæœã€‚</li></ul><p>æ€»ç»“ä¸€ä¸‹ï¼šå¦‚æœä¸éœ€è¦æ·˜æ±°ç®—æ³•åˆ™é€‰æ‹© <code>ConcurrentHashMap</code>ï¼Œå¦‚æœéœ€è¦æ·˜æ±°ç®—æ³•å’Œä¸€äº›ä¸°å¯Œçš„ APIï¼Œæ¨èé€‰æ‹© Caffeineã€‚</p><h2 id="5-åˆ†å¸ƒå¼ç¼“å­˜"><a class="markdownIt-Anchor" href="#5-åˆ†å¸ƒå¼ç¼“å­˜"></a> 5. åˆ†å¸ƒå¼ç¼“å­˜</h2><blockquote><p><strong>åˆ†å¸ƒå¼ç¼“å­˜è§£å†³äº†è¿›ç¨‹å†…ç¼“å­˜æœ€å¤§çš„é—®é¢˜ï¼šå¦‚æœåº”ç”¨æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒèŠ‚ç‚¹ä¹‹é—´æ— æ³•å…±äº«å½¼æ­¤çš„è¿›ç¨‹å†…ç¼“å­˜</strong>ã€‚</p><p>åˆ†å¸ƒå¼ç¼“å­˜çš„åº”ç”¨åœºæ™¯ï¼š</p><ul><li>ç¼“å­˜ç»è¿‡å¤æ‚è®¡ç®—å¾—åˆ°çš„æ•°æ®</li><li>ç¼“å­˜ç³»ç»Ÿä¸­é¢‘ç¹è®¿é—®çš„çƒ­ç‚¹æ•°æ®ï¼Œå‡è½»æ•°æ®åº“å‹åŠ›</li></ul></blockquote><p>ä¸åŒåˆ†å¸ƒå¼ç¼“å­˜çš„å®ç°åŸç†å¾€å¾€æœ‰æ¯”è¾ƒå¤§çš„å·®å¼‚ã€‚æœ¬æ–‡ä¸»è¦é’ˆå¯¹ Memcached å’Œ Redis è¿›è¡Œè¯´æ˜ã€‚</p><h3 id="51-memcache"><a class="markdownIt-Anchor" href="#51-memcache"></a> 5.1. Memcache</h3><blockquote><p><a href="https://memcached.org/" target="_blank" rel="noopener">Memcache</a> æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œåˆ†å¸ƒå¼å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿï¼Œé€šè¿‡åœ¨å†…å­˜é‡Œç»´æŠ¤ä¸€ä¸ªç»Ÿä¸€çš„å·¨å¤§çš„ hash è¡¨ï¼Œå®ƒèƒ½å¤Ÿç”¨æ¥å­˜å‚¨å„ç§æ ¼å¼çš„æ•°æ®ï¼ŒåŒ…æ‹¬å›¾åƒã€è§†é¢‘ã€æ–‡ä»¶ä»¥åŠæ•°æ®åº“æ£€ç´¢çš„ç»“æœç­‰ã€‚</p><p>ç®€å•çš„è¯´å°±æ˜¯ï¼šå°†æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œç„¶åä»å†…å­˜ä¸­è¯»å–ï¼Œä»è€Œå¤§å¤§æé«˜è¯»å–é€Ÿåº¦ã€‚</p></blockquote><h4 id="memcache-ç‰¹æ€§"><a class="markdownIt-Anchor" href="#memcache-ç‰¹æ€§"></a> Memcache ç‰¹æ€§</h4><ul><li><strong>ä½¿ç”¨ç‰©ç†å†…å­˜ä½œä¸ºç¼“å­˜åŒºï¼Œå¯ç‹¬ç«‹è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Š</strong>ã€‚æ¯ä¸ªè¿›ç¨‹æœ€å¤§ 2Gï¼Œå¦‚æœæƒ³ç¼“å­˜æ›´å¤šçš„æ•°æ®ï¼Œå¯ä»¥å¼€è¾Ÿæ›´å¤šçš„ Memcache è¿›ç¨‹ï¼ˆä¸åŒç«¯å£ï¼‰æˆ–è€…ä½¿ç”¨åˆ†å¸ƒå¼ Memcache è¿›è¡Œç¼“å­˜ï¼Œå°†æ•°æ®ç¼“å­˜åˆ°ä¸åŒçš„ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºä¸Šã€‚</li><li><strong>ä½¿ç”¨ key-value çš„æ–¹å¼æ¥å­˜å‚¨æ•°æ®</strong>ã€‚è¿™æ˜¯ä¸€ç§å•ç´¢å¼•çš„ç»“æ„åŒ–æ•°æ®ç»„ç»‡å½¢å¼ï¼Œå¯ä½¿æ•°æ®é¡¹æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</li><li><strong>åè®®ç®€å•ï¼ŒåŸºäºæ–‡æœ¬è¡Œçš„åè®®</strong>ã€‚ç›´æ¥é€šè¿‡ telnet åœ¨ Memcached æœåŠ¡å™¨ä¸Šå¯è¿›è¡Œå­˜å–æ•°æ®æ“ä½œï¼Œç®€å•ï¼Œæ–¹ä¾¿å¤šç§ç¼“å­˜å‚è€ƒæ­¤åè®®ï¼›</li><li><strong>åŸºäº libevent é«˜æ€§èƒ½é€šä¿¡</strong>ã€‚Libevent æ˜¯ä¸€å¥—åˆ©ç”¨ C å¼€å‘çš„ç¨‹åºåº“ï¼Œå®ƒå°† BSD ç³»ç»Ÿçš„ kqueue,Linux ç³»ç»Ÿçš„ epoll ç­‰äº‹ä»¶å¤„ç†åŠŸèƒ½å°è£…æˆä¸€ä¸ªæ¥å£ï¼Œä¸ä¼ ç»Ÿçš„ select ç›¸æ¯”ï¼Œæé«˜äº†æ€§èƒ½ã€‚</li><li><strong>åˆ†å¸ƒå¼èƒ½åŠ›å–å†³äº Memcache å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨ä¹‹é—´äº’ä¸é€šä¿¡</strong>ã€‚å„ä¸ª Memcached æœåŠ¡å™¨ä¹‹é—´äº’ä¸é€šä¿¡ï¼Œå„è‡ªç‹¬ç«‹å­˜å–æ•°æ®ï¼Œä¸å…±äº«ä»»ä½•ä¿¡æ¯ã€‚æœåŠ¡å™¨å¹¶ä¸å…·æœ‰åˆ†å¸ƒå¼åŠŸèƒ½ï¼Œåˆ†å¸ƒå¼éƒ¨ç½²å–å†³äº Memcached å®¢æˆ·ç«¯ã€‚</li><li><strong>é‡‡ç”¨ LRU ç¼“å­˜æ·˜æ±°ç­–ç•¥</strong>ã€‚åœ¨ Memcached å†…å­˜å‚¨æ•°æ®é¡¹æ—¶ï¼Œå¯ä»¥æŒ‡å®šå®ƒåœ¨ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ï¼Œé»˜è®¤ä¸ºæ°¸ä¹…ã€‚å½“ Memcached æœåŠ¡å™¨ç”¨å®Œåˆ†é…çš„å†…æ—¶ï¼Œå¤±æ•ˆçš„æ•°æ®è¢«é¦–å…ˆæ›¿æ¢ï¼Œç„¶åä¹Ÿæ˜¯æœ€è¿‘æœªä½¿ç”¨çš„æ•°æ®ã€‚åœ¨ LRU ä¸­ï¼ŒMemcached ä½¿ç”¨çš„æ˜¯ä¸€ç§ Lazy Expiration ç­–ç•¥ï¼Œè‡ªå·±ä¸ä¼šç›‘æ§å­˜å…¥çš„ key/vlue å¯¹æ˜¯å¦è¿‡æœŸï¼Œè€Œæ˜¯åœ¨è·å– key å€¼æ—¶æŸ¥çœ‹è®°å½•çš„æ—¶é—´æˆ³ï¼Œæ£€æŸ¥ key/value å¯¹ç©ºé—´æ˜¯å¦è¿‡æœŸï¼Œè¿™æ ·å¯å‡è½»æœåŠ¡å™¨çš„è´Ÿè½½ã€‚</li><li><strong>å†…ç½®äº†ä¸€å¥—é«˜æ•ˆçš„å†…å­˜ç®¡ç†ç®—æ³•</strong>ã€‚è¿™å¥—å†…å­˜ç®¡ç†æ•ˆç‡å¾ˆé«˜ï¼Œè€Œä¸”ä¸ä¼šé€ æˆå†…å­˜ç¢ç‰‡ï¼Œä½†æ˜¯å®ƒæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ä¼šå¯¼è‡´ç©ºé—´æµªè´¹ã€‚å½“å†…å­˜æ»¡åï¼Œé€šè¿‡ LRU ç®—æ³•è‡ªåŠ¨åˆ é™¤ä¸ä½¿ç”¨çš„ç¼“å­˜ã€‚</li><li><strong>ä¸æ”¯æŒæŒä¹…åŒ–</strong>ã€‚Memcached æ²¡æœ‰è€ƒè™‘æ•°æ®çš„å®¹ç¾é—®é¢˜ï¼Œé‡å¯æœåŠ¡ï¼Œæ‰€æœ‰æ•°æ®ä¼šä¸¢å¤±ã€‚</li></ul><h4 id="memcache-å·¥ä½œåŸç†"><a class="markdownIt-Anchor" href="#memcache-å·¥ä½œåŸç†"></a> Memcache å·¥ä½œåŸç†</h4><p>ï¼ˆ1ï¼‰å†…å­˜ç®¡ç†</p><p>Memcached åˆ©ç”¨ <strong>slab allocation</strong> æœºåˆ¶æ¥åˆ†é…å’Œç®¡ç†å†…å­˜ï¼Œå®ƒæŒ‰ç…§é¢„å…ˆè§„å®šçš„å¤§å°ï¼Œå°†åˆ†é…çš„å†…å­˜åˆ†å‰²æˆç‰¹å®šé•¿åº¦çš„å†…å­˜å—ï¼Œå†æŠŠå°ºå¯¸ç›¸åŒçš„å†…å­˜å—åˆ†æˆç»„ï¼Œæ•°æ®åœ¨å­˜æ”¾æ—¶ï¼Œæ ¹æ®é”®å€¼ å¤§å°å»åŒ¹é… slab å¤§å°ï¼Œæ‰¾å°±è¿‘çš„ slab å­˜æ”¾ï¼Œæ‰€ä»¥å­˜åœ¨ç©ºé—´æµªè´¹ç°è±¡ã€‚</p><p>è¿™å¥—å†…å­˜ç®¡ç†æ•ˆç‡å¾ˆé«˜ï¼Œè€Œä¸”ä¸ä¼šé€ æˆå†…å­˜ç¢ç‰‡ï¼Œä½†æ˜¯å®ƒæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ä¼šå¯¼è‡´ç©ºé—´æµªè´¹ã€‚</p><p>ï¼ˆ2ï¼‰ç¼“å­˜æ·˜æ±°ç­–ç•¥</p><p>Memcached çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥æ˜¯ <strong>LRU</strong> + åˆ°æœŸå¤±æ•ˆç­–ç•¥ã€‚</p><p>å½“ä½ åœ¨ Memcached å†…å­˜å‚¨æ•°æ®é¡¹æ—¶ï¼Œä½ æœ‰å¯èƒ½ä¼šæŒ‡å®šå®ƒåœ¨ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ï¼Œé»˜è®¤ä¸ºæ°¸ä¹…ã€‚å½“ Memcached æœåŠ¡å™¨ç”¨å®Œåˆ†é…çš„å†…æ—¶ï¼Œå¤±æ•ˆçš„æ•°æ®è¢«é¦–å…ˆæ›¿æ¢ï¼Œç„¶åæ˜¯æœ€è¿‘æœªä½¿ç”¨çš„æ•°æ®ã€‚</p><p>åœ¨ LRU ä¸­ï¼ŒMemcached ä½¿ç”¨çš„æ˜¯ä¸€ç§ Lazy Expiration ç­–ç•¥ï¼š<strong>Memcached ä¸ä¼šç›‘æ§å­˜å…¥çš„ key/vlue å¯¹æ˜¯å¦è¿‡æœŸ</strong>ï¼Œè€Œæ˜¯åœ¨è·å– key å€¼æ—¶æŸ¥çœ‹è®°å½•çš„æ—¶é—´æˆ³ï¼Œ<strong>æ£€æŸ¥ key/value å¯¹ç©ºé—´æ˜¯å¦è¿‡æœŸ</strong>ï¼Œè¿™æ ·å¯å‡è½»æœåŠ¡å™¨çš„è´Ÿè½½ã€‚</p><p>ï¼ˆ3ï¼‰åˆ†åŒº</p><p>Memcached æœåŠ¡å™¨ä¹‹é—´å½¼æ­¤ä¸é€šä¿¡ï¼Œå®ƒçš„åˆ†å¸ƒå¼èƒ½åŠ›æ˜¯ä¾èµ–å®¢æˆ·ç«¯æ¥å®ç°ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯å®ç°ä¸€ç§ç®—æ³•ï¼Œæ ¹æ® key æ¥è®¡ç®—å‡ºæ•°æ®åº”è¯¥å‘å“ªä¸ªæœåŠ¡å™¨èŠ‚ç‚¹è¯»/å†™ã€‚</p><p>è€Œè¿™ç§é€‰å–é›†ç¾¤èŠ‚ç‚¹çš„ç®—æ³•å¸¸è§çš„æœ‰ä¸‰ç§ï¼š</p><ul><li><strong>å“ˆå¸Œå–ä½™ç®—æ³•</strong> - ä½¿ç”¨å…¬å¼ï¼š<code>hashï¼ˆkeyï¼‰% N</code> è®¡ç®—å‡º <strong>å“ˆå¸Œå€¼</strong> æ¥å†³å®šæ•°æ®æ˜ å°„åˆ°å“ªä¸€ä¸ªèŠ‚ç‚¹ã€‚</li><li><strong>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</strong> - å¯ä»¥å¾ˆå¥½çš„è§£å†³ <strong>ç¨³å®šæ€§é—®é¢˜</strong>ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„ <strong>å­˜å‚¨èŠ‚ç‚¹</strong> æ’åˆ—åœ¨ <strong>é¦–å°¾ç›¸æ¥</strong> çš„ <code>Hash</code> ç¯ä¸Šï¼Œæ¯ä¸ª <code>key</code> åœ¨è®¡ç®— <code>Hash</code> åä¼š <strong>é¡ºæ—¶é’ˆ</strong> æ‰¾åˆ° <strong>ä¸´æ¥</strong> çš„ <strong>å­˜å‚¨èŠ‚ç‚¹</strong> å­˜æ”¾ã€‚è€Œå½“æœ‰èŠ‚ç‚¹ <strong>åŠ å…¥</strong> æˆ– <strong>é€€å‡º</strong> æ—¶ï¼Œä»…å½±å“è¯¥èŠ‚ç‚¹åœ¨ <code>Hash</code> ç¯ä¸Š <strong>é¡ºæ—¶é’ˆç›¸é‚»</strong> çš„ <strong>åç»­èŠ‚ç‚¹</strong>ã€‚</li><li><strong>è™šæ‹Ÿ Hash æ§½ç®—æ³•</strong> - ä½¿ç”¨ <strong>åˆ†æ•£åº¦è‰¯å¥½</strong> çš„ <strong>å“ˆå¸Œå‡½æ•°</strong> æŠŠæ‰€æœ‰æ•°æ® <strong>æ˜ å°„</strong> åˆ°ä¸€ä¸ª <strong>å›ºå®šèŒƒå›´</strong> çš„ <strong>æ•´æ•°é›†åˆ</strong> ä¸­ï¼Œæ•´æ•°å®šä¹‰ä¸º <strong>æ§½</strong>ï¼ˆ<code>slot</code>ï¼‰ï¼Œè¿™ä¸ªèŒƒå›´ä¸€èˆ¬ <strong>è¿œè¿œå¤§äº</strong> èŠ‚ç‚¹æ•°ã€‚<strong>æ§½</strong> æ˜¯é›†ç¾¤å†… <strong>æ•°æ®ç®¡ç†</strong> å’Œ <strong>è¿ç§»</strong> çš„ <strong>åŸºæœ¬å•ä½</strong>ã€‚é‡‡ç”¨ <strong>å¤§èŒƒå›´æ§½</strong> çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ <strong>æ•°æ®æ‹†åˆ†</strong> å’Œ <strong>é›†ç¾¤æ‰©å±•</strong>ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¼šè´Ÿè´£ <strong>ä¸€å®šæ•°é‡çš„æ§½</strong>ã€‚</li></ul><h3 id="52-redis"><a class="markdownIt-Anchor" href="#52-redis"></a> 5.2. Redis</h3><blockquote><p>Redis æ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSD è®¸å¯ï¼‰çš„ï¼ŒåŸºäºå†…å­˜çš„ï¼Œå¤šæ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿã€‚å¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚</p><p>Redis è¿˜å¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯åˆ†ç‰‡æ¥æ‰©å±•å†™æ€§èƒ½ã€‚å†…ç½®äº† å¤åˆ¶ï¼ˆreplicationï¼‰ï¼ŒLUA è„šæœ¬ï¼ˆLua scriptingï¼‰ï¼ŒLRU é©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰ï¼Œäº‹åŠ¡ï¼ˆtransactionsï¼‰ å’Œä¸åŒçº§åˆ«çš„ ç£ç›˜æŒä¹…åŒ–ï¼ˆpersistenceï¼‰ï¼Œ å¹¶é€šè¿‡ Redis å“¨å…µï¼ˆSentinelï¼‰å’Œè‡ªåŠ¨åˆ†åŒºï¼ˆClusterï¼‰æä¾›é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰ã€‚</p></blockquote><h4 id="redis-ç‰¹æ€§"><a class="markdownIt-Anchor" href="#redis-ç‰¹æ€§"></a> Redis ç‰¹æ€§</h4><ul><li><p>æ”¯æŒå¤šç§æ•°æ®ç±»å‹ - stringã€hashã€listã€setã€sorted setã€‚</p></li><li><p>æ”¯æŒå¤šç§æ•°æ®æ·˜æ±°ç­–ç•¥</p><ul><li><strong>volatile-lru</strong> - ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li><li><strong>volatile-ttl</strong> - ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°</li><li><strong>volatile-random</strong> - ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</li><li><strong>allkeys-lru</strong> - ä»æ‰€æœ‰æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li><li><strong>allkeys-random</strong> - ä»æ‰€æœ‰æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®è¿›è¡Œæ·˜æ±°</li><li><strong>noeviction</strong> - ç¦æ­¢é©±é€æ•°æ®</li></ul></li><li><p>æä¾›ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ - RDB å’Œ AOF</p></li><li><p>é€šè¿‡ Redis cluster æä¾›é›†ç¾¤æ¨¡å¼ã€‚</p></li></ul><h4 id="redis-åŸç†"><a class="markdownIt-Anchor" href="#redis-åŸç†"></a> Redis åŸç†</h4><ul><li>ç¼“å­˜æ·˜æ±°<ul><li>Redis æœ‰ä¸¤ç§æ•°æ®æ·˜æ±°å®ç°<ul><li>æ¶ˆææ–¹å¼ - è®¿é—® Redis key æ—¶ï¼Œå¦‚æœå‘ç°å®ƒå·²ç»å¤±æ•ˆï¼Œåˆ™åˆ é™¤å®ƒ</li><li>ç§¯ææ–¹å¼ - å‘¨æœŸæ€§ä»è®¾ç½®äº†å¤±æ•ˆæ—¶é—´çš„ key ä¸­ï¼Œæ ¹æ®æ·˜æ±°ç­–ç•¥ï¼Œé€‰æ‹©ä¸€éƒ¨åˆ†å¤±æ•ˆçš„ key è¿›è¡Œåˆ é™¤ã€‚</li></ul></li></ul></li><li>åˆ†åŒº<ul><li>Redis Cluster é›†ç¾¤åŒ…å« 16384 ä¸ªè™šæ‹Ÿ Hash æ§½ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥è®¡ç®— key å±äºå“ªä¸ª Hash æ§½ã€‚</li><li>Redis Cluster æ”¯æŒè¯·æ±‚åˆ†å‘ - èŠ‚ç‚¹åœ¨æ¥åˆ°ä¸€ä¸ªå‘½ä»¤è¯·æ±‚æ—¶ï¼Œä¼šå…ˆæ£€æµ‹è¿™ä¸ªå‘½ä»¤è¯·æ±‚è¦å¤„ç†çš„é”®æ‰€åœ¨çš„æ§½æ˜¯å¦ç”±è‡ªå·±è´Ÿè´£ï¼Œå¦‚æœä¸æ˜¯çš„è¯ï¼ŒèŠ‚ç‚¹å°†å‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ª MOVED é”™è¯¯ï¼ŒMOVED é”™è¯¯æºå¸¦çš„ä¿¡æ¯å¯ä»¥æŒ‡å¼•å®¢æˆ·ç«¯å°†è¯·æ±‚é‡å®šå‘è‡³æ­£åœ¨è´Ÿè´£ç›¸å…³æ§½çš„èŠ‚ç‚¹ã€‚</li></ul></li><li>ä¸»ä»å¤åˆ¶<ul><li>Redis 2.8 åæ”¯æŒå¼‚æ­¥å¤åˆ¶ã€‚å®ƒæœ‰ä¸¤ç§æ¨¡å¼ï¼š<ul><li><code>å®Œæ•´é‡åŒæ­¥ï¼ˆfull resychronizationï¼‰</code> - ç”¨äºåˆæ¬¡å¤åˆ¶ã€‚æ‰§è¡Œæ­¥éª¤ä¸ <code>SYNC</code> å‘½ä»¤åŸºæœ¬ä¸€è‡´ã€‚</li><li><code>éƒ¨åˆ†é‡åŒæ­¥ï¼ˆpartial resychronizationï¼‰</code> - ç”¨äºæ–­çº¿åé‡å¤åˆ¶ã€‚å¦‚æœæ¡ä»¶å…è®¸ï¼Œä¸»æœåŠ¡å™¨å¯ä»¥å°†ä¸»ä»æœåŠ¡å™¨è¿æ¥æ–­å¼€æœŸé—´æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨åªéœ€æ¥æ”¶å¹¶æ‰§è¡Œè¿™äº›å†™å‘½ä»¤ï¼Œå³å¯å°†ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®åº“çŠ¶æ€ä¿æŒä¸€è‡´ã€‚</li></ul></li><li>é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå®šæœŸå‘é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹å‘é€ PING æ¶ˆæ¯ï¼Œä»¥æ­¤æ¥æ£€æµ‹å¯¹æ–¹æ˜¯å¦åœ¨çº¿ã€‚</li><li>å¦‚æœä¸€ä¸ªä¸»èŠ‚ç‚¹è¢«è®¤ä¸ºä¸‹çº¿ï¼Œåˆ™åœ¨å…¶ä»èŠ‚ç‚¹ä¸­ï¼Œæ ¹æ® Raft ç®—æ³•ï¼Œé€‰ä¸¾å‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå‡çº§ä¸ºä¸»èŠ‚ç‚¹ã€‚</li></ul></li><li>æ•°æ®ä¸€è‡´æ€§<ul><li>Redis ä¸ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œå› ä¸ºè¿™ä¼šä½¿å¾—é›†ç¾¤æ€§èƒ½å¤§å¤§é™ä½ã€‚</li><li>Redis æ˜¯é€šè¿‡å¼‚æ­¥å¤åˆ¶æ¥å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚</li></ul></li></ul><h3 id="53-é€‰æ‹©åˆ†å¸ƒå¼ç¼“å­˜"><a class="markdownIt-Anchor" href="#53-é€‰æ‹©åˆ†å¸ƒå¼ç¼“å­˜"></a> 5.3. é€‰æ‹©åˆ†å¸ƒå¼ç¼“å­˜</h3><p>ä¸åŒçš„åˆ†å¸ƒå¼ç¼“å­˜åŠŸèƒ½ç‰¹æ€§å’Œå®ç°åŸç†æ–¹é¢æœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œå› æ­¤ä»–ä»¬æ‰€é€‚åº”çš„åœºæ™¯ä¹Ÿæœ‰æ‰€ä¸åŒã€‚</p><p>è¿™é‡Œé€‰å–ä¸‰ä¸ªæ¯”è¾ƒå‡ºåçš„åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆMemCacheï¼ŒRedisï¼ŒTairï¼‰æ¥ä½œä¸ºæ¯”è¾ƒï¼š</p><table><thead><tr><th>æ¯”è¾ƒé¡¹</th><th>MemCache</th><th>Redis</th><th>Tair</th></tr></thead><tbody><tr><td>æ•°æ®ç»“æ„</td><td>åªæ”¯æŒç®€å•çš„ Key-Value ç»“æ„</td><td>String,Hash, List, Set, Sorted Set</td><td>String,HashMap, Listï¼ŒSet</td></tr><tr><td>æŒä¹…åŒ–</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>å®¹é‡å¤§å°</td><td>æ•°æ®çº¯å†…å­˜ï¼Œæ•°æ®å­˜å‚¨ä¸å®œè¿‡å¤š</td><td>æ•°æ®å…¨å†…å­˜ï¼Œèµ„æºæˆæœ¬è€ƒé‡ä¸å®œè¶…è¿‡ 100GB</td><td>å¯ä»¥é…ç½®å…¨å†…å­˜æˆ–å†…å­˜+ç£ç›˜å¼•æ“ï¼Œæ•°æ®å®¹é‡å¯æ— é™æ‰©å……</td></tr><tr><td>è¯»å†™æ€§èƒ½</td><td>å¾ˆé«˜</td><td>å¾ˆé«˜(RT0.5ms å·¦å³)</td><td>String ç±»å‹æ¯”è¾ƒé«˜(RT1ms å·¦å³)ï¼Œå¤æ‚ç±»å‹æ¯”è¾ƒæ…¢(RT5ms å·¦å³)</td></tr><tr><td>è¿‡æœŸç­–ç•¥</td><td>è¿‡æœŸåï¼Œä¸åˆ é™¤ç¼“å­˜</td><td>æœ‰å…­ç§ç­–ç•¥æ¥å¤„ç†è¿‡æœŸæ•°æ®</td><td>æ”¯æŒ</td></tr></tbody></table><ul><li><code>MemCache</code> - è¿™ä¸€å—æ¥è§¦å¾—æ¯”è¾ƒå°‘ï¼Œä¸åšè¿‡å¤šçš„æ¨èã€‚å…¶ååé‡è¾ƒå¤§ï¼Œä½†æ˜¯æ”¯æŒçš„æ•°æ®ç»“æ„è¾ƒå°‘ï¼Œå¹¶ä¸”ä¸æ”¯æŒæŒä¹…åŒ–ã€‚</li><li><code>Redis</code> - æ”¯æŒä¸°å¯Œçš„æ•°æ®ç»“æ„ï¼Œè¯»å†™æ€§èƒ½å¾ˆé«˜ï¼Œä½†æ˜¯æ•°æ®å…¨å†…å­˜ï¼Œå¿…é¡»è¦è€ƒè™‘èµ„æºæˆæœ¬ï¼Œæ”¯æŒæŒä¹…åŒ–ã€‚</li><li><code>Tair</code> - æ”¯æŒä¸°å¯Œçš„æ•°æ®ç»“æ„ï¼Œè¯»å†™æ€§èƒ½è¾ƒé«˜ï¼Œéƒ¨åˆ†ç±»å‹æ¯”è¾ƒæ…¢ï¼Œç†è®ºä¸Šå®¹é‡å¯ä»¥æ— é™æ‰©å……ã€‚</li></ul><p>æ€»ç»“ï¼šå¦‚æœæœåŠ¡å¯¹å»¶è¿Ÿæ¯”è¾ƒæ•æ„Ÿï¼ŒMap/Set æ•°æ®ä¹Ÿæ¯”è¾ƒå¤šçš„è¯ï¼Œæ¯”è¾ƒé€‚åˆ Redisã€‚å¦‚æœæœåŠ¡éœ€è¦æ”¾å…¥ç¼“å­˜é‡çš„æ•°æ®å¾ˆå¤§ï¼Œå¯¹å»¶è¿Ÿåˆä¸æ˜¯ç‰¹åˆ«æ•æ„Ÿçš„è¯ï¼Œé‚£å°±å¯ä»¥é€‰æ‹© Tairã€‚</p><h2 id="6-å¤šçº§ç¼“å­˜"><a class="markdownIt-Anchor" href="#6-å¤šçº§ç¼“å­˜"></a> 6. å¤šçº§ç¼“å­˜</h2><h3 id="61-ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜"><a class="markdownIt-Anchor" href="#61-ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜"></a> 6.1. ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜</h3><p>å¦‚æœåº”ç”¨æœåŠ¡ä¸æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œé‚£ä¹ˆè¿›ç¨‹å†…ç¼“å­˜å½“ç„¶æ˜¯ç¼“å­˜çš„é¦–é€‰æ–¹æ¡ˆã€‚</p><p>å¯¹äºè¿›ç¨‹å†…ç¼“å­˜ï¼Œå…¶æœ¬æ¥å—é™äºå†…å­˜çš„å¤§å°çš„é™åˆ¶ï¼Œä»¥åŠè¿›ç¨‹ç¼“å­˜æ›´æ–°åå…¶ä»–ç¼“å­˜æ— æ³•å¾—çŸ¥ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´è¿›ç¨‹ç¼“å­˜é€‚ç”¨äº:</p><ol><li>æ•°æ®é‡ä¸æ˜¯å¾ˆå¤§ä¸”æ›´æ–°é¢‘ç‡è¾ƒä½çš„æ•°æ®ã€‚</li><li>å¦‚æœæ›´æ–°é¢‘ç¹çš„æ•°æ®ï¼Œä¹Ÿæƒ³ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜ï¼Œé‚£ä¹ˆå¯ä»¥å°†å…¶è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºè¾ƒçŸ­çš„æ—¶é—´ï¼Œæˆ–è€…è®¾ç½®è¾ƒçŸ­çš„è‡ªåŠ¨åˆ·æ–°æ—¶é—´ã€‚</li></ol><p>è¿™ç§æ–¹æ¡ˆå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>å¦‚æœåº”ç”¨æœåŠ¡æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåº”ç”¨èŠ‚ç‚¹ä¹‹é—´æ— æ³•å…±äº«ç¼“å­˜ï¼Œå­˜åœ¨æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</li><li>ç”±äºè¿›ç¨‹å†…ç¼“å­˜å—é™äºå†…å­˜å¤§å°çš„é™åˆ¶ï¼Œæ‰€ä»¥ç¼“å­˜ä¸èƒ½æ— é™æ‰©å±•ã€‚</li></ul><h3 id="62-ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜"><a class="markdownIt-Anchor" href="#62-ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜"></a> 6.2. ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜</h3><p>å¦‚æœåº”ç”¨æœåŠ¡æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œé‚£ä¹ˆæœ€ç®€å•çš„ç¼“å­˜æ–¹æ¡ˆå°±æ˜¯ç›´æ¥ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜ã€‚</p><p>å…¶åº”ç”¨åœºæ™¯å¦‚å›¾æ‰€ç¤ºï¼š</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/technology/cache/å¤šçº§ç¼“å­˜1.png!zp" width="600px"/></div>Redis ç”¨æ¥å­˜å‚¨çƒ­ç‚¹æ•°æ®ï¼Œå¦‚æœç¼“å­˜ä¸å‘½ä¸­ï¼Œåˆ™å»æŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶æ›´æ–°ç¼“å­˜ã€‚<p>è¿™ç§æ–¹æ¡ˆå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li>ç¼“å­˜æœåŠ¡å¦‚æœæŒ‚äº†ï¼Œè¿™æ—¶åº”ç”¨åªèƒ½è®¿é—®æ•°æ®åº“ï¼Œå®¹æ˜“é€ æˆç¼“å­˜é›ªå´©ã€‚</li><li>è®¿é—®åˆ†å¸ƒå¼ç¼“å­˜æœåŠ¡ä¼šæœ‰ä¸€å®šçš„ I/O ä»¥åŠåºåˆ—åŒ–ååºåˆ—åŒ–çš„å¼€é”€ï¼Œè™½ç„¶æ€§èƒ½å¾ˆé«˜ï¼Œä½†æ˜¯å…¶ç»ˆç©¶æ²¡æœ‰åœ¨å†…å­˜ä¸­æŸ¥è¯¢å¿«ã€‚</li></ol><h3 id="63-ä½¿ç”¨å¤šçº§ç¼“å­˜"><a class="markdownIt-Anchor" href="#63-ä½¿ç”¨å¤šçº§ç¼“å­˜"></a> 6.3. ä½¿ç”¨å¤šçº§ç¼“å­˜</h3><p>å•çº¯ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜éƒ½å­˜åœ¨å„è‡ªçš„ä¸è¶³ã€‚å¦‚æœéœ€è¦æ›´é«˜çš„æ€§èƒ½ä»¥åŠæ›´å¥½çš„å¯ç”¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç¼“å­˜è®¾è®¡ä¸ºå¤šçº§ç»“æ„ã€‚å°†æœ€çƒ­çš„æ•°æ®ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¿›ä¸€æ­¥æå‡è®¿é—®é€Ÿåº¦ã€‚</p><p>è¿™ä¸ªè®¾è®¡æ€è·¯åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ä¹Ÿå­˜åœ¨ï¼Œæ¯”å¦‚ CPU ä½¿ç”¨ L1ã€L2ã€L3 å¤šçº§ç¼“å­˜ï¼Œç”¨æ¥å‡å°‘å¯¹å†…å­˜çš„ç›´æ¥è®¿é—®ï¼Œä»è€ŒåŠ å¿«è®¿é—®é€Ÿåº¦ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¤šçº§ç¼“å­˜æ¶æ„ä½¿ç”¨äºŒçº§ç¼“å­˜å·²å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†ä¸šåŠ¡éœ€æ±‚ï¼Œè¿‡å¤šçš„åˆ†çº§ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ä»¥åŠç»´æŠ¤çš„æˆæœ¬ã€‚å› æ­¤ï¼Œå¤šçº§ç¼“å­˜ä¸æ˜¯åˆ†çº§è¶Šå¤šè¶Šå¥½ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæƒè¡¡ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„äºŒçº§ç¼“å­˜æ¶æ„ï¼Œå¯ä»¥ä½¿ç”¨è¿›ç¨‹å†…ç¼“å­˜ï¼ˆå¦‚ï¼š Caffeine/Google Guava/Ehcache/HashMapï¼‰ä½œä¸ºä¸€çº§ç¼“å­˜ï¼›ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¦‚ï¼šRedis/Memcachedï¼‰ä½œä¸ºäºŒçº§ç¼“å­˜ã€‚</p><h4 id="å¤šçº§ç¼“å­˜æŸ¥è¯¢"><a class="markdownIt-Anchor" href="#å¤šçº§ç¼“å­˜æŸ¥è¯¢"></a> å¤šçº§ç¼“å­˜æŸ¥è¯¢</h4><div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/technology/cache/å¤šçº§ç¼“å­˜2.png!zp" width="600" /></div>å¤šçº§ç¼“å­˜æŸ¥è¯¢æµç¨‹å¦‚ä¸‹ï¼š<ol><li>é¦–å…ˆï¼ŒæŸ¥è¯¢ L1 ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›ç»“æœï¼›å¦‚æœæ²¡æœ‰å‘½ä¸­ï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥ã€‚</li><li>æ¥ä¸‹æ¥ï¼ŒæŸ¥è¯¢ L2 ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›ç»“æœå¹¶å›å¡« L1 ç¼“å­˜ï¼›å¦‚æœæ²¡æœ‰å‘½ä¸­ï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥ã€‚</li><li>æœ€åï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œè¿”å›ç»“æœå¹¶ä¾æ¬¡å›å¡« L2 ç¼“å­˜ã€L1 ç¼“å­˜ã€‚</li></ol><h4 id="å¤šçº§ç¼“å­˜æ›´æ–°"><a class="markdownIt-Anchor" href="#å¤šçº§ç¼“å­˜æ›´æ–°"></a> å¤šçº§ç¼“å­˜æ›´æ–°</h4><p>å¯¹äº L1 ç¼“å­˜ï¼Œå¦‚æœæœ‰æ•°æ®æ›´æ–°ï¼Œåªèƒ½åˆ é™¤å¹¶æ›´æ–°æ‰€åœ¨æœºå™¨ä¸Šçš„ç¼“å­˜ï¼Œå…¶ä»–æœºå™¨åªèƒ½é€šè¿‡è¶…æ—¶æœºåˆ¶æ¥åˆ·æ–°ç¼“å­˜ã€‚è¶…æ—¶è®¾å®šå¯ä»¥æœ‰ä¸¤ç§ç­–ç•¥:</p><ul><li>è®¾ç½®æˆå†™å…¥åå¤šå°‘æ—¶é—´åè¿‡æœŸ</li><li>è®¾ç½®æˆå†™å…¥åå¤šå°‘æ—¶é—´åˆ·æ–°</li></ul><p>å¯¹äº L1 ç¼“å­˜ï¼Œå¦‚æœæœ‰æ•°æ®æ›´æ–°ï¼Œå…¶ä»–æœºå™¨ç«‹é©¬å¯è§ã€‚ä½†æ˜¯ï¼Œä¹Ÿå¿…é¡»è¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå…¶æ—¶é—´åº”è¯¥æ¯” L1 ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´é•¿ã€‚</p><p>ä¸ºäº†è§£å†³è¿›ç¨‹å†…ç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œè®¾è®¡å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–:</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/technology/cache/å¤šçº§ç¼“å­˜3.png!zp" /></div>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—çš„å‘å¸ƒã€è®¢é˜…æœºåˆ¶ï¼Œå¯ä»¥é€šçŸ¥å…¶ä»–åº”ç”¨èŠ‚ç‚¹å¯¹è¿›ç¨‹å†…ç¼“å­˜è¿›è¡Œæ›´æ–°ã€‚ä½¿ç”¨è¿™ç§æ–¹æ¡ˆï¼Œå³ä½¿æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡æŒ‚äº†æˆ–ä¸å¯é ï¼Œç”±äºå…ˆæ‰§è¡Œäº†æ•°æ®åº“æ›´æ–°ï¼Œä½†è¿›ç¨‹å†…ç¼“å­˜è¿‡æœŸï¼Œåˆ·æ–°ç¼“å­˜æ—¶ï¼Œä¹Ÿèƒ½ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚<h2 id="7-ç¼“å­˜é—®é¢˜"><a class="markdownIt-Anchor" href="#7-ç¼“å­˜é—®é¢˜"></a> 7. ç¼“å­˜é—®é¢˜</h2><h3 id="71-ç¼“å­˜é›ªå´©"><a class="markdownIt-Anchor" href="#71-ç¼“å­˜é›ªå´©"></a> 7.1. ç¼“å­˜é›ªå´©</h3><blockquote><p><strong>ç¼“å­˜é›ªå´©æ˜¯æŒ‡ç¼“å­˜ä¸å¯ç”¨æˆ–è€…å¤§é‡ç¼“å­˜ç”±äºè¶…æ—¶æ—¶é—´ç›¸åŒåœ¨åŒä¸€æ—¶é—´æ®µå¤±æ•ˆï¼Œå¤§é‡è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œæ•°æ®åº“å‹åŠ›è¿‡å¤§å¯¼è‡´ç³»ç»Ÿé›ªå´©</strong>ã€‚</p></blockquote><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>å¢åŠ ç¼“å­˜ç³»ç»Ÿå¯ç”¨æ€§ã€‚é€šè¿‡ç›‘æ§å…³æ³¨ç¼“å­˜çš„å¥åº·ç¨‹åº¦ï¼Œæ ¹æ®ä¸šåŠ¡é‡é€‚å½“çš„æ‰©å®¹ç¼“å­˜ã€‚</li><li>é‡‡ç”¨å¤šçº§ç¼“å­˜ã€‚ä¸åŒçº§åˆ«ç¼“å­˜è®¾ç½®çš„è¶…æ—¶æ—¶é—´ä¸åŒï¼Œå³ä½¿æŸä¸ªçº§åˆ«ç¼“å­˜éƒ½è¿‡æœŸï¼Œä¹Ÿæœ‰å…¶ä»–çº§åˆ«ç¼“å­˜å…œåº•ã€‚</li><li>ç¼“å­˜çš„è¿‡æœŸæ—¶é—´å¯ä»¥å–ä¸ªéšæœºå€¼ã€‚æ¯”å¦‚ä»¥å‰æ˜¯è®¾ç½® 10 åˆ†é’Ÿçš„è¶…æ—¶æ—¶é—´ï¼Œé‚£æ¯ä¸ª Key éƒ½å¯ä»¥éšæœº 8-13 åˆ†é’Ÿè¿‡æœŸï¼Œå°½é‡è®©ä¸åŒ Key çš„è¿‡æœŸæ—¶é—´ä¸åŒã€‚</li><li>å¯¹æ•°æ®åº“è¿›è¡Œè¿‡è½½ä¿æŠ¤æˆ–åº”ç”¨å±‚é™æµã€‚</li></ul><h3 id="72-ç¼“å­˜ç©¿é€"><a class="markdownIt-Anchor" href="#72-ç¼“å­˜ç©¿é€"></a> 7.2. ç¼“å­˜ç©¿é€</h3><blockquote><p><strong>ç¼“å­˜ç©¿é€æ˜¯æŒ‡ï¼šæŸ¥è¯¢çš„æ•°æ®åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆç¼“å­˜ä¸­è‡ªç„¶ä¹Ÿä¸å­˜åœ¨ã€‚æ‰€ä»¥ï¼Œåº”ç”¨åœ¨ç¼“å­˜ä¸­æŸ¥ä¸åˆ°ï¼Œåˆ™ä¼šå»æŸ¥è¯¢æ•°æ®åº“ã€‚å½“è¿™æ ·çš„è¯·æ±‚å¤šäº†åï¼Œæ•°æ®åº“çš„å‹åŠ›å°±ä¼šå¢å¤§ã€‚</strong></p></blockquote><p>è§£å†³ç¼“å­˜ç©¿é€ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li><strong>å¯¹äºè¿”å›ä¸º NULL çš„ä¾ç„¶ç¼“å­˜ï¼Œå¯¹äºæŠ›å‡ºå¼‚å¸¸çš„è¿”å›ä¸è¿›è¡Œç¼“å­˜</strong>ã€‚</li></ul><div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/technology/cache/ç¼“å­˜ç©¿é€1.png!zp" width="350px"/></div>é‡‡ç”¨è¿™ç§æ‰‹æ®µçš„ä¼šå¢åŠ æˆ‘ä»¬ç¼“å­˜çš„ç»´æŠ¤æˆæœ¬ï¼Œéœ€è¦åœ¨æ’å…¥ç¼“å­˜çš„æ—¶å€™åˆ é™¤è¿™ä¸ªç©ºç¼“å­˜ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®è¾ƒçŸ­çš„è¶…æ—¶æ—¶é—´æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<ul><li><strong>è¿‡æ»¤ä¸å¯èƒ½å­˜åœ¨çš„æ•°æ®</strong></li></ul><div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/technology/cache/ç¼“å­˜ç©¿é€2.png!zp" width="350px"/></div>**åˆ¶å®šä¸€äº›è§„åˆ™è¿‡æ»¤ä¸€äº›ä¸å¯èƒ½å­˜åœ¨çš„æ•°æ®**ã€‚å°æ•°æ®ç”¨ BitMapï¼Œå¤§æ•°æ®å¯ä»¥ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œæ¯”å¦‚ä½ çš„è®¢å• ID æ˜æ˜¾æ˜¯åœ¨ä¸€ä¸ªèŒƒå›´ 1-1000ï¼Œå¦‚æœä¸æ˜¯ 1-1000 ä¹‹å†…çš„æ•°æ®é‚£å…¶å®å¯ä»¥ç›´æ¥ç»™è¿‡æ»¤æ‰ã€‚<h3 id="73-ç¼“å­˜å‡»ç©¿"><a class="markdownIt-Anchor" href="#73-ç¼“å­˜å‡»ç©¿"></a> 7.3. ç¼“å­˜å‡»ç©¿</h3><p>å¯¹äºæŸäº› key è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œä½†æ˜¯å…¶æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œå¦‚æœæŸä¸ª key å¤±æ•ˆï¼Œå¯èƒ½å¤§é‡çš„è¯·æ±‚æ‰“è¿‡æ¥ï¼Œç¼“å­˜æœªå‘½ä¸­ï¼Œç„¶åå»æ•°æ®åº“è®¿é—®ï¼Œæ­¤æ—¶æ•°æ®åº“è®¿é—®é‡ä¼šæ€¥å‰§å¢åŠ ã€‚</p><p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–ä¸‹é¢çš„ä¸¤ä¸ªæ‰‹æ®µ:</p><ul><li><strong>åˆ†å¸ƒå¼é”</strong> - é”ä½çƒ­ç‚¹æ•°æ®çš„ keyï¼Œé¿å…å¤§é‡çº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ª keyã€‚</li><li><strong>å¼‚æ­¥åŠ è½½</strong> - å¯ä»¥å¯¹éƒ¨åˆ†æ•°æ®é‡‡å–åˆ°æœŸè‡ªåŠ¨åˆ·æ–°çš„ç­–ç•¥ï¼Œè€Œä¸æ˜¯åˆ°æœŸè‡ªåŠ¨æ·˜æ±°ã€‚æ·˜æ±°å…¶å®ä¹Ÿæ˜¯ä¸ºäº†æ•°æ®çš„æ—¶æ•ˆæ€§ï¼Œæ‰€ä»¥é‡‡ç”¨è‡ªåŠ¨åˆ·æ–°ä¹Ÿå¯ä»¥ã€‚</li></ul><h3 id="74-ç¼“å­˜æ›´æ–°"><a class="markdownIt-Anchor" href="#74-ç¼“å­˜æ›´æ–°"></a> 7.4. ç¼“å­˜æ›´æ–°</h3><p>ä¸€èˆ¬æ¥è¯´ç¼“å­˜çš„æ›´æ–°æœ‰ä¸¤ç§æƒ…å†µ:</p><ul><li>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€‚</li><li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€‚</li></ul><blockquote><p><strong>ä¸ºä»€ä¹ˆæ˜¯åˆ é™¤ç¼“å­˜ï¼Œè€Œä¸æ˜¯æ›´æ–°ç¼“å­˜å‘¢ï¼Ÿ</strong></p><p>ä½ å¯ä»¥æƒ³æƒ³å½“æœ‰å¤šä¸ªå¹¶å‘çš„è¯·æ±‚æ›´æ–°æ•°æ®ï¼Œä½ å¹¶ä¸èƒ½ä¿è¯æ›´æ–°æ•°æ®åº“çš„é¡ºåºå’Œæ›´æ–°ç¼“å­˜çš„é¡ºåºä¸€è‡´ï¼Œé‚£å°±ä¼šå‡ºç°æ•°æ®åº“ä¸­å’Œç¼“å­˜ä¸­æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´è€ƒè™‘åˆ é™¤ç¼“å­˜ã€‚</p></blockquote><ul><li><strong>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</strong></li></ul><p>å¯¹äºä¸€ä¸ªæ›´æ–°æ“ä½œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å…ˆå»å„çº§ç¼“å­˜è¿›è¡Œåˆ é™¤ï¼Œç„¶åæ›´æ–°æ•°æ®åº“ã€‚</p><p>è¿™ä¸ªæ“ä½œæœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜ï¼Œåœ¨å¯¹ç¼“å­˜åˆ é™¤å®Œä¹‹åï¼Œæœ‰ä¸€ä¸ªè¯»è¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™ç”±äºç¼“å­˜è¢«åˆ é™¤æ‰€ä»¥ç›´æ¥ä¼šè¯»åº“ï¼Œè¯»æ“ä½œçš„æ•°æ®æ˜¯è€çš„å¹¶ä¸”ä¼šè¢«åŠ è½½è¿›å…¥ç¼“å­˜å½“ä¸­ï¼Œåç»­è¯»è¯·æ±‚å…¨éƒ¨è®¿é—®çš„è€æ•°æ®ã€‚</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/technology/cache/ç¼“å­˜æ›´æ–°.png!zp" width="400px"/></div>å¯¹ç¼“å­˜çš„æ“ä½œä¸è®ºæˆåŠŸå¤±è´¥éƒ½ä¸èƒ½é˜»å¡æˆ‘ä»¬å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œé‚£ä¹ˆå¾ˆå¤šæ—¶å€™åˆ é™¤ç¼“å­˜å¯ä»¥ç”¨å¼‚æ­¥çš„æ“ä½œï¼Œä½†æ˜¯å…ˆåˆ é™¤ç¼“å­˜ä¸èƒ½å¾ˆå¥½çš„é€‚ç”¨äºè¿™ä¸ªåœºæ™¯ã€‚<p>å…ˆåˆ é™¤ç¼“å­˜ä¹Ÿæœ‰ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¦‚æœå¯¹æ•°æ®åº“æ“ä½œå¤±è´¥äº†ï¼Œé‚£ä¹ˆç”±äºå…ˆåˆ é™¤çš„ç¼“å­˜ï¼Œæœ€å¤šåªæ˜¯é€ æˆ Cache Missã€‚</p><ul><li><strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</strong></li></ul><blockquote><p>æ³¨ï¼šæ›´æ¨èä½¿ç”¨è¿™ç§ç­–ç•¥</p></blockquote><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜å°±èƒ½é¿å…ä¸Šé¢çš„é—®é¢˜ã€‚</p><p>ä½†æ˜¯åŒæ ·çš„å¼•å…¥äº†æ–°çš„é—®é¢˜ï¼šå‡è®¾æ‰§è¡Œæ›´æ–°æ“ä½œæ—¶ï¼Œåˆæ¥æ”¶åˆ°æŸ¥è¯¢è¯·æ±‚ï¼Œæ­¤æ—¶å°±ä¼šè¿”å›ç¼“å­˜ä¸­çš„è€æ•°æ®ã€‚æ›´éº»çƒ¦çš„æ˜¯ï¼Œå¦‚æœæ•°æ®åº“æ›´æ–°æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œåˆ™ç¼“å­˜ä¸­å¯èƒ½æ°¸è¿œæ˜¯è„æ•°æ®ã€‚</p><ul><li>åº”è¯¥é€‰æ‹©å“ªç§æ›´æ–°æµ‹å½•</li></ul><p>é€šè¿‡ä¸Šé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œä¸¤ç§æ›´æ–°ç­–ç•¥éƒ½å­˜åœ¨å¹¶å‘é—®é¢˜ã€‚</p><p>ä½†æ˜¯å»ºè®®é€‰æ‹©å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼Œå› ä¸ºå…¶å¹¶å‘é—®é¢˜å‡ºç°çš„æ¦‚ç‡å¯èƒ½éå¸¸ä½ï¼Œå› ä¸ºè¿™ä¸ªæ¡ä»¶éœ€è¦å‘ç”Ÿåœ¨è¯»ç¼“å­˜æ—¶ç¼“å­˜å¤±æ•ˆï¼Œè€Œä¸”å¹¶å‘ç€æœ‰ä¸€ä¸ªå†™æ“ä½œã€‚è€Œå®é™…ä¸Šæ•°æ®åº“çš„å†™æ“ä½œä¼šæ¯”è¯»æ“ä½œæ…¢å¾—å¤šï¼Œè€Œä¸”è¿˜è¦é”è¡¨ï¼Œè€Œè¯»æ“ä½œå¿…éœ€åœ¨å†™æ“ä½œå‰è¿›å…¥æ•°æ®åº“æ“ä½œï¼Œè€Œåˆè¦æ™šäºå†™æ“ä½œæ›´æ–°ç¼“å­˜ï¼Œæ‰€æœ‰çš„è¿™äº›æ¡ä»¶éƒ½å…·å¤‡çš„æ¦‚ç‡åŸºæœ¬å¹¶ä¸å¤§ã€‚</p><p>å¦‚æœéœ€è¦æ•°æ®åº“å’Œç¼“å­˜ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œåˆ™å¯ä»¥é€šè¿‡ 2PC æˆ– Paxos åè®®æ¥å®ç°ã€‚ä½†æ˜¯ 2PC å¤ªæ…¢ï¼Œè€Œ Paxos å¤ªå¤æ‚ï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯éå¸¸é‡è¦çš„æ•°æ®ï¼Œä¸å»ºè®®ä½¿ç”¨å¼ºä¸€è‡´æ€§æ–¹æ¡ˆã€‚</p><h3 id="75-ç¼“å­˜é¢„çƒ­"><a class="markdownIt-Anchor" href="#75-ç¼“å­˜é¢„çƒ­"></a> 7.5. ç¼“å­˜é¢„çƒ­</h3><p>ç¼“å­˜é¢„çƒ­æ˜¯æŒ‡ç³»ç»Ÿå¯åŠ¨åï¼Œå°†å¸¸ç”¨çš„æ•°æ®ç›´æ¥ç¼“å­˜ã€‚è¿™æ ·å°±å¯ä»¥é¿å…ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†æ›´æ–°ç¼“å­˜çš„é—®é¢˜ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ç›´æ¥å†™ä¸ªç¼“å­˜åˆ·æ–°é¡µé¢ï¼Œä¸Šçº¿æ—¶æ‰‹å·¥æ“ä½œä¸‹ã€‚</li><li>æ•°æ®é‡ä¸å¤§ï¼Œå¯ä»¥åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨è¿›è¡ŒåŠ è½½ã€‚</li><li>å®šæ—¶åˆ·æ–°ç¼“å­˜ã€‚</li></ul><h3 id="76-ç¼“å­˜é™çº§"><a class="markdownIt-Anchor" href="#76-ç¼“å­˜é™çº§"></a> 7.6. ç¼“å­˜é™çº§</h3><p>å½“è®¿é—®é‡å‰§å¢ã€æœåŠ¡å‡ºç°é—®é¢˜ï¼ˆå¦‚å“åº”æ—¶é—´æ…¢æˆ–ä¸å“åº”ï¼‰æˆ–éæ ¸å¿ƒæœåŠ¡å½±å“åˆ°æ ¸å¿ƒæµç¨‹çš„æ€§èƒ½æ—¶ï¼Œä»ç„¶éœ€è¦ä¿è¯æœåŠ¡è¿˜æ˜¯å¯ç”¨çš„ï¼Œå³ä½¿æ˜¯æœ‰æŸæœåŠ¡ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®ä¸€äº›å…³é”®æ•°æ®è¿›è¡Œè‡ªåŠ¨é™çº§ï¼Œä¹Ÿå¯ä»¥é…ç½®å¼€å…³å®ç°äººå·¥é™çº§ã€‚</p><p>é™çº§çš„æœ€ç»ˆç›®çš„æ˜¯ä¿è¯æ ¸å¿ƒæœåŠ¡å¯ç”¨ï¼Œå³ä½¿æ˜¯æœ‰æŸçš„ã€‚è€Œä¸”æœ‰äº›æœåŠ¡æ˜¯æ— æ³•é™çº§çš„ï¼ˆå¦‚åŠ å…¥è´­ç‰©è½¦ã€ç»“ç®—ï¼‰ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2><ul><li>ã€Šå¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ã€‹</li><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5b7593496fb9a009b62904fa">ä½ åº”è¯¥çŸ¥é“çš„ç¼“å­˜è¿›åŒ–å²</a></li><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5b849878e51d4538c77a974a">å¦‚ä½•ä¼˜é›…çš„è®¾è®¡å’Œä½¿ç”¨ç¼“å­˜ï¼Ÿ</a></li><li><a href="https://www.jianshu.com/p/73ce0ef820f9" target="_blank" rel="noopener">ç†è§£åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ç¼“å­˜æ¶æ„(ä¸Š)</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ç¼“å­˜åŸºæœ¬åŸç†&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#ç¼“å­˜åŸºæœ¬åŸç†&quot;&gt;&lt;/a&gt; ç¼“å­˜åŸºæœ¬åŸç†&lt;/h1&gt;
&lt;!-- TOC depthFrom:2 depthTo:3 --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-%E7%BC%
      
    
    </summary>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/tags/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/tags/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
      <category term="ç¼“å­˜" scheme="https://dunwu.github.io/blog/tags/%E7%BC%93%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼äº‹åŠ¡åŸºæœ¬åŸç†</title>
    <link href="https://dunwu.github.io/blog/design/theory/distributed-transaction-theory/"/>
    <id>https://dunwu.github.io/blog/design/theory/distributed-transaction-theory/</id>
    <published>2019-06-21T03:30:00.000Z</published>
    <updated>2020-01-25T15:30:02.724Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆ†å¸ƒå¼äº‹åŠ¡åŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#åˆ†å¸ƒå¼äº‹åŠ¡åŸºæœ¬åŸç†"></a> åˆ†å¸ƒå¼äº‹åŠ¡åŸºæœ¬åŸç†</h1><blockquote><p><strong>åˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„æ˜¯äº‹åŠ¡æ“ä½œè·¨è¶Šå¤šä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¦æ±‚æ»¡è¶³äº‹åŠ¡çš„ ACID ç‰¹æ€§ã€‚</strong></p></blockquote><p>åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°ä¸»è¦æœ‰ä»¥ä¸‹ 5 ç§æ–¹æ¡ˆï¼š</p><ul><li>XA æ–¹æ¡ˆ</li><li>TCC æ–¹æ¡ˆ</li><li>æœ¬åœ°æ¶ˆæ¯è¡¨</li><li>å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ</li><li>æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ</li></ul><h2 id="1-ä¸¤é˜¶æ®µæäº¤"><a class="markdownIt-Anchor" href="#1-ä¸¤é˜¶æ®µæäº¤"></a> 1. ä¸¤é˜¶æ®µæäº¤</h2><blockquote><p>ä¸¤é˜¶æ®µæäº¤ï¼ˆTwo-phase Commitï¼Œ2PCï¼‰é€šè¿‡å¼•å…¥åè°ƒè€…ï¼ˆCoordinatorï¼‰æ¥è°ƒåº¦å‚ä¸è€…çš„è¡Œä¸ºï¼Œå¹¶æœ€ç»ˆå†³å®šè¿™äº›å‚ä¸è€…æ˜¯å¦è¦çœŸæ­£æ‰§è¡Œäº‹åŠ¡ã€‚</p><p>å‚è€ƒå®ç°ï¼š<a href="https://github.com/changmingxie/tcc-transaction" target="_blank" rel="noopener">https://github.com/changmingxie/tcc-transaction</a></p></blockquote><h3 id="11-è¿è¡Œè¿‡ç¨‹"><a class="markdownIt-Anchor" href="#11-è¿è¡Œè¿‡ç¨‹"></a> 1.1. è¿è¡Œè¿‡ç¨‹</h3><h4 id="111-å‡†å¤‡é˜¶æ®µ"><a class="markdownIt-Anchor" href="#111-å‡†å¤‡é˜¶æ®µ"></a> 1.1.1. å‡†å¤‡é˜¶æ®µ</h4><p>åè°ƒè€…è¯¢é—®å‚ä¸è€…äº‹åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå‚ä¸è€…å‘å›äº‹åŠ¡æ‰§è¡Œç»“æœã€‚</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/architecture/åˆ†å¸ƒå¼äº‹åŠ¡ä¸¤é˜¶æ®µæäº¤-01.jpg!zp" /></div><h4 id="112-æäº¤é˜¶æ®µ"><a class="markdownIt-Anchor" href="#112-æäº¤é˜¶æ®µ"></a> 1.1.2. æäº¤é˜¶æ®µ</h4><p>å¦‚æœäº‹åŠ¡åœ¨æ¯ä¸ªå‚ä¸è€…ä¸Šéƒ½æ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡åè°ƒè€…å‘é€é€šçŸ¥è®©å‚ä¸è€…æäº¤äº‹åŠ¡ï¼›å¦åˆ™ï¼Œåè°ƒè€…å‘é€é€šçŸ¥è®©å‚ä¸è€…å›æ»šäº‹åŠ¡ã€‚</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/architecture/åˆ†å¸ƒå¼äº‹åŠ¡ä¸¤é˜¶æ®µæäº¤-02.jpg!zp" /></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å‡†å¤‡é˜¶æ®µï¼Œå‚ä¸è€…æ‰§è¡Œäº†äº‹åŠ¡ï¼Œä½†æ˜¯è¿˜æœªæäº¤ã€‚åªæœ‰åœ¨æäº¤é˜¶æ®µæ¥æ”¶åˆ°åè°ƒè€…å‘æ¥çš„é€šçŸ¥åï¼Œæ‰è¿›è¡Œæäº¤æˆ–è€…å›æ»šã€‚</p><h3 id="12-é—®é¢˜"><a class="markdownIt-Anchor" href="#12-é—®é¢˜"></a> 1.2. é—®é¢˜</h3><ul><li><strong>åŒæ­¥é˜»å¡</strong> - æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…åœ¨ç­‰å¾…å…¶å®ƒå‚ä¸è€…å“åº”çš„æ—¶å€™éƒ½å¤„äºåŒæ­¥é˜»å¡çŠ¶æ€ï¼Œæ— æ³•è¿›è¡Œå…¶å®ƒæ“ä½œã€‚</li><li><strong>å•ç‚¹é—®é¢˜</strong> - åè°ƒè€…åœ¨ 2PC ä¸­èµ·åˆ°éå¸¸å¤§çš„ä½œç”¨ï¼Œå‘ç”Ÿæ•…éšœå°†ä¼šé€ æˆå¾ˆå¤§å½±å“ï¼Œç‰¹åˆ«æ˜¯åœ¨é˜¶æ®µäºŒå‘ç”Ÿæ•…éšœï¼Œæ‰€æœ‰å‚ä¸è€…ä¼šä¸€ç›´ç­‰å¾…çŠ¶æ€ï¼Œæ— æ³•å®Œæˆå…¶å®ƒæ“ä½œã€‚</li><li><strong>æ•°æ®ä¸ä¸€è‡´</strong> - åœ¨é˜¶æ®µäºŒï¼Œå¦‚æœåè°ƒè€…åªå‘é€äº†éƒ¨åˆ† Commit æ¶ˆæ¯ï¼Œæ­¤æ—¶ç½‘ç»œå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆåªæœ‰éƒ¨åˆ†å‚ä¸è€…æ¥æ”¶åˆ° Commit æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰éƒ¨åˆ†å‚ä¸è€…æäº¤äº†äº‹åŠ¡ï¼Œä½¿å¾—ç³»ç»Ÿæ•°æ®ä¸ä¸€è‡´ã€‚</li><li><strong>å¤ªè¿‡ä¿å®ˆ</strong> - ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¤±è´¥å°±ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼Œæ²¡æœ‰å®Œå–„çš„å®¹é”™æœºåˆ¶ã€‚</li></ul><h3 id="13-ä¼˜ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#13-ä¼˜ç¼ºç‚¹"></a> 1.3. ä¼˜ç¼ºç‚¹</h3><ul><li>ä¼˜ç‚¹ï¼šå°½é‡ä¿è¯äº†æ•°æ®çš„å¼ºä¸€è‡´ï¼Œé€‚åˆå¯¹æ•°æ®å¼ºä¸€è‡´è¦æ±‚å¾ˆé«˜çš„å…³é”®é¢†åŸŸã€‚ï¼ˆå…¶å®ä¹Ÿä¸èƒ½ 100%ä¿è¯å¼ºä¸€è‡´</li><li>ç¼ºç‚¹ï¼šå®ç°å¤æ‚ï¼Œç‰ºç‰²äº†å¯ç”¨æ€§ï¼Œå¯¹æ€§èƒ½å½±å“è¾ƒå¤§ï¼Œä¸é€‚åˆé«˜å¹¶å‘é«˜æ€§èƒ½åœºæ™¯ã€‚</li></ul><h2 id="2-è¡¥å¿äº‹åŠ¡"><a class="markdownIt-Anchor" href="#2-è¡¥å¿äº‹åŠ¡"></a> 2. è¡¥å¿äº‹åŠ¡</h2><blockquote><p>è¡¥å¿äº‹åŠ¡ï¼ˆTCCï¼‰ï¼Œå…¨ç§°æ˜¯ï¼š<code>Try</code>ã€<code>Confirm</code>ã€<code>Cancel</code>ã€‚</p><p>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šé’ˆå¯¹æ¯ä¸ªæ“ä½œï¼Œéƒ½è¦æ³¨å†Œä¸€ä¸ªä¸å…¶å¯¹åº”çš„ç¡®è®¤å’Œè¡¥å¿ï¼ˆæ’¤é”€ï¼‰æ“ä½œã€‚å®ƒåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><p>TCC çš„ã€‚</p><ul><li>Try é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µè¯´çš„æ˜¯å¯¹å„ä¸ªæœåŠ¡çš„èµ„æºåšæ£€æµ‹ä»¥åŠå¯¹èµ„æºè¿›è¡Œ<strong>é”å®šæˆ–è€…é¢„ç•™</strong>ã€‚</li><li>Confirm é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µè¯´çš„æ˜¯åœ¨å„ä¸ªæœåŠ¡ä¸­<strong>æ‰§è¡Œå®é™…çš„æ“ä½œ</strong>ã€‚</li><li>Cancel é˜¶æ®µï¼šå¦‚æœä»»ä½•ä¸€ä¸ªæœåŠ¡çš„ä¸šåŠ¡æ–¹æ³•æ‰§è¡Œå‡ºé”™ï¼Œé‚£ä¹ˆè¿™é‡Œå°±éœ€è¦<strong>è¿›è¡Œè¡¥å¿</strong>ï¼Œå°±æ˜¯æ‰§è¡Œå·²ç»æ‰§è¡ŒæˆåŠŸçš„ä¸šåŠ¡é€»è¾‘çš„å›æ»šæ“ä½œã€‚ï¼ˆæŠŠé‚£äº›æ‰§è¡ŒæˆåŠŸçš„å›æ»šï¼‰</li></ul></blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ Bob è¦å‘ Smith è½¬è´¦ï¼Œæ€è·¯å¤§æ¦‚æ˜¯ï¼š</p><ol><li>é¦–å…ˆåœ¨ Try é˜¶æ®µï¼Œè¦å…ˆè°ƒç”¨è¿œç¨‹æ¥å£æŠŠ Smith å’Œ Bob çš„é’±ç»™å†»ç»“èµ·æ¥ã€‚</li><li>åœ¨ Confirm é˜¶æ®µï¼Œæ‰§è¡Œè¿œç¨‹è°ƒç”¨çš„è½¬è´¦çš„æ“ä½œï¼Œè½¬è´¦æˆåŠŸè¿›è¡Œè§£å†»ã€‚</li><li>å¦‚æœç¬¬ 2 æ­¥æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆè½¬è´¦æˆåŠŸï¼Œå¦‚æœç¬¬äºŒæ­¥æ‰§è¡Œå¤±è´¥ï¼Œåˆ™è°ƒç”¨è¿œç¨‹å†»ç»“æ¥å£å¯¹åº”çš„è§£å†»æ–¹æ³• (Cancel)ã€‚</li></ol><p>ä¼˜ç¼ºç‚¹ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šè·Ÿ 2PC æ¯”èµ·æ¥ï¼Œå®ç°ä»¥åŠæµç¨‹ç›¸å¯¹ç®€å•äº†ä¸€äº›ï¼Œä½†æ•°æ®çš„ä¸€è‡´æ€§æ¯” 2PC ä¹Ÿè¦å·®ä¸€äº›ã€‚</li><li>ç¼ºç‚¹ï¼šç¼ºç‚¹è¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„ï¼Œåœ¨ 2,3 æ­¥ä¸­éƒ½æœ‰å¯èƒ½å¤±è´¥ã€‚TCC å±äºåº”ç”¨å±‚çš„ä¸€ç§è¡¥å¿æ–¹å¼ï¼Œæ‰€ä»¥éœ€è¦ç¨‹åºå‘˜åœ¨å®ç°çš„æ—¶å€™å¤šå†™å¾ˆå¤šè¡¥å¿çš„ä»£ç ï¼Œåœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œä¸€äº›ä¸šåŠ¡æµç¨‹å¯èƒ½ç”¨ TCC ä¸å¤ªå¥½å®šä¹‰åŠå¤„ç†ã€‚</li></ul><p>è¿™ç§æ–¹æ¡ˆå‡ ä¹å¾ˆå°‘äººä½¿ç”¨ï¼Œå› ä¸º<strong>äº‹åŠ¡å›æ»š</strong>å®é™…ä¸Šæ˜¯<strong>ä¸¥é‡ä¾èµ–äºè‡ªå·±å†™ä»£ç æ¥å›æ»šå’Œè¡¥å¿</strong>äº†ï¼Œä¼šé€ æˆè¡¥å¿ä»£ç å·¨å¤§ã€‚</p><p>ä½†æ˜¯ï¼Œä¹Ÿæœ‰ç‰¹æ®Šçš„ä½¿ç”¨åœºæ™¯ï¼šä¸€èˆ¬æ¥è¯´è·Ÿ<strong>é’±</strong>ç›¸å…³çš„ï¼Œè·Ÿé’±æ‰“äº¤é“çš„ï¼Œ<strong>æ”¯ä»˜</strong>ã€<strong>äº¤æ˜“</strong>ç›¸å…³çš„åœºæ™¯ï¼Œä¼šç”¨ TCCï¼Œä¸¥æ ¼ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨è‡ªåŠ¨å›æ»šï¼Œä¸¥æ ¼ä¿è¯èµ„é‡‘çš„æ­£ç¡®æ€§ï¼Œä¿è¯åœ¨èµ„é‡‘ä¸Šä¸ä¼šå‡ºç°é—®é¢˜ã€‚</p><p>è€Œä¸”æœ€å¥½æ˜¯ä½ çš„å„ä¸ªä¸šåŠ¡æ‰§è¡Œçš„æ—¶é—´éƒ½æ¯”è¾ƒçŸ­ã€‚</p><p>ä½†æ˜¯è¯´å®è¯ï¼Œä¸€èˆ¬å°½é‡åˆ«è¿™ä¹ˆæï¼Œè‡ªå·±æ‰‹å†™å›æ»šé€»è¾‘ï¼Œæˆ–è€…æ˜¯è¡¥å¿é€»è¾‘ï¼Œå®åœ¨å¤ªæ¶å¿ƒäº†ï¼Œé‚£ä¸ªä¸šåŠ¡ä»£ç æ˜¯å¾ˆéš¾ç»´æŠ¤çš„ã€‚</p><h2 id="3-æœ¬åœ°æ¶ˆæ¯è¡¨å¼‚æ­¥ç¡®ä¿"><a class="markdownIt-Anchor" href="#3-æœ¬åœ°æ¶ˆæ¯è¡¨å¼‚æ­¥ç¡®ä¿"></a> 3. æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆå¼‚æ­¥ç¡®ä¿ï¼‰</h2><blockquote><p>æœ¬åœ°æ¶ˆæ¯è¡¨ä¸ä¸šåŠ¡æ•°æ®è¡¨å¤„äºåŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œè¿™æ ·å°±èƒ½åˆ©ç”¨æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯åœ¨å¯¹è¿™ä¸¤ä¸ªè¡¨çš„æ“ä½œæ»¡è¶³äº‹åŠ¡ç‰¹æ€§ã€‚</p><ol><li>åœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ“ä½œçš„ä¸€æ–¹å®Œæˆå†™ä¸šåŠ¡æ•°æ®çš„æ“ä½œä¹‹åå‘æœ¬åœ°æ¶ˆæ¯è¡¨å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œæœ¬åœ°äº‹åŠ¡èƒ½ä¿è¯è¿™ä¸ªæ¶ˆæ¯ä¸€å®šä¼šè¢«å†™å…¥æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­ã€‚</li><li>ä¹‹åå°†æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­çš„æ¶ˆæ¯è½¬å‘åˆ° Kafka ç­‰æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰ä¸­ï¼Œå¦‚æœè½¬å‘æˆåŠŸåˆ™å°†æ¶ˆæ¯ä»æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­åˆ é™¤ï¼Œå¦åˆ™ç»§ç»­é‡æ–°è½¬å‘ã€‚</li><li>åœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ“ä½œçš„å¦ä¸€æ–¹ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¹¶æ‰§è¡Œæ¶ˆæ¯ä¸­çš„æ“ä½œã€‚</li></ol></blockquote><div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/architecture/åˆ†å¸ƒå¼äº‹åŠ¡æœ¬åœ°æ¶ˆæ¯.jpg!zp" /></div><p>è¿™ç§æ–¹æ¡ˆéµå¾ª BASE ç†è®ºï¼Œé‡‡ç”¨çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><p>æœ¬åœ°æ¶ˆæ¯è¡¨åˆ©ç”¨äº†æœ¬åœ°äº‹åŠ¡æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—æ¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><h3 id="31-ä¼˜ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#31-ä¼˜ç¼ºç‚¹"></a> 3.1. ä¼˜ç¼ºç‚¹</h3><ul><li>ä¼˜ç‚¹ï¼šä¸€ç§éå¸¸ç»å…¸çš„å®ç°ï¼Œé¿å…äº†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå®ç°äº†æœ€ç»ˆä¸€è‡´æ€§ã€‚</li><li>ç¼ºç‚¹ï¼šæ¶ˆæ¯è¡¨ä¼šè€¦åˆåˆ°ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œå¦‚æœæ²¡æœ‰å°è£…å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œä¼šæœ‰å¾ˆå¤šæ‚æ´»éœ€è¦å¤„ç†ã€‚</li></ul><h2 id="4-mq-äº‹åŠ¡æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#4-mq-äº‹åŠ¡æ¶ˆæ¯"></a> 4. MQ äº‹åŠ¡æ¶ˆæ¯</h2><p>æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹çš„ MQ æ˜¯æ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„ï¼Œæ¯”å¦‚ RocketMQï¼Œä»–ä»¬æ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„æ–¹å¼ä¹Ÿæ˜¯ç±»ä¼¼äºé‡‡ç”¨çš„äºŒé˜¶æ®µæäº¤ã€‚ä½†æ˜¯å¸‚é¢ä¸Šä¸€äº›ä¸»æµçš„ MQ éƒ½æ˜¯ä¸æ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„ï¼Œæ¯”å¦‚ RabbitMQ å’Œ Kafka éƒ½ä¸æ”¯æŒã€‚</p><p>ä»¥é˜¿é‡Œçš„ RocketMQ ä¸­é—´ä»¶ä¸ºä¾‹ï¼Œå…¶æ€è·¯å¤§è‡´ä¸ºï¼š</p><ol><li>Prepared æ¶ˆæ¯ï¼Œä¼šæ‹¿åˆ°æ¶ˆæ¯çš„åœ°å€ã€‚</li><li>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ã€‚</li><li>é€šè¿‡ç¬¬ä¸€é˜¶æ®µæ‹¿åˆ°çš„åœ°å€å»è®¿é—®æ¶ˆæ¯ï¼Œå¹¶ä¿®æ”¹çŠ¶æ€ã€‚</li></ol><p>ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸šåŠ¡æ–¹æ³•å†…è¦æƒ³æ¶ˆæ¯é˜Ÿåˆ—æäº¤ä¸¤æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡å‘é€æ¶ˆæ¯å’Œä¸€æ¬¡ç¡®è®¤æ¶ˆæ¯ã€‚å¦‚æœç¡®è®¤æ¶ˆæ¯å‘é€å¤±è´¥äº† RocketMQ ä¼šå®šæœŸæ‰«ææ¶ˆæ¯é›†ç¾¤ä¸­çš„äº‹åŠ¡æ¶ˆæ¯ï¼Œè¿™æ—¶å€™å‘ç°äº† Prepared æ¶ˆæ¯ï¼Œå®ƒä¼šå‘æ¶ˆæ¯å‘é€è€…ç¡®è®¤ï¼Œæ‰€ä»¥ç”Ÿäº§æ–¹éœ€è¦å®ç°ä¸€ä¸ª check æ¥å£ï¼ŒRocketMQ ä¼šæ ¹æ®å‘é€ç«¯è®¾ç½®çš„ç­–ç•¥æ¥å†³å®šæ˜¯å›æ»šè¿˜æ˜¯ç»§ç»­å‘é€ç¡®è®¤æ¶ˆæ¯ã€‚è¿™æ ·å°±ä¿è¯äº†æ¶ˆæ¯å‘é€ä¸æœ¬åœ°äº‹åŠ¡åŒæ—¶æˆåŠŸæˆ–åŒæ—¶å¤±è´¥ã€‚</p><h3 id="41-ä¼˜ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#41-ä¼˜ç¼ºç‚¹"></a> 4.1. ä¼˜ç¼ºç‚¹</h3><ul><li>ä¼˜ç‚¹ï¼šå®ç°äº†æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸éœ€è¦ä¾èµ–æœ¬åœ°æ•°æ®åº“äº‹åŠ¡ã€‚</li><li>ç¼ºç‚¹ï¼šå®ç°éš¾åº¦å¤§ï¼Œä¸»æµ MQ ä¸æ”¯æŒã€‚</li></ul><h3 id="42-ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆxa-æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#42-ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆxa-æ–¹æ¡ˆ"></a> 4.2. ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆ/XA æ–¹æ¡ˆ</h3><p>æ‰€è°“çš„ XA æ–¹æ¡ˆï¼Œå³ï¼šä¸¤é˜¶æ®µæäº¤ï¼Œæœ‰ä¸€ä¸ª<strong>äº‹åŠ¡ç®¡ç†å™¨</strong>çš„æ¦‚å¿µï¼Œè´Ÿè´£åè°ƒå¤šä¸ªæ•°æ®åº“ï¼ˆèµ„æºç®¡ç†å™¨ï¼‰çš„äº‹åŠ¡ï¼Œäº‹åŠ¡ç®¡ç†å™¨å…ˆé—®é—®å„ä¸ªæ•°æ®åº“ä½ å‡†å¤‡å¥½äº†å—ï¼Ÿå¦‚æœæ¯ä¸ªæ•°æ®åº“éƒ½å›å¤ okï¼Œé‚£ä¹ˆå°±æ­£å¼æäº¤äº‹åŠ¡ï¼Œåœ¨å„ä¸ªæ•°æ®åº“ä¸Šæ‰§è¡Œæ“ä½œï¼›å¦‚æœä»»ä½•å…¶ä¸­ä¸€ä¸ªæ•°æ®åº“å›ç­”ä¸ okï¼Œé‚£ä¹ˆå°±å›æ»šäº‹åŠ¡ã€‚</p><p>è¿™ç§åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆï¼Œæ¯”è¾ƒé€‚åˆå•å—åº”ç”¨é‡Œï¼Œè·¨å¤šä¸ªåº“çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè€Œä¸”å› ä¸ºä¸¥é‡ä¾èµ–äºæ•°æ®åº“å±‚é¢æ¥æå®šå¤æ‚çš„äº‹åŠ¡ï¼Œæ•ˆç‡å¾ˆä½ï¼Œç»å¯¹ä¸é€‚åˆé«˜å¹¶å‘çš„åœºæ™¯ã€‚å¦‚æœè¦ç©å„¿ï¼Œé‚£ä¹ˆåŸºäº <code>Spring + JTA</code> å°±å¯ä»¥æå®šï¼Œè‡ªå·±éšä¾¿æœä¸ª demo çœ‹çœ‹å°±çŸ¥é“äº†ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆï¼Œæˆ‘ä»¬å¾ˆå°‘ç”¨ï¼Œä¸€èˆ¬æ¥è¯´<strong>æŸä¸ªç³»ç»Ÿå†…éƒ¨å¦‚æœå‡ºç°è·¨å¤šä¸ªåº“</strong>çš„è¿™ä¹ˆä¸€ä¸ªæ“ä½œï¼Œæ˜¯<strong>ä¸åˆè§„</strong>çš„ã€‚æˆ‘å¯ä»¥ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹ï¼Œ ç°åœ¨å¾®æœåŠ¡ï¼Œä¸€ä¸ªå¤§çš„ç³»ç»Ÿåˆ†æˆå‡ åä¸ªç”šè‡³å‡ ç™¾ä¸ªæœåŠ¡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬çš„è§„å®šå’Œè§„èŒƒï¼Œæ˜¯è¦æ±‚<strong>æ¯ä¸ªæœåŠ¡åªèƒ½æ“ä½œè‡ªå·±å¯¹åº”çš„ä¸€ä¸ªæ•°æ®åº“</strong>ã€‚</p><p>å¦‚æœä½ è¦æ“ä½œåˆ«çš„æœåŠ¡å¯¹åº”çš„åº“ï¼Œä¸å…è®¸ç›´è¿åˆ«çš„æœåŠ¡çš„åº“ï¼Œè¿åå¾®æœåŠ¡æ¶æ„çš„è§„èŒƒï¼Œä½ éšä¾¿äº¤å‰èƒ¡ä¹±è®¿é—®ï¼Œå‡ ç™¾ä¸ªæœåŠ¡çš„è¯ï¼Œå…¨ä½“ä¹±å¥—ï¼Œè¿™æ ·çš„ä¸€å¥—æœåŠ¡æ˜¯æ²¡æ³•ç®¡ç†çš„ï¼Œæ²¡æ³•æ²»ç†çš„ï¼Œå¯èƒ½ä¼šå‡ºç°æ•°æ®è¢«åˆ«äººæ”¹é”™ï¼Œè‡ªå·±çš„åº“è¢«åˆ«äººå†™æŒ‚ç­‰æƒ…å†µã€‚</p><p>å¦‚æœä½ è¦æ“ä½œåˆ«äººçš„æœåŠ¡çš„åº“ï¼Œä½ å¿…é¡»æ˜¯é€šè¿‡<strong>è°ƒç”¨åˆ«çš„æœåŠ¡çš„æ¥å£</strong>æ¥å®ç°ï¼Œç»å¯¹ä¸å…è®¸äº¤å‰è®¿é—®åˆ«äººçš„æ•°æ®åº“ã€‚</p><div align="center"><img src="https://github.com/doocs/advanced-java/blob/master/images/distributed-transaction-XA.png"/></div>### 4.3. æœ¬åœ°æ¶ˆæ¯è¡¨<p>æœ¬åœ°æ¶ˆæ¯è¡¨å…¶å®æ˜¯å›½å¤–çš„ ebay æå‡ºæ¥çš„è¿™ä¹ˆä¸€å¥—æ€æƒ³ã€‚</p><p>è¿™ä¸ªå¤§æ¦‚æ„æ€æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>A ç³»ç»Ÿåœ¨è‡ªå·±æœ¬åœ°ä¸€ä¸ªäº‹åŠ¡é‡Œæ“ä½œåŒæ—¶ï¼Œæ’å…¥ä¸€æ¡æ•°æ®åˆ°æ¶ˆæ¯è¡¨ï¼›</li><li>æ¥ç€ A ç³»ç»Ÿå°†è¿™ä¸ªæ¶ˆæ¯å‘é€åˆ° MQ ä¸­å»ï¼›</li><li>B ç³»ç»Ÿæ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œï¼Œå¾€è‡ªå·±æœ¬åœ°æ¶ˆæ¯è¡¨é‡Œæ’å…¥ä¸€æ¡æ•°æ®ï¼ŒåŒæ—¶æ‰§è¡Œå…¶ä»–çš„ä¸šåŠ¡æ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ¶ˆæ¯å·²ç»è¢«å¤„ç†è¿‡äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™ä¸ªäº‹åŠ¡ä¼šå›æ»šï¼Œè¿™æ ·<strong>ä¿è¯ä¸ä¼šé‡å¤å¤„ç†æ¶ˆæ¯</strong>ï¼›</li><li>B ç³»ç»Ÿæ‰§è¡ŒæˆåŠŸä¹‹åï¼Œå°±ä¼šæ›´æ–°è‡ªå·±æœ¬åœ°æ¶ˆæ¯è¡¨çš„çŠ¶æ€ä»¥åŠ A ç³»ç»Ÿæ¶ˆæ¯è¡¨çš„çŠ¶æ€ï¼›</li><li>å¦‚æœ B ç³»ç»Ÿå¤„ç†å¤±è´¥äº†ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ›´æ–°æ¶ˆæ¯è¡¨çŠ¶æ€ï¼Œé‚£ä¹ˆæ­¤æ—¶ A ç³»ç»Ÿä¼šå®šæ—¶æ‰«æè‡ªå·±çš„æ¶ˆæ¯è¡¨ï¼Œå¦‚æœæœ‰æœªå¤„ç†çš„æ¶ˆæ¯ï¼Œä¼šå†æ¬¡å‘é€åˆ° MQ ä¸­å»ï¼Œè®© B å†æ¬¡å¤„ç†ï¼›</li><li>è¿™ä¸ªæ–¹æ¡ˆä¿è¯äº†æœ€ç»ˆä¸€è‡´æ€§ï¼Œå“ªæ€• B äº‹åŠ¡å¤±è´¥äº†ï¼Œä½†æ˜¯ A ä¼šä¸æ–­é‡å‘æ¶ˆæ¯ï¼Œç›´åˆ° B é‚£è¾¹æˆåŠŸä¸ºæ­¢ã€‚</li></ol><p>è¿™ä¸ªæ–¹æ¡ˆè¯´å®è¯æœ€å¤§çš„é—®é¢˜å°±åœ¨äº<strong>ä¸¥é‡ä¾èµ–äºæ•°æ®åº“çš„æ¶ˆæ¯è¡¨æ¥ç®¡ç†äº‹åŠ¡</strong>å•¥çš„ï¼Œå¦‚æœæ˜¯é«˜å¹¶å‘åœºæ™¯å’‹åŠå‘¢ï¼Ÿå’‹æ‰©å±•å‘¢ï¼Ÿæ‰€ä»¥ä¸€èˆ¬ç¡®å®å¾ˆå°‘ç”¨ã€‚</p><div align="center"><img src="https://github.com/doocs/advanced-java/blob/master/images/distributed-transaction-local-message-table.png"/></div>### 4.4. å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ<p>è¿™ä¸ªçš„æ„æ€ï¼Œå°±æ˜¯å¹²è„†ä¸è¦ç”¨æœ¬åœ°çš„æ¶ˆæ¯è¡¨äº†ï¼Œç›´æ¥åŸºäº MQ æ¥å®ç°äº‹åŠ¡ã€‚æ¯”å¦‚é˜¿é‡Œçš„ RocketMQ å°±æ”¯æŒæ¶ˆæ¯äº‹åŠ¡ã€‚</p><p>å¤§æ¦‚çš„æ„æ€å°±æ˜¯ï¼š</p><ol><li>A ç³»ç»Ÿå…ˆå‘é€ä¸€ä¸ª prepared æ¶ˆæ¯åˆ° mqï¼Œå¦‚æœè¿™ä¸ª prepared æ¶ˆæ¯å‘é€å¤±è´¥é‚£ä¹ˆå°±ç›´æ¥å–æ¶ˆæ“ä½œåˆ«æ‰§è¡Œäº†ï¼›</li><li>å¦‚æœè¿™ä¸ªæ¶ˆæ¯å‘é€æˆåŠŸè¿‡äº†ï¼Œé‚£ä¹ˆæ¥ç€æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå¦‚æœæˆåŠŸå°±å‘Šè¯‰ mq å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœå¤±è´¥å°±å‘Šè¯‰ mq å›æ»šæ¶ˆæ¯ï¼›</li><li>å¦‚æœå‘é€äº†ç¡®è®¤æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ­¤æ—¶ B ç³»ç»Ÿä¼šæ¥æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯ï¼Œç„¶åæ‰§è¡Œæœ¬åœ°çš„äº‹åŠ¡ï¼›</li><li>mq ä¼šè‡ªåŠ¨<strong>å®šæ—¶è½®è¯¢</strong>æ‰€æœ‰ prepared æ¶ˆæ¯å›è°ƒä½ çš„æ¥å£ï¼Œé—®ä½ ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯ä¸æ˜¯æœ¬åœ°äº‹åŠ¡å¤„ç†å¤±è´¥äº†ï¼Œæ‰€æœ‰æ²¡å‘é€ç¡®è®¤çš„æ¶ˆæ¯ï¼Œæ˜¯ç»§ç»­é‡è¯•è¿˜æ˜¯å›æ»šï¼Ÿä¸€èˆ¬æ¥è¯´è¿™é‡Œä½ å°±å¯ä»¥æŸ¥ä¸‹æ•°æ®åº“çœ‹ä¹‹å‰æœ¬åœ°äº‹åŠ¡æ˜¯å¦æ‰§è¡Œï¼Œå¦‚æœå›æ»šäº†ï¼Œé‚£ä¹ˆè¿™é‡Œä¹Ÿå›æ»šå§ã€‚è¿™ä¸ªå°±æ˜¯é¿å…å¯èƒ½æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸäº†ï¼Œè€Œç¡®è®¤æ¶ˆæ¯å´å‘é€å¤±è´¥äº†ã€‚</li><li>è¿™ä¸ªæ–¹æ¡ˆé‡Œï¼Œè¦æ˜¯ç³»ç»Ÿ B çš„äº‹åŠ¡å¤±è´¥äº†å’‹åŠï¼Ÿé‡è¯•å’¯ï¼Œè‡ªåŠ¨ä¸æ–­é‡è¯•ç›´åˆ°æˆåŠŸï¼Œå¦‚æœå®åœ¨æ˜¯ä¸è¡Œï¼Œè¦ä¹ˆå°±æ˜¯é’ˆå¯¹é‡è¦çš„èµ„é‡‘ç±»ä¸šåŠ¡è¿›è¡Œå›æ»šï¼Œæ¯”å¦‚ B ç³»ç»Ÿæœ¬åœ°å›æ»šåï¼Œæƒ³åŠæ³•é€šçŸ¥ç³»ç»Ÿ A ä¹Ÿå›æ»šï¼›æˆ–è€…æ˜¯å‘é€æŠ¥è­¦ç”±äººå·¥æ¥æ‰‹å·¥å›æ»šå’Œè¡¥å¿ã€‚</li><li>è¿™ä¸ªè¿˜æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œç›®å‰å›½å†…äº’è”ç½‘å…¬å¸å¤§éƒ½æ˜¯è¿™ä¹ˆç©å„¿çš„ï¼Œè¦ä¸ä½ ä¸¾ç”¨ RocketMQ æ”¯æŒçš„ï¼Œè¦ä¸ä½ å°±è‡ªå·±åŸºäºç±»ä¼¼ ActiveMQï¼ŸRabbitMQï¼Ÿè‡ªå·±å°è£…ä¸€å¥—ç±»ä¼¼çš„é€»è¾‘å‡ºæ¥ï¼Œæ€»ä¹‹æ€è·¯å°±æ˜¯è¿™æ ·å­çš„ã€‚</li></ol><div align="center"><img src="https://github.com/doocs/advanced-java/blob/master/images/distributed-transaction-reliable-message.png"/></div>### 4.5. æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ<p>è¿™ä¸ªæ–¹æ¡ˆçš„å¤§è‡´æ„æ€å°±æ˜¯ï¼š</p><ol><li>ç³»ç»Ÿ A æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œå‘é€ä¸ªæ¶ˆæ¯åˆ° MQï¼›</li><li>è¿™é‡Œä¼šæœ‰ä¸ªä¸“é—¨æ¶ˆè´¹ MQ çš„<strong>æœ€å¤§åŠªåŠ›é€šçŸ¥æœåŠ¡</strong>ï¼Œè¿™ä¸ªæœåŠ¡ä¼šæ¶ˆè´¹ MQ ç„¶åå†™å…¥æ•°æ®åº“ä¸­è®°å½•ä¸‹æ¥ï¼Œæˆ–è€…æ˜¯æ”¾å…¥ä¸ªå†…å­˜é˜Ÿåˆ—ä¹Ÿå¯ä»¥ï¼Œæ¥ç€è°ƒç”¨ç³»ç»Ÿ B çš„æ¥å£ï¼›</li><li>è¦æ˜¯ç³»ç»Ÿ B æ‰§è¡ŒæˆåŠŸå°± ok äº†ï¼›è¦æ˜¯ç³»ç»Ÿ B æ‰§è¡Œå¤±è´¥äº†ï¼Œé‚£ä¹ˆæœ€å¤§åŠªåŠ›é€šçŸ¥æœåŠ¡å°±å®šæ—¶å°è¯•é‡æ–°è°ƒç”¨ç³»ç»Ÿ Bï¼Œåå¤ N æ¬¡ï¼Œæœ€åè¿˜æ˜¯ä¸è¡Œå°±æ”¾å¼ƒã€‚</li></ol><h3 id="46-ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„"><a class="markdownIt-Anchor" href="#46-ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„"></a> 4.6. ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Ÿ</h3><p>å¦‚æœä½ çœŸçš„è¢«é—®åˆ°ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ï¼Œæˆ‘ä»¬æŸæŸç‰¹åˆ«ä¸¥æ ¼çš„åœºæ™¯ï¼Œç”¨çš„æ˜¯ TCC æ¥ä¿è¯å¼ºä¸€è‡´æ€§ï¼›ç„¶åå…¶ä»–çš„ä¸€äº›åœºæ™¯åŸºäºé˜¿é‡Œçš„ RocketMQ æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p>ä½ æ‰¾ä¸€ä¸ªä¸¥æ ¼èµ„é‡‘è¦æ±‚ç»å¯¹ä¸èƒ½é”™çš„åœºæ™¯ï¼Œä½ å¯ä»¥è¯´ä½ æ˜¯ç”¨çš„ TCC æ–¹æ¡ˆï¼›å¦‚æœæ˜¯ä¸€èˆ¬çš„åˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯ï¼Œè®¢å•æ’å…¥ä¹‹åè¦è°ƒç”¨åº“å­˜æœåŠ¡æ›´æ–°åº“å­˜ï¼Œåº“å­˜æ•°æ®æ²¡æœ‰èµ„é‡‘é‚£ä¹ˆçš„æ•æ„Ÿï¼Œå¯ä»¥ç”¨å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆã€‚</p><p>å‹æƒ…æç¤ºä¸€ä¸‹ï¼ŒRocketMQ 3.2.6 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæ˜¯å¯ä»¥æŒ‰ç…§ä¸Šé¢çš„æ€è·¯æ¥çš„ï¼Œä½†æ˜¯ä¹‹åæ¥å£åšäº†ä¸€äº›æ”¹å˜ï¼Œæˆ‘è¿™é‡Œä¸å†èµ˜è¿°äº†ã€‚</p><p>å½“ç„¶å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥å‚è€ƒå¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆæ¥è‡ªå·±å®ç°ä¸€å¥—åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæ¯”å¦‚åŸºäº RocketMQ æ¥ç©å„¿ã€‚</p><h2 id="5-å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#5-å‚è€ƒèµ„æ–™"></a> 5. å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://www.cnblogs.com/savorboard/p/distributed-system-transaction-consistency.html" target="_blank" rel="noopener">èŠèŠåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå†è¯´è¯´è§£å†³æ–¹æ¡ˆ</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;åˆ†å¸ƒå¼äº‹åŠ¡åŸºæœ¬åŸç†&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#åˆ†å¸ƒå¼äº‹åŠ¡åŸºæœ¬åŸç†&quot;&gt;&lt;/a&gt; åˆ†å¸ƒå¼äº‹åŠ¡åŸºæœ¬åŸç†&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;åˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„æ˜¯äº‹åŠ¡æ“ä½œè·¨è¶Šå¤šä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¦æ±‚æ»¡è¶³äº‹åŠ¡çš„ A
      
    
    </summary>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/tags/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/tags/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
      <category term="äº‹åŠ¡" scheme="https://dunwu.github.io/blog/tags/%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼ä¼šè¯åŸºæœ¬åŸç†</title>
    <link href="https://dunwu.github.io/blog/design/theory/distributed-session-theory/"/>
    <id>https://dunwu.github.io/blog/design/theory/distributed-session-theory/</id>
    <published>2019-06-04T15:42:00.000Z</published>
    <updated>2020-01-19T11:43:25.924Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆ†å¸ƒå¼ä¼šè¯åŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#åˆ†å¸ƒå¼ä¼šè¯åŸºæœ¬åŸç†"></a> åˆ†å¸ƒå¼ä¼šè¯åŸºæœ¬åŸç†</h1><blockquote><p>ç”±äº Http æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®ï¼ŒæœåŠ¡å™¨å•å•ä»ç½‘ç»œè¿æ¥ä¸Šæ— ä»çŸ¥é“å®¢æˆ·èº«ä»½ã€‚</p><p>ä¼šè¯è·Ÿè¸ªæ˜¯ Web ç¨‹åºä¸­å¸¸ç”¨çš„æŠ€æœ¯ï¼Œç”¨æ¥è·Ÿè¸ªç”¨æˆ·çš„æ•´ä¸ªä¼šè¯ã€‚å¸¸ç”¨ä¼šè¯è·Ÿè¸ªæŠ€æœ¯æ˜¯ Cookie ä¸ Sessionã€‚</p></blockquote><h2 id="1-ç®€ä»‹"><a class="markdownIt-Anchor" href="#1-ç®€ä»‹"></a> 1. ç®€ä»‹</h2><h3 id="11-ä»€ä¹ˆæ˜¯-cookie"><a class="markdownIt-Anchor" href="#11-ä»€ä¹ˆæ˜¯-cookie"></a> 1.1. ä»€ä¹ˆæ˜¯ Cookie</h3><p>Cookie å®é™…ä¸Šæ˜¯å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸Šçš„æ–‡æœ¬ä¿¡æ¯ï¼Œå¹¶ä¿ç•™äº†å„ç§è·Ÿè¸ªçš„ä¿¡æ¯ã€‚</p><p>Cookie å·¥ä½œæ­¥éª¤ï¼š</p><ol><li>å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦è®°å½•è¯¥ç”¨æˆ·çš„çŠ¶æ€ï¼Œå°±æ˜¯ç”¨ response å‘å®¢æˆ·ç«¯æµè§ˆå™¨é¢å‘ä¸€ä¸ª Cookieã€‚</li><li>å®¢æˆ·ç«¯æµè§ˆå™¨ä¼šæŠŠ Cookie ä¿å­˜ä¸‹æ¥ã€‚</li><li>å½“æµè§ˆå™¨å†è¯·æ±‚è¯¥ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨æŠŠè¯¥è¯·æ±‚çš„ç½‘å€è¿åŒ Cookie ä¸€åŒæäº¤ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ£€æŸ¥è¯¥ Cookieï¼Œä»¥æ­¤æ¥è¾¨è®¤ç”¨æˆ·çŠ¶æ€ã€‚</li></ol><p>Cookie ä¸»è¦ç”¨äºä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p><ul><li>ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ã€æ¸¸æˆåˆ†æ•°æˆ–å…¶å®ƒéœ€è¦è®°å½•çš„ä¿¡æ¯ï¼‰</li><li>ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¦‚ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®ã€ä¸»é¢˜ç­‰ï¼‰</li><li>æµè§ˆå™¨è¡Œä¸ºè·Ÿè¸ªï¼ˆå¦‚è·Ÿè¸ªåˆ†æç”¨æˆ·è¡Œä¸ºç­‰ï¼‰</li></ul><p><strong><em>æ³¨ï¼šCookie åŠŸèƒ½éœ€è¦æµè§ˆå™¨çš„æ”¯æŒï¼Œå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ Cookie æˆ–è€… Cookie ç¦ç”¨äº†ï¼ŒCookie åŠŸèƒ½å°±ä¼šå¤±æ•ˆã€‚</em></strong></p><h3 id="12-ä»€ä¹ˆæ˜¯-session"><a class="markdownIt-Anchor" href="#12-ä»€ä¹ˆæ˜¯-session"></a> 1.2. ä»€ä¹ˆæ˜¯ Session</h3><p>Session ä»£è¡¨ç€æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸€æ¬¡ä¼šè¯çš„è¿‡ç¨‹ã€‚Session å¯¹è±¡å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„ Web é¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå­˜å‚¨åœ¨ Session å¯¹è±¡ä¸­çš„å˜é‡å°†ä¸ä¼šä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªç”¨æˆ·ä¼šè¯ä¸­ä¸€ç›´å­˜åœ¨ä¸‹å»ã€‚å½“å®¢æˆ·ç«¯å…³é—­ä¼šè¯ï¼Œæˆ–è€… Session è¶…æ—¶å¤±æ•ˆæ—¶ä¼šè¯ç»“æŸã€‚</p><h3 id="13-cookie-å’Œ-session-çš„åŒºåˆ«"><a class="markdownIt-Anchor" href="#13-cookie-å’Œ-session-çš„åŒºåˆ«"></a> 1.3. Cookie å’Œ Session çš„åŒºåˆ«</h3><ul><li><strong>ä½œç”¨èŒƒå›´ä¸åŒ</strong>ï¼ŒCookie ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ï¼ŒSession ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚</li><li><strong>å­˜å–æ–¹å¼çš„ä¸åŒ</strong>ï¼ŒCookie åªèƒ½ä¿å­˜ ASCIIï¼ŒSession å¯ä»¥å­˜ä»»æ„æ•°æ®ç±»å‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥åœ¨ Session ä¸­ä¿æŒä¸€äº›å¸¸ç”¨å˜é‡ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ UserId ç­‰ã€‚</li><li><strong>æœ‰æ•ˆæœŸä¸åŒ</strong>ï¼ŒCookie å¯è®¾ç½®ä¸ºé•¿æ—¶é—´ä¿æŒï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„é»˜è®¤ç™»å½•åŠŸèƒ½ï¼ŒSession ä¸€èˆ¬å¤±æ•ˆæ—¶é—´è¾ƒçŸ­ï¼Œå®¢æˆ·ç«¯å…³é—­æˆ–è€… Session è¶…æ—¶éƒ½ä¼šå¤±æ•ˆã€‚</li><li><strong>éšç§ç­–ç•¥ä¸åŒ</strong>ï¼ŒCookie å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œæ¯”è¾ƒå®¹æ˜“é­åˆ°ä¸æ³•è·å–ï¼Œæ—©æœŸæœ‰äººå°†ç”¨æˆ·çš„ç™»å½•åå’Œå¯†ç å­˜å‚¨åœ¨ Cookie ä¸­å¯¼è‡´ä¿¡æ¯è¢«çªƒå–ï¼›Session å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œå®‰å…¨æ€§ç›¸å¯¹ Cookie è¦å¥½ä¸€äº›ã€‚</li><li><strong>å­˜å‚¨å¤§å°ä¸åŒ</strong>ï¼Œ å•ä¸ª Cookie ä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡ 4Kï¼ŒSession å¯å­˜å‚¨æ•°æ®è¿œé«˜äº Cookieã€‚</li></ul><h3 id="14-ä¸ºä»€ä¹ˆéœ€è¦-cookie-å’Œ-sessionä»–ä»¬æœ‰ä»€ä¹ˆå…³è”"><a class="markdownIt-Anchor" href="#14-ä¸ºä»€ä¹ˆéœ€è¦-cookie-å’Œ-sessionä»–ä»¬æœ‰ä»€ä¹ˆå…³è”"></a> 1.4. ä¸ºä»€ä¹ˆéœ€è¦ Cookie å’Œ Sessionï¼Œä»–ä»¬æœ‰ä»€ä¹ˆå…³è”ï¼Ÿ</h3><p>è¯´èµ·æ¥ä¸ºä»€ä¹ˆéœ€è¦ Cookie ï¼Œè¿™å°±éœ€è¦ä»æµè§ˆå™¨å¼€å§‹è¯´èµ·ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æµè§ˆå™¨æ˜¯æ²¡æœ‰çŠ¶æ€çš„(HTTP åè®®æ— çŠ¶æ€)ï¼Œè¿™æ„å‘³ç€æµè§ˆå™¨å¹¶ä¸çŸ¥é“æ˜¯å¼ ä¸‰è¿˜æ˜¯æå››åœ¨å’ŒæœåŠ¡ç«¯æ‰“äº¤é“ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦æœ‰ä¸€ä¸ªæœºåˆ¶æ¥å‘Šè¯‰æœåŠ¡ç«¯ï¼Œæœ¬æ¬¡æ“ä½œç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œæ˜¯å“ªä¸ªç”¨æˆ·åœ¨æ‰§è¡Œçš„æ“ä½œï¼Œé‚£è¿™å¥—æœºåˆ¶çš„å®ç°å°±éœ€è¦ Cookie å’Œ Session çš„é…åˆã€‚</p><p>é‚£ä¹ˆ Cookie å’Œ Session æ˜¯å¦‚ä½•é…åˆçš„å‘¢ï¼Ÿæˆ‘ç”»äº†ä¸€å¼ å›¾å¤§å®¶å¯ä»¥å…ˆäº†è§£ä¸‹ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/5/13/16aafb5d90f398e2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img" /></p><p>ç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨æ ¹æ®ç”¨æˆ·æäº¤çš„ç›¸å…³ä¿¡æ¯ï¼Œåˆ›å»ºåˆ›å»ºå¯¹åº”çš„ Session ï¼Œè¯·æ±‚è¿”å›æ—¶å°†æ­¤ Session çš„å”¯ä¸€æ ‡è¯†ä¿¡æ¯ SessionID è¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ SessionID ä¿¡æ¯åï¼Œä¼šå°†æ­¤ä¿¡æ¯å­˜å…¥åˆ° Cookie ä¸­ï¼ŒåŒæ—¶ Cookie è®°å½•æ­¤ SessionID å±äºå“ªä¸ªåŸŸåã€‚</p><p>å½“ç”¨æˆ·ç¬¬äºŒæ¬¡è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨åˆ¤æ–­æ­¤åŸŸåä¸‹æ˜¯å¦å­˜åœ¨ Cookie ä¿¡æ¯ï¼Œå¦‚æœå­˜åœ¨è‡ªåŠ¨å°† Cookie ä¿¡æ¯ä¹Ÿå‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¼šä» Cookie ä¸­è·å– SessionIDï¼Œå†æ ¹æ® SessionID æŸ¥æ‰¾å¯¹åº”çš„ Session ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯´æ˜ç”¨æˆ·æ²¡æœ‰ç™»å½•æˆ–è€…ç™»å½•å¤±æ•ˆï¼Œå¦‚æœæ‰¾åˆ° Session è¯æ˜ç”¨æˆ·å·²ç»ç™»å½•å¯æ‰§è¡Œåé¢æ“ä½œã€‚</p><p>æ ¹æ®ä»¥ä¸Šæµç¨‹å¯çŸ¥ï¼ŒSessionID æ˜¯è¿æ¥ Cookie å’Œ Session çš„ä¸€é“æ¡¥æ¢ï¼Œå¤§éƒ¨åˆ†ç³»ç»Ÿä¹Ÿæ˜¯æ ¹æ®æ­¤åŸç†æ¥éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€ã€‚</p><h3 id="15-å¦‚æœæµè§ˆå™¨ç¦ç”¨-cookie-æ€ä¹ˆåŠ"><a class="markdownIt-Anchor" href="#15-å¦‚æœæµè§ˆå™¨ç¦ç”¨-cookie-æ€ä¹ˆåŠ"></a> 1.5. å¦‚æœæµè§ˆå™¨ç¦ç”¨ Cookie æ€ä¹ˆåŠ</h3><p>æ—¢ç„¶æœåŠ¡ç«¯æ˜¯æ ¹æ® Cookie ä¸­çš„ä¿¡æ¯åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œé‚£ä¹ˆå¦‚æœæµè§ˆå™¨ä¸­ç¦æ­¢äº† Cookieï¼Œå¦‚ä½•ä¿éšœæ•´ä¸ªæœºåˆ¶çš„æ­£å¸¸è¿è½¬ã€‚</p><p>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œæ¯æ¬¡è¯·æ±‚ä¸­éƒ½æºå¸¦ä¸€ä¸ª SessionID çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥ Post çš„æ–¹å¼æäº¤ï¼Œä¹Ÿå¯ä»¥åœ¨è¯·æ±‚çš„åœ°å€åé¢æ‹¼æ¥ <code>xxx?SessionID=123456...</code>ã€‚</p><p>ç¬¬äºŒç§æ–¹æ¡ˆï¼ŒToken æœºåˆ¶ã€‚Token æœºåˆ¶å¤šç”¨äº App å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤äº’çš„æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥ç”¨äº Web ç«¯åšç”¨æˆ·çŠ¶æ€ç®¡ç†ã€‚</p><p>Token çš„æ„æ€æ˜¯â€œä»¤ç‰Œâ€ï¼Œæ˜¯æœåŠ¡ç«¯ç”Ÿæˆçš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œä½œä¸ºå®¢æˆ·ç«¯è¿›è¡Œè¯·æ±‚çš„ä¸€ä¸ªæ ‡è¯†ã€‚Token æœºåˆ¶å’Œ Cookie å’Œ Session çš„ä½¿ç”¨æœºåˆ¶æ¯”è¾ƒç±»ä¼¼ã€‚</p><p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•åï¼ŒæœåŠ¡å™¨æ ¹æ®æäº¤çš„ç”¨æˆ·ä¿¡æ¯ç”Ÿæˆä¸€ä¸ª Tokenï¼Œå“åº”æ—¶å°† Token è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä»¥åå®¢æˆ·ç«¯åªéœ€å¸¦ä¸Šè¿™ä¸ª Token å‰æ¥è¯·æ±‚æ•°æ®å³å¯ï¼Œæ— éœ€å†æ¬¡ç™»å½•éªŒè¯ã€‚</p><h2 id="2-åˆ†å¸ƒå¼-session"><a class="markdownIt-Anchor" href="#2-åˆ†å¸ƒå¼-session"></a> 2. åˆ†å¸ƒå¼ Session</h2><p>åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªç”¨æˆ·çš„ Session å¦‚æœåªå­˜å‚¨åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆå½“è´Ÿè½½å‡è¡¡å™¨æŠŠç”¨æˆ·çš„ä¸‹ä¸€ä¸ªè¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¯¥æœåŠ¡å™¨æ²¡æœ‰ç”¨æˆ·çš„ Sessionï¼Œå°±å¯èƒ½å¯¼è‡´ç”¨æˆ·éœ€è¦é‡æ–°è¿›è¡Œç™»å½•ç­‰æ“ä½œã€‚</p><p>åˆ†å¸ƒå¼ Session çš„å‡ ç§å®ç°ç­–ç•¥ï¼š</p><ol><li>ç²˜æ€§ session</li><li>åº”ç”¨æœåŠ¡å™¨é—´çš„ session å¤åˆ¶å…±äº«</li><li>åŸºäºç¼“å­˜çš„ session å…±äº« âœ…</li></ol><blockquote><p>æ¨èï¼šåŸºäºç¼“å­˜çš„ session å…±äº«</p></blockquote><h3 id="21-ç²˜æ€§-session"><a class="markdownIt-Anchor" href="#21-ç²˜æ€§-session"></a> 2.1. ç²˜æ€§ Session</h3><blockquote><p>ç²˜æ€§ Sessionï¼ˆSticky Sessionsï¼‰<strong>éœ€è¦é…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼Œä½¿å¾—ä¸€ä¸ªç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚éƒ½è·¯ç”±åˆ°ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Š</strong>ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠç”¨æˆ·çš„ Session å­˜æ”¾åœ¨è¯¥æœåŠ¡å™¨èŠ‚ç‚¹ä¸­ã€‚</p><p>ç¼ºç‚¹ï¼š<strong>å½“æœåŠ¡å™¨èŠ‚ç‚¹å®•æœºæ—¶ï¼Œå°†ä¸¢å¤±è¯¥æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ Session</strong>ã€‚</p></blockquote><div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/architecture/MultiNode-StickySessions.jpg!zp" /></div><h3 id="22-session-å¤åˆ¶å…±äº«"><a class="markdownIt-Anchor" href="#22-session-å¤åˆ¶å…±äº«"></a> 2.2. Session å¤åˆ¶å…±äº«</h3><blockquote><p>Session å¤åˆ¶å…±äº«ï¼ˆSession Replicationï¼‰<strong>åœ¨æœåŠ¡å™¨èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œ Session åŒæ­¥æ“ä½œ</strong>ï¼Œè¿™æ ·çš„è¯ç”¨æˆ·å¯ä»¥è®¿é—®ä»»ä½•ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ã€‚</p><p>ç¼ºç‚¹ï¼š<strong>å ç”¨è¿‡å¤šå†…å­˜</strong>ï¼›<strong>åŒæ­¥è¿‡ç¨‹å ç”¨ç½‘ç»œå¸¦å®½ä»¥åŠæœåŠ¡å™¨å¤„ç†å™¨æ—¶é—´</strong>ã€‚</p></blockquote><div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/architecture/MultiNode-SessionReplication.jpg!zp" /></div><h3 id="23-åŸºäºç¼“å­˜çš„-session-å…±äº«"><a class="markdownIt-Anchor" href="#23-åŸºäºç¼“å­˜çš„-session-å…±äº«"></a> 2.3. åŸºäºç¼“å­˜çš„ session å…±äº«</h3><blockquote><p><strong>ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„å­˜å‚¨æœåŠ¡å™¨å­˜å‚¨ Session æ•°æ®</strong>ï¼Œå¯ä»¥å­˜åœ¨ MySQL æ•°æ®åº“ä¸Šï¼Œä¹Ÿå¯ä»¥å­˜åœ¨ Redis æˆ–è€… Memcached è¿™ç§å†…å­˜å‹æ•°æ®åº“ã€‚</p><p>ç¼ºç‚¹ï¼šéœ€è¦å»å®ç°å­˜å– Session çš„ä»£ç ã€‚</p></blockquote><div align="center"><img src="http://dunwu.test.upcdn.net/cs/design/architecture/MultiNode-SpringSession.jpg!zp" /></div><h2 id="3-å…·ä½“å®ç°"><a class="markdownIt-Anchor" href="#3-å…·ä½“å®ç°"></a> 3. å…·ä½“å®ç°</h2><h3 id="31-jwt-token"><a class="markdownIt-Anchor" href="#31-jwt-token"></a> 3.1. JWT Token</h3><p>ä½¿ç”¨ JWT Token å‚¨å­˜ç”¨æˆ·èº«ä»½ï¼Œç„¶åå†ä»æ•°æ®åº“æˆ–è€… cache ä¸­è·å–å…¶ä»–çš„ä¿¡æ¯ã€‚è¿™æ ·æ— è®ºè¯·æ±‚åˆ†é…åˆ°å“ªä¸ªæœåŠ¡å™¨éƒ½æ— æ‰€è°“ã€‚</p><h3 id="32-tomcat-redis"><a class="markdownIt-Anchor" href="#32-tomcat-redis"></a> 3.2. tomcat + redis</h3><p>è¿™ä¸ªå…¶å®è¿˜æŒºæ–¹ä¾¿çš„ï¼Œå°±æ˜¯ä½¿ç”¨ session çš„ä»£ç ï¼Œè·Ÿä»¥å‰ä¸€æ ·ï¼Œè¿˜æ˜¯åŸºäº tomcat åŸç”Ÿçš„ session æ”¯æŒå³å¯ï¼Œç„¶åå°±æ˜¯ç”¨ä¸€ä¸ªå«åš <code>Tomcat RedisSessionManager</code> çš„ä¸œè¥¿ï¼Œè®©æ‰€æœ‰æˆ‘ä»¬éƒ¨ç½²çš„ tomcat éƒ½å°† session æ•°æ®å­˜å‚¨åˆ° redis å³å¯ã€‚</p><p>åœ¨ tomcat çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">"com.orangefunction.tomcat.redissessions.RedisSessionManager"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">host</span>=<span class="string">"&#123;redis.host&#125;"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">port</span>=<span class="string">"&#123;redis.port&#125;"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">database</span>=<span class="string">"&#123;redis.dbnum&#125;"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">maxInactiveInterval</span>=<span class="string">"60"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæŒ‡å®š redis çš„ host å’Œ port å°± ok äº†ã€‚</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">"com.orangefunction.tomcat.redissessions.RedisSessionManager"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">sentinelMaster</span>=<span class="string">"mymaster"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">sentinels</span>=<span class="string">"&lt;sentinel1-ip&gt;:26379,&lt;sentinel2-ip&gt;:26379,&lt;sentinel3-ip&gt;:26379"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">maxInactiveInterval</span>=<span class="string">"60"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ç”¨ä¸Šé¢è¿™ç§æ–¹å¼åŸºäº redis å“¨å…µæ”¯æŒçš„ redis é«˜å¯ç”¨é›†ç¾¤æ¥ä¿å­˜ session æ•°æ®ï¼Œéƒ½æ˜¯ ok çš„ã€‚</p><h3 id="33-spring-session-redis"><a class="markdownIt-Anchor" href="#33-spring-session-redis"></a> 3.3. spring session + redis</h3><p>ä¸Šé¢é‚£ç§ tomcat + redis çš„æ–¹å¼å¥½ç”¨ï¼Œä½†æ˜¯ä¼š<strong>ä¸¥é‡ä¾èµ–äº web å®¹å™¨</strong>ï¼Œä¸å¥½å°†ä»£ç ç§»æ¤åˆ°å…¶ä»– web å®¹å™¨ä¸Šå»ï¼Œå°¤å…¶æ˜¯ä½ è¦æ˜¯æ¢äº†æŠ€æœ¯æ ˆå’‹æ•´ï¼Ÿæ¯”å¦‚æ¢æˆäº† spring cloud æˆ–è€…æ˜¯ spring boot ä¹‹ç±»çš„å‘¢ï¼Ÿ</p><p>æ‰€ä»¥ç°åœ¨æ¯”è¾ƒå¥½çš„è¿˜æ˜¯åŸºäº Java ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯ springã€‚äººå®¶ spring åŸºæœ¬ä¸Šæ‰¿åŒ…äº†å¤§éƒ¨åˆ†æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„æ¡†æ¶ï¼Œspirng cloud åšå¾®æœåŠ¡ï¼Œspring boot åšè„šæ‰‹æ¶ï¼Œæ‰€ä»¥ç”¨ <a href="https://github.com/spring-projects/spring-session" target="_blank" rel="noopener">sping session</a> æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p><p>åœ¨ pom.xml ä¸­é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ spring é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"redisHttpSessionConfiguration"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">class</span>=<span class="string">"org.springframework.session.data.redis.config.annotation.web.http.RedisHttpSessionConfiguration"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxInactiveIntervalInSeconds"</span> <span class="attr">value</span>=<span class="string">"600"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisPoolConfig"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxTotal"</span> <span class="attr">value</span>=<span class="string">"100"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisConnectionFactory"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span> <span class="attr">destroy-method</span>=<span class="string">"destroy"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hostName"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis_hostname&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"port"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis_port&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;redis_pwd&#125;"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeout"</span> <span class="attr">value</span>=<span class="string">"3000"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"usePool"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"poolConfig"</span> <span class="attr">ref</span>=<span class="string">"jedisPoolConfig"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ web.xml ä¸­é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSessionRepositoryFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSessionRepositoryFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/putIntoSession"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">putIntoSession</span><span class="params">(HttpServletRequest request, String username)</span> </span>&#123;</span><br><span class="line">        request.getSession().setAttribute(<span class="string">"name"</span>,  <span class="string">"leo"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/getFromSession"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFromSession</span><span class="params">(HttpServletRequest request, Model model)</span></span>&#123;</span><br><span class="line">        String name = request.getSession().getAttribute(<span class="string">"name"</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å°±æ˜¯ ok çš„ï¼Œç»™ sping session é…ç½®åŸºäº redis æ¥å­˜å‚¨ session æ•°æ®ï¼Œç„¶åé…ç½®äº†ä¸€ä¸ª spring session çš„è¿‡æ»¤å™¨ï¼Œè¿™æ ·çš„è¯ï¼Œsession ç›¸å…³æ“ä½œéƒ½ä¼šäº¤ç»™ spring session æ¥ç®¡äº†ã€‚æ¥ç€åœ¨ä»£ç ä¸­ï¼Œå°±ç”¨åŸç”Ÿçš„ session æ“ä½œï¼Œå°±æ˜¯ç›´æ¥åŸºäº spring sesion ä» redis ä¸­è·å–æ•°æ®äº†ã€‚</p><p>å®ç°åˆ†å¸ƒå¼çš„ä¼šè¯æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæˆ‘è¯´çš„åªä¸è¿‡æ˜¯æ¯”è¾ƒå¸¸è§çš„å‡ ç§æ–¹å¼ï¼Œtomcat + redis æ—©æœŸæ¯”è¾ƒå¸¸ç”¨ï¼Œä½†æ˜¯ä¼šé‡è€¦åˆåˆ° tomcat ä¸­ï¼›è¿‘äº›å¹´ï¼Œé€šè¿‡ spring session æ¥å®ç°ã€‚</p><h2 id="4-å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#4-å‚è€ƒèµ„æ–™"></a> 4. å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://github.com/L316476844/distributed-session" target="_blank" rel="noopener">é›†ç¾¤/åˆ†å¸ƒå¼ç¯å¢ƒ Session çš„å‡ ç§ç­–ç•¥</a></li><li><a href="https://juejin.im/post/5cd9037ee51d456e5c5babca" target="_blank" rel="noopener">ä½ çœŸçš„äº†è§£ Cookie å’Œ Session å—</a></li><li><a href="https://juejin.im/post/5aede266f265da0ba266e0ef" target="_blank" rel="noopener">èŠä¸€èŠ session å’Œ cookie</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;åˆ†å¸ƒå¼ä¼šè¯åŸºæœ¬åŸç†&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#åˆ†å¸ƒå¼ä¼šè¯åŸºæœ¬åŸç†&quot;&gt;&lt;/a&gt; åˆ†å¸ƒå¼ä¼šè¯åŸºæœ¬åŸç†&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;ç”±äº Http æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®ï¼ŒæœåŠ¡å™¨å•å•ä»ç½‘ç»œè¿æ¥ä¸Šæ— ä»çŸ¥é“å®¢æˆ·èº«ä»½ã€‚
      
    
    </summary>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/tags/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/tags/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
      <category term="session" scheme="https://dunwu.github.io/blog/tags/session/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼é”åŸºæœ¬åŸç†</title>
    <link href="https://dunwu.github.io/blog/design/theory/distributed-lock-theory/"/>
    <id>https://dunwu.github.io/blog/design/theory/distributed-lock-theory/</id>
    <published>2019-06-04T15:42:00.000Z</published>
    <updated>2020-01-19T13:59:32.983Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆ†å¸ƒå¼é”åŸºæœ¬åŸç†"><a class="markdownIt-Anchor" href="#åˆ†å¸ƒå¼é”åŸºæœ¬åŸç†"></a> åˆ†å¸ƒå¼é”åŸºæœ¬åŸç†</h1><!-- TOC depthFrom:2 depthTo:3 --><ul><li><a href="#1-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%80%9D%E8%B7%AF">1. åˆ†å¸ƒå¼é”æ€è·¯</a></li><li><a href="#2-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">2. æ•°æ®åº“åˆ†å¸ƒå¼é”</a><ul><li><a href="#21-%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0">2.1. å…·ä½“å®ç°</a></li><li><a href="#22-%E9%97%AE%E9%A2%98">2.2. é—®é¢˜</a></li><li><a href="#23-%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95">2.3. è§£å†³åŠæ³•</a></li><li><a href="#24-%E5%B0%8F%E7%BB%93">2.4. å°ç»“</a></li></ul></li><li><a href="#3-redis-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">3. Redis åˆ†å¸ƒå¼é”</a><ul><li><a href="#31-%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF">3.1. å®ç°æ€è·¯</a></li><li><a href="#32-%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0">3.2. å…·ä½“å®ç°</a></li><li><a href="#33-%E5%B0%8F%E7%BB%93">3.3. å°ç»“</a></li><li><a href="#34-redlock-%E7%AE%97%E6%B3%95">3.4. RedLock ç®—æ³•</a></li></ul></li><li><a href="#4-zookeeper-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">4. ZooKeeper åˆ†å¸ƒå¼é”</a><ul><li><a href="#41-%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF">4.1. å®ç°æ€è·¯</a></li><li><a href="#42-%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0">4.2. å…·ä½“å®ç°</a></li><li><a href="#43-%E5%B0%8F%E7%BB%93">4.3. å°ç»“</a></li></ul></li><li><a href="#5-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94">5. åˆ†å¸ƒå¼é”æ–¹æ¡ˆå¯¹æ¯”</a></li><li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li></ul><!-- /TOC --><p>Java åŸç”Ÿ API è™½ç„¶æœ‰å¹¶å‘é”ï¼Œä½†å¹¶æ²¡æœ‰æä¾›åˆ†å¸ƒå¼é”çš„èƒ½åŠ›ï¼Œæ‰€ä»¥é’ˆå¯¹åˆ†å¸ƒå¼åœºæ™¯ä¸­çš„é”éœ€è¦è§£å†³çš„æ–¹æ¡ˆã€‚</p><p>åˆ†å¸ƒå¼é”çš„è§£å†³æ–¹æ¡ˆå¤§è‡´æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>åŸºäºæ•°æ®åº“å®ç°</li><li>åŸºäºç¼“å­˜ï¼ˆredisï¼Œmemcached ç­‰ï¼‰å®ç°</li><li>åŸºäº Zookeeper å®ç° âœ…</li></ul><blockquote><p>æ³¨ï¼šæ¨èåŸºäº ZooKeeper å®ç°åˆ†å¸ƒå¼é”ï¼Œå…·ä½“åŸå› çœ‹å®Œæœ¬æ–‡å³å¯æ˜äº†ã€‚</p></blockquote><h2 id="1-åˆ†å¸ƒå¼é”æ€è·¯"><a class="markdownIt-Anchor" href="#1-åˆ†å¸ƒå¼é”æ€è·¯"></a> 1. åˆ†å¸ƒå¼é”æ€è·¯</h2><p>åˆ†å¸ƒå¼é”çš„æ€»ä½“æ€è·¯å¤§åŒå°å¼‚ï¼Œä»…åœ¨å®ç°ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚</p><p>åˆ†å¸ƒå¼é”çš„ä¸»è¦æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li><strong>äº’æ–¥</strong> - åˆ›å»ºé”å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œè¡¨ç°å½¢å¼ä¸ºå‘æ•°æ®å­˜å‚¨æœåŠ¡å™¨æˆ–å®¹å™¨æ’å…¥ä¸€ä¸ªå”¯ä¸€çš„ keyï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªçº¿ç¨‹æ’å…¥è¿™ä¸ª keyï¼Œå…¶ä»–çº¿ç¨‹å°±ä¸èƒ½å†æ’å…¥äº†ã€‚</li><li><strong>é¿å…æ°¸è¿œä¸é‡Šæ”¾é”</strong> - æ•°æ®åº“åˆ†å¸ƒå¼é”å’Œç¼“å­˜åˆ†å¸ƒå¼é”ï¼ˆRedisï¼‰çš„æ€è·¯éƒ½æ˜¯å¼•å…¥è¶…æ—¶æœºåˆ¶ï¼Œå³æˆåŠŸç”³è¯·é”åï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´ï¼Œé”å¤±æ•ˆï¼ˆåˆ é™¤ keyï¼‰ï¼ŒåŸå› åœ¨äºå®ƒä»¬æ— æ³•æ„ŸçŸ¥ç”³è¯·é”çš„å®¢æˆ·ç«¯èŠ‚ç‚¹çŠ¶æ€ã€‚è€Œ ZooKeeper ç”±äºå…¶ znode ä»¥ç›®å½•ã€æ–‡ä»¶å½¢å¼ç»„ç»‡ï¼Œå¤©ç„¶å°±å­˜åœ¨ç‰©ç†ç©ºé—´éš”ç¦»ï¼Œåªè¦ znode å­˜åœ¨ï¼Œå³è¡¨ç¤ºå®¢æˆ·ç«¯èŠ‚ç‚¹è¿˜åœ¨å·¥ä½œï¼Œæ‰€ä»¥ä¸å­˜åœ¨è¿™ç§é—®é¢˜ã€‚</li><li><strong>å®¹é”™</strong>ï¼ˆåªè¦å¤§éƒ¨åˆ† redis èŠ‚ç‚¹åˆ›å»ºäº†è¿™æŠŠé”å°±å¯ä»¥ï¼‰</li></ul><h2 id="2-æ•°æ®åº“åˆ†å¸ƒå¼é”"><a class="markdownIt-Anchor" href="#2-æ•°æ®åº“åˆ†å¸ƒå¼é”"></a> 2. æ•°æ®åº“åˆ†å¸ƒå¼é”</h2><h3 id="21-å…·ä½“å®ç°"><a class="markdownIt-Anchor" href="#21-å…·ä½“å®ç°"></a> 2.1. å…·ä½“å®ç°</h3><p>ï¼ˆ1ï¼‰åˆ›å»ºè¡¨</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`methodLock`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'ä¸»é”®'</span>,</span><br><span class="line">  <span class="string">`method_name`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'é”å®šçš„æ–¹æ³•å'</span>,</span><br><span class="line">  <span class="string">`desc`</span> <span class="built_in">varchar</span>(<span class="number">1024</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'å¤‡æ³¨ä¿¡æ¯'</span>,</span><br><span class="line">  <span class="string">`update_time`</span> <span class="built_in">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'ä¿å­˜æ•°æ®æ—¶é—´ï¼Œè‡ªåŠ¨ç”Ÿæˆ'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`uidx_method_name`</span> (<span class="string">`method_name `</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'é”å®šä¸­çš„æ–¹æ³•'</span>;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰è·å–é”</p><p>æƒ³è¦é”ä½æŸä¸ªæ–¹æ³•æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹ SQLï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> methodLock(method_name,<span class="keyword">desc</span>) <span class="keyword">values</span> (â€˜method_nameâ€™,â€˜<span class="keyword">desc</span>â€™)</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬å¯¹ <code>method_name</code> åšäº†å”¯ä¸€æ€§çº¦æŸï¼Œè¿™é‡Œå¦‚æœæœ‰å¤šä¸ªè¯·æ±‚åŒæ—¶æäº¤åˆ°æ•°æ®åº“çš„è¯ï¼Œæ•°æ®åº“ä¼šä¿è¯åªæœ‰ä¸€ä¸ªæ“ä½œå¯ä»¥æˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºæ“ä½œæˆåŠŸçš„é‚£ä¸ªçº¿ç¨‹è·å¾—äº†è¯¥æ–¹æ³•çš„é”ï¼Œå¯ä»¥æ‰§è¡Œæ–¹æ³•ä½“å†…å®¹ã€‚</p><p>æˆåŠŸæ’å…¥åˆ™è·å–é”ã€‚</p><p>ï¼ˆ3ï¼‰é‡Šæ”¾é”</p><p>å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæƒ³è¦é‡Šæ”¾é”çš„è¯ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹ Sql:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> methodLock <span class="keyword">where</span> method_name =<span class="string">'method_name'</span></span><br></pre></td></tr></table></figure><h3 id="22-é—®é¢˜"><a class="markdownIt-Anchor" href="#22-é—®é¢˜"></a> 2.2. é—®é¢˜</h3><ul><li>è¿™æŠŠé”å¼ºä¾èµ–æ•°æ®åº“çš„å¯ç”¨æ€§ã€‚å¦‚æœæ•°æ®åº“æ˜¯ä¸€ä¸ªå•ç‚¹ï¼Œä¸€æ—¦æ•°æ®åº“æŒ‚æ‰ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸å¯ç”¨ã€‚</li><li>è¿™æŠŠé”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Œä¸€æ—¦è§£é”æ“ä½œå¤±è´¥ï¼Œå°±ä¼šå¯¼è‡´é”è®°å½•ä¸€ç›´åœ¨æ•°æ®åº“ä¸­ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•å†è·å¾—åˆ°é”ã€‚</li><li>è¿™æŠŠé”åªèƒ½æ˜¯éé˜»å¡çš„ï¼Œå› ä¸ºæ•°æ®çš„ insert æ“ä½œï¼Œä¸€æ—¦æ’å…¥å¤±è´¥å°±ä¼šç›´æ¥æŠ¥é”™ã€‚æ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹å¹¶ä¸ä¼šè¿›å…¥æ’é˜Ÿé˜Ÿåˆ—ï¼Œè¦æƒ³å†æ¬¡è·å¾—é”å°±è¦å†æ¬¡è§¦å‘è·å¾—é”æ“ä½œã€‚</li><li>è¿™æŠŠé”æ˜¯éé‡å…¥çš„ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰æ— æ³•å†æ¬¡è·å¾—è¯¥é”ã€‚å› ä¸ºæ•°æ®ä¸­æ•°æ®å·²ç»å­˜åœ¨äº†ã€‚</li></ul><h3 id="23-è§£å†³åŠæ³•"><a class="markdownIt-Anchor" href="#23-è§£å†³åŠæ³•"></a> 2.3. è§£å†³åŠæ³•</h3><ul><li>å•ç‚¹é—®é¢˜å¯ä»¥ç”¨å¤šæ•°æ®åº“å®ä¾‹ï¼ŒåŒæ—¶å¡ N ä¸ªè¡¨ï¼ŒN/2+1 ä¸ªæˆåŠŸå°±ä»»åŠ¡é”å®šæˆåŠŸ</li><li>å†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œéš”ä¸€æ®µæ—¶é—´æ¸…é™¤ä¸€æ¬¡è¿‡æœŸçš„æ•°æ®ã€‚</li><li>å†™ä¸€ä¸ª while å¾ªç¯ï¼Œä¸æ–­çš„é‡è¯•æ’å…¥ï¼Œç›´åˆ°æˆåŠŸã€‚</li><li>åœ¨æ•°æ®åº“è¡¨ä¸­åŠ ä¸ªå­—æ®µï¼Œè®°å½•å½“å‰è·å¾—é”çš„æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸‹æ¬¡å†è·å–é”çš„æ—¶å€™å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚æœå½“å‰æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯åœ¨æ•°æ®åº“å¯ä»¥æŸ¥åˆ°çš„è¯ï¼Œç›´æ¥æŠŠé”åˆ†é…ç»™ä»–å°±å¯ä»¥äº†ã€‚</li></ul><h3 id="24-å°ç»“"><a class="markdownIt-Anchor" href="#24-å°ç»“"></a> 2.4. å°ç»“</h3><ul><li>ä¼˜ç‚¹: ç›´æ¥å€ŸåŠ©æ•°æ®åº“ï¼Œå®¹æ˜“ç†è§£ã€‚</li><li>ç¼ºç‚¹: ä¼šæœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼Œåœ¨è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­ä¼šä½¿æ•´ä¸ªæ–¹æ¡ˆå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚æ“ä½œæ•°æ®åº“éœ€è¦ä¸€å®šçš„å¼€é”€ï¼Œæ€§èƒ½é—®é¢˜éœ€è¦è€ƒè™‘ã€‚</li></ul><h2 id="3-redis-åˆ†å¸ƒå¼é”"><a class="markdownIt-Anchor" href="#3-redis-åˆ†å¸ƒå¼é”"></a> 3. Redis åˆ†å¸ƒå¼é”</h2><p>ç›¸æ¯”äºç”¨æ•°æ®åº“æ¥å®ç°åˆ†å¸ƒå¼é”ï¼ŒåŸºäºç¼“å­˜å®ç°çš„åˆ†å¸ƒå¼é”çš„æ€§èƒ½ä¼šæ›´å¥½ä¸€äº›ã€‚ç›®å‰æœ‰å¾ˆå¤šæˆç†Ÿçš„åˆ†å¸ƒå¼äº§å“ï¼ŒåŒ…æ‹¬ Redisã€memcacheã€Tair ç­‰ã€‚è¿™é‡Œä»¥ Redis ä¸¾ä¾‹ã€‚</p><h3 id="31-å®ç°æ€è·¯"><a class="markdownIt-Anchor" href="#31-å®ç°æ€è·¯"></a> 3.1. å®ç°æ€è·¯</h3><p>è¿™ä¸ªåˆ†å¸ƒå¼é”æœ‰ 3 ä¸ªé‡è¦çš„è€ƒé‡ç‚¹ï¼š</p><ol><li>äº’æ–¥ï¼ˆåªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è·å–é”ï¼‰</li><li>ä¸èƒ½æ­»é”</li><li>å®¹é”™ï¼ˆåªè¦å¤§éƒ¨åˆ† redis èŠ‚ç‚¹åˆ›å»ºäº†è¿™æŠŠé”å°±å¯ä»¥ï¼‰</li></ol><p>å¯¹åº”çš„ Redis æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><ul><li><code>setnx</code> - <code>setnx key val</code>ï¼šå½“ä¸”ä»…å½“ key ä¸å­˜åœ¨æ—¶ï¼Œset ä¸€ä¸ª key ä¸º val çš„å­—ç¬¦ä¸²ï¼Œè¿”å› 1ï¼›è‹¥ key å­˜åœ¨ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œè¿”å› 0ã€‚</li><li><code>expire</code> - <code>expire key timeout</code>ï¼šä¸º key è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸º secondï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´é”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…æ­»é”ã€‚</li><li><code>delete</code> - <code>delete key</code>ï¼šåˆ é™¤ key</li></ul><h3 id="32-å…·ä½“å®ç°"><a class="markdownIt-Anchor" href="#32-å…·ä½“å®ç°"></a> 3.2. å…·ä½“å®ç°</h3><p>ï¼ˆ1ï¼‰ç”³è¯·é”</p><figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> resource_name <span class="comment">my_random_value NX PX 30000</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å°± okã€‚</p><ul><li><code>NX</code>ï¼šè¡¨ç¤ºåªæœ‰ <code>key</code> ä¸å­˜åœ¨çš„æ—¶å€™æ‰ä¼šè®¾ç½®æˆåŠŸã€‚ï¼ˆå¦‚æœæ­¤æ—¶ redis ä¸­å­˜åœ¨è¿™ä¸ª keyï¼Œé‚£ä¹ˆè®¾ç½®å¤±è´¥ï¼Œè¿”å› <code>nil</code>ï¼‰</li><li><code>PX 30000</code>ï¼šæ„æ€æ˜¯ 30s åé”è‡ªåŠ¨é‡Šæ”¾ã€‚åˆ«äººåˆ›å»ºçš„æ—¶å€™å¦‚æœå‘ç°å·²ç»æœ‰äº†å°±ä¸èƒ½åŠ é”äº†ã€‚</li></ul><p>ï¼ˆ2ï¼‰é‡Šæ”¾é”</p><p>é‡Šæ”¾é”å°±æ˜¯åˆ é™¤ key ï¼Œä½†æ˜¯ä¸€èˆ¬å¯ä»¥ç”¨ <code>lua</code> è„šæœ¬åˆ é™¤ï¼Œåˆ¤æ–­ value ä¸€æ ·æ‰åˆ é™¤ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">-- åˆ é™¤é”çš„æ—¶å€™ï¼Œæ‰¾åˆ° key å¯¹åº”çš„ valueï¼Œè·Ÿè‡ªå·±ä¼ è¿‡å»çš„ value åšæ¯”è¾ƒï¼Œå¦‚æœæ˜¯ä¸€æ ·çš„æ‰åˆ é™¤ã€‚</span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">"get"</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] then</span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">"del"</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure><h3 id="33-å°ç»“"><a class="markdownIt-Anchor" href="#33-å°ç»“"></a> 3.3. å°ç»“</h3><p>ä¸ºå•¥è¦ç”¨ <code>random_value</code> éšæœºå€¼å‘¢ï¼Ÿå› ä¸ºå¦‚æœæŸä¸ªå®¢æˆ·ç«¯è·å–åˆ°äº†é”ï¼Œä½†æ˜¯é˜»å¡äº†å¾ˆé•¿æ—¶é—´æ‰æ‰§è¡Œå®Œï¼Œæ¯”å¦‚è¯´è¶…è¿‡äº† 30sï¼Œæ­¤æ—¶å¯èƒ½å·²ç»è‡ªåŠ¨é‡Šæ”¾é”äº†ï¼Œæ­¤æ—¶å¯èƒ½åˆ«çš„å®¢æˆ·ç«¯å·²ç»è·å–åˆ°äº†è¿™ä¸ªé”ï¼Œè¦æ˜¯ä½ è¿™ä¸ªæ—¶å€™ç›´æ¥åˆ é™¤ key çš„è¯ä¼šæœ‰é—®é¢˜ï¼Œæ‰€ä»¥å¾—ç”¨éšæœºå€¼åŠ ä¸Šé¢çš„ <code>lua</code> è„šæœ¬æ¥é‡Šæ”¾é”ã€‚</p><p>ä½†æ˜¯è¿™æ ·æ˜¯è‚¯å®šä¸è¡Œçš„ã€‚å› ä¸ºå¦‚æœæ˜¯æ™®é€šçš„ redis å•å®ä¾‹ï¼Œé‚£å°±æ˜¯å•ç‚¹æ•…éšœã€‚æˆ–è€…æ˜¯ redis æ™®é€šä¸»ä»ï¼Œé‚£ redis ä¸»ä»å¼‚æ­¥å¤åˆ¶ï¼Œå¦‚æœä¸»èŠ‚ç‚¹æŒ‚äº†ï¼ˆkey å°±æ²¡æœ‰äº†ï¼‰ï¼Œkey è¿˜æ²¡åŒæ­¥åˆ°ä»èŠ‚ç‚¹ï¼Œæ­¤æ—¶ä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œåˆ«äººå°±å¯ä»¥ set keyï¼Œä»è€Œæ‹¿åˆ°é”ã€‚</p><h3 id="34-redlock-ç®—æ³•"><a class="markdownIt-Anchor" href="#34-redlock-ç®—æ³•"></a> 3.4. RedLock ç®—æ³•</h3><p>è¿™ä¸ªåœºæ™¯æ˜¯å‡è®¾æœ‰ä¸€ä¸ª redis clusterï¼Œæœ‰ 5 ä¸ª redis master å®ä¾‹ã€‚ç„¶åæ‰§è¡Œå¦‚ä¸‹æ­¥éª¤è·å–ä¸€æŠŠé”ï¼š</p><ol><li>è·å–å½“å‰æ—¶é—´æˆ³ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼›</li><li>è·Ÿä¸Šé¢ç±»ä¼¼ï¼Œè½®æµå°è¯•åœ¨æ¯ä¸ª master èŠ‚ç‚¹ä¸Šåˆ›å»ºé”ï¼Œè¿‡æœŸæ—¶é—´è¾ƒçŸ­ï¼Œä¸€èˆ¬å°±å‡ åæ¯«ç§’ï¼›</li><li>å°è¯•åœ¨<strong>å¤§å¤šæ•°èŠ‚ç‚¹</strong>ä¸Šå»ºç«‹ä¸€ä¸ªé”ï¼Œæ¯”å¦‚ 5 ä¸ªèŠ‚ç‚¹å°±è¦æ±‚æ˜¯ 3 ä¸ªèŠ‚ç‚¹ <code>n / 2 + 1</code>ï¼›</li><li>å®¢æˆ·ç«¯è®¡ç®—å»ºç«‹å¥½é”çš„æ—¶é—´ï¼Œå¦‚æœå»ºç«‹é”çš„æ—¶é—´å°äºè¶…æ—¶æ—¶é—´ï¼Œå°±ç®—å»ºç«‹æˆåŠŸäº†ï¼›</li><li>è¦æ˜¯é”å»ºç«‹å¤±è´¥äº†ï¼Œé‚£ä¹ˆå°±ä¾æ¬¡ä¹‹å‰å»ºç«‹è¿‡çš„é”åˆ é™¤ï¼›</li><li>åªè¦åˆ«äººå»ºç«‹äº†ä¸€æŠŠåˆ†å¸ƒå¼é”ï¼Œä½ å°±å¾—<strong>ä¸æ–­è½®è¯¢å»å°è¯•è·å–é”</strong>ã€‚</li></ol><p><a href="https://redis.io/" target="_blank" rel="noopener">Redis å®˜æ–¹</a>ç»™å‡ºäº†ä»¥ä¸Šä¸¤ç§åŸºäº Redis å®ç°åˆ†å¸ƒå¼é”çš„æ–¹æ³•ï¼Œè¯¦ç»†è¯´æ˜å¯ä»¥æŸ¥çœ‹ï¼š<a href="https://redis.io/topics/distlock" target="_blank" rel="noopener">https://redis.io/topics/distlock</a> ã€‚</p><h2 id="4-zookeeper-åˆ†å¸ƒå¼é”"><a class="markdownIt-Anchor" href="#4-zookeeper-åˆ†å¸ƒå¼é”"></a> 4. ZooKeeper åˆ†å¸ƒå¼é”</h2><h3 id="41-å®ç°æ€è·¯"><a class="markdownIt-Anchor" href="#41-å®ç°æ€è·¯"></a> 4.1. å®ç°æ€è·¯</h3><p>è¿™ä¹Ÿæ˜¯ ZooKeeper å®¢æˆ·ç«¯ curator çš„åˆ†å¸ƒå¼é”å®ç°ã€‚</p><ol><li>åˆ›å»ºä¸€ä¸ªç›®å½• mylockï¼›</li><li>çº¿ç¨‹ A æƒ³è·å–é”å°±åœ¨ mylock ç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼›</li><li>è·å– mylock ç›®å½•ä¸‹æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œç„¶åè·å–æ¯”è‡ªå·±å°çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜å½“å‰çº¿ç¨‹é¡ºåºå·æœ€å°ï¼Œè·å¾—é”ï¼›</li><li>çº¿ç¨‹ B è·å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œåˆ¤æ–­è‡ªå·±ä¸æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œè®¾ç½®ç›‘å¬æ¯”è‡ªå·±æ¬¡å°çš„èŠ‚ç‚¹ï¼›</li><li>çº¿ç¨‹ A å¤„ç†å®Œï¼Œåˆ é™¤è‡ªå·±çš„èŠ‚ç‚¹ï¼Œçº¿ç¨‹ B ç›‘å¬åˆ°å˜æ›´äº‹ä»¶ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è·å¾—é”ã€‚</li></ol><h3 id="42-å…·ä½“å®ç°"><a class="markdownIt-Anchor" href="#42-å…·ä½“å®ç°"></a> 4.2. å…·ä½“å®ç°</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ZooKeeperSession</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> bingo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2018/11/29</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZooKeeperSession</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CountDownLatch connectedSemaphore = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ZooKeeper zookeeper;</span><br><span class="line">    <span class="keyword">private</span> CountDownLatch latch;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ZooKeeperSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.zookeeper = <span class="keyword">new</span> ZooKeeper(<span class="string">"192.168.31.187:2181,192.168.31.19:2181,192.168.31.227:2181"</span>, <span class="number">50000</span>, <span class="keyword">new</span> ZooKeeperWatcher());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connectedSemaphore.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"ZooKeeper session established......"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–åˆ†å¸ƒå¼é”</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> productId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">acquireDistributedLock</span><span class="params">(Long productId)</span> </span>&#123;</span><br><span class="line">        String path = <span class="string">"/product-lock-"</span> + productId;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            zookeeper.create(path, <span class="string">""</span>.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// ç›¸å½“äºæ˜¯ç»™nodeæ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ï¼Œå»çœ‹çœ‹è¿™ä¸ªç›‘å¬å™¨æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">                    Stat stat = zk.exists(path, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (stat != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.latch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">                        <span class="keyword">this</span>.latch.await(waitTime, TimeUnit.MILLISECONDS);</span><br><span class="line">                        <span class="keyword">this</span>.latch = <span class="keyword">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    zookeeper.create(path, <span class="string">""</span>.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception ee) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡Šæ”¾æ‰ä¸€ä¸ªåˆ†å¸ƒå¼é”</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> productId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">releaseDistributedLock</span><span class="params">(Long productId)</span> </span>&#123;</span><br><span class="line">        String path = <span class="string">"/product-lock-"</span> + productId;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            zookeeper.delete(path, -<span class="number">1</span>);</span><br><span class="line">            System.out.println(<span class="string">"release the lock for product[id="</span> + productId + <span class="string">"]......"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å»ºç«‹zk sessionçš„watcher</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> bingo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 2018/11/29</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ZooKeeperWatcher</span> <span class="keyword">implements</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(WatchedEvent event)</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"Receive watched event: "</span> + event.getState());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (KeeperState.SyncConnected == event.getState()) &#123;</span><br><span class="line">                connectedSemaphore.countDown();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.latch != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.latch.countDown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°è£…å•ä¾‹çš„é™æ€å†…éƒ¨ç±»</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> bingo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 2018/11/29</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> ZooKeeperSession instance;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> ZooKeeperSession();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ZooKeeperSession <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å•ä¾‹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ZooKeeperSession <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Singleton.getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–å•ä¾‹çš„ä¾¿æ·æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥é‡‡ç”¨å¦ä¸€ç§æ–¹å¼ï¼Œåˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼š</p><p>å¦‚æœæœ‰ä¸€æŠŠé”ï¼Œè¢«å¤šä¸ªäººç»™ç«äº‰ï¼Œæ­¤æ—¶å¤šä¸ªäººä¼šæ’é˜Ÿï¼Œç¬¬ä¸€ä¸ªæ‹¿åˆ°é”çš„äººä¼šæ‰§è¡Œï¼Œç„¶åé‡Šæ”¾é”ï¼›åé¢çš„æ¯ä¸ªäººéƒ½ä¼šå»ç›‘å¬<strong>æ’åœ¨è‡ªå·±å‰é¢</strong>çš„é‚£ä¸ªäººåˆ›å»ºçš„ node ä¸Šï¼Œä¸€æ—¦æŸä¸ªäººé‡Šæ”¾äº†é”ï¼Œæ’åœ¨è‡ªå·±åé¢çš„äººå°±ä¼šè¢« zookeeper ç»™é€šçŸ¥ï¼Œä¸€æ—¦è¢«é€šçŸ¥äº†ä¹‹åï¼Œå°± ok äº†ï¼Œè‡ªå·±å°±è·å–åˆ°äº†é”ï¼Œå°±å¯ä»¥æ‰§è¡Œä»£ç äº†ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZooKeeperDistributedLock</span> <span class="keyword">implements</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ZooKeeper zk;</span><br><span class="line">    <span class="keyword">private</span> String locksRoot = <span class="string">"/locks"</span>;</span><br><span class="line">    <span class="keyword">private</span> String productId;</span><br><span class="line">    <span class="keyword">private</span> String waitNode;</span><br><span class="line">    <span class="keyword">private</span> String lockNode;</span><br><span class="line">    <span class="keyword">private</span> CountDownLatch latch;</span><br><span class="line">    <span class="keyword">private</span> CountDownLatch connectedLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> sessionTimeout = <span class="number">30000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ZooKeeperDistributedLock</span><span class="params">(String productId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.productId = productId;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String address = <span class="string">"192.168.31.187:2181,192.168.31.19:2181,192.168.31.227:2181"</span>;</span><br><span class="line">            zk = <span class="keyword">new</span> ZooKeeper(address, sessionTimeout, <span class="keyword">this</span>);</span><br><span class="line">            connectedLatch.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LockException(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeeperException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LockException(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LockException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(WatchedEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (event.getState() == KeeperState.SyncConnected) &#123;</span><br><span class="line">            connectedLatch.countDown();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.latch != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.latch.countDown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">acquireDistributedLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.tryLock()) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                waitForLock(waitNode, sessionTimeout);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeeperException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LockException(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LockException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="comment">// ä¼ å…¥è¿›å»çš„locksRoot + â€œ/â€ + productId</span></span><br><span class="line">    <span class="comment">// å‡è®¾productIdä»£è¡¨äº†ä¸€ä¸ªå•†å“idï¼Œæ¯”å¦‚è¯´1</span></span><br><span class="line">    <span class="comment">// locksRoot = locks</span></span><br><span class="line">    <span class="comment">// /locks/10000000000ï¼Œ/locks/10000000001ï¼Œ/locks/10000000002</span></span><br><span class="line">            lockNode = zk.create(locksRoot + <span class="string">"/"</span> + productId, <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">0</span>], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// çœ‹çœ‹åˆšåˆ›å»ºçš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹</span></span><br><span class="line">     <span class="comment">// locksï¼š10000000000ï¼Œ10000000001ï¼Œ10000000002</span></span><br><span class="line">            List&lt;String&gt; locks = zk.getChildren(locksRoot, <span class="keyword">false</span>);</span><br><span class="line">            Collections.sort(locks);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(lockNode.equals(locksRoot+<span class="string">"/"</span>+ locks.get(<span class="number">0</span>)))&#123;</span><br><span class="line">                <span class="comment">//å¦‚æœæ˜¯æœ€å°çš„èŠ‚ç‚¹,åˆ™è¡¨ç¤ºå–å¾—é”</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å¦‚æœä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°æ¯”è‡ªå·±å°1çš„èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">int</span> previousLockIndex = -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; locks.size(); i++) &#123;</span><br><span class="line"><span class="keyword">if</span>(lockNode.equals(locksRoot + â€œ/â€ + locks.get(i))) &#123;</span><br><span class="line">             previousLockIndex = i - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">this</span>.waitNode = locks.get(previousLockIndex);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeeperException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LockException(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LockException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">waitForLock</span><span class="params">(String waitNode, <span class="keyword">long</span> waitTime)</span> <span class="keyword">throws</span> InterruptedException, KeeperException </span>&#123;</span><br><span class="line">        Stat stat = zk.exists(locksRoot + <span class="string">"/"</span> + waitNode, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (stat != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.latch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">this</span>.latch.await(waitTime, TimeUnit.MILLISECONDS);</span><br><span class="line">            <span class="keyword">this</span>.latch = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ é™¤/locks/10000000000èŠ‚ç‚¹</span></span><br><span class="line">            <span class="comment">// åˆ é™¤/locks/10000000001èŠ‚ç‚¹</span></span><br><span class="line">            System.out.println(<span class="string">"unlock "</span> + lockNode);</span><br><span class="line">            zk.delete(lockNode, -<span class="number">1</span>);</span><br><span class="line">            lockNode = <span class="keyword">null</span>;</span><br><span class="line">            zk.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeeperException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">LockException</span><span class="params">(String e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">LockException</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="43-å°ç»“"><a class="markdownIt-Anchor" href="#43-å°ç»“"></a> 4.3. å°ç»“</h3><p>ZooKeeper ç‰ˆæœ¬çš„åˆ†å¸ƒå¼é”é—®é¢˜ç›¸å¯¹æ¯”è¾ƒæ¥è¯´å°‘ã€‚</p><ul><li>é”çš„å ç”¨æ—¶é—´é™åˆ¶ï¼šredis å°±æœ‰å ç”¨æ—¶é—´é™åˆ¶ï¼Œè€Œ ZooKeeper åˆ™æ²¡æœ‰ï¼Œæœ€ä¸»è¦çš„åŸå› æ˜¯ redis ç›®å‰æ²¡æœ‰åŠæ³•çŸ¥é“å·²ç»è·å–é”çš„å®¢æˆ·ç«¯çš„çŠ¶æ€ï¼Œæ˜¯å·²ç»æŒ‚äº†å‘¢è¿˜æ˜¯æ­£åœ¨æ‰§è¡Œè€—æ—¶è¾ƒé•¿çš„ä¸šåŠ¡é€»è¾‘ã€‚è€Œ ZooKeeper é€šè¿‡ä¸´æ—¶èŠ‚ç‚¹å°±èƒ½æ¸…æ™°çŸ¥é“ï¼Œå¦‚æœä¸´æ—¶èŠ‚ç‚¹å­˜åœ¨è¯´æ˜è¿˜åœ¨æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœä¸´æ—¶èŠ‚ç‚¹ä¸å­˜åœ¨è¯´æ˜å·²ç»æ‰§è¡Œå®Œæ¯•é‡Šæ”¾é”æˆ–è€…æ˜¯æŒ‚äº†ã€‚ç”±æ­¤çœ‹æ¥ redis å¦‚æœèƒ½åƒ ZooKeeper ä¸€æ ·æ·»åŠ ä¸€äº›ä¸å®¢æˆ·ç«¯ç»‘å®šçš„ä¸´æ—¶é”®ï¼Œä¹Ÿæ˜¯ä¸€å¤§å¥½äº‹ã€‚</li><li>æ˜¯å¦å•ç‚¹æ•…éšœï¼šredis æœ¬èº«æœ‰å¾ˆå¤šä¸­ç©æ³•ï¼Œå¦‚å®¢æˆ·ç«¯ä¸€è‡´æ€§ hashï¼ŒæœåŠ¡å™¨ç«¯ sentinel æ–¹æ¡ˆæˆ–è€… cluster æ–¹æ¡ˆï¼Œå¾ˆéš¾åšåˆ°ä¸€ç§åˆ†å¸ƒå¼é”æ–¹å¼èƒ½åº”å¯¹æ‰€æœ‰è¿™äº›æ–¹æ¡ˆã€‚è€Œ ZooKeeper åªæœ‰ä¸€ç§ç©æ³•ï¼Œå¤šå°æœºå™¨çš„èŠ‚ç‚¹æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œæ²¡æœ‰ redis çš„é‚£ä¹ˆå¤šçš„éº»çƒ¦å› ç´ è¦è€ƒè™‘ã€‚</li></ul><p>æ€»ä½“ä¸Šæ¥è¯´ ZooKeeper å®ç°åˆ†å¸ƒå¼é”æ›´åŠ çš„ç®€å•ï¼Œå¯é æ€§æ›´é«˜ã€‚ä½† ZooKeeper å› ä¸ºéœ€è¦é¢‘ç¹çš„åˆ›å»ºå’Œåˆ é™¤èŠ‚ç‚¹ï¼Œæ€§èƒ½ä¸Šä¸å¦‚ Redis æ–¹å¼ã€‚</p><h2 id="5-åˆ†å¸ƒå¼é”æ–¹æ¡ˆå¯¹æ¯”"><a class="markdownIt-Anchor" href="#5-åˆ†å¸ƒå¼é”æ–¹æ¡ˆå¯¹æ¯”"></a> 5. åˆ†å¸ƒå¼é”æ–¹æ¡ˆå¯¹æ¯”</h2><ul><li><p>æ•°æ®åº“åˆ†å¸ƒå¼é”ï¼Œé—®é¢˜æ¯”è¾ƒå¤šï¼Œè§£å†³èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä¸æ¨è</p></li><li><p>redis åˆ†å¸ƒå¼é”ï¼Œå…¶å®<strong>éœ€è¦è‡ªå·±ä¸æ–­å»å°è¯•è·å–é”</strong>ï¼Œæ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚</p></li><li><p>zk åˆ†å¸ƒå¼é”ï¼Œè·å–ä¸åˆ°é”ï¼Œæ³¨å†Œä¸ªç›‘å¬å™¨å³å¯ï¼Œä¸éœ€è¦ä¸æ–­ä¸»åŠ¨å°è¯•è·å–é”ï¼Œæ€§èƒ½å¼€é”€è¾ƒå°ã€‚</p></li></ul><p>å¦å¤–ä¸€ç‚¹å°±æ˜¯ï¼Œå¦‚æœæ˜¯ redis è·å–é”çš„é‚£ä¸ªå®¢æˆ·ç«¯å‡ºç° bug æŒ‚äº†ï¼Œé‚£ä¹ˆåªèƒ½ç­‰å¾…è¶…æ—¶æ—¶é—´ä¹‹åæ‰èƒ½é‡Šæ”¾é”ï¼›è€Œ zk çš„è¯ï¼Œå› ä¸ºåˆ›å»ºçš„æ˜¯ä¸´æ—¶ znodeï¼Œåªè¦å®¢æˆ·ç«¯æŒ‚äº†ï¼Œznode å°±æ²¡äº†ï¼Œæ­¤æ—¶å°±è‡ªåŠ¨é‡Šæ”¾é”ã€‚</p><p>æ€»ä½“ä¸Šæ¥è¯´ï¼ŒZooKeeper å®ç°åˆ†å¸ƒå¼é”æ›´åŠ çš„ç®€å•ï¼Œå¯é æ€§æ›´é«˜ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://juejin.im/post/5a20cd8bf265da43163cdd9a" target="_blank" rel="noopener">åˆ†å¸ƒå¼é”å®ç°æ±‡æ€»</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;åˆ†å¸ƒå¼é”åŸºæœ¬åŸç†&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#åˆ†å¸ƒå¼é”åŸºæœ¬åŸç†&quot;&gt;&lt;/a&gt; åˆ†å¸ƒå¼é”åŸºæœ¬åŸç†&lt;/h1&gt;
&lt;!-- TOC depthFrom:2 depthTo:3 --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-%
      
    
    </summary>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/categories/%E8%AE%BE%E8%AE%A1/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
    
      <category term="è®¾è®¡" scheme="https://dunwu.github.io/blog/tags/%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="ç³»ç»ŸåŸç†" scheme="https://dunwu.github.io/blog/tags/%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/"/>
    
      <category term="åˆ†å¸ƒå¼é”" scheme="https://dunwu.github.io/blog/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘ç»œé€šä¿¡çŸ¥è¯†ç‚¹é¢ç»</title>
    <link href="https://dunwu.github.io/blog/communication/network-interview/"/>
    <id>https://dunwu.github.io/blog/communication/network-interview/</id>
    <published>2019-06-01T16:00:00.000Z</published>
    <updated>2020-01-16T09:48:30.640Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç½‘ç»œé€šä¿¡çŸ¥è¯†ç‚¹é¢ç»"><a class="markdownIt-Anchor" href="#ç½‘ç»œé€šä¿¡çŸ¥è¯†ç‚¹é¢ç»"></a> ç½‘ç»œé€šä¿¡çŸ¥è¯†ç‚¹é¢ç»</h1><!-- TOC depthFrom:2 depthTo:4 --><ul><li><a href="#1-%E7%BB%BC%E5%90%88">1. ç»¼åˆ</a><ul><li><a href="#11-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%A6%82%E4%BD%95%E5%88%86%E5%B1%82">1.1. è®¡ç®—æœºç½‘ç»œå¦‚ä½•åˆ†å±‚ï¼Ÿ</a></li></ul></li><li><a href="#2-http">2. HTTP</a></li><li><a href="#3-dns">3. DNS</a></li><li><a href="#4-tcpudp">4. TCP/UDP</a><ul><li><a href="#41-%E4%BB%80%E4%B9%88%E6%98%AF-tcp">4.1. ä»€ä¹ˆæ˜¯ TCPï¼Ÿ</a></li><li><a href="#42-tcp-%E7%9A%84%E7%89%B9%E6%80%A7%E6%98%AF%E4%BB%80%E4%B9%88">4.2. TCP çš„ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li><a href="#43-tcp-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B">4.3. TCP ä¸‰æ¬¡æ¡æ‰‹</a></li><li><a href="#44-tcp-%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B">4.4. TCP å››æ¬¡æŒ¥æ‰‹</a></li><li><a href="#45-tcp-%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3">4.5. TCP æ»‘åŠ¨çª—å£</a></li><li><a href="#46-tcp-%E9%87%8D%E4%BC%A0%E6%9C%BA%E5%88%B6">4.6. TCP é‡ä¼ æœºåˆ¶</a></li></ul></li></ul><!-- /TOC --><h2 id="1-ç»¼åˆ"><a class="markdownIt-Anchor" href="#1-ç»¼åˆ"></a> 1. ç»¼åˆ</h2><h3 id="11-è®¡ç®—æœºç½‘ç»œå¦‚ä½•åˆ†å±‚"><a class="markdownIt-Anchor" href="#11-è®¡ç®—æœºç½‘ç»œå¦‚ä½•åˆ†å±‚"></a> 1.1. è®¡ç®—æœºç½‘ç»œå¦‚ä½•åˆ†å±‚ï¼Ÿ</h3><blockquote><p>â“ é—®é¢˜ï¼šè®¡ç®—æœºç½‘ç»œå¦‚ä½•åˆ†å±‚ï¼Ÿå„å±‚çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå„å±‚çš„ä¸»è¦åè®®ã€è®¾å¤‡åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>è¿™æ˜¯å­¦ä¹ è®¡ç®—æœºç½‘ç»œçŸ¥è¯†å®è§‚å±‚é¢å¿…é¡»è¦äº†è§£çš„æ ¸å¿ƒç‚¹ã€‚çŸ¥é“äº†è¿™äº›ï¼Œå¯¹äºç½‘ç»œçš„ä½“ç³»ç»“æ„å°±åŸºæœ¬ä¸Šäº†è§£äº†ã€‚</p></blockquote><div align="center"><img src="http://dunwu.test.upcdn.net/cs/network/overview/network-layers.png!zp"/></div><p>è®¡ç®—æœºç½‘ç»œåˆ†å±‚ä¸€èˆ¬æœ‰ä¸‰ç§åˆ’åˆ†ä½“ç³»ï¼šOSI åˆ†å±‚ï¼›äº”å±‚åè®®åˆ†å±‚ï¼›TCP/IP åè®®åˆ†å±‚ã€‚</p><ul><li>OSI çš„ä¸ƒå±‚ä½“ç³»ç»“æ„æ¦‚å¿µæ¸…æ¥šï¼Œç†è®ºå®Œæ•´ï¼Œä½†æ˜¯æ¯”è¾ƒå¤æ‚ä¸”ä¸å®ç”¨ï¼Œæ‰€ä»¥å¹¶ä¸æµè¡Œã€‚</li><li>äº”å±‚åè®®åˆ†å±‚æ˜¯ä¸€ç§æŠ˜ä¸­æ–¹æ¡ˆï¼Œåœ¨ç°å®ä¸­æ›´ä¸ºæµè¡Œã€‚</li></ul><div align="center"><img src="http://dunwu.test.upcdn.net/cs/network/overview/ç½‘ç»œåˆ†å±‚æ¶æ„å›¾.png!zp"/></div><p><strong>ç‰©ç†å±‚</strong></p><blockquote><p>ç‰©ç†å±‚ï¼ˆPhysical Layerï¼‰åªæ¥æ”¶å’Œå‘é€ä¸€ä¸²æ¯”ç‰¹(bit)æµï¼Œä¸è€ƒè™‘ä¿¡æ¯çš„æ„ä¹‰å’Œä¿¡æ¯ç»“æ„ã€‚</p><p>æ‰©å±•é˜…è¯»ï¼š<a href="network-physical.md">è®¡ç®—æœºç½‘ç»œä¹‹ç‰©ç†å±‚</a></p></blockquote><ul><li>å…³é”®è¯ï¼šè°ƒåˆ¶ã€è§£è°ƒã€æ•°å­—ä¿¡å·ã€æ¨¡æ‹Ÿä¿¡å·ã€é€šä¿¡åª’ä»‹ã€ä¿¡é“å¤ç”¨</li><li>æ•°æ®å•å…ƒï¼šæ¯”ç‰¹æµã€‚</li><li>å…¸å‹è®¾å¤‡ï¼šå…‰çº¤ã€åŒè½´ç”µç¼†ã€åŒç»çº¿ã€ä¸­ç»§å™¨å’Œé›†çº¿å™¨ã€‚</li></ul><p><strong>æ•°æ®é“¾è·¯å±‚</strong></p><blockquote><p>ç½‘ç»œå±‚é’ˆå¯¹çš„è¿˜æ˜¯ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œè€Œä¸»æœºä¹‹é—´å¯ä»¥æœ‰å¾ˆå¤šé“¾è·¯ï¼Œæ•°æ®é“¾è·¯å±‚ï¼ˆData Link Layerï¼‰å°±æ˜¯ä¸ºåŒä¸€é“¾è·¯çš„ä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚æ•°æ®é“¾è·¯å±‚æŠŠç½‘ç»œå±‚ä¼ ä¸‹æ¥çš„åˆ†ç»„å°è£…æˆå¸§ã€‚</p><p>æ‰©å±•é˜…è¯»ï¼š<a href="network-data-link.md">è®¡ç®—æœºç½‘ç»œä¹‹æ•°æ®é“¾è·¯å±‚</a></p></blockquote><ul><li>å…³é”®è¯ï¼šç‚¹å¯¹ç‚¹ä¿¡é“ã€å¹¿æ’­ä¿¡é“ã€<code>PPP</code>ã€<code>CSMA/CD</code>ã€å±€åŸŸç½‘ã€ä»¥å¤ªç½‘ã€<code>MAC</code>ã€é€‚é…å™¨ã€é›†çº¿å™¨ã€ç½‘æ¡¥ã€äº¤æ¢æœº</li><li>ä¸»è¦åè®®ï¼š<code>PPP</code>ã€<code>CSMA/CD</code> ç­‰ã€‚</li><li>æ•°æ®å•å…ƒï¼šå¸§ï¼ˆframeï¼‰ã€‚</li><li>å…¸å‹è®¾å¤‡ï¼šäºŒå±‚äº¤æ¢æœºã€ç½‘æ¡¥ã€ç½‘å¡ã€‚</li></ul><p><strong>ç½‘ç»œå±‚</strong></p><blockquote><p>ç½‘ç»œå±‚ï¼ˆnetwork layerï¼‰ä¸ºåˆ†ç»„äº¤æ¢ç½‘ä¸Šçš„ä¸åŒä¸»æœºæä¾›é€šä¿¡æœåŠ¡ã€‚åœ¨å‘é€æ•°æ®æ—¶ï¼Œç½‘ç»œå±‚æŠŠè¿è¾“å±‚äº§ç”Ÿçš„æŠ¥æ–‡æ®µæˆ–ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„æˆ–åŒ…è¿›è¡Œä¼ é€ã€‚</p><p>æ‰©å±•é˜…è¯»ï¼š<a href="network-network.md">è®¡ç®—æœºç½‘ç»œä¹‹ç½‘ç»œå±‚</a></p></blockquote><ul><li>å…³é”®è¯ï¼š<code>IP</code>ã€<code>ICMP</code>ã€<code>ARP</code>ã€è·¯ç”±</li><li>ä¸»è¦åè®®ï¼š<code>IP</code>ã€‚</li><li>æ•°æ®å•å…ƒï¼šIP æ•°æ®æŠ¥ï¼ˆpacketï¼‰ã€‚</li><li>å…¸å‹è®¾å¤‡ï¼šç½‘å…³ã€è·¯ç”±å™¨ã€‚</li></ul><p><strong>ä¼ è¾“å±‚</strong></p><blockquote><p>ä¼ è¾“å±‚ï¼ˆtransport layerï¼‰ä¸ºä¸¤å°ä¸»æœºä¸­è¿›ç¨‹é—´çš„é€šä¿¡æä¾›é€šç”¨çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚</p><p>æ‰©å±•é˜…è¯»ï¼š<a href="network-network.md">è®¡ç®—æœºç½‘ç»œä¹‹ç½‘ç»œå±‚</a></p></blockquote><ul><li>å…³é”®è¯ï¼š<code>UDP</code>ã€<code>TCP</code>ã€æ»‘åŠ¨çª—å£ã€æ‹¥å¡æ§åˆ¶ã€ä¸‰æ¬¡æ¡æ‰‹</li><li>ä¸»è¦åè®®ï¼š<code>TCP</code>ã€<code>UDP</code>ã€‚</li><li>æ•°æ®å•å…ƒï¼šæŠ¥æ–‡æ®µï¼ˆsegmentï¼‰æˆ–ç”¨æˆ·æ•°æ®æŠ¥ã€‚</li></ul><p><sub>~**ä¼šè¯å±‚**~</sub></p><blockquote><p>~~ä¼šè¯å±‚ï¼ˆSession Layerï¼‰ä¸å‚ä¸å…·ä½“çš„ä¼ è¾“ï¼Œå®ƒæä¾›åŒ…æ‹¬è®¿é—®éªŒè¯å’Œä¼šè¯ç®¡ç†åœ¨å†…çš„å»ºç«‹å’Œç»´æŠ¤åº”ç”¨ä¹‹é—´é€šä¿¡çš„æœºåˆ¶ã€‚~~</p></blockquote><p><sub>~**è¡¨ç¤ºå±‚**~</sub></p><blockquote><p>~~è¡¨ç¤ºå±‚ï¼ˆPresentation Layerï¼‰æ˜¯ä¸ºåœ¨åº”ç”¨è¿‡ç¨‹ä¹‹é—´ä¼ é€çš„ä¿¡æ¯æä¾›è¡¨ç¤ºæ–¹æ³•çš„æœåŠ¡ï¼Œå®ƒå…³å¿ƒçš„åªæ˜¯å‘å‡ºä¿¡æ¯çš„è¯­æ³•ä¸è¯­ä¹‰ã€‚è¡¨ç¤ºå±‚è¦å®ŒæˆæŸäº›ç‰¹å®šçš„åŠŸèƒ½ï¼Œä¸»è¦æœ‰ä¸åŒæ•°æ®ç¼–ç æ ¼å¼çš„è½¬æ¢ï¼Œæä¾›æ•°æ®å‹ç¼©ã€è§£å‹ç¼©æœåŠ¡ï¼Œå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€è§£å¯†ã€‚~~</p></blockquote><p><strong>åº”ç”¨å±‚</strong></p><blockquote><p>åº”ç”¨å±‚ï¼ˆapplication layerï¼‰é€šè¿‡åº”ç”¨è¿›ç¨‹é—´çš„äº¤äº’æ¥å®Œæˆç‰¹å®šç½‘ç»œåº”ç”¨ã€‚åº”ç”¨å±‚åè®®å®šä¹‰çš„æ˜¯åº”ç”¨è¿›ç¨‹é—´é€šä¿¡å’Œäº¤äº’çš„è§„åˆ™ã€‚</p><p>æ‰©å±•é˜…è¯»ï¼š<a href="network-application.md">è®¡ç®—æœºç½‘ç»œä¹‹åº”ç”¨å±‚</a></p></blockquote><ul><li>å…³é”®è¯ï¼š<code>HTTP</code>ã€<code>DNS</code>ã€<code>FTP</code>ã€<code>TELNET</code>ã€<code>DHCP</code></li><li>ä¸»è¦åè®®ï¼š<code>HTTP</code>ã€<code>DNS</code>ã€<code>SMTP</code>ã€<code>Telnet</code>ã€<code>FTP</code>ã€<code>SNMP</code> ç­‰ã€‚</li><li>æ•°æ®å•å…ƒï¼šæŠ¥æ–‡ï¼ˆmessageï¼‰ã€‚</li></ul><h2 id="2-http"><a class="markdownIt-Anchor" href="#2-http"></a> 2. HTTP</h2><blockquote><p>æ‰©å±•é˜…è¯»ï¼š<a href="http.md">è¶…æ–‡æœ¬ä¼ è¾“åè®® HTTP</a></p></blockquote><h2 id="3-dns"><a class="markdownIt-Anchor" href="#3-dns"></a> 3. DNS</h2><blockquote><p>æ‰©å±•é˜…è¯»ï¼š<a href="dns.md">åŸŸåç³»ç»Ÿ DNS</a></p></blockquote><h2 id="4-tcpudp"><a class="markdownIt-Anchor" href="#4-tcpudp"></a> 4. TCP/UDP</h2><blockquote><p>æ‰©å±•é˜…è¯»ï¼š<a href="tcp.md">ä¼ è¾“æ§åˆ¶åè®® TCP</a>ï¼Œ<a href="udp.md">ç”¨æˆ·æ•°æ®æŠ¥åè®® UDP</a></p></blockquote><h3 id="41-ä»€ä¹ˆæ˜¯-tcp"><a class="markdownIt-Anchor" href="#41-ä»€ä¹ˆæ˜¯-tcp"></a> 4.1. ä»€ä¹ˆæ˜¯ TCPï¼Ÿ</h3><p><strong>TCPï¼ˆTransmission Control Protocolï¼‰ï¼Œå³ä¼ è¾“æ§åˆ¶åè®®ï¼Œå®ƒæ˜¯ä¸€ç§<code>é¢å‘è¿æ¥çš„</code>ã€<code>å¯é çš„</code>ã€<code>åŸºäºå­—èŠ‚æµçš„</code>ä¼ è¾“å±‚é€šä¿¡åè®®</strong>ã€‚</p><h3 id="42-tcp-çš„ç‰¹æ€§æ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#42-tcp-çš„ç‰¹æ€§æ˜¯ä»€ä¹ˆ"></a> 4.2. TCP çš„ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><code>é¢å‘è¿æ¥çš„</code> - é¢å‘è¿æ¥æ˜¯æŒ‡ TCP éœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹åŸåˆ™å»ºç«‹å’Œæ–­å¼€åŒå‘è¿æ¥ã€‚</li><li><code>å¯é çš„</code> - å¯é æ˜¯æŒ‡ TCP ä¼ è¾“çš„æ•°æ®åŒ…ä¿è¯ä»¥åŸå§‹é¡ºåºåˆ°è¾¾ç›®çš„åœ°ï¼Œä¸”æ•°æ®åŒ…ä¸è¢«æŸåã€‚ä¸ºäº†å®ç°è¿™ç‚¹ï¼ŒTCP é€šè¿‡ä»¥ä¸‹æŠ€æœ¯æ¥ä¿è¯ï¼š<ul><li>æ•°æ®åŒ…çš„åºåˆ—å·å’Œæ ¡éªŒç </li><li>ç¡®è®¤åŒ…å’Œè‡ªåŠ¨é‡ä¼ <ul><li>å¦‚æœå‘é€è€…æ²¡æœ‰æ”¶åˆ°æ­£ç¡®çš„å“åº”ï¼Œå®ƒå°†é‡æ–°å‘é€æ•°æ®åŒ…ã€‚å¦‚æœå¤šæ¬¡è¶…æ—¶ï¼Œè¿æ¥å°±ä¼šæ–­å¼€ã€‚</li><li>TCP å®è¡Œæµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ã€‚è¿™äº›ç¡®ä¿æªæ–½ä¼šå¯¼è‡´å»¶è¿Ÿï¼Œè€Œä¸”é€šå¸¸å¯¼è‡´ä¼ è¾“æ•ˆç‡æ¯” UDP ä½ã€‚</li></ul></li></ul></li><li><code>åŸºäºå­—èŠ‚æµçš„</code><ul><li>è™½ç„¶åº”ç”¨ç¨‹åºå’Œ TCP çš„äº¤äº’æ˜¯ä¸€æ¬¡ä¸€ä¸ªæ•°æ®å—ï¼ˆå¤§å°ä¸ç­‰ï¼‰ï¼Œä½† TCP æŠŠåº”ç”¨ç¨‹åºçœ‹æˆæ˜¯ä¸€è¿ä¸²çš„æ— ç»“æ„çš„å­—èŠ‚æµã€‚TCP æœ‰ä¸€ä¸ªç¼“å†²ï¼Œå½“åº”ç”¨ç¨‹åºä¼ é€çš„æ•°æ®å—å¤ªé•¿ï¼ŒTCP å°±å¯ä»¥æŠŠå®ƒåˆ’åˆ†çŸ­ä¸€äº›å†ä¼ é€ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸€æ¬¡åªå‘é€ä¸€ä¸ªå­—èŠ‚ï¼ŒTCP ä¹Ÿå¯ä»¥ç­‰å¾…ç§¯ç´¯æœ‰è¶³å¤Ÿå¤šçš„å­—èŠ‚åå†æ„æˆæŠ¥æ–‡æ®µå‘é€å‡ºå»ã€‚</li><li>åœ¨ TCP å»ºç«‹è¿æ¥å‰ä¸¤æ¬¡æ¡æ‰‹çš„ SYN æŠ¥æ–‡ä¸­é€‰é¡¹å­—æ®µçš„ MSS å€¼ï¼Œé€šä¿¡åŒæ–¹å•†å®šé€šä¿¡çš„æœ€å¤§æŠ¥æ–‡é•¿åº¦ã€‚å¦‚æœåº”ç”¨å±‚äº¤ä»˜ä¸‹æ¥çš„æ•°æ®è¿‡å¤§ï¼Œå°±ä¼šå¯¹æ•°æ®åˆ†æ®µï¼Œç„¶åå‘é€ï¼›å¦åˆ™é€šè¿‡æ»‘åŠ¨çª—å£æ¥æ§åˆ¶é€šä¿¡åŒå‘çš„æ•°æ®ã€‚</li></ul></li></ul><h3 id="43-tcp-ä¸‰æ¬¡æ¡æ‰‹"><a class="markdownIt-Anchor" href="#43-tcp-ä¸‰æ¬¡æ¡æ‰‹"></a> 4.3. TCP ä¸‰æ¬¡æ¡æ‰‹</h3><blockquote><p>â“ é—®é¢˜ï¼šä¸‰æ¬¡æ¡æ‰‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</p></blockquote><p>ï¼ˆ1ï¼‰ä¸‰æ¬¡æ¡æ‰‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><ul><li>ä¸‰æ¬¡æ¡æ‰‹è´Ÿè´£å»ºç«‹ TCP åŒå‘è¿æ¥ã€‚</li></ul><p>ï¼ˆ2ï¼‰ä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/network/transport/ä¸‰æ¬¡æ¡æ‰‹.gif!zp"/></div><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸‰æ¬¡æ¡æ‰‹æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¸¦æœ‰ SYN æ ‡å¿—çš„æ•°æ®åŒ…ã€‚</li><li>ç¬¬äºŒæ¬¡æ¡æ‰‹ - æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€å¸¦æœ‰ SYN/ACK æ ‡å¿—çš„æ•°æ®åŒ…ã€‚</li><li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¸¦æœ‰å¸¦æœ‰ ACK æ ‡å¿—çš„æ•°æ®åŒ…ã€‚</li></ol><p>è‡³æ­¤ï¼ŒTCP ä¸‰æ¬¡æ¡æ‰‹å®Œæˆï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å·²å»ºç«‹åŒå‘è¿æ¥ã€‚</p><blockquote><p>ğŸ’¡ è¯´æ˜ï¼šSYN ä¸º synchronize çš„ç¼©å†™ï¼ŒACK ä¸º acknowledgment çš„ç¼©å†™ã€‚</p></blockquote><p>ï¼ˆ3ï¼‰ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</p><p>ä¸ºäº†ä¾¿äºè¯´æ˜ï¼Œå‡è®¾å®¢æˆ·ç«¯ä¸º A, æœåŠ¡ç«¯ä¸º Bã€‚</p><ol><li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼ŒA å‘ B å‘åŒæ­¥æ¶ˆæ¯ã€‚B æ”¶åˆ°æ¶ˆæ¯åï¼ŒB è®¤ä¸ºï¼šA å‘æ¶ˆæ¯æ²¡é—®é¢˜ï¼›B æ”¶æ¶ˆæ¯æ²¡é—®é¢˜ã€‚</li><li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ŒB å‘ A å‘åŒæ­¥æ¶ˆæ¯å’Œç¡®è®¤æ¶ˆæ¯ã€‚A æ”¶åˆ°æ¶ˆæ¯åï¼ŒA è®¤ä¸ºï¼šA å‘æ¶ˆæ¯ã€æ”¶æ¶ˆæ¯éƒ½æ²¡é—®é¢˜ï¼›B å‘æ¶ˆæ¯ã€æ”¶æ¶ˆæ¯éƒ½æ²¡é—®é¢˜ã€‚<strong>ä½†æ˜¯ï¼Œæ­¤æ—¶ B ä¸ç¡®å®šè‡ªå·±å‘æ¶ˆæ¯æ˜¯å¦æ²¡é—®é¢˜</strong>ï¼Œæ‰€ä»¥å°±éœ€è¦ç¬¬ä¸‰æ¬¡æ¡æ‰‹ã€‚</li><li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ŒA å‘ B å‘ç¡®è®¤æ¶ˆæ¯ã€‚B æ”¶åˆ°æ¶ˆæ¯åã€‚B è®¤ä¸ºï¼šB å‘æ¶ˆæ¯æ²¡é—®é¢˜ã€‚</li></ol><h3 id="44-tcp-å››æ¬¡æŒ¥æ‰‹"><a class="markdownIt-Anchor" href="#44-tcp-å››æ¬¡æŒ¥æ‰‹"></a> 4.4. TCP å››æ¬¡æŒ¥æ‰‹</h3><blockquote><p>â“ é—®é¢˜ï¼šå››æ¬¡æŒ¥æ‰‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­è¿æ¥ç¡®æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ</p></blockquote><p>ï¼ˆ1ï¼‰å››æ¬¡æŒ¥æ‰‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><ul><li>å››æ¬¡æŒ¥æ‰‹è´Ÿè´£æ–­å¼€ TCP è¿æ¥ã€‚</li></ul><p>ï¼ˆ2ï¼‰ä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ</p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå››æ¬¡æŒ¥æ‰‹æµç¨‹å¦‚ä¸‹ï¼š</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/network/transport/å››æ¬¡æŒ¥æ‰‹.gif!zp"/></div><ol><li>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ª FIN åŒ…ï¼Œç”¨æ¥å…³é—­å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„æ•°æ®ä¼ é€ã€‚</li><li>ç¬¬äºŒæ¬¡æŒ¥æ‰‹ - æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ª FIN åŒ…ï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª ACK åŒ…ï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ  1ã€‚å’Œ SYN ä¸€æ ·ï¼Œä¸€ä¸ª FIN å°†å ç”¨ä¸€ä¸ªåºå·ã€‚</li><li>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ - æœåŠ¡ç«¯å…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª FIN åŒ…ã€‚</li><li>ç¬¬å››æ¬¡æŒ¥æ‰‹ - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ ACK åŒ…ï¼Œå¹¶å°†ç¡®è®¤åºå·è®¾ç½®ä¸ºæ”¶åˆ°åºå·åŠ  1ã€‚</li></ol><p>ï¼ˆ3ï¼‰ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­è¿æ¥ç¡®æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ</p><ul><li>å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œ æœåŠ¡å™¨åœ¨ LISTEN çŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°å»ºç«‹è¿æ¥è¯·æ±‚çš„ SYN æŠ¥æ–‡åï¼ŒæŠŠ ACK å’Œ SYN æ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li><li>è€Œå…³é—­è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯¹æ–¹çš„ FIN æŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®ï¼Œè€Œè‡ªå·±ä¹Ÿæœªå¿…å…¨éƒ¨æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥å·±æ–¹å¯ä»¥ç«‹å³å…³é—­ï¼Œä¹Ÿå¯ä»¥å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹åï¼Œå†å‘é€ FIN æŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºåŒæ„ç°åœ¨å…³é—­è¿æ¥ï¼Œå› æ­¤ï¼Œå·±æ–¹ ACK å’Œ FIN ä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ï¼Œä»è€Œå¯¼è‡´å¤šäº†ä¸€æ¬¡ã€‚</li></ul><h3 id="45-tcp-æ»‘åŠ¨çª—å£"><a class="markdownIt-Anchor" href="#45-tcp-æ»‘åŠ¨çª—å£"></a> 4.5. TCP æ»‘åŠ¨çª—å£</h3><blockquote><p>â“ é—®é¢˜ï¼šä»€ä¹ˆæ˜¯æ»‘åŠ¨çª—å£ï¼Ÿæ»‘åŠ¨çª—å£åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>ä»€ä¹ˆæ˜¯æ»‘åŠ¨çª—å£ï¼Ÿ</p><p><strong>æ»‘åŠ¨çª—å£æ˜¯ TCP çš„ä¸€ç§æ§åˆ¶ç½‘ç»œæµé‡çš„æŠ€æœ¯ã€‚</strong></p><p><strong>TCP å¿…éœ€è¦è§£å†³çš„å¯é ä¼ è¾“ä»¥åŠåŒ…ä¹±åºï¼ˆreorderingï¼‰çš„é—®é¢˜</strong>ï¼Œæ‰€ä»¥ï¼ŒTCP å¿…éœ€è¦çŸ¥é“ç½‘ç»œå®é™…çš„æ•°æ®å¤„ç†å¸¦å®½æˆ–æ˜¯æ•°æ®å¤„ç†é€Ÿåº¦ï¼Œè¿™æ ·æ‰ä¸ä¼šå¼•èµ·ç½‘ç»œæ‹¥å¡ï¼Œå¯¼è‡´ä¸¢åŒ…ã€‚</p><p>TCP å¤´é‡Œæœ‰ä¸€ä¸ªå­—æ®µå« Windowï¼Œåˆå« Advertised-Windowï¼Œè¿™ä¸ªå­—æ®µæ˜¯æ¥æ”¶ç«¯å‘Šè¯‰å‘é€ç«¯è‡ªå·±è¿˜æœ‰å¤šå°‘ç¼“å†²åŒºå¯ä»¥æ¥æ”¶æ•°æ®ã€‚<strong>äºæ˜¯å‘é€ç«¯å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥æ”¶ç«¯çš„å¤„ç†èƒ½åŠ›æ¥å‘é€æ•°æ®ï¼Œè€Œä¸ä¼šå¯¼è‡´æ¥æ”¶ç«¯å¤„ç†ä¸è¿‡æ¥</strong>ã€‚</p><p>æ»‘åŠ¨çª—å£åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p><div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559265819762.png!zp"/></div><ol><li>å·²å‘é€å·²ç¡®è®¤ - æ•°æ®æµä¸­æœ€æ—©çš„å­—èŠ‚å·²ç»å‘é€å¹¶å¾—åˆ°ç¡®è®¤ã€‚è¿™äº›æ•°æ®æ˜¯ç«™åœ¨å‘é€ç«¯çš„è§’åº¦æ¥çœ‹çš„ã€‚ä¸Šå›¾ä¸­çš„ 31 ä¸ªå­—èŠ‚å·²ç»å‘é€å¹¶ç¡®è®¤ã€‚</li><li>å·²å‘é€ä½†å°šæœªç¡®è®¤ - å·²å‘é€ä½†å°šæœªå¾—åˆ°ç¡®è®¤çš„å­—èŠ‚ã€‚å‘é€æ–¹åœ¨ç¡®è®¤ä¹‹å‰ï¼Œä¸è®¤ä¸ºè¿™äº›æ•°æ®å·²ç»è¢«å¤„ç†ã€‚ä¸Šå›¾ä¸­çš„ 32 ~ 45 å­—èŠ‚ä¸ºç¬¬ 2 ç±»ã€‚</li><li>æœªå‘é€è€Œæ¥æ”¶æ–¹å·² Ready - è®¾å¤‡å°šæœªå°†æ•°æ®å‘å‡º ï¼Œä½†æ¥æ”¶æ–¹æ ¹æ®æœ€è¿‘ä¸€æ¬¡å…³äºå‘é€æ–¹ä¸€æ¬¡è¦å‘é€å¤šå°‘å­—èŠ‚ç¡®è®¤è‡ªå·±æœ‰è¶³å¤Ÿç©ºé—´ã€‚å‘é€æ–¹ä¼šç«‹å³å°è¯•å‘é€ã€‚ä¸Šå›¾ä¸­çš„ 46 ~ 51 å­—èŠ‚ä¸ºç¬¬ 3 ç±»ã€‚</li><li>æœªå‘é€è€Œæ¥æ”¶æ–¹ Not Ready - ç”±äºæ¥æ”¶æ–¹ not readyï¼Œè¿˜ä¸å…è®¸å°†è¿™éƒ¨åˆ†æ•°æ®å‘å‡ºã€‚ä¸Šå›¾ä¸­çš„ 52 ä»¥åçš„å­—èŠ‚ä¸ºç¬¬ 4 ç±»ã€‚</li></ol><div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559265927658.png!zp"/></div><p>è¿™å¼ å›¾ç‰‡ç›¸å¯¹äºä¸Šä¸€å¼ å›¾ç‰‡ï¼Œæ»‘åŠ¨çª—å£åç§»äº† 5 ä¸ªå­—èŠ‚ï¼Œæ„å‘³ç€æœ‰ 5 ä¸ªå·²å‘é€çš„å­—èŠ‚å¾—åˆ°äº†ç¡®è®¤ã€‚</p><h3 id="46-tcp-é‡ä¼ æœºåˆ¶"><a class="markdownIt-Anchor" href="#46-tcp-é‡ä¼ æœºåˆ¶"></a> 4.6. TCP é‡ä¼ æœºåˆ¶</h3><blockquote><p>â“ é—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦é‡ä¼ æœºåˆ¶ï¼ŸTCP æœ‰å“ªäº›é‡ä¼ æœºåˆ¶ï¼ŒåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>TCP è¦ä¿è¯æ‰€æœ‰çš„æ•°æ®åŒ…éƒ½å¯ä»¥åˆ°è¾¾ï¼Œæ‰€ä»¥ï¼Œå¿…éœ€è¦æœ‰é‡ä¼ æœºåˆ¶ã€‚</p><p>TCP é‡ä¼ æœºåˆ¶ä¸»è¦æœ‰ä¸¤ç§ï¼š</p><ul><li>è¶…æ—¶é‡ä¼ æœºåˆ¶</li><li>å¿«é€Ÿé‡ä¼ æœºåˆ¶</li></ul><p>ï¼ˆ1ï¼‰è¶…æ—¶é‡ä¼ æœºåˆ¶</p><p>è¶…æ—¶é‡ä¼ æœºåˆ¶æ˜¯æŒ‡ï¼šå‘é€æ•°æ®åŒ…åœ¨ä¸€å®šçš„æ—¶é—´å‘¨æœŸå†…æ²¡æœ‰æ”¶åˆ°ç›¸åº”çš„ ACKï¼Œç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œè¶…æ—¶ä¹‹åå°±è®¤ä¸ºè¿™ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œå°±ä¼šé‡æ–°å‘é€ã€‚è¿™ä¸ªç­‰å¾…æ—¶é—´è¢«ç§°ä¸º RTO(Retransmission TimeOut)ï¼Œå³é‡ä¼ è¶…æ—¶æ—¶é—´ã€‚</p><p>æ²¡æœ‰ç¡®è®¤çš„æ•°æ®åŒ…ä¸ä¼šä»çª—å£ä¸­ç§»èµ°ï¼Œå®šæ—¶å™¨åœ¨é‡ä¼ æ—¶é—´åˆ°æœŸå†…ï¼Œæ¯ä¸ªç‰‡æ®µçš„ä½ç½®ä¸å˜ã€‚</p><p>è¿™ç§æœºåˆ¶çš„é‡ç‚¹æ˜¯ RTO çš„è®¾ç½®ï¼š</p><ul><li>RTO è®¾é•¿äº†ï¼Œé‡å‘å°±æ…¢ï¼Œä¸¢äº†è€åŠå¤©æ‰é‡å‘ï¼Œæ²¡æœ‰æ•ˆç‡ï¼Œæ€§èƒ½å·®ï¼›</li><li>RTO è®¾çŸ­äº†ï¼Œä¼šå¯¼è‡´å¯èƒ½å¹¶æ²¡æœ‰ä¸¢å°±é‡å‘ã€‚äºæ˜¯é‡å‘çš„å°±å¿«ï¼Œä¼šå¢åŠ ç½‘ç»œæ‹¥å¡ï¼Œå¯¼è‡´æ›´å¤šçš„è¶…æ—¶ï¼Œæ›´å¤šçš„è¶…æ—¶å¯¼è‡´æ›´å¤šçš„é‡å‘</li></ul><p>ï¼ˆ2ï¼‰å¿«é€Ÿé‡ä¼ æœºåˆ¶</p><p>å¿«é€Ÿé‡ä¼ æœºåˆ¶ï¼Œå®ç°äº†å¦å¤–çš„ä¸€ç§ä¸¢åŒ…è¯„å®šæ ‡å‡†ï¼Œå³å¦‚æœè¿ç»­æ”¶åˆ° 3 æ¬¡é‡å¤ ACKï¼Œå‘é€æ–¹å°±è®¤ä¸ºè¿™ä¸ª seq çš„åŒ…ä¸¢å¤±äº†ï¼Œç«‹åˆ»è¿›è¡Œé‡ä¼ ã€‚</p><p>å½“æ¥æ”¶æ–¹æ”¶åˆ°ä¹±åºç‰‡æ®µæ—¶ï¼Œéœ€è¦é‡å¤å‘é€ ACKã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ç½‘ç»œé€šä¿¡çŸ¥è¯†ç‚¹é¢ç»&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#ç½‘ç»œé€šä¿¡çŸ¥è¯†ç‚¹é¢ç»&quot;&gt;&lt;/a&gt; ç½‘ç»œé€šä¿¡çŸ¥è¯†ç‚¹é¢ç»&lt;/h1&gt;
&lt;!-- TOC depthFrom:2 depthTo:4 --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#
      
    
    </summary>
    
    
      <category term="é€šä¿¡" scheme="https://dunwu.github.io/blog/categories/%E9%80%9A%E4%BF%A1/"/>
    
    
      <category term="é€šä¿¡" scheme="https://dunwu.github.io/blog/tags/%E9%80%9A%E4%BF%A1/"/>
    
      <category term="ç½‘ç»œ" scheme="https://dunwu.github.io/blog/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="application" scheme="https://dunwu.github.io/blog/tags/application/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘ç»œåè®®ä¹‹ UDP</title>
    <link href="https://dunwu.github.io/blog/communication/udp/"/>
    <id>https://dunwu.github.io/blog/communication/udp/</id>
    <published>2019-05-31T03:51:00.000Z</published>
    <updated>2020-01-16T09:48:30.647Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h2><div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559263939493.png!zp"/></div><p>UDP æ˜¯æ— è¿æ¥çš„ã€‚æ•°æ®æŠ¥ï¼ˆç±»ä¼¼äºæ•°æ®åŒ…ï¼‰åªåœ¨æ•°æ®æŠ¥çº§åˆ«æœ‰ä¿è¯ã€‚æ•°æ®æŠ¥å¯èƒ½ä¼šæ— åºçš„åˆ°è¾¾ç›®çš„åœ°ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šé—å¤±ã€‚UDP ä¸æ”¯æŒæ‹¥å¡æ§åˆ¶ã€‚è™½ç„¶ä¸å¦‚ TCP é‚£æ ·æœ‰ä¿è¯ï¼Œä½† UDP é€šå¸¸æ•ˆç‡æ›´é«˜ã€‚</p><p>UDP å¯ä»¥é€šè¿‡å¹¿æ’­å°†æ•°æ®æŠ¥å‘é€è‡³å­ç½‘å†…çš„æ‰€æœ‰è®¾å¤‡ã€‚è¿™å¯¹ <a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol" target="_blank" rel="noopener">DHCP</a> å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå­ç½‘å†…çš„è®¾å¤‡è¿˜æ²¡æœ‰åˆ†é… IP åœ°å€ï¼Œè€Œ IP å¯¹äº TCP æ˜¯å¿…é¡»çš„ã€‚</p><p>UDP å¯é æ€§æ›´ä½ä½†é€‚åˆç”¨åœ¨ç½‘ç»œç”µè¯ã€è§†é¢‘èŠå¤©ï¼Œæµåª’ä½“å’Œå®æ—¶å¤šäººæ¸¸æˆä¸Šã€‚</p><p>ä»¥ä¸‹æƒ…å†µä½¿ç”¨ UDP ä»£æ›¿ TCPï¼š</p><ul><li>ä½ éœ€è¦ä½å»¶è¿Ÿ</li><li>ç›¸å¯¹äºæ•°æ®ä¸¢å¤±æ›´ç³Ÿçš„æ˜¯æ•°æ®å»¶è¿Ÿ</li><li>ä½ æƒ³å®ç°è‡ªå·±çš„é”™è¯¯æ ¡æ­£æ–¹æ³•</li></ul><h3 id="udp-ç‰¹ç‚¹"><a class="markdownIt-Anchor" href="#udp-ç‰¹ç‚¹"></a> UDP ç‰¹ç‚¹</h3><ol><li><strong>æ— è¿æ¥çš„</strong>ï¼Œå³å‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå› æ­¤å‡å°‘äº†å¼€é”€å’Œå‘é€æ•°æ®ä¹‹å‰çš„æ—¶å»¶ã€‚</li><li><strong>ä¸ä¿è¯å¯é äº¤ä»˜</strong>ï¼Œå› æ­¤ä¸»æœºä¸éœ€è¦ä¸ºæ­¤å¤æ‚çš„è¿æ¥çŠ¶æ€è¡¨</li><li><strong>é¢å‘æŠ¥æ–‡çš„</strong>ï¼Œæ„æ€æ˜¯ UDP å¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå‘ä¸‹äº¤ç»™ IP å±‚ã€‚</li><li><strong>æ²¡æœ‰é˜»å¡æ§åˆ¶</strong>ï¼Œå› æ­¤ç½‘ç»œå‡ºç°çš„æ‹¥å¡ä¸ä¼šä½¿å‘é€æ–¹çš„å‘é€é€Ÿç‡é™ä½ã€‚</li><li><strong>æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡</strong>ï¼Œä¹Ÿå³æ˜¯æä¾›å¹¿æ’­å’Œå¤šæ’­çš„åŠŸèƒ½ã€‚</li><li><strong>é¦–éƒ¨å¼€é”€å°</strong>ï¼Œé¦–éƒ¨åªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œåˆ†ä¸ºå››éƒ¨åˆ†ã€‚</li></ol><h3 id="udp-åº”ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#udp-åº”ç”¨åœºæ™¯"></a> UDP åº”ç”¨åœºæ™¯</h3><ol><li>åå­—è½¬æ¢ï¼ˆDNSï¼‰</li><li>æ–‡ä»¶ä¼ é€ï¼ˆTFTPï¼‰</li><li>è·¯ç”±é€‰æ‹©åè®®ï¼ˆRIPï¼‰</li><li>IP åœ°å€é…ç½®ï¼ˆBOOTPï¼ŒDHTPï¼‰</li><li>ç½‘ç»œç®¡ç†ï¼ˆSNMPï¼‰</li><li>è¿œç¨‹æ–‡ä»¶æœåŠ¡ï¼ˆNFSï¼‰</li><li>IP ç”µè¯</li><li>æµå¼å¤šåª’ä½“é€šä¿¡</li></ol><h2 id="udp-æŠ¥æ–‡"><a class="markdownIt-Anchor" href="#udp-æŠ¥æ–‡"></a> UDP æŠ¥æ–‡</h2><p>UDP æ•°æ®æŠ¥åˆ†ä¸ºæ•°æ®å­—æ®µå’Œé¦–éƒ¨å­—æ®µã€‚<br />é¦–éƒ¨å­—æ®µåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œç”±å››ä¸ªå­—æ®µç»„æˆï¼Œæ¯ä¸ªå­—æ®µçš„é•¿åº¦æ˜¯ 2 ä¸ªå­—èŠ‚ã€‚</p><p><strong>é¦–éƒ¨å„å­—æ®µæ„ä¹‰</strong>ï¼š</p><ol><li><strong>æºç«¯å£</strong>ï¼šæºç«¯å£å·ï¼Œåœ¨éœ€è¦å¯¹æ–¹å›ä¿¡æ—¶é€‰ç”¨ï¼Œä¸éœ€è¦æ—¶å¯å…¨ 0.</li><li><strong>ç›®çš„ç«¯å£</strong>ï¼šç›®çš„ç«¯å£å·ï¼Œåœ¨ç»ˆç‚¹äº¤ä»˜æŠ¥æ–‡æ—¶å¿…é¡»è¦ä½¿ç”¨åˆ°ã€‚</li><li><strong>é•¿åº¦</strong>ï¼šUDP ç”¨æˆ·æ•°æ®æŠ¥çš„é•¿åº¦ï¼Œåœ¨åªæœ‰é¦–éƒ¨çš„æƒ…å†µï¼Œå…¶æœ€å°å€¼æ˜¯ 8 ã€‚</li><li><strong>æ£€éªŒå’Œ</strong>ï¼šæ£€æµ‹ UDP ç”¨æˆ·æ•°æ®æŠ¥åœ¨ä¼ è¾“ä¸­æ˜¯å¦æœ‰é”™ï¼Œæœ‰é”™å°±ä¸¢å¼ƒã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#ç®€ä»‹&quot;&gt;&lt;/a&gt; ç®€ä»‹&lt;/h2&gt;
&lt;div align=&quot;center&quot;&gt;&lt;img src=&quot;http://dunwu.test.upcdn.net/snap/155926393949
      
    
    </summary>
    
    
      <category term="é€šä¿¡" scheme="https://dunwu.github.io/blog/categories/%E9%80%9A%E4%BF%A1/"/>
    
    
      <category term="é€šä¿¡" scheme="https://dunwu.github.io/blog/tags/%E9%80%9A%E4%BF%A1/"/>
    
      <category term="ç½‘ç»œ" scheme="https://dunwu.github.io/blog/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="åè®®" scheme="https://dunwu.github.io/blog/tags/%E5%8D%8F%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘ç»œåè®®ä¹‹ Websocket</title>
    <link href="https://dunwu.github.io/blog/communication/websocket/"/>
    <id>https://dunwu.github.io/blog/communication/websocket/</id>
    <published>2019-05-31T03:51:00.000Z</published>
    <updated>2020-01-19T04:32:03.171Z</updated>
    
    <content type="html"><![CDATA[<h1 id="socket-å’Œ-websocket"><a class="markdownIt-Anchor" href="#socket-å’Œ-websocket"></a> Socket å’Œ WebSocket</h1><h2 id="socket"><a class="markdownIt-Anchor" href="#socket"></a> Socket</h2><p>Socket ä½œä¸ºä¸€ç§æŠ½è±¡å±‚ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡å®ƒæ¥å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œä½¿ç”¨ Socket å¯ä»¥å°†åº”ç”¨ç¨‹åºä¸å¤„äºåŒä¸€ç½‘ç»œä¸­çš„å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡äº¤äº’ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒSocket æä¾›äº†åº”ç”¨ç¨‹åºå†…éƒ¨ä¸å¤–ç•Œé€šä¿¡çš„ç«¯å£ä»¥åŠä¸ºé€šä¿¡åŒæ–¹æä¾›äº†æ•°æ®ä¼ è¾“çš„é€šé“ã€‚</p><h3 id="socket-ç”¨æ³•"><a class="markdownIt-Anchor" href="#socket-ç”¨æ³•"></a> Socket ç”¨æ³•</h3><p>å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æ”¯æŒ Socketã€‚è¿™é‡Œä»¥ Java çš„ Socket ç”¨æ³•ä¸ºä¾‹ã€‚</p><p>åœ¨ Java çš„ SDK ä¸­ï¼Œsocket çš„å…±æœ‰ä¸¤ä¸ªæ¥å£ï¼šç”¨äºç›‘å¬å®¢æˆ·è¿æ¥çš„ <code>ServerSocket</code> å’Œç”¨äºé€šä¿¡çš„ <code>Socket</code>ã€‚ä½¿ç”¨ socket çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>åˆ›å»º <code>ServerSocket</code> å¹¶ç›‘å¬å®¢æˆ·è¿æ¥</li><li>ä½¿ç”¨ <code>Socket</code> è¿æ¥æœåŠ¡ç«¯</li><li>é€šè¿‡ <code>Socket</code> è·å–è¾“å…¥è¾“å‡ºæµè¿›è¡Œé€šä¿¡</li></ul><h3 id="socket-é•¿è¿æ¥"><a class="markdownIt-Anchor" href="#socket-é•¿è¿æ¥"></a> Socket é•¿è¿æ¥</h3><p>Socket é•¿è¿æ¥ï¼ŒæŒ‡çš„æ˜¯åœ¨å®¢æˆ·å’ŒæœåŠ¡ç«¯ä¹‹é—´ä¿æŒä¸€ä¸ª socket è¿æ¥é•¿æ—¶é—´ä¸æ–­å¼€ã€‚</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">socket.set<span class="constructor">KeepAlive(<span class="params">true</span>)</span>;</span><br></pre></td></tr></table></figure><h2 id="websocket"><a class="markdownIt-Anchor" href="#websocket"></a> WebSocket</h2><h3 id="websocket-ç®€ä»‹"><a class="markdownIt-Anchor" href="#websocket-ç®€ä»‹"></a> WebSocket ç®€ä»‹</h3><h4 id="websocket-æ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#websocket-æ˜¯ä»€ä¹ˆ"></a> WebSocket æ˜¯ä»€ä¹ˆ</h4><p><a href="http://websocket.org/" target="_blank" rel="noopener">WebSocket</a> æ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡åè®®ã€‚<a href="https://tools.ietf.org/html/rfc6455" target="_blank" rel="noopener">RFC6455</a> å®šä¹‰äº†å®ƒçš„é€šä¿¡æ ‡å‡†ã€‚</p><p>WebSocket æ˜¯ HTML5 å¼€å§‹æä¾›çš„ä¸€ç§åœ¨å•ä¸ª TCP è¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šè®¯çš„åè®®ã€‚</p><h4 id="ä¸ºä»€ä¹ˆéœ€è¦-websocket"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦-websocket"></a> ä¸ºä»€ä¹ˆéœ€è¦ WebSocket</h4><p>äº†è§£è®¡ç®—æœºç½‘ç»œåè®®çš„äººï¼Œåº”è¯¥éƒ½çŸ¥é“ï¼šHTTP åè®®æ˜¯ä¸€ç§æ— çŠ¶æ€çš„ã€æ— è¿æ¥çš„ã€å•å‘çš„åº”ç”¨å±‚åè®®ã€‚å®ƒé‡‡ç”¨äº†è¯·æ±‚/å“åº”æ¨¡å‹ã€‚é€šä¿¡è¯·æ±‚åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ï¼ŒæœåŠ¡ç«¯å¯¹è¯·æ±‚åšå‡ºåº”ç­”å¤„ç†ã€‚</p><p>è¿™ç§é€šä¿¡æ¨¡å‹æœ‰ä¸€ä¸ªå¼Šç«¯ï¼šHTTP åè®®æ— æ³•å®ç°æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘èµ·æ¶ˆæ¯ã€‚</p><p>è¿™ç§å•å‘è¯·æ±‚çš„ç‰¹ç‚¹ï¼Œæ³¨å®šäº†å¦‚æœæœåŠ¡å™¨æœ‰è¿ç»­çš„çŠ¶æ€å˜åŒ–ï¼Œå®¢æˆ·ç«¯è¦è·çŸ¥å°±éå¸¸éº»çƒ¦ã€‚å¤§å¤šæ•° Web åº”ç”¨ç¨‹åºå°†é€šè¿‡é¢‘ç¹çš„å¼‚æ­¥ JavaScript å’Œ XMLï¼ˆAJAXï¼‰è¯·æ±‚å®ç°é•¿è½®è¯¢ã€‚è½®è¯¢çš„æ•ˆç‡ä½ï¼Œéå¸¸æµªè´¹èµ„æºï¼ˆå› ä¸ºå¿…é¡»ä¸åœè¿æ¥ï¼Œæˆ–è€… HTTP è¿æ¥å§‹ç»ˆæ‰“å¼€ï¼‰ã€‚</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/spring/web/ajax-long-polling.png!zp"/></div>å› æ­¤ï¼Œå·¥ç¨‹å¸ˆä»¬ä¸€ç›´åœ¨æ€è€ƒï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•ã€‚WebSocket å°±æ˜¯è¿™æ ·å‘æ˜çš„ã€‚WebSocket è¿æ¥å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå…¨åŒå·¥é€šä¿¡ï¼Œä»¥ä¾¿ä»»ä¸€æ–¹éƒ½å¯ä»¥é€šè¿‡å»ºç«‹çš„è¿æ¥å°†æ•°æ®æ¨é€åˆ°å¦ä¸€ç«¯ã€‚WebSocket åªéœ€è¦å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œå°±å¯ä»¥ä¸€ç›´ä¿æŒè¿æ¥çŠ¶æ€ã€‚è¿™ç›¸æ¯”äºè½®è¯¢æ–¹å¼çš„ä¸åœå»ºç«‹è¿æ¥æ˜¾ç„¶æ•ˆç‡è¦å¤§å¤§æé«˜ã€‚<div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/spring/web/websockets-flow.png!zp"/></div>#### WebSocket å¦‚ä½•å·¥ä½œ<p>Web æµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½å¿…é¡»å®ç° WebSockets åè®®æ¥å»ºç«‹å’Œç»´æŠ¤è¿æ¥ã€‚ç”±äº WebSockets è¿æ¥é•¿æœŸå­˜åœ¨ï¼Œä¸å…¸å‹çš„ HTTP è¿æ¥ä¸åŒï¼Œå¯¹æœåŠ¡å™¨æœ‰é‡è¦çš„å½±å“ã€‚</p><p>åŸºäºå¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹çš„æœåŠ¡å™¨æ— æ³•é€‚ç”¨äº WebSocketsï¼Œå› ä¸ºå®ƒæ—¨åœ¨æ‰“å¼€è¿æ¥ï¼Œå°½å¯èƒ½å¿«åœ°å¤„ç†è¯·æ±‚ï¼Œç„¶åå…³é—­è¿æ¥ã€‚ä»»ä½•å®é™…çš„ WebSockets æœåŠ¡å™¨ç«¯å®ç°éƒ½éœ€è¦ä¸€ä¸ªå¼‚æ­¥æœåŠ¡å™¨ã€‚</p><h3 id="websocket-ä½¿ç”¨"><a class="markdownIt-Anchor" href="#websocket-ä½¿ç”¨"></a> WebSocket ä½¿ç”¨</h3><h4 id="websocket-å®¢æˆ·ç«¯"><a class="markdownIt-Anchor" href="#websocket-å®¢æˆ·ç«¯"></a> WebSocket å®¢æˆ·ç«¯</h4><p>åœ¨å®¢æˆ·ç«¯ï¼Œæ²¡æœ‰å¿…è¦ä¸º WebSockets ä½¿ç”¨ JavaScript åº“ã€‚å®ç° WebSockets çš„ Web æµè§ˆå™¨å°†é€šè¿‡ WebSockets å¯¹è±¡å…¬å¼€æ‰€æœ‰å¿…éœ€çš„å®¢æˆ·ç«¯åŠŸèƒ½ï¼ˆä¸»è¦æŒ‡æ”¯æŒ Html5 çš„æµè§ˆå™¨ï¼‰ã€‚</p><p>ä»¥ä¸‹ API ç”¨äºåˆ›å»º WebSocket å¯¹è±¡ã€‚</p><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">var Socket = <span class="keyword">new</span> <span class="constructor">WebSocket(<span class="params">url</span>, [<span class="params">protocol</span>] )</span>;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•° url, æŒ‡å®šè¿æ¥çš„ URLã€‚ç¬¬äºŒä¸ªå‚æ•° protocol æ˜¯å¯é€‰çš„ï¼ŒæŒ‡å®šäº†å¯æ¥å—çš„å­åè®®ã€‚</p><h5 id="websocket-å±æ€§"><a class="markdownIt-Anchor" href="#websocket-å±æ€§"></a> WebSocket å±æ€§</h5><p>ä»¥ä¸‹æ˜¯ WebSocket å¯¹è±¡çš„å±æ€§ã€‚å‡å®šæˆ‘ä»¬ä½¿ç”¨äº†ä»¥ä¸Šä»£ç åˆ›å»ºäº† Socket å¯¹è±¡ï¼š</p><table><thead><tr><th>å±æ€§</th><th>æè¿°</th></tr></thead><tbody><tr><td>Socket.readyState</td><td>åªè¯»å±æ€§ <strong>readyState</strong> è¡¨ç¤ºè¿æ¥çŠ¶æ€ï¼Œå¯ä»¥æ˜¯ä»¥ä¸‹å€¼ï¼š0 - è¡¨ç¤ºè¿æ¥å°šæœªå»ºç«‹ã€‚1 - è¡¨ç¤ºè¿æ¥å·²å»ºç«‹ï¼Œå¯ä»¥è¿›è¡Œé€šä¿¡ã€‚2 - è¡¨ç¤ºè¿æ¥æ­£åœ¨è¿›è¡Œå…³é—­ã€‚3 - è¡¨ç¤ºè¿æ¥å·²ç»å…³é—­æˆ–è€…è¿æ¥ä¸èƒ½æ‰“å¼€ã€‚</td></tr><tr><td>Socket.bufferedAmount</td><td>åªè¯»å±æ€§ <strong>bufferedAmount</strong> å·²è¢« send() æ”¾å…¥æ­£åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ä¼ è¾“ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å‘å‡ºçš„ UTF-8 æ–‡æœ¬å­—èŠ‚æ•°ã€‚</td></tr></tbody></table><h5 id="websocket-äº‹ä»¶"><a class="markdownIt-Anchor" href="#websocket-äº‹ä»¶"></a> WebSocket äº‹ä»¶</h5><p>ä»¥ä¸‹æ˜¯ WebSocket å¯¹è±¡çš„ç›¸å…³äº‹ä»¶ã€‚å‡å®šæˆ‘ä»¬ä½¿ç”¨äº†ä»¥ä¸Šä»£ç åˆ›å»ºäº† Socket å¯¹è±¡ï¼š</p><table><thead><tr><th>äº‹ä»¶</th><th>äº‹ä»¶å¤„ç†ç¨‹åº</th><th>æè¿°</th></tr></thead><tbody><tr><td>open</td><td>Socket.onopen</td><td>è¿æ¥å»ºç«‹æ—¶è§¦å‘</td></tr><tr><td>message</td><td>Socket.onmessage</td><td>å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡ç«¯æ•°æ®æ—¶è§¦å‘</td></tr><tr><td>error</td><td>Socket.onerror</td><td>é€šä¿¡å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘</td></tr><tr><td>close</td><td>Socket.onclose</td><td>è¿æ¥å…³é—­æ—¶è§¦å‘</td></tr></tbody></table><h5 id="websocket-æ–¹æ³•"><a class="markdownIt-Anchor" href="#websocket-æ–¹æ³•"></a> WebSocket æ–¹æ³•</h5><p>ä»¥ä¸‹æ˜¯ WebSocket å¯¹è±¡çš„ç›¸å…³æ–¹æ³•ã€‚å‡å®šæˆ‘ä»¬ä½¿ç”¨äº†ä»¥ä¸Šä»£ç åˆ›å»ºäº† Socket å¯¹è±¡ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>Socket.send()</td><td>ä½¿ç”¨è¿æ¥å‘é€æ•°æ®</td></tr><tr><td>Socket.close()</td><td>å…³é—­è¿æ¥</td></tr></tbody></table><p>WebSocket å®¢æˆ·ç«¯ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–ä¸€ä¸ª WebSocket å¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:9998/echo'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å»ºç«‹ web socket è¿æ¥æˆåŠŸè§¦å‘äº‹ä»¶</span></span><br><span class="line">ws.onopen = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">// ä½¿ç”¨ send() æ–¹æ³•å‘é€æ•°æ®</span></span><br><span class="line">ws.send(<span class="string">'å‘é€æ•°æ®'</span>)</span><br><span class="line">alert(<span class="string">'æ•°æ®å‘é€ä¸­...'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶æœåŠ¡ç«¯æ•°æ®æ—¶è§¦å‘äº‹ä»¶</span></span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> received_msg = evt.data</span><br><span class="line">alert(<span class="string">'æ•°æ®å·²æ¥æ”¶...'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–­å¼€ web socket è¿æ¥æˆåŠŸè§¦å‘äº‹ä»¶</span></span><br><span class="line">ws.onclose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">alert(<span class="string">'è¿æ¥å·²å…³é—­...'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="websocket-æœåŠ¡ç«¯"><a class="markdownIt-Anchor" href="#websocket-æœåŠ¡ç«¯"></a> WebSocket æœåŠ¡ç«¯</h4><p>WebSocket åœ¨æœåŠ¡ç«¯çš„å®ç°éå¸¸ä¸°å¯Œã€‚Node.jsã€Javaã€C++ã€Python ç­‰å¤šç§è¯­è¨€éƒ½æœ‰è‡ªå·±çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>ä»¥ä¸‹ï¼Œä»‹ç»æˆ‘åœ¨å­¦ä¹  WebSocket è¿‡ç¨‹ä¸­æ¥è§¦è¿‡çš„ WebSocket æœåŠ¡ç«¯è§£å†³æ–¹æ¡ˆã€‚</p><h5 id="nodejs"><a class="markdownIt-Anchor" href="#nodejs"></a> Node.js</h5><p>å¸¸ç”¨çš„ Node å®ç°æœ‰ä»¥ä¸‹ä¸‰ç§ã€‚</p><ul><li><a href="https://github.com/uWebSockets/uWebSockets" target="_blank" rel="noopener">ÂµWebSockets</a></li><li><a href="http://socket.io/" target="_blank" rel="noopener">Socket.IO</a></li><li><a href="https://github.com/theturtle32/WebSocket-Node" target="_blank" rel="noopener">WebSocket-Node</a></li></ul><h5 id="java"><a class="markdownIt-Anchor" href="#java"></a> Java</h5><p>Java çš„ web ä¸€èˆ¬éƒ½ä¾æ‰˜äº servlet å®¹å™¨ã€‚</p><p>æˆ‘ä½¿ç”¨è¿‡çš„ servlet å®¹å™¨æœ‰ï¼šTomcatã€Jettyã€Resinã€‚å…¶ä¸­ Tomcat7ã€Jetty7 åŠä»¥ä¸Šç‰ˆæœ¬å‡å¼€å§‹æ”¯æŒ WebSocketï¼ˆæ¨èè¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œå› ä¸ºéšç€ç‰ˆæœ¬çš„æ›´è¿­ï¼Œå¯¹ WebSocket çš„æ”¯æŒå¯èƒ½æœ‰å˜æ›´ï¼‰ã€‚</p><p>æ­¤å¤–ï¼ŒSpring æ¡†æ¶å¯¹ WebSocket ä¹Ÿæä¾›äº†æ”¯æŒã€‚</p><p>è™½ç„¶ï¼Œä»¥ä¸Šåº”ç”¨å¯¹äº WebSocket éƒ½æœ‰å„è‡ªçš„å®ç°ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬éƒ½éµå¾ª<a href="https://tools.ietf.org/html/rfc6455" target="_blank" rel="noopener">RFC6455</a> çš„é€šä¿¡æ ‡å‡†ï¼Œå¹¶ä¸” Java API ç»Ÿä¸€éµå¾ª <a href="http://www.jcp.org/en/jsr/detail?id=356" target="_blank" rel="noopener">JSR 356 - JavaTM API for WebSocket </a> è§„èŒƒã€‚æ‰€ä»¥ï¼Œåœ¨å®é™…ç¼–ç ä¸­ï¼ŒAPI å·®å¼‚ä¸å¤§ã€‚</p><h5 id="spring"><a class="markdownIt-Anchor" href="#spring"></a> Spring</h5><p>Spring å¯¹äº WebSocket çš„æ”¯æŒåŸºäºä¸‹é¢çš„ jar åŒ…ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ Spring å®ç° WebSocket æœåŠ¡å™¨å¤§æ¦‚åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><p><strong>åˆ›å»º WebSocket å¤„ç†å™¨</strong></p><p>æ‰©å±• <code>TextWebSocketHandler</code> æˆ– <code>BinaryWebSocketHandler</code> ï¼Œä½ å¯ä»¥è¦†å†™æŒ‡å®šçš„æ–¹æ³•ã€‚Spring åœ¨æ”¶åˆ° WebSocket äº‹ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨äº‹ä»¶å¯¹åº”çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.socket.WebSocketHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.WebSocketSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.TextMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> <span class="keyword">extends</span> <span class="title">TextWebSocketHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleTextMessage</span><span class="params">(WebSocketSession session, TextMessage message)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>WebSocketHandler</code> æºç å¦‚ä¸‹ï¼Œè¿™æ„å‘³ç€ä½ çš„å¤„ç†å™¨å¤§æ¦‚å¯ä»¥å¤„ç†å“ªäº› WebSocket äº‹ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WebSocketHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å»ºç«‹è¿æ¥åè§¦å‘çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">afterConnectionEstablished</span><span class="params">(WebSocketSession session)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ”¶åˆ°æ¶ˆæ¯æ—¶è§¦å‘çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(WebSocketSession session, WebSocketMessage&lt;?&gt; message)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ä¼ è¾“æ¶ˆæ¯å‡ºé”™æ—¶è§¦å‘çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">handleTransportError</span><span class="params">(WebSocketSession session, Throwable exception)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ–­å¼€è¿æ¥åè§¦å‘çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">afterConnectionClosed</span><span class="params">(WebSocketSession session, CloseStatus closeStatus)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ˜¯å¦å¤„ç†åˆ†ç‰‡æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">boolean</span> <span class="title">supportsPartialMessages</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é…ç½® WebSocket</strong></p><p>é…ç½®æœ‰ä¸¤ç§æ–¹å¼ï¼šæ³¨è§£å’Œ xml ã€‚å…¶ä½œç”¨å°±æ˜¯å°† WebSocket å¤„ç†å™¨æ·»åŠ åˆ°æ³¨å†Œä¸­å¿ƒã€‚</p><ol><li>å®ç° <code>WebSocketConfigurer</code></li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocket</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerWebSocketHandlers</span><span class="params">(WebSocketHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addHandler(myHandler(), <span class="string">"/myHandler"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebSocketHandler <span class="title">myHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyHandler();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>xml æ–¹å¼</li></ol><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:websocket</span>=<span class="string">"http://www.springframework.org/schema/websocket"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/websocket</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/websocket/spring-websocket.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">websocket:handlers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">websocket:mapping</span> <span class="attr">path</span>=<span class="string">"/myHandler"</span> <span class="attr">handler</span>=<span class="string">"myHandler"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">websocket:handlers</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myHandler"</span> <span class="attr">class</span>=<span class="string">"org.springframework.samples.MyHandler"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ›´å¤šé…ç½®ç»†èŠ‚å¯ä»¥å‚è€ƒï¼š<a href="https://docs.spring.io/spring/docs/4.3.12.RELEASE/spring-framework-reference/htmlsingle/#websocket" target="_blank" rel="noopener">Spring WebSocket æ–‡æ¡£</a></p></blockquote><p>javax.websocket</p><p>å¦‚æœä¸æƒ³ä½¿ç”¨ Spring æ¡†æ¶çš„ WebSocket APIï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©åŸºæœ¬çš„ javax.websocketã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦å¼•å…¥ API jar åŒ…ã€‚</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- To write basic javax.websocket against --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.websocket<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.websocket-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨åµŒå…¥å¼ jettyï¼Œä½ è¿˜éœ€è¦å¼•å…¥å®ƒçš„å®ç°åŒ…ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- To run javax.websocket in embedded server --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.eclipse.jetty.websocket<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax-websocket-server-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jetty-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- To run javax.websocket client --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.eclipse.jetty.websocket<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax-websocket-client-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jetty-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>@ServerEndpoint</strong></p><p>è¿™ä¸ªæ³¨è§£ç”¨æ¥æ ‡è®°ä¸€ä¸ªç±»æ˜¯ WebSocket çš„å¤„ç†å™¨ã€‚</p><p>ç„¶åï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªç±»ä¸­ä½¿ç”¨ä¸‹é¢çš„æ³¨è§£æ¥è¡¨æ˜æ‰€ä¿®é¥°çš„æ–¹æ³•æ˜¯è§¦å‘äº‹ä»¶çš„å›è°ƒ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ”¶åˆ°æ¶ˆæ¯è§¦å‘äº‹ä»¶</span></span><br><span class="line"><span class="meta">@OnMessage</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String message, Session session)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å¼€è¿æ¥è§¦å‘äº‹ä»¶</span></span><br><span class="line"><span class="meta">@OnOpen</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(Session session, EndpointConfig config, @PathParam(<span class="string">"id"</span>)</span> String id) </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­è¿æ¥è§¦å‘äº‹ä»¶</span></span><br><span class="line"><span class="meta">@OnClose</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClose</span><span class="params">(Session session, CloseReason closeReason)</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ è¾“æ¶ˆæ¯é”™è¯¯è§¦å‘äº‹ä»¶</span></span><br><span class="line"><span class="meta">@OnError</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable error)</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ServerEndpointConfig.Configurator</strong></p><p>ç¼–å†™å®Œå¤„ç†å™¨ï¼Œä½ éœ€è¦æ‰©å±• ServerEndpointConfig.Configurator ç±»å®Œæˆé…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketServerConfigurator</span> <span class="keyword">extends</span> <span class="title">ServerEndpointConfig</span>.<span class="title">Configurator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">modifyHandshake</span><span class="params">(ServerEndpointConfig sec, HandshakeRequest request, HandshakeResponse response)</span> </span>&#123;</span><br><span class="line">        HttpSession httpSession = (HttpSession) request.getHttpSession();</span><br><span class="line">        sec.getUserProperties().put(HttpSession<span class="class">.<span class="keyword">class</span>.<span class="title">getName</span>(), <span class="title">httpSession</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ²¡æœ‰ç„¶åäº†ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ã€‚</p><h4 id="websocket-ä»£ç†"><a class="markdownIt-Anchor" href="#websocket-ä»£ç†"></a> WebSocket ä»£ç†</h4><p>å¦‚æœæŠŠ WebSocket çš„é€šä¿¡çœ‹æˆæ˜¯ç”µè¯è¿æ¥ï¼ŒNginx çš„è§’è‰²åˆ™åƒæ˜¯ç”µè¯æ¥çº¿å‘˜ï¼Œè´Ÿè´£å°†å‘èµ·ç”µè¯è¿æ¥çš„ç”µè¯è½¬æ¥åˆ°æŒ‡å®šçš„å®¢æœã€‚</p><p>Nginx ä» <a href="http://nginx.com/blog/websocket-nginx/" target="_blank" rel="noopener">1.3 ç‰ˆ</a>å¼€å§‹æ­£å¼æ”¯æŒ WebSocket ä»£ç†ã€‚å¦‚æœä½ çš„ web åº”ç”¨ä½¿ç”¨äº†ä»£ç†æœåŠ¡å™¨ Nginxï¼Œé‚£ä¹ˆä½ è¿˜éœ€è¦ä¸º Nginx åšä¸€äº›é…ç½®ï¼Œä½¿å¾—å®ƒå¼€å¯ WebSocket ä»£ç†åŠŸèƒ½ã€‚</p><p>ä»¥ä¸‹ä¸ºå‚è€ƒé…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="comment"># this section is specific to the WebSockets proxying</span></span><br><span class="line">  <span class="attribute">location</span> /socket.io &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://app_server_wsgiapp/socket.io;</span><br><span class="line">    <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Connection <span class="string">"upgrade"</span>;</span><br><span class="line">    <span class="attribute">proxy_read_timeout</span> <span class="number">600</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ›´å¤šé…ç½®ç»†èŠ‚å¯ä»¥å‚è€ƒï¼š<a href="http://nginx.org/en/docs/http/websocket.html" target="_blank" rel="noopener">Nginx å®˜æ–¹çš„ websocket æ–‡æ¡£</a></p></blockquote><h4 id="websocket-åº”ç”¨ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#websocket-åº”ç”¨ç¤ºä¾‹"></a> WebSocket åº”ç”¨ç¤ºä¾‹</h4><p>å¦‚æœéœ€è¦å®Œæ•´ç¤ºä¾‹ä»£ç ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„ Github ä»£ç ï¼š</p><ul><li><a href="https://github.com/dunwu/spring-notes/tree/master/codes/web/websocket" target="_blank" rel="noopener">Spring å¯¹ WebSocket æ”¯æŒçš„ç¤ºä¾‹</a></li><li><a href="https://github.com/dunwu/javaee-notes/tree/master/codes/websocket" target="_blank" rel="noopener">åµŒå…¥å¼ Jetty æœåŠ¡å™¨çš„ WebSocket ç¤ºä¾‹</a></li></ul><p>spring-websocket å’Œ jetty 9.3 ç‰ˆæœ¬ä¼¼ä¹å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼ŒTomcat åˆ™æœ¨æœ‰é—®é¢˜ã€‚</p><p>æˆ‘å°è¯•äº†å¥½å‡ æ¬¡ï¼Œæ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼Œåªå¥½ä½¿ç”¨ Jetty å®˜æ–¹çš„åµŒå…¥å¼ç¤ºä¾‹åœ¨ Jetty ä¸­ä½¿ç”¨ WebSocket ã€‚</p><h2 id="faq"><a class="markdownIt-Anchor" href="#faq"></a> FAQ</h2><h3 id="http-vs-socket"><a class="markdownIt-Anchor" href="#http-vs-socket"></a> Http vs. Socket</h3><p>Http é€šä¿¡ä¸ Socket é€šä¿¡æ–¹å¼æœ‰ä½•å·®å¼‚ï¼Ÿ</p><ul><li>Http<ul><li>åŸºäºè¯·æ±‚/å“åº”æ¨¡å¼ï¼Œé‡‡å–ä¸€é—®ä¸€ç­”æ–¹å¼ï¼ˆå®¢æˆ·ç«¯è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ‰ä¼šå“åº”ï¼‰</li></ul></li><li>Socket<ul><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹åŒå‘è¿æ¥ã€‚è¿æ¥æˆåŠŸåï¼Œä»»æ„ä¸€æ–¹éƒ½å¯ä¸»åŠ¨å‘é€æ¶ˆæ¯ã€‚</li><li>æ•°æ®ä¸¢å¤±ç‡ä½ï¼Œä½¿ç”¨ç®€å•ï¼Œæ˜“äºç§»æ¤ã€‚</li></ul></li></ul><h3 id="http-å’Œ-websocket-æœ‰ä»€ä¹ˆå…³ç³»"><a class="markdownIt-Anchor" href="#http-å’Œ-websocket-æœ‰ä»€ä¹ˆå…³ç³»"></a> HTTP å’Œ WebSocket æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</h3><p>Websocket å…¶å®æ˜¯ä¸€ä¸ªæ–°åè®®ï¼Œè·Ÿ HTTP åè®®åŸºæœ¬æ²¡æœ‰å…³ç³»ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹ç°æœ‰æµè§ˆå™¨çš„æ¡æ‰‹è§„èŒƒè€Œå·²ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ HTTP åè®®ä¸Šçš„ä¸€ç§è¡¥å……ã€‚</p><h3 id="html-å’Œ-http-æœ‰ä»€ä¹ˆå…³ç³»"><a class="markdownIt-Anchor" href="#html-å’Œ-http-æœ‰ä»€ä¹ˆå…³ç³»"></a> Html å’Œ HTTP æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</h3><p>Html æ˜¯è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œæ˜¯ä¸€ç§ç”¨äºåˆ›å»ºç½‘é¡µçš„æ ‡å‡†æ ‡è®°è¯­è¨€ã€‚å®ƒæ˜¯ä¸€ç§æŠ€æœ¯æ ‡å‡†ã€‚Html5 æ˜¯å®ƒçš„æœ€æ–°ç‰ˆæœ¬ã€‚</p><p>Http æ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡åè®®ã€‚å…¶æœ¬èº«å’Œ Html æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://www.zhihu.com/question/20215561" target="_blank" rel="noopener">çŸ¥ä¹é«˜ç¥¨ç­”æ¡ˆâ€”â€”WebSocket æ˜¯ä»€ä¹ˆåŸç†</a> - å¯¹ WebSocket åŸç†çš„é˜è¿°ç®€å•æ˜“æ‡‚ã€‚</li><li><a href="http://www.ruanyifeng.com/blog/2017/05/websocket.html" target="_blank" rel="noopener">WebSocket æ•™ç¨‹</a> - é˜®ä¸€å³°å¤§ç¥çš„ç§‘æ™®ä¸€å¦‚æ—¢å¾€çš„æµ…æ˜¾æ˜“æ‡‚ã€‚</li><li><a href="https://www.fullstackpython.com/websockets.html" target="_blank" rel="noopener">WebSockets</a> - by <em>fullstackpython</em></li><li><a href="http://nginx.org/en/docs/http/websocket.html" target="_blank" rel="noopener">Nginx å®˜æ–¹çš„ websocket æ–‡æ¡£</a></li><li><a href="https://docs.spring.io/spring/docs/4.3.12.RELEASE/spring-framework-reference/htmlsingle/#websocket" target="_blank" rel="noopener">Spring WebSocket æ–‡æ¡£</a></li><li><a href="http://tomcat.apache.org/tomcat-7.0-doc/web-socket-howto.html" target="_blank" rel="noopener">Tomcat7 WebSocket æ–‡æ¡£</a></li><li><a href="https://www.eclipse.org/jetty/documentation/9.4.7.v20170914/websocket-intro.html" target="_blank" rel="noopener">Jetty WebSocket æ–‡æ¡£</a></li><li><a href="https://juejin.im/post/57f885370bd1d00058b37d74" target="_blank" rel="noopener">Socketï¼Œä½ éœ€è¦çŸ¥é“çš„äº‹å„¿</a></li><li><a href="https://juejin.im/post/5b3649d751882552f052703b" target="_blank" rel="noopener">æ‰‹æŠŠæ‰‹æ•™ä½ å†™ Socket é•¿è¿æ¥</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;socket-å’Œ-websocket&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#socket-å’Œ-websocket&quot;&gt;&lt;/a&gt; Socket å’Œ WebSocket&lt;/h1&gt;
&lt;h2 id=&quot;socket&quot;&gt;&lt;a class=&quot;m
      
    
    </summary>
    
    
      <category term="é€šä¿¡" scheme="https://dunwu.github.io/blog/categories/%E9%80%9A%E4%BF%A1/"/>
    
    
      <category term="é€šä¿¡" scheme="https://dunwu.github.io/blog/tags/%E9%80%9A%E4%BF%A1/"/>
    
      <category term="ç½‘ç»œ" scheme="https://dunwu.github.io/blog/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="åè®®" scheme="https://dunwu.github.io/blog/tags/%E5%8D%8F%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘ç»œåè®®ä¹‹ TCP</title>
    <link href="https://dunwu.github.io/blog/communication/tcp/"/>
    <id>https://dunwu.github.io/blog/communication/tcp/</id>
    <published>2019-05-31T03:51:00.000Z</published>
    <updated>2020-01-16T09:48:30.646Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h2><h3 id="ä»€ä¹ˆæ˜¯-tcp"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯-tcp"></a> ä»€ä¹ˆæ˜¯ TCP</h3><p><strong>TCPï¼ˆTransmission Control Protocolï¼‰ï¼Œå³ä¼ è¾“æ§åˆ¶åè®®ï¼Œå®ƒæ˜¯ä¸€ç§<code>é¢å‘è¿æ¥çš„</code>ã€<code>å¯é çš„</code>ã€<code>åŸºäºå­—èŠ‚æµçš„</code>ä¼ è¾“å±‚é€šä¿¡åè®®</strong>ã€‚TCP ç”± RFC 793 å®šä¹‰ã€‚</p><div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559263786555.png!zp"/></div><h3 id="tcp-çš„ç‰¹æ€§"><a class="markdownIt-Anchor" href="#tcp-çš„ç‰¹æ€§"></a> TCP çš„ç‰¹æ€§</h3><ul><li><code>é¢å‘è¿æ¥çš„</code> - é¢å‘è¿æ¥æ˜¯æŒ‡ TCP éœ€è¦é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹åŸåˆ™å»ºç«‹å’Œæ–­å¼€åŒå‘è¿æ¥ã€‚</li><li><code>å¯é çš„</code> - å¯é æ˜¯æŒ‡ TCP ä¼ è¾“çš„æ•°æ®åŒ…ä¿è¯ä»¥åŸå§‹é¡ºåºåˆ°è¾¾ç›®çš„åœ°ï¼Œä¸”æ•°æ®åŒ…ä¸è¢«æŸåã€‚ä¸ºäº†å®ç°è¿™ç‚¹ï¼ŒTCP é€šè¿‡ä»¥ä¸‹æŠ€æœ¯æ¥ä¿è¯ï¼š<ul><li>æ•°æ®åŒ…çš„åºåˆ—å·å’Œæ ¡éªŒç </li><li>ç¡®è®¤åŒ…å’Œè‡ªåŠ¨é‡ä¼ <ul><li>å¦‚æœå‘é€è€…æ²¡æœ‰æ”¶åˆ°æ­£ç¡®çš„å“åº”ï¼Œå®ƒå°†é‡æ–°å‘é€æ•°æ®åŒ…ã€‚å¦‚æœå¤šæ¬¡è¶…æ—¶ï¼Œè¿æ¥å°±ä¼šæ–­å¼€ã€‚</li><li>TCP å®è¡Œæµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ã€‚è¿™äº›ç¡®ä¿æªæ–½ä¼šå¯¼è‡´å»¶è¿Ÿï¼Œè€Œä¸”é€šå¸¸å¯¼è‡´ä¼ è¾“æ•ˆç‡æ¯” UDP ä½ã€‚</li></ul></li></ul></li><li><code>åŸºäºå­—èŠ‚æµçš„</code><ul><li>è™½ç„¶åº”ç”¨ç¨‹åºå’Œ TCP çš„äº¤äº’æ˜¯ä¸€æ¬¡ä¸€ä¸ªæ•°æ®å—ï¼ˆå¤§å°ä¸ç­‰ï¼‰ï¼Œä½† TCP æŠŠåº”ç”¨ç¨‹åºçœ‹æˆæ˜¯ä¸€è¿ä¸²çš„æ— ç»“æ„çš„å­—èŠ‚æµã€‚TCP æœ‰ä¸€ä¸ªç¼“å†²ï¼Œå½“åº”ç”¨ç¨‹åºä¼ é€çš„æ•°æ®å—å¤ªé•¿ï¼ŒTCP å°±å¯ä»¥æŠŠå®ƒåˆ’åˆ†çŸ­ä¸€äº›å†ä¼ é€ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸€æ¬¡åªå‘é€ä¸€ä¸ªå­—èŠ‚ï¼ŒTCP ä¹Ÿå¯ä»¥ç­‰å¾…ç§¯ç´¯æœ‰è¶³å¤Ÿå¤šçš„å­—èŠ‚åå†æ„æˆæŠ¥æ–‡æ®µå‘é€å‡ºå»ã€‚</li><li>åœ¨ TCP å»ºç«‹è¿æ¥å‰ä¸¤æ¬¡æ¡æ‰‹çš„ SYN æŠ¥æ–‡ä¸­é€‰é¡¹å­—æ®µçš„ MSS å€¼ï¼Œé€šä¿¡åŒæ–¹å•†å®šé€šä¿¡çš„æœ€å¤§æŠ¥æ–‡é•¿åº¦ã€‚å¦‚æœåº”ç”¨å±‚äº¤ä»˜ä¸‹æ¥çš„æ•°æ®è¿‡å¤§ï¼Œå°±ä¼šå¯¹æ•°æ®åˆ†æ®µï¼Œç„¶åå‘é€ï¼›å¦åˆ™é€šè¿‡æ»‘åŠ¨çª—å£æ¥æ§åˆ¶é€šä¿¡åŒå‘çš„æ•°æ®ã€‚</li></ul></li></ul><h3 id="tcp-çš„é€‚ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#tcp-çš„é€‚ç”¨åœºæ™¯"></a> TCP çš„é€‚ç”¨åœºæ™¯</h3><p>åŸºäºä»¥ä¸Šç‰¹æ€§ï¼Œä¸ºäº†ç¡®ä¿é«˜ååé‡ï¼ŒWeb æœåŠ¡å™¨å¯ä»¥ä¿æŒå¤§é‡çš„ TCP è¿æ¥ï¼Œä»è€Œå¯¼è‡´é«˜å†…å­˜ä½¿ç”¨ã€‚ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Web æœåŠ¡å™¨çº¿ç¨‹é—´æ‹¥æœ‰å¤§é‡å¼€æ”¾è¿æ¥å¯èƒ½å¼€é”€å·¨å¤§ï¼Œæ¶ˆè€—èµ„æºè¿‡å¤šï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘åœ¨é€‚ç”¨æƒ…å†µä¸‹åˆ‡æ¢åˆ° UDPã€‚</p><p>TCP å¯¹äºéœ€è¦é«˜å¯é æ€§ä½†æ—¶é—´ç´§è¿«çš„åº”ç”¨ç¨‹åºå¾ˆæœ‰ç”¨ã€‚æ¯”å¦‚åŒ…æ‹¬ Web æœåŠ¡å™¨ï¼Œæ•°æ®åº“ä¿¡æ¯ï¼ŒSMTPï¼ŒFTP å’Œ SSHã€‚</p><p>ä»¥ä¸‹æƒ…å†µä½¿ç”¨ TCP ä»£æ›¿ UDPï¼š</p><ul><li>ä½ éœ€è¦æ•°æ®å®Œå¥½æ— æŸã€‚</li><li>ä½ æƒ³å¯¹ç½‘ç»œååé‡è‡ªåŠ¨è¿›è¡Œæœ€ä½³è¯„ä¼°ã€‚</li></ul><h3 id="tcp-æŠ¥æ–‡"><a class="markdownIt-Anchor" href="#tcp-æŠ¥æ–‡"></a> TCP æŠ¥æ–‡</h3><div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559264511812.png!zp"/></div><p>æŠ¥æ–‡å­—æ®µä¸ä¸€ä¸€é˜è¿°ï¼Œé‡ç‚¹å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>TCP çš„åŒ…æ˜¯æ²¡æœ‰ IP åœ°å€çš„ï¼Œé‚£æ˜¯ IP å±‚ä¸Šçš„äº‹ã€‚ä½†æ˜¯æœ‰æºç«¯å£å’Œç›®æ ‡ç«¯å£ã€‚</li><li>ä¸€ä¸ª TCP è¿æ¥éœ€è¦å››ä¸ªå…ƒç»„æ¥è¡¨ç¤ºæ˜¯åŒä¸€ä¸ªè¿æ¥ï¼ˆsrc_ip, src_port, dst_ip, dst_portï¼‰å‡†ç¡®è¯´æ˜¯äº”å…ƒç»„ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯åè®®ã€‚ä½†å› ä¸ºè¿™é‡Œåªæ˜¯è¯´ TCP åè®®ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘åªè¯´å››å…ƒç»„ã€‚</li><li>æ³¨æ„ä¸Šå›¾ä¸­çš„å››ä¸ªéå¸¸é‡è¦çš„ä¸œè¥¿ï¼š<ul><li><strong>Sequence Number</strong>æ˜¯åŒ…çš„åºå·ï¼Œ<strong>ç”¨æ¥è§£å†³ç½‘ç»œåŒ…ä¹±åºï¼ˆreorderingï¼‰é—®é¢˜ã€‚</strong></li><li><strong>Acknowledgement Number</strong>å°±æ˜¯ ACKâ€”â€”ç”¨äºç¡®è®¤æ”¶åˆ°ï¼Œ<strong>ç”¨æ¥è§£å†³ä¸ä¸¢åŒ…çš„é—®é¢˜</strong>ã€‚</li><li><strong>Window åˆå« Advertised-Window</strong>ï¼Œä¹Ÿå°±æ˜¯è‘—åçš„æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰ï¼Œ<strong>ç”¨äºè§£å†³æµæ§çš„</strong>ã€‚</li><li><strong>TCP Flag</strong>ï¼Œä¹Ÿå°±æ˜¯åŒ…çš„ç±»å‹ï¼Œ<strong>ä¸»è¦æ˜¯ç”¨äºæ“æ§ TCP çš„çŠ¶æ€æœºçš„</strong>ã€‚</li></ul></li></ul><div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559264593860.png!zp"/></div><h2 id="tcp-é€šä¿¡æµç¨‹"><a class="markdownIt-Anchor" href="#tcp-é€šä¿¡æµç¨‹"></a> TCP é€šä¿¡æµç¨‹</h2><div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559264679371.png!zp"/></div><p>TCP å®Œæ•´çš„é€šä¿¡åˆ†ä¸ºä¸‰å—ï¼š</p><ol><li>ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥</li><li>æ•°æ®ä¼ è¾“</li><li>å››æ¬¡æŒ¥æ‰‹ç«¯å£è¿æ¥</li></ol><h3 id="ä¸‰æ¬¡æ¡æ‰‹"><a class="markdownIt-Anchor" href="#ä¸‰æ¬¡æ¡æ‰‹"></a> ä¸‰æ¬¡æ¡æ‰‹</h3><p>ï¼ˆ1ï¼‰ä¸‰æ¬¡æ¡æ‰‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><ul><li>ä¸‰æ¬¡æ¡æ‰‹è´Ÿè´£å»ºç«‹ TCP åŒå‘è¿æ¥ã€‚</li></ul><p>ï¼ˆ2ï¼‰ä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/network/transport/ä¸‰æ¬¡æ¡æ‰‹.gif!zp"/></div><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸‰æ¬¡æ¡æ‰‹æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¸¦æœ‰ SYN æ ‡å¿—çš„æ•°æ®åŒ…ã€‚</li><li>ç¬¬äºŒæ¬¡æ¡æ‰‹ - æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€å¸¦æœ‰ SYN/ACK æ ‡å¿—çš„æ•°æ®åŒ…ã€‚</li><li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¸¦æœ‰å¸¦æœ‰ ACK æ ‡å¿—çš„æ•°æ®åŒ…ã€‚</li></ol><p>è‡³æ­¤ï¼ŒTCP ä¸‰æ¬¡æ¡æ‰‹å®Œæˆï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å·²å»ºç«‹åŒå‘è¿æ¥ã€‚</p><blockquote><p>ğŸ’¡ è¯´æ˜ï¼šSYN ä¸º synchronize çš„ç¼©å†™ï¼ŒACK ä¸º acknowledgment çš„ç¼©å†™ã€‚</p></blockquote><p>ï¼ˆ3ï¼‰ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</p><p>ä¸ºäº†ä¾¿äºè¯´æ˜ï¼Œå‡è®¾å®¢æˆ·ç«¯ä¸º A, æœåŠ¡ç«¯ä¸º Bã€‚</p><ol><li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼ŒA å‘ B å‘åŒæ­¥æ¶ˆæ¯ã€‚B æ”¶åˆ°æ¶ˆæ¯åï¼ŒB è®¤ä¸ºï¼šA å‘æ¶ˆæ¯æ²¡é—®é¢˜ï¼›B æ”¶æ¶ˆæ¯æ²¡é—®é¢˜ã€‚</li><li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ŒB å‘ A å‘åŒæ­¥æ¶ˆæ¯å’Œç¡®è®¤æ¶ˆæ¯ã€‚A æ”¶åˆ°æ¶ˆæ¯åï¼ŒA è®¤ä¸ºï¼šA å‘æ¶ˆæ¯ã€æ”¶æ¶ˆæ¯éƒ½æ²¡é—®é¢˜ï¼›B å‘æ¶ˆæ¯ã€æ”¶æ¶ˆæ¯éƒ½æ²¡é—®é¢˜ã€‚<strong>ä½†æ˜¯ï¼Œæ­¤æ—¶ B ä¸ç¡®å®šè‡ªå·±å‘æ¶ˆæ¯æ˜¯å¦æ²¡é—®é¢˜</strong>ï¼Œæ‰€ä»¥å°±éœ€è¦ç¬¬ä¸‰æ¬¡æ¡æ‰‹ã€‚</li><li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ŒA å‘ B å‘ç¡®è®¤æ¶ˆæ¯ã€‚B æ”¶åˆ°æ¶ˆæ¯åã€‚B è®¤ä¸ºï¼šB å‘æ¶ˆæ¯æ²¡é—®é¢˜ã€‚</li></ol><h3 id="å››æ¬¡æŒ¥æ‰‹"><a class="markdownIt-Anchor" href="#å››æ¬¡æŒ¥æ‰‹"></a> å››æ¬¡æŒ¥æ‰‹</h3><p>ï¼ˆ1ï¼‰å››æ¬¡æŒ¥æ‰‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><ul><li>å››æ¬¡æŒ¥æ‰‹è´Ÿè´£æ–­å¼€ TCP è¿æ¥ã€‚</li></ul><p>ï¼ˆ2ï¼‰ä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ</p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå››æ¬¡æŒ¥æ‰‹æµç¨‹å¦‚ä¸‹ï¼š</p><div align="center"><img src="http://dunwu.test.upcdn.net/cs/network/transport/å››æ¬¡æŒ¥æ‰‹.gif!zp"/></div><ol><li>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ª FIN åŒ…ï¼Œç”¨æ¥å…³é—­å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„æ•°æ®ä¼ é€ã€‚</li><li>ç¬¬äºŒæ¬¡æŒ¥æ‰‹ - æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ª FIN åŒ…ï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª ACK åŒ…ï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ  1ã€‚å’Œ SYN ä¸€æ ·ï¼Œä¸€ä¸ª FIN å°†å ç”¨ä¸€ä¸ªåºå·ã€‚</li><li>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ - æœåŠ¡ç«¯å…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª FIN åŒ…ã€‚</li><li>ç¬¬å››æ¬¡æŒ¥æ‰‹ - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ ACK åŒ…ï¼Œå¹¶å°†ç¡®è®¤åºå·è®¾ç½®ä¸ºæ”¶åˆ°åºå·åŠ  1ã€‚</li></ol><p>ï¼ˆ3ï¼‰ä¸ºä»€ä¹ˆå»ºç«‹è¿æ¥æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­è¿æ¥ç¡®æ˜¯å››æ¬¡æŒ¥æ‰‹å‘¢ï¼Ÿ</p><ul><li>å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œ æœåŠ¡å™¨åœ¨ LISTEN çŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°å»ºç«‹è¿æ¥è¯·æ±‚çš„ SYN æŠ¥æ–‡åï¼ŒæŠŠ ACK å’Œ SYN æ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li><li>è€Œå…³é—­è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯¹æ–¹çš„ FIN æŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®ï¼Œè€Œè‡ªå·±ä¹Ÿæœªå¿…å…¨éƒ¨æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥å·±æ–¹å¯ä»¥ç«‹å³å…³é—­ï¼Œä¹Ÿå¯ä»¥å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹åï¼Œå†å‘é€ FIN æŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºåŒæ„ç°åœ¨å…³é—­è¿æ¥ï¼Œå› æ­¤ï¼Œå·±æ–¹ ACK å’Œ FIN ä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ï¼Œä»è€Œå¯¼è‡´å¤šäº†ä¸€æ¬¡ã€‚</li></ul><h2 id="æ»‘åŠ¨çª—å£"><a class="markdownIt-Anchor" href="#æ»‘åŠ¨çª—å£"></a> æ»‘åŠ¨çª—å£</h2><p>ä»€ä¹ˆæ˜¯æ»‘åŠ¨çª—å£ï¼Ÿ</p><p><strong>æ»‘åŠ¨çª—å£æ˜¯ TCP çš„ä¸€ç§æ§åˆ¶ç½‘ç»œæµé‡çš„æŠ€æœ¯ã€‚</strong></p><p><strong>TCP å¿…éœ€è¦è§£å†³çš„å¯é ä¼ è¾“ä»¥åŠåŒ…ä¹±åºï¼ˆreorderingï¼‰çš„é—®é¢˜</strong>ï¼Œæ‰€ä»¥ï¼ŒTCP å¿…éœ€è¦çŸ¥é“ç½‘ç»œå®é™…çš„æ•°æ®å¤„ç†å¸¦å®½æˆ–æ˜¯æ•°æ®å¤„ç†é€Ÿåº¦ï¼Œè¿™æ ·æ‰ä¸ä¼šå¼•èµ·ç½‘ç»œæ‹¥å¡ï¼Œå¯¼è‡´ä¸¢åŒ…ã€‚</p><p>TCP å¤´é‡Œæœ‰ä¸€ä¸ªå­—æ®µå« Windowï¼Œåˆå« Advertised-Windowï¼Œè¿™ä¸ªå­—æ®µæ˜¯æ¥æ”¶ç«¯å‘Šè¯‰å‘é€ç«¯è‡ªå·±è¿˜æœ‰å¤šå°‘ç¼“å†²åŒºå¯ä»¥æ¥æ”¶æ•°æ®ã€‚<strong>äºæ˜¯å‘é€ç«¯å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥æ”¶ç«¯çš„å¤„ç†èƒ½åŠ›æ¥å‘é€æ•°æ®ï¼Œè€Œä¸ä¼šå¯¼è‡´æ¥æ”¶ç«¯å¤„ç†ä¸è¿‡æ¥</strong>ã€‚</p><p>æ»‘åŠ¨çª—å£åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p><div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559265819762.png!zp"/></div><ol><li>å·²å‘é€å·²ç¡®è®¤ - æ•°æ®æµä¸­æœ€æ—©çš„å­—èŠ‚å·²ç»å‘é€å¹¶å¾—åˆ°ç¡®è®¤ã€‚è¿™äº›æ•°æ®æ˜¯ç«™åœ¨å‘é€ç«¯çš„è§’åº¦æ¥çœ‹çš„ã€‚ä¸Šå›¾ä¸­çš„ 31 ä¸ªå­—èŠ‚å·²ç»å‘é€å¹¶ç¡®è®¤ã€‚</li><li>å·²å‘é€ä½†å°šæœªç¡®è®¤ - å·²å‘é€ä½†å°šæœªå¾—åˆ°ç¡®è®¤çš„å­—èŠ‚ã€‚å‘é€æ–¹åœ¨ç¡®è®¤ä¹‹å‰ï¼Œä¸è®¤ä¸ºè¿™äº›æ•°æ®å·²ç»è¢«å¤„ç†ã€‚ä¸Šå›¾ä¸­çš„ 32 ~ 45 å­—èŠ‚ä¸ºç¬¬ 2 ç±»ã€‚</li><li>æœªå‘é€è€Œæ¥æ”¶æ–¹å·² Ready - è®¾å¤‡å°šæœªå°†æ•°æ®å‘å‡º ï¼Œä½†æ¥æ”¶æ–¹æ ¹æ®æœ€è¿‘ä¸€æ¬¡å…³äºå‘é€æ–¹ä¸€æ¬¡è¦å‘é€å¤šå°‘å­—èŠ‚ç¡®è®¤è‡ªå·±æœ‰è¶³å¤Ÿç©ºé—´ã€‚å‘é€æ–¹ä¼šç«‹å³å°è¯•å‘é€ã€‚ä¸Šå›¾ä¸­çš„ 46 ~ 51 å­—èŠ‚ä¸ºç¬¬ 3 ç±»ã€‚</li><li>æœªå‘é€è€Œæ¥æ”¶æ–¹ Not Ready - ç”±äºæ¥æ”¶æ–¹ not readyï¼Œè¿˜ä¸å…è®¸å°†è¿™éƒ¨åˆ†æ•°æ®å‘å‡ºã€‚ä¸Šå›¾ä¸­çš„ 52 ä»¥åçš„å­—èŠ‚ä¸ºç¬¬ 4 ç±»ã€‚</li></ol><div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559265927658.png!zp"/></div><p>è¿™å¼ å›¾ç‰‡ç›¸å¯¹äºä¸Šä¸€å¼ å›¾ç‰‡ï¼Œæ»‘åŠ¨çª—å£åç§»äº† 5 ä¸ªå­—èŠ‚ï¼Œæ„å‘³ç€æœ‰ 5 ä¸ªå·²å‘é€çš„å­—èŠ‚å¾—åˆ°äº†ç¡®è®¤ã€‚</p><h2 id="tcp-é‡ä¼ æœºåˆ¶"><a class="markdownIt-Anchor" href="#tcp-é‡ä¼ æœºåˆ¶"></a> TCP é‡ä¼ æœºåˆ¶</h2><p>TCP è¦ä¿è¯æ‰€æœ‰çš„æ•°æ®åŒ…éƒ½å¯ä»¥åˆ°è¾¾ï¼Œæ‰€ä»¥ï¼Œå¿…éœ€è¦æœ‰é‡ä¼ æœºåˆ¶ã€‚</p><p>TCP é‡ä¼ æœºåˆ¶ä¸»è¦æœ‰ä¸¤ç§ï¼š</p><ul><li>è¶…æ—¶é‡ä¼ æœºåˆ¶</li><li>å¿«é€Ÿé‡ä¼ æœºåˆ¶</li></ul><h3 id="è¶…æ—¶é‡ä¼ æœºåˆ¶"><a class="markdownIt-Anchor" href="#è¶…æ—¶é‡ä¼ æœºåˆ¶"></a> è¶…æ—¶é‡ä¼ æœºåˆ¶</h3><p>è¶…æ—¶é‡ä¼ æœºåˆ¶æ˜¯æŒ‡ï¼šå‘é€æ•°æ®åŒ…åœ¨ä¸€å®šçš„æ—¶é—´å‘¨æœŸå†…æ²¡æœ‰æ”¶åˆ°ç›¸åº”çš„ ACKï¼Œç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œè¶…æ—¶ä¹‹åå°±è®¤ä¸ºè¿™ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œå°±ä¼šé‡æ–°å‘é€ã€‚è¿™ä¸ªç­‰å¾…æ—¶é—´è¢«ç§°ä¸º RTO(Retransmission TimeOut)ï¼Œå³é‡ä¼ è¶…æ—¶æ—¶é—´ã€‚</p><p>æ²¡æœ‰ç¡®è®¤çš„æ•°æ®åŒ…ä¸ä¼šä»çª—å£ä¸­ç§»èµ°ï¼Œå®šæ—¶å™¨åœ¨é‡ä¼ æ—¶é—´åˆ°æœŸå†…ï¼Œæ¯ä¸ªç‰‡æ®µçš„ä½ç½®ä¸å˜ã€‚</p><p>è¿™ç§æœºåˆ¶çš„é‡ç‚¹æ˜¯ RTO çš„è®¾ç½®ï¼š</p><ul><li>RTO è®¾é•¿äº†ï¼Œé‡å‘å°±æ…¢ï¼Œä¸¢äº†è€åŠå¤©æ‰é‡å‘ï¼Œæ²¡æœ‰æ•ˆç‡ï¼Œæ€§èƒ½å·®ï¼›</li><li>RTO è®¾çŸ­äº†ï¼Œä¼šå¯¼è‡´å¯èƒ½å¹¶æ²¡æœ‰ä¸¢å°±é‡å‘ã€‚äºæ˜¯é‡å‘çš„å°±å¿«ï¼Œä¼šå¢åŠ ç½‘ç»œæ‹¥å¡ï¼Œå¯¼è‡´æ›´å¤šçš„è¶…æ—¶ï¼Œæ›´å¤šçš„è¶…æ—¶å¯¼è‡´æ›´å¤šçš„é‡å‘</li></ul><h3 id="å¿«é€Ÿé‡ä¼ æœºåˆ¶"><a class="markdownIt-Anchor" href="#å¿«é€Ÿé‡ä¼ æœºåˆ¶"></a> å¿«é€Ÿé‡ä¼ æœºåˆ¶</h3><p>å¿«é€Ÿé‡ä¼ æœºåˆ¶ï¼Œå®ç°äº†å¦å¤–çš„ä¸€ç§ä¸¢åŒ…è¯„å®šæ ‡å‡†ï¼Œå³å¦‚æœè¿ç»­æ”¶åˆ° 3 æ¬¡é‡å¤ ACKï¼Œå‘é€æ–¹å°±è®¤ä¸ºè¿™ä¸ª seq çš„åŒ…ä¸¢å¤±äº†ï¼Œç«‹åˆ»è¿›è¡Œé‡ä¼ ã€‚</p><p>å½“æ¥æ”¶æ–¹æ”¶åˆ°ä¹±åºç‰‡æ®µæ—¶ï¼Œéœ€è¦é‡å¤å‘é€ ACKã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://coolshell.cn/articles/11564.html" target="_blank" rel="noopener">TCP çš„é‚£äº›äº‹å„¿ï¼ˆä¸Šï¼‰</a></li><li><a href="https://coolshell.cn/articles/11609.html" target="_blank" rel="noopener">TCP çš„é‚£äº›äº‹å„¿ï¼ˆä¸‹ï¼‰</a></li><li><a href="https://juejin.im/post/5a7835a46fb9a063606eb801" target="_blank" rel="noopener">å›¾è§£ TCP ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡åˆ†æ‰‹</a></li><li><a href="https://blog.csdn.net/qzcsu/article/details/72861891" target="_blank" rel="noopener">TCP çš„ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹ï¼ˆè¯¦è§£+åŠ¨å›¾ï¼‰</a></li><li><a href="https://blog.csdn.net/sinat_36629696/article/details/80740678" target="_blank" rel="noopener">TCP è¯¦è§£</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#ç®€ä»‹&quot;&gt;&lt;/a&gt; ç®€ä»‹&lt;/h2&gt;
&lt;h3 id=&quot;ä»€ä¹ˆæ˜¯-tcp&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#ä»€ä¹ˆæ˜¯-tcp&quot;&gt;&lt;/a&gt; ä»€ä¹ˆæ˜¯ TCP&lt;
      
    
    </summary>
    
    
      <category term="é€šä¿¡" scheme="https://dunwu.github.io/blog/categories/%E9%80%9A%E4%BF%A1/"/>
    
    
      <category term="é€šä¿¡" scheme="https://dunwu.github.io/blog/tags/%E9%80%9A%E4%BF%A1/"/>
    
      <category term="ç½‘ç»œ" scheme="https://dunwu.github.io/blog/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="åè®®" scheme="https://dunwu.github.io/blog/tags/%E5%8D%8F%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘ç»œé€šä¿¡ä¹‹ CDN</title>
    <link href="https://dunwu.github.io/blog/communication/cdn/"/>
    <id>https://dunwu.github.io/blog/communication/cdn/</id>
    <published>2019-05-29T15:19:00.000Z</published>
    <updated>2020-01-16T09:48:30.632Z</updated>
    
    <content type="html"><![CDATA[<div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559138689425.png!zp"/></div><h2 id="ç®€ä»‹"><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h2><h3 id="cdn-æ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#cdn-æ˜¯ä»€ä¹ˆ"></a> CDN æ˜¯ä»€ä¹ˆ</h3><p>CDN(<strong>Content Delivery Network</strong>)ï¼Œå³<strong>å†…å®¹åˆ†å‘ç½‘ç»œ</strong>ã€‚</p><p>CDN æ˜¯ä¸€ä¸ªå…¨çƒæ€§çš„ä»£ç†æœåŠ¡å™¨åˆ†å¸ƒå¼ç½‘ç»œï¼Œä¾é éƒ¨ç½²åœ¨å„åœ°çš„è¾¹ç¼˜æœåŠ¡å™¨ï¼Œé€šè¿‡ä¸­å¿ƒå¹³å°çš„è´Ÿè½½å‡è¡¡ã€å†…å®¹åˆ†å‘ã€è°ƒåº¦ç­‰åŠŸèƒ½æ¨¡å—ï¼Œä½¿ç”¨æˆ·å°±è¿‘è·å–æ‰€éœ€å†…å®¹ï¼Œé™ä½ç½‘ç»œæ‹¥å¡ï¼Œæé«˜ç”¨æˆ·è®¿é—®å“åº”é€Ÿåº¦å’Œå‘½ä¸­ç‡ã€‚å®ƒä»é è¿‘ç”¨æˆ·çš„ä½ç½®æä¾›å†…å®¹ã€‚é€šå¸¸ï¼ŒHTML/CSS/JSï¼Œå›¾ç‰‡å’Œè§†é¢‘ç­‰é™æ€å†…å®¹ç”± CDN æä¾›ã€‚CDN çš„ DNS è§£æä¼šå‘ŠçŸ¥å®¢æˆ·ç«¯è¿æ¥å“ªå°æœåŠ¡å™¨ã€‚CDN çš„å…³é”®æŠ€æœ¯ä¸»è¦æœ‰å†…å®¹å­˜å‚¨å’Œåˆ†å‘æŠ€æœ¯ã€‚</p><h3 id="cdn-çš„ä¼˜ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#cdn-çš„ä¼˜ç¼ºç‚¹"></a> CDN çš„ä¼˜ç¼ºç‚¹</h3><ul><li>ä¼˜ç‚¹<ul><li><strong>è®¿é—®åŠ é€Ÿ</strong> - ç”±äº CDN å°±è¿‘æœåŠ¡ï¼Œå¤§å¤§é™ä½äº†ç½‘ç»œä¼ æ’­æ—¶å»¶ï¼Œæ‰€ä»¥è‡ªç„¶æé«˜äº†è®¿é—®é€Ÿåº¦ã€‚</li><li><strong>é™ä½è´Ÿè½½</strong> - å¦‚æœ CDN å·²ç»èƒ½è·å–æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¸å¿…è¯·æ±‚æºç«™ï¼Œè¿™è‡ªç„¶é™ä½äº†æºç«™ï¼ˆæœåŠ¡å™¨ï¼‰çš„è´Ÿè½½ã€‚</li></ul></li><li>ç¼ºç‚¹<ul><li>CDN æˆæœ¬å¯èƒ½å› æµé‡è€Œå¼‚ï¼Œå¯èƒ½åœ¨æƒè¡¡ä¹‹åä½ å°†ä¸ä¼šä½¿ç”¨ CDNã€‚</li><li>å¦‚æœåœ¨ TTL è¿‡æœŸä¹‹å‰æ›´æ–°å†…å®¹ï¼ŒCDN ç¼“å­˜å†…å®¹å¯èƒ½ä¼šè¿‡æ—¶ã€‚</li><li>CDN éœ€è¦æ›´æ”¹é™æ€å†…å®¹çš„ URL åœ°å€ä»¥æŒ‡å‘ CDNã€‚</li></ul></li></ul><h2 id="cdn-åŸç†"><a class="markdownIt-Anchor" href="#cdn-åŸç†"></a> CDN åŸç†</h2><p>CDN çš„åŸºæœ¬åŸç†æ˜¯ï¼š</p><ul><li>å¹¿æ³›é‡‡ç”¨å„ç§ç¼“å­˜æœåŠ¡å™¨ï¼Œå°†è¿™äº›ç¼“å­˜æœåŠ¡å™¨åˆ†å¸ƒåˆ°ç”¨æˆ·è®¿é—®ç›¸å¯¹é›†ä¸­çš„åœ°åŒºæˆ–ç½‘ç»œä¸­ï¼›</li><li>åœ¨ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶ï¼Œå®æ—¶åœ°æ ¹æ®ç½‘ç»œæµé‡å’Œå„èŠ‚ç‚¹çš„è¿æ¥ã€è´Ÿè½½çŠ¶å†µä»¥åŠåˆ°ç”¨æˆ·çš„è·ç¦»å’Œå“åº”æ—¶é—´ç­‰ç»¼åˆä¿¡æ¯æ¥é€‰æ‹©æœ€ä½³ç¼“å­˜æœåŠ¡å™¨ï¼›</li><li>ç„¶åï¼Œå°†ç”¨æˆ·çš„è¯·æ±‚é‡æ–°å¯¼å‘æœ€ä½³çš„ç¼“å­˜æœåŠ¡å™¨ä¸Šï¼Œç”±ç¼“å­˜æœåŠ¡å™¨ç›´æ¥å“åº”ç”¨æˆ·è¯·æ±‚ã€‚</li></ul><p>CDN ç½‘ç»œæ¶æ„ä¸»è¦ç”±ä¸¤å¤§éƒ¨åˆ†ï¼Œåˆ†ä¸º<strong>ä¸­å¿ƒ</strong>å’Œ<strong>è¾¹ç¼˜</strong>ä¸¤éƒ¨åˆ†ï¼š</p><ul><li>ä¸­å¿ƒæŒ‡ CDN ç½‘ç®¡ä¸­å¿ƒå’Œ DNS é‡å®šå‘è§£æä¸­å¿ƒï¼Œè´Ÿè´£å…¨å±€è´Ÿè½½å‡è¡¡ï¼Œè®¾å¤‡ç³»ç»Ÿå®‰è£…åœ¨ç®¡ç†ä¸­å¿ƒæœºæˆ¿ï¼›</li><li>è¾¹ç¼˜ä¸»è¦æŒ‡å¼‚åœ°èŠ‚ç‚¹ï¼ŒCDN åˆ†å‘çš„è½½ä½“ï¼Œä¸»è¦ç”± Cache å’Œè´Ÿè½½å‡è¡¡å™¨ç­‰ç»„æˆã€‚</li></ul><p>CDN æ˜¯ä¸€ä¸ªç­–ç•¥æ€§éƒ¨ç½²çš„æ•´ä½“ç³»ç»Ÿï¼ŒåŒ…æ‹¬<strong>åˆ†å¸ƒå¼å­˜å‚¨</strong>ã€<strong>è´Ÿè½½å‡è¡¡</strong>ã€<strong>å†…å®¹ç®¡ç†</strong>å’Œ<strong>ç½‘ç»œè¯·æ±‚çš„é‡å®šå‘</strong>ï¼”ä¸ªè¦ä»¶ã€‚</p><h3 id="åˆ†å¸ƒå¼å­˜å‚¨"><a class="markdownIt-Anchor" href="#åˆ†å¸ƒå¼å­˜å‚¨"></a> åˆ†å¸ƒå¼å­˜å‚¨</h3><p>CDN ç½‘ç»œå°†å­˜å‚¨èµ„æºåˆ†å¸ƒåˆ°å„ä¸ªåœ°ç†ä½ç½®ã€å„ä¸ªç½‘æ®µã€‚å­˜å‚¨ç³»ç»Ÿä½œä¸º CDN ç³»ç»Ÿå¯†ä¸å¯åˆ†çš„ä¸€éƒ¨åˆ†ï¼Œå°† CDN åˆ†å‘çš„æ–‡ä»¶å’Œæ•°æ®åº“è¡¨è®°å½•å†…å®¹å­˜å‚¨èµ·æ¥ï¼Œæä¾›æŒç»­æœåŠ¡ã€‚å­˜å‚¨ç³»ç»Ÿé‡‡ç”¨ä¸‰çº§å­˜å‚¨æ¶æ„ï¼ŒåŒ…æ‹¬æ ¸å¿ƒå­˜å‚¨ã€CDN æœåŠ¡èŠ‚ç‚¹åˆ†å¸ƒå¼ç¼“å­˜å’Œç»ˆç«¯æœ¬åœ°ç¼“å­˜ã€‚ä»»æ„ä¸€ä¸ªç‚¹çš„å­˜å‚¨å´©æºƒæˆ–å¤±æ•ˆï¼Œå¹¶ä¸å½±å“ç³»ç»ŸæœåŠ¡çš„å¯ç”¨æ€§ã€‚</p><div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559140068433.png!zp"/></div><p>å¦‚ CDN ç³»ç»Ÿåœ¨ 5 å¤§è¿è¥å•†ï¼ˆä¸­å›½ç”µä¿¡ã€ä¸­å›½ç½‘é€šã€ä¸­å›½é“é€šã€ä¸­å›½ç§»åŠ¨ã€ä¸­å›½è”é€šï¼‰ä»¥åŠ 2 å¤§ä¸“æœ‰ç½‘ç»œï¼ˆä¸­å›½æ•™è‚²å’Œç§‘ç ”è®¡ç®—æœºç½‘ã€ä¸­å›½ç§‘æŠ€ç½‘ï¼‰éƒ½å¸ƒæœ‰ CDN èŠ‚ç‚¹ã€‚<strong>è¿™æ ·å°±æ¶ˆé™¤äº†ä¸åŒè¿è¥å•†ä¹‹é—´äº’è”çš„ç“¶é¢ˆé€ æˆçš„å½±å“ï¼Œå®ç°äº†è·¨è¿è¥å•†çš„ç½‘ç»œåŠ é€Ÿï¼Œä¿è¯ä¸åŒç½‘ç»œä¸­çš„ç”¨æˆ·éƒ½èƒ½å¾—åˆ°è‰¯å¥½çš„è®¿é—®è´¨é‡ã€‚</strong></p><h3 id="å†…å®¹ç®¡ç†"><a class="markdownIt-Anchor" href="#å†…å®¹ç®¡ç†"></a> å†…å®¹ç®¡ç†</h3><p>å†…å®¹ç®¡ç†å’Œå…¨å±€çš„ç½‘ç»œæµé‡ç®¡ç†(Traffic Management)æ˜¯ CDN çš„æ ¸å¿ƒæ‰€åœ¨ã€‚<strong>é€šè¿‡ç”¨æˆ·å°±è¿‘æ€§å’ŒæœåŠ¡å™¨è´Ÿè½½çš„åˆ¤æ–­ï¼ŒCDN ç¡®ä¿å†…å®¹ä»¥ä¸€ç§æä¸ºé«˜æ•ˆçš„æ–¹å¼ä¸ºç”¨æˆ·çš„è¯·æ±‚æä¾›æœåŠ¡</strong>ã€‚æ€»çš„æ¥è¯´ï¼Œå†…å®¹æœåŠ¡åŸºäº<strong>ç¼“å­˜æœåŠ¡å™¨</strong>ï¼Œä¹Ÿç§°ä½œ<strong>ä»£ç†ç¼“å­˜(Surrogate)</strong>ï¼Œå®ƒä½äºç½‘ç»œçš„è¾¹ç¼˜ï¼Œè·ç”¨æˆ·ä»…æœ‰&quot;ä¸€è·³&quot;(Single Hop)ä¹‹é¥ã€‚åŒæ—¶ï¼Œä»£ç†ç¼“å­˜æ˜¯å†…å®¹æä¾›å•†æºæœåŠ¡å™¨ï¼ˆé€šå¸¸ä½äº CDN æœåŠ¡æä¾›å•†çš„æ•°æ®ä¸­å¿ƒï¼‰çš„ä¸€ä¸ªé€æ˜é•œåƒã€‚è¿™æ ·çš„æ¶æ„ä½¿å¾— CDN æœåŠ¡æä¾›å•†èƒ½å¤Ÿä»£è¡¨ä»–ä»¬å®¢æˆ·ï¼Œå³å†…å®¹ä¾›åº”å•†ï¼Œå‘æœ€ç»ˆç”¨æˆ·æä¾›å°½å¯èƒ½å¥½çš„ä½“éªŒï¼Œè€Œè¿™äº›ç”¨æˆ·æ˜¯ä¸èƒ½å®¹å¿è¯·æ±‚å“åº”æ—¶é—´æœ‰ä»»ä½•å»¶è¿Ÿçš„ã€‚æ®ç»Ÿè®¡ï¼Œé‡‡ç”¨ CDN æŠ€æœ¯ï¼Œèƒ½å¤„ç†æ•´ä¸ªç½‘ç«™é¡µé¢çš„ 70%ï½ 95ï¼…çš„å†…å®¹è®¿é—®é‡ï¼Œå‡è½»æœåŠ¡å™¨çš„å‹åŠ›ï¼Œæå‡äº†ç½‘ç«™çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚</p><h3 id="è´Ÿè½½å‡è¡¡"><a class="markdownIt-Anchor" href="#è´Ÿè½½å‡è¡¡"></a> è´Ÿè½½å‡è¡¡</h3><p>CDN è´Ÿè½½å‡è¡¡ç³»ç»Ÿå®ç° CDN çš„<strong>å†…å®¹è·¯ç”±åŠŸèƒ½</strong>ã€‚å®ƒçš„ä½œç”¨æ˜¯å°†ç”¨æˆ·çš„è¯·æ±‚å¯¼å‘æ•´ä¸ª CDN ç½‘ç»œä¸­çš„æœ€ä½³èŠ‚ç‚¹ã€‚æœ€ä½³èŠ‚ç‚¹çš„é€‰å®šå¯ä»¥æ ¹æ®å¤šç§ç­–ç•¥ï¼Œä¾‹å¦‚<strong>è·ç¦»æœ€è¿‘</strong>ã€<strong>èŠ‚ç‚¹è´Ÿè½½æœ€è½»</strong>ç­‰ã€‚è´Ÿè½½å‡è¡¡ç³»ç»Ÿæ˜¯æ•´ä¸ª CDN çš„æ ¸å¿ƒï¼Œè´Ÿè½½å‡è¡¡çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ç›´æ¥å†³å®šäº†æ•´ä¸ª CDN çš„æ•ˆç‡å’Œæ€§èƒ½ã€‚é€šå¸¸è´Ÿè½½å‡è¡¡å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªå±‚æ¬¡ï¼š<strong>å…¨å±€è´Ÿè½½å‡è¡¡ï¼ˆGSLBï¼‰<strong>å’Œ</strong>æœ¬åœ°è´Ÿè½½å‡è¡¡ï¼ˆSLBï¼‰</strong>ã€‚</p><h3 id="ç½‘ç»œè¯·æ±‚çš„é‡å®šå‘"><a class="markdownIt-Anchor" href="#ç½‘ç»œè¯·æ±‚çš„é‡å®šå‘"></a> ç½‘ç»œè¯·æ±‚çš„é‡å®šå‘</h3><p>å½“ç”¨æˆ·è®¿é—®äº†ä½¿ç”¨ CDN æœåŠ¡çš„èµ„æºæ—¶ï¼ŒDNS åŸŸåæœåŠ¡å™¨é€šè¿‡ CNAME æ–¹å¼å°†æœ€ç»ˆåŸŸåè¯·æ±‚é‡å®šå‘åˆ° CDN ç³»ç»Ÿä¸­çš„æ™ºèƒ½ DNS è´Ÿè½½å‡è¡¡ç³»ç»Ÿã€‚<strong>æ™ºèƒ½ DNS è´Ÿè½½å‡è¡¡ç³»ç»Ÿé€šè¿‡ä¸€ç»„é¢„å…ˆå®šä¹‰å¥½çš„ç­–ç•¥ï¼ˆå¦‚å†…å®¹ç±»å‹ã€åœ°ç†åŒºåŸŸã€ç½‘ç»œè´Ÿè½½çŠ¶å†µç­‰ï¼‰ï¼Œå°†å½“æ—¶èƒ½å¤Ÿæœ€å¿«å“åº”ç”¨æˆ·çš„èŠ‚ç‚¹åœ°å€æä¾›ç»™ç”¨æˆ·ï¼Œä½¿ç”¨æˆ·å¯ä»¥å¾—åˆ°å¿«é€Ÿçš„æœåŠ¡</strong>ã€‚</p><p>åŒæ—¶ï¼Œå®ƒè¿˜ä¸åˆ†å¸ƒåœ¨ä¸åŒåœ°ç‚¹çš„æ‰€æœ‰ CDN èŠ‚ç‚¹ä¿æŒé€šä¿¡ï¼Œæœé›†å„èŠ‚ç‚¹çš„å¥åº·çŠ¶æ€ï¼Œç¡®ä¿ä¸å°†ç”¨æˆ·çš„è¯·æ±‚åˆ†é…åˆ°ä»»ä½•ä¸€ä¸ªå·²ç»ä¸å¯ç”¨çš„èŠ‚ç‚¹ä¸Šã€‚</p><blockquote><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.cnblogs.com/skynet/archive/2012/12/18/2824141.html" target="_blank" rel="noopener">CDN-å†…å®¹æ¨é€ç½‘ç»œ</a></li><li><a href="https://zhuanlan.zhihu.com/p/39028766" target="_blank" rel="noopener">é—²è¯ CDN</a></li></ul></blockquote><h2 id="cdn-è®¿é—®æµç¨‹"><a class="markdownIt-Anchor" href="#cdn-è®¿é—®æµç¨‹"></a> CDN è®¿é—®æµç¨‹</h2><div align="center"><img src="http://dunwu.test.upcdn.net/snap/1559126750010.png!zp"/></div><ol><li>ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è®¿é—®åŸŸåï¼ŒåŸŸåè§£æçš„è¯·æ±‚è¢«å‘å¾€ç½‘ç«™çš„ DNS åŸŸåè§£ææœåŠ¡å™¨ï¼›</li><li>ç”±äºç½‘ç«™çš„ DNS åŸŸåè§£ææœåŠ¡å™¨å¯¹æ­¤åŸŸåçš„è§£æè®¾ç½®äº† CNAMEï¼Œè¯·æ±‚è¢«æŒ‡å‘ CDN ç½‘ç»œä¸­çš„æ™ºèƒ½ DNS è´Ÿè½½å‡è¡¡ç³»ç»Ÿï¼›</li><li>æ™ºèƒ½ DNS è´Ÿè½½å‡è¡¡ç³»ç»Ÿå¯¹åŸŸåè¿›è¡Œæ™ºèƒ½è§£æï¼Œå°†å“åº”é€Ÿåº¦æœ€å¿«çš„èŠ‚ç‚¹ IP è¿”å›ç»™ç”¨æˆ·ï¼›æµè§ˆå™¨åœ¨å¾—åˆ°é€Ÿåº¦æœ€å¿«èŠ‚ç‚¹çš„ IP åœ°å€ä»¥åï¼Œå‘ CDN èŠ‚ç‚¹å‘å‡ºè®¿é—®è¯·æ±‚ï¼›</li><li>ç”±äºæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®ï¼ŒCDN èŠ‚ç‚¹å°†å›åˆ°æºç«™å–ç”¨æˆ·è¯·æ±‚çš„æ•°æ®å¹¶å‘ç»™ç”¨æˆ·ï¼›</li><li>å½“æœ‰å…¶ä»–ç”¨æˆ·å†æ¬¡è®¿é—®åŒæ ·å†…å®¹æ—¶ï¼ŒCDN å°†ç›´æ¥å°†æ•°æ®è¿”å›ç»™å®¢æˆ·ï¼Œå®Œæˆè¯·æ±‚/æœåŠ¡è¿‡ç¨‹ã€‚</li></ol><p>åŒæ—¶ï¼Œå®ƒè¿˜ä¸åˆ†å¸ƒåœ¨ä¸åŒåœ°ç‚¹çš„æ‰€æœ‰ CDN èŠ‚ç‚¹ä¿æŒé€šä¿¡ï¼Œæœé›†å„èŠ‚ç‚¹çš„å¥åº·çŠ¶æ€ï¼Œç¡®ä¿ä¸å°†ç”¨æˆ·çš„è¯·æ±‚åˆ†é…åˆ°ä»»ä½•ä¸€ä¸ªå·²ç»ä¸å¯ç”¨çš„èŠ‚ç‚¹ä¸Šã€‚</p><blockquote><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.cnblogs.com/skynet/archive/2012/12/18/2824141.html" target="_blank" rel="noopener">CDN-å†…å®¹æ¨é€ç½‘ç»œ</a></li><li><a href="https://zhuanlan.zhihu.com/p/39028766" target="_blank" rel="noopener">é—²è¯ CDN</a></li></ul></blockquote><h2 id="æ¨é€å’Œæ‹‰å–"><a class="markdownIt-Anchor" href="#æ¨é€å’Œæ‹‰å–"></a> æ¨é€å’Œæ‹‰å–</h2><p>CDN æœåŠ¡æœ‰æ¨é€å’Œæ‹‰å–ä¸¤ç§æ–¹å¼ï¼š</p><h3 id="cdn-æ¨é€"><a class="markdownIt-Anchor" href="#cdn-æ¨é€"></a> CDN æ¨é€</h3><p>å½“ä½ æœåŠ¡å™¨ä¸Šå†…å®¹å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œæ¨é€ CDN æ¥å—æ–°å†…å®¹ã€‚ç›´æ¥æ¨é€ç»™ CDN å¹¶é‡å†™ URL åœ°å€ä»¥æŒ‡å‘ä½ çš„å†…å®¹çš„ CDN åœ°å€ã€‚ä½ å¯ä»¥é…ç½®å†…å®¹åˆ°æœŸæ—¶é—´åŠä½•æ—¶æ›´æ–°ã€‚å†…å®¹åªæœ‰åœ¨æ›´æ”¹æˆ–æ–°å¢æ˜¯æ‰æ¨é€ï¼Œæµé‡æœ€å°åŒ–ï¼Œä½†å‚¨å­˜æœ€å¤§åŒ–ã€‚</p><p>ä¼˜ç‚¹åœ¨äºèŠ‚çœæºç«™å¸¦å®½ï¼Œæå‰å°†è¦åˆ†å‘çš„å†…å®¹æ”¾åˆ° CDN èŠ‚ç‚¹ä¸Šäº†ï¼Œå½“æŸä¸ªæµé‡é«˜å³°æ¥ä¸´æ—¶ï¼Œä¸ä¼šæŠŠä½ çš„æºç«™å¸¦å®½å æ»¡ï¼ˆæºç«™è¿˜è¦ç•™ç‚¹å¸¦å®½æä¾›åŠ¨æ€ HTML å•Šï¼‰ã€‚</p><p>ç¼ºç‚¹æ˜¯éœ€è¦é’ˆå¯¹ CDN åšæ¥å£å¼€å‘ï¼Œåœ¨è¢«åˆ†å‘å†…å®¹ç”Ÿæˆæ—¶ä¸»åŠ¨ä¸Šä¼ ç»™ CDNã€‚</p><h3 id="cdn-æ‹‰å–"><a class="markdownIt-Anchor" href="#cdn-æ‹‰å–"></a> CDN æ‹‰å–</h3><p>CDN æ‹‰å–æ˜¯å½“ç¬¬ä¸€ä¸ªç”¨æˆ·è¯·æ±‚è¯¥èµ„æºæ—¶ï¼Œä»æœåŠ¡å™¨ä¸Šæ‹‰å–èµ„æºã€‚ä½ å°†å†…å®¹ç•™åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šå¹¶é‡å†™ URL æŒ‡å‘ CDN åœ°å€ã€‚ç›´åˆ°å†…å®¹è¢«ç¼“å­˜åœ¨ CDN ä¸Šä¸ºæ­¢ï¼Œè¿™æ ·è¯·æ±‚åªä¼šæ›´æ…¢ï¼Œ</p><p><a href="https://en.wikipedia.org/wiki/Time_to_live" target="_blank" rel="noopener">å­˜æ´»æ—¶é—´ï¼ˆTTLï¼‰</a>å†³å®šç¼“å­˜å¤šä¹…æ—¶é—´ã€‚CDN æ‹‰å–æ–¹å¼æœ€å°åŒ– CDN ä¸Šçš„å‚¨å­˜ç©ºé—´ï¼Œä½†å¦‚æœè¿‡æœŸæ–‡ä»¶å¹¶åœ¨å®é™…æ›´æ”¹ä¹‹å‰è¢«æ‹‰å–ï¼Œåˆ™ä¼šå¯¼è‡´å†—ä½™çš„æµé‡ã€‚</p><p>é«˜æµé‡ç«™ç‚¹ä½¿ç”¨ CDN æ‹‰å–æ•ˆæœä¸é”™ï¼Œå› ä¸ºåªæœ‰æœ€è¿‘è¯·æ±‚çš„å†…å®¹ä¿å­˜åœ¨ CDN ä¸­ï¼Œæµé‡æ‰èƒ½æ›´å¹³è¡¡åœ°åˆ†æ•£ã€‚</p><p>ä¼˜ç‚¹åœ¨äºå®ç°ç®€å•ã€‚</p><blockquote><p>å‚è€ƒï¼š<a href="https://segmentfault.com/q/1010000000119794" target="_blank" rel="noopener">æ¨é€å¼ä¸æ‹‰å–å¼ CDN æœåŠ¡çš„ä¼˜åŠ£é—®é¢˜</a></p></blockquote><h2 id="èµ„æº"><a class="markdownIt-Anchor" href="#èµ„æº"></a> èµ„æº</h2><ul><li>æ–‡ç« <ul><li><a href="https://en.wikipedia.org/wiki/Content_delivery_network" target="_blank" rel="noopener">Wikipedia - CDN</a></li><li><a href="https://www.cnblogs.com/skynet/archive/2012/12/18/2824141.html" target="_blank" rel="noopener">CDN-å†…å®¹æ¨é€ç½‘ç»œ</a></li><li><a href="https://zhuanlan.zhihu.com/p/39028766" target="_blank" rel="noopener">é—²è¯ CDN</a></li><li><a href="https://www.cnblogs.com/losbyday/p/5843960.html" target="_blank" rel="noopener">CDN æŠ€æœ¯è¯¦è§£</a></li><li><a href="https://segmentfault.com/q/1010000000119794" target="_blank" rel="noopener">æ¨é€å¼ä¸æ‹‰å–å¼ CDN æœåŠ¡çš„ä¼˜åŠ£é—®é¢˜</a></li></ul></li><li>CDN èµ„æº<ul><li><a href="https://staticfile.org/" target="_blank" rel="noopener">https://staticfile.org/</a></li><li><a href="https://unpkg.com/" target="_blank" rel="noopener">https://unpkg.com/</a></li><li><a href="https://cdnjs.com/" target="_blank" rel="noopener">https://cdnjs.com/</a></li><li><a href="https://github.com/ossrs/srs" target="_blank" rel="noopener">https://github.com/ossrs/srs</a></li><li><a href="https://github.com/jsdelivr/jsdelivr" target="_blank" rel="noopener">https://github.com/jsdelivr/jsdelivr</a></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;div align=&quot;center&quot;&gt;&lt;img src=&quot;http://dunwu.test.upcdn.net/snap/1559138689425.png!zp&quot;/&gt;&lt;/div&gt;
&lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;
      
    
    </summary>
    
    
      <category term="é€šä¿¡" scheme="https://dunwu.github.io/blog/categories/%E9%80%9A%E4%BF%A1/"/>
    
    
      <category term="é€šä¿¡" scheme="https://dunwu.github.io/blog/tags/%E9%80%9A%E4%BF%A1/"/>
    
      <category term="ç½‘ç»œ" scheme="https://dunwu.github.io/blog/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>Mac å¸¸ç”¨æŠ€å·§æ€»ç»“</title>
    <link href="https://dunwu.github.io/blog/os/mac/"/>
    <id>https://dunwu.github.io/blog/os/mac/</id>
    <published>2019-05-07T12:35:00.000Z</published>
    <updated>2019-11-22T03:31:57.012Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸºæœ¬æ“ä½œ"><a class="markdownIt-Anchor" href="#åŸºæœ¬æ“ä½œ"></a> åŸºæœ¬æ“ä½œ</h2><h3 id="è½¯ä»¶ç®¡ç†"><a class="markdownIt-Anchor" href="#è½¯ä»¶ç®¡ç†"></a> è½¯ä»¶ç®¡ç†</h3><p>dmg æ ¼å¼ï¼šåŒå‡»å®‰è£…åŒ…ï¼Œç„¶åæ‹–åˆ° applications æ–‡ä»¶å¤¹ä¸‹å³å¯ã€‚</p><h3 id="æµè§ˆå™¨"><a class="markdownIt-Anchor" href="#æµè§ˆå™¨"></a> æµè§ˆå™¨</h3><h4 id="æ›´æ”¹é»˜è®¤æœç´¢å¼•æ“"><a class="markdownIt-Anchor" href="#æ›´æ”¹é»˜è®¤æœç´¢å¼•æ“"></a> æ›´æ”¹é»˜è®¤æœç´¢å¼•æ“</h4><p>é€‰æ‹©ã€Œåå¥½è®¾ç½®â€“&gt;æœç´¢â€“&gt;æœç´¢å¼•æ“â€“&gt;Googleã€ã€‚</p><h4 id="å¯¼å…¥-chrome-æµè§ˆå™¨çš„ä¹¦ç­¾"><a class="markdownIt-Anchor" href="#å¯¼å…¥-chrome-æµè§ˆå™¨çš„ä¹¦ç­¾"></a> å¯¼å…¥ chrome æµè§ˆå™¨çš„ä¹¦ç­¾</h4><p>é€‰æ‹©ã€Œæ–‡ä»¶â€“&gt;å¯¼å…¥è‡ªâ€“&gt; Google Chromeã€ï¼Œç„¶åé€‰æ‹©è¦å¯¼å…¥çš„é¡¹ç›®ã€‚</p><h4 id="å¿«æ·é”®"><a class="markdownIt-Anchor" href="#å¿«æ·é”®"></a> å¿«æ·é”®</h4><p>Command + R åˆ·æ–°</p><h4 id="ä¸Šæ–¹æ˜¾ç¤ºä¹¦ç­¾æ æ”¶è—æ "><a class="markdownIt-Anchor" href="#ä¸Šæ–¹æ˜¾ç¤ºä¹¦ç­¾æ æ”¶è—æ "></a> ä¸Šæ–¹æ˜¾ç¤ºä¹¦ç­¾æ ï¼æ”¶è—æ </h4><p>é€‰æ‹©ã€Œæ˜¾ç¤ºâ€“&gt; æ˜¾ç¤ºä¸ªäººæ”¶è—æ ã€ã€‚</p><h4 id="å…³é—­è½¯ä»¶çš„å³ä¸Šè§’é€šçŸ¥"><a class="markdownIt-Anchor" href="#å…³é—­è½¯ä»¶çš„å³ä¸Šè§’é€šçŸ¥"></a> å…³é—­è½¯ä»¶çš„å³ä¸Šè§’é€šçŸ¥</h4><p>åœ¨ Mac ç³»ç»Ÿä¸­æœ‰å¯¹é€šçŸ¥çš„è®¾ç½®ï¼Œæ‰“å¼€ç³»ç»Ÿåå¥½è®¾ç½® â€” é€šçŸ¥ æ‰¾åˆ° QQï¼Œç„¶åå°† QQ æç¤ºæ ·å¼è®¾ç½®æˆæ— å³å¯ã€‚</p><h4 id="å¤åˆ¶æ–‡ä»¶æ–‡ä»¶å¤¹è·¯å¾„"><a class="markdownIt-Anchor" href="#å¤åˆ¶æ–‡ä»¶æ–‡ä»¶å¤¹è·¯å¾„"></a> å¤åˆ¶æ–‡ä»¶/æ–‡ä»¶å¤¹è·¯å¾„</h4><ul><li>OS X 10.11 ç³»ç»Ÿï¼Œé€‰ä¸­æ–‡ä»¶å¤¹ï¼Œã€Œcmd +Option +cã€ å¤åˆ¶æ–‡ä»¶å¤¹è·¯å¾„ï¼Œcmd+v ç²˜è´´ã€‚<br />ä¹‹å‰çš„ç³»ç»Ÿï¼Œåˆ©ç”¨ Administrator åˆ›å»ºä¸€ä¸ªåˆ°å³é”®èœå•ï¼Œç„¶ååˆ°è®¾ç½®é‡Œé¢è®¾ç½®å¿«æ·é”®ã€‚å…·ä½“æ“ä½œè¯·ç™¾åº¦ã€‚</li></ul><h4 id="æ‰“å¼€æ¥è‡ªèº«ä»½ä¸æ˜çš„å¼€å‘è€…çš„åº”ç”¨ç¨‹åº"><a class="markdownIt-Anchor" href="#æ‰“å¼€æ¥è‡ªèº«ä»½ä¸æ˜çš„å¼€å‘è€…çš„åº”ç”¨ç¨‹åº"></a> æ‰“å¼€æ¥è‡ªèº«ä»½ä¸æ˜çš„å¼€å‘è€…çš„åº”ç”¨ç¨‹åº</h4><p>åœ¨åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹ï¼ŒæŒ‰ä½ control é”®çš„åŒæ—¶æ‰“å¼€åº”ç”¨ç¨‹åºã€‚</p><h4 id="å¤åˆ¶æ–‡ä»¶è·¯å¾„"><a class="markdownIt-Anchor" href="#å¤åˆ¶æ–‡ä»¶è·¯å¾„"></a> å¤åˆ¶æ–‡ä»¶è·¯å¾„</h4><ul><li><p>é€‰æ‹©æ–‡ä»¶ï¼æ–‡ä»¶å¤¹æŒ‰ Command+C å¤åˆ¶ï¼Œåœ¨ç»ˆç«¯ä¸­ Command+V ç²˜è´´å³å¯ã€‚</p></li><li><p>å¦‚æœåªæ˜¯æƒ³åœ¨ Finder ä¸­çœ‹åˆ°æ–‡ä»¶çš„è·¯å¾„, å¹¶æ–¹ä¾¿åˆ‡æ¢å±‚çº§, Finder å†…ç½®äº†ã€Œæ˜¾ç¤ºè·¯å¾„æ ã€çš„åŠŸèƒ½, å¹¶é…ç½®äº†å¿«æ·é”®(Option+Cmd+P). å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p></li></ul><p>20161124-184148.png</p><p>å‚è€ƒé“¾æ¥ï¼š</p><ul><li>[<a href="https://www.zhihu.com/question/22883229" target="_blank" rel="noopener">https://www.zhihu.com/question/22883229</a>]</li></ul><h3 id="éšè—å’Œå–æ¶ˆéšè—-mac-app-store-ä¸­çš„å·²è´­é¡¹ç›®"><a class="markdownIt-Anchor" href="#éšè—å’Œå–æ¶ˆéšè—-mac-app-store-ä¸­çš„å·²è´­é¡¹ç›®"></a> éšè—å’Œå–æ¶ˆéšè— Mac App Store ä¸­çš„å·²è´­é¡¹ç›®</h3><h3 id="mac-åŒæ—¶ç™»é™†ä¸¤ä¸ª-qq"><a class="markdownIt-Anchor" href="#mac-åŒæ—¶ç™»é™†ä¸¤ä¸ª-qq"></a> Mac åŒæ—¶ç™»é™†ä¸¤ä¸ª QQ</h3><p>åœ¨å·²ç»æ‰“å¼€çš„ QQ ä¸­ï¼ŒæŒ‰ä½ã€Œcommand + Nã€å³å¯ã€‚</p><h2 id="ç³»ç»Ÿä¾¿å¥½è®¾ç½®"><a class="markdownIt-Anchor" href="#ç³»ç»Ÿä¾¿å¥½è®¾ç½®"></a> ç³»ç»Ÿä¾¿å¥½è®¾ç½®</h2><h3 id="è¯­éŸ³æ’­æŠ¥"><a class="markdownIt-Anchor" href="#è¯­éŸ³æ’­æŠ¥"></a> è¯­éŸ³æ’­æŠ¥</h3><p>æ‰“å¼€ã€Œç³»ç»Ÿä¾¿å¥½è®¾ç½®â€“&gt;è¾…åŠ©åŠŸèƒ½â€“&gt;è¯­éŸ³ã€ï¼Œå³å¯è®¾ç½®ä¸åŒå›½å®¶çš„è¯­è¨€ã€‚</p><p>å‹¾é€‰ä¸Šå›¾ä¸­çš„çº¢æ¡†éƒ¨åˆ†ï¼Œå¯ä»¥è®¾ç½®å…¨å±€å¿«æ·é”®ã€‚è¿™æ ·çš„è¯ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªè½¯ä»¶å½“ä¸­ï¼ŒæŒ‰ä¸‹ã€Œ option+escã€æ—¶ï¼Œå°±ä¼šæœ—è¯»é€‰ä¸­çš„æ–‡æœ¬ã€‚</p><h3 id="è°ƒæ•´å­—ä½“å¤§å°"><a class="markdownIt-Anchor" href="#è°ƒæ•´å­—ä½“å¤§å°"></a> è°ƒæ•´å­—ä½“å¤§å°</h3><p>Mac è°ƒæ•´å­—ä½“å¤§å°ï¼šã€Œç³»ç»Ÿåå¥½è®¾ç½® -&gt; æ˜¾ç¤ºå™¨ -&gt; ç¼©æ”¾ã€ã€‚å¦‚ä¸‹å›¾ï¼š</p><h3 id="å¦‚ä½•åˆ†åˆ«è®¾ç½®-mac-çš„é¼ æ ‡å’Œè§¦æ§æ¿çš„æ»šåŠ¨æ–¹å‘"><a class="markdownIt-Anchor" href="#å¦‚ä½•åˆ†åˆ«è®¾ç½®-mac-çš„é¼ æ ‡å’Œè§¦æ§æ¿çš„æ»šåŠ¨æ–¹å‘"></a> å¦‚ä½•åˆ†åˆ«è®¾ç½® Mac çš„é¼ æ ‡å’Œè§¦æ§æ¿çš„æ»šåŠ¨æ–¹å‘</h3><p>å¾ˆå¤šäººä¹ æƒ¯é¼ æ ‡ä½¿ç”¨ç›¸åçš„æ»šåŠ¨æ–¹å‘ï¼Œè€Œè§¦æ§æ¿ç±»ä¼¼ iPad é‚£æ ·çš„è‡ªç„¶æ»šåŠ¨ï¼Œé—®å¦‚ä½•è®¾ç½®ï¼Œå½“æ—¶æˆ‘çš„å›ç­”æ˜¯ä¸çŸ¥é“ï¼Œå› ä¸ºç›®å‰ OS X çš„ç³»ç»Ÿè®¾ç½®é‡Œï¼Œé¼ æ ‡å’Œè§¦æ§æ¿çš„è®¾ç½®æ˜¯ç»Ÿä¸€<br />çš„ã€‚ä»Šå¤©å‘ç°äº†ä¸€ä¸ªå…è´¹çš„è½¯ä»¶ Scroll Reverserï¼Œå¯ä»¥å®ç°é¼ æ ‡å’Œè§¦æ§æ¿çš„åˆ†åˆ«è®¾ç½®ã€‚ä¸‹è½½åœ°å€ï¼š<a href="https://pilotmoon.com/scrollreverser/" target="_blank" rel="noopener">https://pilotmoon.com/scrollreverser/</a><br />å¯åŠ¨åç¨‹åºæ˜¾ç¤ºåœ¨é¡¶éƒ¨èœå•æ ï¼Œè®¾ç½®ç®€å•æ˜äº†ï¼Œæœ‰éœ€è¦çš„ç”¨æˆ·ä½“éªŒä¸€ä¸‹å§ã€‚</p><h3 id="touch-bar-è‡ªå®šä¹‰"><a class="markdownIt-Anchor" href="#touch-bar-è‡ªå®šä¹‰"></a> Touch Bar è‡ªå®šä¹‰</h3><p>æ‰“å¼€ã€Œç³»ç»Ÿåå¥½è®¾ç½®-é”®ç›˜ã€ï¼Œä¸‹é¢æœ‰ä¸ªè‡ªå®šä¹‰æ§åˆ¶æ¡ã€‚</p><h3 id="è‰²æ¸©è°ƒèŠ‚å¤œé—´æ¨¡å¼"><a class="markdownIt-Anchor" href="#è‰²æ¸©è°ƒèŠ‚å¤œé—´æ¨¡å¼"></a> è‰²æ¸©è°ƒèŠ‚ï¼šå¤œé—´æ¨¡å¼</h3><p>iOS9.3 çš„æœ€æ˜æ˜¾å˜åŒ–ï¼Œè«è¿‡äºè‹¹æœåœ¨å‘å¸ƒä¼šä¸Šç‰¹æ„æåˆ°çš„ Night Shift å¤œé—´æŠ¤çœ¼æ¨¡å¼ã€‚</p><h3 id="icloud-é‚®ç®±"><a class="markdownIt-Anchor" href="#icloud-é‚®ç®±"></a> iCloud é‚®ç®±</h3><p>å¦‚æœæ‚¨ç”¨äºè®¾ç½® iCloud çš„ Apple ID ä¸ä»¥â€œ@icloud.comâ€ã€â€œ@me.comâ€æˆ–â€œ@mac.comâ€ç»“å°¾ï¼Œæ‚¨å¿…é¡»å…ˆè®¾ç½®ä¸€ä¸ªâ€œ@icloud.comâ€ç”µå­é‚®ä»¶åœ°å€ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨ iCloudâ€œé‚®ä»¶â€ã€‚</p><p>å¦‚æœæ‚¨æ‹¥æœ‰ä»¥â€œ@mac.comâ€æˆ–â€œ@me.comâ€ç»“å°¾çš„ç”µå­é‚®ä»¶åœ°å€ï¼Œåˆ™æ‚¨å·²ç»æ‹¥æœ‰äº†åç§°ç›¸åŒä½†ä»¥â€œ@icloud.comâ€ç»“å°¾çš„ç­‰æ•ˆåœ°å€ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„ç”µå­é‚®ä»¶åˆ«åä»¥â€œ@mac.comâ€æˆ–â€œ@me.comâ€ç»“å°¾ï¼Œæ‚¨ä¹Ÿå°†æ‹¥æœ‰ä»¥â€œ@icloud.comâ€ç»“å°¾çš„ç­‰æ•ˆåœ°å€ã€‚</p><p><strong>æ“ä½œå¦‚ä¸‹ï¼š</strong></p><ul><li><p>åœ¨ iOS è®¾å¤‡ä¸Šï¼Œå‰å¾€â€œè®¾ç½®â€&gt;â€œiCloudâ€ï¼Œå¼€å¯â€œé‚®ä»¶â€ï¼Œç„¶åæŒ‰ç…§å±å¹•ä¸Šçš„è¯´æ˜æ“ä½œã€‚</p></li><li><p>åœ¨ Mac ä¸Šï¼Œé€‰å– Apple èœå• &gt;â€œç³»ç»Ÿåå¥½è®¾ç½®â€ï¼Œç‚¹æŒ‰â€œiCloudâ€ï¼Œå†é€‰æ‹©â€œé‚®ä»¶â€ï¼Œç„¶åæŒ‰ç…§å±å¹•ä¸Šçš„è¯´æ˜æ“ä½œã€‚</p></li></ul><p>PSï¼šåˆ›å»º iCloud ç”µå­é‚®ä»¶åœ°å€åï¼Œæ‚¨æ— æ³•å¯¹å…¶è¿›è¡Œæ›´æ”¹ã€‚</p><p>è®¾ç½® @icloud.com ç”µå­é‚®ä»¶åœ°å€åå³å¯ç”¨å…¶ç™»å½• iCloudã€‚æ‚¨ä¹Ÿå¯ä»¥ç”¨åˆ›å»º iCloud å¸æˆ·æ—¶æ‰€ç”¨çš„ Apple ID ç™»å½•ã€‚</p><p>æ‚¨å¯ä»¥ä»ä»¥ä¸‹ä»»æ„åœ°å€å‘é€ iCloud ç”µå­é‚®ä»¶ï¼š</p><p>æ‚¨çš„ iCloud ç”µå­é‚®ä»¶åœ°å€ï¼ˆæ‚¨çš„å¸å·åç§°@icloud.comï¼‰</p><p>åˆ«å</p><p>å‚è€ƒé“¾æ¥ï¼š</p><p><strong>ç›´æ¥æ³¨å†Œä»¥@icloud.com ç»“å°¾çš„ Apple IDï¼š</strong></p><p>å‚è€ƒé“¾æ¥ï¼š</p><h2 id="podcast"><a class="markdownIt-Anchor" href="#podcast"></a> PodCast</h2><p>PodCast ä¸­æ–‡ç¿»è¯‘ä¸ºæ’­å®¢ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„éŸ³é¢‘ or è§†é¢‘èŠ‚ç›®ã€‚PodCast è¿™ä¸ªå•è¯æ˜¯ç”± iPod+Broadcast è¿™ä¸¤ä¸ªå•è¯ç»„æˆçš„ã€‚</p><p>PodCast å¯ä»¥åœ¨ iTunes ä¸­æ”¶å¬ã€‚</p><h2 id="others"><a class="markdownIt-Anchor" href="#others"></a> others</h2><h3 id="è¯å…¸"><a class="markdownIt-Anchor" href="#è¯å…¸"></a> è¯å…¸</h3><p>ç³»ç»Ÿæœ‰ä¸€ä¸ªè‡ªå¸¦åº”ç”¨ã€Œè¯å…¸ã€ï¼Œå¯ä»¥è¿›è¡Œå•è¯çš„æŸ¥è¯¢ã€‚</p><h3 id="å¦‚ä½•è§£å†³-mac-è½¯ä»¶dmgakpappå‡ºç°ç¨‹åºå·²æŸåçš„æç¤º"><a class="markdownIt-Anchor" href="#å¦‚ä½•è§£å†³-mac-è½¯ä»¶dmgakpappå‡ºç°ç¨‹åºå·²æŸåçš„æç¤º"></a> å¦‚ä½•è§£å†³ MAC è½¯ä»¶ï¼ˆdmgï¼Œakpï¼Œappï¼‰å‡ºç°ç¨‹åºå·²æŸåçš„æç¤º</h3><p>ã€Œxxx.app å·²æŸå,æ‰“ä¸å¼€.ä½ åº”è¯¥å°†å®ƒç§»åˆ°åºŸçº¸ç¯“ã€ï¼Œå¹¶éä½ å®‰è£…çš„è½¯ä»¶å·²æŸåï¼Œè€Œæ˜¯ Mac ç³»ç»Ÿçš„å®‰å…¨è®¾ç½®é—®é¢˜ï¼Œå› ä¸ºè¿™äº›åº”ç”¨éƒ½æ˜¯ç ´è§£æˆ–è€…æ±‰åŒ–çš„,é‚£ä¹ˆè§£å†³æ–¹æ³•å°±æ˜¯ä¸´æ—¶æ”¹å˜ Mac ç³»ç»Ÿå®‰å…¨è®¾ç½®ã€‚</p><p>å‡ºç°è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•ï¼šä¿®æ”¹ç³»ç»Ÿé…ç½®ï¼šç³»ç»Ÿåå¥½è®¾ç½®â€¦ -&gt; å®‰å…¨æ€§ä¸éšç§ã€‚ä¿®æ”¹ä¸ºä»»ä½•æ¥æºã€‚</p><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªé€‰é¡¹çš„è¯ï¼ˆmacOS Sierra 10.12ï¼‰,æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo spctl --master-disable</span><br></pre></td></tr></table></figure><p>å³å¯ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š</p><ul><li><p><a href="http://www.jianshu.com/p/379b49b88df9" target="_blank" rel="noopener">Max OS-[xxx.app å·²æŸå,æ‰“ä¸å¼€.ä½ åº”è¯¥å°†å®ƒç§»åˆ°åºŸçº¸ç¯“]</a></p></li><li><p><a href="http://www.yunrui.co/25693.html" target="_blank" rel="noopener">å¦‚ä½•è§£å†³ MAC è½¯ä»¶ï¼ˆdmgï¼Œakpï¼Œappï¼‰å‡ºç°ç¨‹åºå·²æŸåçš„æç¤º</a></p></li></ul><p>å¤‡æ³¨ï¼šè¿™ä¸ªé“¾æ¥é‡Œçš„å„ç§èµ„æºéƒ½å¾ˆä¸é”™å•Šã€‚</p><h4 id="ç»ˆç«¯"><a class="markdownIt-Anchor" href="#ç»ˆç«¯"></a> ç»ˆç«¯</h4><h4 id="åœ¨-finder-çš„å½“å‰ç›®å½•æ‰“å¼€ç»ˆç«¯"><a class="markdownIt-Anchor" href="#åœ¨-finder-çš„å½“å‰ç›®å½•æ‰“å¼€ç»ˆç«¯"></a> åœ¨ Finder çš„å½“å‰ç›®å½•æ‰“å¼€ç»ˆç«¯</h4><p>åœ¨ Finder æ‰“å¼€ terminal ç»ˆç«¯è¿™ä¸ªåŠŸèƒ½å…¶å®æ˜¯æœ‰çš„ï¼Œä½†æ˜¯ç³»ç»Ÿé»˜è®¤æ²¡æœ‰æ‰“å¼€ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•å°†å…¶æ‰“å¼€ï¼š</p><p>è¿›å…¥ç³»ç»Ÿåå¥½è®¾ç½®-&gt;é”®ç›˜-&gt;å¿«æ·é”®-&gt;æœåŠ¡ã€‚</p><p>åœ¨å³è¾¹æ–°å»ºä½äºæ–‡ä»¶å¤¹ä½ç½®çš„ç»ˆç«¯çª—å£ä¸Šæ‰“å‹¾ã€‚</p><p>å¦‚æ­¤è®¾ç½®åï¼Œåœ¨ Finder ä¸­å³å‡»æŸæ–‡ä»¶ï¼Œåœ¨å‡ºç°çš„èœå•ä¸­æ‰¾åˆ°æœåŠ¡ï¼Œç„¶åç‚¹å‡»æ–°å»ºä½äºæ–‡ä»¶å¤¹ä½ç½®çš„ç»ˆç«¯çª—å£å³å¯ï¼</p><h2 id="mac-å¸¸ç”¨å¿«æ·é”®"><a class="markdownIt-Anchor" href="#mac-å¸¸ç”¨å¿«æ·é”®"></a> Mac å¸¸ç”¨å¿«æ·é”®</h2><h3 id="finder"><a class="markdownIt-Anchor" href="#finder"></a> Finder</h3><table><thead><tr><th style="text-align:left">å¿«æ·é”®</th><th style="text-align:left">ä½œç”¨</th><th style="text-align:left">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:left">Shift + Command + G</td><td style="text-align:left">å‰å¾€æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶å¤¹</td><td style="text-align:left">åŒ…æ‹¬éšè—æ–‡ä»¶å¤¹</td></tr><tr><td style="text-align:left">Shift + Command + .</td><td style="text-align:left">æ˜¾ç¤ºéšè—æ–‡ä»¶ã€æ–‡ä»¶å¤¹</td><td style="text-align:left">å†æŒ‰ä¸€æ¬¡ï¼Œæ¢å¤éšè—</td></tr><tr><td style="text-align:left">Command + â†‘</td><td style="text-align:left">è¿”å›ä¸Šä¸€å±‚</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">Command + â†“</td><td style="text-align:left">è¿›å…¥å½“å‰æ–‡ä»¶å¤¹</td><td style="text-align:left"></td></tr></tbody></table><h3 id="ç¼–è¾‘"><a class="markdownIt-Anchor" href="#ç¼–è¾‘"></a> ç¼–è¾‘</h3><p><strong>åˆ é™¤æ–‡å­—</strong>ï¼š</p><table><thead><tr><th style="text-align:left">å¿«æ·é”®</th><th style="text-align:left">ä½œç”¨</th><th style="text-align:left">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:left">delete</td><td style="text-align:left">åˆ é™¤å…‰æ ‡çš„å‰ä¸€ä¸ªå­—ç¬¦</td><td style="text-align:left">ç›¸å½“äº Windows é”®ç›˜ä¸Šçš„é€€æ ¼é”®</td></tr><tr><td style="text-align:left">fn + delete</td><td style="text-align:left">åˆ é™¤å…‰æ ‡çš„åä¸€ä¸ªå­—ç¬¦</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">option + delete</td><td style="text-align:left">åˆ é™¤å…‰æ ‡ä¹‹å‰çš„ä¸€ä¸ªå•è¯</td><td style="text-align:left">è‹±æ–‡æœ‰æ•ˆ</td></tr><tr><td style="text-align:left"><strong>command + delete</strong></td><td style="text-align:left">åˆ é™¤å…‰æ ‡ä¹‹å‰çš„æ•´è¡Œå†…å®¹</td><td style="text-align:left">ã€èã€‘</td></tr><tr><td style="text-align:left">command + delete</td><td style="text-align:left">åœ¨ finder ä¸­åˆ æ‰è¯¥æ–‡ä»¶</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">shift + command + delete</td><td style="text-align:left">æ¸…ç©ºå›æ”¶ç«™</td><td style="text-align:left"></td></tr></tbody></table><p><strong>å‰ªåˆ‡æ–‡ä»¶</strong>ï¼š</p><p>é¦–å…ˆé€‰ä¸­æ–‡ä»¶ï¼ŒæŒ‰ Command+C å¤åˆ¶æ–‡ä»¶ï¼›ç„¶åæŒ‰ã€ŒCommand ï¼‹ Option ï¼‹ Vã€å‰ªåˆ‡æ–‡ä»¶ã€‚</p><p>å¤‡æ³¨ï¼šCommand+X åªèƒ½å‰ªåˆ‡æ–‡å­—æ–‡æœ¬ï¼Œä¸è¦æ··æ·†äº†ã€‚</p><h2 id="mac-ç”¨æˆ·å¿…é¡»çŸ¥é“çš„-15-ç»„å¿«æ·é”®"><a class="markdownIt-Anchor" href="#mac-ç”¨æˆ·å¿…é¡»çŸ¥é“çš„-15-ç»„å¿«æ·é”®"></a> Mac ç”¨æˆ·å¿…é¡»çŸ¥é“çš„ 15 ç»„å¿«æ·é”®</h2><blockquote><p>å‚è€ƒé“¾æ¥ï¼š<a href="http://v.youku.com/v_show/id_XNDE4MzM0NDgw.html" target="_blank" rel="noopener">ã€Šè½»æ¾ç© Macã€‹ç¬¬ 6 æœŸï¼šMac ç”¨æˆ·å¿…é¡»çŸ¥é“çš„ 15 ç»„å¿«æ·é”®</a></p></blockquote><h3 id="spaceé”®å¿«é€Ÿé¢„è§ˆ"><a class="markdownIt-Anchor" href="#spaceé”®å¿«é€Ÿé¢„è§ˆ"></a> ã€Œspaceã€é”®ï¼šå¿«é€Ÿé¢„è§ˆ</h3><p>é€‰ä¸­æ–‡ä»¶åï¼Œ ä¸éœ€è¦å¯åŠ¨ä»»ä½•åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨ã€Œspaceã€ç©ºæ ¼é”®å¯è¿›è¡Œå¿«é€Ÿé¢„è§ˆï¼Œå†æ¬¡æŒ‰ä¸‹ã€Œspaceã€ç©ºæ ¼é”®å–æ¶ˆé¢„è§ˆã€‚</p><p>å¯ä»¥é¢„è§ˆ mp3ã€è§†é¢‘ã€pdf ç­‰æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥<strong>é€‰ä¸­å¤šå¼ å›¾ç‰‡</strong>ï¼Œ ç„¶åæŒ‰ã€Œspaceã€é”®ï¼Œå°±å¯ä»¥åŒæ—¶å¯¹æ¯”é¢„è§ˆå¤šå¼ å›¾ç‰‡ã€‚è¿™ä¸€ç‚¹ï¼Œå¾ˆèµã€‚</p><h3 id="æ”¹å"><a class="markdownIt-Anchor" href="#æ”¹å"></a> æ”¹å</h3><p>é€‰ä¸­æ–‡ä»¶/æ–‡ä»¶å¤¹åï¼ŒæŒ‰ enter é”®ï¼Œå°±å¯ä»¥æ”¹åäº†ã€‚</p><h3 id="command-ié”®æŸ¥çœ‹æ–‡ä»¶å±æ€§"><a class="markdownIt-Anchor" href="#command-ié”®æŸ¥çœ‹æ–‡ä»¶å±æ€§"></a> ã€Œcommand + Iã€é”®ï¼šæŸ¥çœ‹æ–‡ä»¶å±æ€§</h3><ul><li><p>é€‰ä¸­æ–‡ä»¶åï¼ŒæŒ‰ã€Œcommand + Iã€é”®ï¼Œå¯ä»¥æŸ¥çœ‹æ–‡ä»¶çš„å„ç§å±æ€§ã€‚</p></li><li><p>é€‰ä¸­<strong>æ–‡ä»¶å¤¹</strong>åï¼ŒæŒ‰ã€Œcommand + Iã€é”®ï¼Œå¯ä»¥æŸ¥çœ‹æ–‡ä»¶å¤¹çš„å¤§å°ã€‚ã€èã€‘</p></li></ul><h3 id="åˆ‡æ¢è¾“å…¥æ³•"><a class="markdownIt-Anchor" href="#åˆ‡æ¢è¾“å…¥æ³•"></a> åˆ‡æ¢è¾“å…¥æ³•</h3><p>ã€Œcontrol + spaceã€</p><h3 id="æ‰“å¼€-spotlight-æœç´¢æ¡†"><a class="markdownIt-Anchor" href="#æ‰“å¼€-spotlight-æœç´¢æ¡†"></a> æ‰“å¼€ spotlight æœç´¢æ¡†</h3><p>spotlight æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„è½¯ä»¶ï¼Œæœç´¢åŠŸèƒ½ä¸æ˜¯å¾ˆå¼ºå¤§ã€‚æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šç”¨ç¬¬ä¸‰æ–¹çš„ Alfred è½¯ä»¶ã€‚</p><h3 id="ç¼–è¾‘ç›¸å…³"><a class="markdownIt-Anchor" href="#ç¼–è¾‘ç›¸å…³"></a> ç¼–è¾‘ç›¸å…³</h3><p>Cmd+Cã€Cmd+Vã€Cmd+Xã€Cmd+Aã€Cmd+Zã€‚</p><h3 id="ç¿»é¡µå’Œå…‰æ ‡"><a class="markdownIt-Anchor" href="#ç¿»é¡µå’Œå…‰æ ‡"></a> ç¿»é¡µå’Œå…‰æ ‡</h3><ul><li><p>ã€Œcontrol + â†‘ã€ï¼šå°†å…‰æ ‡å®šä½åˆ°æ–‡ç« çš„æœ€å¼€å¤´ï¼ˆç¿»é¡µåˆ°æ–‡æ¡£çš„æœ€ä¸Šæ–¹ï¼‰</p></li><li><p>ã€Œcontrol + â†“ã€ï¼šå°†å…‰æ ‡å®šä½åˆ°æ–‡ç« çš„æœ€æœ«å°¾ï¼ˆç¿»é¡µåˆ°æ–‡æ¡£çš„æœ€ä¸‹æ–¹ï¼‰</p></li><li><p>ã€Œcontrol + â†ã€ï¼šå°†å…‰æ ‡å®šä½åˆ°å½“å‰è¡Œçš„æœ€å·¦ä¾§</p></li><li><p>ã€Œcontrol + â†’ã€ï¼šå°†å…‰æ ‡å®šä½åˆ°å½“å‰è¡Œçš„æœ€å³ä¾§</p></li></ul><h3 id="command-shift-yå°†æ–‡å­—å¿«é€Ÿä¿å­˜åˆ°ä¾¿ç¬º"><a class="markdownIt-Anchor" href="#command-shift-yå°†æ–‡å­—å¿«é€Ÿä¿å­˜åˆ°ä¾¿ç¬º"></a> ã€Œcommand + shift + Yã€ï¼šå°†æ–‡å­—å¿«é€Ÿä¿å­˜åˆ°ä¾¿ç¬º</h3><p>é€‰ä¸­ä½ æƒ³è¦çš„å†…å®¹ï¼ˆä¾‹å¦‚æ–‡å­—ã€é“¾æ¥ç­‰ï¼‰ï¼Œç„¶åæŒ‰ä¸‹ command + shift + Yã€ï¼Œé‚£ä¹ˆä½ é€‰ä¸­çš„å†…å®¹å°±ä¼šå¿«é€Ÿä¿å­˜åˆ°ç³»ç»Ÿè‡ªå¸¦çš„ã€Œä¾¿ç¬ºã€è½¯ä»¶ä¸­ã€‚</p><p>å¦‚æœä½ æƒ³ä¸´æ—¶æ€§çš„ä¿å­˜ä¸€æ®µå†…å®¹ï¼Œè¿™ä¸ªæ“ä½œå¾ˆå®ç”¨ã€‚</p><h3 id="ç¨‹åºç›¸å…³"><a class="markdownIt-Anchor" href="#ç¨‹åºç›¸å…³"></a> ç¨‹åºç›¸å…³</h3><ul><li><p>ã€Œcommand + Qã€ï¼šå¿«é€Ÿé€€å‡ºç¨‹åº</p></li><li><p>ã€Œcommand + tabã€ï¼šåˆ‡æ¢ç¨‹åº</p></li><li><p>ã€Œcommand + Hã€ï¼šéšè—å½“å‰åº”ç”¨ç¨‹åºã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„å¿«æ·é”®ã€‚</p></li><li><p>ã€Œcommand + ï¼Œã€ï¼šæ‰“å¼€å½“å‰åº”ç”¨ç¨‹åºçš„ã€Œåå¥½è®¾ç½®ã€ã€‚</p></li></ul><h3 id="çª—å£ç›¸å…³"><a class="markdownIt-Anchor" href="#çª—å£ç›¸å…³"></a> çª—å£ç›¸å…³</h3><ul><li><p>ã€Œcommand + Nã€ï¼šæ–°å»ºä¸€ä¸ªå½“å‰åº”ç”¨ç¨‹åºçš„çª—å£</p></li><li><p>ã€Œcommand + `ã€ï¼šåœ¨å½“å‰åº”ç”¨ç¨‹åºçš„ä¸åŒçª—å£ä¹‹é—´åˆ‡æ¢ã€å¾ˆå®ç”¨ã€‘</p></li></ul><p>æˆ‘ä»¬çŸ¥é“ï¼Œã€Œcommand + tabã€æ˜¯åœ¨ä¸åŒçš„è½¯ä»¶ä¹‹é—´åˆ‡æ¢ã€‚ä½†ä½ ä¸çŸ¥é“çš„æ˜¯ï¼Œã€Œcommand + `ã€æ˜¯åœ¨åŒä¸€ä¸ªè½¯ä»¶çš„ä¸åŒçª—å£ä¹‹é—´åˆ‡æ¢ã€‚</p><ul><li><p>ã€Œcommand + Mã€ï¼šå°†å½“å‰çª—å£æœ€å°åŒ–</p></li><li><p>ã€Œcommand + Wã€ï¼šå…³é—­å½“å‰çª—å£</p></li></ul><h3 id="æµè§ˆå™¨ç›¸å…³"><a class="markdownIt-Anchor" href="#æµè§ˆå™¨ç›¸å…³"></a> æµè§ˆå™¨ç›¸å…³</h3><ul><li><p>ã€Œcommand + Tã€ï¼šæµè§ˆå™¨ä¸­ï¼Œæ–°å»ºä¸€ä¸ªæ ‡ç­¾</p></li><li><p>ã€Œcommand + Wã€ï¼šå…³é—­å½“å‰æ ‡ç­¾</p></li></ul><ul><li>ã€Œcommand + Rã€ï¼šå¼ºåˆ¶åˆ·æ–°ã€‚</li></ul><ul><li>ã€Œcommand + Lã€ï¼šå®šä½åˆ°åœ°å€æ ã€‚ã€é‡è¦ã€‘</li></ul><h3 id="æˆªå›¾ç›¸å…³"><a class="markdownIt-Anchor" href="#æˆªå›¾ç›¸å…³"></a> æˆªå›¾ç›¸å…³</h3><ul><li>ã€Œcommand + shift + 3ã€ï¼šæˆªå…¨å±ï¼ˆå¯¹æ•´ä¸ªå±å¹•æˆªå›¾ï¼‰ã€‚</li></ul><h3 id="å£°éŸ³ç›¸å…³"><a class="markdownIt-Anchor" href="#å£°éŸ³ç›¸å…³"></a> å£°éŸ³ç›¸å…³</h3><p>é€‰ä¸­æ–‡å­—åï¼ŒæŒ‰ä½ã€Œctrl + escã€é”®ï¼Œä¼šå°†æ–‡å­—è¿›è¡Œæœ—è¯»ã€‚ï¼ˆæˆ‘å‘ç°ï¼Œåœ¨è§¦æ§æ¡ç‰ˆçš„ mac ä¸Šï¼Œå¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼‰</p><h3 id="dock-æ ç›¸å…³"><a class="markdownIt-Anchor" href="#dock-æ ç›¸å…³"></a> Dock æ ç›¸å…³</h3><ul><li>ã€Œoption + command + Dã€ï¼šéšè— dock æ </li></ul><h3 id="å¼ºåˆ¶æ¨å‡º"><a class="markdownIt-Anchor" href="#å¼ºåˆ¶æ¨å‡º"></a> å¼ºåˆ¶æ¨å‡º</h3><blockquote><p>å¼ºåˆ¶é€€å‡ºçš„å¿«æ·é”®éå¸¸é‡è¦</p></blockquote><ul><li>ã€Œoption + command + escã€ï¼šæ‰“å¼€å¼ºåˆ¶é€€å‡ºçš„çª—å£</li></ul><h3 id="option-ç›¸å…³"><a class="markdownIt-Anchor" href="#option-ç›¸å…³"></a> option ç›¸å…³</h3><blockquote><p>å¼ºçƒˆæ¨è</p></blockquote><ul><li><p>ã€Œoption + command + Hã€ï¼šéšè—é™¤å½“å‰åº”ç”¨ç¨‹åºä¹‹å¤–çš„å…¶ä»–åº”ç”¨ç¨‹åº</p></li><li><p>åœ¨æ–‡æœ¬ä¸­ï¼ŒæŒ‰ä½ã€Œoptionã€é”®ï¼Œé…åˆé¼ æ ‡çš„é€‰ä¸­ï¼Œå¯ä»¥è¿›è¡Œå—çŠ¶æ–‡å­—é€‰å–ã€‚</p></li><li><p>ã€Œoption + command + Wã€ï¼šå¿«é€Ÿå…³é—­å½“å‰åº”ç”¨ç¨‹åºçš„æ‰€æœ‰çª—å£ã€‚ã€å¾ˆå®ç”¨ã€‘</p></li></ul><p>æ¯”å¦‚è¯´ï¼Œä½ ä¸€æ¬¡æ€§æ‰“å¼€äº†å¾ˆå¤šæ–‡ä»¶çš„è¯¦æƒ…ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡æ­¤å¿«æ·é”®ï¼Œå°†è¿™äº›çª—å£ä¸€æ¬¡æ€§å…³é—­ã€‚</p><ul><li>ã€Œoption + command + Iã€ï¼šæŸ¥çœ‹å¤šä¸ªæ–‡ä»¶çš„æ€»çš„å±æ€§ã€‚</li></ul><ul><li><p>æ‰“å¼€ launchpadï¼ŒæŒ‰ä½ã€Œoptionã€é”®ï¼Œå¯ä»¥å¿«é€Ÿå¸è½½åº”ç”¨ç¨‹åºã€‚</p></li><li><p>åœ¨ dock æ ï¼Œå³é”®ç‚¹å‡»è½¯ä»¶å›¾æ ‡ï¼ŒåŒæ—¶æŒ‰ä½ã€Œoptionã€é”®ï¼Œå°±å¯ä»¥<strong>å¼ºåˆ¶é€€å‡º</strong>è¯¥è½¯ä»¶ã€‚ã€é‡è¦ã€‘</p></li></ul><ul><li>åœ¨ Safari æµè§ˆå™¨ä¸­ï¼ŒæŒ‰ä½ã€Œoption + command + Qã€é€€å‡º Safariã€‚ç­‰ä¸‹æ¬¡è¿›å…¥ Safari çš„æ—¶å€™ï¼Œä¸Šæ¬¡é€€å‡ºæ—¶çš„ç½‘å€ä¼šè‡ªåŠ¨è¢«æ‰“å¼€ã€‚ã€å®ç”¨ã€‘</li></ul><h3 id="æ¨èä¸€ä¸ªè½¯ä»¶cheatsheet"><a class="markdownIt-Anchor" href="#æ¨èä¸€ä¸ªè½¯ä»¶cheatsheet"></a> æ¨èä¸€ä¸ªè½¯ä»¶ï¼šCheatSheet</h3><p>æ‰“å¼€ CheatSheet åï¼Œé•¿æŒ‰ command é”®ï¼Œä¼šå¼¹å‡ºå½“å‰åº”ç”¨ç¨‹åºçš„æ‰€æœ‰å¿«æ·é”®ã€‚æˆ‘ä»¬è¿˜å¯ä»¥å¯¹è¿™äº›å¿«æ·é”®è¿›è¡Œä¿å­˜ã€‚</p><h2 id="å­¦ä¹ èµ„æº"><a class="markdownIt-Anchor" href="#å­¦ä¹ èµ„æº"></a> ğŸ“š å­¦ä¹ èµ„æº</h2><ul><li><a href="https://github.com/jaywcjlove/awesome-mac" target="_blank" rel="noopener">Awesome Mac</a></li><li><a href="https://github.com/herrbischoff/awesome-macos-command-line" target="_blank" rel="noopener">awesome-macos-command-line</a></li></ul><h2 id="ä¼ é€é—¨"><a class="markdownIt-Anchor" href="#ä¼ é€é—¨"></a> ğŸšª ä¼ é€é—¨</h2><p>| <a href="https://github.com/dunwu/blog" target="_blank" rel="noopener">å›é¦–é </a> |</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åŸºæœ¬æ“ä½œ&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#åŸºæœ¬æ“ä½œ&quot;&gt;&lt;/a&gt; åŸºæœ¬æ“ä½œ&lt;/h2&gt;
&lt;h3 id=&quot;è½¯ä»¶ç®¡ç†&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#è½¯ä»¶ç®¡ç†&quot;&gt;&lt;/a&gt; è½¯ä»¶ç®¡ç†&lt;/h3
      
    
    </summary>
    
    
      <category term="æ“ä½œç³»ç»Ÿ" scheme="https://dunwu.github.io/blog/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
    
      <category term="æ“ä½œç³»ç»Ÿ" scheme="https://dunwu.github.io/blog/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
      <category term="Mac" scheme="https://dunwu.github.io/blog/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>Windows å¸¸ç”¨æŠ€å·§æ€»ç»“</title>
    <link href="https://dunwu.github.io/blog/os/windows/"/>
    <id>https://dunwu.github.io/blog/os/windows/</id>
    <published>2019-05-07T12:35:00.000Z</published>
    <updated>2019-11-22T03:31:33.349Z</updated>
    
    <content type="html"><![CDATA[<h1 id="windows-å¸¸ç”¨æŠ€å·§æ€»ç»“"><a class="markdownIt-Anchor" href="#windows-å¸¸ç”¨æŠ€å·§æ€»ç»“"></a> Windows å¸¸ç”¨æŠ€å·§æ€»ç»“</h1><!-- TOC depthFrom:2 depthTo:3 --><ul><li><a href="#%E8%BD%AF%E4%BB%B6">è½¯ä»¶</a><ul><li><a href="#%E8%A7%86%E9%A2%91%E9%9F%B3%E9%A2%91">è§†é¢‘éŸ³é¢‘</a></li><li><a href="#%E5%8E%8B%E7%BC%A9">å‹ç¼©</a></li><li><a href="#%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86">æ–‡ä»¶ç®¡ç†</a></li><li><a href="#%E5%BC%80%E5%8F%91">å¼€å‘</a></li><li><a href="#%E7%BC%96%E8%BE%91%E5%99%A8">ç¼–è¾‘å™¨</a></li><li><a href="#%E6%96%87%E6%A1%A3">æ–‡æ¡£</a></li><li><a href="#%E6%95%88%E7%8E%87%E6%8F%90%E5%8D%87">æ•ˆç‡æå‡</a></li><li><a href="#%E5%8A%9E%E5%85%AC">åŠå…¬</a></li><li><a href="#%E4%B8%AA%E6%80%A7%E5%8C%96">ä¸ªæ€§åŒ–</a></li></ul></li><li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li></ul><!-- /TOC --><h2 id="è½¯ä»¶"><a class="markdownIt-Anchor" href="#è½¯ä»¶"></a> è½¯ä»¶</h2><blockquote><p>æ‰©å±•é˜…è¯»ï¼š</p><ul><li><a href="https://github.com/Awesome-Windows/Awesome/blob/master/README-cn.md" target="_blank" rel="noopener">Awesome Windows</a></li><li><a href="https://github.com/stackia/best-windows-apps" target="_blank" rel="noopener">best-windows-apps</a></li></ul></blockquote><h3 id="è§†é¢‘éŸ³é¢‘"><a class="markdownIt-Anchor" href="#è§†é¢‘éŸ³é¢‘"></a> è§†é¢‘éŸ³é¢‘</h3><ul><li><a href="http://getmusicbee.com/" target="_blank" rel="noopener">Musicbee</a> - ç±»ä¼¼ iTunesï¼Œä½†æ¯” iTunes æ›´å¥½ç”¨ã€‚</li><li><a href="http://www.screentogif.com/" target="_blank" rel="noopener">ScreenToGif</a> - å®ƒå…è®¸ä½ å½•åˆ¶å±å¹•çš„ä¸€éƒ¨åˆ†åŒºåŸŸå¹¶ä¿å­˜ä¸º gif æˆ–è§†é¢‘ã€‚</li><li><a href="http://potplayer.daum.net/" target="_blank" rel="noopener">PotPlayer</a> - å¤šåª’ä½“æ’­æ”¾å™¨ï¼Œå…·æœ‰å¹¿æ³›çš„ç¼–è§£ç å™¨é›†åˆï¼Œå®ƒè¿˜ä¸ºç”¨æˆ·æä¾›å¤§é‡é…ç½®é€‰é¡¹ã€‚</li><li><a href="http://www.splayer.org/" target="_blank" rel="noopener">å°„æ‰‹å½±éŸ³æ’­æ”¾å™¨</a> - æ¥è‡ªå°„æ‰‹ç½‘ï¼Œå°å·§å¼€æºï¼Œé¦–åˆ›è‡ªåŠ¨åŒ¹é…å­—å¹•åŠŸèƒ½ã€‚</li></ul><h3 id="å‹ç¼©"><a class="markdownIt-Anchor" href="#å‹ç¼©"></a> å‹ç¼©</h3><ul><li><a href="http://www.7-zip.org/" target="_blank" rel="noopener">7-Zip</a> - ç”¨äºå¤„ç†å‹ç¼©åŒ…çš„å¼€æº Windows å®ç”¨ç¨‹åºã€‚å®Œç¾æ”¯æŒ 7zï¼ŒZIPï¼ŒGZIPï¼ŒBZIP2 å’Œ TAR çš„å…¨éƒ¨ç‰¹æ€§ï¼Œå…¶ä»–æ ¼å¼ä¹Ÿå¯è§£å‹ç¼©ã€‚</li><li><a href="http://www.rarlab.com/" target="_blank" rel="noopener">WinRAR</a> - å¼ºå¤§çš„å½’æ¡£ç®¡ç†å™¨ã€‚ å®ƒå¯ä»¥å¤‡ä»½æ‚¨çš„æ•°æ®å¹¶å‡å°ç”µå­é‚®ä»¶é™„ä»¶çš„å¤§å°ï¼Œè§£å‹ç¼© RARï¼ŒZIP å’Œå…¶ä»–æ–‡ä»¶ã€‚</li></ul><h3 id="æ–‡ä»¶ç®¡ç†"><a class="markdownIt-Anchor" href="#æ–‡ä»¶ç®¡ç†"></a> æ–‡ä»¶ç®¡ç†</h3><ul><li><a href="http://en.ejie.me/" target="_blank" rel="noopener">Clover</a> - ä¸ºèµ„æºç®¡ç†å™¨åŠ ä¸Šå¤šæ ‡ç­¾åŠŸèƒ½ã€‚</li><li><a href="http://www.ghisler.com/" target="_blank" rel="noopener">Total Commander</a> - è€ç‰Œã€åŠŸèƒ½å¼‚å¸¸å¼ºå¤§çš„æ–‡ä»¶ç®¡ç†å¢å¼ºè½¯ä»¶ã€‚</li><li><a href="http://www.softwareok.com/?seite=Freeware/Q-Dir" target="_blank" rel="noopener">Q-Dir</a> - è½»é‡çº§çš„æ–‡ä»¶ç®¡ç†å™¨ï¼Œå„ç§å¸ƒå±€è§†å›¾åˆ‡æ¢çµæ´»ï¼Œé»˜è®¤å››ä¸ªå°çª—å£ç»„æˆä¸€ä¸ªå¤§çª—å£ï¼Œæ“ä½œå¿«æ·ã€‚è½¯ä»¶è™½å°ï¼Œç²‰ä¸å¿ è¯šã€‚</li><li><a href="https://github.com/Wox-launcher/Wox" target="_blank" rel="noopener">WoX</a> - æ–°ä¸€ä»£æ–‡ä»¶å®šä½å·¥å…·ï¼Œå ªç§° Windows ä¸Šçš„ Alfredã€‚</li><li><a href="http://www.voidtools.com/" target="_blank" rel="noopener">Everything</a> - æœ€å¿«çš„æ–‡ä»¶/æ–‡ä»¶å¤¹æœç´¢å·¥å…·ï¼Œ é€šè¿‡åç§°æœç´¢ã€‚</li><li><a href="http://www.listary.com/" target="_blank" rel="noopener">Listary</a> - éå¸¸ä¼˜ç§€çš„ Windows æ–‡ä»¶æµè§ˆå’Œæœç´¢å¢å¼ºå·¥å…·ã€‚</li><li>Beyond Compare - å¥½ç”¨åˆä¸‡èƒ½çš„æ–‡ä»¶å¯¹æ¯”å·¥å…·ã€‚</li><li><a href="https://www.piriform.com/ccleaner/download" target="_blank" rel="noopener">CCleaner</a> - å¦‚æœä½ æœ‰ç³»ç»Ÿæ´ç™–ï¼Œé‚£ä¸€å®šè¦é€‰æ‹©ä¸€æ¬¾å¹²å‡€ã€è‰¯å¿ƒã€è€ç‰Œçš„æ¸…æ´è½¯ä»¶ã€‚</li><li><a href="https://chocolatey.org/" target="_blank" rel="noopener">chocolatey</a> - åŒ…ç®¡ç†å™¨</li><li><a href="https://ninite.com/" target="_blank" rel="noopener">Ninite</a> - æœ€ç®€å•ï¼Œæœ€å¿«é€Ÿçš„æ›´æ–°æˆ–å®‰è£…è½¯ä»¶çš„æ–¹å¼ã€‚</li><li><a href="http://www.piriform.com/RECUVA" target="_blank" rel="noopener">Recuva</a> - æ¥è‡ª piriform æ¢¨å­å…¬å¸äº§å“ï¼Œå…è´¹çš„æ•°æ®æ¢å¤å·¥å…·ã€‚</li><li><a href="http://www.launchy.net/" target="_blank" rel="noopener">Launchy</a>ï¼šè‡ªç”±çš„è·¨å¹³å°å·¥å…·ï¼Œå¸®åŠ©ä½ å¿˜è®°å¼€å§‹èœå•ã€æ¡Œé¢å›¾æ ‡ç”šè‡³æ–‡ä»¶ç®¡ç†å™¨ã€‚</li></ul><h3 id="å¼€å‘"><a class="markdownIt-Anchor" href="#å¼€å‘"></a> å¼€å‘</h3><ul><li><a href="http://www.telerik.com/fiddler" target="_blank" rel="noopener">Fiddler</a> - web è°ƒè¯•ä»£ç†å·¥å…·ã€‚</li><li><a href="https://www.getpostman.com/postman" target="_blank" rel="noopener">Postman</a> - é€‚åˆ API å¼€å‘çš„å®Œæ•´å·¥å…·é“¾ï¼Œæœ€å¸¸ç”¨çš„ REST å®¢æˆ·ç«¯ã€‚</li><li><a href="https://www.sourcetreeapp.com/" target="_blank" rel="noopener">SourceTree</a> - ä¸€ä¸ªå…è´¹çš„ Git &amp; Mercurial å®¢æˆ·ç«¯ã€‚</li><li><a href="https://tortoisesvn.net/" target="_blank" rel="noopener">TortoiseSVN</a> - Subversion(SVN)çš„å›¾å½¢å®¢æˆ·ç«¯</li><li><a href="https://www.wireshark.org/" target="_blank" rel="noopener">Wireshark</a> - ä¸€ä¸ªç½‘ç»œåè®®åˆ†æå·¥å…·ã€‚</li><li>Switchhosts</li><li><a href="https://github.com/cmderdev/cmder" target="_blank" rel="noopener">Cmder</a> - æ§åˆ¶å°æ¨¡æ‹Ÿå™¨åŒ…ã€‚æ‰©å±•é˜…è¯»ï¼š<a href="https://www.jeffjade.com/2016/01/13/2016-01-13-windows-software-cmder/" target="_blank" rel="noopener">Win ä¸‹å¿…å¤‡ç¥å™¨ä¹‹ Cmder</a></li><li><a href="http://babun.github.io/" target="_blank" rel="noopener">Babun</a> - åŸºäº Cygwinï¼Œç”¨äºæ›¿ä»£ Windows shellã€‚</li></ul><h3 id="ç¼–è¾‘å™¨"><a class="markdownIt-Anchor" href="#ç¼–è¾‘å™¨"></a> ç¼–è¾‘å™¨</h3><ul><li><a href="http://www.jetbrains.com/" target="_blank" rel="noopener">JetBrain IDE ç³»åˆ—</a> - çœŸé¦™ï¼</li><li><a href="https://code.visualstudio.com/" target="_blank" rel="noopener">Visual Studio Code</a> - ç”¨äºæ„å»ºå’Œè°ƒè¯•ç°ä»£ Web å’Œäº‘åº”ç”¨ç¨‹åºã€‚</li><li><a href="https://eclipse.org/downloads/" target="_blank" rel="noopener">Eclipse</a> - ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ IDEã€‚</li><li><a href="https://www.visualstudio.com/vs/" target="_blank" rel="noopener">Visual Studio</a> - å¾®è½¯å®˜æ–¹çš„ IDEï¼Œé€šè¿‡æ’ä»¶å¯æ”¯æŒå¤§é‡ç¼–ç¨‹è¯­è¨€ã€‚</li><li><a href="https://netbeans.org/" target="_blank" rel="noopener">NetBeans IDE</a> - å…è´¹å¼€æºçš„ IDEã€‚</li><li><a href="https://www.typora.io/" target="_blank" rel="noopener">Typora</a> - ä¸ªäººè§‰å¾—æœ€å¥½ç”¨çš„ Markdown ç¼–è¾‘å™¨ã€‚</li><li><a href="https://www.zybuluo.com/cmd/" target="_blank" rel="noopener">Cmd Markdown</a> - è·¨å¹³å°ä¼˜ç§€ Markdown ç¼–è¾‘å™¨ï¼Œæœ¬æ–‡å³ç”¨å…¶æ‰€å†™ã€‚</li><li><a href="https://notepad-plus-plus.org/" target="_blank" rel="noopener">Notepad++</a> - ä¸€æ¬¾æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€çš„æºç ç¼–è¾‘å™¨ã€‚</li><li><a href="http://www.flos-freeware.ch/notepad2.html" target="_blank" rel="noopener">Notepad2</a> - ç”¨äºæ›¿ä»£é»˜è®¤æ–‡æœ¬ç¼–è¾‘å™¨çš„è½»é‡å¿«é€Ÿçš„ç¼–è¾‘å™¨ï¼Œæ‹¥æœ‰ä¼—å¤šæœ‰ç”¨çš„åŠŸèƒ½ã€‚</li><li><a href="http://www.sublimetext.com/3" target="_blank" rel="noopener">Sublime Text 3</a> - é«˜çº§æ–‡æœ¬ç¼–è¾‘å™¨ã€‚</li><li><a href="https://atom.io/" target="_blank" rel="noopener">Atom</a> - é¢å‘ 21 ä¸–çºªçš„æå®¢æ–‡æœ¬ç¼–è¾‘å™¨ã€‚</li></ul><h3 id="æ–‡æ¡£"><a class="markdownIt-Anchor" href="#æ–‡æ¡£"></a> æ–‡æ¡£</h3><ul><li><a href="http://www.office.com/" target="_blank" rel="noopener">Microsoft Office</a> - å¾®è½¯åŠå…¬è½¯ä»¶ã€‚</li><li><a href="https://www.wps.com/office-free" target="_blank" rel="noopener">WPS Office</a> - é‡‘å±±å…è´¹åŠå…¬è½¯ä»¶ã€‚</li><li><a href="http://calibre-ebook.com/" target="_blank" rel="noopener">Calibre</a> - ç”¨äºç”µå­ä¹¦ç®¡ç†å’Œè½¬æ¢çš„å¼ºå¤§è½¯ä»¶ã€‚</li><li><a href="http://www.foxitsoftware.cn/products/reader/" target="_blank" rel="noopener">ç¦æ˜•é˜…è¯»å™¨</a> - åœ¨å…¨çƒæ‹¥æœ‰å¤§é‡ç”¨æˆ·ï¼Œæœ€ä¼˜ç§€çš„å›½äº§è½¯ä»¶ä¹‹ä¸€ã€‚Ribbon ç•Œé¢ï¼Œæ”¯æŒæ‰‹å†™ç­¾åã€æ’å…¥å°ç« ç­‰ã€‚</li></ul><h3 id="æ•ˆç‡æå‡"><a class="markdownIt-Anchor" href="#æ•ˆç‡æå‡"></a> æ•ˆç‡æå‡</h3><p><strong>ã€ç¬”è®°ã€‘</strong></p><ul><li><a href="http://www.xmind.net/" target="_blank" rel="noopener">XMind</a> - ä¼˜ç§€çš„æ€ç»´å¯¼å›¾ã€‚</li><li><a href="https://www.onenote.com/" target="_blank" rel="noopener">OneNote</a> - Windows ä¸‹ç»¼åˆè¯„ä»·éå¸¸é«˜çš„ç¬”è®°åº”ç”¨ã€‚</li><li><a href="http://www.yinxiang.com/" target="_blank" rel="noopener">å°è±¡ç¬”è®°</a> - è€ç‰Œè·¨å¹³å°ç¬”è®°å·¥å…·ï¼Œå›½é™…ç‰ˆ Evernoteã€‚ä¸€å®¶ç«‹å¿—äºåšç™¾å¹´å…¬å¸çš„ä¼ä¸šï¼Œå®‰å…¨ã€å¯é ã€‚</li><li><a href="http://www.wiz.cn/index.html" target="_blank" rel="noopener">ä¸ºçŸ¥ç¬”è®°</a> - è¶Šæ¥è¶Šå¥½çš„ç¬”è®°åº”ç”¨ï¼Œè®°å½•ã€æŸ¥é˜…ä¸€åˆ‡æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼ŒåŒæ ·è·¨å¹³å°æ”¯æŒã€‚</li><li><a href="http://note.youdao.com/" target="_blank" rel="noopener">æœ‰é“äº‘ç¬”è®°</a> - ç½‘æ˜“æ——ä¸‹ç¬”è®°å·¥å…·ï¼ŒåŒæ ·è·¨ä¸»æµå¹³å°æ”¯æŒï¼Œæ–‡å­—ã€æ‰‹å†™ã€å½•éŸ³ã€æ‹ç…§å¤šç§è®°å½•æ–¹å¼ï¼Œæ”¯æŒä»»æ„é™„ä»¶æ ¼å¼ã€‚</li><li><a href="https://getsharex.com/" target="_blank" rel="noopener">ShareX</a> - ä½ è¦çš„æ‰€æœ‰ä¸æˆªå›¾ã€å½•å±ç›¸å…³çš„åŠŸèƒ½ï¼Œè¿™é‡Œéƒ½æœ‰äº†ã€‚</li></ul><p>ã€å¿«æ·é”®ã€‘</p><ul><li><a href="https://autohotkey.com/" target="_blank" rel="noopener">AutoHotkey</a> - Windows å¹³å°çš„ç»ˆæè‡ªåŠ¨åŒ–è„šæœ¬è¯­è¨€ã€‚</li></ul><blockquote><p>æŠ€å·§ï¼š</p><ul><li><a href="https://www.jeffjade.com/2016/03/11/2016-03-11-autohotkey/" target="_blank" rel="noopener">https://www.jeffjade.com/2016/03/11/2016-03-11-autohotkey/</a></li><li><a href="https://www.autohotkey.com/boards/viewtopic.php?f=29&amp;t=4296" target="_blank" rel="noopener">https://www.autohotkey.com/boards/viewtopic.php?f=29&amp;t=4296</a></li></ul></blockquote><h3 id="åŠå…¬"><a class="markdownIt-Anchor" href="#åŠå…¬"></a> åŠå…¬</h3><ul><li><a href="http://cidian.youdao.com/index.html" target="_blank" rel="noopener">æœ‰é“è¯å…¸</a> - æœ€å¥½ç”¨çš„å…è´¹å…¨èƒ½ç¿»è¯‘è½¯ä»¶ã€‚</li><li><a href="http://office.microsoft.com/zh-cn/outlook/" target="_blank" rel="noopener">Outlook</a> - å¤§åé¼é¼çš„ Microsoft Office ç»„ä»¶ä¹‹ä¸€ï¼Œé™¤äº†ç”µå­é‚®ä»¶ï¼Œè¿˜åŒ…å«äº†æ—¥å†ã€ä»»åŠ¡ç®¡ç†ã€è”ç³»äººã€è®°äº‹æœ¬ç­‰åŠŸèƒ½ã€‚</li><li><a href="http://www.gmail.com/" target="_blank" rel="noopener">Gmail</a> - åŠŸèƒ½ä¸Šå¯ä»¥ç§°ä¸ºä¸šç•Œæ ‡æ†ï¼Œç”¨æˆ·æ•°é‡ä¸–ç•Œç¬¬ä¸€ï¼Œæˆ–è®¸ä½ çœŸçš„æ‰¾ä¸åˆ°æ¯”å®ƒæ›´å¥½çš„é‚®ä»¶ç³»ç»Ÿã€‚</li><li><a href="https://www.google.com/intl/zh-CN/chrome/browser/" target="_blank" rel="noopener">Chrome</a> - æœ€å¥½çš„æµè§ˆå™¨ã€‚</li><li><a href="http://www.teamviewer.com/Zhcn/index.aspx" target="_blank" rel="noopener">Teamviewer</a> - ä¸“ä¸šã€åŠŸèƒ½å¼ºå¤§çš„è¿œç¨‹æ§åˆ¶è½¯ä»¶ã€‚ä½¿ç”¨ç®€å•ï¼Œå¯¹ä¸ªäººç”¨æˆ·å…è´¹ã€‚</li></ul><h3 id="ä¸ªæ€§åŒ–"><a class="markdownIt-Anchor" href="#ä¸ªæ€§åŒ–"></a> ä¸ªæ€§åŒ–</h3><ul><li><a href="https://github.com/TranslucentTB/TranslucentTB" target="_blank" rel="noopener">TranslucentTB</a> - é€æ˜åŒ–ä½ çš„ Windows ä»»åŠ¡æ ã€‚</li><li><a href="http://qttabbar.wikidot.com/" target="_blank" rel="noopener">QTTabBar</a> - é€šè¿‡å¤šæ ‡ç­¾å’Œé¢å¤–çš„æ–‡ä»¶å¤¹è§†å›¾æ‰©å±•èµ„æºç®¡ç†å™¨çš„åŠŸèƒ½ã€‚</li><li><a href="https://www.stardock.com/products/fences/" target="_blank" rel="noopener">Fences</a> - ç®¡ç†æ¡Œé¢å¿«æ·æ–¹å¼ã€‚</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://github.com/Awesome-Windows/Awesome/blob/master/README-cn.md" target="_blank" rel="noopener">https://github.com/Awesome-Windows/Awesome/blob/master/README-cn.md</a></li><li><a href="https://love.appinn.com/" target="_blank" rel="noopener">https://love.appinn.com/</a></li><li><a href="https://github.com/stackia/best-windows-apps" target="_blank" rel="noopener">https://github.com/stackia/best-windows-apps</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;windows-å¸¸ç”¨æŠ€å·§æ€»ç»“&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#windows-å¸¸ç”¨æŠ€å·§æ€»ç»“&quot;&gt;&lt;/a&gt; Windows å¸¸ç”¨æŠ€å·§æ€»ç»“&lt;/h1&gt;
&lt;!-- TOC depthFrom:2 depthTo:3 --&gt;
&lt;ul&gt;
      
    
    </summary>
    
    
      <category term="æ“ä½œç³»ç»Ÿ" scheme="https://dunwu.github.io/blog/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
    
      <category term="æ“ä½œç³»ç»Ÿ" scheme="https://dunwu.github.io/blog/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
      <category term="Windows" scheme="https://dunwu.github.io/blog/tags/Windows/"/>
    
  </entry>
  
</feed>
