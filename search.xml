<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼æŠ€æœ¯é¢è¯•é¢˜]]></title>
    <url>%2Fblog%2F2019%2F10%2F25%2Fdesign%2Farchitecture%2F%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E9%9D%A2%E8%AF%95%E9%A2%98%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼æŠ€æœ¯é¢è¯•é¢˜ 1. åˆ†å¸ƒå¼ç¼“å­˜ 1.1. Redis æœ‰ä»€ä¹ˆæ•°æ®ç±»åž‹ï¼Ÿåˆ†åˆ«ç”¨äºŽä»€ä¹ˆåœºæ™¯ï¼Ÿ 1.2. Redis çš„ä¸»ä»Žå¤åˆ¶æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ 1.3. Redis çš„ key æ˜¯å¦‚ä½•å¯»å€çš„ï¼Ÿ 1.4. Redis çš„é›†ç¾¤æ¨¡å¼æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ 1.5. Redis å¦‚ä½•å®žçŽ°åˆ†å¸ƒå¼é”ï¼ŸZooKeeper å¦‚ä½•å®žçŽ°åˆ†å¸ƒå¼é”ï¼Ÿæ¯”è¾ƒäºŒè€…ä¼˜åŠ£ï¼Ÿ 1.6. Redis çš„æŒä¹…åŒ–æ–¹å¼ï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼ŸæŒä¹…åŒ–å®žçŽ°åŽŸç†ï¼Ÿ 1.7. Redis è¿‡æœŸç­–ç•¥æœ‰å“ªäº›ï¼Ÿ 1.8. Redis å’Œ Memcached æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ 1.9. ä¸ºä»€ä¹ˆå•çº¿ç¨‹çš„ Redis æ€§èƒ½åè€Œä¼˜äºŽå¤šçº¿ç¨‹çš„ Memcachedï¼Ÿ 2. åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰ 2.1. ä¸ºä»€ä¹ˆä½¿ç”¨ MQï¼Ÿ 2.2. å¦‚ä½•ä¿è¯ MQ çš„é«˜å¯ç”¨ï¼Ÿ 2.3. MQ æœ‰å“ªäº›å¸¸è§é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ 2.4. Kafka, ActiveMQ, RabbitMQ, RocketMQ å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ 3. åˆ†å¸ƒå¼æœåŠ¡ï¼ˆRPCï¼‰ 3.1. Dubbo çš„å®žçŽ°è¿‡ç¨‹ï¼Ÿ 3.2. Dubbo è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ 3.3. Dubbo é›†ç¾¤å®¹é”™ç­–ç•¥ ï¼Ÿ 3.4. åŠ¨æ€ä»£ç†ç­–ç•¥ï¼Ÿ 3.5. Dubbo æ”¯æŒå“ªäº›åºåˆ—åŒ–åè®®ï¼ŸHessianï¼ŸHessian çš„æ•°æ®ç»“æž„ï¼Ÿ 3.6. Protoco Buffer æ˜¯ä»€ä¹ˆï¼Ÿ 3.7. æ³¨å†Œä¸­å¿ƒæŒ‚äº†å¯ä»¥ç»§ç»­é€šä¿¡å—ï¼Ÿ 3.8. ZooKeeper åŽŸç†æ˜¯ä»€ä¹ˆï¼ŸZooKeeper æœ‰ä»€ä¹ˆç”¨ï¼Ÿ 3.9. Netty æœ‰ä»€ä¹ˆç”¨ï¼ŸNIO/BIO/AIO æœ‰ä»€ä¹ˆç”¨ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ 3.10. ä¸ºä»€ä¹ˆè¦è¿›è¡Œç³»ç»Ÿæ‹†åˆ†ï¼Ÿæ‹†åˆ†ä¸ç”¨ Dubbo å¯ä»¥å—ï¼Ÿ 3.11. Dubbo å’Œ Thrift æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ 1. åˆ†å¸ƒå¼ç¼“å­˜ 1.1. Redis æœ‰ä»€ä¹ˆæ•°æ®ç±»åž‹ï¼Ÿåˆ†åˆ«ç”¨äºŽä»€ä¹ˆåœºæ™¯ï¼Ÿ æ•°æ®ç±»åž‹ å¯ä»¥å­˜å‚¨çš„å€¼ æ“ä½œ STRING å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–è€…æµ®ç‚¹æ•° å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œ å¯¹æ•´æ•°å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢žæˆ–è€…è‡ªå‡æ“ä½œ LIST åˆ—è¡¨ ä»Žä¸¤ç«¯åŽ‹å…¥æˆ–è€…å¼¹å‡ºå…ƒç´  è¯»å–å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´  è¿›è¡Œä¿®å‰ªï¼Œåªä¿ç•™ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´  SET æ— åºé›†åˆ æ·»åŠ ã€èŽ·å–ã€ç§»é™¤å•ä¸ªå…ƒç´  æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºŽé›†åˆä¸­ è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›† ä»Žé›†åˆé‡Œé¢éšæœºèŽ·å–å…ƒç´  HASH åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨ æ·»åŠ ã€èŽ·å–ã€ç§»é™¤å•ä¸ªé”®å€¼å¯¹ èŽ·å–æ‰€æœ‰é”®å€¼å¯¹ æ£€æŸ¥æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ ZSET æœ‰åºé›†åˆ æ·»åŠ ã€èŽ·å–ã€åˆ é™¤å…ƒç´  æ ¹æ®åˆ†å€¼èŒƒå›´æˆ–è€…æˆå‘˜æ¥èŽ·å–å…ƒç´  è®¡ç®—ä¸€ä¸ªé”®çš„æŽ’å What Redis data structures look like 1.2. Redis çš„ä¸»ä»Žå¤åˆ¶æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ ä»ŽæœåŠ¡å™¨è¿žæŽ¥ä¸»æœåŠ¡å™¨ï¼Œå‘é€ SYNC å‘½ä»¤ï¼› ä¸»æœåŠ¡å™¨æŽ¥æ”¶åˆ° SYNC å‘½ååŽï¼Œå¼€å§‹æ‰§è¡Œ BGSAVE å‘½ä»¤ç”Ÿæˆ RDB æ–‡ä»¶å¹¶ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ­¤åŽæ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ï¼› ä¸»æœåŠ¡å™¨ BGSAVE æ‰§è¡Œå®ŒåŽï¼Œå‘æ‰€æœ‰ä»ŽæœåŠ¡å™¨å‘é€å¿«ç…§æ–‡ä»¶ï¼Œå¹¶åœ¨å‘é€æœŸé—´ç»§ç»­è®°å½•è¢«æ‰§è¡Œçš„å†™å‘½ä»¤ï¼› ä»ŽæœåŠ¡å™¨æ”¶åˆ°å¿«ç…§æ–‡ä»¶åŽä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥æ”¶åˆ°çš„å¿«ç…§ï¼› ä¸»æœåŠ¡å™¨å¿«ç…§å‘é€å®Œæ¯•åŽå¼€å§‹å‘ä»ŽæœåŠ¡å™¨å‘é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ï¼› ä»ŽæœåŠ¡å™¨å®Œæˆå¯¹å¿«ç…§çš„è½½å…¥ï¼Œå¼€å§‹æŽ¥æ”¶å‘½ä»¤è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ¥è‡ªä¸»æœåŠ¡å™¨ç¼“å†²åŒºçš„å†™å‘½ä»¤ï¼› 1.3. Redis çš„ key æ˜¯å¦‚ä½•å¯»å€çš„ï¼Ÿ èƒŒæ™¯ ï¼ˆ1ï¼‰redis ä¸­çš„æ¯ä¸€ä¸ªæ•°æ®åº“ï¼Œéƒ½ç”±ä¸€ä¸ª redisDb çš„ç»“æž„å­˜å‚¨ã€‚å…¶ä¸­ï¼š redisDb.id å­˜å‚¨ç€ redis æ•°æ®åº“ä»¥æ•´æ•°è¡¨ç¤ºçš„å·ç ã€‚ redisDb.dict å­˜å‚¨ç€è¯¥åº“æ‰€æœ‰çš„é”®å€¼å¯¹æ•°æ®ã€‚ redisDb.expires ä¿å­˜ç€æ¯ä¸€ä¸ªé”®çš„è¿‡æœŸæ—¶é—´ã€‚ ï¼ˆ2ï¼‰å½“ redis æœåŠ¡å™¨åˆå§‹åŒ–æ—¶ï¼Œä¼šé¢„å…ˆåˆ†é… 16 ä¸ªæ•°æ®åº“ï¼ˆè¯¥æ•°é‡å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®ï¼‰ï¼Œæ‰€æœ‰æ•°æ®åº“ä¿å­˜åˆ°ç»“æž„ redisServer çš„ä¸€ä¸ªæˆå‘˜ redisServer.db æ•°ç»„ä¸­ã€‚å½“æˆ‘ä»¬é€‰æ‹©æ•°æ®åº“ select number æ—¶ï¼Œç¨‹åºç›´æŽ¥é€šè¿‡ redisServer.db[number] æ¥åˆ‡æ¢æ•°æ®åº“ã€‚æœ‰æ—¶å€™å½“ç¨‹åºéœ€è¦çŸ¥é“è‡ªå·±æ˜¯åœ¨å“ªä¸ªæ•°æ®åº“æ—¶ï¼Œç›´æŽ¥è¯»å– redisDb.id å³å¯ã€‚ ï¼ˆ3ï¼‰redis çš„å­—å…¸ä½¿ç”¨å“ˆå¸Œè¡¨ä½œä¸ºå…¶åº•å±‚å®žçŽ°ã€‚dict ç±»åž‹ä½¿ç”¨çš„ä¸¤ä¸ªæŒ‡å‘å“ˆå¸Œè¡¨çš„æŒ‡é’ˆï¼Œå…¶ä¸­ 0 å·å“ˆå¸Œè¡¨ï¼ˆht[0]ï¼‰ä¸»è¦ç”¨äºŽå­˜å‚¨æ•°æ®åº“çš„æ‰€æœ‰é”®å€¼ï¼Œè€Œ 1 å·å“ˆå¸Œè¡¨ä¸»è¦ç”¨äºŽç¨‹åºå¯¹ 0 å·å“ˆå¸Œè¡¨è¿›è¡Œ rehash æ—¶ä½¿ç”¨ï¼Œrehash ä¸€èˆ¬æ˜¯åœ¨æ·»åŠ æ–°å€¼æ—¶ä¼šè§¦å‘ï¼Œè¿™é‡Œä¸åšè¿‡å¤šçš„èµ˜è¿°ã€‚æ‰€ä»¥ redis ä¸­æŸ¥æ‰¾ä¸€ä¸ª keyï¼Œå…¶å®žå°±æ˜¯å¯¹è¿›è¡Œè¯¥ dict ç»“æž„ä¸­çš„ ht[0] è¿›è¡ŒæŸ¥æ‰¾æ“ä½œã€‚ ï¼ˆ4ï¼‰æ—¢ç„¶æ˜¯å“ˆå¸Œï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“å°±ä¼šæœ‰å“ˆå¸Œç¢°æ’žï¼Œé‚£ä¹ˆå½“å¤šä¸ªé”®å“ˆå¸Œä¹‹åŽä¸ºåŒä¸€ä¸ªå€¼æ€Žä¹ˆåŠžå‘¢ï¼Ÿredis é‡‡å–é“¾è¡¨çš„æ–¹å¼æ¥å­˜å‚¨å¤šä¸ªå“ˆå¸Œç¢°æ’žçš„é”®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ ¹æ® key çš„å“ˆå¸Œå€¼æ‰¾åˆ°è¯¥åˆ—è¡¨åŽï¼Œå¦‚æžœåˆ—è¡¨çš„é•¿åº¦å¤§äºŽ 1ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦éåŽ†è¯¥é“¾è¡¨æ¥æ‰¾åˆ°æˆ‘ä»¬æ‰€æŸ¥æ‰¾çš„ keyã€‚å½“ç„¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹é“¾è¡¨é•¿åº¦éƒ½ä¸ºæ˜¯ 1ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦å¯çœ‹ä½œ o(1)ã€‚ å¯»å€ key çš„æ­¥éª¤ å½“æ‹¿åˆ°ä¸€ä¸ª key åŽï¼Œredis å…ˆåˆ¤æ–­å½“å‰åº“çš„ 0 å·å“ˆå¸Œè¡¨æ˜¯å¦ä¸ºç©ºï¼Œå³ï¼šif (dict-&gt;ht[0].size == 0)ã€‚å¦‚æžœä¸º true ç›´æŽ¥è¿”å›ž NULLã€‚ åˆ¤æ–­è¯¥ 0 å·å“ˆå¸Œè¡¨æ˜¯å¦éœ€è¦ rehashï¼Œå› ä¸ºå¦‚æžœåœ¨è¿›è¡Œ rehashï¼Œé‚£ä¹ˆä¸¤ä¸ªè¡¨ä¸­è€…æœ‰å¯èƒ½å­˜å‚¨è¯¥ keyã€‚å¦‚æžœæ­£åœ¨è¿›è¡Œ rehashï¼Œå°†è°ƒç”¨ä¸€æ¬¡_dictRehashStep æ–¹æ³•ï¼Œ_dictRehashStep ç”¨äºŽå¯¹æ•°æ®åº“å­—å…¸ã€ä»¥åŠå“ˆå¸Œé”®çš„å­—å…¸è¿›è¡Œè¢«åŠ¨ rehashï¼Œè¿™é‡Œä¸ä½œèµ˜è¿°ã€‚ è®¡ç®—å“ˆå¸Œè¡¨ï¼Œæ ¹æ®å½“å‰å­—å…¸ä¸Ž key è¿›è¡Œå“ˆå¸Œå€¼çš„è®¡ç®—ã€‚ æ ¹æ®å“ˆå¸Œå€¼ä¸Žå½“å‰å­—å…¸è®¡ç®—å“ˆå¸Œè¡¨çš„ç´¢å¼•å€¼ã€‚ æ ¹æ®ç´¢å¼•å€¼åœ¨å“ˆå¸Œè¡¨ä¸­å–å‡ºé“¾è¡¨ï¼ŒéåŽ†è¯¥é“¾è¡¨æ‰¾åˆ° key çš„ä½ç½®ã€‚ä¸€èˆ¬æƒ…å†µï¼Œè¯¥é“¾è¡¨é•¿åº¦ä¸º 1ã€‚ å½“ ht[0] æŸ¥æ‰¾å®Œäº†ä¹‹åŽï¼Œå†è¿›è¡Œäº†æ¬¡ rehash åˆ¤æ–­ï¼Œå¦‚æžœæœªåœ¨ rehashingï¼Œåˆ™ç›´æŽ¥ç»“æŸï¼Œå¦åˆ™å¯¹ ht[1]é‡å¤ 345 æ­¥éª¤ã€‚ 1.4. Redis çš„é›†ç¾¤æ¨¡å¼æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ Redis Cluster æ˜¯ Redis çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œåœ¨ Redis 3.0 ç‰ˆæœ¬æ­£å¼æŽ¨å‡ºçš„ã€‚ Redis Cluster åŽ»ä¸­å¿ƒåŒ–ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¿å­˜æ•°æ®å’Œæ•´ä¸ªé›†ç¾¤çŠ¶æ€ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å’Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹è¿žæŽ¥ã€‚ Redis Cluster èŠ‚ç‚¹åˆ†é… Redis Cluster ç‰¹ç‚¹ï¼š æ‰€æœ‰çš„ redis èŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONG æœºåˆ¶)ï¼Œå†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½ã€‚ èŠ‚ç‚¹çš„ fail æ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆã€‚ å®¢æˆ·ç«¯ä¸Ž redis èŠ‚ç‚¹ç›´è¿ž,ä¸éœ€è¦ä¸­é—´ proxy å±‚ã€‚å®¢æˆ·ç«¯ä¸éœ€è¦è¿žæŽ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿žæŽ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚ redis-cluster æŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383] å“ˆå¸Œæ§½ (hash slot)ä¸Šï¼ˆä¸ä¸€å®šæ˜¯å¹³å‡åˆ†é…ï¼‰,cluster è´Ÿè´£ç»´æŠ¤ nodeã€slotã€valueã€‚ Redis é›†ç¾¤é¢„åˆ†å¥½ 16384 ä¸ªæ¡¶ï¼Œå½“éœ€è¦åœ¨ Redis é›†ç¾¤ä¸­æ”¾ç½®ä¸€ä¸ª key-value æ—¶ï¼Œæ ¹æ® CRC16(key) mod 16384 çš„å€¼ï¼Œå†³å®šå°†ä¸€ä¸ª key æ”¾åˆ°å“ªä¸ªæ¡¶ä¸­ã€‚ Redis Cluster ä¸»ä»Žæ¨¡å¼ Redis Cluster ä¸ºäº†ä¿è¯æ•°æ®çš„é«˜å¯ç”¨æ€§ï¼ŒåŠ å…¥äº†ä¸»ä»Žæ¨¡å¼ã€‚ ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªä»ŽèŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹æä¾›æ•°æ®å­˜å–ï¼Œä»ŽèŠ‚ç‚¹åˆ™æ˜¯ä»Žä¸»èŠ‚ç‚¹æ‹‰å–æ•°æ®å¤‡ä»½ã€‚å½“è¿™ä¸ªä¸»èŠ‚ç‚¹æŒ‚æŽ‰åŽï¼Œå°±ä¼šæœ‰è¿™ä¸ªä»ŽèŠ‚ç‚¹é€‰å–ä¸€ä¸ªæ¥å……å½“ä¸»èŠ‚ç‚¹ï¼Œä»Žè€Œä¿è¯é›†ç¾¤ä¸ä¼šæŒ‚æŽ‰ã€‚æ‰€ä»¥ï¼Œåœ¨é›†ç¾¤å»ºç«‹çš„æ—¶å€™ï¼Œä¸€å®šè¦ä¸ºæ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½æ·»åŠ äº†ä»ŽèŠ‚ç‚¹ã€‚ Redis Sentinel Redis Sentinel ç”¨äºŽç®¡ç†å¤šä¸ª Redis æœåŠ¡å™¨ï¼Œå®ƒæœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼š ç›‘æŽ§ï¼ˆMonitoringï¼‰ - Sentinel ä¼šä¸æ–­åœ°æ£€æŸ¥ä½ çš„ä¸»æœåŠ¡å™¨å’Œä»ŽæœåŠ¡å™¨æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚ æé†’ï¼ˆNotificationï¼‰ - å½“è¢«ç›‘æŽ§çš„æŸä¸ª Redis æœåŠ¡å™¨å‡ºçŽ°é—®é¢˜æ—¶ï¼Œ Sentinel å¯ä»¥é€šè¿‡ API å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚ è‡ªåŠ¨æ•…éšœè¿ç§»ï¼ˆAutomatic failoverï¼‰ - å½“ä¸€ä¸ªä¸»æœåŠ¡å™¨ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œ Sentinel ä¼šå¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»æ“ä½œï¼Œ å®ƒä¼šå°†å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä¸­ä¸€ä¸ªä»ŽæœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ï¼Œ å¹¶è®©å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä»–ä»ŽæœåŠ¡å™¨æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»æœåŠ¡å™¨ï¼› å½“å®¢æˆ·ç«¯è¯•å›¾è¿žæŽ¥å¤±æ•ˆçš„ä¸»æœåŠ¡å™¨æ—¶ï¼Œ é›†ç¾¤ä¹Ÿä¼šå‘å®¢æˆ·ç«¯è¿”å›žæ–°ä¸»æœåŠ¡å™¨çš„åœ°å€ï¼Œ ä½¿å¾—é›†ç¾¤å¯ä»¥ä½¿ç”¨æ–°ä¸»æœåŠ¡å™¨ä»£æ›¿å¤±æ•ˆæœåŠ¡å™¨ã€‚ Redis é›†ç¾¤ä¸­åº”è¯¥æœ‰å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥è‡³å°‘æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ã€‚ å“¨å…µç›‘æŽ§é›†ç¾¤ä¸­çš„ä¸»æœåŠ¡å™¨å‡ºçŽ°æ•…éšœæ—¶ï¼Œéœ€è¦æ ¹æ® quorum é€‰ä¸¾å‡ºä¸€ä¸ªå“¨å…µæ¥æ‰§è¡Œæ•…éšœè½¬ç§»ã€‚é€‰ä¸¾éœ€è¦ majorityï¼Œå³å¤§å¤šæ•°å“¨å…µæ˜¯è¿è¡Œçš„ï¼ˆ2 ä¸ªå“¨å…µçš„ majority=2ï¼Œ3 ä¸ªå“¨å…µçš„ majority=2ï¼Œ5 ä¸ªå“¨å…µçš„ majority=3ï¼Œ4 ä¸ªå“¨å…µçš„ majority=2ï¼‰ã€‚ å‡è®¾é›†ç¾¤ä»…ä»…éƒ¨ç½² 2 ä¸ªèŠ‚ç‚¹ +----+ +----+| M1 |---------| R1 || S1 | | S2 |+----+ +----+ å¦‚æžœ M1 å’Œ S1 æ‰€åœ¨æœåŠ¡å™¨å®•æœºï¼Œåˆ™å“¨å…µåªæœ‰ 1 ä¸ªï¼Œæ— æ³•æ»¡è¶³ majority æ¥è¿›è¡Œé€‰ä¸¾ï¼Œå°±ä¸èƒ½æ‰§è¡Œæ•…éšœè½¬ç§»ã€‚ 1.5. Redis å¦‚ä½•å®žçŽ°åˆ†å¸ƒå¼é”ï¼ŸZooKeeper å¦‚ä½•å®žçŽ°åˆ†å¸ƒå¼é”ï¼Ÿæ¯”è¾ƒäºŒè€…ä¼˜åŠ£ï¼Ÿ åˆ†å¸ƒå¼é”çš„ä¸‰ç§å®žçŽ°ï¼š åŸºäºŽæ•°æ®åº“å®žçŽ°åˆ†å¸ƒå¼é”ï¼› åŸºäºŽç¼“å­˜ï¼ˆRedis ç­‰ï¼‰å®žçŽ°åˆ†å¸ƒå¼é”ï¼› åŸºäºŽ Zookeeper å®žçŽ°åˆ†å¸ƒå¼é”ï¼› æ•°æ®åº“å®žçŽ° Redis å®žçŽ° èŽ·å–é”çš„æ—¶å€™ï¼Œä½¿ç”¨ setnx åŠ é”ï¼Œå¹¶ä½¿ç”¨ expire å‘½ä»¤ä¸ºé”æ·»åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´åˆ™è‡ªåŠ¨é‡Šæ”¾é”ï¼Œé”çš„ value å€¼ä¸ºä¸€ä¸ªéšæœºç”Ÿæˆçš„ UUIDï¼Œé€šè¿‡æ­¤åœ¨é‡Šæ”¾é”çš„æ—¶å€™è¿›è¡Œåˆ¤æ–­ã€‚ èŽ·å–é”çš„æ—¶å€™è¿˜è®¾ç½®ä¸€ä¸ªèŽ·å–çš„è¶…æ—¶æ—¶é—´ï¼Œè‹¥è¶…è¿‡è¿™ä¸ªæ—¶é—´åˆ™æ”¾å¼ƒèŽ·å–é”ã€‚ é‡Šæ”¾é”çš„æ—¶å€™ï¼Œé€šè¿‡ UUID åˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥é”ï¼Œè‹¥æ˜¯è¯¥é”ï¼Œåˆ™æ‰§è¡Œ delete è¿›è¡Œé”é‡Šæ”¾ã€‚ ZooKeeper å®žçŽ° åˆ›å»ºä¸€ä¸ªç›®å½• mylockï¼› çº¿ç¨‹ A æƒ³èŽ·å–é”å°±åœ¨ mylock ç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼› èŽ·å– mylock ç›®å½•ä¸‹æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œç„¶åŽèŽ·å–æ¯”è‡ªå·±å°çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œå¦‚æžœä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜Žå½“å‰çº¿ç¨‹é¡ºåºå·æœ€å°ï¼ŒèŽ·å¾—é”ï¼› çº¿ç¨‹ B èŽ·å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œåˆ¤æ–­è‡ªå·±ä¸æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œè®¾ç½®ç›‘å¬æ¯”è‡ªå·±æ¬¡å°çš„èŠ‚ç‚¹ï¼› çº¿ç¨‹ A å¤„ç†å®Œï¼Œåˆ é™¤è‡ªå·±çš„èŠ‚ç‚¹ï¼Œçº¿ç¨‹ B ç›‘å¬åˆ°å˜æ›´äº‹ä»¶ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œå¦‚æžœæ˜¯åˆ™èŽ·å¾—é”ã€‚ å®žçŽ°å¯¹æ¯” ZooKeeper å…·å¤‡é«˜å¯ç”¨ã€å¯é‡å…¥ã€é˜»å¡žé”ç‰¹æ€§ï¼Œå¯è§£å†³å¤±æ•ˆæ­»é”é—®é¢˜ã€‚ ä½† ZooKeeper å› ä¸ºéœ€è¦é¢‘ç¹çš„åˆ›å»ºå’Œåˆ é™¤èŠ‚ç‚¹ï¼Œæ€§èƒ½ä¸Šä¸å¦‚ Redis æ–¹å¼ã€‚ 1.6. Redis çš„æŒä¹…åŒ–æ–¹å¼ï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼ŸæŒä¹…åŒ–å®žçŽ°åŽŸç†ï¼Ÿ RDB å¿«ç…§ï¼ˆsnapshotï¼‰ å°†å­˜åœ¨äºŽæŸä¸€æ—¶åˆ»çš„æ‰€æœ‰æ•°æ®éƒ½å†™å…¥åˆ°ç¡¬ç›˜ä¸­ã€‚ å¿«ç…§çš„åŽŸç† åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedis å°†æ•°æ®åº“å¿«ç…§ä¿å­˜åœ¨åå­—ä¸º dump.rdb çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚ä½ å¯ä»¥å¯¹ Redis è¿›è¡Œè®¾ç½®ï¼Œ è®©å®ƒåœ¨â€œN ç§’å†…æ•°æ®é›†è‡³å°‘æœ‰ M ä¸ªæ”¹åŠ¨â€è¿™ä¸€æ¡ä»¶è¢«æ»¡è¶³æ—¶ï¼Œ è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡æ•°æ®é›†ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ SAVE æˆ–è€… BGSAVEï¼Œæ‰‹åŠ¨è®© Redis è¿›è¡Œæ•°æ®é›†ä¿å­˜æ“ä½œã€‚è¿™ç§æŒä¹…åŒ–æ–¹å¼è¢«ç§°ä¸ºå¿«ç…§ã€‚ å½“ Redis éœ€è¦ä¿å­˜ dump.rdb æ–‡ä»¶æ—¶ï¼Œ æœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹æ“ä½œ: Redis åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ã€‚ å­è¿›ç¨‹å°†æ•°æ®é›†å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶å¿«ç…§æ–‡ä»¶ä¸­ã€‚ å½“å­è¿›ç¨‹å®Œæˆå¯¹æ–°å¿«ç…§æ–‡ä»¶çš„å†™å…¥æ—¶ï¼ŒRedis ç”¨æ–°å¿«ç…§æ–‡ä»¶æ›¿æ¢åŽŸæ¥çš„å¿«ç…§æ–‡ä»¶ï¼Œå¹¶åˆ é™¤æ—§çš„å¿«ç…§æ–‡ä»¶ã€‚ è¿™ç§å·¥ä½œæ–¹å¼ä½¿å¾— Redis å¯ä»¥ä»Žå†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼‰æœºåˆ¶ä¸­èŽ·ç›Šã€‚ å¿«ç…§çš„ä¼˜ç‚¹ å®ƒä¿å­˜äº†æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®é›†ï¼Œéžå¸¸é€‚ç”¨äºŽæ•°æ®é›†çš„å¤‡ä»½ã€‚ å¾ˆæ–¹ä¾¿ä¼ é€åˆ°å¦ä¸€ä¸ªè¿œç«¯æ•°æ®ä¸­å¿ƒæˆ–è€…äºšé©¬é€Šçš„ S3ï¼ˆå¯èƒ½åŠ å¯†ï¼‰ï¼Œéžå¸¸é€‚ç”¨äºŽç¾éš¾æ¢å¤ã€‚ å¿«ç…§åœ¨ä¿å­˜ RDB æ–‡ä»¶æ—¶çˆ¶è¿›ç¨‹å”¯ä¸€éœ€è¦åšçš„å°±æ˜¯ fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼ŒæŽ¥ä¸‹æ¥çš„å·¥ä½œå…¨éƒ¨ç”±å­è¿›ç¨‹æ¥åšï¼Œçˆ¶è¿›ç¨‹ä¸éœ€è¦å†åšå…¶ä»– IO æ“ä½œï¼Œæ‰€ä»¥å¿«ç…§æŒä¹…åŒ–æ–¹å¼å¯ä»¥æœ€å¤§åŒ– redis çš„æ€§èƒ½ã€‚ ä¸Ž AOF ç›¸æ¯”ï¼Œåœ¨æ¢å¤å¤§çš„æ•°æ®é›†çš„æ—¶å€™ï¼ŒDB æ–¹å¼ä¼šæ›´å¿«ä¸€äº›ã€‚ å¿«ç…§çš„ç¼ºç‚¹ å¦‚æžœä½ å¸Œæœ›åœ¨ redis æ„å¤–åœæ­¢å·¥ä½œï¼ˆä¾‹å¦‚ç”µæºä¸­æ–­ï¼‰çš„æƒ…å†µä¸‹ä¸¢å¤±çš„æ•°æ®æœ€å°‘çš„è¯ï¼Œé‚£ä¹ˆå¿«ç…§ä¸é€‚åˆä½ ã€‚ å¿«ç…§éœ€è¦ç»å¸¸ fork å­è¿›ç¨‹æ¥ä¿å­˜æ•°æ®é›†åˆ°ç¡¬ç›˜ä¸Šã€‚å½“æ•°æ®é›†æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œfork çš„è¿‡ç¨‹æ˜¯éžå¸¸è€—æ—¶çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ Redis åœ¨ä¸€äº›æ¯«ç§’çº§å†…ä¸èƒ½å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ AOF AOF æŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨æ‰§è¡Œçš„å†™æ“ä½œã€‚å½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŽŸå§‹çš„æ•°æ®ã€‚ AOF çš„åŽŸç† Redis åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ã€‚ å­è¿›ç¨‹å¼€å§‹å°†æ–° AOF æ–‡ä»¶çš„å†…å®¹å†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ã€‚ å¯¹äºŽæ‰€æœ‰æ–°æ‰§è¡Œçš„å†™å…¥å‘½ä»¤ï¼Œçˆ¶è¿›ç¨‹ä¸€è¾¹å°†å®ƒä»¬ç´¯ç§¯åˆ°ä¸€ä¸ªå†…å­˜ç¼“å­˜ä¸­ï¼Œä¸€è¾¹å°†è¿™äº›æ”¹åŠ¨è¿½åŠ åˆ°çŽ°æœ‰ AOF æ–‡ä»¶çš„æœ«å°¾ï¼Œè¿™æ ·æ ·å³ä½¿åœ¨é‡å†™çš„ä¸­é€”å‘ç”Ÿåœæœºï¼ŒçŽ°æœ‰çš„ AOF æ–‡ä»¶ä¹Ÿè¿˜æ˜¯å®‰å…¨çš„ã€‚ å½“å­è¿›ç¨‹å®Œæˆé‡å†™å·¥ä½œæ—¶ï¼Œå®ƒç»™çˆ¶è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œçˆ¶è¿›ç¨‹åœ¨æŽ¥æ”¶åˆ°ä¿¡å·ä¹‹åŽï¼Œå°†å†…å­˜ç¼“å­˜ä¸­çš„æ‰€æœ‰æ•°æ®è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶çš„æœ«å°¾ã€‚ æžå®šï¼çŽ°åœ¨ Redis åŽŸå­åœ°ç”¨æ–°æ–‡ä»¶æ›¿æ¢æ—§æ–‡ä»¶ï¼Œä¹‹åŽæ‰€æœ‰å‘½ä»¤éƒ½ä¼šç›´æŽ¥è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶çš„æœ«å°¾ã€‚ AOF çš„ä¼˜ç‚¹ ä½¿ç”¨é»˜è®¤çš„æ¯ç§’ fsync ç­–ç•¥ï¼ŒRedis çš„æ€§èƒ½ä¾ç„¶å¾ˆå¥½(fsync æ˜¯ç”±åŽå°çº¿ç¨‹è¿›è¡Œå¤„ç†çš„,ä¸»çº¿ç¨‹ä¼šå°½åŠ›å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚)ï¼Œä¸€æ—¦å‡ºçŽ°æ•…éšœï¼Œä½¿ç”¨ AOF ï¼Œä½ æœ€å¤šä¸¢å¤± 1 ç§’çš„æ•°æ®ã€‚ AOF æ–‡ä»¶æ˜¯ä¸€ä¸ªåªè¿›è¡Œè¿½åŠ çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸éœ€è¦å†™å…¥ seekï¼Œå³ä½¿ç”±äºŽæŸäº›åŽŸå› (ç£ç›˜ç©ºé—´å·²æ»¡ï¼Œå†™çš„è¿‡ç¨‹ä¸­å®•æœºç­‰ç­‰)æœªæ‰§è¡Œå®Œæ•´çš„å†™å…¥å‘½ä»¤ï¼Œä½ ä¹Ÿä¹Ÿå¯ä½¿ç”¨ redis-check-aof å·¥å…·ä¿®å¤è¿™äº›é—®é¢˜ã€‚ Redis å¯ä»¥åœ¨ AOF æ–‡ä»¶ä½“ç§¯å˜å¾—è¿‡å¤§æ—¶ï¼Œè‡ªåŠ¨åœ°åœ¨åŽå°å¯¹ AOF è¿›è¡Œé‡å†™ï¼šé‡å†™åŽçš„æ–° AOF æ–‡ä»¶åŒ…å«äº†æ¢å¤å½“å‰æ•°æ®é›†æ‰€éœ€çš„æœ€å°å‘½ä»¤é›†åˆã€‚æ•´ä¸ªé‡å†™æ“ä½œæ˜¯ç»å¯¹å®‰å…¨çš„ã€‚ AOF æ–‡ä»¶æœ‰åºåœ°ä¿å­˜äº†å¯¹æ•°æ®åº“æ‰§è¡Œçš„æ‰€æœ‰å†™å…¥æ“ä½œï¼Œè¿™äº›å†™å…¥æ“ä½œä»¥ Redis åè®®çš„æ ¼å¼ä¿å­˜ã€‚å› æ­¤ AOF æ–‡ä»¶çš„å†…å®¹éžå¸¸å®¹æ˜“è¢«äººè¯»æ‡‚ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œåˆ†æžï¼ˆparseï¼‰ä¹Ÿå¾ˆè½»æ¾ã€‚ AOF çš„ç¼ºç‚¹ å¯¹äºŽç›¸åŒçš„æ•°æ®é›†æ¥è¯´ï¼ŒAOF æ–‡ä»¶çš„ä½“ç§¯é€šå¸¸è¦å¤§äºŽ RDB æ–‡ä»¶çš„ä½“ç§¯ã€‚ æ ¹æ®æ‰€ä½¿ç”¨çš„ fsync ç­–ç•¥ï¼ŒAOF çš„é€Ÿåº¦å¯èƒ½ä¼šæ…¢äºŽå¿«ç…§ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ç§’ fsync çš„æ€§èƒ½ä¾ç„¶éžå¸¸é«˜ï¼Œè€Œå…³é—­ fsync å¯ä»¥è®© AOF çš„é€Ÿåº¦å’Œå¿«ç…§ä¸€æ ·å¿«ï¼Œå³ä½¿åœ¨é«˜è´Ÿè·ä¹‹ä¸‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸è¿‡åœ¨å¤„ç†å·¨å¤§çš„å†™å…¥è½½å…¥æ—¶ï¼Œå¿«ç…§å¯ä»¥æä¾›æ›´æœ‰ä¿è¯çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ï¼ˆlatencyï¼‰ã€‚ 1.7. Redis è¿‡æœŸç­–ç•¥æœ‰å“ªäº›ï¼Ÿ noeviction - å½“å†…å­˜ä½¿ç”¨è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œæ‰€æœ‰å¼•èµ·ç”³è¯·å†…å­˜çš„å‘½ä»¤ä¼šæŠ¥é”™ã€‚ allkeys-lru - åœ¨ä¸»é”®ç©ºé—´ä¸­ï¼Œä¼˜å…ˆç§»é™¤æœ€è¿‘æœªä½¿ç”¨çš„ keyã€‚ allkeys-random - åœ¨ä¸»é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ª keyã€‚ volatile-lru - åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œä¼˜å…ˆç§»é™¤æœ€è¿‘æœªä½¿ç”¨çš„ keyã€‚ volatile-random - åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ª keyã€‚ volatile-ttl - åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œå…·æœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„ key ä¼˜å…ˆç§»é™¤ã€‚ 1.8. Redis å’Œ Memcached æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ä¸¤è€…éƒ½æ˜¯éžå…³ç³»åž‹å†…å­˜é”®å€¼æ•°æ®åº“ã€‚æœ‰ä»¥ä¸‹ä¸»è¦ä¸åŒï¼š æ•°æ®ç±»åž‹ Memcached ä»…æ”¯æŒå­—ç¬¦ä¸²ç±»åž‹ï¼› è€Œ Redis æ”¯æŒäº”ç§ä¸åŒç§ç±»çš„æ•°æ®ç±»åž‹ï¼Œä½¿å¾—å®ƒå¯ä»¥æ›´çµæ´»åœ°è§£å†³é—®é¢˜ã€‚ æ•°æ®æŒä¹…åŒ– Memcached ä¸æ”¯æŒæŒä¹…åŒ–ï¼› Redis æ”¯æŒä¸¤ç§æŒä¹…åŒ–ç­–ç•¥ï¼šRDB å¿«ç…§å’Œ AOF æ—¥å¿—ã€‚ åˆ†å¸ƒå¼ Memcached ä¸æ”¯æŒåˆ†å¸ƒå¼ï¼Œåªèƒ½é€šè¿‡åœ¨å®¢æˆ·ç«¯ä½¿ç”¨åƒä¸€è‡´æ€§å“ˆå¸Œè¿™æ ·çš„åˆ†å¸ƒå¼ç®—æ³•æ¥å®žçŽ°åˆ†å¸ƒå¼å­˜å‚¨ï¼Œè¿™ç§æ–¹å¼åœ¨å­˜å‚¨å’ŒæŸ¥è¯¢æ—¶éƒ½éœ€è¦å…ˆåœ¨å®¢æˆ·ç«¯è®¡ç®—ä¸€æ¬¡æ•°æ®æ‰€åœ¨çš„èŠ‚ç‚¹ã€‚ Redis Cluster å®žçŽ°äº†åˆ†å¸ƒå¼çš„æ”¯æŒã€‚ å†…å­˜ç®¡ç†æœºåˆ¶ Memcached å°†å†…å­˜åˆ†å‰²æˆç‰¹å®šé•¿åº¦çš„å—æ¥å­˜å‚¨æ•°æ®ï¼Œä»¥å®Œå…¨è§£å†³å†…å­˜ç¢Žç‰‡çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä¼šä½¿å¾—å†…å­˜çš„åˆ©ç”¨çŽ‡ä¸é«˜ï¼Œä¾‹å¦‚å—çš„å¤§å°ä¸º 128 bytesï¼Œåªå­˜å‚¨ 100 bytes çš„æ•°æ®ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ 28 bytes å°±æµªè´¹æŽ‰äº†ã€‚ åœ¨ Redis ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½ä¸€ç›´å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥å°†ä¸€äº›å¾ˆä¹…æ²¡ç”¨çš„ value äº¤æ¢åˆ°ç£ç›˜ã€‚è€Œ Memcached çš„æ•°æ®åˆ™ä¼šä¸€ç›´åœ¨å†…å­˜ä¸­ã€‚ 1.9. ä¸ºä»€ä¹ˆå•çº¿ç¨‹çš„ Redis æ€§èƒ½åè€Œä¼˜äºŽå¤šçº¿ç¨‹çš„ Memcachedï¼Ÿ Redis å¿«é€Ÿçš„åŽŸå› ï¼š ç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼ˆéžå¸¸å¿«é€Ÿï¼‰ é‡‡ç”¨å•çº¿ç¨‹,é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«žäº‰æ¡ä»¶ éžé˜»å¡ž IO å†…éƒ¨å®žçŽ°é‡‡ç”¨ epollï¼Œé‡‡ç”¨äº† epoll+è‡ªå·±å®žçŽ°çš„ç®€å•çš„äº‹ä»¶æ¡†æž¶ã€‚epoll ä¸­çš„è¯»ã€å†™ã€å…³é—­ã€è¿žæŽ¥éƒ½è½¬åŒ–æˆäº†äº‹ä»¶ï¼Œç„¶åŽåˆ©ç”¨ epoll çš„å¤šè·¯å¤ç”¨ç‰¹æ€§ï¼Œç»ä¸åœ¨ io ä¸Šæµªè´¹ä¸€ç‚¹æ—¶é—´ã€‚ 2. åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰ 2.1. ä¸ºä»€ä¹ˆä½¿ç”¨ MQï¼Ÿ å¼‚æ­¥å¤„ç† - ç›¸æ¯”äºŽä¼ ç»Ÿçš„ä¸²è¡Œã€å¹¶è¡Œæ–¹å¼ï¼Œæé«˜äº†ç³»ç»Ÿåžåé‡ã€‚ åº”ç”¨è§£è€¦ - ç³»ç»Ÿé—´é€šè¿‡æ¶ˆæ¯é€šä¿¡ï¼Œä¸ç”¨å…³å¿ƒå…¶ä»–ç³»ç»Ÿçš„å¤„ç†ã€‚ æµé‡å‰Šé”‹ - å¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦æŽ§åˆ¶è¯·æ±‚é‡ï¼›å¯ä»¥ç¼“è§£çŸ­æ—¶é—´å†…çš„é«˜å¹¶å‘è¯·æ±‚ã€‚ æ—¥å¿—å¤„ç† - è§£å†³å¤§é‡æ—¥å¿—ä¼ è¾“ã€‚ æ¶ˆæ¯é€šè®¯ - æ¶ˆæ¯é˜Ÿåˆ—ä¸€èˆ¬éƒ½å†…ç½®äº†é«˜æ•ˆçš„é€šä¿¡æœºåˆ¶ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç”¨åœ¨çº¯çš„æ¶ˆæ¯é€šè®¯ã€‚æ¯”å¦‚å®žçŽ°ç‚¹å¯¹ç‚¹æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ–è€…èŠå¤©å®¤ç­‰ã€‚ 2.2. å¦‚ä½•ä¿è¯ MQ çš„é«˜å¯ç”¨ï¼Ÿ æ•°æ®å¤åˆ¶ å°†æ‰€æœ‰ Broker å’Œå¾…åˆ†é…çš„ Partition æŽ’åº å°†ç¬¬ i ä¸ª Partition åˆ†é…åˆ°ç¬¬ï¼ˆi mod nï¼‰ä¸ª Broker ä¸Š å°†ç¬¬ i ä¸ª Partition çš„ç¬¬ j ä¸ª Replica åˆ†é…åˆ°ç¬¬ï¼ˆ(i + j) mode nï¼‰ä¸ª Broker ä¸Š é€‰ä¸¾ä¸»æœåŠ¡å™¨ 2.3. MQ æœ‰å“ªäº›å¸¸è§é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ MQ çš„å¸¸è§é—®é¢˜æœ‰ï¼š æ¶ˆæ¯çš„é¡ºåºé—®é¢˜ æ¶ˆæ¯çš„é‡å¤é—®é¢˜ æ¶ˆæ¯çš„é¡ºåºé—®é¢˜ æ¶ˆæ¯æœ‰åºæŒ‡çš„æ˜¯å¯ä»¥æŒ‰ç…§æ¶ˆæ¯çš„å‘é€é¡ºåºæ¥æ¶ˆè´¹ã€‚ å‡å¦‚ç”Ÿäº§è€…äº§ç”Ÿäº† 2 æ¡æ¶ˆæ¯ï¼šM1ã€M2ï¼Œå‡å®š M1 å‘é€åˆ° S1ï¼ŒM2 å‘é€åˆ° S2ï¼Œå¦‚æžœè¦ä¿è¯ M1 å…ˆäºŽ M2 è¢«æ¶ˆè´¹ï¼Œæ€Žä¹ˆåšï¼Ÿ è§£å†³æ–¹æ¡ˆï¼š ï¼ˆ1ï¼‰ä¿è¯ç”Ÿäº§è€… - MQServer - æ¶ˆè´¹è€…æ˜¯ä¸€å¯¹ä¸€å¯¹ä¸€çš„å…³ç³» ç¼ºé™·ï¼š å¹¶è¡Œåº¦å°±ä¼šæˆä¸ºæ¶ˆæ¯ç³»ç»Ÿçš„ç“¶é¢ˆï¼ˆåžåé‡ä¸å¤Ÿï¼‰ æ›´å¤šçš„å¼‚å¸¸å¤„ç†ï¼Œæ¯”å¦‚ï¼šåªè¦æ¶ˆè´¹ç«¯å‡ºçŽ°é—®é¢˜ï¼Œå°±ä¼šå¯¼è‡´æ•´ä¸ªå¤„ç†æµç¨‹é˜»å¡žï¼Œæˆ‘ä»¬ä¸å¾—ä¸èŠ±è´¹æ›´å¤šçš„ç²¾åŠ›æ¥è§£å†³é˜»å¡žçš„é—®é¢˜ã€‚ ï¼ˆ2ï¼‰é€šè¿‡åˆç†çš„è®¾è®¡æˆ–è€…å°†é—®é¢˜åˆ†è§£æ¥è§„é¿ã€‚ ä¸å…³æ³¨ä¹±åºçš„åº”ç”¨å®žé™…å¤§é‡å­˜åœ¨ é˜Ÿåˆ—æ— åºå¹¶ä¸æ„å‘³ç€æ¶ˆæ¯æ— åº æ‰€ä»¥ä»Žä¸šåŠ¡å±‚é¢æ¥ä¿è¯æ¶ˆæ¯çš„é¡ºåºè€Œä¸ä»…ä»…æ˜¯ä¾èµ–äºŽæ¶ˆæ¯ç³»ç»Ÿï¼Œæ˜¯ä¸€ç§æ›´åˆç†çš„æ–¹å¼ã€‚ æ¶ˆæ¯çš„é‡å¤é—®é¢˜ é€ æˆæ¶ˆæ¯é‡å¤çš„æ ¹æœ¬åŽŸå› æ˜¯ï¼šç½‘ç»œä¸å¯è¾¾ã€‚ æ‰€ä»¥è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠžæ³•å°±æ˜¯ç»•è¿‡è¿™ä¸ªé—®é¢˜ã€‚é‚£ä¹ˆé—®é¢˜å°±å˜æˆäº†ï¼šå¦‚æžœæ¶ˆè´¹ç«¯æ”¶åˆ°ä¸¤æ¡ä¸€æ ·çš„æ¶ˆæ¯ï¼Œåº”è¯¥æ€Žæ ·å¤„ç†ï¼Ÿ æ¶ˆè´¹ç«¯å¤„ç†æ¶ˆæ¯çš„ä¸šåŠ¡é€»è¾‘ä¿æŒå¹‚ç­‰æ€§ã€‚åªè¦ä¿æŒå¹‚ç­‰æ€§ï¼Œä¸ç®¡æ¥å¤šå°‘æ¡é‡å¤æ¶ˆæ¯ï¼Œæœ€åŽå¤„ç†çš„ç»“æžœéƒ½ä¸€æ ·ã€‚ ä¿è¯æ¯æ¡æ¶ˆæ¯éƒ½æœ‰å”¯ä¸€ç¼–å·ä¸”ä¿è¯æ¶ˆæ¯å¤„ç†æˆåŠŸä¸ŽåŽ»é‡è¡¨çš„æ—¥å¿—åŒæ—¶å‡ºçŽ°ã€‚åˆ©ç”¨ä¸€å¼ æ—¥å¿—è¡¨æ¥è®°å½•å·²ç»å¤„ç†æˆåŠŸçš„æ¶ˆæ¯çš„ IDï¼Œå¦‚æžœæ–°åˆ°çš„æ¶ˆæ¯ ID å·²ç»åœ¨æ—¥å¿—è¡¨ä¸­ï¼Œé‚£ä¹ˆå°±ä¸å†å¤„ç†è¿™æ¡æ¶ˆæ¯ã€‚ 2.4. Kafka, ActiveMQ, RabbitMQ, RocketMQ å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ 3. åˆ†å¸ƒå¼æœåŠ¡ï¼ˆRPCï¼‰ 3.1. Dubbo çš„å®žçŽ°è¿‡ç¨‹ï¼Ÿ èŠ‚ç‚¹è§’è‰²ï¼š èŠ‚ç‚¹ è§’è‰²è¯´æ˜Ž Provider æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ Consumer è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ Registry æœåŠ¡æ³¨å†Œä¸Žå‘çŽ°çš„æ³¨å†Œä¸­å¿ƒ Monitor ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æŽ§ä¸­å¿ƒ Container æœåŠ¡è¿è¡Œå®¹å™¨ è°ƒç”¨å…³ç³»ï¼š åŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚ æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚ æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚ æ³¨å†Œä¸­å¿ƒè¿”å›žæœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æžœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºŽé•¿è¿žæŽ¥æŽ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚ æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»Žæä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºŽè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æžœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚ æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æŽ§ä¸­å¿ƒã€‚ 3.2. Dubbo è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ Random éšæœºï¼ŒæŒ‰æƒé‡è®¾ç½®éšæœºæ¦‚çŽ‡ã€‚ åœ¨ä¸€ä¸ªæˆªé¢ä¸Šç¢°æ’žçš„æ¦‚çŽ‡é«˜ï¼Œä½†è°ƒç”¨é‡è¶Šå¤§åˆ†å¸ƒè¶Šå‡åŒ€ï¼Œè€Œä¸”æŒ‰æ¦‚çŽ‡ä½¿ç”¨æƒé‡åŽä¹Ÿæ¯”è¾ƒå‡åŒ€ï¼Œæœ‰åˆ©äºŽåŠ¨æ€è°ƒæ•´æä¾›è€…æƒé‡ã€‚ RoundRobin è½®å¾ªï¼ŒæŒ‰å…¬çº¦åŽçš„æƒé‡è®¾ç½®è½®å¾ªæ¯”çŽ‡ã€‚ å­˜åœ¨æ…¢çš„æä¾›è€…ç´¯ç§¯è¯·æ±‚çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šç¬¬äºŒå°æœºå™¨å¾ˆæ…¢ï¼Œä½†æ²¡æŒ‚ï¼Œå½“è¯·æ±‚è°ƒåˆ°ç¬¬äºŒå°æ—¶å°±å¡åœ¨é‚£ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¡åœ¨è°ƒåˆ°ç¬¬äºŒå°ä¸Šã€‚ LeastActive æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°ï¼Œç›¸åŒæ´»è·ƒæ•°çš„éšæœºï¼Œæ´»è·ƒæ•°æŒ‡è°ƒç”¨å‰åŽè®¡æ•°å·®ã€‚ ä½¿æ…¢çš„æä¾›è€…æ”¶åˆ°æ›´å°‘è¯·æ±‚ï¼Œå› ä¸ºè¶Šæ…¢çš„æä¾›è€…çš„è°ƒç”¨å‰åŽè®¡æ•°å·®ä¼šè¶Šå¤§ã€‚ ConsistentHash ä¸€è‡´æ€§ Hashï¼Œç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚ å½“æŸä¸€å°æä¾›è€…æŒ‚æ—¶ï¼ŒåŽŸæœ¬å‘å¾€è¯¥æä¾›è€…çš„è¯·æ±‚ï¼ŒåŸºäºŽè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹³æ‘Šåˆ°å…¶å®ƒæä¾›è€…ï¼Œä¸ä¼šå¼•èµ·å‰§çƒˆå˜åŠ¨ã€‚ ç®—æ³•å‚è§ï¼šhttp://en.wikipedia.org/wiki/Consistent_hashing ç¼ºçœåªå¯¹ç¬¬ä¸€ä¸ªå‚æ•° Hashï¼Œå¦‚æžœè¦ä¿®æ”¹ï¼Œè¯·é…ç½® &lt;dubbo:parameter key=&quot;hash.arguments&quot; value=&quot;0,1&quot; /&gt; ç¼ºçœç”¨ 160 ä»½è™šæ‹ŸèŠ‚ç‚¹ï¼Œå¦‚æžœè¦ä¿®æ”¹ï¼Œè¯·é…ç½® &lt;dubbo:parameter key=&quot;hash.nodes&quot; value=&quot;320&quot; /&gt; 3.3. Dubbo é›†ç¾¤å®¹é”™ç­–ç•¥ ï¼Ÿ Failover - å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“å‡ºçŽ°å¤±è´¥ï¼Œé‡è¯•å…¶å®ƒæœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äºŽè¯»æ“ä½œï¼Œä½†é‡è¯•ä¼šå¸¦æ¥æ›´é•¿å»¶è¿Ÿã€‚å¯é€šè¿‡ retries=â€œ2â€ æ¥è®¾ç½®é‡è¯•æ¬¡æ•°(ä¸å«ç¬¬ä¸€æ¬¡)ã€‚ Failfast - å¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥ç«‹å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºŽéžå¹‚ç­‰æ€§çš„å†™æ“ä½œï¼Œæ¯”å¦‚æ–°å¢žè®°å½•ã€‚ Failsafe - å¤±è´¥å®‰å…¨ï¼Œå‡ºçŽ°å¼‚å¸¸æ—¶ï¼Œç›´æŽ¥å¿½ç•¥ã€‚é€šå¸¸ç”¨äºŽå†™å…¥å®¡è®¡æ—¥å¿—ç­‰æ“ä½œã€‚ Failback - å¤±è´¥è‡ªåŠ¨æ¢å¤ï¼ŒåŽå°è®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘ã€‚é€šå¸¸ç”¨äºŽæ¶ˆæ¯é€šçŸ¥æ“ä½œã€‚ Forking - å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›žã€‚é€šå¸¸ç”¨äºŽå®žæ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¯»æ“ä½œï¼Œä½†éœ€è¦æµªè´¹æ›´å¤šæœåŠ¡èµ„æºã€‚å¯é€šè¿‡ forks=â€œ2â€ æ¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°ã€‚ Broadcast - æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…ï¼Œé€ä¸ªè°ƒç”¨ï¼Œä»»æ„ä¸€å°æŠ¥é”™åˆ™æŠ¥é”™ã€‚é€šå¸¸ç”¨äºŽé€šçŸ¥æ‰€æœ‰æä¾›è€…æ›´æ–°ç¼“å­˜æˆ–æ—¥å¿—ç­‰æœ¬åœ°èµ„æºä¿¡æ¯ã€‚ 3.4. åŠ¨æ€ä»£ç†ç­–ç•¥ï¼Ÿ Dubbo ä½œä¸º RPC æ¡†æž¶ï¼Œé¦–å…ˆè¦å®Œæˆçš„å°±æ˜¯è·¨ç³»ç»Ÿï¼Œè·¨ç½‘ç»œçš„æœåŠ¡è°ƒç”¨ã€‚æ¶ˆè´¹æ–¹ä¸Žæä¾›æ–¹éµå¾ªç»Ÿä¸€çš„æŽ¥å£å®šä¹‰ï¼Œæ¶ˆè´¹æ–¹è°ƒç”¨æŽ¥å£æ—¶ï¼ŒDubbo å°†å…¶è½¬æ¢æˆç»Ÿä¸€æ ¼å¼çš„æ•°æ®ç»“æž„ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œæä¾›æ–¹æ ¹æ®è§„åˆ™æ‰¾åˆ°æŽ¥å£å®žçŽ°ï¼Œé€šè¿‡åå°„å®Œæˆè°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆè´¹æ–¹èŽ·å–çš„æ˜¯å¯¹è¿œç¨‹æœåŠ¡çš„ä¸€ä¸ªä»£ç†(Proxy)ï¼Œè€Œæä¾›æ–¹å› ä¸ºè¦æ”¯æŒä¸åŒçš„æŽ¥å£å®žçŽ°ï¼Œéœ€è¦ä¸€ä¸ªåŒ…è£…å±‚(Wrapper)ã€‚è°ƒç”¨çš„è¿‡ç¨‹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š æ¶ˆè´¹æ–¹çš„ Proxy å’Œæä¾›æ–¹çš„ Wrapper å¾—ä»¥è®© Dubbo æž„å»ºå‡ºå¤æ‚ã€ç»Ÿä¸€çš„ä½“ç³»ã€‚è€Œè¿™ç§åŠ¨æ€ä»£ç†ä¸ŽåŒ…è£…ä¹Ÿæ˜¯é€šè¿‡åŸºäºŽ SPI çš„æ’ä»¶æ–¹å¼å®žçŽ°çš„ï¼Œå®ƒçš„æŽ¥å£å°±æ˜¯ProxyFactoryã€‚ @SPI("javassist")public interface ProxyFactory &#123; @Adaptive(&#123;Constants.PROXY_KEY&#125;) &lt;T&gt; T getProxy(Invoker&lt;T&gt; invoker) throws RpcException; @Adaptive(&#123;Constants.PROXY_KEY&#125;) &lt;T&gt; Invoker&lt;T&gt; getInvoker(T proxy, Class&lt;T&gt; type, URL url) throws RpcException;&#125; ProxyFactory æœ‰ä¸¤ç§å®žçŽ°æ–¹å¼ï¼Œä¸€ç§æ˜¯åŸºäºŽ JDK çš„ä»£ç†å®žçŽ°ï¼Œä¸€ç§æ˜¯åŸºäºŽ javassist çš„å®žçŽ°ã€‚ProxyFactory æŽ¥å£ä¸Šå®šä¹‰äº†@SPI(â€œjavassistâ€)ï¼Œé»˜è®¤ä¸º javassist çš„å®žçŽ°ã€‚ 3.5. Dubbo æ”¯æŒå“ªäº›åºåˆ—åŒ–åè®®ï¼ŸHessianï¼ŸHessian çš„æ•°æ®ç»“æž„ï¼Ÿ dubbo åºåˆ—åŒ–ï¼Œé˜¿é‡Œå°šä¸æˆç†Ÿçš„ java åºåˆ—åŒ–å®žçŽ°ã€‚ hessian2 åºåˆ—åŒ–ï¼šhessian æ˜¯ä¸€ç§è·¨è¯­è¨€çš„é«˜æ•ˆäºŒè¿›åˆ¶çš„åºåˆ—åŒ–æ–¹å¼ï¼Œä½†è¿™é‡Œå®žé™…ä¸æ˜¯åŽŸç”Ÿçš„ hessian2 åºåˆ—åŒ–ï¼Œè€Œæ˜¯é˜¿é‡Œä¿®æ”¹è¿‡çš„ hessian liteï¼Œå®ƒæ˜¯ dubbo RPC é»˜è®¤å¯ç”¨çš„åºåˆ—åŒ–æ–¹å¼ã€‚ json åºåˆ—åŒ–ï¼šç›®å‰æœ‰ä¸¤ç§å®žçŽ°ï¼Œä¸€ç§æ˜¯é‡‡ç”¨çš„é˜¿é‡Œçš„ fastjson åº“ï¼Œå¦ä¸€ç§æ˜¯é‡‡ç”¨ dubbo ä¸­è‡ªå·²å®žçŽ°çš„ç®€å• json åº“ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œjson è¿™ç§æ–‡æœ¬åºåˆ—åŒ–æ€§èƒ½ä¸å¦‚äºŒè¿›åˆ¶åºåˆ—åŒ–ã€‚ java åºåˆ—åŒ–ï¼šä¸»è¦æ˜¯é‡‡ç”¨ JDK è‡ªå¸¦çš„ java åºåˆ—åŒ–å®žçŽ°ï¼Œæ€§èƒ½å¾ˆä¸ç†æƒ³ã€‚ Kryo å’Œ FSTï¼šKryo å’Œ FST çš„æ€§èƒ½ä¾ç„¶æ™®éä¼˜äºŽ hessian å’Œ dubbo åºåˆ—åŒ–ã€‚ Hessian åºåˆ—åŒ–ä¸Ž Java é»˜è®¤çš„åºåˆ—åŒ–åŒºåˆ«ï¼Ÿ Hessian æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ remoting on http å·¥å…·ï¼Œé‡‡ç”¨çš„æ˜¯ Binary RPC åè®®ï¼Œæ‰€ä»¥å®ƒå¾ˆé€‚åˆäºŽå‘é€äºŒè¿›åˆ¶æ•°æ®ï¼ŒåŒæ—¶åˆå…·æœ‰é˜²ç«å¢™ç©¿é€èƒ½åŠ›ã€‚ Hessian æ”¯æŒè·¨è¯­è¨€ä¸²è¡Œ æ¯” java åºåˆ—åŒ–å…·æœ‰æ›´å¥½çš„æ€§èƒ½å’Œæ˜“ç”¨æ€§ æ”¯æŒçš„è¯­è¨€æ¯”è¾ƒå¤š 3.6. Protoco Buffer æ˜¯ä»€ä¹ˆï¼Ÿ Protocol Buffer æ˜¯ Google å‡ºå“çš„ä¸€ç§è½»é‡ &amp; é«˜æ•ˆçš„ç»“æž„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œæ€§èƒ½æ¯” Jsonã€XML çœŸçš„å¼ºï¼å¤ªï¼å¤šï¼ Protocol Buffer çš„åºåˆ—åŒ– &amp; ååºåˆ—åŒ–ç®€å• &amp; é€Ÿåº¦å¿«çš„åŽŸå› æ˜¯ï¼š ç¼–ç  / è§£ç  æ–¹å¼ç®€å•ï¼ˆåªéœ€è¦ç®€å•çš„æ•°å­¦è¿ç®— = ä½ç§»ç­‰ç­‰ï¼‰ é‡‡ç”¨ Protocol Buffer è‡ªèº«çš„æ¡†æž¶ä»£ç  å’Œ ç¼–è¯‘å™¨ å…±åŒå®Œæˆ Protocol Buffer çš„æ•°æ®åŽ‹ç¼©æ•ˆæžœå¥½ï¼ˆå³åºåˆ—åŒ–åŽçš„æ•°æ®é‡ä½“ç§¯å°ï¼‰çš„åŽŸå› æ˜¯ï¼š é‡‡ç”¨äº†ç‹¬ç‰¹çš„ç¼–ç æ–¹å¼ï¼Œå¦‚ Varintã€Zigzag ç¼–ç æ–¹å¼ç­‰ç­‰ é‡‡ç”¨ T - L - V çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼šå‡å°‘äº†åˆ†éš”ç¬¦çš„ä½¿ç”¨ &amp; æ•°æ®å­˜å‚¨å¾—ç´§å‡‘ 3.7. æ³¨å†Œä¸­å¿ƒæŒ‚äº†å¯ä»¥ç»§ç»­é€šä¿¡å—ï¼Ÿ å¯ä»¥ã€‚Dubbo æ¶ˆè´¹è€…åœ¨åº”ç”¨å¯åŠ¨æ—¶ä¼šä»Žæ³¨å†Œä¸­å¿ƒæ‹‰å–å·²æ³¨å†Œçš„ç”Ÿäº§è€…çš„åœ°å€æŽ¥å£ï¼Œå¹¶ç¼“å­˜åœ¨æœ¬åœ°ã€‚æ¯æ¬¡è°ƒç”¨æ—¶ï¼ŒæŒ‰ç…§æœ¬åœ°å­˜å‚¨çš„åœ°å€è¿›è¡Œè°ƒç”¨ã€‚ 3.8. ZooKeeper åŽŸç†æ˜¯ä»€ä¹ˆï¼ŸZooKeeper æœ‰ä»€ä¹ˆç”¨ï¼Ÿ ZooKeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨åè°ƒç³»ç»Ÿï¼Œå·²ç»ç”¨åˆ°äº†è®¸å¤šåˆ†å¸ƒå¼é¡¹ç›®ä¸­ï¼Œç”¨æ¥å®Œæˆç»Ÿä¸€å‘½åæœåŠ¡ã€çŠ¶æ€åŒæ­¥æœåŠ¡ã€é›†ç¾¤ç®¡ç†ã€åˆ†å¸ƒå¼åº”ç”¨é…ç½®é¡¹çš„ç®¡ç†ç­‰å·¥ä½œã€‚ æ¯ä¸ª Server åœ¨å†…å­˜ä¸­å­˜å‚¨äº†ä¸€ä»½æ•°æ®ï¼› Zookeeper å¯åŠ¨æ—¶ï¼Œå°†ä»Žå®žä¾‹ä¸­é€‰ä¸¾ä¸€ä¸ª leaderï¼ˆPaxos åè®®ï¼‰ï¼› Leader è´Ÿè´£å¤„ç†æ•°æ®æ›´æ–°ç­‰æ“ä½œï¼ˆZab åè®®ï¼‰ï¼› ä¸€ä¸ªæ›´æ–°æ“ä½œæˆåŠŸï¼Œå½“ä¸”ä»…å½“å¤§å¤šæ•° Server åœ¨å†…å­˜ä¸­æˆåŠŸä¿®æ”¹æ•°æ®ã€‚ 3.9. Netty æœ‰ä»€ä¹ˆç”¨ï¼ŸNIO/BIO/AIO æœ‰ä»€ä¹ˆç”¨ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Netty æ˜¯ä¸€ä¸ªâ€œç½‘ç»œé€šè®¯æ¡†æž¶â€ã€‚ Netty è¿›è¡Œäº‹ä»¶å¤„ç†çš„æµç¨‹ã€‚Channelæ˜¯è¿žæŽ¥çš„é€šé“ï¼Œæ˜¯ ChannelEvent çš„äº§ç”Ÿè€…ï¼Œè€ŒChannelPipelineå¯ä»¥ç†è§£ä¸º ChannelHandler çš„é›†åˆã€‚ å‚è€ƒï¼šhttps://github.com/code4craft/netty-learning/blob/master/posts/ch1-overview.md IO çš„æ–¹å¼é€šå¸¸åˆ†ä¸ºå‡ ç§ï¼š åŒæ­¥é˜»å¡žçš„ BIO åŒæ­¥éžé˜»å¡žçš„ NIO å¼‚æ­¥éžé˜»å¡žçš„ AIO åœ¨ä½¿ç”¨åŒæ­¥ I/O çš„ç½‘ç»œåº”ç”¨ä¸­ï¼Œå¦‚æžœè¦åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼Œæˆ–æ˜¯åœ¨å®¢æˆ·ç«¯è¦åŒæ—¶å’Œå¤šä¸ªæœåŠ¡å™¨è¿›è¡Œé€šè®¯ï¼Œå°±å¿…é¡»ä½¿ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†ã€‚ NIO åŸºäºŽ Reactorï¼Œå½“ socket æœ‰æµå¯è¯»æˆ–å¯å†™å…¥ socket æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šç›¸åº”çš„é€šçŸ¥å¼•ç”¨ç¨‹åºè¿›è¡Œå¤„ç†ï¼Œåº”ç”¨å†å°†æµè¯»å–åˆ°ç¼“å†²åŒºæˆ–å†™å…¥æ“ä½œç³»ç»Ÿã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå·²ç»ä¸æ˜¯ä¸€ä¸ªè¿žæŽ¥å°±è¦å¯¹åº”ä¸€ä¸ªå¤„ç†çº¿ç¨‹äº†ï¼Œè€Œæ˜¯æœ‰æ•ˆçš„è¯·æ±‚ï¼Œå¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“è¿žæŽ¥æ²¡æœ‰æ•°æ®æ—¶ï¼Œæ˜¯æ²¡æœ‰å·¥ä½œçº¿ç¨‹æ¥å¤„ç†çš„ã€‚ ä¸Ž NIO ä¸åŒï¼Œå½“è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œåªé¡»ç›´æŽ¥è°ƒç”¨ API çš„ read æˆ– write æ–¹æ³•å³å¯ã€‚è¿™ä¸¤ç§æ–¹æ³•å‡ä¸ºå¼‚æ­¥çš„ï¼Œå¯¹äºŽè¯»æ“ä½œè€Œè¨€ï¼Œå½“æœ‰æµå¯è¯»å–æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†å¯è¯»çš„æµä¼ å…¥ read æ–¹æ³•çš„ç¼“å†²åŒºï¼Œå¹¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼›å¯¹äºŽå†™æ“ä½œè€Œè¨€ï¼Œå½“æ“ä½œç³»ç»Ÿå°† write æ–¹æ³•ä¼ é€’çš„æµå†™å…¥å®Œæ¯•æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸»åŠ¨é€šçŸ¥åº”ç”¨ç¨‹åºã€‚ å³å¯ä»¥ç†è§£ä¸ºï¼Œread/write æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå®ŒæˆåŽä¼šä¸»åŠ¨è°ƒç”¨å›žè°ƒå‡½æ•°ã€‚ å‚è€ƒï¼šhttps://blog.csdn.net/skiof007/article/details/52873421 3.10. ä¸ºä»€ä¹ˆè¦è¿›è¡Œç³»ç»Ÿæ‹†åˆ†ï¼Ÿæ‹†åˆ†ä¸ç”¨ Dubbo å¯ä»¥å—ï¼Ÿ ç³»ç»Ÿæ‹†åˆ†ä»Žèµ„æºè§’åº¦åˆ†ä¸ºï¼šåº”ç”¨æ‹†åˆ†å’Œæ•°æ®åº“æ‹†åˆ†ã€‚ ä»Žé‡‡ç”¨çš„å…ˆåŽé¡ºåºå¯åˆ†ä¸ºï¼šæ°´å¹³æ‰©å±•ã€åž‚ç›´æ‹†åˆ†ã€ä¸šåŠ¡æ‹†åˆ†ã€æ°´å¹³æ‹†åˆ†ã€‚ æ˜¯å¦ä½¿ç”¨æœåŠ¡ä¾æ®å®žé™…ä¸šåŠ¡åœºæ™¯æ¥å†³å®šã€‚ å½“åž‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒï¼Œä½¿å‰ç«¯åº”ç”¨èƒ½æ›´å¿«é€Ÿçš„å“åº”å¤šå˜çš„å¸‚åœºéœ€æ±‚ã€‚æ­¤æ—¶ï¼Œç”¨äºŽæé«˜ä¸šåŠ¡å¤ç”¨åŠæ•´åˆçš„åˆ†å¸ƒå¼æœåŠ¡æ¡†æž¶(RPC)æ˜¯å…³é”®ã€‚ å½“æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå®¹é‡çš„è¯„ä¼°ï¼Œå°æœåŠ¡èµ„æºçš„æµªè´¹ç­‰é—®é¢˜é€æ¸æ˜¾çŽ°ï¼Œæ­¤æ—¶éœ€å¢žåŠ ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒåŸºäºŽè®¿é—®åŽ‹åŠ›å®žæ—¶ç®¡ç†é›†ç¾¤å®¹é‡ï¼Œæé«˜é›†ç¾¤åˆ©ç”¨çŽ‡ã€‚æ­¤æ—¶ï¼Œç”¨äºŽæé«˜æœºå™¨åˆ©ç”¨çŽ‡çš„èµ„æºè°ƒåº¦å’Œæ²»ç†ä¸­å¿ƒ(SOA)æ˜¯å…³é”®ã€‚ 3.11. Dubbo å’Œ Thrift æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Thrift æ˜¯è·¨è¯­è¨€çš„ RPC æ¡†æž¶ã€‚ Dubbo æ”¯æŒæœåŠ¡æ²»ç†ï¼Œè€Œ Thrift ä¸æ”¯æŒã€‚]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
        <tag>distributed</tag>
        <tag>interview</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>%2Fblog%2F2019%2F10%2F25%2Fbigdata%2FREADME%2F</url>
    <content type="text"><![CDATA[å¤§æ•°æ® ðŸ“ çŸ¥è¯†ç‚¹ MapReduce HDFS YARN HBase HBase å‘½ä»¤ HBase é…ç½® ðŸ“š å­¦ä¹ èµ„æº ä¹¦ Hadoop æƒå¨æŒ‡å— ðŸšª ä¼ é€é—¨ | å›žé¦–é  |]]></content>
      <tags>
        <tag>hide</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­˜å‚¨]]></title>
    <url>%2Fblog%2F2019%2F08%2F21%2Fdesign%2Fdistributed%2Fdistributed-storage%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼å­˜å‚¨ åˆ†åŒºè§„åˆ™ åˆ†å¸ƒå¼æ•°æ®åº“ é¦–å…ˆè¦è§£å†³æŠŠ æ•´ä¸ªæ•°æ®é›† æŒ‰ç…§ åˆ†åŒºè§„åˆ™ æ˜ å°„åˆ° å¤šä¸ªèŠ‚ç‚¹ çš„é—®é¢˜ï¼Œå³æŠŠ æ•°æ®é›† åˆ’åˆ†åˆ° å¤šä¸ªèŠ‚ç‚¹ ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ æ•´ä½“æ•°æ® çš„ä¸€ä¸ª å­é›†ã€‚ æ•°æ®åˆ†å¸ƒé€šå¸¸æœ‰ å“ˆå¸Œåˆ†åŒº å’Œ é¡ºåºåˆ†åŒº ä¸¤ç§æ–¹å¼ï¼Œå¯¹æ¯”å¦‚ä¸‹ï¼š åˆ†åŒºæ–¹å¼ ç‰¹ç‚¹ ç›¸å…³äº§å“ å“ˆå¸Œåˆ†åŒº ç¦»æ•£ç¨‹åº¦å¥½ï¼Œæ•°æ®åˆ†å¸ƒä¸Žä¸šåŠ¡æ— å…³ï¼Œæ— æ³•é¡ºåºè®¿é—® Redis Clusterï¼ŒCassandraï¼ŒDynamo é¡ºåºåˆ†åŒº ç¦»æ•£ç¨‹åº¦æ˜“å€¾æ–œï¼Œæ•°æ®åˆ†å¸ƒä¸Žä¸šåŠ¡ç›¸å…³ï¼Œå¯ä»¥é¡ºåºè®¿é—® BigTableï¼ŒHBaseï¼ŒHypertable ç”±äºŽ Redis Cluster é‡‡ç”¨ å“ˆå¸Œåˆ†åŒºè§„åˆ™ï¼Œè¿™é‡Œé‡ç‚¹è®¨è®º å“ˆå¸Œåˆ†åŒºã€‚å¸¸è§çš„ å“ˆå¸Œåˆ†åŒº è§„åˆ™æœ‰å‡ ç§ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»ï¼š èŠ‚ç‚¹å–ä½™åˆ†åŒº ä½¿ç”¨ç‰¹å®šçš„æ•°æ®ï¼Œå¦‚ Redis çš„ é”® æˆ– ç”¨æˆ· IDï¼Œå†æ ¹æ® èŠ‚ç‚¹æ•°é‡ N ä½¿ç”¨å…¬å¼ï¼šhashï¼ˆkeyï¼‰% N è®¡ç®—å‡º å“ˆå¸Œå€¼ï¼Œç”¨æ¥å†³å®šæ•°æ® æ˜ å°„ åˆ°å“ªä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ ä¼˜ç‚¹ è¿™ç§æ–¹å¼çš„çªå‡ºä¼˜ç‚¹æ˜¯ ç®€å•æ€§ï¼Œå¸¸ç”¨äºŽ æ•°æ®åº“ çš„ åˆ†åº“åˆ†è¡¨è§„åˆ™ã€‚ä¸€èˆ¬é‡‡ç”¨ é¢„åˆ†åŒº çš„æ–¹å¼ï¼Œæå‰æ ¹æ® æ•°æ®é‡ è§„åˆ’å¥½ åˆ†åŒºæ•°ï¼Œæ¯”å¦‚åˆ’åˆ†ä¸º 512 æˆ– 1024 å¼ è¡¨ï¼Œä¿è¯å¯æ”¯æ’‘æœªæ¥ä¸€æ®µæ—¶é—´çš„ æ•°æ®å®¹é‡ï¼Œå†æ ¹æ® è´Ÿè½½æƒ…å†µ å°† è¡¨ è¿ç§»åˆ°å…¶ä»– æ•°æ®åº“ ä¸­ã€‚æ‰©å®¹æ—¶é€šå¸¸é‡‡ç”¨ ç¿»å€æ‰©å®¹ï¼Œé¿å… æ•°æ®æ˜ å°„ å…¨éƒ¨è¢« æ‰“ä¹±ï¼Œå¯¼è‡´ å…¨é‡è¿ç§» çš„æƒ…å†µã€‚ ç¼ºç‚¹ å½“ èŠ‚ç‚¹æ•°é‡ å˜åŒ–æ—¶ï¼Œå¦‚ æ‰©å®¹ æˆ– æ”¶ç¼© èŠ‚ç‚¹ï¼Œæ•°æ®èŠ‚ç‚¹ æ˜ å°„å…³ç³» éœ€è¦é‡æ–°è®¡ç®—ï¼Œä¼šå¯¼è‡´æ•°æ®çš„ é‡æ–°è¿ç§»ã€‚ ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº ä¸€è‡´æ€§å“ˆå¸Œ å¯ä»¥å¾ˆå¥½çš„è§£å†³ ç¨³å®šæ€§é—®é¢˜ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„ å­˜å‚¨èŠ‚ç‚¹ æŽ’åˆ—åœ¨ é¦–å°¾ç›¸æŽ¥ çš„ Hash çŽ¯ä¸Šï¼Œæ¯ä¸ª key åœ¨è®¡ç®— Hash åŽä¼š é¡ºæ—¶é’ˆ æ‰¾åˆ° ä¸´æŽ¥ çš„ å­˜å‚¨èŠ‚ç‚¹ å­˜æ”¾ã€‚è€Œå½“æœ‰èŠ‚ç‚¹ åŠ å…¥ æˆ– é€€å‡º æ—¶ï¼Œä»…å½±å“è¯¥èŠ‚ç‚¹åœ¨ Hash çŽ¯ä¸Š é¡ºæ—¶é’ˆç›¸é‚» çš„ åŽç»­èŠ‚ç‚¹ã€‚ ä¼˜ç‚¹ åŠ å…¥ å’Œ åˆ é™¤ èŠ‚ç‚¹åªå½±å“ å“ˆå¸ŒçŽ¯ ä¸­ é¡ºæ—¶é’ˆæ–¹å‘ çš„ ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¯¹å…¶ä»–èŠ‚ç‚¹æ— å½±å“ã€‚ ç¼ºç‚¹ åŠ å‡èŠ‚ç‚¹ ä¼šé€ æˆ å“ˆå¸ŒçŽ¯ ä¸­éƒ¨åˆ†æ•°æ® æ— æ³•å‘½ä¸­ã€‚å½“ä½¿ç”¨ å°‘é‡èŠ‚ç‚¹ æ—¶ï¼ŒèŠ‚ç‚¹å˜åŒ– å°†å¤§èŒƒå›´å½±å“ å“ˆå¸ŒçŽ¯ ä¸­ æ•°æ®æ˜ å°„ï¼Œä¸é€‚åˆ å°‘é‡æ•°æ®èŠ‚ç‚¹ çš„åˆ†å¸ƒå¼æ–¹æ¡ˆã€‚æ™®é€š çš„ ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº åœ¨å¢žå‡èŠ‚ç‚¹æ—¶éœ€è¦ å¢žåŠ ä¸€å€ æˆ– å‡åŽ»ä¸€åŠ èŠ‚ç‚¹æ‰èƒ½ä¿è¯ æ•°æ® å’Œ è´Ÿè½½çš„å‡è¡¡ã€‚ æ³¨æ„ï¼šå› ä¸º ä¸€è‡´æ€§å“ˆå¸Œåˆ†åŒº çš„è¿™äº›ç¼ºç‚¹ï¼Œä¸€äº›åˆ†å¸ƒå¼ç³»ç»Ÿé‡‡ç”¨ è™šæ‹Ÿæ§½ å¯¹ ä¸€è‡´æ€§å“ˆå¸Œ è¿›è¡Œæ”¹è¿›ï¼Œæ¯”å¦‚ Dynamo ç³»ç»Ÿã€‚ è™šæ‹Ÿæ§½åˆ†åŒº è™šæ‹Ÿæ§½åˆ†åŒº å·§å¦™åœ°ä½¿ç”¨äº† å“ˆå¸Œç©ºé—´ï¼Œä½¿ç”¨ åˆ†æ•£åº¦è‰¯å¥½ çš„ å“ˆå¸Œå‡½æ•° æŠŠæ‰€æœ‰æ•°æ® æ˜ å°„ åˆ°ä¸€ä¸ª å›ºå®šèŒƒå›´ çš„ æ•´æ•°é›†åˆ ä¸­ï¼Œæ•´æ•°å®šä¹‰ä¸º æ§½ï¼ˆslotï¼‰ã€‚è¿™ä¸ªèŒƒå›´ä¸€èˆ¬ è¿œè¿œå¤§äºŽ èŠ‚ç‚¹æ•°ï¼Œæ¯”å¦‚ Redis Cluster æ§½èŒƒå›´æ˜¯ 0 ~ 16383ã€‚æ§½ æ˜¯é›†ç¾¤å†… æ•°æ®ç®¡ç† å’Œ è¿ç§» çš„ åŸºæœ¬å•ä½ã€‚é‡‡ç”¨ å¤§èŒƒå›´æ§½ çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ æ•°æ®æ‹†åˆ† å’Œ é›†ç¾¤æ‰©å±•ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¼šè´Ÿè´£ ä¸€å®šæ•°é‡çš„æ§½ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š å½“å‰é›†ç¾¤æœ‰ `3` ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¹³å‡å¤§çº¦è´Ÿè´£ `5460` ä¸ª **æ§½**ã€‚ç”±äºŽé‡‡ç”¨ **é«˜è´¨é‡** çš„ **å“ˆå¸Œç®—æ³•**ï¼Œæ¯ä¸ªæ§½æ‰€æ˜ å°„çš„æ•°æ®é€šå¸¸æ¯”è¾ƒ **å‡åŒ€**ï¼Œå°†æ•°æ®å¹³å‡åˆ’åˆ†åˆ° `3` ä¸ªèŠ‚ç‚¹è¿›è¡Œ **æ•°æ®åˆ†åŒº**ã€‚`Redis Cluster` å°±æ˜¯é‡‡ç”¨ **è™šæ‹Ÿæ§½åˆ†åŒº**ã€‚ é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†å“ˆå¸Œæ§½ï¼Œæ¯”å¦‚é›†ç¾¤ä¸­æœ‰ï¼“ä¸ªèŠ‚ç‚¹ï¼Œåˆ™ï¼š èŠ‚ç‚¹ï¼¡å­˜å‚¨çš„å“ˆå¸Œæ§½èŒƒå›´æ˜¯ï¼š0 â€“ 5460 èŠ‚ç‚¹ï¼¢å­˜å‚¨çš„å“ˆå¸Œæ§½èŒƒå›´æ˜¯ï¼š5461 â€“ 10922 èŠ‚ç‚¹ï¼£å­˜å‚¨çš„å“ˆå¸Œæ§½èŒƒå›´æ˜¯ï¼š10923 â€“ 16383 è¿™ç§ç»“æž„å¾ˆå®¹æ˜“ æ·»åŠ  æˆ–è€… åˆ é™¤ èŠ‚ç‚¹ã€‚å¦‚æžœ å¢žåŠ  ä¸€ä¸ªèŠ‚ç‚¹ 4ï¼Œå°±éœ€è¦ä»ŽèŠ‚ç‚¹ 1 ~ 3 èŽ·å¾—éƒ¨åˆ† æ§½ åˆ†é…åˆ°èŠ‚ç‚¹ 4 ä¸Šã€‚å¦‚æžœæƒ³ ç§»é™¤ èŠ‚ç‚¹ 1ï¼Œéœ€è¦å°†èŠ‚ç‚¹ 1 ä¸­çš„ æ§½ ç§»åˆ°èŠ‚ç‚¹ 2 ~ 3 ä¸Šï¼Œç„¶åŽå°† æ²¡æœ‰ä»»ä½•æ§½ çš„èŠ‚ç‚¹ 1 ä»Žé›†ç¾¤ä¸­ ç§»é™¤ å³å¯ã€‚ ç”±äºŽä»Žä¸€ä¸ªèŠ‚ç‚¹å°† å“ˆå¸Œæ§½ ç§»åŠ¨åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹å¹¶ä¸ä¼š åœæ­¢æœåŠ¡ï¼Œæ‰€ä»¥æ— è®º æ·»åŠ åˆ é™¤ æˆ–è€… æ”¹å˜ æŸä¸ªèŠ‚ç‚¹çš„ å“ˆå¸Œæ§½çš„æ•°é‡ éƒ½ä¸ä¼šé€ æˆ é›†ç¾¤ä¸å¯ç”¨ çš„çŠ¶æ€. å‚è€ƒèµ„æ–™ æ·±å…¥å‰–æž Redis ç³»åˆ—(ä¸‰) - Redis é›†ç¾¤æ¨¡å¼æ­å»ºä¸ŽåŽŸç†è¯¦è§£]]></content>
      <categories>
        <category>design</category>
        <category>distributed</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>distributed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“æ•™ç¨‹]]></title>
    <url>%2Fblog%2F2019%2F08%2F19%2Fdatabase%2F</url>
    <content type="text"><![CDATA[æ•°æ®åº“æ•™ç¨‹ ðŸ”¢ æ•°æ®åº“ç»éªŒæ€»ç»“ ðŸ” é¡¹ç›®åŒæ­¥ç»´æŠ¤ï¼šGithub | Gitee ðŸ“– ç”µå­ä¹¦é˜…è¯»ï¼šGithub Pages | Gitee Pages]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>database</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux æ•™ç¨‹]]></title>
    <url>%2Fblog%2F2019%2F08%2F19%2Flinux%2F</url>
    <content type="text"><![CDATA[Linux æ•™ç¨‹ ðŸ” é¡¹ç›®åŒæ­¥ç»´æŠ¤åœ¨ github | gitee ðŸ“– ç”µå­ä¹¦ | ç”µå­ä¹¦ï¼ˆå›½å†…ï¼‰]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‰ç«¯æ•™ç¨‹]]></title>
    <url>%2Fblog%2F2019%2F08%2F19%2Ffrontend%2F</url>
    <content type="text"><![CDATA[Frontend Tutorial â˜• frontend-tutorial æ˜¯å¯¹ Java æ ¸å¿ƒæŠ€æœ¯çš„ç»éªŒæ€»ç»“ã€‚ ðŸ” é¡¹ç›®åŒæ­¥ç»´æŠ¤ï¼šGithub | Gitee ðŸ“– ç”µå­ä¹¦é˜…è¯»ï¼šGithub Pages | Gitee Pages]]></content>
      <categories>
        <category>frontend</category>
      </categories>
      <tags>
        <tag>frontend</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java æ•™ç¨‹]]></title>
    <url>%2Fblog%2F2019%2F08%2F19%2Fjava%2F</url>
    <content type="text"><![CDATA[Java æ•™ç¨‹ â˜• Java Tutorial æ˜¯æœ¬äººåœ¨ Java æŠ€æœ¯é¢†åŸŸçš„åå¹´ç§¯ç´¯ã€‚ ðŸ” é¡¹ç›®åŒæ­¥ç»´æŠ¤ï¼šGithub | Gitee ðŸ“– ç”µå­ä¹¦é˜…è¯»ï¼šGithub Pages | Gitee Pages]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼ ID]]></title>
    <url>%2Fblog%2F2019%2F07%2F24%2Fdesign%2Fdistributed%2Fdistributed-id%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼ ID UUID UUID æ˜¯é€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ˆUniversally Unique Identifier)çš„ç¼©å†™ï¼Œå¼€æ”¾è½¯ä»¶åŸºé‡‘ä¼š(OSF)è§„èŒƒå®šä¹‰äº†åŒ…æ‹¬ç½‘å¡ MAC åœ°å€ã€æ—¶é—´æˆ³ã€åå­—ç©ºé—´ï¼ˆNamespaceï¼‰ã€éšæœºæˆ–ä¼ªéšæœºæ•°ã€æ—¶åºç­‰å…ƒç´ ã€‚åˆ©ç”¨è¿™äº›å…ƒç´ æ¥ç”Ÿæˆ UUIDã€‚ UUID æ˜¯ç”± 128 ä½äºŒè¿›åˆ¶ç»„æˆï¼Œä¸€èˆ¬è½¬æ¢æˆåå…­è¿›åˆ¶ï¼Œç„¶åŽç”¨ String è¡¨ç¤ºã€‚åœ¨ java ä¸­æœ‰ä¸ª UUID ç±»,åœ¨ä»–çš„æ³¨é‡Šä¸­æˆ‘ä»¬çœ‹è§è¿™é‡Œæœ‰ 4 ç§ä¸åŒçš„ UUID çš„ç”Ÿæˆç­–ç•¥: random - åŸºäºŽéšæœºæ•°ç”Ÿæˆ UUIDï¼Œç”±äºŽ Java ä¸­çš„éšæœºæ•°æ˜¯ä¼ªéšæœºæ•°ï¼Œå…¶é‡å¤çš„æ¦‚çŽ‡æ˜¯å¯ä»¥è¢«è®¡ç®—å‡ºæ¥çš„ã€‚è¿™ä¸ªä¸€èˆ¬æˆ‘ä»¬ç”¨ä¸‹é¢çš„ä»£ç èŽ·å–åŸºäºŽéšæœºæ•°çš„ UUID: String id = UUID.randomUUID().toString(); time-based - åŸºäºŽæ—¶é—´çš„ UUID,è¿™ä¸ªä¸€èˆ¬æ˜¯é€šè¿‡å½“å‰æ—¶é—´ï¼Œéšæœºæ•°ï¼Œå’Œæœ¬åœ° Mac åœ°å€æ¥è®¡ç®—å‡ºæ¥ï¼Œè‡ªå¸¦çš„ JDK åŒ…å¹¶æ²¡æœ‰è¿™ä¸ªç®—æ³•çš„æˆ‘ä»¬åœ¨ä¸€äº› UUIDUtil ä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ log4j.core.utilï¼Œä¼šé‡æ–°å®šä¹‰ UUID çš„é«˜ä½å’Œä½Žä½ã€‚ public static UUID getTimeBasedUuid() &#123; long time = System.currentTimeMillis() * 10000L + 122192928000000000L + (long)(COUNT.incrementAndGet() % 10000); long timeLow = (time &amp; 4294967295L) &lt;&lt; 32; long timeMid = (time &amp; 281470681743360L) &gt;&gt; 16; long timeHi = (time &amp; 1152640029630136320L) &gt;&gt; 48; long most = timeLow | timeMid | 4096L | timeHi; return new UUID(most, LEAST);&#125; DCE security - DCE å®‰å…¨çš„ UUIDã€‚ name-based - åŸºäºŽåå­—çš„ UUIDï¼Œé€šè¿‡è®¡ç®—åå­—å’Œåå­—ç©ºé—´çš„ MD5 æ¥è®¡ç®— UUIDã€‚ UUID çš„ä¼˜ç‚¹: é€šè¿‡æœ¬åœ°ç”Ÿæˆï¼Œæ²¡æœ‰ç»è¿‡ç½‘ç»œ I/Oï¼Œæ€§èƒ½è¾ƒå¿« UUID çš„ç¼ºç‚¹: é•¿åº¦è¿‡é•¿ - UUID å¤ªé•¿ï¼Œ16 å­—èŠ‚ 128 ä½ï¼Œé€šå¸¸ä»¥ 36 é•¿åº¦çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¾ˆå¤šåœºæ™¯ä¸é€‚ç”¨ã€‚ä¾‹å¦‚ï¼šMysql å®˜æ–¹æ˜Žç¡®å»ºè®®ä¸»é”®è¶ŠçŸ­è¶Šå¥½ï¼Œ36 ä¸ªå­—ç¬¦é•¿åº¦çš„ UUID ä¸ç¬¦åˆè¦æ±‚ã€‚ ä¿¡æ¯ä¸å®‰å…¨ - åŸºäºŽ MAC åœ°å€ç”Ÿæˆ UUID çš„ç®—æ³•å¯èƒ½ä¼šé€ æˆ MAC åœ°å€æ³„éœ²ï¼Œè¿™ä¸ªæ¼æ´žæ›¾è¢«ç”¨äºŽå¯»æ‰¾æ¢…ä¸½èŽŽç—…æ¯’çš„åˆ¶ä½œè€…ä½ç½®ã€‚ æ— åºæ€§ - ä¸èƒ½ç”Ÿæˆé€’å¢žæœ‰åºçš„æ•°å­—ã€‚è¿™å¯¹äºŽä¸€äº›ç‰¹å®šåœºæ™¯ä¸åˆ©ã€‚ä¾‹å¦‚ï¼šå¦‚æžœä½œä¸ºæ•°æ®åº“ä¸»é”®ï¼Œåœ¨ InnoDB å¼•æ“Žä¸‹ï¼ŒUUID çš„æ— åºæ€§å¯èƒ½ä¼šå¼•èµ·æ•°æ®ä½ç½®é¢‘ç¹å˜åŠ¨ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚ é€‚ç”¨åœºæ™¯ï¼šUUID çš„é€‚ç”¨åœºæ™¯å¯ä»¥ä¸ºä¸éœ€è¦æ‹…å¿ƒè¿‡å¤šçš„ç©ºé—´å ç”¨ï¼Œä»¥åŠä¸éœ€è¦ç”Ÿæˆæœ‰é€’å¢žè¶‹åŠ¿çš„æ•°å­—ã€‚åœ¨ Log4j é‡Œ UuidPatternConverter ä¸­åŠ å…¥äº† UUID æ¥æ ‡è¯†æ¯ä¸€æ¡æ—¥å¿—ã€‚ æ•°æ®åº“ä¸»é”®è‡ªå¢ž å¤§å®¶å¯¹äºŽå”¯ä¸€æ ‡è¯†æœ€å®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯ä¸»é”®è‡ªå¢žï¼Œè¿™ä¸ªä¹Ÿæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸ªè®¢å•æœåŠ¡ï¼Œé‚£ä¹ˆæŠŠè®¢å• id è®¾ç½®ä¸ºä¸»é”®è‡ªå¢žå³å¯ã€‚ ä¼˜ç‚¹: ç®€å•æ–¹ä¾¿ï¼Œæœ‰åºé€’å¢žï¼Œæ–¹ä¾¿æŽ’åºå’Œåˆ†é¡µ ç¼ºç‚¹: åˆ†åº“åˆ†è¡¨ä¼šå¸¦æ¥é—®é¢˜ï¼Œéœ€è¦è¿›è¡Œæ”¹é€ ã€‚ å¹¶å‘æ€§èƒ½ä¸é«˜ï¼Œå—é™äºŽæ•°æ®åº“çš„æ€§èƒ½ã€‚ ç®€å•é€’å¢žå®¹æ˜“è¢«å…¶ä»–äººçŒœæµ‹åˆ©ç”¨ï¼Œæ¯”å¦‚ä½ æœ‰ä¸€ä¸ªç”¨æˆ·æœåŠ¡ç”¨çš„é€’å¢žï¼Œé‚£ä¹ˆå…¶ä»–äººå¯ä»¥æ ¹æ®åˆ†æžæ³¨å†Œçš„ç”¨æˆ· ID æ¥å¾—åˆ°å½“å¤©ä½ çš„æœåŠ¡æœ‰å¤šå°‘äººæ³¨å†Œï¼Œä»Žè€Œå°±èƒ½çŒœæµ‹å‡ºä½ è¿™ä¸ªæœåŠ¡å½“å‰çš„ä¸€ä¸ªå¤§æ¦‚çŠ¶å†µã€‚ æ•°æ®åº“å®•æœºæœåŠ¡ä¸å¯ç”¨ã€‚ é€‚ç”¨åœºæ™¯: æ ¹æ®ä¸Šé¢å¯ä»¥æ€»ç»“å‡ºæ¥ï¼Œå½“æ•°æ®é‡ä¸å¤šï¼Œå¹¶å‘æ€§èƒ½ä¸é«˜çš„æ—¶å€™è¿™ä¸ªå¾ˆé€‚åˆï¼Œæ¯”å¦‚ä¸€äº› to B çš„ä¸šåŠ¡ï¼Œå•†å®¶æ³¨å†Œè¿™äº›ï¼Œå•†å®¶æ³¨å†Œå’Œç”¨æˆ·æ³¨å†Œä¸æ˜¯ä¸€ä¸ªæ•°é‡çº§çš„ï¼Œæ‰€ä»¥å¯ä»¥æ•°æ®åº“ä¸»é”®é€’å¢žã€‚å¦‚æžœå¯¹é¡ºåºé€’å¢žå¼ºä¾èµ–ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ä½¿ç”¨æ•°æ®åº“ä¸»é”®è‡ªå¢žã€‚ Redis ç†Ÿæ‚‰ Redis çš„åŒå­¦ï¼Œåº”è¯¥çŸ¥é“åœ¨ Redis ä¸­æœ‰ä¸¤ä¸ªå‘½ä»¤ Incrï¼ŒIncrBy,å› ä¸º Redis æ˜¯å•çº¿ç¨‹çš„æ‰€ä»¥èƒ½ä¿è¯åŽŸå­æ€§ã€‚ ä¼˜ç‚¹ï¼š æ€§èƒ½æ¯”æ•°æ®åº“å¥½ï¼Œèƒ½æ»¡è¶³æœ‰åºé€’å¢žã€‚ ç¼ºç‚¹ï¼š ç”±äºŽ redis æ˜¯å†…å­˜çš„ KV æ•°æ®åº“ï¼Œå³ä½¿æœ‰ AOF å’Œ RDBï¼Œä½†æ˜¯ä¾ç„¶ä¼šå­˜åœ¨æ•°æ®ä¸¢å¤±ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆ ID é‡å¤ã€‚ ä¾èµ–äºŽ redisï¼Œredis è¦æ˜¯ä¸ç¨³å®šï¼Œä¼šå½±å“ ID ç”Ÿæˆã€‚ é€‚ç”¨ï¼šç”±äºŽå…¶æ€§èƒ½æ¯”æ•°æ®åº“å¥½ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šå‡ºçŽ° ID é‡å¤å’Œä¸ç¨³å®šï¼Œè¿™ä¸€å—å¦‚æžœå¯ä»¥æŽ¥å—é‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ã€‚ä¹Ÿé€‚ç”¨äºŽåˆ°äº†æŸä¸ªæ—¶é—´ï¼Œæ¯”å¦‚æ¯å¤©éƒ½åˆ·æ–° IDï¼Œé‚£ä¹ˆè¿™ä¸ª ID å°±éœ€è¦é‡ç½®ï¼Œé€šè¿‡(Incr Today)ï¼Œæ¯å¤©éƒ½ä¼šä»Ž 0 å¼€å§‹åŠ ã€‚ Zookeeper åˆ©ç”¨ ZK çš„ Znode æ•°æ®ç‰ˆæœ¬å¦‚ä¸‹é¢çš„ä»£ç ï¼Œæ¯æ¬¡éƒ½ä¸èŽ·å–æœŸæœ›ç‰ˆæœ¬å·ä¹Ÿå°±æ˜¯æ¯æ¬¡éƒ½ä¼šæˆåŠŸï¼Œé‚£ä¹ˆæ¯æ¬¡éƒ½ä¼šè¿”å›žæœ€æ–°çš„ç‰ˆæœ¬å·: Zookeeper è¿™ä¸ªæ–¹æ¡ˆç”¨å¾—è¾ƒå°‘ï¼Œä¸¥é‡ä¾èµ– Zookeeper é›†ç¾¤ï¼Œå¹¶ä¸”æ€§èƒ½ä¸æ˜¯å¾ˆé«˜ï¼Œæ‰€ä»¥ä¸äºˆæŽ¨èã€‚ æ•°æ®åº“åˆ†æ®µ+æœåŠ¡ç¼“å­˜ ID è¿™ä¸ªæ–¹æ³•åœ¨ç¾Žå›¢çš„ Leaf ä¸­æœ‰ä»‹ç»ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒç¾Žå›¢æŠ€æœ¯å›¢é˜Ÿçš„å‘å¸ƒçš„æŠ€æœ¯æ–‡ç« :Leafâ€”â€”ç¾Žå›¢ç‚¹è¯„åˆ†å¸ƒå¼ ID ç”Ÿæˆç³»ç»Ÿ,è¿™ä¸ªæ–¹æ¡ˆæ˜¯å°†æ•°æ®åº“ä¸»é”®è‡ªå¢žè¿›è¡Œä¼˜åŒ–ã€‚ biz_tag ä»£è¡¨æ¯ä¸ªä¸åŒçš„ä¸šåŠ¡ï¼Œmax_id ä»£è¡¨æ¯ä¸ªä¸šåŠ¡è®¾ç½®çš„å¤§å°ï¼Œstep ä»£è¡¨æ¯ä¸ª proxyServer ç¼“å­˜çš„æ­¥é•¿ã€‚ ä¹‹å‰æˆ‘ä»¬çš„æ¯ä¸ªæœåŠ¡éƒ½è®¿é—®çš„æ˜¯æ•°æ®åº“ï¼ŒçŽ°åœ¨ä¸éœ€è¦ï¼Œæ¯ä¸ªæœåŠ¡ç›´æŽ¥å’Œæˆ‘ä»¬çš„ ProxyServer åšäº¤äº’ï¼Œå‡å°‘äº†å¯¹æ•°æ®åº“çš„ä¾èµ–ã€‚æˆ‘ä»¬çš„æ¯ä¸ª ProxyServer å›žåŽ»æ•°æ®åº“ä¸­æ‹¿å‡ºæ­¥é•¿çš„é•¿åº¦ï¼Œæ¯”å¦‚ server1 æ‹¿åˆ°äº† 1-1000,server2 æ‹¿åˆ°æ¥ 1001-2000ã€‚å¦‚æžœç”¨å®Œä¼šå†æ¬¡åŽ»æ•°æ®åº“ä¸­æ‹¿ã€‚ ä¼˜ç‚¹: æ¯”ä¸»é”®é€’å¢žæ€§èƒ½é«˜ï¼Œèƒ½ä¿è¯è¶‹åŠ¿é€’å¢žã€‚ å¦‚æžœ DB å®•æœºï¼ŒproxServer ç”±äºŽæœ‰ç¼“å­˜ä¾ç„¶å¯ä»¥åšæŒä¸€æ®µæ—¶é—´ã€‚ ç¼ºç‚¹: å’Œä¸»é”®é€’å¢žä¸€æ ·ï¼Œå®¹æ˜“è¢«äººçŒœæµ‹ã€‚ DB å®•æœºï¼Œè™½ç„¶èƒ½æ”¯æ’‘ä¸€æ®µæ—¶é—´ä½†æ˜¯ä»ç„¶ä¼šé€ æˆç³»ç»Ÿä¸å¯ç”¨ã€‚ é€‚ç”¨åœºæ™¯:éœ€è¦è¶‹åŠ¿é€’å¢žï¼Œå¹¶ä¸” ID å¤§å°å¯æŽ§åˆ¶çš„ï¼Œå¯ä»¥ä½¿ç”¨è¿™å¥—æ–¹æ¡ˆã€‚ å½“ç„¶è¿™ä¸ªæ–¹æ¡ˆä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›æ‰‹æ®µé¿å…è¢«äººçŒœæµ‹ï¼ŒæŠŠ ID å˜æˆæ˜¯æ— åºçš„ï¼Œæ¯”å¦‚æŠŠæˆ‘ä»¬ç”Ÿæˆçš„æ•°æ®æ˜¯ä¸€ä¸ªé€’å¢žçš„ long åž‹ï¼ŒæŠŠè¿™ä¸ª Long åˆ†æˆå‡ ä¸ªéƒ¨åˆ†ï¼Œæ¯”å¦‚å¯ä»¥åˆ†æˆå‡ ç»„ä¸‰ä½æ•°ï¼Œå‡ ç»„å››ä½æ•°ï¼Œç„¶åŽåœ¨å»ºç«‹ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œå°†æˆ‘ä»¬çš„æ•°æ®å˜æˆæ— åºã€‚ é›ªèŠ±ç®—æ³•-Snowflake ç®—æ³•åŽŸç†ï¼š Snowflake æ˜¯ Twitter æå‡ºæ¥çš„ä¸€ä¸ªç®—æ³•ï¼Œå…¶ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ª 64bit çš„æ•´æ•°: 1bit:ä¸€èˆ¬æ˜¯ç¬¦å·ä½ï¼Œä¸åšå¤„ç† 41bit:ç”¨æ¥è®°å½•æ—¶é—´æˆ³ï¼Œè¿™é‡Œå¯ä»¥è®°å½• 69 å¹´ï¼Œå¦‚æžœè®¾ç½®å¥½èµ·å§‹æ—¶é—´æ¯”å¦‚ä»Šå¹´æ˜¯ 2018 å¹´ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨åˆ° 2089 å¹´ï¼Œåˆ°æ—¶å€™æ€Žä¹ˆåŠžï¼Ÿè¦æ˜¯è¿™ä¸ªç³»ç»Ÿèƒ½ç”¨ 69 å¹´ï¼Œæˆ‘ç›¸ä¿¡è¿™ä¸ªç³»ç»Ÿæ—©éƒ½é‡æž„äº†å¥½å¤šæ¬¡äº†ã€‚ 10bit:10bit ç”¨æ¥è®°å½•æœºå™¨ IDï¼Œæ€»å…±å¯ä»¥è®°å½• 1024 å°æœºå™¨ï¼Œä¸€èˆ¬ç”¨å‰ 5 ä½ä»£è¡¨æ•°æ®ä¸­å¿ƒï¼ŒåŽé¢ 5 ä½æ˜¯æŸä¸ªæ•°æ®ä¸­å¿ƒçš„æœºå™¨ ID 12bit:å¾ªçŽ¯ä½ï¼Œç”¨æ¥å¯¹åŒä¸€ä¸ªæ¯«ç§’ä¹‹å†…äº§ç”Ÿä¸åŒçš„ IDï¼Œ12 ä½å¯ä»¥æœ€å¤šè®°å½• 4095 ä¸ªï¼Œä¹Ÿå°±æ˜¯åœ¨åŒä¸€ä¸ªæœºå™¨åŒä¸€æ¯«ç§’æœ€å¤šè®°å½• 4095 ä¸ªï¼Œå¤šä½™çš„éœ€è¦è¿›è¡Œç­‰å¾…ä¸‹æ¯«ç§’ã€‚ ä¸Šé¢åªæ˜¯ä¸€ä¸ªå°† 64bit åˆ’åˆ†çš„æ ‡å‡†ï¼Œå½“ç„¶ä¹Ÿä¸ä¸€å®šè¿™ä¹ˆåšï¼Œå¯ä»¥æ ¹æ®ä¸åŒä¸šåŠ¡çš„å…·ä½“åœºæ™¯æ¥åˆ’åˆ†ï¼Œæ¯”å¦‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸šåŠ¡åœºæ™¯ï¼š æœåŠ¡ç›®å‰ QPS10 ä¸‡ï¼Œé¢„è®¡å‡ å¹´ä¹‹å†…ä¼šå‘å±•åˆ°ç™¾ä¸‡ã€‚ å½“å‰æœºå™¨ä¸‰åœ°éƒ¨ç½²ï¼Œä¸Šæµ·ï¼ŒåŒ—äº¬ï¼Œæ·±åœ³éƒ½æœ‰ã€‚ å½“å‰æœºå™¨ 10 å°å·¦å³ï¼Œé¢„è®¡æœªæ¥ä¼šå¢žåŠ è‡³ç™¾å°ã€‚ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ ¹æ®ä¸Šé¢çš„åœºæ™¯å¯ä»¥å†æ¬¡åˆç†çš„åˆ’åˆ† 62bit,QPS å‡ å¹´ä¹‹å†…ä¼šå‘å±•åˆ°ç™¾ä¸‡ï¼Œé‚£ä¹ˆæ¯æ¯«ç§’å°±æ˜¯åƒçº§çš„è¯·æ±‚ï¼Œç›®å‰ 10 å°æœºå™¨é‚£ä¹ˆæ¯å°æœºå™¨æ‰¿æ‹…ç™¾çº§çš„è¯·æ±‚ï¼Œä¸ºäº†ä¿è¯æ‰©å±•ï¼ŒåŽé¢çš„å¾ªçŽ¯ä½å¯ä»¥é™åˆ¶åˆ° 1024ï¼Œä¹Ÿå°±æ˜¯ 2^10ï¼Œé‚£ä¹ˆå¾ªçŽ¯ä½ 10 ä½å°±è¶³å¤Ÿäº†ã€‚ æœºå™¨ä¸‰åœ°éƒ¨ç½²æˆ‘ä»¬å¯ä»¥ç”¨ 3bit æ€»å…± 8 æ¥è¡¨ç¤ºæœºæˆ¿ä½ç½®ï¼Œå½“å‰çš„æœºå™¨ 10 å°ï¼Œä¸ºäº†ä¿è¯æ‰©å±•åˆ°ç™¾å°é‚£ä¹ˆå¯ä»¥ç”¨ 7bit 128 æ¥è¡¨ç¤ºï¼Œæ—¶é—´ä½ä¾ç„¶æ˜¯ 41bit,é‚£ä¹ˆè¿˜å‰©ä¸‹ 64-10-3-7-41-1 = 2bit,è¿˜å‰©ä¸‹ 2bit å¯ä»¥ç”¨æ¥è¿›è¡Œæ‰©å±•ã€‚ é€‚ç”¨åœºæ™¯:å½“æˆ‘ä»¬éœ€è¦æ— åºä¸èƒ½è¢«çŒœæµ‹çš„ IDï¼Œå¹¶ä¸”éœ€è¦ä¸€å®šé«˜æ€§èƒ½ï¼Œä¸”éœ€è¦ long åž‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬é›ªèŠ±ç®—æ³•ã€‚æ¯”å¦‚å¸¸è§çš„è®¢å• IDï¼Œç”¨é›ªèŠ±ç®—æ³•åˆ«äººå°±æ— æ³•çŒœæµ‹ä½ æ¯å¤©çš„è®¢å•é‡æ˜¯å¤šå°‘ã€‚ ä¼˜ç‚¹ï¼š æ¯«ç§’æ•°åœ¨é«˜ä½ï¼Œè‡ªå¢žåºåˆ—åœ¨ä½Žä½ï¼Œæ•´ä¸ª ID éƒ½æ˜¯è¶‹åŠ¿é€’å¢žçš„ã€‚ ä¸ä¾èµ–æ•°æ®åº“ç­‰ç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Œä»¥æœåŠ¡çš„æ–¹å¼éƒ¨ç½²ï¼Œç¨³å®šæ€§æ›´é«˜ï¼Œç”Ÿæˆ ID çš„æ€§èƒ½ä¹Ÿæ˜¯éžå¸¸é«˜çš„ã€‚ å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹æ€§åˆ†é… bit ä½ï¼Œéžå¸¸çµæ´»ã€‚ ç¼ºç‚¹ï¼š å¼ºä¾èµ–æœºå™¨æ—¶é’Ÿï¼Œå¦‚æžœæœºå™¨ä¸Šæ—¶é’Ÿå›žæ‹¨ï¼Œä¼šå¯¼è‡´å‘å·é‡å¤æˆ–è€…æœåŠ¡ä¼šå¤„äºŽä¸å¯ç”¨çŠ¶æ€ã€‚ ä¸€ä¸ªç®€å•çš„ Snowflake public static class DistributedId &#123; private long workerId; // è¿™ä¸ªå°±æ˜¯ä»£è¡¨äº†æœºå™¨id private long datacenterId; // è¿™ä¸ªå°±æ˜¯ä»£è¡¨äº†æœºæˆ¿id private long sequence; // è¿™ä¸ªå°±æ˜¯ä»£è¡¨äº†ä¸€æ¯«ç§’å†…ç”Ÿæˆçš„å¤šä¸ªidçš„æœ€æ–°åºå· public DistributedId(long workerId, long datacenterId, long sequence) &#123; // sanity check for workerId // è¿™å„¿å°±ä¸æ£€æŸ¥äº†ï¼Œè¦æ±‚å°±æ˜¯ä½ ä¼ é€’è¿›æ¥çš„æœºæˆ¿idå’Œæœºå™¨idä¸èƒ½è¶…è¿‡32ï¼Œä¸èƒ½å°äºŽ0 if (workerId &gt; maxWorkerId || workerId &lt; 0) &#123; throw new IllegalArgumentException( String.format("worker Id can't be greater than %d or less than 0", maxWorkerId)); &#125; if (datacenterId &gt; maxDatacenterId || datacenterId &lt; 0) &#123; throw new IllegalArgumentException( String.format("datacenter Id can't be greater than %d or less than 0", maxDatacenterId)); &#125; this.workerId = workerId; this.datacenterId = datacenterId; this.sequence = sequence; &#125; private long twepoch = 1288834974657L; private long workerIdBits = 5L; private long datacenterIdBits = 5L; // è¿™ä¸ªæ˜¯äºŒè¿›åˆ¶è¿ç®—ï¼Œå°±æ˜¯5 bitæœ€å¤šåªèƒ½æœ‰31ä¸ªæ•°å­—ï¼Œä¹Ÿå°±æ˜¯è¯´æœºå™¨idæœ€å¤šåªèƒ½æ˜¯32ä»¥å†… private long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits); // è¿™ä¸ªæ˜¯ä¸€ä¸ªæ„æ€ï¼Œå°±æ˜¯5 bitæœ€å¤šåªèƒ½æœ‰31ä¸ªæ•°å­—ï¼Œæœºæˆ¿idæœ€å¤šåªèƒ½æ˜¯32ä»¥å†… private long maxDatacenterId = -1L ^ (-1L &lt;&lt; datacenterIdBits); private long sequenceBits = 12L; private long workerIdShift = sequenceBits; private long datacenterIdShift = sequenceBits + workerIdBits; private long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits; private long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits); private long lastTimestamp = -1L; public long getWorkerId() &#123; return workerId; &#125; public long getDatacenterId() &#123; return datacenterId; &#125; public long getTimestamp() &#123; return System.currentTimeMillis(); &#125; // è¿™ä¸ªæ˜¯æ ¸å¿ƒæ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨nextId()æ–¹æ³•ï¼Œè®©å½“å‰è¿™å°æœºå™¨ä¸Šçš„snowflakeç®—æ³•ç¨‹åºç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„id public synchronized long nextId() &#123; // è¿™å„¿å°±æ˜¯èŽ·å–å½“å‰æ—¶é—´æˆ³ï¼Œå•ä½æ˜¯æ¯«ç§’ long timestamp = timeGen(); if (timestamp &lt; lastTimestamp) &#123; System.err.printf("clock is moving backwards. Rejecting requests until %d.", lastTimestamp); throw new RuntimeException( String.format("Clock moved backwards. Refusing to generate id for %d milliseconds", lastTimestamp - timestamp)); &#125; // ä¸‹é¢æ˜¯è¯´å‡è®¾åœ¨åŒä¸€ä¸ªæ¯«ç§’å†…ï¼Œåˆå‘é€äº†ä¸€ä¸ªè¯·æ±‚ç”Ÿæˆä¸€ä¸ªid // è¿™ä¸ªæ—¶å€™å°±å¾—æŠŠseqenceåºå·ç»™é€’å¢ž1ï¼Œæœ€å¤šå°±æ˜¯4096 if (lastTimestamp == timestamp) &#123; // è¿™ä¸ªæ„æ€æ˜¯è¯´ä¸€ä¸ªæ¯«ç§’å†…æœ€å¤šåªèƒ½æœ‰4096ä¸ªæ•°å­—ï¼Œæ— è®ºä½ ä¼ é€’å¤šå°‘è¿›æ¥ï¼Œ //è¿™ä¸ªä½è¿ç®—ä¿è¯å§‹ç»ˆå°±æ˜¯åœ¨4096è¿™ä¸ªèŒƒå›´å†…ï¼Œé¿å…ä½ è‡ªå·±ä¼ é€’ä¸ªsequenceè¶…è¿‡äº†4096è¿™ä¸ªèŒƒå›´ sequence = (sequence + 1) &amp; sequenceMask; if (sequence == 0) &#123; timestamp = tilNextMillis(lastTimestamp); &#125; &#125; else &#123; sequence = 0; &#125; // è¿™å„¿è®°å½•ä¸€ä¸‹æœ€è¿‘ä¸€æ¬¡ç”Ÿæˆidçš„æ—¶é—´æˆ³ï¼Œå•ä½æ˜¯æ¯«ç§’ lastTimestamp = timestamp; // è¿™å„¿å°±æ˜¯æœ€æ ¸å¿ƒçš„äºŒè¿›åˆ¶ä½è¿ç®—æ“ä½œï¼Œç”Ÿæˆä¸€ä¸ª64bitçš„id // å…ˆå°†å½“å‰æ—¶é—´æˆ³å·¦ç§»ï¼Œæ”¾åˆ°41 bité‚£å„¿ï¼›å°†æœºæˆ¿idå·¦ç§»æ”¾åˆ°5 bité‚£å„¿ï¼›å°†æœºå™¨idå·¦ç§»æ”¾åˆ°5 bité‚£å„¿ï¼›å°†åºå·æ”¾æœ€åŽ12 bit // æœ€åŽæ‹¼æŽ¥èµ·æ¥æˆä¸€ä¸ª64 bitçš„äºŒè¿›åˆ¶æ•°å­—ï¼Œè½¬æ¢æˆ10è¿›åˆ¶å°±æ˜¯ä¸ªlongåž‹ return ((timestamp - twepoch) &lt;&lt; timestampLeftShift) | (datacenterId &lt;&lt; datacenterIdShift) | (workerId &lt;&lt; workerIdShift) | sequence; &#125; private long tilNextMillis(long lastTimestamp) &#123; long timestamp = timeGen(); while (timestamp &lt;= lastTimestamp) &#123; timestamp = timeGen(); &#125; return timestamp; &#125; private long timeGen() &#123; return System.currentTimeMillis(); &#125;&#125; ä¸Šé¢å®šä¹‰äº†é›ªèŠ±ç®—æ³•çš„å®žçŽ°ï¼Œåœ¨ nextId ä¸­æ˜¯æˆ‘ä»¬ç”Ÿæˆé›ªèŠ±ç®—æ³•çš„å…³é”®ã€‚ é˜²æ­¢æ—¶é’Ÿå›žæ‹¨ å› ä¸ºæœºå™¨çš„åŽŸå› ä¼šå‘ç”Ÿæ—¶é—´å›žæ‹¨ï¼Œæˆ‘ä»¬çš„é›ªèŠ±ç®—æ³•æ˜¯å¼ºä¾èµ–æˆ‘ä»¬çš„æ—¶é—´çš„ï¼Œå¦‚æžœæ—¶é—´å‘ç”Ÿå›žæ‹¨ï¼Œæœ‰å¯èƒ½ä¼šç”Ÿæˆé‡å¤çš„ IDï¼Œåœ¨æˆ‘ä»¬ä¸Šé¢çš„ nextId ä¸­æˆ‘ä»¬ç”¨å½“å‰æ—¶é—´å’Œä¸Šä¸€æ¬¡çš„æ—¶é—´è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æžœå½“å‰æ—¶é—´å°äºŽä¸Šä¸€æ¬¡çš„æ—¶é—´é‚£ä¹ˆè‚¯å®šæ˜¯å‘ç”Ÿäº†å›žæ‹¨ï¼Œæ™®é€šçš„ç®—æ³•ä¼šç›´æŽ¥æŠ›å‡ºå¼‚å¸¸,è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œä¼˜åŒ–,ä¸€èˆ¬åˆ†ä¸ºä¸¤ä¸ªæƒ…å†µ: å¦‚æžœæ—¶é—´å›žæ‹¨æ—¶é—´è¾ƒçŸ­ï¼Œæ¯”å¦‚é…ç½® 5ms ä»¥å†…ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æŽ¥ç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œè®©æœºå™¨çš„æ—¶é—´è¿½ä¸Šæ¥ã€‚ å¦‚æžœæ—¶é—´çš„å›žæ‹¨æ—¶é—´è¾ƒé•¿ï¼Œæˆ‘ä»¬ä¸èƒ½æŽ¥å—è¿™ä¹ˆé•¿çš„é˜»å¡žç­‰å¾…ï¼Œé‚£ä¹ˆåˆæœ‰ä¸¤ä¸ªç­–ç•¥: ç›´æŽ¥æ‹’ç»ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰“æ—¥å¿—ï¼Œé€šçŸ¥ RD æ—¶é’Ÿå›žæ»šã€‚ åˆ©ç”¨æ‰©å±•ä½ï¼Œä¸Šé¢æˆ‘ä»¬è®¨è®ºè¿‡ä¸åŒä¸šåŠ¡åœºæ™¯ä½æ•°å¯èƒ½ç”¨ä¸åˆ°é‚£ä¹ˆå¤šï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠæ‰©å±•ä½æ•°åˆ©ç”¨èµ·æ¥äº†ï¼Œæ¯”å¦‚å½“è¿™ä¸ªæ—¶é—´å›žæ‹¨æ¯”è¾ƒé•¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸éœ€è¦ç­‰å¾…ï¼Œç›´æŽ¥åœ¨æ‰©å±•ä½åŠ  1ã€‚2 ä½çš„æ‰©å±•ä½å…è®¸æˆ‘ä»¬æœ‰ 3 æ¬¡å¤§çš„æ—¶é’Ÿå›žæ‹¨ï¼Œä¸€èˆ¬æ¥è¯´å°±å¤Ÿäº†ï¼Œå¦‚æžœå…¶è¶…è¿‡ä¸‰æ¬¡æˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰“æ—¥å¿—ã€‚ é€šè¿‡ä¸Šé¢çš„å‡ ç§ç­–ç•¥å¯ä»¥æ¯”è¾ƒçš„é˜²æŠ¤æˆ‘ä»¬çš„æ—¶é’Ÿå›žæ‹¨ï¼Œé˜²æ­¢å‡ºçŽ°å›žæ‹¨ä¹‹åŽå¤§é‡çš„å¼‚å¸¸å‡ºçŽ°ã€‚ä¸‹é¢æ˜¯ä¿®æ”¹ä¹‹åŽçš„ä»£ç ï¼Œè¿™é‡Œä¿®æ”¹äº†æ—¶é’Ÿå›žæ‹¨çš„é€»è¾‘: å‚è€ƒèµ„æ–™ ç™¾åº¦åˆ†å¸ƒå¼ ID å¦‚æžœå†æœ‰äººé—®ä½ åˆ†å¸ƒå¼ IDï¼Œè¿™ç¯‡æ–‡ç« ä¸¢ç»™ä»– ç†è§£åˆ†å¸ƒå¼ id ç”Ÿæˆç®—æ³• SnowFlake Leafâ€”â€”ç¾Žå›¢ç‚¹è¯„åˆ†å¸ƒå¼ ID ç”Ÿæˆç³»ç»Ÿ UUID è§„èŒƒ]]></content>
      <categories>
        <category>design</category>
        <category>distributed</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>distributed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼ç¼“å­˜]]></title>
    <url>%2Fblog%2F2019%2F06%2F27%2Fdesign%2Fdistributed%2Fdistributed-cache%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼ç¼“å­˜ ç®€ä»‹ ä½¿ç”¨ç¼“å­˜çš„å¥½å¤„ï¼š æå‡æ•°æ®è¯»å–é€Ÿåº¦ æå‡ç³»ç»Ÿæ‰©å±•èƒ½åŠ›ï¼Œé€šè¿‡æ‰©å±•ç¼“å­˜ï¼Œæå‡ç³»ç»Ÿæ‰¿è½½èƒ½åŠ› é™ä½Žå­˜å‚¨æˆæœ¬ï¼ŒCache+DB çš„æ–¹å¼å¯ä»¥æ‰¿æ‹…åŽŸæœ‰éœ€è¦å¤šå° DB æ‰èƒ½æ‰¿æ‹…çš„è¯·æ±‚é‡ï¼ŒèŠ‚çœæœºå™¨æˆæœ¬ æ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œé€šå¸¸ç¼“å­˜æœ‰ä»¥ä¸‹å‡ ç§ä½¿ç”¨æ–¹å¼ æ‡’æ±‰å¼(è¯»æ—¶è§¦å‘)ï¼šå†™å…¥ DB åŽ, ç„¶åŽæŠŠç›¸å…³çš„æ•°æ®ä¹Ÿå†™å…¥ Cache é¥¥é¥¿å¼(å†™æ—¶è§¦å‘)ï¼šå…ˆæŸ¥è¯¢ DB é‡Œçš„æ•°æ®, ç„¶åŽæŠŠç›¸å…³çš„æ•°æ®å†™å…¥ Cache å®šæœŸåˆ·æ–°ï¼šé€‚åˆå‘¨æœŸæ€§çš„è·‘æ•°æ®çš„ä»»åŠ¡ï¼Œæˆ–è€…åˆ—è¡¨åž‹çš„æ•°æ®ï¼Œè€Œä¸”ä¸è¦æ±‚ç»å¯¹å®žæ—¶æ€§ ç¼“å­˜åˆ†ç±»ï¼š åº”ç”¨å†…ç¼“å­˜ï¼šå¦‚ï¼šEHCache åˆ†å¸ƒå¼ç¼“å­˜ï¼šå¦‚ï¼šMemachedã€Redis é—®é¢˜ ç¼“å­˜é›ªå´© ç¼“å­˜é›ªå´©æ˜¯æŒ‡ï¼šåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œç”±äºŽåŽŸæœ‰ç¼“å­˜å¤±æ•ˆï¼Œæ–°ç¼“å­˜æœªåˆ°æœŸé—´(ä¾‹å¦‚ï¼šæˆ‘ä»¬è®¾ç½®ç¼“å­˜æ—¶é‡‡ç”¨äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œåœ¨åŒä¸€æ—¶åˆ»å‡ºçŽ°å¤§é¢ç§¯çš„ç¼“å­˜è¿‡æœŸ)ï¼Œæ‰€æœ‰åŽŸæœ¬åº”è¯¥è®¿é—®ç¼“å­˜çš„è¯·æ±‚éƒ½åŽ»æŸ¥è¯¢æ•°æ®åº“äº†ï¼Œè€Œå¯¹æ•°æ®åº“ CPU å’Œå†…å­˜é€ æˆå·¨å¤§åŽ‹åŠ›ï¼Œä¸¥é‡çš„ä¼šé€ æˆæ•°æ®åº“å®•æœºã€‚ä»Žè€Œå½¢æˆä¸€ç³»åˆ—è¿žé”ååº”ï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚ è§£å†³æ–¹æ¡ˆï¼š ç”¨åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼ä¿è¯æ¥ä¿è¯ä¸ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹å¯¹æ•°æ®åº“ä¸€æ¬¡æ€§è¿›è¡Œè¯»å†™ï¼Œä»Žè€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ°åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚ è¿˜æœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ¡ˆï¼Œå°±æ˜¯å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€ï¼Œä¸è¦æ‰€æœ‰ç¼“å­˜æ—¶é—´é•¿åº¦éƒ½è®¾ç½®æˆ 5 åˆ†é’Ÿæˆ–è€… 10 åˆ†é’Ÿï¼›æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŽŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢žåŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚ 1-5 åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤çŽ‡å°±ä¼šé™ä½Žï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚ ç¼“å­˜å¤±æ•ˆæ—¶äº§ç”Ÿçš„é›ªå´©æ•ˆåº”ï¼Œå°†æ‰€æœ‰è¯·æ±‚å…¨éƒ¨æ”¾åœ¨æ•°æ®åº“ä¸Šï¼Œè¿™æ ·å¾ˆå®¹æ˜“å°±è¾¾åˆ°æ•°æ®åº“çš„ç“¶é¢ˆï¼Œå¯¼è‡´æœåŠ¡æ— æ³•æ­£å¸¸æä¾›ã€‚å°½é‡é¿å…è¿™ç§åœºæ™¯çš„å‘ç”Ÿã€‚ ç¼“å­˜ç©¿é€ ç¼“å­˜ç©¿é€æ˜¯æŒ‡ï¼šç”¨æˆ·æŸ¥è¯¢çš„æ•°æ®ï¼Œåœ¨æ•°æ®åº“æ²¡æœ‰ï¼Œè‡ªç„¶åœ¨ç¼“å­˜ä¸­ä¹Ÿä¸ä¼šæœ‰ã€‚è¿™æ ·å°±å¯¼è‡´ç”¨æˆ·æŸ¥è¯¢çš„æ—¶å€™ï¼Œåœ¨ç¼“å­˜ä¸­æ‰¾ä¸åˆ°ï¼Œæ¯æ¬¡éƒ½è¦åŽ»æ•°æ®åº“å†æŸ¥è¯¢ä¸€éï¼Œç„¶åŽè¿”å›žç©ºï¼ˆç›¸å½“äºŽè¿›è¡Œäº†ä¸¤æ¬¡æ— ç”¨çš„æŸ¥è¯¢ï¼‰ã€‚è¿™æ ·è¯·æ±‚å°±ç»•è¿‡ç¼“å­˜ç›´æŽ¥æŸ¥æ•°æ®åº“ï¼Œè¿™ä¹Ÿæ˜¯ç»å¸¸æçš„ç¼“å­˜å‘½ä¸­çŽ‡é—®é¢˜ã€‚ å½“åœ¨æµé‡è¾ƒå¤§æ—¶ï¼Œå‡ºçŽ°è¿™æ ·çš„æƒ…å†µï¼Œä¸€ç›´è¯·æ±‚ DBï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æœåŠ¡æŒ‚æŽ‰ã€‚ è§£å†³æ–¹æ¡ˆï¼š åœ¨å°è£…çš„ç¼“å­˜ SET å’Œ GET éƒ¨åˆ†å¢žåŠ ä¸ªæ­¥éª¤ï¼Œå¦‚æžœæŸ¥è¯¢ä¸€ä¸ª KEY ä¸å­˜åœ¨ï¼Œå°±ä»¥è¿™ä¸ª KEY ä¸ºå‰ç¼€è®¾å®šä¸€ä¸ªæ ‡è¯† KEYï¼›ä»¥åŽå†æŸ¥è¯¢è¯¥ KEY çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ ‡è¯† KEYï¼Œå¦‚æžœæ ‡è¯† KEY å­˜åœ¨ï¼Œå°±è¿”å›žä¸€ä¸ªåå®šå¥½çš„éž false æˆ–è€… NULL å€¼ï¼Œç„¶åŽ APP åšç›¸åº”çš„å¤„ç†ï¼Œè¿™æ ·ç¼“å­˜å±‚å°±ä¸ä¼šè¢«ç©¿é€ã€‚å½“ç„¶è¿™ä¸ªéªŒè¯ KEY çš„å¤±æ•ˆæ—¶é—´ä¸èƒ½å¤ªé•¿ã€‚ å¦‚æžœä¸€ä¸ªæŸ¥è¯¢è¿”å›žçš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•°æ®ä¸å­˜åœ¨ï¼Œè¿˜æ˜¯ç³»ç»Ÿæ•…éšœï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æžœè¿›è¡Œç¼“å­˜ï¼Œä½†å®ƒçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œä¸€èˆ¬åªæœ‰å‡ åˆ†é’Ÿã€‚ é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ bitmap ä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢«è¿™ä¸ª bitmap æ‹¦æˆªæŽ‰ï¼Œä»Žè€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢åŽ‹åŠ›ã€‚ ç¼“å­˜é¢„çƒ­ ç¼“å­˜é¢„çƒ­è¿™ä¸ªåº”è¯¥æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„æ¦‚å¿µï¼Œç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´éƒ½åº”è¯¥å¯ä»¥å¾ˆå®¹æ˜“çš„ç†è§£ï¼Œç¼“å­˜é¢„çƒ­å°±æ˜¯ç³»ç»Ÿä¸Šçº¿åŽï¼Œå°†ç›¸å…³çš„ç¼“å­˜æ•°æ®ç›´æŽ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚è¿™æ ·å°±å¯ä»¥é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åŽå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ï¼ç”¨æˆ·ç›´æŽ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ï¼ è§£å†³æ–¹æ¡ˆï¼š ç›´æŽ¥å†™ä¸ªç¼“å­˜åˆ·æ–°é¡µé¢ï¼Œä¸Šçº¿æ—¶æ‰‹å·¥æ“ä½œä¸‹ï¼› æ•°æ®é‡ä¸å¤§ï¼Œå¯ä»¥åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨è¿›è¡ŒåŠ è½½ï¼› å®šæ—¶åˆ·æ–°ç¼“å­˜ï¼› ç¼“å­˜æ›´æ–° é™¤äº†ç¼“å­˜æœåŠ¡å™¨è‡ªå¸¦çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥ä¹‹å¤–ï¼ˆRedis é»˜è®¤çš„æœ‰ 6 ä¸­ç­–ç•¥å¯ä¾›é€‰æ‹©ï¼‰ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰çš„ç¼“å­˜æ·˜æ±°ï¼Œå¸¸è§çš„ç­–ç•¥æœ‰ä¸¤ç§ï¼š å®šæ—¶åŽ»æ¸…ç†è¿‡æœŸçš„ç¼“å­˜ï¼› å½“æœ‰ç”¨æˆ·è¯·æ±‚è¿‡æ¥æ—¶ï¼Œå†åˆ¤æ–­è¿™ä¸ªè¯·æ±‚æ‰€ç”¨åˆ°çš„ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸçš„è¯å°±åŽ»åº•å±‚ç³»ç»Ÿå¾—åˆ°æ–°æ•°æ®å¹¶æ›´æ–°ç¼“å­˜ã€‚ ä¸¤è€…å„æœ‰ä¼˜åŠ£ï¼Œç¬¬ä¸€ç§çš„ç¼ºç‚¹æ˜¯ç»´æŠ¤å¤§é‡ç¼“å­˜çš„ key æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œç¬¬äºŒç§çš„ç¼ºç‚¹å°±æ˜¯æ¯æ¬¡ç”¨æˆ·è¯·æ±‚è¿‡æ¥éƒ½è¦åˆ¤æ–­ç¼“å­˜å¤±æ•ˆï¼Œé€»è¾‘ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼å…·ä½“ç”¨å“ªç§æ–¹æ¡ˆï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„åº”ç”¨åœºæ™¯æ¥æƒè¡¡ã€‚ ç¼“å­˜é™çº§ å½“è®¿é—®é‡å‰§å¢žã€æœåŠ¡å‡ºçŽ°é—®é¢˜ï¼ˆå¦‚å“åº”æ—¶é—´æ…¢æˆ–ä¸å“åº”ï¼‰æˆ–éžæ ¸å¿ƒæœåŠ¡å½±å“åˆ°æ ¸å¿ƒæµç¨‹çš„æ€§èƒ½æ—¶ï¼Œä»ç„¶éœ€è¦ä¿è¯æœåŠ¡è¿˜æ˜¯å¯ç”¨çš„ï¼Œå³ä½¿æ˜¯æœ‰æŸæœåŠ¡ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®ä¸€äº›å…³é”®æ•°æ®è¿›è¡Œè‡ªåŠ¨é™çº§ï¼Œä¹Ÿå¯ä»¥é…ç½®å¼€å…³å®žçŽ°äººå·¥é™çº§ã€‚ é™çº§çš„æœ€ç»ˆç›®çš„æ˜¯ä¿è¯æ ¸å¿ƒæœåŠ¡å¯ç”¨ï¼Œå³ä½¿æ˜¯æœ‰æŸçš„ã€‚è€Œä¸”æœ‰äº›æœåŠ¡æ˜¯æ— æ³•é™çº§çš„ï¼ˆå¦‚åŠ å…¥è´­ç‰©è½¦ã€ç»“ç®—ï¼‰ã€‚ å‚è€ƒèµ„æ–™ åˆ†å¸ƒå¼ç¼“å­˜æž¶æž„åŸºç¡€ é˜¿é‡Œ P8 æŠ€æœ¯ä¸“å®¶ç»†ç©¶åˆ†å¸ƒå¼ç¼“å­˜é—®é¢˜]]></content>
      <categories>
        <category>design</category>
        <category>distributed</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>distributed</tag>
        <tag>cache</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼äº‹åŠ¡]]></title>
    <url>%2Fblog%2F2019%2F06%2F21%2Fdesign%2Fdistributed%2Fdistributed-transaction%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼äº‹åŠ¡ åˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„æ˜¯äº‹åŠ¡æ“ä½œè·¨è¶Šå¤šä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¦æ±‚æ»¡è¶³äº‹åŠ¡çš„ ACID ç‰¹æ€§ã€‚ åˆ†å¸ƒå¼äº‹åŠ¡çš„å®žçŽ°ä¸»è¦æœ‰ä»¥ä¸‹ 5 ç§æ–¹æ¡ˆï¼š XA æ–¹æ¡ˆ TCC æ–¹æ¡ˆ æœ¬åœ°æ¶ˆæ¯è¡¨ å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ ä¸¤é˜¶æ®µæäº¤ ä¸¤é˜¶æ®µæäº¤ï¼ˆTwo-phase Commitï¼Œ2PCï¼‰é€šè¿‡å¼•å…¥åè°ƒè€…ï¼ˆCoordinatorï¼‰æ¥è°ƒåº¦å‚ä¸Žè€…çš„è¡Œä¸ºï¼Œå¹¶æœ€ç»ˆå†³å®šè¿™äº›å‚ä¸Žè€…æ˜¯å¦è¦çœŸæ­£æ‰§è¡Œäº‹åŠ¡ã€‚ å‚è€ƒå®žçŽ°ï¼šhttps://github.com/changmingxie/tcc-transaction è¿è¡Œè¿‡ç¨‹ å‡†å¤‡é˜¶æ®µ åè°ƒè€…è¯¢é—®å‚ä¸Žè€…äº‹åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå‚ä¸Žè€…å‘å›žäº‹åŠ¡æ‰§è¡Œç»“æžœã€‚ æäº¤é˜¶æ®µ å¦‚æžœäº‹åŠ¡åœ¨æ¯ä¸ªå‚ä¸Žè€…ä¸Šéƒ½æ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡åè°ƒè€…å‘é€é€šçŸ¥è®©å‚ä¸Žè€…æäº¤äº‹åŠ¡ï¼›å¦åˆ™ï¼Œåè°ƒè€…å‘é€é€šçŸ¥è®©å‚ä¸Žè€…å›žæ»šäº‹åŠ¡ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å‡†å¤‡é˜¶æ®µï¼Œå‚ä¸Žè€…æ‰§è¡Œäº†äº‹åŠ¡ï¼Œä½†æ˜¯è¿˜æœªæäº¤ã€‚åªæœ‰åœ¨æäº¤é˜¶æ®µæŽ¥æ”¶åˆ°åè°ƒè€…å‘æ¥çš„é€šçŸ¥åŽï¼Œæ‰è¿›è¡Œæäº¤æˆ–è€…å›žæ»šã€‚ é—®é¢˜ åŒæ­¥é˜»å¡ž - æ‰€æœ‰äº‹åŠ¡å‚ä¸Žè€…åœ¨ç­‰å¾…å…¶å®ƒå‚ä¸Žè€…å“åº”çš„æ—¶å€™éƒ½å¤„äºŽåŒæ­¥é˜»å¡žçŠ¶æ€ï¼Œæ— æ³•è¿›è¡Œå…¶å®ƒæ“ä½œã€‚ å•ç‚¹é—®é¢˜ - åè°ƒè€…åœ¨ 2PC ä¸­èµ·åˆ°éžå¸¸å¤§çš„ä½œç”¨ï¼Œå‘ç”Ÿæ•…éšœå°†ä¼šé€ æˆå¾ˆå¤§å½±å“ï¼Œç‰¹åˆ«æ˜¯åœ¨é˜¶æ®µäºŒå‘ç”Ÿæ•…éšœï¼Œæ‰€æœ‰å‚ä¸Žè€…ä¼šä¸€ç›´ç­‰å¾…çŠ¶æ€ï¼Œæ— æ³•å®Œæˆå…¶å®ƒæ“ä½œã€‚ æ•°æ®ä¸ä¸€è‡´ - åœ¨é˜¶æ®µäºŒï¼Œå¦‚æžœåè°ƒè€…åªå‘é€äº†éƒ¨åˆ† Commit æ¶ˆæ¯ï¼Œæ­¤æ—¶ç½‘ç»œå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆåªæœ‰éƒ¨åˆ†å‚ä¸Žè€…æŽ¥æ”¶åˆ° Commit æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰éƒ¨åˆ†å‚ä¸Žè€…æäº¤äº†äº‹åŠ¡ï¼Œä½¿å¾—ç³»ç»Ÿæ•°æ®ä¸ä¸€è‡´ã€‚ å¤ªè¿‡ä¿å®ˆ - ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¤±è´¥å°±ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼Œæ²¡æœ‰å®Œå–„çš„å®¹é”™æœºåˆ¶ã€‚ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šå°½é‡ä¿è¯äº†æ•°æ®çš„å¼ºä¸€è‡´ï¼Œé€‚åˆå¯¹æ•°æ®å¼ºä¸€è‡´è¦æ±‚å¾ˆé«˜çš„å…³é”®é¢†åŸŸã€‚ï¼ˆå…¶å®žä¹Ÿä¸èƒ½ 100%ä¿è¯å¼ºä¸€è‡´ ç¼ºç‚¹ï¼šå®žçŽ°å¤æ‚ï¼Œç‰ºç‰²äº†å¯ç”¨æ€§ï¼Œå¯¹æ€§èƒ½å½±å“è¾ƒå¤§ï¼Œä¸é€‚åˆé«˜å¹¶å‘é«˜æ€§èƒ½åœºæ™¯ã€‚ è¡¥å¿äº‹åŠ¡ è¡¥å¿äº‹åŠ¡ï¼ˆTCCï¼‰ï¼Œå…¨ç§°æ˜¯ï¼šTryã€Confirmã€Cancelã€‚ å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šé’ˆå¯¹æ¯ä¸ªæ“ä½œï¼Œéƒ½è¦æ³¨å†Œä¸€ä¸ªä¸Žå…¶å¯¹åº”çš„ç¡®è®¤å’Œè¡¥å¿ï¼ˆæ’¤é”€ï¼‰æ“ä½œã€‚å®ƒåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š TCC çš„ã€‚ Try é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µè¯´çš„æ˜¯å¯¹å„ä¸ªæœåŠ¡çš„èµ„æºåšæ£€æµ‹ä»¥åŠå¯¹èµ„æºè¿›è¡Œé”å®šæˆ–è€…é¢„ç•™ã€‚ Confirm é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µè¯´çš„æ˜¯åœ¨å„ä¸ªæœåŠ¡ä¸­æ‰§è¡Œå®žé™…çš„æ“ä½œã€‚ Cancel é˜¶æ®µï¼šå¦‚æžœä»»ä½•ä¸€ä¸ªæœåŠ¡çš„ä¸šåŠ¡æ–¹æ³•æ‰§è¡Œå‡ºé”™ï¼Œé‚£ä¹ˆè¿™é‡Œå°±éœ€è¦è¿›è¡Œè¡¥å¿ï¼Œå°±æ˜¯æ‰§è¡Œå·²ç»æ‰§è¡ŒæˆåŠŸçš„ä¸šåŠ¡é€»è¾‘çš„å›žæ»šæ“ä½œã€‚ï¼ˆæŠŠé‚£äº›æ‰§è¡ŒæˆåŠŸçš„å›žæ»šï¼‰ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ Bob è¦å‘ Smith è½¬è´¦ï¼Œæ€è·¯å¤§æ¦‚æ˜¯ï¼š é¦–å…ˆåœ¨ Try é˜¶æ®µï¼Œè¦å…ˆè°ƒç”¨è¿œç¨‹æŽ¥å£æŠŠ Smith å’Œ Bob çš„é’±ç»™å†»ç»“èµ·æ¥ã€‚ åœ¨ Confirm é˜¶æ®µï¼Œæ‰§è¡Œè¿œç¨‹è°ƒç”¨çš„è½¬è´¦çš„æ“ä½œï¼Œè½¬è´¦æˆåŠŸè¿›è¡Œè§£å†»ã€‚ å¦‚æžœç¬¬ 2 æ­¥æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆè½¬è´¦æˆåŠŸï¼Œå¦‚æžœç¬¬äºŒæ­¥æ‰§è¡Œå¤±è´¥ï¼Œåˆ™è°ƒç”¨è¿œç¨‹å†»ç»“æŽ¥å£å¯¹åº”çš„è§£å†»æ–¹æ³• (Cancel)ã€‚ ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼šè·Ÿ 2PC æ¯”èµ·æ¥ï¼Œå®žçŽ°ä»¥åŠæµç¨‹ç›¸å¯¹ç®€å•äº†ä¸€äº›ï¼Œä½†æ•°æ®çš„ä¸€è‡´æ€§æ¯” 2PC ä¹Ÿè¦å·®ä¸€äº›ã€‚ ç¼ºç‚¹ï¼šç¼ºç‚¹è¿˜æ˜¯æ¯”è¾ƒæ˜Žæ˜¾çš„ï¼Œåœ¨ 2,3 æ­¥ä¸­éƒ½æœ‰å¯èƒ½å¤±è´¥ã€‚TCC å±žäºŽåº”ç”¨å±‚çš„ä¸€ç§è¡¥å¿æ–¹å¼ï¼Œæ‰€ä»¥éœ€è¦ç¨‹åºå‘˜åœ¨å®žçŽ°çš„æ—¶å€™å¤šå†™å¾ˆå¤šè¡¥å¿çš„ä»£ç ï¼Œåœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œä¸€äº›ä¸šåŠ¡æµç¨‹å¯èƒ½ç”¨ TCC ä¸å¤ªå¥½å®šä¹‰åŠå¤„ç†ã€‚ è¿™ç§æ–¹æ¡ˆå‡ ä¹Žå¾ˆå°‘äººä½¿ç”¨ï¼Œå› ä¸ºäº‹åŠ¡å›žæ»šå®žé™…ä¸Šæ˜¯ä¸¥é‡ä¾èµ–äºŽè‡ªå·±å†™ä»£ç æ¥å›žæ»šå’Œè¡¥å¿äº†ï¼Œä¼šé€ æˆè¡¥å¿ä»£ç å·¨å¤§ã€‚ ä½†æ˜¯ï¼Œä¹Ÿæœ‰ç‰¹æ®Šçš„ä½¿ç”¨åœºæ™¯ï¼šä¸€èˆ¬æ¥è¯´è·Ÿé’±ç›¸å…³çš„ï¼Œè·Ÿé’±æ‰“äº¤é“çš„ï¼Œæ”¯ä»˜ã€äº¤æ˜“ç›¸å…³çš„åœºæ™¯ï¼Œä¼šç”¨ TCCï¼Œä¸¥æ ¼ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨è‡ªåŠ¨å›žæ»šï¼Œä¸¥æ ¼ä¿è¯èµ„é‡‘çš„æ­£ç¡®æ€§ï¼Œä¿è¯åœ¨èµ„é‡‘ä¸Šä¸ä¼šå‡ºçŽ°é—®é¢˜ã€‚ è€Œä¸”æœ€å¥½æ˜¯ä½ çš„å„ä¸ªä¸šåŠ¡æ‰§è¡Œçš„æ—¶é—´éƒ½æ¯”è¾ƒçŸ­ã€‚ ä½†æ˜¯è¯´å®žè¯ï¼Œä¸€èˆ¬å°½é‡åˆ«è¿™ä¹ˆæžï¼Œè‡ªå·±æ‰‹å†™å›žæ»šé€»è¾‘ï¼Œæˆ–è€…æ˜¯è¡¥å¿é€»è¾‘ï¼Œå®žåœ¨å¤ªæ¶å¿ƒäº†ï¼Œé‚£ä¸ªä¸šåŠ¡ä»£ç æ˜¯å¾ˆéš¾ç»´æŠ¤çš„ã€‚ æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆå¼‚æ­¥ç¡®ä¿ï¼‰ æœ¬åœ°æ¶ˆæ¯è¡¨ä¸Žä¸šåŠ¡æ•°æ®è¡¨å¤„äºŽåŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œè¿™æ ·å°±èƒ½åˆ©ç”¨æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯åœ¨å¯¹è¿™ä¸¤ä¸ªè¡¨çš„æ“ä½œæ»¡è¶³äº‹åŠ¡ç‰¹æ€§ã€‚ åœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ“ä½œçš„ä¸€æ–¹å®Œæˆå†™ä¸šåŠ¡æ•°æ®çš„æ“ä½œä¹‹åŽå‘æœ¬åœ°æ¶ˆæ¯è¡¨å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œæœ¬åœ°äº‹åŠ¡èƒ½ä¿è¯è¿™ä¸ªæ¶ˆæ¯ä¸€å®šä¼šè¢«å†™å…¥æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­ã€‚ ä¹‹åŽå°†æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­çš„æ¶ˆæ¯è½¬å‘åˆ° Kafka ç­‰æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰ä¸­ï¼Œå¦‚æžœè½¬å‘æˆåŠŸåˆ™å°†æ¶ˆæ¯ä»Žæœ¬åœ°æ¶ˆæ¯è¡¨ä¸­åˆ é™¤ï¼Œå¦åˆ™ç»§ç»­é‡æ–°è½¬å‘ã€‚ åœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ“ä½œçš„å¦ä¸€æ–¹ä»Žæ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¹¶æ‰§è¡Œæ¶ˆæ¯ä¸­çš„æ“ä½œã€‚ è¿™ç§æ–¹æ¡ˆéµå¾ª BASE ç†è®ºï¼Œé‡‡ç”¨çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚ æœ¬åœ°æ¶ˆæ¯è¡¨åˆ©ç”¨äº†æœ¬åœ°äº‹åŠ¡æ¥å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—æ¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šä¸€ç§éžå¸¸ç»å…¸çš„å®žçŽ°ï¼Œé¿å…äº†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå®žçŽ°äº†æœ€ç»ˆä¸€è‡´æ€§ã€‚ ç¼ºç‚¹ï¼šæ¶ˆæ¯è¡¨ä¼šè€¦åˆåˆ°ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œå¦‚æžœæ²¡æœ‰å°è£…å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œä¼šæœ‰å¾ˆå¤šæ‚æ´»éœ€è¦å¤„ç†ã€‚ MQ äº‹åŠ¡æ¶ˆæ¯ æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹çš„ MQ æ˜¯æ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„ï¼Œæ¯”å¦‚ RocketMQï¼Œä»–ä»¬æ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„æ–¹å¼ä¹Ÿæ˜¯ç±»ä¼¼äºŽé‡‡ç”¨çš„äºŒé˜¶æ®µæäº¤ã€‚ä½†æ˜¯å¸‚é¢ä¸Šä¸€äº›ä¸»æµçš„ MQ éƒ½æ˜¯ä¸æ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„ï¼Œæ¯”å¦‚ RabbitMQ å’Œ Kafka éƒ½ä¸æ”¯æŒã€‚ ä»¥é˜¿é‡Œçš„ RocketMQ ä¸­é—´ä»¶ä¸ºä¾‹ï¼Œå…¶æ€è·¯å¤§è‡´ä¸ºï¼š Prepared æ¶ˆæ¯ï¼Œä¼šæ‹¿åˆ°æ¶ˆæ¯çš„åœ°å€ã€‚ æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ã€‚ é€šè¿‡ç¬¬ä¸€é˜¶æ®µæ‹¿åˆ°çš„åœ°å€åŽ»è®¿é—®æ¶ˆæ¯ï¼Œå¹¶ä¿®æ”¹çŠ¶æ€ã€‚ ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸šåŠ¡æ–¹æ³•å†…è¦æƒ³æ¶ˆæ¯é˜Ÿåˆ—æäº¤ä¸¤æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡å‘é€æ¶ˆæ¯å’Œä¸€æ¬¡ç¡®è®¤æ¶ˆæ¯ã€‚å¦‚æžœç¡®è®¤æ¶ˆæ¯å‘é€å¤±è´¥äº† RocketMQ ä¼šå®šæœŸæ‰«ææ¶ˆæ¯é›†ç¾¤ä¸­çš„äº‹åŠ¡æ¶ˆæ¯ï¼Œè¿™æ—¶å€™å‘çŽ°äº† Prepared æ¶ˆæ¯ï¼Œå®ƒä¼šå‘æ¶ˆæ¯å‘é€è€…ç¡®è®¤ï¼Œæ‰€ä»¥ç”Ÿäº§æ–¹éœ€è¦å®žçŽ°ä¸€ä¸ª check æŽ¥å£ï¼ŒRocketMQ ä¼šæ ¹æ®å‘é€ç«¯è®¾ç½®çš„ç­–ç•¥æ¥å†³å®šæ˜¯å›žæ»šè¿˜æ˜¯ç»§ç»­å‘é€ç¡®è®¤æ¶ˆæ¯ã€‚è¿™æ ·å°±ä¿è¯äº†æ¶ˆæ¯å‘é€ä¸Žæœ¬åœ°äº‹åŠ¡åŒæ—¶æˆåŠŸæˆ–åŒæ—¶å¤±è´¥ã€‚ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šå®žçŽ°äº†æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸éœ€è¦ä¾èµ–æœ¬åœ°æ•°æ®åº“äº‹åŠ¡ã€‚ ç¼ºç‚¹ï¼šå®žçŽ°éš¾åº¦å¤§ï¼Œä¸»æµ MQ ä¸æ”¯æŒã€‚ ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆ/XA æ–¹æ¡ˆ æ‰€è°“çš„ XA æ–¹æ¡ˆï¼Œå³ï¼šä¸¤é˜¶æ®µæäº¤ï¼Œæœ‰ä¸€ä¸ªäº‹åŠ¡ç®¡ç†å™¨çš„æ¦‚å¿µï¼Œè´Ÿè´£åè°ƒå¤šä¸ªæ•°æ®åº“ï¼ˆèµ„æºç®¡ç†å™¨ï¼‰çš„äº‹åŠ¡ï¼Œäº‹åŠ¡ç®¡ç†å™¨å…ˆé—®é—®å„ä¸ªæ•°æ®åº“ä½ å‡†å¤‡å¥½äº†å—ï¼Ÿå¦‚æžœæ¯ä¸ªæ•°æ®åº“éƒ½å›žå¤ okï¼Œé‚£ä¹ˆå°±æ­£å¼æäº¤äº‹åŠ¡ï¼Œåœ¨å„ä¸ªæ•°æ®åº“ä¸Šæ‰§è¡Œæ“ä½œï¼›å¦‚æžœä»»ä½•å…¶ä¸­ä¸€ä¸ªæ•°æ®åº“å›žç­”ä¸ okï¼Œé‚£ä¹ˆå°±å›žæ»šäº‹åŠ¡ã€‚ è¿™ç§åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆï¼Œæ¯”è¾ƒé€‚åˆå•å—åº”ç”¨é‡Œï¼Œè·¨å¤šä¸ªåº“çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè€Œä¸”å› ä¸ºä¸¥é‡ä¾èµ–äºŽæ•°æ®åº“å±‚é¢æ¥æžå®šå¤æ‚çš„äº‹åŠ¡ï¼Œæ•ˆçŽ‡å¾ˆä½Žï¼Œç»å¯¹ä¸é€‚åˆé«˜å¹¶å‘çš„åœºæ™¯ã€‚å¦‚æžœè¦çŽ©å„¿ï¼Œé‚£ä¹ˆåŸºäºŽ Spring + JTA å°±å¯ä»¥æžå®šï¼Œè‡ªå·±éšä¾¿æœä¸ª demo çœ‹çœ‹å°±çŸ¥é“äº†ã€‚ è¿™ä¸ªæ–¹æ¡ˆï¼Œæˆ‘ä»¬å¾ˆå°‘ç”¨ï¼Œä¸€èˆ¬æ¥è¯´æŸä¸ªç³»ç»Ÿå†…éƒ¨å¦‚æžœå‡ºçŽ°è·¨å¤šä¸ªåº“çš„è¿™ä¹ˆä¸€ä¸ªæ“ä½œï¼Œæ˜¯ä¸åˆè§„çš„ã€‚æˆ‘å¯ä»¥ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹ï¼Œ çŽ°åœ¨å¾®æœåŠ¡ï¼Œä¸€ä¸ªå¤§çš„ç³»ç»Ÿåˆ†æˆå‡ åä¸ªç”šè‡³å‡ ç™¾ä¸ªæœåŠ¡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬çš„è§„å®šå’Œè§„èŒƒï¼Œæ˜¯è¦æ±‚æ¯ä¸ªæœåŠ¡åªèƒ½æ“ä½œè‡ªå·±å¯¹åº”çš„ä¸€ä¸ªæ•°æ®åº“ã€‚ å¦‚æžœä½ è¦æ“ä½œåˆ«çš„æœåŠ¡å¯¹åº”çš„åº“ï¼Œä¸å…è®¸ç›´è¿žåˆ«çš„æœåŠ¡çš„åº“ï¼Œè¿åå¾®æœåŠ¡æž¶æž„çš„è§„èŒƒï¼Œä½ éšä¾¿äº¤å‰èƒ¡ä¹±è®¿é—®ï¼Œå‡ ç™¾ä¸ªæœåŠ¡çš„è¯ï¼Œå…¨ä½“ä¹±å¥—ï¼Œè¿™æ ·çš„ä¸€å¥—æœåŠ¡æ˜¯æ²¡æ³•ç®¡ç†çš„ï¼Œæ²¡æ³•æ²»ç†çš„ï¼Œå¯èƒ½ä¼šå‡ºçŽ°æ•°æ®è¢«åˆ«äººæ”¹é”™ï¼Œè‡ªå·±çš„åº“è¢«åˆ«äººå†™æŒ‚ç­‰æƒ…å†µã€‚ å¦‚æžœä½ è¦æ“ä½œåˆ«äººçš„æœåŠ¡çš„åº“ï¼Œä½ å¿…é¡»æ˜¯é€šè¿‡è°ƒç”¨åˆ«çš„æœåŠ¡çš„æŽ¥å£æ¥å®žçŽ°ï¼Œç»å¯¹ä¸å…è®¸äº¤å‰è®¿é—®åˆ«äººçš„æ•°æ®åº“ã€‚ æœ¬åœ°æ¶ˆæ¯è¡¨ æœ¬åœ°æ¶ˆæ¯è¡¨å…¶å®žæ˜¯å›½å¤–çš„ ebay æžå‡ºæ¥çš„è¿™ä¹ˆä¸€å¥—æ€æƒ³ã€‚ è¿™ä¸ªå¤§æ¦‚æ„æ€æ˜¯è¿™æ ·çš„ï¼š A ç³»ç»Ÿåœ¨è‡ªå·±æœ¬åœ°ä¸€ä¸ªäº‹åŠ¡é‡Œæ“ä½œåŒæ—¶ï¼Œæ’å…¥ä¸€æ¡æ•°æ®åˆ°æ¶ˆæ¯è¡¨ï¼› æŽ¥ç€ A ç³»ç»Ÿå°†è¿™ä¸ªæ¶ˆæ¯å‘é€åˆ° MQ ä¸­åŽ»ï¼› B ç³»ç»ŸæŽ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åŽï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œï¼Œå¾€è‡ªå·±æœ¬åœ°æ¶ˆæ¯è¡¨é‡Œæ’å…¥ä¸€æ¡æ•°æ®ï¼ŒåŒæ—¶æ‰§è¡Œå…¶ä»–çš„ä¸šåŠ¡æ“ä½œï¼Œå¦‚æžœè¿™ä¸ªæ¶ˆæ¯å·²ç»è¢«å¤„ç†è¿‡äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™ä¸ªäº‹åŠ¡ä¼šå›žæ»šï¼Œè¿™æ ·ä¿è¯ä¸ä¼šé‡å¤å¤„ç†æ¶ˆæ¯ï¼› B ç³»ç»Ÿæ‰§è¡ŒæˆåŠŸä¹‹åŽï¼Œå°±ä¼šæ›´æ–°è‡ªå·±æœ¬åœ°æ¶ˆæ¯è¡¨çš„çŠ¶æ€ä»¥åŠ A ç³»ç»Ÿæ¶ˆæ¯è¡¨çš„çŠ¶æ€ï¼› å¦‚æžœ B ç³»ç»Ÿå¤„ç†å¤±è´¥äº†ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ›´æ–°æ¶ˆæ¯è¡¨çŠ¶æ€ï¼Œé‚£ä¹ˆæ­¤æ—¶ A ç³»ç»Ÿä¼šå®šæ—¶æ‰«æè‡ªå·±çš„æ¶ˆæ¯è¡¨ï¼Œå¦‚æžœæœ‰æœªå¤„ç†çš„æ¶ˆæ¯ï¼Œä¼šå†æ¬¡å‘é€åˆ° MQ ä¸­åŽ»ï¼Œè®© B å†æ¬¡å¤„ç†ï¼› è¿™ä¸ªæ–¹æ¡ˆä¿è¯äº†æœ€ç»ˆä¸€è‡´æ€§ï¼Œå“ªæ€• B äº‹åŠ¡å¤±è´¥äº†ï¼Œä½†æ˜¯ A ä¼šä¸æ–­é‡å‘æ¶ˆæ¯ï¼Œç›´åˆ° B é‚£è¾¹æˆåŠŸä¸ºæ­¢ã€‚ è¿™ä¸ªæ–¹æ¡ˆè¯´å®žè¯æœ€å¤§çš„é—®é¢˜å°±åœ¨äºŽä¸¥é‡ä¾èµ–äºŽæ•°æ®åº“çš„æ¶ˆæ¯è¡¨æ¥ç®¡ç†äº‹åŠ¡å•¥çš„ï¼Œå¦‚æžœæ˜¯é«˜å¹¶å‘åœºæ™¯å’‹åŠžå‘¢ï¼Ÿå’‹æ‰©å±•å‘¢ï¼Ÿæ‰€ä»¥ä¸€èˆ¬ç¡®å®žå¾ˆå°‘ç”¨ã€‚ å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ è¿™ä¸ªçš„æ„æ€ï¼Œå°±æ˜¯å¹²è„†ä¸è¦ç”¨æœ¬åœ°çš„æ¶ˆæ¯è¡¨äº†ï¼Œç›´æŽ¥åŸºäºŽ MQ æ¥å®žçŽ°äº‹åŠ¡ã€‚æ¯”å¦‚é˜¿é‡Œçš„ RocketMQ å°±æ”¯æŒæ¶ˆæ¯äº‹åŠ¡ã€‚ å¤§æ¦‚çš„æ„æ€å°±æ˜¯ï¼š A ç³»ç»Ÿå…ˆå‘é€ä¸€ä¸ª prepared æ¶ˆæ¯åˆ° mqï¼Œå¦‚æžœè¿™ä¸ª prepared æ¶ˆæ¯å‘é€å¤±è´¥é‚£ä¹ˆå°±ç›´æŽ¥å–æ¶ˆæ“ä½œåˆ«æ‰§è¡Œäº†ï¼› å¦‚æžœè¿™ä¸ªæ¶ˆæ¯å‘é€æˆåŠŸè¿‡äº†ï¼Œé‚£ä¹ˆæŽ¥ç€æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå¦‚æžœæˆåŠŸå°±å‘Šè¯‰ mq å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æžœå¤±è´¥å°±å‘Šè¯‰ mq å›žæ»šæ¶ˆæ¯ï¼› å¦‚æžœå‘é€äº†ç¡®è®¤æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ­¤æ—¶ B ç³»ç»Ÿä¼šæŽ¥æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯ï¼Œç„¶åŽæ‰§è¡Œæœ¬åœ°çš„äº‹åŠ¡ï¼› mq ä¼šè‡ªåŠ¨å®šæ—¶è½®è¯¢æ‰€æœ‰ prepared æ¶ˆæ¯å›žè°ƒä½ çš„æŽ¥å£ï¼Œé—®ä½ ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯ä¸æ˜¯æœ¬åœ°äº‹åŠ¡å¤„ç†å¤±è´¥äº†ï¼Œæ‰€æœ‰æ²¡å‘é€ç¡®è®¤çš„æ¶ˆæ¯ï¼Œæ˜¯ç»§ç»­é‡è¯•è¿˜æ˜¯å›žæ»šï¼Ÿä¸€èˆ¬æ¥è¯´è¿™é‡Œä½ å°±å¯ä»¥æŸ¥ä¸‹æ•°æ®åº“çœ‹ä¹‹å‰æœ¬åœ°äº‹åŠ¡æ˜¯å¦æ‰§è¡Œï¼Œå¦‚æžœå›žæ»šäº†ï¼Œé‚£ä¹ˆè¿™é‡Œä¹Ÿå›žæ»šå§ã€‚è¿™ä¸ªå°±æ˜¯é¿å…å¯èƒ½æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸäº†ï¼Œè€Œç¡®è®¤æ¶ˆæ¯å´å‘é€å¤±è´¥äº†ã€‚ è¿™ä¸ªæ–¹æ¡ˆé‡Œï¼Œè¦æ˜¯ç³»ç»Ÿ B çš„äº‹åŠ¡å¤±è´¥äº†å’‹åŠžï¼Ÿé‡è¯•å’¯ï¼Œè‡ªåŠ¨ä¸æ–­é‡è¯•ç›´åˆ°æˆåŠŸï¼Œå¦‚æžœå®žåœ¨æ˜¯ä¸è¡Œï¼Œè¦ä¹ˆå°±æ˜¯é’ˆå¯¹é‡è¦çš„èµ„é‡‘ç±»ä¸šåŠ¡è¿›è¡Œå›žæ»šï¼Œæ¯”å¦‚ B ç³»ç»Ÿæœ¬åœ°å›žæ»šåŽï¼Œæƒ³åŠžæ³•é€šçŸ¥ç³»ç»Ÿ A ä¹Ÿå›žæ»šï¼›æˆ–è€…æ˜¯å‘é€æŠ¥è­¦ç”±äººå·¥æ¥æ‰‹å·¥å›žæ»šå’Œè¡¥å¿ã€‚ è¿™ä¸ªè¿˜æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œç›®å‰å›½å†…äº’è”ç½‘å…¬å¸å¤§éƒ½æ˜¯è¿™ä¹ˆçŽ©å„¿çš„ï¼Œè¦ä¸ä½ ä¸¾ç”¨ RocketMQ æ”¯æŒçš„ï¼Œè¦ä¸ä½ å°±è‡ªå·±åŸºäºŽç±»ä¼¼ ActiveMQï¼ŸRabbitMQï¼Ÿè‡ªå·±å°è£…ä¸€å¥—ç±»ä¼¼çš„é€»è¾‘å‡ºæ¥ï¼Œæ€»ä¹‹æ€è·¯å°±æ˜¯è¿™æ ·å­çš„ã€‚ æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ è¿™ä¸ªæ–¹æ¡ˆçš„å¤§è‡´æ„æ€å°±æ˜¯ï¼š ç³»ç»Ÿ A æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå®Œä¹‹åŽï¼Œå‘é€ä¸ªæ¶ˆæ¯åˆ° MQï¼› è¿™é‡Œä¼šæœ‰ä¸ªä¸“é—¨æ¶ˆè´¹ MQ çš„æœ€å¤§åŠªåŠ›é€šçŸ¥æœåŠ¡ï¼Œè¿™ä¸ªæœåŠ¡ä¼šæ¶ˆè´¹ MQ ç„¶åŽå†™å…¥æ•°æ®åº“ä¸­è®°å½•ä¸‹æ¥ï¼Œæˆ–è€…æ˜¯æ”¾å…¥ä¸ªå†…å­˜é˜Ÿåˆ—ä¹Ÿå¯ä»¥ï¼ŒæŽ¥ç€è°ƒç”¨ç³»ç»Ÿ B çš„æŽ¥å£ï¼› è¦æ˜¯ç³»ç»Ÿ B æ‰§è¡ŒæˆåŠŸå°± ok äº†ï¼›è¦æ˜¯ç³»ç»Ÿ B æ‰§è¡Œå¤±è´¥äº†ï¼Œé‚£ä¹ˆæœ€å¤§åŠªåŠ›é€šçŸ¥æœåŠ¡å°±å®šæ—¶å°è¯•é‡æ–°è°ƒç”¨ç³»ç»Ÿ Bï¼Œåå¤ N æ¬¡ï¼Œæœ€åŽè¿˜æ˜¯ä¸è¡Œå°±æ”¾å¼ƒã€‚ ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Ÿ å¦‚æžœä½ çœŸçš„è¢«é—®åˆ°ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ï¼Œæˆ‘ä»¬æŸæŸç‰¹åˆ«ä¸¥æ ¼çš„åœºæ™¯ï¼Œç”¨çš„æ˜¯ TCC æ¥ä¿è¯å¼ºä¸€è‡´æ€§ï¼›ç„¶åŽå…¶ä»–çš„ä¸€äº›åœºæ™¯åŸºäºŽé˜¿é‡Œçš„ RocketMQ æ¥å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚ ä½ æ‰¾ä¸€ä¸ªä¸¥æ ¼èµ„é‡‘è¦æ±‚ç»å¯¹ä¸èƒ½é”™çš„åœºæ™¯ï¼Œä½ å¯ä»¥è¯´ä½ æ˜¯ç”¨çš„ TCC æ–¹æ¡ˆï¼›å¦‚æžœæ˜¯ä¸€èˆ¬çš„åˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯ï¼Œè®¢å•æ’å…¥ä¹‹åŽè¦è°ƒç”¨åº“å­˜æœåŠ¡æ›´æ–°åº“å­˜ï¼Œåº“å­˜æ•°æ®æ²¡æœ‰èµ„é‡‘é‚£ä¹ˆçš„æ•æ„Ÿï¼Œå¯ä»¥ç”¨å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆã€‚ å‹æƒ…æç¤ºä¸€ä¸‹ï¼ŒRocketMQ 3.2.6 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæ˜¯å¯ä»¥æŒ‰ç…§ä¸Šé¢çš„æ€è·¯æ¥çš„ï¼Œä½†æ˜¯ä¹‹åŽæŽ¥å£åšäº†ä¸€äº›æ”¹å˜ï¼Œæˆ‘è¿™é‡Œä¸å†èµ˜è¿°äº†ã€‚ å½“ç„¶å¦‚æžœä½ æ„¿æ„ï¼Œä½ å¯ä»¥å‚è€ƒå¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆæ¥è‡ªå·±å®žçŽ°ä¸€å¥—åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæ¯”å¦‚åŸºäºŽ RocketMQ æ¥çŽ©å„¿ã€‚ å‚è€ƒèµ„æ–™ èŠèŠåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå†è¯´è¯´è§£å†³æ–¹æ¡ˆ]]></content>
      <categories>
        <category>design</category>
        <category>distributed</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>distributed</tag>
        <tag>transaction</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼é”]]></title>
    <url>%2Fblog%2F2019%2F06%2F04%2Fdesign%2Fdistributed%2Fdistributed-lock%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼é” Java åŽŸç”Ÿ API è™½ç„¶æœ‰å¹¶å‘é”ï¼Œä½†å¹¶æ²¡æœ‰æä¾›åˆ†å¸ƒå¼é”çš„èƒ½åŠ›ï¼Œæ‰€ä»¥é’ˆå¯¹åˆ†å¸ƒå¼åœºæ™¯ä¸­çš„é”éœ€è¦è§£å†³çš„æ–¹æ¡ˆã€‚ åˆ†å¸ƒå¼é”çš„è§£å†³æ–¹æ¡ˆå¤§è‡´æœ‰ä»¥ä¸‹å‡ ç§ï¼š åŸºäºŽæ•°æ®åº“å®žçŽ° åŸºäºŽç¼“å­˜ï¼ˆredisï¼Œmemcached ç­‰ï¼‰å®žçŽ° åŸºäºŽ Zookeeper å®žçŽ° âœ… æ³¨ï¼šæŽ¨èåŸºäºŽ ZooKeeper å®žçŽ°åˆ†å¸ƒå¼é”ï¼Œå…·ä½“åŽŸå› çœ‹å®Œæœ¬æ–‡å³å¯æ˜Žäº†ã€‚ åˆ†å¸ƒå¼é”æ€è·¯ åˆ†å¸ƒå¼é”çš„æ€»ä½“æ€è·¯å¤§åŒå°å¼‚ï¼Œä»…åœ¨å®žçŽ°ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚ åˆ†å¸ƒå¼é”çš„ä¸»è¦æ€è·¯å¦‚ä¸‹ï¼š äº’æ–¥ - åˆ›å»ºé”å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œè¡¨çŽ°å½¢å¼ä¸ºå‘æ•°æ®å­˜å‚¨æœåŠ¡å™¨æˆ–å®¹å™¨æ’å…¥ä¸€ä¸ªå”¯ä¸€çš„ keyï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªçº¿ç¨‹æ’å…¥è¿™ä¸ª keyï¼Œå…¶ä»–çº¿ç¨‹å°±ä¸èƒ½å†æ’å…¥äº†ã€‚ é¿å…æ°¸è¿œä¸é‡Šæ”¾é” - æ•°æ®åº“åˆ†å¸ƒå¼é”å’Œç¼“å­˜åˆ†å¸ƒå¼é”ï¼ˆRedisï¼‰çš„æ€è·¯éƒ½æ˜¯å¼•å…¥è¶…æ—¶æœºåˆ¶ï¼Œå³æˆåŠŸç”³è¯·é”åŽï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´ï¼Œé”å¤±æ•ˆï¼ˆåˆ é™¤ keyï¼‰ï¼ŒåŽŸå› åœ¨äºŽå®ƒä»¬æ— æ³•æ„ŸçŸ¥ç”³è¯·é”çš„å®¢æˆ·ç«¯èŠ‚ç‚¹çŠ¶æ€ã€‚è€Œ ZooKeeper ç”±äºŽå…¶ znode ä»¥ç›®å½•ã€æ–‡ä»¶å½¢å¼ç»„ç»‡ï¼Œå¤©ç„¶å°±å­˜åœ¨ç‰©ç†ç©ºé—´éš”ç¦»ï¼Œåªè¦ znode å­˜åœ¨ï¼Œå³è¡¨ç¤ºå®¢æˆ·ç«¯èŠ‚ç‚¹è¿˜åœ¨å·¥ä½œï¼Œæ‰€ä»¥ä¸å­˜åœ¨è¿™ç§é—®é¢˜ã€‚ å®¹é”™ï¼ˆåªè¦å¤§éƒ¨åˆ† redis èŠ‚ç‚¹åˆ›å»ºäº†è¿™æŠŠé”å°±å¯ä»¥ï¼‰ æ•°æ®åº“åˆ†å¸ƒå¼é” å…·ä½“å®žçŽ° ï¼ˆ1ï¼‰åˆ›å»ºè¡¨ CREATE TABLE `methodLock` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®', `method_name` varchar(64) NOT NULL DEFAULT '' COMMENT 'é”å®šçš„æ–¹æ³•å', `desc` varchar(1024) NOT NULL DEFAULT 'å¤‡æ³¨ä¿¡æ¯', `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ä¿å­˜æ•°æ®æ—¶é—´ï¼Œè‡ªåŠ¨ç”Ÿæˆ', PRIMARY KEY (`id`), UNIQUE KEY `uidx_method_name` (`method_name `) USING BTREE) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='é”å®šä¸­çš„æ–¹æ³•'; ï¼ˆ2ï¼‰èŽ·å–é” æƒ³è¦é”ä½æŸä¸ªæ–¹æ³•æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹ SQLï¼š insert into methodLock(method_name,desc) values (â€˜method_nameâ€™,â€˜descâ€™) å› ä¸ºæˆ‘ä»¬å¯¹ method_name åšäº†å”¯ä¸€æ€§çº¦æŸï¼Œè¿™é‡Œå¦‚æžœæœ‰å¤šä¸ªè¯·æ±‚åŒæ—¶æäº¤åˆ°æ•°æ®åº“çš„è¯ï¼Œæ•°æ®åº“ä¼šä¿è¯åªæœ‰ä¸€ä¸ªæ“ä½œå¯ä»¥æˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºæ“ä½œæˆåŠŸçš„é‚£ä¸ªçº¿ç¨‹èŽ·å¾—äº†è¯¥æ–¹æ³•çš„é”ï¼Œå¯ä»¥æ‰§è¡Œæ–¹æ³•ä½“å†…å®¹ã€‚ æˆåŠŸæ’å…¥åˆ™èŽ·å–é”ã€‚ ï¼ˆ3ï¼‰é‡Šæ”¾é” å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åŽï¼Œæƒ³è¦é‡Šæ”¾é”çš„è¯ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹ Sql: delete from methodLock where method_name ='method_name' é—®é¢˜ è¿™æŠŠé”å¼ºä¾èµ–æ•°æ®åº“çš„å¯ç”¨æ€§ã€‚å¦‚æžœæ•°æ®åº“æ˜¯ä¸€ä¸ªå•ç‚¹ï¼Œä¸€æ—¦æ•°æ®åº“æŒ‚æŽ‰ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸å¯ç”¨ã€‚ è¿™æŠŠé”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Œä¸€æ—¦è§£é”æ“ä½œå¤±è´¥ï¼Œå°±ä¼šå¯¼è‡´é”è®°å½•ä¸€ç›´åœ¨æ•°æ®åº“ä¸­ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•å†èŽ·å¾—åˆ°é”ã€‚ è¿™æŠŠé”åªèƒ½æ˜¯éžé˜»å¡žçš„ï¼Œå› ä¸ºæ•°æ®çš„ insert æ“ä½œï¼Œä¸€æ—¦æ’å…¥å¤±è´¥å°±ä¼šç›´æŽ¥æŠ¥é”™ã€‚æ²¡æœ‰èŽ·å¾—é”çš„çº¿ç¨‹å¹¶ä¸ä¼šè¿›å…¥æŽ’é˜Ÿé˜Ÿåˆ—ï¼Œè¦æƒ³å†æ¬¡èŽ·å¾—é”å°±è¦å†æ¬¡è§¦å‘èŽ·å¾—é”æ“ä½œã€‚ è¿™æŠŠé”æ˜¯éžé‡å…¥çš„ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰æ— æ³•å†æ¬¡èŽ·å¾—è¯¥é”ã€‚å› ä¸ºæ•°æ®ä¸­æ•°æ®å·²ç»å­˜åœ¨äº†ã€‚ è§£å†³åŠžæ³• å•ç‚¹é—®é¢˜å¯ä»¥ç”¨å¤šæ•°æ®åº“å®žä¾‹ï¼ŒåŒæ—¶å¡ž N ä¸ªè¡¨ï¼ŒN/2+1 ä¸ªæˆåŠŸå°±ä»»åŠ¡é”å®šæˆåŠŸ å†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œéš”ä¸€æ®µæ—¶é—´æ¸…é™¤ä¸€æ¬¡è¿‡æœŸçš„æ•°æ®ã€‚ å†™ä¸€ä¸ª while å¾ªçŽ¯ï¼Œä¸æ–­çš„é‡è¯•æ’å…¥ï¼Œç›´åˆ°æˆåŠŸã€‚ åœ¨æ•°æ®åº“è¡¨ä¸­åŠ ä¸ªå­—æ®µï¼Œè®°å½•å½“å‰èŽ·å¾—é”çš„æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸‹æ¬¡å†èŽ·å–é”çš„æ—¶å€™å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚æžœå½“å‰æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯åœ¨æ•°æ®åº“å¯ä»¥æŸ¥åˆ°çš„è¯ï¼Œç›´æŽ¥æŠŠé”åˆ†é…ç»™ä»–å°±å¯ä»¥äº†ã€‚ å°ç»“ ä¼˜ç‚¹: ç›´æŽ¥å€ŸåŠ©æ•°æ®åº“ï¼Œå®¹æ˜“ç†è§£ã€‚ ç¼ºç‚¹: ä¼šæœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼Œåœ¨è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­ä¼šä½¿æ•´ä¸ªæ–¹æ¡ˆå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚æ“ä½œæ•°æ®åº“éœ€è¦ä¸€å®šçš„å¼€é”€ï¼Œæ€§èƒ½é—®é¢˜éœ€è¦è€ƒè™‘ã€‚ Redis åˆ†å¸ƒå¼é” ç›¸æ¯”äºŽç”¨æ•°æ®åº“æ¥å®žçŽ°åˆ†å¸ƒå¼é”ï¼ŒåŸºäºŽç¼“å­˜å®žçŽ°çš„åˆ†å¸ƒå¼é”çš„æ€§èƒ½ä¼šæ›´å¥½ä¸€äº›ã€‚ç›®å‰æœ‰å¾ˆå¤šæˆç†Ÿçš„åˆ†å¸ƒå¼äº§å“ï¼ŒåŒ…æ‹¬ Redisã€memcacheã€Tair ç­‰ã€‚è¿™é‡Œä»¥ Redis ä¸¾ä¾‹ã€‚ å®žçŽ°æ€è·¯ è¿™ä¸ªåˆ†å¸ƒå¼é”æœ‰ 3 ä¸ªé‡è¦çš„è€ƒé‡ç‚¹ï¼š äº’æ–¥ï¼ˆåªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èŽ·å–é”ï¼‰ ä¸èƒ½æ­»é” å®¹é”™ï¼ˆåªè¦å¤§éƒ¨åˆ† redis èŠ‚ç‚¹åˆ›å»ºäº†è¿™æŠŠé”å°±å¯ä»¥ï¼‰ å¯¹åº”çš„ Redis æŒ‡ä»¤å¦‚ä¸‹ï¼š setnx - setnx key valï¼šå½“ä¸”ä»…å½“ key ä¸å­˜åœ¨æ—¶ï¼Œset ä¸€ä¸ª key ä¸º val çš„å­—ç¬¦ä¸²ï¼Œè¿”å›ž 1ï¼›è‹¥ key å­˜åœ¨ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œè¿”å›ž 0ã€‚ expire - expire key timeoutï¼šä¸º key è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸º secondï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´é”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…æ­»é”ã€‚ delete - delete keyï¼šåˆ é™¤ key å…·ä½“å®žçŽ° ï¼ˆ1ï¼‰ç”³è¯·é” SET resource_name my_random_value NX PX 30000 æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å°± okã€‚ NXï¼šè¡¨ç¤ºåªæœ‰ key ä¸å­˜åœ¨çš„æ—¶å€™æ‰ä¼šè®¾ç½®æˆåŠŸã€‚ï¼ˆå¦‚æžœæ­¤æ—¶ redis ä¸­å­˜åœ¨è¿™ä¸ª keyï¼Œé‚£ä¹ˆè®¾ç½®å¤±è´¥ï¼Œè¿”å›ž nilï¼‰ PX 30000ï¼šæ„æ€æ˜¯ 30s åŽé”è‡ªåŠ¨é‡Šæ”¾ã€‚åˆ«äººåˆ›å»ºçš„æ—¶å€™å¦‚æžœå‘çŽ°å·²ç»æœ‰äº†å°±ä¸èƒ½åŠ é”äº†ã€‚ ï¼ˆ2ï¼‰é‡Šæ”¾é” é‡Šæ”¾é”å°±æ˜¯åˆ é™¤ key ï¼Œä½†æ˜¯ä¸€èˆ¬å¯ä»¥ç”¨ lua è„šæœ¬åˆ é™¤ï¼Œåˆ¤æ–­ value ä¸€æ ·æ‰åˆ é™¤ï¼š -- åˆ é™¤é”çš„æ—¶å€™ï¼Œæ‰¾åˆ° key å¯¹åº”çš„ valueï¼Œè·Ÿè‡ªå·±ä¼ è¿‡åŽ»çš„ value åšæ¯”è¾ƒï¼Œå¦‚æžœæ˜¯ä¸€æ ·çš„æ‰åˆ é™¤ã€‚if redis.call("get",KEYS[1]) == ARGV[1] then return redis.call("del",KEYS[1])else return 0end å°ç»“ ä¸ºå•¥è¦ç”¨ random_value éšæœºå€¼å‘¢ï¼Ÿå› ä¸ºå¦‚æžœæŸä¸ªå®¢æˆ·ç«¯èŽ·å–åˆ°äº†é”ï¼Œä½†æ˜¯é˜»å¡žäº†å¾ˆé•¿æ—¶é—´æ‰æ‰§è¡Œå®Œï¼Œæ¯”å¦‚è¯´è¶…è¿‡äº† 30sï¼Œæ­¤æ—¶å¯èƒ½å·²ç»è‡ªåŠ¨é‡Šæ”¾é”äº†ï¼Œæ­¤æ—¶å¯èƒ½åˆ«çš„å®¢æˆ·ç«¯å·²ç»èŽ·å–åˆ°äº†è¿™ä¸ªé”ï¼Œè¦æ˜¯ä½ è¿™ä¸ªæ—¶å€™ç›´æŽ¥åˆ é™¤ key çš„è¯ä¼šæœ‰é—®é¢˜ï¼Œæ‰€ä»¥å¾—ç”¨éšæœºå€¼åŠ ä¸Šé¢çš„ lua è„šæœ¬æ¥é‡Šæ”¾é”ã€‚ ä½†æ˜¯è¿™æ ·æ˜¯è‚¯å®šä¸è¡Œçš„ã€‚å› ä¸ºå¦‚æžœæ˜¯æ™®é€šçš„ redis å•å®žä¾‹ï¼Œé‚£å°±æ˜¯å•ç‚¹æ•…éšœã€‚æˆ–è€…æ˜¯ redis æ™®é€šä¸»ä»Žï¼Œé‚£ redis ä¸»ä»Žå¼‚æ­¥å¤åˆ¶ï¼Œå¦‚æžœä¸»èŠ‚ç‚¹æŒ‚äº†ï¼ˆkey å°±æ²¡æœ‰äº†ï¼‰ï¼Œkey è¿˜æ²¡åŒæ­¥åˆ°ä»ŽèŠ‚ç‚¹ï¼Œæ­¤æ—¶ä»ŽèŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œåˆ«äººå°±å¯ä»¥ set keyï¼Œä»Žè€Œæ‹¿åˆ°é”ã€‚ RedLock ç®—æ³• è¿™ä¸ªåœºæ™¯æ˜¯å‡è®¾æœ‰ä¸€ä¸ª redis clusterï¼Œæœ‰ 5 ä¸ª redis master å®žä¾‹ã€‚ç„¶åŽæ‰§è¡Œå¦‚ä¸‹æ­¥éª¤èŽ·å–ä¸€æŠŠé”ï¼š èŽ·å–å½“å‰æ—¶é—´æˆ³ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼› è·Ÿä¸Šé¢ç±»ä¼¼ï¼Œè½®æµå°è¯•åœ¨æ¯ä¸ª master èŠ‚ç‚¹ä¸Šåˆ›å»ºé”ï¼Œè¿‡æœŸæ—¶é—´è¾ƒçŸ­ï¼Œä¸€èˆ¬å°±å‡ åæ¯«ç§’ï¼› å°è¯•åœ¨å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šå»ºç«‹ä¸€ä¸ªé”ï¼Œæ¯”å¦‚ 5 ä¸ªèŠ‚ç‚¹å°±è¦æ±‚æ˜¯ 3 ä¸ªèŠ‚ç‚¹ n / 2 + 1ï¼› å®¢æˆ·ç«¯è®¡ç®—å»ºç«‹å¥½é”çš„æ—¶é—´ï¼Œå¦‚æžœå»ºç«‹é”çš„æ—¶é—´å°äºŽè¶…æ—¶æ—¶é—´ï¼Œå°±ç®—å»ºç«‹æˆåŠŸäº†ï¼› è¦æ˜¯é”å»ºç«‹å¤±è´¥äº†ï¼Œé‚£ä¹ˆå°±ä¾æ¬¡ä¹‹å‰å»ºç«‹è¿‡çš„é”åˆ é™¤ï¼› åªè¦åˆ«äººå»ºç«‹äº†ä¸€æŠŠåˆ†å¸ƒå¼é”ï¼Œä½ å°±å¾—ä¸æ–­è½®è¯¢åŽ»å°è¯•èŽ·å–é”ã€‚ Redis å®˜æ–¹ç»™å‡ºäº†ä»¥ä¸Šä¸¤ç§åŸºäºŽ Redis å®žçŽ°åˆ†å¸ƒå¼é”çš„æ–¹æ³•ï¼Œè¯¦ç»†è¯´æ˜Žå¯ä»¥æŸ¥çœ‹ï¼šhttps://redis.io/topics/distlock ã€‚ ZooKeeper åˆ†å¸ƒå¼é” å®žçŽ°æ€è·¯ è¿™ä¹Ÿæ˜¯ ZooKeeper å®¢æˆ·ç«¯ curator çš„åˆ†å¸ƒå¼é”å®žçŽ°ã€‚ åˆ›å»ºä¸€ä¸ªç›®å½• mylockï¼› çº¿ç¨‹ A æƒ³èŽ·å–é”å°±åœ¨ mylock ç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼› èŽ·å– mylock ç›®å½•ä¸‹æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œç„¶åŽèŽ·å–æ¯”è‡ªå·±å°çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œå¦‚æžœä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜Žå½“å‰çº¿ç¨‹é¡ºåºå·æœ€å°ï¼ŒèŽ·å¾—é”ï¼› çº¿ç¨‹ B èŽ·å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œåˆ¤æ–­è‡ªå·±ä¸æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œè®¾ç½®ç›‘å¬æ¯”è‡ªå·±æ¬¡å°çš„èŠ‚ç‚¹ï¼› çº¿ç¨‹ A å¤„ç†å®Œï¼Œåˆ é™¤è‡ªå·±çš„èŠ‚ç‚¹ï¼Œçº¿ç¨‹ B ç›‘å¬åˆ°å˜æ›´äº‹ä»¶ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œå¦‚æžœæ˜¯åˆ™èŽ·å¾—é”ã€‚ å…·ä½“å®žçŽ° /** * ZooKeeperSession * * @author bingo * @since 2018/11/29 * */public class ZooKeeperSession &#123; private static CountDownLatch connectedSemaphore = new CountDownLatch(1); private ZooKeeper zookeeper; private CountDownLatch latch; public ZooKeeperSession() &#123; try &#123; this.zookeeper = new ZooKeeper("192.168.31.187:2181,192.168.31.19:2181,192.168.31.227:2181", 50000, new ZooKeeperWatcher()); try &#123; connectedSemaphore.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("ZooKeeper session established......"); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; /** * èŽ·å–åˆ†å¸ƒå¼é” * * @param productId */ public Boolean acquireDistributedLock(Long productId) &#123; String path = "/product-lock-" + productId; try &#123; zookeeper.create(path, "".getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL); return true; &#125; catch (Exception e) &#123; while (true) &#123; try &#123; // ç›¸å½“äºŽæ˜¯ç»™nodeæ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ï¼ŒåŽ»çœ‹çœ‹è¿™ä¸ªç›‘å¬å™¨æ˜¯å¦å­˜åœ¨ Stat stat = zk.exists(path, true); if (stat != null) &#123; this.latch = new CountDownLatch(1); this.latch.await(waitTime, TimeUnit.MILLISECONDS); this.latch = null; &#125; zookeeper.create(path, "".getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL); return true; &#125; catch (Exception ee) &#123; continue; &#125; &#125; &#125; return true; &#125; /** * é‡Šæ”¾æŽ‰ä¸€ä¸ªåˆ†å¸ƒå¼é” * * @param productId */ public void releaseDistributedLock(Long productId) &#123; String path = "/product-lock-" + productId; try &#123; zookeeper.delete(path, -1); System.out.println("release the lock for product[id=" + productId + "]......"); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; /** * å»ºç«‹zk sessionçš„watcher * * @author bingo * @since 2018/11/29 * */ private class ZooKeeperWatcher implements Watcher &#123; public void process(WatchedEvent event) &#123; System.out.println("Receive watched event: " + event.getState()); if (KeeperState.SyncConnected == event.getState()) &#123; connectedSemaphore.countDown(); &#125; if (this.latch != null) &#123; this.latch.countDown(); &#125; &#125; &#125; /** * å°è£…å•ä¾‹çš„é™æ€å†…éƒ¨ç±» * * @author bingo * @since 2018/11/29 * */ private static class Singleton &#123; private static ZooKeeperSession instance; static &#123; instance = new ZooKeeperSession(); &#125; public static ZooKeeperSession getInstance() &#123; return instance; &#125; &#125; /** * èŽ·å–å•ä¾‹ * * @return */ public static ZooKeeperSession getInstance() &#123; return Singleton.getInstance(); &#125; /** * åˆå§‹åŒ–å•ä¾‹çš„ä¾¿æ·æ–¹æ³• */ public static void init() &#123; getInstance(); &#125;&#125; ä¹Ÿå¯ä»¥é‡‡ç”¨å¦ä¸€ç§æ–¹å¼ï¼Œåˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼š å¦‚æžœæœ‰ä¸€æŠŠé”ï¼Œè¢«å¤šä¸ªäººç»™ç«žäº‰ï¼Œæ­¤æ—¶å¤šä¸ªäººä¼šæŽ’é˜Ÿï¼Œç¬¬ä¸€ä¸ªæ‹¿åˆ°é”çš„äººä¼šæ‰§è¡Œï¼Œç„¶åŽé‡Šæ”¾é”ï¼›åŽé¢çš„æ¯ä¸ªäººéƒ½ä¼šåŽ»ç›‘å¬æŽ’åœ¨è‡ªå·±å‰é¢çš„é‚£ä¸ªäººåˆ›å»ºçš„ node ä¸Šï¼Œä¸€æ—¦æŸä¸ªäººé‡Šæ”¾äº†é”ï¼ŒæŽ’åœ¨è‡ªå·±åŽé¢çš„äººå°±ä¼šè¢« zookeeper ç»™é€šçŸ¥ï¼Œä¸€æ—¦è¢«é€šçŸ¥äº†ä¹‹åŽï¼Œå°± ok äº†ï¼Œè‡ªå·±å°±èŽ·å–åˆ°äº†é”ï¼Œå°±å¯ä»¥æ‰§è¡Œä»£ç äº†ã€‚ public class ZooKeeperDistributedLock implements Watcher &#123; private ZooKeeper zk; private String locksRoot = "/locks"; private String productId; private String waitNode; private String lockNode; private CountDownLatch latch; private CountDownLatch connectedLatch = new CountDownLatch(1); private int sessionTimeout = 30000; public ZooKeeperDistributedLock(String productId) &#123; this.productId = productId; try &#123; String address = "192.168.31.187:2181,192.168.31.19:2181,192.168.31.227:2181"; zk = new ZooKeeper(address, sessionTimeout, this); connectedLatch.await(); &#125; catch (IOException e) &#123; throw new LockException(e); &#125; catch (KeeperException e) &#123; throw new LockException(e); &#125; catch (InterruptedException e) &#123; throw new LockException(e); &#125; &#125; public void process(WatchedEvent event) &#123; if (event.getState() == KeeperState.SyncConnected) &#123; connectedLatch.countDown(); return; &#125; if (this.latch != null) &#123; this.latch.countDown(); &#125; &#125; public void acquireDistributedLock() &#123; try &#123; if (this.tryLock()) &#123; return; &#125; else &#123; waitForLock(waitNode, sessionTimeout); &#125; &#125; catch (KeeperException e) &#123; throw new LockException(e); &#125; catch (InterruptedException e) &#123; throw new LockException(e); &#125; &#125; public boolean tryLock() &#123; try &#123; // ä¼ å…¥è¿›åŽ»çš„locksRoot + â€œ/â€ + productId // å‡è®¾productIdä»£è¡¨äº†ä¸€ä¸ªå•†å“idï¼Œæ¯”å¦‚è¯´1 // locksRoot = locks // /locks/10000000000ï¼Œ/locks/10000000001ï¼Œ/locks/10000000002 lockNode = zk.create(locksRoot + "/" + productId, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL); // çœ‹çœ‹åˆšåˆ›å»ºçš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ // locksï¼š10000000000ï¼Œ10000000001ï¼Œ10000000002 List&lt;String&gt; locks = zk.getChildren(locksRoot, false); Collections.sort(locks); if(lockNode.equals(locksRoot+"/"+ locks.get(0)))&#123; //å¦‚æžœæ˜¯æœ€å°çš„èŠ‚ç‚¹,åˆ™è¡¨ç¤ºå–å¾—é” return true; &#125; //å¦‚æžœä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°æ¯”è‡ªå·±å°1çš„èŠ‚ç‚¹ int previousLockIndex = -1; for(int i = 0; i &lt; locks.size(); i++) &#123; if(lockNode.equals(locksRoot + â€œ/â€ + locks.get(i))) &#123; previousLockIndex = i - 1; break; &#125; &#125; this.waitNode = locks.get(previousLockIndex); &#125; catch (KeeperException e) &#123; throw new LockException(e); &#125; catch (InterruptedException e) &#123; throw new LockException(e); &#125; return false; &#125; private boolean waitForLock(String waitNode, long waitTime) throws InterruptedException, KeeperException &#123; Stat stat = zk.exists(locksRoot + "/" + waitNode, true); if (stat != null) &#123; this.latch = new CountDownLatch(1); this.latch.await(waitTime, TimeUnit.MILLISECONDS); this.latch = null; &#125; return true; &#125; public void unlock() &#123; try &#123; // åˆ é™¤/locks/10000000000èŠ‚ç‚¹ // åˆ é™¤/locks/10000000001èŠ‚ç‚¹ System.out.println("unlock " + lockNode); zk.delete(lockNode, -1); lockNode = null; zk.close(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (KeeperException e) &#123; e.printStackTrace(); &#125; &#125; public class LockException extends RuntimeException &#123; private static final long serialVersionUID = 1L; public LockException(String e) &#123; super(e); &#125; public LockException(Exception e) &#123; super(e); &#125; &#125;&#125; å°ç»“ ZooKeeper ç‰ˆæœ¬çš„åˆ†å¸ƒå¼é”é—®é¢˜ç›¸å¯¹æ¯”è¾ƒæ¥è¯´å°‘ã€‚ é”çš„å ç”¨æ—¶é—´é™åˆ¶ï¼šredis å°±æœ‰å ç”¨æ—¶é—´é™åˆ¶ï¼Œè€Œ ZooKeeper åˆ™æ²¡æœ‰ï¼Œæœ€ä¸»è¦çš„åŽŸå› æ˜¯ redis ç›®å‰æ²¡æœ‰åŠžæ³•çŸ¥é“å·²ç»èŽ·å–é”çš„å®¢æˆ·ç«¯çš„çŠ¶æ€ï¼Œæ˜¯å·²ç»æŒ‚äº†å‘¢è¿˜æ˜¯æ­£åœ¨æ‰§è¡Œè€—æ—¶è¾ƒé•¿çš„ä¸šåŠ¡é€»è¾‘ã€‚è€Œ ZooKeeper é€šè¿‡ä¸´æ—¶èŠ‚ç‚¹å°±èƒ½æ¸…æ™°çŸ¥é“ï¼Œå¦‚æžœä¸´æ—¶èŠ‚ç‚¹å­˜åœ¨è¯´æ˜Žè¿˜åœ¨æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æžœä¸´æ—¶èŠ‚ç‚¹ä¸å­˜åœ¨è¯´æ˜Žå·²ç»æ‰§è¡Œå®Œæ¯•é‡Šæ”¾é”æˆ–è€…æ˜¯æŒ‚äº†ã€‚ç”±æ­¤çœ‹æ¥ redis å¦‚æžœèƒ½åƒ ZooKeeper ä¸€æ ·æ·»åŠ ä¸€äº›ä¸Žå®¢æˆ·ç«¯ç»‘å®šçš„ä¸´æ—¶é”®ï¼Œä¹Ÿæ˜¯ä¸€å¤§å¥½äº‹ã€‚ æ˜¯å¦å•ç‚¹æ•…éšœï¼šredis æœ¬èº«æœ‰å¾ˆå¤šä¸­çŽ©æ³•ï¼Œå¦‚å®¢æˆ·ç«¯ä¸€è‡´æ€§ hashï¼ŒæœåŠ¡å™¨ç«¯ sentinel æ–¹æ¡ˆæˆ–è€… cluster æ–¹æ¡ˆï¼Œå¾ˆéš¾åšåˆ°ä¸€ç§åˆ†å¸ƒå¼é”æ–¹å¼èƒ½åº”å¯¹æ‰€æœ‰è¿™äº›æ–¹æ¡ˆã€‚è€Œ ZooKeeper åªæœ‰ä¸€ç§çŽ©æ³•ï¼Œå¤šå°æœºå™¨çš„èŠ‚ç‚¹æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œæ²¡æœ‰ redis çš„é‚£ä¹ˆå¤šçš„éº»çƒ¦å› ç´ è¦è€ƒè™‘ã€‚ æ€»ä½“ä¸Šæ¥è¯´ ZooKeeper å®žçŽ°åˆ†å¸ƒå¼é”æ›´åŠ çš„ç®€å•ï¼Œå¯é æ€§æ›´é«˜ã€‚ä½† ZooKeeper å› ä¸ºéœ€è¦é¢‘ç¹çš„åˆ›å»ºå’Œåˆ é™¤èŠ‚ç‚¹ï¼Œæ€§èƒ½ä¸Šä¸å¦‚ Redis æ–¹å¼ã€‚ åˆ†å¸ƒå¼é”æ–¹æ¡ˆå¯¹æ¯” æ•°æ®åº“åˆ†å¸ƒå¼é”ï¼Œé—®é¢˜æ¯”è¾ƒå¤šï¼Œè§£å†³èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä¸æŽ¨è redis åˆ†å¸ƒå¼é”ï¼Œå…¶å®žéœ€è¦è‡ªå·±ä¸æ–­åŽ»å°è¯•èŽ·å–é”ï¼Œæ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚ zk åˆ†å¸ƒå¼é”ï¼ŒèŽ·å–ä¸åˆ°é”ï¼Œæ³¨å†Œä¸ªç›‘å¬å™¨å³å¯ï¼Œä¸éœ€è¦ä¸æ–­ä¸»åŠ¨å°è¯•èŽ·å–é”ï¼Œæ€§èƒ½å¼€é”€è¾ƒå°ã€‚ å¦å¤–ä¸€ç‚¹å°±æ˜¯ï¼Œå¦‚æžœæ˜¯ redis èŽ·å–é”çš„é‚£ä¸ªå®¢æˆ·ç«¯å‡ºçŽ° bug æŒ‚äº†ï¼Œé‚£ä¹ˆåªèƒ½ç­‰å¾…è¶…æ—¶æ—¶é—´ä¹‹åŽæ‰èƒ½é‡Šæ”¾é”ï¼›è€Œ zk çš„è¯ï¼Œå› ä¸ºåˆ›å»ºçš„æ˜¯ä¸´æ—¶ znodeï¼Œåªè¦å®¢æˆ·ç«¯æŒ‚äº†ï¼Œznode å°±æ²¡äº†ï¼Œæ­¤æ—¶å°±è‡ªåŠ¨é‡Šæ”¾é”ã€‚ æ€»ä½“ä¸Šæ¥è¯´ï¼ŒZooKeeper å®žçŽ°åˆ†å¸ƒå¼é”æ›´åŠ çš„ç®€å•ï¼Œå¯é æ€§æ›´é«˜ã€‚ å‚è€ƒèµ„æ–™ åˆ†å¸ƒå¼é”å®žçŽ°æ±‡æ€»]]></content>
      <categories>
        <category>design</category>
        <category>distributed</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>distributed</tag>
        <tag>lock</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼ä¼šè¯]]></title>
    <url>%2Fblog%2F2019%2F06%2F04%2Fdesign%2Fdistributed%2Fdistributed-session%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼ä¼šè¯ æ¦‚å¿µ ä»€ä¹ˆæ˜¯ Sessionï¼Ÿ session æ˜¯å•¥ï¼Ÿæµè§ˆå™¨æœ‰ä¸ª cookieï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…è¿™ä¸ª cookie éƒ½å­˜åœ¨ï¼Œç„¶åŽæ¯æ¬¡å‘è¯·æ±‚è¿‡æ¥éƒ½å¸¦ä¸Šä¸€ä¸ªç‰¹æ®Šçš„ jsessionid cookieï¼Œå°±æ ¹æ®è¿™ä¸ªä¸œè¥¿ï¼Œåœ¨æœåŠ¡ç«¯å¯ä»¥ç»´æŠ¤ä¸€ä¸ªå¯¹åº”çš„ session åŸŸï¼Œé‡Œé¢å¯ä»¥æ”¾ç‚¹æ•°æ®ã€‚ ä¸€èˆ¬çš„è¯åªè¦ä½ æ²¡å…³æŽ‰æµè§ˆå™¨ï¼Œcookie è¿˜åœ¨ï¼Œé‚£ä¹ˆå¯¹åº”çš„é‚£ä¸ª session å°±åœ¨ï¼Œä½†æ˜¯å¦‚æžœ cookie æ²¡äº†ï¼Œsession ä¹Ÿå°±æ²¡äº†ã€‚å¸¸è§äºŽä»€ä¹ˆè´­ç‰©è½¦ä¹‹ç±»çš„ä¸œè¥¿ï¼Œè¿˜æœ‰ç™»å½•çŠ¶æ€ä¿å­˜ä¹‹ç±»çš„ã€‚ ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ Sessionï¼Ÿ åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªç”¨æˆ·çš„ Session å¦‚æžœåªå­˜å‚¨åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆå½“è´Ÿè½½å‡è¡¡å™¨æŠŠç”¨æˆ·çš„ä¸‹ä¸€ä¸ªè¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¯¥æœåŠ¡å™¨æ²¡æœ‰ç”¨æˆ·çš„ Sessionï¼Œå°±å¯èƒ½å¯¼è‡´ç”¨æˆ·éœ€è¦é‡æ–°è¿›è¡Œç™»å½•ç­‰æ“ä½œã€‚ åˆ†å¸ƒå¼ Session çš„å‡ ç§å®žçŽ°ç­–ç•¥ï¼š ç²˜æ€§ session åº”ç”¨æœåŠ¡å™¨é—´çš„ session å¤åˆ¶å…±äº« åŸºäºŽç¼“å­˜çš„ session å…±äº« âœ… æŽ¨èï¼šåŸºäºŽç¼“å­˜çš„ session å…±äº« ç²˜æ€§ Session ç²˜æ€§ Sessionï¼ˆSticky Sessionsï¼‰éœ€è¦é…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼Œä½¿å¾—ä¸€ä¸ªç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚éƒ½è·¯ç”±åˆ°ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥æŠŠç”¨æˆ·çš„ Session å­˜æ”¾åœ¨è¯¥æœåŠ¡å™¨èŠ‚ç‚¹ä¸­ã€‚ ç¼ºç‚¹ï¼šå½“æœåŠ¡å™¨èŠ‚ç‚¹å®•æœºæ—¶ï¼Œå°†ä¸¢å¤±è¯¥æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ Sessionã€‚ session å¤åˆ¶å…±äº« Session å¤åˆ¶å…±äº«ï¼ˆSession Replicationï¼‰åœ¨æœåŠ¡å™¨èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œ Session åŒæ­¥æ“ä½œï¼Œè¿™æ ·çš„è¯ç”¨æˆ·å¯ä»¥è®¿é—®ä»»ä½•ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ã€‚ ç¼ºç‚¹ï¼šå ç”¨è¿‡å¤šå†…å­˜ï¼›åŒæ­¥è¿‡ç¨‹å ç”¨ç½‘ç»œå¸¦å®½ä»¥åŠæœåŠ¡å™¨å¤„ç†å™¨æ—¶é—´ã€‚ åŸºäºŽç¼“å­˜çš„ session å…±äº« ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„å­˜å‚¨æœåŠ¡å™¨å­˜å‚¨ Session æ•°æ®ï¼Œå¯ä»¥å­˜åœ¨ MySQL æ•°æ®åº“ä¸Šï¼Œä¹Ÿå¯ä»¥å­˜åœ¨ Redis æˆ–è€… Memcached è¿™ç§å†…å­˜åž‹æ•°æ®åº“ã€‚ ç¼ºç‚¹ï¼šéœ€è¦åŽ»å®žçŽ°å­˜å– Session çš„ä»£ç ã€‚ å…·ä½“å®žçŽ° JWT Token ä½¿ç”¨ JWT Token å‚¨å­˜ç”¨æˆ·èº«ä»½ï¼Œç„¶åŽå†ä»Žæ•°æ®åº“æˆ–è€… cache ä¸­èŽ·å–å…¶ä»–çš„ä¿¡æ¯ã€‚è¿™æ ·æ— è®ºè¯·æ±‚åˆ†é…åˆ°å“ªä¸ªæœåŠ¡å™¨éƒ½æ— æ‰€è°“ã€‚ tomcat + redis è¿™ä¸ªå…¶å®žè¿˜æŒºæ–¹ä¾¿çš„ï¼Œå°±æ˜¯ä½¿ç”¨ session çš„ä»£ç ï¼Œè·Ÿä»¥å‰ä¸€æ ·ï¼Œè¿˜æ˜¯åŸºäºŽ tomcat åŽŸç”Ÿçš„ session æ”¯æŒå³å¯ï¼Œç„¶åŽå°±æ˜¯ç”¨ä¸€ä¸ªå«åš Tomcat RedisSessionManager çš„ä¸œè¥¿ï¼Œè®©æ‰€æœ‰æˆ‘ä»¬éƒ¨ç½²çš„ tomcat éƒ½å°† session æ•°æ®å­˜å‚¨åˆ° redis å³å¯ã€‚ åœ¨ tomcat çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š &lt;Valve className="com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve" /&gt;&lt;Manager className="com.orangefunction.tomcat.redissessions.RedisSessionManager" host="&#123;redis.host&#125;" port="&#123;redis.port&#125;" database="&#123;redis.dbnum&#125;" maxInactiveInterval="60"/&gt; ç„¶åŽæŒ‡å®š redis çš„ host å’Œ port å°± ok äº†ã€‚ &lt;Valve className="com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve" /&gt;&lt;Manager className="com.orangefunction.tomcat.redissessions.RedisSessionManager" sentinelMaster="mymaster" sentinels="&lt;sentinel1-ip&gt;:26379,&lt;sentinel2-ip&gt;:26379,&lt;sentinel3-ip&gt;:26379" maxInactiveInterval="60"/&gt; è¿˜å¯ä»¥ç”¨ä¸Šé¢è¿™ç§æ–¹å¼åŸºäºŽ redis å“¨å…µæ”¯æŒçš„ redis é«˜å¯ç”¨é›†ç¾¤æ¥ä¿å­˜ session æ•°æ®ï¼Œéƒ½æ˜¯ ok çš„ã€‚ spring session + redis ä¸Šé¢é‚£ç§ tomcat + redis çš„æ–¹å¼å¥½ç”¨ï¼Œä½†æ˜¯ä¼šä¸¥é‡ä¾èµ–äºŽ web å®¹å™¨ï¼Œä¸å¥½å°†ä»£ç ç§»æ¤åˆ°å…¶ä»– web å®¹å™¨ä¸ŠåŽ»ï¼Œå°¤å…¶æ˜¯ä½ è¦æ˜¯æ¢äº†æŠ€æœ¯æ ˆå’‹æ•´ï¼Ÿæ¯”å¦‚æ¢æˆäº† spring cloud æˆ–è€…æ˜¯ spring boot ä¹‹ç±»çš„å‘¢ï¼Ÿ æ‰€ä»¥çŽ°åœ¨æ¯”è¾ƒå¥½çš„è¿˜æ˜¯åŸºäºŽ Java ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯ springã€‚äººå®¶ spring åŸºæœ¬ä¸Šæ‰¿åŒ…äº†å¤§éƒ¨åˆ†æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„æ¡†æž¶ï¼Œspirng cloud åšå¾®æœåŠ¡ï¼Œspring boot åšè„šæ‰‹æž¶ï¼Œæ‰€ä»¥ç”¨ sping session æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ åœ¨ pom.xml ä¸­é…ç½®ï¼š &lt;dependency&gt; &lt;groupId&gt;org.springframework.session&lt;/groupId&gt; &lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt; &lt;version&gt;1.2.1.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.8.1&lt;/version&gt;&lt;/dependency&gt; åœ¨ spring é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š &lt;bean id="redisHttpSessionConfiguration" class="org.springframework.session.data.redis.config.annotation.web.http.RedisHttpSessionConfiguration"&gt; &lt;property name="maxInactiveIntervalInSeconds" value="600"/&gt;&lt;/bean&gt;&lt;bean id="jedisPoolConfig" class="redis.clients.jedis.JedisPoolConfig"&gt; &lt;property name="maxTotal" value="100" /&gt; &lt;property name="maxIdle" value="10" /&gt;&lt;/bean&gt;&lt;bean id="jedisConnectionFactory" class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory" destroy-method="destroy"&gt; &lt;property name="hostName" value="$&#123;redis_hostname&#125;"/&gt; &lt;property name="port" value="$&#123;redis_port&#125;"/&gt; &lt;property name="password" value="$&#123;redis_pwd&#125;" /&gt; &lt;property name="timeout" value="3000"/&gt; &lt;property name="usePool" value="true"/&gt; &lt;property name="poolConfig" ref="jedisPoolConfig"/&gt;&lt;/bean&gt; åœ¨ web.xml ä¸­é…ç½®ï¼š &lt;filter&gt; &lt;filter-name&gt;springSessionRepositoryFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;springSessionRepositoryFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt; ç¤ºä¾‹ä»£ç ï¼š @RestController@RequestMapping("/test")public class TestController &#123; @RequestMapping("/putIntoSession") public String putIntoSession(HttpServletRequest request, String username) &#123; request.getSession().setAttribute("name", "leo"); return "ok"; &#125; @RequestMapping("/getFromSession") public String getFromSession(HttpServletRequest request, Model model)&#123; String name = request.getSession().getAttribute("name"); return name; &#125;&#125; ä¸Šé¢çš„ä»£ç å°±æ˜¯ ok çš„ï¼Œç»™ sping session é…ç½®åŸºäºŽ redis æ¥å­˜å‚¨ session æ•°æ®ï¼Œç„¶åŽé…ç½®äº†ä¸€ä¸ª spring session çš„è¿‡æ»¤å™¨ï¼Œè¿™æ ·çš„è¯ï¼Œsession ç›¸å…³æ“ä½œéƒ½ä¼šäº¤ç»™ spring session æ¥ç®¡äº†ã€‚æŽ¥ç€åœ¨ä»£ç ä¸­ï¼Œå°±ç”¨åŽŸç”Ÿçš„ session æ“ä½œï¼Œå°±æ˜¯ç›´æŽ¥åŸºäºŽ spring sesion ä»Ž redis ä¸­èŽ·å–æ•°æ®äº†ã€‚ å®žçŽ°åˆ†å¸ƒå¼çš„ä¼šè¯æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæˆ‘è¯´çš„åªä¸è¿‡æ˜¯æ¯”è¾ƒå¸¸è§çš„å‡ ç§æ–¹å¼ï¼Œtomcat + redis æ—©æœŸæ¯”è¾ƒå¸¸ç”¨ï¼Œä½†æ˜¯ä¼šé‡è€¦åˆåˆ° tomcat ä¸­ï¼›è¿‘äº›å¹´ï¼Œé€šè¿‡ spring session æ¥å®žçŽ°ã€‚ å‚è€ƒèµ„æ–™ é›†ç¾¤/åˆ†å¸ƒå¼çŽ¯å¢ƒ Session çš„å‡ ç§ç­–ç•¥]]></content>
      <categories>
        <category>design</category>
        <category>distributed</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>distributed</tag>
        <tag>session</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Title]]></title>
    <url>%2Fblog%2F2019%2F03%2F08%2Fdesign%2Farchitecture%2FREADME%2F</url>
    <content type="text"><![CDATA[æž¶æž„è®¾è®¡ æž¶æž„è®¾è®¡æ˜¯ä¸ºä¸šåŠ¡æœåŠ¡ï¼Œè„±ç¦»ä¸šåŠ¡å®žé™…çš„æž¶æž„è®¾è®¡éƒ½æ˜¯çº¸ä¸Šè°ˆå…µã€‚ æž¶æž„è®¾è®¡éœ€è¦æ ¹æ®æž¶æž„å¸ˆè‡ªèº«çš„ç»éªŒï¼Œåœ¨å®žçŽ°ä¸šåŠ¡åŠŸèƒ½ã€æ€§èƒ½ã€æ‰©å±•æ€§ã€ç³»ç»Ÿå¤æ‚åº¦ç­‰ç»´åº¦ä¸Šç»¼åˆè€ƒé‡ä»¥åŠæƒè¡¡ã€‚è€Œæž¶æž„è®¾è®¡çš„ç»éªŒéœ€è¦æž¶æž„å¸ˆä¸æ–­çš„å­¦ä¹ ã€ä¸æ–­çš„ç§¯ç´¯ã€‚æ€§èƒ½ã€æ‰©å±•æ€§ã€ç³»ç»Ÿå¤æ‚åº¦ç­‰æ–¹é¢æœ‰å¾ˆå¤šä¸ªä¸“é¢˜ï¼Œæœ‰å¿…è¦é’ˆå¯¹æ¯ä¸ªä¸“é¢˜ç”±æµ…å…¥æ·±çš„åŽ»ç†è§£ã€æŽŒæ¡ã€‚ ä¸“é¢˜ å¦‚ä½•è®¾è®¡ ç¬¬ä¸€æ­¥ï¼šéœ€æ±‚åˆ†æž éœ€æ±‚åˆ†æžé˜¶æ®µï¼Œè¦åšçš„å°±æ˜¯åˆ†æžä½¿ç”¨åœºæ™¯ï¼Œçº¦æŸå’Œå‡è®¾ã€‚ è¿™ä¸ªé˜¶æ®µï¼Œåº”è¯¥ä»¥å®¡è§†çš„è§’åº¦ï¼Œä¸æ–­æé—®ã€æ±‚è¯ï¼Œä»¥æŒ–æŽ˜ç”¨æˆ·çœŸå®žçš„éœ€æ±‚ã€‚ ç³»ç»Ÿæ˜¯ä»€ä¹ˆï¼Ÿç³»ç»Ÿæœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ è°æ˜¯ç³»ç»Ÿçš„ç”¨æˆ·ç¾¤ä½“ï¼Ÿç”¨æˆ·ç¾¤ä½“çš„è§„æ¨¡æ˜¯å¤šå¤§ï¼Ÿ ç³»ç»Ÿçš„è¾“å…¥è¾“å‡ºåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç³»ç»Ÿå¸Œæœ›å¤„ç†å¤šå°‘æ•°æ®ï¼Ÿ ç³»ç»Ÿå¸Œæœ›æ¯ç§’é’Ÿå¤„ç†å¤šå°‘è¯·æ±‚ï¼Ÿ ç³»ç»Ÿå¸Œæœ›çš„è¯»å†™æ¯”çŽ‡ï¼Ÿ ç¬¬äºŒæ­¥ï¼šæ¦‚è¦è®¾è®¡ åˆ›é€ ä¸€ä¸ªé«˜å±‚çº§çš„è®¾è®¡ ç¬¬ä¸‰æ­¥ï¼šè¯¦ç»†è®¾è®¡ æ•°æ®åº“é€‰åž‹ï¼šSQL è¿˜æ˜¯ NOSQL æ•°æ®åº“æ¨¡åž‹ API å’Œé¢å‘å¯¹è±¡è®¾è®¡ ç¬¬å››æ­¥ï¼šæ‰©å±•è®¾è®¡ è´Ÿè½½å‡è¡¡ æ°´å¹³æ‰©å±• ç¼“å­˜ æ•°æ®åº“åˆ†ç‰‡ æ¶ˆæ¯é˜Ÿåˆ— æ‰©å±•é˜…è¯» å‚è€ƒèµ„æ–™ æ–‡ç«  ç³»ç»Ÿè®¾è®¡å…¥é—¨]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HBase ç»´æŠ¤]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fbigdata%2Fhbase%2Fhbase-ops%2F</url>
    <content type="text"><![CDATA[HBase ç»´æŠ¤ é…ç½®æ–‡ä»¶ çŽ¯å¢ƒè¦æ±‚ å¼•ç”¨å’Œå¼•ç”³ å¼•ç”³ é…ç½®æ–‡ä»¶ backup-masters - é»˜è®¤æƒ…å†µä¸‹ä¸å­˜åœ¨ã€‚åˆ—å‡ºä¸»æœåŠ¡å™¨åº”åœ¨å…¶ä¸Šå¯åŠ¨å¤‡ä»½ä¸»è¿›ç¨‹çš„ä¸»æœºï¼Œæ¯è¡Œä¸€ä¸ªä¸»æœºã€‚ hadoop-metrics2-hbase.properties - ç”¨äºŽè¿žæŽ¥ HBase Hadoop çš„ Metrics2 æ¡†æž¶ã€‚ hbase-env.cmd and hbase-env.sh - ç”¨äºŽ Windows å’Œ Linux / Unix çŽ¯å¢ƒçš„è„šæœ¬ï¼Œç”¨äºŽè®¾ç½® HBase çš„å·¥ä½œçŽ¯å¢ƒï¼ŒåŒ…æ‹¬ Javaï¼ŒJava é€‰é¡¹å’Œå…¶ä»–çŽ¯å¢ƒå˜é‡çš„ä½ç½®ã€‚ hbase-policy.xml - RPC æœåŠ¡å™¨ç”¨äºŽå¯¹å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡ŒæŽˆæƒå†³ç­–çš„é»˜è®¤ç­–ç•¥é…ç½®æ–‡ä»¶ã€‚ä»…åœ¨å¯ç”¨ HBase å®‰å…¨æ€§æ—¶ä½¿ç”¨ã€‚ hbase-site.xml - ä¸»è¦çš„ HBase é…ç½®æ–‡ä»¶ã€‚æ­¤æ–‡ä»¶æŒ‡å®šè¦†ç›– HBase é»˜è®¤é…ç½®çš„é…ç½®é€‰é¡¹ã€‚æ‚¨å¯ä»¥åœ¨ docs / hbase-default.xml ä¸­æŸ¥çœ‹ï¼ˆä½†ä¸è¦ç¼–è¾‘ï¼‰é»˜è®¤é…ç½®æ–‡ä»¶ã€‚æ‚¨è¿˜å¯ä»¥åœ¨ HBase Web UI çš„ HBase é…ç½®é€‰é¡¹å¡ä¸­æŸ¥çœ‹ç¾¤é›†çš„æ•´ä¸ªæœ‰æ•ˆé…ç½®ï¼ˆé»˜è®¤å€¼å’Œè¦†ç›–ï¼‰ã€‚ log4j.properties - log4j æ—¥å¿—é…ç½®ã€‚ regionservers - åŒ…å«åº”åœ¨ HBase é›†ç¾¤ä¸­è¿è¡Œ RegionServer çš„ä¸»æœºåˆ—è¡¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤æ–‡ä»¶åŒ…å«å•ä¸ªæ¡ç›® localhostã€‚å®ƒåº”åŒ…å«ä¸»æœºåæˆ– IP åœ°å€åˆ—è¡¨ï¼Œæ¯è¡Œä¸€ä¸ªï¼Œå¹¶ä¸”å¦‚æžœç¾¤é›†ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å°†åœ¨å…¶ localhost æŽ¥å£ä¸Šè¿è¡Œ RegionServerï¼Œåˆ™åº”ä»…åŒ…å« localhostã€‚ çŽ¯å¢ƒè¦æ±‚ Java HBase 2.0+ è¦æ±‚ JDK8+ HBase 1.2+ è¦æ±‚ JDK7+ SSH - çŽ¯å¢ƒè¦æ”¯æŒ SSH DNS - çŽ¯å¢ƒä¸­è¦åœ¨ hosts é…ç½®æœ¬æœº hostname å’Œæœ¬æœº IP NTP - HBase é›†ç¾¤çš„æ—¶é—´è¦åŒæ­¥ï¼Œå¯ä»¥é…ç½®ç»Ÿä¸€çš„ NTP å¹³å° - ç”Ÿäº§çŽ¯å¢ƒä¸æŽ¨èéƒ¨ç½²åœ¨ Windows ç³»ç»Ÿä¸­ Hadoop - ä¾èµ– Hadoop é…å¥—ç‰ˆæœ¬ Zookeeper - ä¾èµ– Zookeeper é…å¥—ç‰ˆæœ¬ è¿è¡Œæ¨¡å¼ å•ç‚¹ hbase-site.xml é…ç½®å¦‚ä¸‹ï¼š &lt;configuration&gt; &lt;property&gt; &lt;name&gt;hbase.rootdir&lt;/name&gt; &lt;value&gt;hdfs://namenode.example.org:8020/hbase&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.cluster.distributed&lt;/name&gt; &lt;value&gt;false&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; åˆ†å¸ƒå¼ hbase-site.xm é…ç½®å¦‚ä¸‹ï¼š &lt;configuration&gt; &lt;property&gt; &lt;name&gt;hbase.rootdir&lt;/name&gt; &lt;value&gt;hdfs://namenode.example.org:8020/hbase&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.cluster.distributed&lt;/name&gt; &lt;value&gt;true&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt; &lt;value&gt;node-a.example.com,node-b.example.com,node-c.example.com&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; å¼•ç”¨å’Œå¼•ç”³ æ‰©å±•é˜…è¯» Apache HBase Configuration]]></content>
  </entry>
  <entry>
    <title><![CDATA[é¡¹ç›®è§„èŒƒ]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fmethod%2Fproject-style%2F</url>
    <content type="text"><![CDATA[é¡¹ç›®è§„èŒƒ è½¯ä»¶é¡¹ç›®å¼€å‘è§„èŒƒã€‚ é¡¹ç›®ç»“æž„ ç›®å½• æ–‡ä»¶ å‘½åè§„åˆ™ ç›®å½•å æ–‡ä»¶å Java æ—¥å¿—è§„èŒƒ å‚è€ƒèµ„æ–™ é¡¹ç›®ç»“æž„ ä»¥ä¸‹ä¸ºé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œç›®å½•çš„ç»„ç»‡ç»“æž„ï¼š ç›®å½• codes - ä»£ç ç›®å½•ã€‚ configurations - é…ç½®ç›®å½•ã€‚ä¸€èˆ¬å­˜æ”¾é¡¹ç›®ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚å¦‚ maven çš„ settings.xmlï¼Œnginx çš„ nginx.conf ç­‰ã€‚ demos - ç¤ºä¾‹ç›®å½•ã€‚ docs - æ–‡æ¡£ç›®å½•ã€‚ libs - ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶ã€‚ scripts - è„šæœ¬ç›®å½•ã€‚ä¸€èˆ¬å­˜æ”¾ç”¨äºŽå¯åŠ¨ã€æž„å»ºé¡¹ç›®çš„å¯æ‰§è¡Œè„šæœ¬æ–‡ä»¶ã€‚ packages - æ‰“åŒ…æ–‡ä»¶ç›®å½•ã€‚Java é¡¹ç›®ä¸­å¯èƒ½æ˜¯ jarã€war ç­‰ï¼›å‰ç«¯é¡¹ç›®ä¸­å¯èƒ½æ˜¯ zipã€rar ç­‰ï¼›ç”µå­ä¹¦é¡¹ç›®ä¸­å¯èƒ½æ˜¯ pdf ç­‰ã€‚ æ–‡ä»¶ .gitignore - git å¿½ç•¥è§„åˆ™ã€‚ .gitattributes - git å±žæ€§è§„åˆ™ã€‚ .editorconfig - ç¼–è¾‘å™¨ä¹¦å†™è§„åˆ™ã€‚ README.md - é¡¹ç›®è¯´æ˜Žæ–‡ä»¶ã€‚ LICENSE - å¼€æºåè®®ã€‚å¦‚æžœé¡¹ç›®æ˜¯å¼€æºæ–‡ä»¶ï¼Œéœ€è¦æ·»åŠ ã€‚ å‘½åè§„åˆ™ ç›®å½•å ç›®å½•åå¿…é¡»ä½¿ç”¨åŠè§’å­—ç¬¦ï¼Œä¸å¾—ä½¿ç”¨å…¨è§’å­—ç¬¦ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œä¸­æ–‡ä¸èƒ½ç”¨äºŽæ–‡ä»¶åã€‚ ç›®å½•åå»ºè®®åªä½¿ç”¨å°å†™å­—æ¯ï¼Œä¸ä½¿ç”¨å¤§å†™å­—æ¯ã€‚ ä¸ä½³ï¼š Testæ­£ç¡®ï¼š test ç›®å½•åå¯ä»¥ä½¿ç”¨æ•°å­—ï¼Œä½†ä¸åº”è¯¥æ˜¯é¦–å­—ç¬¦ã€‚ ä¸ä½³ï¼š 1-demoæ­£ç¡®ï¼š demo1 ç›®å½•ååŒ…å«å¤šä¸ªå•è¯æ—¶ï¼Œå•è¯ä¹‹é—´å»ºè®®ä½¿ç”¨åŠè§’çš„è¿žè¯çº¿ï¼ˆ-ï¼‰åˆ†éš”ã€‚ ä¸ä½³ï¼š common_demoæ­£ç¡®ï¼š common-demo æ–‡ä»¶å æ–‡æ¡£çš„æ–‡ä»¶åä¸å¾—å«æœ‰ç©ºæ ¼ã€‚ æ–‡ä»¶åå¿…é¡»ä½¿ç”¨åŠè§’å­—ç¬¦ï¼Œä¸å¾—ä½¿ç”¨å…¨è§’å­—ç¬¦ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œä¸­æ–‡ä¸èƒ½ç”¨äºŽæ–‡ä»¶åã€‚ é”™è¯¯ï¼š åè¯è§£é‡Š.mdæ­£ç¡®ï¼š glossary.md æ–‡ä»¶åå»ºè®®åªä½¿ç”¨å°å†™å­—æ¯ï¼Œä¸ä½¿ç”¨å¤§å†™å­—æ¯ã€‚ é”™è¯¯ï¼šTroubleShooting.mdæ­£ç¡®ï¼štroubleshooting.md ä¸ºäº†é†’ç›®ï¼ŒæŸäº›è¯´æ˜Žæ–‡ä»¶çš„æ–‡ä»¶åï¼Œå¯ä»¥ä½¿ç”¨å¤§å†™å­—æ¯ï¼Œæ¯”å¦‚READMEã€LICENSEã€‚ ä¸€äº›çº¦å®šä¿—æˆçš„ä¹ æƒ¯å¯ä»¥ä¿æŒä¼ ç»Ÿå†™æ³•ï¼Œå¦‚ï¼šJava çš„æ–‡ä»¶åä¸€èˆ¬ä½¿ç”¨é©¼å³°å‘½åæ³•ï¼Œä¸”é¦–å­—æ¯å¤§å†™ï¼›é…ç½®æ–‡ä»¶ applicationContext.xml ï¼›React ä¸­çš„ JSX ç»„ä»¶æ–‡ä»¶åä¸€èˆ¬ä½¿ç”¨é©¼å³°å‘½åæ³•ï¼Œä¸”é¦–å­—æ¯å¤§å†™ç­‰ã€‚ æ–‡ä»¶ååŒ…å«å¤šä¸ªå•è¯æ—¶ï¼Œå•è¯ä¹‹é—´å»ºè®®ä½¿ç”¨åŠè§’çš„è¿žè¯çº¿ï¼ˆ-ï¼‰åˆ†éš”ã€‚ ä¸ä½³ï¼šadvanced_usage.mdæ­£ç¡®ï¼šadvanced-usage.md Java æ—¥å¿—è§„èŒƒ è¿™é‡ŒåŸºäºŽé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œæ—¥å¿—è§„çº¦ç« èŠ‚ï¼Œç»“åˆè‡ªå·±çš„å¼€å‘ç»éªŒåšäº†ä¸€äº›å¢žåˆ å’Œè°ƒæ•´ã€‚ ã€å¼ºåˆ¶ã€‘åº”ç”¨ä¸­ä¸å¯ç›´æŽ¥ä½¿ç”¨æ—¥å¿—ç³»ç»Ÿï¼ˆLog4jã€Logbackï¼‰ä¸­çš„ APIï¼Œè€Œåº”ä¾èµ–ä½¿ç”¨æ—¥å¿—æ¡†æž¶ SLF4J ä¸­çš„ APIï¼Œä½¿ç”¨é—¨é¢æ¨¡å¼çš„æ—¥å¿—æ¡†æž¶ï¼Œæœ‰åˆ©äºŽç»´æŠ¤å’Œå„ä¸ªç±»çš„æ—¥å¿—å¤„ç†æ–¹å¼ç»Ÿä¸€ã€‚ import org.slf4j.Logger;import org.slf4j.LoggerFactory;private static final Logger logger = LoggerFactory.getLogger(Abc.class); ã€å¼ºåˆ¶ã€‘æ—¥å¿—æ–‡ä»¶æŽ¨èè‡³å°‘ä¿å­˜ 30 å¤©ï¼Œå› ä¸ºæœ‰äº›å¼‚å¸¸å…·å¤‡ä»¥â€œå‘¨â€ä¸ºé¢‘æ¬¡å‘ç”Ÿçš„ç‰¹ç‚¹ã€‚ ã€å¼ºåˆ¶ã€‘åº”ç”¨ä¸­çš„æ‰©å±•æ—¥å¿—ï¼ˆå¦‚æ‰“ç‚¹ã€ä¸´æ—¶ç›‘æŽ§ã€è®¿é—®æ—¥å¿—ç­‰ï¼‰å‘½åæ–¹å¼ï¼šappName_logType_logName.logã€‚logType:æ—¥å¿—ç±»åž‹ï¼ŒæŽ¨èåˆ†ç±»æœ‰ stats/desc/monitor/visit ç­‰ï¼›logName:æ—¥å¿—æè¿°ã€‚è¿™ç§å‘½åçš„å¥½å¤„ï¼šé€šè¿‡æ–‡ä»¶åå°±å¯çŸ¥é“æ—¥å¿—æ–‡ä»¶å±žäºŽä»€ä¹ˆåº”ç”¨ï¼Œä»€ä¹ˆç±»åž‹ï¼Œä»€ä¹ˆç›®çš„ï¼Œä¹Ÿæœ‰åˆ©äºŽå½’ç±»æŸ¥æ‰¾ã€‚ æ­£ä¾‹ï¼šmppserver åº”ç”¨ä¸­å•ç‹¬ç›‘æŽ§æ—¶åŒºè½¬æ¢å¼‚å¸¸ï¼Œå¦‚ï¼šmppserver_monitor_timeZoneConvert.log è¯´æ˜Žï¼šæŽ¨èå¯¹æ—¥å¿—è¿›è¡Œåˆ†ç±»ï¼Œå¦‚å°†é”™è¯¯æ—¥å¿—å’Œä¸šåŠ¡æ—¥å¿—åˆ†å¼€å­˜æ”¾ï¼Œä¾¿äºŽå¼€å‘äººå‘˜æŸ¥çœ‹ï¼Œä¹Ÿä¾¿äºŽé€šè¿‡æ—¥å¿—å¯¹ç³»ç»Ÿè¿›è¡ŒåŠæ—¶ç›‘æŽ§ã€‚ ã€å¼ºåˆ¶ã€‘å¯¹ trace/debug/info çº§åˆ«çš„æ—¥å¿—è¾“å‡ºï¼Œå¿…é¡»ä½¿ç”¨æ¡ä»¶è¾“å‡ºå½¢å¼æˆ–è€…ä½¿ç”¨å ä½ç¬¦çš„æ–¹å¼ã€‚ è¯´æ˜Žï¼šlogger.debug(&quot;Processing trade with id: &quot; + id + &quot; and symbol: &quot; + symbol); å¦‚æžœæ—¥å¿—çº§åˆ«æ˜¯ warnï¼Œä¸Šè¿°æ—¥å¿—ä¸ä¼šæ‰“å°ï¼Œä½†æ˜¯ä¼šæ‰§è¡Œå­—ç¬¦ä¸²æ‹¼æŽ¥æ“ä½œï¼Œå¦‚æžœ symbol æ˜¯å¯¹è±¡ï¼Œä¼šæ‰§è¡Œ toString()æ–¹æ³•ï¼Œæµªè´¹äº†ç³»ç»Ÿèµ„æºï¼Œæ‰§è¡Œäº†ä¸Šè¿°æ“ä½œï¼Œæœ€ç»ˆæ—¥å¿—å´æ²¡æœ‰æ‰“å°ã€‚ æ­£ä¾‹ï¼šï¼ˆæ¡ä»¶ï¼‰ if (logger.isDebugEnabled()) &#123;logger.debug("Processing trade with id: " + id + " and symbol: " + symbol);&#125; æ­£ä¾‹ï¼šï¼ˆå ä½ç¬¦ï¼‰ logger.debug("Processing trade with id: &#123;&#125; and symbol : &#123;&#125; ", id, symbol); ã€å¼ºåˆ¶ã€‘é¿å…é‡å¤æ‰“å°æ—¥å¿—ï¼Œæµªè´¹ç£ç›˜ç©ºé—´ã€‚åŠ¡å¿…åœ¨ log4j.xml æˆ– logback.xml ä¸­è®¾ç½® additivity=falseã€‚ æ­£ä¾‹ï¼š &lt;logger name="com.taobao.dubbo.config" additivity="false"&gt; ã€å¼ºåˆ¶ã€‘å¼‚å¸¸ä¿¡æ¯åº”è¯¥åŒ…æ‹¬ä¸¤ç±»ä¿¡æ¯ï¼šæ¡ˆå‘çŽ°åœºä¿¡æ¯å’Œå¼‚å¸¸å †æ ˆä¿¡æ¯ã€‚å¦‚æžœä¸å¤„ç†ï¼Œé‚£ä¹ˆé€šè¿‡å…³é”®å­— throws å¾€ä¸ŠæŠ›å‡ºã€‚ æ­£ä¾‹ï¼šlogger.error(å„ç±»å‚æ•°æˆ–è€…å¯¹è±¡ toString + â€œ_â€ + e.getMessage(), e); ã€å¼ºåˆ¶ã€‘æ—¥å¿—æ ¼å¼éµå¾ªå¦‚ä¸‹æ ¼å¼ï¼š æ‰“å°å‡ºçš„æ—¥å¿—ä¿¡æ¯å¦‚ï¼š 2018-03-29 15:06:57.277 [javalib] [main] [TRACE] i.g.dunwu.javalib.log.LogbackDemo#main - è¿™æ˜¯ä¸€æ¡ trace æ—¥å¿—è®°å½•2018-03-29 15:06:57.282 [javalib] [main] [DEBUG] i.g.dunwu.javalib.log.LogbackDemo#main - è¿™æ˜¯ä¸€æ¡ debug æ—¥å¿—è®°å½•2018-03-29 15:06:57.282 [javalib] [main] [INFO] i.g.dunwu.javalib.log.LogbackDemo#main - è¿™æ˜¯ä¸€æ¡ info æ—¥å¿—è®°å½•2018-03-29 15:06:57.282 [javalib] [main] [WARN] i.g.dunwu.javalib.log.LogbackDemo#main - è¿™æ˜¯ä¸€æ¡ warn æ—¥å¿—è®°å½•2018-03-29 15:06:57.282 [javalib] [main] [ERROR] i.g.dunwu.javalib.log.LogbackDemo#main - è¿™æ˜¯ä¸€æ¡ error æ—¥å¿—è®°å½• ã€å‚è€ƒã€‘slf4j æ”¯æŒçš„æ—¥å¿—çº§åˆ«ï¼ŒæŒ‰ç…§çº§åˆ«ä»Žä½Žåˆ°é«˜ï¼Œåˆ†åˆ«ä¸ºï¼štrace &lt; debug &lt; info &lt; warn &lt; errorã€‚ å»ºè®®åªä½¿ç”¨ debug &lt; info &lt; warn &lt; error å››ä¸ªçº§åˆ«ã€‚ error æ—¥å¿—çº§åˆ«åªè®°å½•ç³»ç»Ÿé€»è¾‘å‡ºé”™ã€å¼‚å¸¸ç­‰é‡è¦çš„é”™è¯¯ä¿¡æ¯ã€‚å¦‚éžå¿…è¦ï¼Œè¯·ä¸è¦åœ¨æ­¤åœºæ™¯æ‰“å‡º error çº§åˆ«ã€‚ warn æ—¥å¿—çº§åˆ«è®°å½•ç”¨æˆ·è¾“å…¥å‚æ•°é”™è¯¯çš„æƒ…å†µï¼Œé¿å…ç”¨æˆ·æŠ•è¯‰æ—¶ï¼Œæ— æ‰€é€‚ä»Žã€‚ info æ—¥å¿—çº§åˆ«è®°å½•ä¸šåŠ¡é€»è¾‘ä¸­ä¸€äº›é‡è¦æ­¥éª¤ä¿¡æ¯ã€‚ debug æ—¥å¿—çº§åˆ«è®°å½•ä¸€äº›ç”¨äºŽè°ƒè¯•çš„ä¿¡æ¯ã€‚ ã€å‚è€ƒã€‘æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹æ¡†æž¶æˆ–åº“çš„æ—¥å¿—å¯¹äºŽæŽ’æŸ¥é—®é¢˜å…·æœ‰ä¸€å®šçš„å¸®åŠ©ï¼Œå¦‚ Springã€Dubboã€Mybatis ç­‰ã€‚è¿™äº›æ¡†æž¶æ‰€ä½¿ç”¨çš„æ—¥å¿—åº“æœªå¿…å’Œæœ¬é¡¹ç›®ä¸€æ ·ï¼Œä¸ºäº†é¿å…å‡ºçŽ°æ—¥å¿—æ— æ³•è¾“å‡ºçš„é—®é¢˜ï¼Œè¯·å¼•å…¥å¯¹åº”çš„æ¡¥æŽ¥ jar åŒ…ã€‚ å‚è€ƒèµ„æ–™ é˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œæ—¥å¿—è§„çº¦ç« èŠ‚]]></content>
      <categories>
        <category>method</category>
      </categories>
      <tags>
        <tag>method</tag>
        <tag>project</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç›®å½•è§„èŒƒ]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fmethod%2Fdir-style%2F</url>
    <content type="text"><![CDATA[ç›®å½•è§„èŒƒ 1. ç›®å½•ç»“æž„è§„èŒƒ 2. æ–‡ä»¶ç®¡ç†è½¯ä»¶ 2.1. Clover 2.2. Everything 2.3. Wox 2.4. Q-dir 1. ç›®å½•ç»“æž„è§„èŒƒ ä½œä¸ºç¨‹åºå‘˜ï¼Œæƒ³å¿…æ¯ä¸ªäººéƒ½ä¼šæœ‰å¤§é‡çš„èµ„æ–™ã€æ•°æ®ã€‚æŒ‰ç…§æ¡ç†æ¸…æ™°çš„ç›®å½•ç»“æž„åŽ»åˆ†ç±»åŒ–å­˜å‚¨ï¼Œååˆ†æœ‰åŠ©äºŽç®¡ç†æ–‡ä»¶ã€‚ ä»¥ä¸‹æ˜¯æˆ‘ä¸ªäººæ•´ç†çš„ç›®å½•ç»“æž„ï¼š .â”œâ”€â”€ Codes #ä»£ç ç›®å½•â”‚ â”œâ”€â”€ Other #ç¬¬ä¸‰æ–¹ä»£ç ç›®å½•â”‚ â”œâ”€â”€ My #ä¸ªäººä»£ç ç›®å½•â”‚ â””â”€â”€ Work #å·¥ä½œä»£ç ç›®å½•â”œâ”€â”€ Data #æ•°æ®ç›®å½•â”œâ”€â”€ Downloads #ä¸‹è½½æ–‡ä»¶ç›®å½•â”œâ”€â”€ Docs #æ–‡æ¡£ç›®å½•â”‚ â”œâ”€â”€ Books #ç”µå­ä¹¦ç›®å½•â”‚ â”œâ”€â”€ My #ä¸ªäººæ–‡æ¡£ç›®å½•â”‚ â””â”€â”€ Work #å·¥ä½œæ–‡æ¡£ç›®å½•â”œâ”€â”€ Movies #è§†é¢‘ç›®å½•â”œâ”€â”€ Music #éŸ³ä¹ç›®å½•â”œâ”€â”€ Pictures #å›¾ç‰‡ç›®å½•â”œâ”€â”€ Public #å…±äº«ç›®å½•â”œâ”€â”€ Temp #ä¸´æ—¶æ–‡ä»¶ç›®å½•â””â”€â”€ Tools #å·¥å…·è½¯ä»¶ç›®å½• â””â”€â”€ Packages #å®‰è£…åŒ…ç›®å½• æ³¨ï¼šå¦‚æžœæ‚¨ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿæ˜¯ Mac è¿™ç§å¯ä»¥ä¸ºç›®å½•æˆ–æ–‡ä»¶æ·»åŠ  tag çš„æ“ä½œç³»ç»Ÿï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½æ›´ç»†è‡´åŒ–çš„ç®¡ç†ã€‚ 2. æ–‡ä»¶ç®¡ç†è½¯ä»¶ é€‰ç”¨ä¾¿åˆ©çš„æ–‡ä»¶ç®¡ç†è½¯ä»¶ï¼Œå¯ä»¥è®©ä½ çš„æ–‡ä»¶ç®¡ç†å¦‚è™Žæ·»ç¿¼ã€‚è¿™é‡ŒæŽ¨èå‡ æ¬¾ç»å…¸çš„æ–‡ä»¶ç®¡ç†å·¥å…·ã€‚ 2.1. Clover Clover æ˜¯ Windows Explorer èµ„æºç®¡ç†å™¨çš„ä¸€ä¸ªæ‰©å±•ï¼Œä¸ºå…¶å¢žåŠ ç±»ä¼¼è°·æ­Œ Chrome æµè§ˆå™¨çš„å¤šæ ‡ç­¾é¡µåŠŸèƒ½ã€‚ 2.2. Everything Everything å¯ä»¥ç«‹å³åœ¨ windows ç³»ç»Ÿä¸­æ‰¾åˆ°åˆ¶å®šåç§°çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚ 2.3. Wox Wox æ˜¯ä¸€æ¬¾ç®€å•æ˜“ç”¨çš„ Windows å¯åŠ¨å™¨ã€‚å¯ä»¥æŠŠå®ƒè§†ä¸º windows ç‰ˆçš„ Alfredã€‚ 2.4. Q-dir Q-dir æ˜¯è½»é‡çš„æ–‡ä»¶ç®¡ç†å™¨,ç‰¹ç‚¹é²œæ˜Ž,å„ç§å¸ƒå±€è§†å›¾åˆ‡æ¢çµæ´»,é»˜è®¤å››ä¸ªå°çª—å£ç»„æˆä¸€ä¸ªå¤§çª—å£,æ“ä½œå¿«æ·ã€‚]]></content>
      <categories>
        <category>method</category>
      </categories>
      <tags>
        <tag>method</tag>
        <tag>doc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¡ç®—æœºç½‘ç»œä¹‹æ•°æ®é“¾è·¯å±‚]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fcommunication%2Fnetwork-data-link%2F</url>
    <content type="text"><![CDATA[è®¡ç®—æœºç½‘ç»œä¹‹æ•°æ®é“¾è·¯å±‚ æ•°æ®é“¾è·¯å±‚ï¼ˆData Link Layerï¼‰ - ç½‘ç»œå±‚é’ˆå¯¹çš„è¿˜æ˜¯ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œè€Œä¸»æœºä¹‹é—´å¯ä»¥æœ‰å¾ˆå¤šé“¾è·¯ï¼Œé“¾è·¯å±‚åè®®å°±æ˜¯ä¸ºåŒä¸€é“¾è·¯çš„ä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚æ•°æ®é“¾è·¯å±‚æŠŠç½‘ç»œå±‚ä¼ ä¸‹æ¥çš„åˆ†ç»„å°è£…æˆå¸§ã€‚ ä¸»è¦åè®®ï¼šPPPã€CSMA/CD ç­‰ã€‚ æ•°æ®å•å…ƒï¼šå¸§ï¼ˆframeï¼‰ã€‚ å…¸åž‹è®¾å¤‡ï¼šäºŒå±‚äº¤æ¢æœºã€ç½‘æ¡¥ã€ç½‘å¡ã€‚ ç®€ä»‹ åŸºæœ¬é—®é¢˜ å°è£…æˆå¸§ é€æ˜Žä¼ è¾“ å·®é”™æ£€æµ‹ ç‚¹å¯¹ç‚¹ä¿¡é“ PPP åè®® å¹¿æ’­ä¿¡é“ CSMA/CD åè®® å±€åŸŸç½‘ ä»¥å¤ªç½‘ MAC åœ°å€ è®¾å¤‡ é€‚é…å™¨ é›†çº¿å™¨ ç½‘æ¡¥ ä»¥å¤ªç½‘äº¤æ¢æœº ç®€ä»‹ é“¾è·¯æ˜¯ä»Žä¸€ä¸ªèŠ‚ç‚¹åˆ°ç›¸é‚»èŠ‚ç‚¹çš„ä¸€æ®µç‰©ç†çº¿è·¯ï¼Œæ•°æ®é“¾è·¯åˆ™æ˜¯åœ¨é“¾è·¯çš„åŸºç¡€ä¸Šå¢žåŠ äº†ä¸€äº›å¿…è¦çš„ç¡¬ä»¶ï¼ˆç½‘ç»œé€‚é…å™¨ï¼‰å’Œè½¯ä»¶ï¼ˆåè®®ï¼‰ã€‚ æ•°æ®é“¾è·¯å±‚ä¸‰ä¸ªåŸºæœ¬é—®é¢˜ï¼šå°è£…æˆå¸§ã€é€æ˜Žä¼ è¾“ã€å·®é”™æ£€æµ‹ã€‚ æ•°æ®é“¾è·¯å±‚æœ‰ä¸¤ç§ä¿¡é“ç±»åž‹ï¼šç‚¹å¯¹ç‚¹ä¿¡é“ï¼ˆä¸»è¦ä½¿ç”¨ PPPï¼‰å’Œå¹¿æ’­ä¿¡é“ï¼ˆä¸»è¦ä½¿ç”¨ CSMA/CDï¼‰ã€‚ ä»¥å¤ªç½‘ MAC å±‚çš„åœ°å€ã€‚ é€‚é…å™¨ã€è½¬å‘å™¨ã€é›†çº¿å™¨ã€ç½‘æ¡¥ã€ä»¥å¤ªç½‘äº¤æ¢æœºçš„ä½œç”¨åŠä½¿ç”¨åœºåˆã€‚ åŸºæœ¬é—®é¢˜ å°è£…æˆå¸§ ä¸ºç½‘ç»œå±‚ä¼ ä¸‹æ¥çš„ IP æ•°æ®æŠ¥æ·»åŠ é¦–éƒ¨å’Œå°¾éƒ¨ï¼Œç”¨äºŽæ ‡è®°å¸§çš„å¼€å§‹å’Œç»“æŸã€‚ ä¸ºäº†æé«˜ä¼ è¾“æ•ˆçŽ‡ï¼Œåº”è¯¥è®©æ•°æ®éƒ¨åˆ†é•¿åº¦å°½å¯èƒ½å¤§äºŽé¦–éƒ¨å’Œå°¾éƒ¨ã€‚ä½†æ˜¯ï¼Œæ¯ç§é“¾è·¯å±‚åè®®éƒ½é™åˆ¶äº†å¸§çš„æ•°æ®éƒ¨åˆ†é•¿åº¦ä¸Šçº¿â€”â€”æœ€å¤§ä¼ é€å•å…ƒ MTUï¼ˆMaximum Transfer Unitï¼‰ é€æ˜Žä¼ è¾“ é€æ˜Žè¡¨ç¤ºï¼šæŸä¸€ä¸ªå®žé™…å­˜åœ¨çš„äº‹ç‰©çœ‹èµ·æ¥å¥½åƒä¸å­˜åœ¨ä¸€æ ·ã€‚ å¸§ä½¿ç”¨é¦–éƒ¨å’Œå°¾éƒ¨è¿›è¡Œå®šç•Œï¼Œå¦‚æžœå¸§çš„æ•°æ®éƒ¨åˆ†å«æœ‰å’Œé¦–éƒ¨å°¾éƒ¨ç›¸åŒçš„å†…å®¹ï¼Œé‚£ä¹ˆå¸§çš„å¼€å§‹å’Œç»“æŸä½ç½®å°±ä¼šè¢«é”™è¯¯çš„åˆ¤å®šã€‚éœ€è¦åœ¨æ•°æ®éƒ¨åˆ†å‡ºçŽ°é¦–éƒ¨å°¾éƒ¨ç›¸åŒçš„å†…å®¹å‰é¢æ’å…¥è½¬ä¹‰å­—ç¬¦ã€‚å¦‚æžœæ•°æ®éƒ¨åˆ†å‡ºçŽ°è½¬ä¹‰å­—ç¬¦ï¼Œé‚£ä¹ˆå°±åœ¨è½¬ä¹‰å­—ç¬¦å‰é¢å†åŠ ä¸ªè½¬ä¹‰å­—ç¬¦ã€‚åœ¨æŽ¥æ”¶ç«¯è¿›è¡Œå¤„ç†ä¹‹åŽå¯ä»¥è¿˜åŽŸå‡ºåŽŸå§‹æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹é€æ˜Žä¼ è¾“çš„å†…å®¹æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œç”¨æˆ·å¯Ÿè§‰ä¸åˆ°è½¬ä¹‰å­—ç¬¦çš„å­˜åœ¨ã€‚ å·®é”™æ£€æµ‹ ç›®å‰æ•°æ®é“¾è·¯å±‚å¹¿æ³›ä½¿ç”¨äº†å¾ªçŽ¯å†—ä½™æ£€éªŒ CRCï¼ˆCyclic redundancy checkï¼‰æ¥æ£€æŸ¥æ¯”ç‰¹å·®é”™ã€‚ ç‚¹å¯¹ç‚¹ä¿¡é“ ç‚¹å¯¹ç‚¹ä¿¡é“ä½¿ç”¨ä¸€å¯¹ä¸€çš„ç‚¹å¯¹ç‚¹é€šä¿¡æ–¹å¼ã€‚ å¯¹äºŽç‚¹å¯¹ç‚¹çš„é“¾è·¯ï¼Œç‚¹å¯¹ç‚¹åè®® PPPï¼ˆPoint-to-Point Protocolï¼‰æ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„æ•°æ®é“¾è·¯å±‚åè®®ã€‚ PPP åè®® äº’è”ç½‘ç”¨æˆ·é€šå¸¸éƒ½è¦è¿žæŽ¥åˆ°æŸä¸ª ISP ä¹‹åŽæ‰èƒ½æŽ¥å…¥åˆ°äº’è”ç½‘ï¼ŒPPP åè®®æ˜¯ç”¨æˆ·è®¡ç®—æœºå’Œ ISP è¿›è¡Œé€šä¿¡æ—¶æ‰€ä½¿ç”¨çš„æ•°æ®é“¾è·¯å±‚åè®®ã€‚ PPPï¼ˆç‚¹åˆ°ç‚¹åè®®ï¼‰æ˜¯ä¸ºåœ¨åŒç­‰å•å…ƒä¹‹é—´ä¼ è¾“æ•°æ®åŒ…è¿™æ ·çš„ç®€å•é“¾è·¯è®¾è®¡çš„é“¾è·¯å±‚åè®®ã€‚è¿™ç§é“¾è·¯æä¾›å…¨åŒå·¥æ“ä½œï¼Œå¹¶æŒ‰ç…§é¡ºåºä¼ é€’æ•°æ®åŒ…ã€‚è®¾è®¡ç›®çš„ä¸»è¦æ˜¯ç”¨æ¥é€šè¿‡æ‹¨å·æˆ–ä¸“çº¿æ–¹å¼å»ºç«‹ç‚¹å¯¹ç‚¹è¿žæŽ¥å‘é€æ•°æ®ï¼Œä½¿å…¶æˆä¸ºå„ç§ä¸»æœºã€ç½‘æ¡¥å’Œè·¯ç”±å™¨ä¹‹é—´ç®€å•è¿žæŽ¥çš„ä¸€ç§å…±é€šçš„è§£å†³æ–¹æ¡ˆã€‚ PPP çš„å¸§æ ¼å¼ï¼š F å­—æ®µä¸ºå¸§çš„å®šç•Œç¬¦ A å’Œ C å­—æ®µæš‚æ—¶æ²¡æœ‰æ„ä¹‰ FCS å­—æ®µæ˜¯ä½¿ç”¨ CRC çš„æ£€éªŒåºåˆ— ä¿¡æ¯éƒ¨åˆ†çš„é•¿åº¦ä¸è¶…è¿‡ 1500 å¹¿æ’­ä¿¡é“ å¹¿æ’­ä¿¡é“(broadcast channel)æ˜¯é€šè¿‡å¹¿æ’­çš„æ–¹å¼ä¼ è¾“ä¿¡æ¯çš„ä¿¡æ¯é€šé“ã€‚ æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½åœ¨åŒä¸€ä¸ªå¹¿æ’­ä¿¡é“ä¸Šå‘é€æ•°æ®ï¼Œå› æ­¤éœ€è¦æœ‰ä¸“é—¨çš„æŽ§åˆ¶æ–¹æ³•è¿›è¡Œåè°ƒï¼Œé¿å…å‘ç”Ÿå†²çªï¼ˆå†²çªä¹Ÿå«ç¢°æ’žï¼‰ã€‚ ä¸»è¦æœ‰ä¸¤ç§æŽ§åˆ¶æ–¹æ³•è¿›è¡Œåè°ƒï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨ä¿¡é“å¤ç”¨æŠ€æœ¯ï¼Œä¸€æ˜¯ä½¿ç”¨ CSMA/CD åè®®ã€‚ CSMA/CD åè®® CSMA/CDï¼ˆCarrier Sense Multiple Access with Collision Detectionï¼‰å³å¸¦å†²çªæ£€æµ‹çš„è½½æ³¢ç›‘å¬å¤šè·¯è®¿é—®æŠ€æœ¯(è½½æ³¢ç›‘å¬å¤šç‚¹æŽ¥å…¥/ç¢°æ’žæ£€æµ‹)ã€‚ å¤šç‚¹æŽ¥å…¥ ï¼šè¯´æ˜Žè¿™æ˜¯æ€»çº¿åž‹ç½‘ç»œï¼Œè®¸å¤šè®¡ç®—æœºä»¥å¤šç‚¹æŽ¥å…¥çš„æ–¹å¼è¿žæŽ¥åœ¨ä¸€æ ¹æ€»çº¿ä¸Šã€‚ è½½æ³¢ç›‘å¬ ï¼šæ¯ä¸ªä¸»æœºéƒ½å¿…é¡»ä¸åœåœ°ç›‘å¬ä¿¡é“ã€‚å‘é€å‰ç›‘å¬ï¼Œå¦‚æžœå¿™åˆ™ç­‰å¾…ï¼Œå¦‚æžœç©ºé—²åˆ™å‘é€ã€‚ ç¢°æ’žæ£€æµ‹ ï¼šå³è¾¹å‘é€è¾¹æ£€æµ‹ã€‚è‹¥æ£€æµ‹åˆ°ä¿¡é“æœ‰å¹²æ‰°ä¿¡å·ï¼Œåˆ™è¡¨ç¤ºäº§ç”Ÿäº†ç¢°æ’žï¼ŒäºŽæ˜¯å°±è¦åœæ­¢å‘é€æ•°æ®ï¼Œè®¡ç®—å‡ºé€€é¿ç­‰å¾…æ—¶é—´ï¼Œç„¶åŽä½¿ç”¨ CSMA æ–¹æ³•ç»§ç»­å°è¯•å‘é€ã€‚è®¡ç®—é€€é¿ç­‰å¾…æ—¶é—´é‡‡ç”¨çš„æ˜¯äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿ç®—æ³•ã€‚ å±€åŸŸç½‘ å±€åŸŸç½‘ LANï¼ˆLocal Area Networkï¼‰æ˜¯æŒ‡åœ¨æŸä¸€åŒºåŸŸå†…ç”±å¤šå°è®¡ç®—æœºäº’è”æˆçš„è®¡ç®—æœºç»„ã€‚ å±€åŸŸç½‘çš„æ‹“æ‰‘ç»“æž„é€šå¸¸ä¸ºæ€»çº¿åž‹å’ŒçŽ¯åž‹ã€‚ å±€åŸŸç½‘æŠ€æœ¯ä¸»è¦æœ‰ï¼šä»¥å¤ªç½‘ã€ä»¤ç‰ŒçŽ¯ç½‘ã€FDDI ç½‘å’Œæ— çº¿å±€åŸŸç½‘ç­‰ã€‚ ä»¥å¤ªç½‘ ä»¥å¤ªç½‘ï¼ˆEthernetï¼‰æ˜¯ä¸€ç§æ˜Ÿåž‹æ‹“æ‰‘ç»“æž„å±€åŸŸç½‘ã€‚ ä»¥å¤ªç½‘æ˜¯ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„å±€åŸŸç½‘ã€‚ ä»¥å¤ªç½‘ä½¿ç”¨ CSMA/CD åè®®ã€‚ MAC åœ°å€ MAC åœ°å€ï¼ˆMedia Access Control Addressï¼‰ï¼Œä¹Ÿç§°ä¸ºä»¥å¤ªç½‘åœ°å€æˆ–ç‰©ç†åœ°å€ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨æ¥ç¡®è®¤ç½‘ä¸Šè®¾å¤‡ä½ç½®çš„åœ°å€ã€‚ MAC åœ°å€é•¿åº¦ä¸º 6 å­—èŠ‚ï¼ˆ48 ä½ï¼‰ï¼Œç”¨äºŽå”¯ä¸€æ ‡è¯†ç½‘ç»œé€‚é…å™¨ï¼ˆç½‘å¡ï¼‰ã€‚ ä¸€å°ä¸»æœºæ‹¥æœ‰å¤šå°‘ä¸ªç½‘ç»œé€‚é…å™¨å°±æœ‰å¤šå°‘ä¸ª MAC åœ°å€ã€‚ è®¾å¤‡ é€‚é…å™¨ ç½‘ç»œé€‚é…å™¨ä¸€èˆ¬æŒ‡ç½‘å¡ã€‚ ç½‘å¡æ˜¯å·¥ä½œåœ¨é“¾è·¯å±‚çš„ç½‘ç»œç»„ä»¶ï¼Œæ˜¯å±€åŸŸç½‘ä¸­è¿žæŽ¥è®¡ç®—æœºå’Œä¼ è¾“ä»‹è´¨çš„æŽ¥å£ï¼Œä¸ä»…èƒ½å®žçŽ°ä¸Žå±€åŸŸç½‘ä¼ è¾“ä»‹è´¨ä¹‹é—´çš„ç‰©ç†è¿žæŽ¥å’Œç”µä¿¡å·åŒ¹é…ï¼Œè¿˜æ¶‰åŠå¸§çš„å‘é€ä¸ŽæŽ¥æ”¶ã€å¸§çš„å°è£…ä¸Žæ‹†å°ã€ä»‹è´¨è®¿é—®æŽ§åˆ¶ã€æ•°æ®çš„ç¼–ç ä¸Žè§£ç ä»¥åŠæ•°æ®ç¼“å­˜çš„åŠŸèƒ½ç­‰ã€‚ ç½‘å¡å’Œå±€åŸŸç½‘ä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡ç”µç¼†æˆ–åŒç»žçº¿ä»¥ä¸²è¡Œä¼ è¾“æ–¹å¼è¿›è¡Œçš„ã€‚è€Œç½‘å¡å’Œè®¡ç®—æœºä¹‹é—´çš„é€šä¿¡åˆ™æ˜¯é€šè¿‡è®¡ç®—æœºä¸»æ¿ä¸Šçš„ I/O æ€»çº¿ä»¥å¹¶è¡Œä¼ è¾“æ–¹å¼è¿›è¡Œã€‚ é›†çº¿å™¨ é›†çº¿å™¨ï¼ˆHubï¼‰çš„ä¸»è¦åŠŸèƒ½æ˜¯å¯¹æŽ¥æ”¶åˆ°çš„ä¿¡å·è¿›è¡Œå†ç”Ÿæ•´å½¢æ”¾å¤§ï¼Œä»¥æ‰©å¤§ç½‘ç»œçš„ä¼ è¾“è·ç¦»ï¼ŒåŒæ—¶æŠŠæ‰€æœ‰èŠ‚ç‚¹é›†ä¸­åœ¨ä»¥å®ƒä¸ºä¸­å¿ƒçš„èŠ‚ç‚¹ä¸Šã€‚ ä½¿ç”¨é›†çº¿å™¨å¯ä»¥åœ¨ç‰©ç†å±‚æ‰©å±•ä»¥å¤ªç½‘ã€‚ ç½‘æ¡¥ ç½‘æ¡¥ï¼ˆBridgeï¼‰æ˜¯æ—©æœŸçš„ä¸¤ç«¯å£äºŒå±‚ç½‘ç»œè®¾å¤‡ï¼Œç”¨æ¥è¿žæŽ¥ä¸åŒç½‘æ®µã€‚ç½‘æ¡¥çš„ä¸¤ä¸ªç«¯å£åˆ†åˆ«æœ‰ä¸€æ¡ç‹¬ç«‹çš„äº¤æ¢ä¿¡é“ï¼Œä¸æ˜¯å…±äº«ä¸€æ¡èƒŒæ¿æ€»çº¿ï¼Œå¯éš”ç¦»å†²çªåŸŸã€‚ç½‘æ¡¥æ¯”é›†çº¿å™¨ï¼ˆHubï¼‰æ€§èƒ½æ›´å¥½ï¼Œé›†çº¿å™¨ä¸Šå„ç«¯å£éƒ½æ˜¯å…±äº«åŒä¸€æ¡èƒŒæ¿æ€»çº¿çš„ã€‚åŽæ¥ï¼Œç½‘æ¡¥è¢«å…·æœ‰æ›´å¤šç«¯å£ã€åŒæ—¶ä¹Ÿå¯éš”ç¦»å†²çªåŸŸçš„äº¤æ¢æœºï¼ˆSwitchï¼‰æ‰€å–ä»£ã€‚ ä»¥å¤ªç½‘äº¤æ¢æœº ä»¥å¤ªç½‘äº¤æ¢æœºæ˜¯åŸºäºŽä»¥å¤ªç½‘ä¼ è¾“æ•°æ®çš„äº¤æ¢æœºï¼Œä»¥å¤ªç½‘é‡‡ç”¨å…±äº«æ€»çº¿åž‹ä¼ è¾“åª’ä½“æ–¹å¼çš„å±€åŸŸç½‘ã€‚ä»¥å¤ªç½‘äº¤æ¢æœºçš„ç»“æž„æ˜¯æ¯ä¸ªç«¯å£éƒ½ç›´æŽ¥ä¸Žä¸»æœºç›¸è¿žï¼Œå¹¶ä¸”ä¸€èˆ¬éƒ½å·¥ä½œåœ¨å…¨åŒå·¥æ–¹å¼ã€‚äº¤æ¢æœºèƒ½åŒæ—¶è¿žé€šè®¸å¤šå¯¹ç«¯å£ï¼Œä½¿æ¯ä¸€å¯¹ç›¸äº’é€šä¿¡çš„ä¸»æœºéƒ½èƒ½åƒç‹¬å é€šä¿¡åª’ä½“é‚£æ ·ï¼Œè¿›è¡Œæ— å†²çªåœ°ä¼ è¾“æ•°æ®ã€‚ ä»¥å¤ªç½‘äº¤æ¢æœºçš„æ¯ä¸ªç«¯å£éƒ½ç›´æŽ¥ä¸Žä¸»æœºç›¸è¿žï¼Œå¹¶ä¸”ä¸€èˆ¬éƒ½å·¥ä½œåœ¨å…¨åŒå·¥æ–¹å¼ã€‚ äº¤æ¢æœºèƒ½åŒæ—¶è¿žé€šè®¸å¤šå¯¹çš„ç«¯å£ï¼Œä½¿æ¯ä¸€å¯¹ç›¸äº’é€šä¿¡çš„ä¸»æœºéƒ½èƒ½åƒç‹¬å é€šä¿¡åª’ä½“é‚£æ ·ï¼Œè¿›è¡Œæ— å†²çªåœ°ä¼ è¾“æ•°æ®ã€‚ ç”¨æˆ·ç‹¬å ä¼ è¾“åª’ä½“çš„å¸¦å®½ï¼Œè‹¥ä¸€ä¸ªæŽ¥å£åˆ°ä¸»æœºçš„å¸¦å®½æ˜¯ 10Mbit æ¯ç§’ï¼Œé‚£ä¹ˆæœ‰ 10 ä¸ªæŽ¥å£çš„äº¤æ¢æœºçš„æ€»å®¹é‡æ˜¯ 100Mbit æ¯ç§’ã€‚è¿™æ˜¯äº¤æ¢æœºçš„æœ€å¤§ä¼˜ç‚¹ã€‚]]></content>
      <categories>
        <category>communication</category>
      </categories>
      <tags>
        <tag>communication</tag>
        <tag>network</tag>
        <tag>data link</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¡ç®—æœºç½‘ç»œä¹‹åº”ç”¨å±‚]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fcommunication%2Fnetwork-application%2F</url>
    <content type="text"><![CDATA[è®¡ç®—æœºç½‘ç»œä¹‹åº”ç”¨å±‚ HTTP DNS FTP DHCP TELNET ç”µå­é‚®ä»¶åè®® 1. SMTP 2. POP3 3. IMAP å¸¸ç”¨ç«¯å£ Web é¡µé¢è¯·æ±‚è¿‡ç¨‹ 1. DHCP é…ç½®ä¸»æœºä¿¡æ¯ 2. ARP è§£æž MAC åœ°å€ 3. DNS è§£æžåŸŸå 4. HTTP è¯·æ±‚é¡µé¢ HTTP è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆè‹±è¯­ï¼šHyperText Transfer Protocolï¼Œç¼©å†™ï¼šHTTPï¼‰æ˜¯ä¸€ç§ç”¨äºŽåˆ†å¸ƒå¼ã€åä½œå¼å’Œè¶…åª’ä½“ä¿¡æ¯ç³»ç»Ÿçš„åº”ç”¨å±‚åè®®ã€‚HTTP æ˜¯ä¸‡ç»´ç½‘çš„æ•°æ®é€šä¿¡çš„åŸºç¡€ã€‚ è®¾è®¡ HTTP æœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’ŒæŽ¥æ”¶ HTML é¡µé¢çš„æ–¹æ³•ã€‚é€šè¿‡ HTTP æˆ–è€… HTTPS åè®®è¯·æ±‚çš„èµ„æºç”±ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆUniform Resource Identifiersï¼ŒURIï¼‰æ¥æ ‡è¯†ã€‚ å®‰å…¨å¥—æŽ¥å­—å±‚è¶…æ–‡æœ¬ä¼ è¾“åè®® HTTPS ä¸ºäº†æ•°æ®ä¼ è¾“çš„å®‰å…¨ï¼ŒHTTPS åœ¨ HTTP çš„åŸºç¡€ä¸ŠåŠ å…¥äº† SSL åè®®ï¼ŒSSL ä¾é è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œå¹¶ä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡åŠ å¯†ã€‚ ðŸ‘‰ æ‰©å±•é˜…è¯»ï¼šHTTP DNS åŸŸåæœåŠ¡å™¨ DNS æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œæä¾›äº†ä¸»æœºåå’Œ IP åœ°å€ä¹‹é—´ç›¸äº’è½¬æ¢çš„æœåŠ¡ã€‚è¿™é‡Œçš„åˆ†å¸ƒå¼æ•°æ®åº“æ˜¯æŒ‡ï¼Œæ¯ä¸ªç«™ç‚¹åªä¿ç•™å®ƒè‡ªå·±çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚ åŸŸåå…·æœ‰å±‚æ¬¡ç»“æž„ï¼Œä»Žä¸Šåˆ°ä¸‹ä¾æ¬¡ä¸ºï¼šæ ¹åŸŸåã€é¡¶çº§åŸŸåã€äºŒçº§åŸŸåã€‚ DNS å¯ä»¥ä½¿ç”¨ UDP æˆ–è€… TCP è¿›è¡Œä¼ è¾“ï¼Œä½¿ç”¨çš„ç«¯å£å·éƒ½ä¸º 53ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ DNS ä½¿ç”¨ UDP è¿›è¡Œä¼ è¾“ï¼Œè¿™å°±è¦æ±‚åŸŸåè§£æžå™¨å’ŒåŸŸåæœåŠ¡å™¨éƒ½å¿…é¡»è‡ªå·±å¤„ç†è¶…æ—¶å’Œé‡ä¼ æ¥ä¿è¯å¯é æ€§ã€‚åœ¨ä¸¤ç§æƒ…å†µä¸‹ä¼šä½¿ç”¨ TCP è¿›è¡Œä¼ è¾“ï¼š å¦‚æžœè¿”å›žçš„å“åº”è¶…è¿‡çš„ 512 å­—èŠ‚ï¼ˆUDP æœ€å¤§åªæ”¯æŒ 512 å­—èŠ‚çš„æ•°æ®ï¼‰ã€‚ åŒºåŸŸä¼ é€ï¼ˆåŒºåŸŸä¼ é€æ˜¯ä¸»åŸŸåæœåŠ¡å™¨å‘è¾…åŠ©åŸŸåæœåŠ¡å™¨ä¼ é€å˜åŒ–çš„é‚£éƒ¨åˆ†æ•°æ®ï¼‰ã€‚ ðŸ‘‰ æ‰©å±•é˜…è¯»ï¼šDNS FTP æ–‡ä»¶ä¼ é€åè®® FTP ä½¿ç”¨ TCP è¿›è¡Œè¿žæŽ¥ï¼Œå®ƒéœ€è¦ä¸¤ä¸ªè¿žæŽ¥æ¥ä¼ é€ä¸€ä¸ªæ–‡ä»¶ï¼š æŽ§åˆ¶è¿žæŽ¥ï¼šæœåŠ¡å™¨æ‰“å¼€ç«¯å£å· 21 ç­‰å¾…å®¢æˆ·ç«¯çš„è¿žæŽ¥ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨å»ºç«‹è¿žæŽ¥åŽï¼Œä½¿ç”¨è¿™ä¸ªè¿žæŽ¥å°†å®¢æˆ·ç«¯çš„å‘½ä»¤ä¼ é€ç»™æœåŠ¡å™¨ï¼Œå¹¶ä¼ å›žæœåŠ¡å™¨çš„åº”ç­”ã€‚ æ•°æ®è¿žæŽ¥ï¼šç”¨æ¥ä¼ é€ä¸€ä¸ªæ–‡ä»¶æ•°æ®ã€‚ æ ¹æ®æ•°æ®è¿žæŽ¥æ˜¯å¦æ˜¯æœåŠ¡å™¨ç«¯ä¸»åŠ¨å»ºç«‹ï¼ŒFTP æœ‰ä¸»åŠ¨å’Œè¢«åŠ¨ä¸¤ç§æ¨¡å¼ï¼š ä¸»åŠ¨æ¨¡å¼ï¼šæœåŠ¡å™¨ç«¯ä¸»åŠ¨å»ºç«‹æ•°æ®è¿žæŽ¥ï¼Œå…¶ä¸­æœåŠ¡å™¨ç«¯çš„ç«¯å£å·ä¸º 20ï¼Œå®¢æˆ·ç«¯çš„ç«¯å£å·éšæœºï¼Œä½†æ˜¯å¿…é¡»å¤§äºŽ 1024ï¼Œå› ä¸º 0~1023 æ˜¯ç†ŸçŸ¥ç«¯å£å·ã€‚ è¢«åŠ¨æ¨¡å¼ï¼šå®¢æˆ·ç«¯ä¸»åŠ¨å»ºç«‹æ•°æ®è¿žæŽ¥ï¼Œå…¶ä¸­å®¢æˆ·ç«¯çš„ç«¯å£å·ç”±å®¢æˆ·ç«¯è‡ªå·±æŒ‡å®šï¼ŒæœåŠ¡å™¨ç«¯çš„ç«¯å£å·éšæœºã€‚ ä¸»åŠ¨æ¨¡å¼è¦æ±‚å®¢æˆ·ç«¯å¼€æ”¾ç«¯å£å·ç»™æœåŠ¡å™¨ç«¯ï¼Œéœ€è¦åŽ»é…ç½®å®¢æˆ·ç«¯çš„é˜²ç«å¢™ã€‚è¢«åŠ¨æ¨¡å¼åªéœ€è¦æœåŠ¡å™¨ç«¯å¼€æ”¾ç«¯å£å·å³å¯ï¼Œæ— éœ€å®¢æˆ·ç«¯é…ç½®é˜²ç«å¢™ã€‚ä½†æ˜¯è¢«åŠ¨æ¨¡å¼ä¼šå¯¼è‡´æœåŠ¡å™¨ç«¯çš„å®‰å…¨æ€§å‡å¼±ï¼Œå› ä¸ºå¼€æ”¾äº†è¿‡å¤šçš„ç«¯å£å·ã€‚ FTPS æ˜¯ä¸€ç§å¯¹å¸¸ç”¨çš„æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆFTPï¼‰æ·»åŠ ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰å’Œå®‰å…¨å¥—æŽ¥å±‚ï¼ˆSSLï¼‰åŠ å¯†åè®®æ”¯æŒçš„æ‰©å±•åè®®ã€‚ DHCP åŠ¨æ€ä¸»æœºé…ç½®åè®® DHCP (Dynamic Host Configuration Protocol) æä¾›äº†å³æ’å³ç”¨çš„è¿žç½‘æ–¹å¼ï¼Œç”¨æˆ·ä¸å†éœ€è¦åŽ»æ‰‹åŠ¨é…ç½® IP åœ°å€ç­‰ä¿¡æ¯ã€‚ DHCP é…ç½®çš„å†…å®¹ä¸ä»…æ˜¯ IP åœ°å€ï¼Œè¿˜åŒ…æ‹¬å­ç½‘æŽ©ç ã€ç½‘å…³ IP åœ°å€ã€‚ DHCP å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯å‘é€ Discover æŠ¥æ–‡ï¼Œè¯¥æŠ¥æ–‡çš„ç›®çš„åœ°å€ä¸º 255.255.255.255:67ï¼Œæºåœ°å€ä¸º 0.0.0.0:68ï¼Œè¢«æ”¾å…¥ UDP ä¸­ï¼Œè¯¥æŠ¥æ–‡è¢«å¹¿æ’­åˆ°åŒä¸€ä¸ªå­ç½‘çš„æ‰€æœ‰ä¸»æœºä¸Šã€‚å¦‚æžœå®¢æˆ·ç«¯å’Œ DHCP æœåŠ¡å™¨ä¸åœ¨åŒä¸€ä¸ªå­ç½‘ï¼Œå°±éœ€è¦ä½¿ç”¨ä¸­ç»§ä»£ç†ã€‚ DHCP æœåŠ¡å™¨æ”¶åˆ° Discover æŠ¥æ–‡ä¹‹åŽï¼Œå‘é€ Offer æŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œè¯¥æŠ¥æ–‡åŒ…å«äº†å®¢æˆ·ç«¯æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚å› ä¸ºå®¢æˆ·ç«¯å¯èƒ½æ”¶åˆ°å¤šä¸ª DHCP æœåŠ¡å™¨æä¾›çš„ä¿¡æ¯ï¼Œå› æ­¤å®¢æˆ·ç«¯éœ€è¦è¿›è¡Œé€‰æ‹©ã€‚ å¦‚æžœå®¢æˆ·ç«¯é€‰æ‹©äº†æŸä¸ª DHCP æœåŠ¡å™¨æä¾›çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±å‘é€ Request æŠ¥æ–‡ç»™è¯¥ DHCP æœåŠ¡å™¨ã€‚ DHCP æœåŠ¡å™¨å‘é€ Ack æŠ¥æ–‡ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯æ­¤æ—¶å¯ä»¥ä½¿ç”¨æä¾›ç»™å®ƒçš„ä¿¡æ¯ã€‚ TELNET è¿œç¨‹ç™»å½•åè®® TELNET ç”¨äºŽç™»å½•åˆ°è¿œç¨‹ä¸»æœºä¸Šï¼Œå¹¶ä¸”è¿œç¨‹ä¸»æœºä¸Šçš„è¾“å‡ºä¹Ÿä¼šè¿”å›žã€‚ TELNET å¯ä»¥é€‚åº”è®¸å¤šè®¡ç®—æœºå’Œæ“ä½œç³»ç»Ÿçš„å·®å¼‚ï¼Œä¾‹å¦‚ä¸åŒæ“ä½œç³»ç»Ÿç³»ç»Ÿçš„æ¢è¡Œç¬¦å®šä¹‰ã€‚ ç”µå­é‚®ä»¶åè®® ä¸€ä¸ªç”µå­é‚®ä»¶ç³»ç»Ÿç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šç”¨æˆ·ä»£ç†ã€é‚®ä»¶æœåŠ¡å™¨ä»¥åŠé‚®ä»¶åè®®ã€‚ é‚®ä»¶åè®®åŒ…å«å‘é€åè®®å’Œè¯»å–åè®®ï¼Œå‘é€åè®®å¸¸ç”¨ SMTPï¼Œè¯»å–åè®®å¸¸ç”¨ POP3 å’Œ IMAPã€‚ 1. SMTP SMTP åªèƒ½å‘é€ ASCII ç ï¼Œè€Œäº’è”ç½‘é‚®ä»¶æ‰©å…… MIME å¯ä»¥å‘é€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚MIME å¹¶æ²¡æœ‰æ”¹åŠ¨æˆ–è€…å–ä»£ SMTPï¼Œè€Œæ˜¯å¢žåŠ é‚®ä»¶ä¸»ä½“çš„ç»“æž„ï¼Œå®šä¹‰äº†éž ASCII ç çš„ç¼–ç è§„åˆ™ã€‚ 2. POP3 POP3 çš„ç‰¹ç‚¹æ˜¯åªè¦ç”¨æˆ·ä»ŽæœåŠ¡å™¨ä¸Šè¯»å–äº†é‚®ä»¶ï¼Œå°±æŠŠè¯¥é‚®ä»¶åˆ é™¤ã€‚ 3. IMAP IMAP åè®®ä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ä¿æŒåŒæ­¥ï¼Œå¦‚æžœä¸æ‰‹åŠ¨åˆ é™¤é‚®ä»¶ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ä¹Ÿä¸ä¼šè¢«åˆ é™¤ã€‚IMAP è¿™ç§åšæ³•å¯ä»¥è®©ç”¨æˆ·éšæ—¶éšåœ°åŽ»è®¿é—®æœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ã€‚ å¸¸ç”¨ç«¯å£ åº”ç”¨ åº”ç”¨å±‚åè®® ç«¯å£å· ä¼ è¾“å±‚åè®® å¤‡æ³¨ åŸŸåè§£æž DNS 53 UDP/TCP é•¿åº¦è¶…è¿‡ 512 å­—èŠ‚æ—¶ä½¿ç”¨ TCP åŠ¨æ€ä¸»æœºé…ç½®åè®® DHCP 67/68 UDP ç®€å•ç½‘ç»œç®¡ç†åè®® SNMP 161/162 UDP æ–‡ä»¶ä¼ é€åè®® FTP 20/21 TCP æŽ§åˆ¶è¿žæŽ¥ 21ï¼Œæ•°æ®è¿žæŽ¥ 20 è¿œç¨‹ç»ˆç«¯åè®® TELNET 23 TCP è¶…æ–‡æœ¬ä¼ é€åè®® HTTP 80 TCP ç®€å•é‚®ä»¶ä¼ é€åè®® SMTP 25 TCP é‚®ä»¶è¯»å–åè®® POP3 110 TCP ç½‘é™…æŠ¥æ–‡å­˜å–åè®® IMAP 143 TCP Web é¡µé¢è¯·æ±‚è¿‡ç¨‹ 1. DHCP é…ç½®ä¸»æœºä¿¡æ¯ å‡è®¾ä¸»æœºæœ€å¼€å§‹æ²¡æœ‰ IP åœ°å€ä»¥åŠå…¶å®ƒä¿¡æ¯ï¼Œé‚£ä¹ˆå°±éœ€è¦å…ˆä½¿ç”¨ DHCP æ¥èŽ·å–ã€‚ ä¸»æœºç”Ÿæˆä¸€ä¸ª DHCP è¯·æ±‚æŠ¥æ–‡ï¼Œå¹¶å°†è¿™ä¸ªæŠ¥æ–‡æ”¾å…¥å…·æœ‰ç›®çš„ç«¯å£ 67 å’Œæºç«¯å£ 68 çš„ UDP æŠ¥æ–‡æ®µä¸­ã€‚ è¯¥æŠ¥æ–‡æ®µåˆ™è¢«æ”¾å…¥åœ¨ä¸€ä¸ªå…·æœ‰å¹¿æ’­ IP ç›®çš„åœ°å€(255.255.255.255) å’Œæº IP åœ°å€ï¼ˆ0.0.0.0ï¼‰çš„ IP æ•°æ®æŠ¥ä¸­ã€‚ è¯¥æ•°æ®æŠ¥åˆ™è¢«æ”¾ç½®åœ¨ MAC å¸§ä¸­ï¼Œè¯¥å¸§å…·æœ‰ç›®çš„åœ°å€ FF:FF:FF:FF:FF:FFï¼Œå°†å¹¿æ’­åˆ°ä¸Žäº¤æ¢æœºè¿žæŽ¥çš„æ‰€æœ‰è®¾å¤‡ã€‚ è¿žæŽ¥åœ¨äº¤æ¢æœºçš„ DHCP æœåŠ¡å™¨æ”¶åˆ°å¹¿æ’­å¸§ä¹‹åŽï¼Œä¸æ–­åœ°å‘ä¸Šåˆ†è§£å¾—åˆ° IP æ•°æ®æŠ¥ã€UDP æŠ¥æ–‡æ®µã€DHCP è¯·æ±‚æŠ¥æ–‡ï¼Œä¹‹åŽç”Ÿæˆ DHCP ACK æŠ¥æ–‡ï¼Œè¯¥æŠ¥æ–‡åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼šIP åœ°å€ã€DNS æœåŠ¡å™¨çš„ IP åœ°å€ã€é»˜è®¤ç½‘å…³è·¯ç”±å™¨çš„ IP åœ°å€å’Œå­ç½‘æŽ©ç ã€‚è¯¥æŠ¥æ–‡è¢«æ”¾å…¥ UDP æŠ¥æ–‡æ®µä¸­ï¼ŒUDP æŠ¥æ–‡æ®µæœ‰è¢«æ”¾å…¥ IP æ•°æ®æŠ¥ä¸­ï¼Œæœ€åŽæ”¾å…¥ MAC å¸§ä¸­ã€‚ è¯¥å¸§çš„ç›®çš„åœ°å€æ˜¯è¯·æ±‚ä¸»æœºçš„ MAC åœ°å€ï¼Œå› ä¸ºäº¤æ¢æœºå…·æœ‰è‡ªå­¦ä¹ èƒ½åŠ›ï¼Œä¹‹å‰ä¸»æœºå‘é€äº†å¹¿æ’­å¸§ä¹‹åŽå°±è®°å½•äº† MAC åœ°å€åˆ°å…¶è½¬å‘æŽ¥å£çš„äº¤æ¢è¡¨é¡¹ï¼Œå› æ­¤çŽ°åœ¨äº¤æ¢æœºå°±å¯ä»¥ç›´æŽ¥çŸ¥é“åº”è¯¥å‘å“ªä¸ªæŽ¥å£å‘é€è¯¥å¸§ã€‚ ä¸»æœºæ”¶åˆ°è¯¥å¸§åŽï¼Œä¸æ–­åˆ†è§£å¾—åˆ° DHCP æŠ¥æ–‡ã€‚ä¹‹åŽå°±é…ç½®å®ƒçš„ IP åœ°å€ã€å­ç½‘æŽ©ç å’Œ DNS æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œå¹¶åœ¨å…¶ IP è½¬å‘è¡¨ä¸­å®‰è£…é»˜è®¤ç½‘å…³ã€‚ 2. ARP è§£æž MAC åœ°å€ ä¸»æœºé€šè¿‡æµè§ˆå™¨ç”Ÿæˆä¸€ä¸ª TCP å¥—æŽ¥å­—ï¼Œå¥—æŽ¥å­—å‘ HTTP æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ã€‚ä¸ºäº†ç”Ÿæˆè¯¥å¥—æŽ¥å­—ï¼Œä¸»æœºéœ€è¦çŸ¥é“ç½‘ç«™çš„åŸŸåå¯¹åº”çš„ IP åœ°å€ã€‚ ä¸»æœºç”Ÿæˆä¸€ä¸ª DNS æŸ¥è¯¢æŠ¥æ–‡ï¼Œè¯¥æŠ¥æ–‡å…·æœ‰ 53 å·ç«¯å£ï¼Œå› ä¸º DNS æœåŠ¡å™¨çš„ç«¯å£å·æ˜¯ 53ã€‚ è¯¥ DNS æŸ¥è¯¢æŠ¥æ–‡è¢«æ”¾å…¥ç›®çš„åœ°å€ä¸º DNS æœåŠ¡å™¨ IP åœ°å€çš„ IP æ•°æ®æŠ¥ä¸­ã€‚ è¯¥ IP æ•°æ®æŠ¥è¢«æ”¾å…¥ä¸€ä¸ªä»¥å¤ªç½‘å¸§ä¸­ï¼Œè¯¥å¸§å°†å‘é€åˆ°ç½‘å…³è·¯ç”±å™¨ã€‚ DHCP è¿‡ç¨‹åªçŸ¥é“ç½‘å…³è·¯ç”±å™¨çš„ IP åœ°å€ï¼Œä¸ºäº†èŽ·å–ç½‘å…³è·¯ç”±å™¨çš„ MAC åœ°å€ï¼Œéœ€è¦ä½¿ç”¨ ARP åè®®ã€‚ ä¸»æœºç”Ÿæˆä¸€ä¸ªåŒ…å«ç›®çš„åœ°å€ä¸ºç½‘å…³è·¯ç”±å™¨ IP åœ°å€çš„ ARP æŸ¥è¯¢æŠ¥æ–‡ï¼Œå°†è¯¥ ARP æŸ¥è¯¢æŠ¥æ–‡æ”¾å…¥ä¸€ä¸ªå…·æœ‰å¹¿æ’­ç›®çš„åœ°å€ï¼ˆFF:FF:FF:FF:FF:FFï¼‰çš„ä»¥å¤ªç½‘å¸§ä¸­ï¼Œå¹¶å‘äº¤æ¢æœºå‘é€è¯¥ä»¥å¤ªç½‘å¸§ï¼Œäº¤æ¢æœºå°†è¯¥å¸§è½¬å‘ç»™æ‰€æœ‰çš„è¿žæŽ¥è®¾å¤‡ï¼ŒåŒ…æ‹¬ç½‘å…³è·¯ç”±å™¨ã€‚ ç½‘å…³è·¯ç”±å™¨æŽ¥æ”¶åˆ°è¯¥å¸§åŽï¼Œä¸æ–­å‘ä¸Šåˆ†è§£å¾—åˆ° ARP æŠ¥æ–‡ï¼Œå‘çŽ°å…¶ä¸­çš„ IP åœ°å€ä¸Žå…¶æŽ¥å£çš„ IP åœ°å€åŒ¹é…ï¼Œå› æ­¤å°±å‘é€ä¸€ä¸ª ARP å›žç­”æŠ¥æ–‡ï¼ŒåŒ…å«äº†å®ƒçš„ MAC åœ°å€ï¼Œå‘å›žç»™ä¸»æœºã€‚ 3. DNS è§£æžåŸŸå çŸ¥é“äº†ç½‘å…³è·¯ç”±å™¨çš„ MAC åœ°å€ä¹‹åŽï¼Œå°±å¯ä»¥ç»§ç»­ DNS çš„è§£æžè¿‡ç¨‹äº†ã€‚ ç½‘å…³è·¯ç”±å™¨æŽ¥æ”¶åˆ°åŒ…å« DNS æŸ¥è¯¢æŠ¥æ–‡çš„ä»¥å¤ªç½‘å¸§åŽï¼ŒæŠ½å–å‡º IP æ•°æ®æŠ¥ï¼Œå¹¶æ ¹æ®è½¬å‘è¡¨å†³å®šè¯¥ IP æ•°æ®æŠ¥åº”è¯¥è½¬å‘çš„è·¯ç”±å™¨ã€‚ å› ä¸ºè·¯ç”±å™¨å…·æœ‰å†…éƒ¨ç½‘å…³åè®®ï¼ˆRIPã€OSPFï¼‰å’Œå¤–éƒ¨ç½‘å…³åè®®ï¼ˆBGPï¼‰è¿™ä¸¤ç§è·¯ç”±é€‰æ‹©åè®®ï¼Œå› æ­¤è·¯ç”±è¡¨ä¸­å·²ç»é…ç½®äº†ç½‘å…³è·¯ç”±å™¨åˆ°è¾¾ DNS æœåŠ¡å™¨çš„è·¯ç”±è¡¨é¡¹ã€‚ åˆ°è¾¾ DNS æœåŠ¡å™¨ä¹‹åŽï¼ŒDNS æœåŠ¡å™¨æŠ½å–å‡º DNS æŸ¥è¯¢æŠ¥æ–‡ï¼Œå¹¶åœ¨ DNS æ•°æ®åº“ä¸­æŸ¥æ‰¾å¾…è§£æžçš„åŸŸåã€‚ æ‰¾åˆ° DNS è®°å½•ä¹‹åŽï¼Œå‘é€ DNS å›žç­”æŠ¥æ–‡ï¼Œå°†è¯¥å›žç­”æŠ¥æ–‡æ”¾å…¥ UDP æŠ¥æ–‡æ®µä¸­ï¼Œç„¶åŽæ”¾å…¥ IP æ•°æ®æŠ¥ä¸­ï¼Œé€šè¿‡è·¯ç”±å™¨åå‘è½¬å‘å›žç½‘å…³è·¯ç”±å™¨ï¼Œå¹¶ç»è¿‡ä»¥å¤ªç½‘äº¤æ¢æœºåˆ°è¾¾ä¸»æœºã€‚ 4. HTTP è¯·æ±‚é¡µé¢ æœ‰äº† HTTP æœåŠ¡å™¨çš„ IP åœ°å€ä¹‹åŽï¼Œä¸»æœºå°±èƒ½å¤Ÿç”Ÿæˆ TCP å¥—æŽ¥å­—ï¼Œè¯¥å¥—æŽ¥å­—å°†ç”¨äºŽå‘ Web æœåŠ¡å™¨å‘é€ HTTP GET æŠ¥æ–‡ã€‚ åœ¨ç”Ÿæˆ TCP å¥—æŽ¥å­—ä¹‹å‰ï¼Œå¿…é¡»å…ˆä¸Ž HTTP æœåŠ¡å™¨è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹æ¥å»ºç«‹è¿žæŽ¥ã€‚ç”Ÿæˆä¸€ä¸ªå…·æœ‰ç›®çš„ç«¯å£ 80 çš„ TCP SYN æŠ¥æ–‡æ®µï¼Œå¹¶å‘ HTTP æœåŠ¡å™¨å‘é€è¯¥æŠ¥æ–‡æ®µã€‚ HTTP æœåŠ¡å™¨æ”¶åˆ°è¯¥æŠ¥æ–‡æ®µä¹‹åŽï¼Œç”Ÿæˆ TCP SYN ACK æŠ¥æ–‡æ®µï¼Œå‘å›žç»™ä¸»æœºã€‚ è¿žæŽ¥å»ºç«‹ä¹‹åŽï¼Œæµè§ˆå™¨ç”Ÿæˆ HTTP GET æŠ¥æ–‡ï¼Œå¹¶äº¤ä»˜ç»™ HTTP æœåŠ¡å™¨ã€‚ HTTP æœåŠ¡å™¨ä»Ž TCP å¥—æŽ¥å­—è¯»å– HTTP GET æŠ¥æ–‡ï¼Œç”Ÿæˆä¸€ä¸ª HTTP å“åº”æŠ¥æ–‡ï¼Œå°† Web é¡µé¢å†…å®¹æ”¾å…¥æŠ¥æ–‡ä¸»ä½“ä¸­ï¼Œå‘å›žç»™ä¸»æœºã€‚ æµè§ˆå™¨æ”¶åˆ° HTTP å“åº”æŠ¥æ–‡åŽï¼ŒæŠ½å–å‡º Web é¡µé¢å†…å®¹ï¼Œä¹‹åŽè¿›è¡Œæ¸²æŸ“ï¼Œæ˜¾ç¤º Web é¡µé¢ã€‚]]></content>
      <categories>
        <category>communication</category>
      </categories>
      <tags>
        <tag>communication</tag>
        <tag>network</tag>
        <tag>application</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¡ç®—æœºç½‘ç»œä¹‹ç‰©ç†å±‚]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fcommunication%2Fnetwork-physical%2F</url>
    <content type="text"><![CDATA[è®¡ç®—æœºç½‘ç»œä¹‹ç‰©ç†å±‚ æ‘˜è¦ ç‰©ç†å±‚ï¼ˆPhysical Layerï¼‰ - ç‰©ç†å±‚åªæŽ¥æ”¶å’Œå‘é€ä¸€ä¸²æ¯”ç‰¹(bit)æµï¼Œä¸è€ƒè™‘ä¿¡æ¯çš„æ„ä¹‰å’Œä¿¡æ¯ç»“æž„ã€‚ æ•°æ®å•å…ƒï¼šæ¯”ç‰¹æµã€‚ å…¸åž‹è®¾å¤‡ï¼šå…‰çº¤ã€åŒè½´ç”µç¼†ã€åŒç»žçº¿ã€ä¸­ç»§å™¨å’Œé›†çº¿å™¨ã€‚ é€šä¿¡ç³»ç»Ÿæ¨¡åž‹ é€šä¿¡æ–¹å¼ é€šä¿¡ä¿¡å· è°ƒåˆ¶è§£è°ƒ åŸºæœ¬å¸¦é€šè°ƒåˆ¶æ–¹æ³• é€šä¿¡åª’ä»‹ ä¿¡é“å¤ç”¨ é€šä¿¡ç³»ç»Ÿæ¨¡åž‹ é€šä¿¡ç³»ç»Ÿæ¨¡åž‹åˆ†ä¸ºä¸‰å¤§éƒ¨åˆ†ï¼šæºç³»ç»Ÿï¼ˆåŒ…æ‹¬ä¿¡æºå’Œå‘é€å™¨ï¼‰ã€ä¼ è¾“ç³»ç»Ÿã€ç›®çš„ç³»ç»Ÿï¼ˆåŒ…æ‹¬ä¿¡å®¿æŽ¥æ”¶å™¨ï¼‰ã€‚ é‡è¦æ¦‚å¿µï¼š ä¿¡æº - ä¹Ÿå«æºç‚¹ã€‚äº§ç”Ÿå„ç±»ä¿¡æ¯çš„å®žä½“ã€‚ ä¿¡é“ - é€šä¿¡çš„é€šé“ï¼Œæ˜¯ä¿¡å·ä¼ è¾“çš„åª’ä»‹ã€‚ ä¿¡å®¿ - ä¼ è¾“ä¿¡æ¯çš„å½’å®¿ã€‚ ç å…ƒ - åœ¨æ•°å­—é€šä¿¡ä¸­å¸¸å¸¸ç”¨æ—¶é—´é—´éš”ç›¸åŒçš„ç¬¦å·æ¥è¡¨ç¤ºä¸€ä¸ªäºŒè¿›åˆ¶æ•°å­—ï¼Œè¿™æ ·çš„æ—¶é—´é—´éš”å†…çš„ä¿¡å·ç§°ä¸º(äºŒè¿›åˆ¶ï¼‰ç å…ƒã€‚ é€šä¿¡æ–¹å¼ æœ‰ä¸‰ç§é€šä¿¡æ–¹å¼ï¼š å•å·¥é€šä¿¡ï¼šå•å‘ä¼ è¾“ åŠåŒå·¥é€šä¿¡ï¼šåŒå‘äº¤æ›¿ä¼ è¾“ å…¨åŒå·¥é€šä¿¡ï¼šåŒå‘åŒæ—¶ä¼ è¾“ é€šä¿¡ä¿¡å· é€šä¿¡çš„ç›®çš„æ˜¯ä¼ é€æ¶ˆæ¯ã€‚å¦‚è¯­éŸ³ã€æ–‡å­—ã€å›¾åƒã€è§†é¢‘éƒ½æ˜¯æ¶ˆæ¯ã€‚æ•°æ®æ—¶ä¼ é€æ¶ˆæ¯çš„å®žä½“ã€‚ä¿¡å·æ˜¯æ•°æ®çš„ç”µæ°”æˆ–ç”µç£çš„è¡¨çŽ°ã€‚ æ¨¡æ‹Ÿä¿¡å·å’Œæ•°å­—ä¿¡å· æ¨¡æ‹Ÿä¿¡å· - æ¨¡æ‹Ÿä¿¡å·æ˜¯è¿žç»­çš„ä¿¡å·ã€‚ æ•°å­—ä¿¡å· - æ•°å­—ä¿¡å·æ˜¯ç¦»æ•£çš„ä¿¡å·ã€‚ è°ƒåˆ¶è§£è°ƒ é‡è¦æ¦‚å¿µï¼š åŸºå¸¦ä¿¡å· - æ¥è‡ªä¿¡æºçš„ä¿¡å·å«åšåŸºå¸¦ä¿¡å·ã€‚ è°ƒåˆ¶ - å°†å„ç§æ•°å­—åŸºå¸¦ä¿¡å·è½¬æ¢æˆé€‚äºŽä¿¡é“ä¼ è¾“çš„æ•°å­—è°ƒåˆ¶ä¿¡å·(å·²è°ƒä¿¡å·æˆ–é¢‘å¸¦ä¿¡å·)ã€‚ç®€å•æ¥è¯´ï¼šè°ƒåˆ¶å³ï¼Œæ•°å­— -&gt; æ¨¡æ‹Ÿã€‚ è§£è°ƒ - åœ¨æŽ¥æ”¶ç«¯å°†æ”¶åˆ°çš„æ•°å­—é¢‘å¸¦ä¿¡å·è¿˜åŽŸæˆæ•°å­—åŸºå¸¦ä¿¡å·ã€‚ç®€å•æ¥è¯´ï¼šè§£è°ƒå³ï¼Œæ¨¡æ‹Ÿ -&gt; æ•°å­—ã€‚ ðŸ“Œ æç¤ºï¼šæˆ‘ä»¬ä¸Šç½‘æ—¶æ‰€ç”¨åˆ°çš„è°ƒåˆ¶è§£è°ƒå™¨ï¼ˆä¿—ç§°â€œçŒ«â€ï¼‰ï¼ŒæŒ‡çš„å°±æ˜¯è½¬æ¢æ•°å­—å’Œæ¨¡æ‹Ÿä¿¡å·çš„æœºå™¨ã€‚ ä¿¡å·è¦åœ¨ä¿¡é“ä¸Šä¼ è¾“å°±è¦ç»è¿‡è°ƒåˆ¶ã€‚ è°ƒåˆ¶åˆ†ä¸ºï¼šåŸºå¸¦è°ƒåˆ¶å’Œå¸¦é€šè°ƒåˆ¶ åŸºæœ¬å¸¦é€šè°ƒåˆ¶æ–¹æ³• å¦‚æžœä½ æ”¶å¬è¿‡å¹¿æ’­ï¼Œä¸€å®šç»å¸¸å¬åˆ° AMã€FM è¿™ä¸¤ä¸ªå…³é”®è¯ï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿç­”æ¡ˆå¦‚ä¸‹ï¼š è°ƒå¹…ï¼ˆAMï¼‰ - å³è½½æ³¢çš„æŒ¯å¹…éšåŸºå¸¦æ•°å­—ä¿¡å·è€Œå˜åŒ–ã€‚ è°ƒé¢‘ï¼ˆFMï¼‰ - å³è½½æ³¢çš„é¢‘çŽ‡éšåŸºå¸¦æ•°å­—ä¿¡å·è€Œå˜åŒ–ã€‚ è°ƒç›¸ï¼ˆPMï¼‰ - å³è½½æ³¢çš„åˆå§‹ç›¸ä½éšåŸºå¸¦æ•°å­—ä¿¡å·è€Œå˜åŒ–ã€‚ ðŸ“Œ æç¤ºï¼šæˆ‘ä»¬æ”¶å¬å¹¿æ’­æ—¶ï¼Œä¸ºäº†æŽ¥æ”¶ä¸åŒå¹¿æ’­å°çš„ä¿¡å·ï¼Œå°±è¦è°ƒæ•´ AM æˆ– FMï¼ŒæŒ‡çš„å°±æ˜¯è¿™é‡Œçš„è°ƒåˆ¶æ–¹æ³•ã€‚ é€šä¿¡åª’ä»‹ é€šä¿¡åª’ä»‹åˆ†ä¸ºä¸¤å¤§ç±»ï¼š å¯¼å¼•åž‹ - åŒç»žçº¿ã€ç”µç¼†ã€å…‰çº¤ éžå¯¼å¼•åž‹ - æ— çº¿ã€çº¢å¤–çº¿ã€å¤§æ°”ã€æ¿€å…‰ ä¿¡é“å¤ç”¨ ä¿¡é“å¤ç”¨å°±æ˜¯å°†ç”¨äºŽä¼ è¾“ä¿¡é“çš„æ€»å¸¦å®½åˆ’åˆ†æˆè‹¥å¹²ä¸ªå­é¢‘å¸¦ï¼ˆæˆ–ç§°å­ä¿¡é“ï¼‰ï¼Œæ¯ä¸€ä¸ªå­ä¿¡é“ä¼ è¾“ä¸€è·¯ä¿¡å·ã€‚ é¢‘åˆ†å¤ç”¨ æ—¶åˆ†å¤ç”¨ æ³¢åˆ†å¤ç”¨ ç åˆ†å¤ç”¨]]></content>
      <categories>
        <category>communication</category>
      </categories>
      <tags>
        <tag>communication</tag>
        <tag>network</tag>
        <tag>physical</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¡ç®—æœºç½‘ç»œä¹‹ç½‘ç»œå±‚]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fcommunication%2Fnetwork-network%2F</url>
    <content type="text"><![CDATA[è®¡ç®—æœºç½‘ç»œä¹‹ç½‘ç»œå±‚ ç½‘ç»œå±‚ï¼ˆnetwork layerï¼‰ - ä¸ºåˆ†ç»„äº¤æ¢ç½‘ä¸Šçš„ä¸åŒä¸»æœºæä¾›é€šä¿¡æœåŠ¡ã€‚åœ¨å‘é€æ•°æ®æ—¶ï¼Œç½‘ç»œå±‚æŠŠè¿è¾“å±‚äº§ç”Ÿçš„æŠ¥æ–‡æ®µæˆ–ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„æˆ–åŒ…è¿›è¡Œä¼ é€ã€‚ ä¸»è¦åè®®ï¼šIPã€ICMPã€‚ æ•°æ®å•å…ƒï¼šIP æ•°æ®æŠ¥ï¼ˆpacketï¼‰ã€‚ å…¸åž‹è®¾å¤‡ï¼šç½‘å…³ã€è·¯ç”±å™¨ã€‚ æ¦‚è¿° IP åè®® ç›¸å…³åè®® åˆ†ç±»çš„ IP åœ°å€ IP åœ°å€ä¸Žç‰©ç†åœ°å€ IP æ•°æ®æŠ¥æ ¼å¼ åœ°å€è§£æžåè®® ARP ç½‘é™…æŽ§åˆ¶æŠ¥æ–‡åè®® ICMP 1. Ping 2. Traceroute è™šæ‹Ÿä¸“ç”¨ç½‘ VPN ç½‘ç»œåœ°å€è½¬æ¢ NAT è·¯ç”±å™¨çš„ç»“æž„ è·¯ç”±å™¨åˆ†ç»„è½¬å‘æµç¨‹ è·¯ç”±é€‰æ‹©åè®® 1. å†…éƒ¨ç½‘å…³åè®® RIP 2. å†…éƒ¨ç½‘å…³åè®® OSPF 3. å¤–éƒ¨ç½‘å…³åè®® BGP æ¦‚è¿° ç½‘ç»œå±‚å‘ä¸Šåªæä¾›ç®€å•çµæ´»çš„ã€æ— è¿žæŽ¥çš„ã€å°½æœ€å¤§åŠªåŠ›äº¤ä»˜çš„æ•°æ®æŠ¥æœåŠ¡ã€‚ç½‘ç»œå±‚ä¸æä¾›æœåŠ¡è´¨é‡çš„æ‰¿è¯ºï¼Œä¸ä¿è¯åˆ†ç»„äº¤ä»˜çš„æ—¶é™ï¼Œæ‰€ä¼ é€çš„åˆ†ç»„å¯èƒ½å‡ºé”™ã€ä¸¢å¤±ã€é‡å¤å’Œå¤±åºã€‚è¿›ç¨‹é—´é€šä¿¡çš„å¯é æ€§ç”±è¿è¾“å±‚è´Ÿè´£ã€‚ IP åè®® ç½‘é™…åè®® IP (Internet Protocol) å®šä¹‰äº†ä¸‰ç§åŠŸèƒ½ï¼š IP å®šä¹‰äº†åœ¨ TCP/IP äº’è”ç½‘ä¸Šæ•°æ®ä¼ é€çš„åŸºæœ¬å•å…ƒå’Œæ•°æ®æ ¼å¼ã€‚ IP è½¯ä»¶å®Œæˆè·¯ç”±é€‰æ‹©åŠŸèƒ½ï¼Œé€‰æ‹©æ•°æ®ä¼ é€çš„è·¯å¾„ã€‚ IP åŒ…å«äº†ä¸€ç»„ä¸å¯é åˆ†ç»„ä¼ é€çš„è§„åˆ™ï¼ŒæŒ‡æ˜Žäº†åˆ†ç»„å¤„ç†ã€å·®é”™ä¿¡æ¯å‘ç”Ÿä»¥åŠåˆ†ç»„çš„è§„åˆ™ã€‚ ç›¸å…³åè®® ä¸Ž IP åè®®é…å¥—ä½¿ç”¨çš„è¿˜æœ‰ä¸‰ä¸ªåè®®ï¼š åœ°å€è§£æžåè®® ARPï¼ˆAddress Resolution Protocolï¼‰ ç½‘é™…æŽ§åˆ¶æŠ¥æ–‡åè®® ICMPï¼ˆInternet Control Message Protocolï¼‰ ç½‘é™…ç»„ç®¡ç†åè®® IGMPï¼ˆInternet Group Management Protocolï¼‰ åˆ†ç±»çš„ IP åœ°å€ IP åœ°å€çš„ç¼–å€æ–¹å¼ç»åŽ†äº†ä¸‰ä¸ªåŽ†å²é˜¶æ®µï¼š åˆ†ç±» å­ç½‘åˆ’åˆ† æ— åˆ†ç±» 1. åˆ†ç±» ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç½‘ç»œå·å’Œä¸»æœºå·ï¼Œå…¶ä¸­ä¸åŒåˆ†ç±»å…·æœ‰ä¸åŒçš„ç½‘ç»œå·é•¿åº¦ï¼Œå¹¶ä¸”æ˜¯å›ºå®šçš„ã€‚ IP åœ°å€ ::= &#123;&lt; ç½‘ç»œå· &gt;, &lt; ä¸»æœºå· &gt;&#125; 2. å­ç½‘åˆ’åˆ† é€šè¿‡åœ¨ä¸»æœºå·å­—æ®µä¸­æ‹¿ä¸€éƒ¨åˆ†ä½œä¸ºå­ç½‘å·ï¼ŒæŠŠä¸¤çº§ IP åœ°å€åˆ’åˆ†ä¸ºä¸‰çº§ IP åœ°å€ã€‚ IP åœ°å€ ::= &#123;&lt; ç½‘ç»œå· &gt;, &lt; å­ç½‘å· &gt;, &lt; ä¸»æœºå· &gt;&#125; è¦ä½¿ç”¨å­ç½‘ï¼Œå¿…é¡»é…ç½®å­ç½‘æŽ©ç ã€‚ä¸€ä¸ª B ç±»åœ°å€çš„é»˜è®¤å­ç½‘æŽ©ç ä¸º 255.255.0.0ï¼Œå¦‚æžœ B ç±»åœ°å€çš„å­ç½‘å ä¸¤ä¸ªæ¯”ç‰¹ï¼Œé‚£ä¹ˆå­ç½‘æŽ©ç ä¸º 11111111 11111111 11000000 00000000ï¼Œä¹Ÿå°±æ˜¯ 255.255.192.0ã€‚ æ³¨æ„ï¼Œå¤–éƒ¨ç½‘ç»œçœ‹ä¸åˆ°å­ç½‘çš„å­˜åœ¨ã€‚ 3. æ— åˆ†ç±» æ— åˆ†ç±»ç¼–å€ CIDR æ¶ˆé™¤äº†ä¼ ç»Ÿ A ç±»ã€B ç±»å’Œ C ç±»åœ°å€ä»¥åŠåˆ’åˆ†å­ç½‘çš„æ¦‚å¿µï¼Œä½¿ç”¨ç½‘ç»œå‰ç¼€å’Œä¸»æœºå·æ¥å¯¹ IP åœ°å€è¿›è¡Œç¼–ç ï¼Œç½‘ç»œå‰ç¼€çš„é•¿åº¦å¯ä»¥æ ¹æ®éœ€è¦å˜åŒ–ã€‚ IP åœ°å€ ::= &#123;&lt; ç½‘ç»œå‰ç¼€å· &gt;, &lt; ä¸»æœºå· &gt;&#125; CIDR çš„è®°æ³•ä¸Šé‡‡ç”¨åœ¨ IP åœ°å€åŽé¢åŠ ä¸Šç½‘ç»œå‰ç¼€é•¿åº¦çš„æ–¹æ³•ï¼Œä¾‹å¦‚ 128.14.35.7/20 è¡¨ç¤ºå‰ 20 ä½ä¸ºç½‘ç»œå‰ç¼€ã€‚ CIDR çš„åœ°å€æŽ©ç å¯ä»¥ç»§ç»­ç§°ä¸ºå­ç½‘æŽ©ç ï¼Œå­ç½‘æŽ©ç é¦– 1 é•¿åº¦ä¸ºç½‘ç»œå‰ç¼€çš„é•¿åº¦ã€‚ ä¸€ä¸ª CIDR åœ°å€å—ä¸­æœ‰å¾ˆå¤šåœ°å€ï¼Œä¸€ä¸ª CIDR è¡¨ç¤ºçš„ç½‘ç»œå°±å¯ä»¥è¡¨ç¤ºåŽŸæ¥çš„å¾ˆå¤šä¸ªç½‘ç»œï¼Œå¹¶ä¸”åœ¨è·¯ç”±è¡¨ä¸­åªéœ€è¦ä¸€ä¸ªè·¯ç”±å°±å¯ä»¥ä»£æ›¿åŽŸæ¥çš„å¤šä¸ªè·¯ç”±ï¼Œå‡å°‘äº†è·¯ç”±è¡¨é¡¹çš„æ•°é‡ã€‚æŠŠè¿™ç§é€šè¿‡ä½¿ç”¨ç½‘ç»œå‰ç¼€æ¥å‡å°‘è·¯ç”±è¡¨é¡¹çš„æ–¹å¼ç§°ä¸ºè·¯ç”±èšåˆï¼Œä¹Ÿç§°ä¸º æž„æˆè¶…ç½‘ ã€‚ åœ¨è·¯ç”±è¡¨ä¸­çš„é¡¹ç›®ç”±â€œç½‘ç»œå‰ç¼€â€å’Œâ€œä¸‹ä¸€è·³åœ°å€â€ç»„æˆï¼Œåœ¨æŸ¥æ‰¾æ—¶å¯èƒ½ä¼šå¾—åˆ°ä¸æ­¢ä¸€ä¸ªåŒ¹é…ç»“æžœï¼Œåº”å½“é‡‡ç”¨æœ€é•¿å‰ç¼€åŒ¹é…æ¥ç¡®å®šåº”è¯¥åŒ¹é…å“ªä¸€ä¸ªã€‚ IP åœ°å€ä¸Žç‰©ç†åœ°å€ ç‰©ç†åœ°å€æ˜¯æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚ä½¿ç”¨çš„åœ°å€ã€‚ IP åœ°å€æ˜¯ç½‘ç»œå±‚å’Œä»¥ä¸Šå„å±‚ä½¿ç”¨çš„åœ°å€ï¼Œæ˜¯ä¸€ç§é€»è¾‘åœ°å€ã€‚ IP æ•°æ®æŠ¥æ ¼å¼ ç‰ˆæœ¬ - æœ‰ 4ï¼ˆIPv4ï¼‰å’Œ 6ï¼ˆIPv6ï¼‰ä¸¤ä¸ªå€¼ã€‚ é¦–éƒ¨é•¿åº¦ - å  4 ä½ï¼Œå› æ­¤æœ€å¤§åè¿›åˆ¶æ•°å€¼ä¸º 15ã€‚å€¼ä¸º 1 è¡¨ç¤ºçš„æ˜¯ 1 ä¸ª 32 ä½å­—çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯ 4 å­—èŠ‚ã€‚å› ä¸ºé¦–éƒ¨å›ºå®šé•¿åº¦ä¸º 20 å­—èŠ‚ï¼Œå› æ­¤è¯¥å€¼æœ€å°ä¸º 5ã€‚å¦‚æžœå¯é€‰å­—æ®µçš„é•¿åº¦ä¸æ˜¯ 4 å­—èŠ‚çš„æ•´æ•°å€ï¼Œå°±ç”¨å°¾éƒ¨çš„å¡«å……éƒ¨åˆ†æ¥å¡«å……ã€‚ åŒºåˆ†æœåŠ¡ - ç”¨æ¥èŽ·å¾—æ›´å¥½çš„æœåŠ¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸ä½¿ç”¨ã€‚ æ€»é•¿åº¦ - åŒ…æ‹¬é¦–éƒ¨é•¿åº¦å’Œæ•°æ®éƒ¨åˆ†é•¿åº¦ã€‚å  16 ä½ï¼Œå› æ­¤æ•°æ®æŠ¥çš„æœ€å¤§é•¿åº¦ä¸º 2 16 - 1 = 65535 å­—èŠ‚ã€‚ ç”Ÿå­˜æ—¶é—´ - TTLï¼Œå®ƒçš„å­˜åœ¨æ˜¯ä¸ºäº†é˜²æ­¢æ— æ³•äº¤ä»˜çš„æ•°æ®æŠ¥åœ¨äº’è”ç½‘ä¸­ä¸æ–­å…œåœˆå­ã€‚ä»¥è·¯ç”±å™¨è·³æ•°ä¸ºå•ä½ï¼Œå½“ TTL ä¸º 0 æ—¶å°±ä¸¢å¼ƒæ•°æ®æŠ¥ã€‚ åè®® - æŒ‡å‡ºæºå¸¦çš„æ•°æ®åº”è¯¥ä¸Šäº¤ç»™å“ªä¸ªåè®®è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚ ICMPã€TCPã€UDP ç­‰ã€‚ é¦–éƒ¨æ£€éªŒå’Œ - å› ä¸ºæ•°æ®æŠ¥æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼Œéƒ½è¦é‡æ–°è®¡ç®—æ£€éªŒå’Œï¼Œå› æ­¤æ£€éªŒå’Œä¸åŒ…å«æ•°æ®éƒ¨åˆ†å¯ä»¥å‡å°‘è®¡ç®—çš„å·¥ä½œé‡ã€‚ æ ‡è¯† - åœ¨æ•°æ®æŠ¥é•¿åº¦è¿‡é•¿ä»Žè€Œå‘ç”Ÿåˆ†ç‰‡çš„æƒ…å†µä¸‹ï¼Œç›¸åŒæ•°æ®æŠ¥çš„ä¸åŒåˆ†ç‰‡å…·æœ‰ç›¸åŒçš„æ ‡è¯†ç¬¦ã€‚ ç‰‡åç§» - å’Œæ ‡è¯†ç¬¦ä¸€èµ·ï¼Œç”¨äºŽå‘ç”Ÿåˆ†ç‰‡çš„æƒ…å†µã€‚ç‰‡åç§»çš„å•ä½ä¸º 8 å­—èŠ‚ã€‚ åœ°å€è§£æžåè®® ARP ç½‘ç»œå±‚å®žçŽ°ä¸»æœºä¹‹é—´çš„é€šä¿¡ï¼Œè€Œé“¾è·¯å±‚å®žçŽ°å…·ä½“æ¯æ®µé“¾è·¯ä¹‹é—´çš„é€šä¿¡ã€‚å› æ­¤åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼ŒIP æ•°æ®æŠ¥çš„æºåœ°å€å’Œç›®çš„åœ°å€å§‹ç»ˆä¸å˜ï¼Œè€Œ MAC åœ°å€éšç€é“¾è·¯çš„æ”¹å˜è€Œæ”¹å˜ã€‚ ARP å®žçŽ°ç”± IP åœ°å€å¾—åˆ° MAC åœ°å€ã€‚ æ¯ä¸ªä¸»æœºéƒ½æœ‰ä¸€ä¸ª ARP é«˜é€Ÿç¼“å­˜ï¼Œé‡Œé¢æœ‰æœ¬å±€åŸŸç½‘ä¸Šçš„å„ä¸»æœºå’Œè·¯ç”±å™¨çš„ IP åœ°å€åˆ° MAC åœ°å€çš„æ˜ å°„è¡¨ã€‚ å¦‚æžœä¸»æœº A çŸ¥é“ä¸»æœº B çš„ IP åœ°å€ï¼Œä½†æ˜¯ ARP é«˜é€Ÿç¼“å­˜ä¸­æ²¡æœ‰è¯¥ IP åœ°å€åˆ° MAC åœ°å€çš„æ˜ å°„ï¼Œæ­¤æ—¶ä¸»æœº A é€šè¿‡å¹¿æ’­çš„æ–¹å¼å‘é€ ARP è¯·æ±‚åˆ†ç»„ï¼Œä¸»æœº B æ”¶åˆ°è¯¥è¯·æ±‚åŽä¼šå‘é€ ARP å“åº”åˆ†ç»„ç»™ä¸»æœº A å‘ŠçŸ¥å…¶ MAC åœ°å€ï¼ŒéšåŽä¸»æœº A å‘å…¶é«˜é€Ÿç¼“å­˜ä¸­å†™å…¥ä¸»æœº B çš„ IP åœ°å€åˆ° MAC åœ°å€çš„æ˜ å°„ã€‚ ç½‘é™…æŽ§åˆ¶æŠ¥æ–‡åè®® ICMP ICMP æ˜¯ä¸ºäº†æ›´æœ‰æ•ˆåœ°è½¬å‘ IP æ•°æ®æŠ¥å’Œæé«˜äº¤ä»˜æˆåŠŸçš„æœºä¼šã€‚å®ƒå°è£…åœ¨ IP æ•°æ®æŠ¥ä¸­ï¼Œä½†æ˜¯ä¸å±žäºŽé«˜å±‚åè®®ã€‚ ICMP æŠ¥æ–‡åˆ†ä¸ºå·®é”™æŠ¥å‘ŠæŠ¥æ–‡å’Œè¯¢é—®æŠ¥æ–‡ã€‚ 1. Ping Ping æ˜¯ ICMP çš„ä¸€ä¸ªé‡è¦åº”ç”¨ï¼Œä¸»è¦ç”¨æ¥æµ‹è¯•ä¸¤å°ä¸»æœºä¹‹é—´çš„è¿žé€šæ€§ã€‚ Ping çš„åŽŸç†æ˜¯é€šè¿‡å‘ç›®çš„ä¸»æœºå‘é€ ICMP Echo è¯·æ±‚æŠ¥æ–‡ï¼Œç›®çš„ä¸»æœºæ”¶åˆ°ä¹‹åŽä¼šå‘é€ Echo å›žç­”æŠ¥æ–‡ã€‚Ping ä¼šæ ¹æ®æ—¶é—´å’ŒæˆåŠŸå“åº”çš„æ¬¡æ•°ä¼°ç®—å‡ºæ•°æ®åŒ…å¾€è¿”æ—¶é—´ä»¥åŠä¸¢åŒ…çŽ‡ã€‚ 2. Traceroute Traceroute æ˜¯ ICMP çš„å¦ä¸€ä¸ªåº”ç”¨ï¼Œç”¨æ¥è·Ÿè¸ªä¸€ä¸ªåˆ†ç»„ä»Žæºç‚¹åˆ°ç»ˆç‚¹çš„è·¯å¾„ã€‚ Traceroute å‘é€çš„ IP æ•°æ®æŠ¥å°è£…çš„æ˜¯æ— æ³•äº¤ä»˜çš„ UDP ç”¨æˆ·æ•°æ®æŠ¥ï¼Œå¹¶ç”±ç›®çš„ä¸»æœºå‘é€ç»ˆç‚¹ä¸å¯è¾¾å·®é”™æŠ¥å‘ŠæŠ¥æ–‡ã€‚ æºä¸»æœºå‘ç›®çš„ä¸»æœºå‘é€ä¸€è¿žä¸²çš„ IP æ•°æ®æŠ¥ã€‚ç¬¬ä¸€ä¸ªæ•°æ®æŠ¥ P1 çš„ç”Ÿå­˜æ—¶é—´ TTL è®¾ç½®ä¸º 1ï¼Œå½“ P1 åˆ°è¾¾è·¯å¾„ä¸Šçš„ç¬¬ä¸€ä¸ªè·¯ç”±å™¨ R1 æ—¶ï¼ŒR1 æ”¶ä¸‹å®ƒå¹¶æŠŠ TTL å‡ 1ï¼Œæ­¤æ—¶ TTL ç­‰äºŽ 0ï¼ŒR1 å°±æŠŠ P1 ä¸¢å¼ƒï¼Œå¹¶å‘æºä¸»æœºå‘é€ä¸€ä¸ª ICMP æ—¶é—´è¶…è¿‡å·®é”™æŠ¥å‘ŠæŠ¥æ–‡ï¼› æºä¸»æœºæŽ¥ç€å‘é€ç¬¬äºŒä¸ªæ•°æ®æŠ¥ P2ï¼Œå¹¶æŠŠ TTL è®¾ç½®ä¸º 2ã€‚P2 å…ˆåˆ°è¾¾ R1ï¼ŒR1 æ”¶ä¸‹åŽæŠŠ TTL å‡ 1 å†è½¬å‘ç»™ R2ï¼ŒR2 æ”¶ä¸‹åŽä¹ŸæŠŠ TTL å‡ 1ï¼Œç”±äºŽæ­¤æ—¶ TTL ç­‰äºŽ 0ï¼ŒR2 å°±ä¸¢å¼ƒ P2ï¼Œå¹¶å‘æºä¸»æœºå‘é€ä¸€ä¸ª ICMP æ—¶é—´è¶…è¿‡å·®é”™æŠ¥æ–‡ã€‚ ä¸æ–­æ‰§è¡Œè¿™æ ·çš„æ­¥éª¤ï¼Œç›´åˆ°æœ€åŽä¸€ä¸ªæ•°æ®æŠ¥åˆšåˆšåˆ°è¾¾ç›®çš„ä¸»æœºï¼Œä¸»æœºä¸è½¬å‘æ•°æ®æŠ¥ï¼Œä¹Ÿä¸æŠŠ TTL å€¼å‡ 1ã€‚ä½†æ˜¯å› ä¸ºæ•°æ®æŠ¥å°è£…çš„æ˜¯æ— æ³•äº¤ä»˜çš„ UDPï¼Œå› æ­¤ç›®çš„ä¸»æœºè¦å‘æºä¸»æœºå‘é€ ICMP ç»ˆç‚¹ä¸å¯è¾¾å·®é”™æŠ¥å‘ŠæŠ¥æ–‡ã€‚ ä¹‹åŽæºä¸»æœºçŸ¥é“äº†åˆ°è¾¾ç›®çš„ä¸»æœºæ‰€ç»è¿‡çš„è·¯ç”±å™¨ IP åœ°å€ä»¥åŠåˆ°è¾¾æ¯ä¸ªè·¯ç”±å™¨çš„å¾€è¿”æ—¶é—´ã€‚ è™šæ‹Ÿä¸“ç”¨ç½‘ VPN ç”±äºŽ IP åœ°å€çš„ç´§ç¼ºï¼Œä¸€ä¸ªæœºæž„èƒ½ç”³è¯·åˆ°çš„ IP åœ°å€æ•°å¾€å¾€è¿œå°äºŽæœ¬æœºæž„æ‰€æ‹¥æœ‰çš„ä¸»æœºæ•°ã€‚å¹¶ä¸”ä¸€ä¸ªæœºæž„å¹¶ä¸éœ€è¦æŠŠæ‰€æœ‰çš„ä¸»æœºæŽ¥å…¥åˆ°å¤–éƒ¨çš„äº’è”ç½‘ä¸­ï¼Œæœºæž„å†…çš„è®¡ç®—æœºå¯ä»¥ä½¿ç”¨ä»…åœ¨æœ¬æœºæž„æœ‰æ•ˆçš„ IP åœ°å€ï¼ˆä¸“ç”¨åœ°å€ï¼‰ã€‚ æœ‰ä¸‰ä¸ªä¸“ç”¨åœ°å€å—ï¼š 10.0.0.0 ~ 10.255.255.255 172.16.0.0 ~ 172.31.255.255 192.168.0.0 ~ 192.168.255.255 VPN ä½¿ç”¨å…¬ç”¨çš„äº’è”ç½‘ä½œä¸ºæœ¬æœºæž„å„ä¸“ç”¨ç½‘ä¹‹é—´çš„é€šä¿¡è½½ä½“ã€‚ä¸“ç”¨æŒ‡æœºæž„å†…çš„ä¸»æœºåªä¸Žæœ¬æœºæž„å†…çš„å…¶å®ƒä¸»æœºé€šä¿¡ï¼›è™šæ‹ŸæŒ‡å¥½åƒæ˜¯ï¼Œè€Œå®žé™…ä¸Šå¹¶ä¸æ˜¯ï¼Œå®ƒæœ‰ç»è¿‡å…¬ç”¨çš„äº’è”ç½‘ã€‚ ä¸‹å›¾ä¸­ï¼Œåœºæ‰€ A å’Œ B çš„é€šä¿¡ç»è¿‡äº’è”ç½‘ï¼Œå¦‚æžœåœºæ‰€ A çš„ä¸»æœº X è¦å’Œå¦ä¸€ä¸ªåœºæ‰€ B çš„ä¸»æœº Y é€šä¿¡ï¼ŒIP æ•°æ®æŠ¥çš„æºåœ°å€æ˜¯ 10.1.0.1ï¼Œç›®çš„åœ°å€æ˜¯ 10.2.0.3ã€‚æ•°æ®æŠ¥å…ˆå‘é€åˆ°ä¸Žäº’è”ç½‘ç›¸è¿žçš„è·¯ç”±å™¨ R1ï¼ŒR1 å¯¹å†…éƒ¨æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç„¶åŽé‡æ–°åŠ ä¸Šæ•°æ®æŠ¥çš„é¦–éƒ¨ï¼Œæºåœ°å€æ˜¯è·¯ç”±å™¨ R1 çš„å…¨çƒåœ°å€ 125.1.2.3ï¼Œç›®çš„åœ°å€æ˜¯è·¯ç”±å™¨ R2 çš„å…¨çƒåœ°å€ 194.4.5.6ã€‚è·¯ç”±å™¨ R2 æ”¶åˆ°æ•°æ®æŠ¥åŽå°†æ•°æ®éƒ¨åˆ†è¿›è¡Œè§£å¯†ï¼Œæ¢å¤åŽŸæ¥çš„æ•°æ®æŠ¥ï¼Œæ­¤æ—¶ç›®çš„åœ°å€ä¸º 10.2.0.3ï¼Œå°±äº¤ä»˜ç»™ Yã€‚ ç½‘ç»œåœ°å€è½¬æ¢ NAT ä¸“ç”¨ç½‘å†…éƒ¨çš„ä¸»æœºä½¿ç”¨æœ¬åœ° IP åœ°å€åˆæƒ³å’Œäº’è”ç½‘ä¸Šçš„ä¸»æœºé€šä¿¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ NAT æ¥å°†æœ¬åœ° IP è½¬æ¢ä¸ºå…¨çƒ IPã€‚ åœ¨ä»¥å‰ï¼ŒNAT å°†æœ¬åœ° IP å’Œå…¨çƒ IP ä¸€ä¸€å¯¹åº”ï¼Œè¿™ç§æ–¹å¼ä¸‹æ‹¥æœ‰ n ä¸ªå…¨çƒ IP åœ°å€çš„ä¸“ç”¨ç½‘å†…æœ€å¤šåªå¯ä»¥åŒæ—¶æœ‰ n å°ä¸»æœºæŽ¥å…¥äº’è”ç½‘ã€‚ä¸ºäº†æ›´æœ‰æ•ˆåœ°åˆ©ç”¨å…¨çƒ IP åœ°å€ï¼ŒçŽ°åœ¨å¸¸ç”¨çš„ NAT è½¬æ¢è¡¨æŠŠä¼ è¾“å±‚çš„ç«¯å£å·ä¹Ÿç”¨ä¸Šäº†ï¼Œä½¿å¾—å¤šä¸ªä¸“ç”¨ç½‘å†…éƒ¨çš„ä¸»æœºå…±ç”¨ä¸€ä¸ªå…¨çƒ IP åœ°å€ã€‚ä½¿ç”¨ç«¯å£å·çš„ NAT ä¹Ÿå«åšç½‘ç»œåœ°å€ä¸Žç«¯å£è½¬æ¢ NAPTã€‚ è·¯ç”±å™¨çš„ç»“æž„ è·¯ç”±å™¨ä»ŽåŠŸèƒ½ä¸Šå¯ä»¥åˆ’åˆ†ä¸ºï¼šè·¯ç”±é€‰æ‹©å’Œåˆ†ç»„è½¬å‘ã€‚ åˆ†ç»„è½¬å‘ç»“æž„ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šäº¤æ¢ç»“æž„ã€ä¸€ç»„è¾“å…¥ç«¯å£å’Œä¸€ç»„è¾“å‡ºç«¯å£ã€‚ è·¯ç”±å™¨åˆ†ç»„è½¬å‘æµç¨‹ ä»Žæ•°æ®æŠ¥çš„é¦–éƒ¨æå–ç›®çš„ä¸»æœºçš„ IP åœ°å€ Dï¼Œå¾—åˆ°ç›®çš„ç½‘ç»œåœ°å€ Nã€‚ è‹¥ N å°±æ˜¯ä¸Žæ­¤è·¯ç”±å™¨ç›´æŽ¥ç›¸è¿žçš„æŸä¸ªç½‘ç»œåœ°å€ï¼Œåˆ™è¿›è¡Œç›´æŽ¥äº¤ä»˜ï¼› è‹¥è·¯ç”±è¡¨ä¸­æœ‰ç›®çš„åœ°å€ä¸º D çš„ç‰¹å®šä¸»æœºè·¯ç”±ï¼Œåˆ™æŠŠæ•°æ®æŠ¥ä¼ é€ç»™è¡¨ä¸­æ‰€æŒ‡æ˜Žçš„ä¸‹ä¸€è·³è·¯ç”±å™¨ï¼› è‹¥è·¯ç”±è¡¨ä¸­æœ‰åˆ°è¾¾ç½‘ç»œ N çš„è·¯ç”±ï¼Œåˆ™æŠŠæ•°æ®æŠ¥ä¼ é€ç»™è·¯ç”±è¡¨ä¸­æ‰€æŒ‡æ˜Žçš„ä¸‹ä¸€è·³è·¯ç”±å™¨ï¼› è‹¥è·¯ç”±è¡¨ä¸­æœ‰ä¸€ä¸ªé»˜è®¤è·¯ç”±ï¼Œåˆ™æŠŠæ•°æ®æŠ¥ä¼ é€ç»™è·¯ç”±è¡¨ä¸­æ‰€æŒ‡æ˜Žçš„é»˜è®¤è·¯ç”±å™¨ï¼› æŠ¥å‘Šè½¬å‘åˆ†ç»„å‡ºé”™ã€‚ è·¯ç”±é€‰æ‹©åè®® è·¯ç”±é€‰æ‹©åè®®éƒ½æ˜¯è‡ªé€‚åº”çš„ï¼Œèƒ½éšç€ç½‘ç»œé€šä¿¡é‡å’Œæ‹“æ‰‘ç»“æž„çš„å˜åŒ–è€Œè‡ªé€‚åº”åœ°è¿›è¡Œè°ƒæ•´ã€‚ äº’è”ç½‘å¯ä»¥åˆ’åˆ†ä¸ºè®¸å¤šè¾ƒå°çš„è‡ªæ²»ç³»ç»Ÿ ASï¼Œä¸€ä¸ª AS å¯ä»¥ä½¿ç”¨ä¸€ç§å’Œåˆ«çš„ AS ä¸åŒçš„è·¯ç”±é€‰æ‹©åè®®ã€‚ å¯ä»¥æŠŠè·¯ç”±é€‰æ‹©åè®®åˆ’åˆ†ä¸ºä¸¤å¤§ç±»ï¼š è‡ªæ²»ç³»ç»Ÿå†…éƒ¨çš„è·¯ç”±é€‰æ‹©ï¼šRIP å’Œ OSPF è‡ªæ²»ç³»ç»Ÿé—´çš„è·¯ç”±é€‰æ‹©ï¼šBGP 1. å†…éƒ¨ç½‘å…³åè®® RIP RIP æ˜¯ä¸€ç§åŸºäºŽè·ç¦»å‘é‡çš„è·¯ç”±é€‰æ‹©åè®®ã€‚è·ç¦»æ˜¯æŒ‡è·³æ•°ï¼Œç›´æŽ¥ç›¸è¿žçš„è·¯ç”±å™¨è·³æ•°ä¸º 1ã€‚è·³æ•°æœ€å¤šä¸º 15ï¼Œè¶…è¿‡ 15 è¡¨ç¤ºä¸å¯è¾¾ã€‚ RIP æŒ‰å›ºå®šçš„æ—¶é—´é—´éš”ä»…å’Œç›¸é‚»è·¯ç”±å™¨äº¤æ¢è‡ªå·±çš„è·¯ç”±è¡¨ï¼Œç»è¿‡è‹¥å¹²æ¬¡äº¤æ¢ä¹‹åŽï¼Œæ‰€æœ‰è·¯ç”±å™¨æœ€ç»ˆä¼šçŸ¥é“åˆ°è¾¾æœ¬è‡ªæ²»ç³»ç»Ÿä¸­ä»»ä½•ä¸€ä¸ªç½‘ç»œçš„æœ€çŸ­è·ç¦»å’Œä¸‹ä¸€è·³è·¯ç”±å™¨åœ°å€ã€‚ è·ç¦»å‘é‡ç®—æ³•ï¼š å¯¹åœ°å€ä¸º X çš„ç›¸é‚»è·¯ç”±å™¨å‘æ¥çš„ RIP æŠ¥æ–‡ï¼Œå…ˆä¿®æ”¹æŠ¥æ–‡ä¸­çš„æ‰€æœ‰é¡¹ç›®ï¼ŒæŠŠä¸‹ä¸€è·³å­—æ®µä¸­çš„åœ°å€æ”¹ä¸º Xï¼Œå¹¶æŠŠæ‰€æœ‰çš„è·ç¦»å­—æ®µåŠ  1ï¼› å¯¹ä¿®æ”¹åŽçš„ RIP æŠ¥æ–‡ä¸­çš„æ¯ä¸€ä¸ªé¡¹ç›®ï¼Œè¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š è‹¥åŽŸæ¥çš„è·¯ç”±è¡¨ä¸­æ²¡æœ‰ç›®çš„ç½‘ç»œ Nï¼Œåˆ™æŠŠè¯¥é¡¹ç›®æ·»åŠ åˆ°è·¯ç”±è¡¨ä¸­ï¼› å¦åˆ™ï¼šè‹¥ä¸‹ä¸€è·³è·¯ç”±å™¨åœ°å€æ˜¯ Xï¼Œåˆ™æŠŠæ”¶åˆ°çš„é¡¹ç›®æ›¿æ¢åŽŸæ¥è·¯ç”±è¡¨ä¸­çš„é¡¹ç›®ï¼›å¦åˆ™ï¼šè‹¥æ”¶åˆ°çš„é¡¹ç›®ä¸­çš„è·ç¦» d å°äºŽè·¯ç”±è¡¨ä¸­çš„è·ç¦»ï¼Œåˆ™è¿›è¡Œæ›´æ–°ï¼ˆä¾‹å¦‚åŽŸå§‹è·¯ç”±è¡¨é¡¹ä¸º Net2, 5, Pï¼Œæ–°è¡¨é¡¹ä¸º Net2, 4, Xï¼Œåˆ™æ›´æ–°ï¼‰ï¼›å¦åˆ™ä»€ä¹ˆä¹Ÿä¸åšã€‚ è‹¥ 3 åˆ†é’Ÿè¿˜æ²¡æœ‰æ”¶åˆ°ç›¸é‚»è·¯ç”±å™¨çš„æ›´æ–°è·¯ç”±è¡¨ï¼Œåˆ™æŠŠè¯¥ç›¸é‚»è·¯ç”±å™¨æ ‡ä¸ºä¸å¯è¾¾ï¼Œå³æŠŠè·ç¦»ç½®ä¸º 16ã€‚ RIP åè®®å®žçŽ°ç®€å•ï¼Œå¼€é”€å°ã€‚ä½†æ˜¯ RIP èƒ½ä½¿ç”¨çš„æœ€å¤§è·ç¦»ä¸º 15ï¼Œé™åˆ¶äº†ç½‘ç»œçš„è§„æ¨¡ã€‚å¹¶ä¸”å½“ç½‘ç»œå‡ºçŽ°æ•…éšœæ—¶ï¼Œè¦ç»è¿‡æ¯”è¾ƒé•¿çš„æ—¶é—´æ‰èƒ½å°†æ­¤æ¶ˆæ¯ä¼ é€åˆ°æ‰€æœ‰è·¯ç”±å™¨ã€‚ 2. å†…éƒ¨ç½‘å…³åè®® OSPF å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆ OSPFï¼Œæ˜¯ä¸ºäº†å…‹æœ RIP çš„ç¼ºç‚¹è€Œå¼€å‘å‡ºæ¥çš„ã€‚ å¼€æ”¾è¡¨ç¤º OSPF ä¸å—æŸä¸€å®¶åŽ‚å•†æŽ§åˆ¶ï¼Œè€Œæ˜¯å…¬å¼€å‘è¡¨çš„ï¼›æœ€çŸ­è·¯å¾„ä¼˜å…ˆè¡¨ç¤ºä½¿ç”¨äº† Dijkstra æå‡ºçš„æœ€çŸ­è·¯å¾„ç®—æ³• SPFã€‚ OSPF å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š å‘æœ¬è‡ªæ²»ç³»ç»Ÿä¸­çš„æ‰€æœ‰è·¯ç”±å™¨å‘é€ä¿¡æ¯ï¼Œè¿™ç§æ–¹æ³•æ˜¯æ´ªæ³›æ³•ã€‚ å‘é€çš„ä¿¡æ¯å°±æ˜¯ä¸Žç›¸é‚»è·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€ï¼Œé“¾è·¯çŠ¶æ€åŒ…æ‹¬ä¸Žå“ªäº›è·¯ç”±å™¨ç›¸è¿žä»¥åŠé“¾è·¯çš„åº¦é‡ï¼Œåº¦é‡ç”¨è´¹ç”¨ã€è·ç¦»ã€æ—¶å»¶ã€å¸¦å®½ç­‰æ¥è¡¨ç¤ºã€‚ åªæœ‰å½“é“¾è·¯çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè·¯ç”±å™¨æ‰ä¼šå‘é€ä¿¡æ¯ã€‚ æ‰€æœ‰è·¯ç”±å™¨éƒ½å…·æœ‰å…¨ç½‘çš„æ‹“æ‰‘ç»“æž„å›¾ï¼Œå¹¶ä¸”æ˜¯ä¸€è‡´çš„ã€‚ç›¸æ¯”äºŽ RIPï¼ŒOSPF çš„æ›´æ–°è¿‡ç¨‹æ”¶æ•›çš„å¾ˆå¿«ã€‚ 3. å¤–éƒ¨ç½‘å…³åè®® BGP BGPï¼ˆBorder Gateway Protocolï¼Œè¾¹ç•Œç½‘å…³åè®®ï¼‰ AS ä¹‹é—´çš„è·¯ç”±é€‰æ‹©å¾ˆå›°éš¾ï¼Œä¸»è¦æ˜¯ç”±äºŽï¼š äº’è”ç½‘è§„æ¨¡å¾ˆå¤§ï¼› å„ä¸ª AS å†…éƒ¨ä½¿ç”¨ä¸åŒçš„è·¯ç”±é€‰æ‹©åè®®ï¼Œæ— æ³•å‡†ç¡®å®šä¹‰è·¯å¾„çš„åº¦é‡ï¼› AS ä¹‹é—´çš„è·¯ç”±é€‰æ‹©å¿…é¡»è€ƒè™‘æœ‰å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æœ‰äº› AS ä¸æ„¿æ„è®©å…¶å®ƒ AS ç»è¿‡ã€‚ BGP åªèƒ½å¯»æ‰¾ä¸€æ¡æ¯”è¾ƒå¥½çš„è·¯ç”±ï¼Œè€Œä¸æ˜¯æœ€ä½³è·¯ç”±ã€‚ æ¯ä¸ª AS éƒ½å¿…é¡»é…ç½® BGP å‘è¨€äººï¼Œé€šè¿‡åœ¨ä¸¤ä¸ªç›¸é‚» BGP å‘è¨€äººä¹‹é—´å»ºç«‹ TCP è¿žæŽ¥æ¥äº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚]]></content>
      <categories>
        <category>communication</category>
      </categories>
      <tags>
        <tag>communication</tag>
        <tag>network</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¡ç®—æœºç½‘ç»œä¹‹ä¼ è¾“å±‚]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fcommunication%2Fnetwork-transport%2F</url>
    <content type="text"><![CDATA[è®¡ç®—æœºç½‘ç»œä¹‹ä¼ è¾“å±‚ ç½‘ç»œå±‚åªæŠŠåˆ†ç»„å‘é€åˆ°ç›®çš„ä¸»æœºï¼Œä½†æ˜¯çœŸæ­£é€šä¿¡çš„å¹¶ä¸æ˜¯ä¸»æœºè€Œæ˜¯ä¸»æœºä¸­çš„è¿›ç¨‹ã€‚ä¼ è¾“å±‚æä¾›äº†è¿›ç¨‹é—´çš„é€»è¾‘é€šä¿¡ï¼Œä¼ è¾“å±‚å‘é«˜å±‚ç”¨æˆ·å±è”½äº†ä¸‹é¢ç½‘ç»œå±‚çš„æ ¸å¿ƒç»†èŠ‚ï¼Œä½¿åº”ç”¨ç¨‹åºçœ‹èµ·æ¥åƒæ˜¯åœ¨ä¸¤ä¸ªä¼ è¾“å±‚å®žä½“ä¹‹é—´æœ‰ä¸€æ¡ç«¯åˆ°ç«¯çš„é€»è¾‘é€šä¿¡ä¿¡é“ã€‚ UDP å’Œ TCP çš„ç‰¹ç‚¹ UDP é¦–éƒ¨æ ¼å¼ TCP é¦–éƒ¨æ ¼å¼ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ TCP çš„å››æ¬¡æŒ¥æ‰‹ TCP å¯é ä¼ è¾“ TCP æ»‘åŠ¨çª—å£ TCP æµé‡æŽ§åˆ¶ TCP æ‹¥å¡žæŽ§åˆ¶ 1. æ…¢å¼€å§‹ä¸Žæ‹¥å¡žé¿å… 2. å¿«é‡ä¼ ä¸Žå¿«æ¢å¤ UDP å’Œ TCP çš„ç‰¹ç‚¹ ç”¨æˆ·æ•°æ®æŠ¥åè®® UDPï¼ˆUser Datagram Protocolï¼‰æ˜¯æ— è¿žæŽ¥çš„ï¼Œå°½æœ€å¤§å¯èƒ½äº¤ä»˜ï¼Œæ²¡æœ‰æ‹¥å¡žæŽ§åˆ¶ï¼Œé¢å‘æŠ¥æ–‡ï¼ˆå¯¹äºŽåº”ç”¨ç¨‹åºä¼ ä¸‹æ¥çš„æŠ¥æ–‡ä¸åˆå¹¶ä¹Ÿä¸æ‹†åˆ†ï¼Œåªæ˜¯æ·»åŠ  UDP é¦–éƒ¨ï¼‰ï¼Œæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ã€‚ ä¼ è¾“æŽ§åˆ¶åè®® TCPï¼ˆTransmission Control Protocolï¼‰æ˜¯é¢å‘è¿žæŽ¥çš„ï¼Œæä¾›å¯é äº¤ä»˜ï¼Œæœ‰æµé‡æŽ§åˆ¶ï¼Œæ‹¥å¡žæŽ§åˆ¶ï¼Œæä¾›å…¨åŒå·¥é€šä¿¡ï¼Œé¢å‘å­—èŠ‚æµï¼ˆæŠŠåº”ç”¨å±‚ä¼ ä¸‹æ¥çš„æŠ¥æ–‡çœ‹æˆå­—èŠ‚æµï¼ŒæŠŠå­—èŠ‚æµç»„ç»‡æˆå¤§å°ä¸ç­‰çš„æ•°æ®å—ï¼‰ï¼Œæ¯ä¸€æ¡ TCP è¿žæŽ¥åªèƒ½æ˜¯ç‚¹å¯¹ç‚¹çš„ï¼ˆä¸€å¯¹ä¸€ï¼‰ã€‚ UDP é¦–éƒ¨æ ¼å¼ é¦–éƒ¨å­—æ®µåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼ŒåŒ…æ‹¬æºç«¯å£ã€ç›®çš„ç«¯å£ã€é•¿åº¦ã€æ£€éªŒå’Œã€‚12 å­—èŠ‚çš„ä¼ªé¦–éƒ¨æ˜¯ä¸ºäº†è®¡ç®—æ£€éªŒå’Œä¸´æ—¶æ·»åŠ çš„ã€‚ TCP é¦–éƒ¨æ ¼å¼ åºå· ï¼šç”¨äºŽå¯¹å­—èŠ‚æµè¿›è¡Œç¼–å·ï¼Œä¾‹å¦‚åºå·ä¸º 301ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ä¸º 301ï¼Œå¦‚æžœæºå¸¦çš„æ•°æ®é•¿åº¦ä¸º 100 å­—èŠ‚ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·åº”ä¸º 401ã€‚ ç¡®è®¤å· ï¼šæœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·ã€‚ä¾‹å¦‚ B æ­£ç¡®æ”¶åˆ° A å‘é€æ¥çš„ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œåºå·ä¸º 501ï¼Œæºå¸¦çš„æ•°æ®é•¿åº¦ä¸º 200 å­—èŠ‚ï¼Œå› æ­¤ B æœŸæœ›ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·ä¸º 701ï¼ŒB å‘é€ç»™ A çš„ç¡®è®¤æŠ¥æ–‡æ®µä¸­ç¡®è®¤å·å°±ä¸º 701ã€‚ æ•°æ®åç§» ï¼šæŒ‡çš„æ˜¯æ•°æ®éƒ¨åˆ†è·ç¦»æŠ¥æ–‡æ®µèµ·å§‹å¤„çš„åç§»é‡ï¼Œå®žé™…ä¸ŠæŒ‡çš„æ˜¯é¦–éƒ¨çš„é•¿åº¦ã€‚ ç¡®è®¤ ACK ï¼šå½“ ACK=1 æ—¶ç¡®è®¤å·å­—æ®µæœ‰æ•ˆï¼Œå¦åˆ™æ— æ•ˆã€‚TCP è§„å®šï¼Œåœ¨è¿žæŽ¥å»ºç«‹åŽæ‰€æœ‰ä¼ é€çš„æŠ¥æ–‡æ®µéƒ½å¿…é¡»æŠŠ ACK ç½® 1ã€‚ åŒæ­¥ SYN ï¼šåœ¨è¿žæŽ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚å½“ SYN=1ï¼ŒACK=0 æ—¶è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚è‹¥å¯¹æ–¹åŒæ„å»ºç«‹è¿žæŽ¥ï¼Œåˆ™å“åº”æŠ¥æ–‡ä¸­ SYN=1ï¼ŒACK=1ã€‚ ç»ˆæ­¢ FIN ï¼šç”¨æ¥é‡Šæ”¾ä¸€ä¸ªè¿žæŽ¥ï¼Œå½“ FIN=1 æ—¶ï¼Œè¡¨ç¤ºæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿žæŽ¥ã€‚ çª—å£ ï¼šçª—å£å€¼ä½œä¸ºæŽ¥æ”¶æ–¹è®©å‘é€æ–¹è®¾ç½®å…¶å‘é€çª—å£çš„ä¾æ®ã€‚ä¹‹æ‰€ä»¥è¦æœ‰è¿™ä¸ªé™åˆ¶ï¼Œæ˜¯å› ä¸ºæŽ¥æ”¶æ–¹çš„æ•°æ®ç¼“å­˜ç©ºé—´æ˜¯æœ‰é™çš„ã€‚ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ å‡è®¾ A ä¸ºå®¢æˆ·ç«¯ï¼ŒB ä¸ºæœåŠ¡å™¨ç«¯ã€‚ é¦–å…ˆ B å¤„äºŽ LISTENï¼ˆç›‘å¬ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·çš„è¿žæŽ¥è¯·æ±‚ã€‚ A å‘ B å‘é€è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡ï¼ŒSYN=1ï¼ŒACK=0ï¼Œé€‰æ‹©ä¸€ä¸ªåˆå§‹çš„åºå· xã€‚ B æ”¶åˆ°è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡ï¼Œå¦‚æžœåŒæ„å»ºç«‹è¿žæŽ¥ï¼Œåˆ™å‘ A å‘é€è¿žæŽ¥ç¡®è®¤æŠ¥æ–‡ï¼ŒSYN=1ï¼ŒACK=1ï¼Œç¡®è®¤å·ä¸º x+1ï¼ŒåŒæ—¶ä¹Ÿé€‰æ‹©ä¸€ä¸ªåˆå§‹çš„åºå· yã€‚ A æ”¶åˆ° B çš„è¿žæŽ¥ç¡®è®¤æŠ¥æ–‡åŽï¼Œè¿˜è¦å‘ B å‘å‡ºç¡®è®¤ï¼Œç¡®è®¤å·ä¸º y+1ï¼Œåºå·ä¸º x+1ã€‚ B æ”¶åˆ° A çš„ç¡®è®¤åŽï¼Œè¿žæŽ¥å»ºç«‹ã€‚ ä¸‰æ¬¡æ¡æ‰‹çš„åŽŸå›  ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ˜¯ä¸ºäº†é˜²æ­¢å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ï¼Œè®©æœåŠ¡å™¨é”™è¯¯æ‰“å¼€è¿žæŽ¥ã€‚ å®¢æˆ·ç«¯å‘é€çš„è¿žæŽ¥è¯·æ±‚å¦‚æžœåœ¨ç½‘ç»œä¸­æ»žç•™ï¼Œé‚£ä¹ˆå°±ä¼šéš”å¾ˆé•¿ä¸€æ®µæ—¶é—´æ‰èƒ½æ”¶åˆ°æœåŠ¡å™¨ç«¯å‘å›žçš„è¿žæŽ¥ç¡®è®¤ã€‚å®¢æˆ·ç«¯ç­‰å¾…ä¸€ä¸ªè¶…æ—¶é‡ä¼ æ—¶é—´ä¹‹åŽï¼Œå°±ä¼šé‡æ–°è¯·æ±‚è¿žæŽ¥ã€‚ä½†æ˜¯è¿™ä¸ªæ»žç•™çš„è¿žæŽ¥è¯·æ±‚æœ€åŽè¿˜æ˜¯ä¼šåˆ°è¾¾æœåŠ¡å™¨ï¼Œå¦‚æžœä¸è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šæ‰“å¼€ä¸¤ä¸ªè¿žæŽ¥ã€‚å¦‚æžœæœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯ä¼šå¿½ç•¥æœåŠ¡å™¨ä¹‹åŽå‘é€çš„å¯¹æ»žç•™è¿žæŽ¥è¯·æ±‚çš„è¿žæŽ¥ç¡®è®¤ï¼Œä¸è¿›è¡Œç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œå› æ­¤å°±ä¸ä¼šå†æ¬¡æ‰“å¼€è¿žæŽ¥ã€‚ TCP çš„å››æ¬¡æŒ¥æ‰‹ ä»¥ä¸‹æè¿°ä¸è®¨è®ºåºå·å’Œç¡®è®¤å·ï¼Œå› ä¸ºåºå·å’Œç¡®è®¤å·çš„è§„åˆ™æ¯”è¾ƒç®€å•ã€‚å¹¶ä¸”ä¸è®¨è®º ACKï¼Œå› ä¸º ACK åœ¨è¿žæŽ¥å»ºç«‹ä¹‹åŽéƒ½ä¸º 1ã€‚ A å‘é€è¿žæŽ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ã€‚ B æ”¶åˆ°ä¹‹åŽå‘å‡ºç¡®è®¤ï¼Œæ­¤æ—¶ TCP å±žäºŽåŠå…³é—­çŠ¶æ€ï¼ŒB èƒ½å‘ A å‘é€æ•°æ®ä½†æ˜¯ A ä¸èƒ½å‘ B å‘é€æ•°æ®ã€‚ å½“ B ä¸å†éœ€è¦è¿žæŽ¥æ—¶ï¼Œå‘é€è¿žæŽ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ã€‚ A æ”¶åˆ°åŽå‘å‡ºç¡®è®¤ï¼Œè¿›å…¥ TIME-WAIT çŠ¶æ€ï¼Œç­‰å¾… 2 MSLï¼ˆæœ€å¤§æŠ¥æ–‡å­˜æ´»æ—¶é—´ï¼‰åŽé‡Šæ”¾è¿žæŽ¥ã€‚ B æ”¶åˆ° A çš„ç¡®è®¤åŽé‡Šæ”¾è¿žæŽ¥ã€‚ å››æ¬¡æŒ¥æ‰‹çš„åŽŸå›  å®¢æˆ·ç«¯å‘é€äº† FIN è¿žæŽ¥é‡Šæ”¾æŠ¥æ–‡ä¹‹åŽï¼ŒæœåŠ¡å™¨æ”¶åˆ°äº†è¿™ä¸ªæŠ¥æ–‡ï¼Œå°±è¿›å…¥äº† CLOSE-WAIT çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€æ˜¯ä¸ºäº†è®©æœåŠ¡å™¨ç«¯å‘é€è¿˜æœªä¼ é€å®Œæ¯•çš„æ•°æ®ï¼Œä¼ é€å®Œæ¯•ä¹‹åŽï¼ŒæœåŠ¡å™¨ä¼šå‘é€ FIN è¿žæŽ¥é‡Šæ”¾æŠ¥æ–‡ã€‚ TIME_WAIT å®¢æˆ·ç«¯æŽ¥æ”¶åˆ°æœåŠ¡å™¨ç«¯çš„ FIN æŠ¥æ–‡åŽè¿›å…¥æ­¤çŠ¶æ€ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯ç›´æŽ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œè¿˜éœ€è¦ç­‰å¾…ä¸€ä¸ªæ—¶é—´è®¡æ—¶å™¨è®¾ç½®çš„æ—¶é—´ 2MSLã€‚è¿™ä¹ˆåšæœ‰ä¸¤ä¸ªç†ç”±ï¼š ç¡®ä¿æœ€åŽä¸€ä¸ªç¡®è®¤æŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾ã€‚å¦‚æžœ B æ²¡æ”¶åˆ° A å‘é€æ¥çš„ç¡®è®¤æŠ¥æ–‡ï¼Œé‚£ä¹ˆå°±ä¼šé‡æ–°å‘é€è¿žæŽ¥é‡Šæ”¾è¯·æ±‚æŠ¥æ–‡ï¼ŒA ç­‰å¾…ä¸€æ®µæ—¶é—´å°±æ˜¯ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚ ç­‰å¾…ä¸€æ®µæ—¶é—´æ˜¯ä¸ºäº†è®©æœ¬è¿žæŽ¥æŒç»­æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡éƒ½ä»Žç½‘ç»œä¸­æ¶ˆå¤±ï¼Œä½¿å¾—ä¸‹ä¸€ä¸ªæ–°çš„è¿žæŽ¥ä¸ä¼šå‡ºçŽ°æ—§çš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡ã€‚ TCP å¯é ä¼ è¾“ TCP ä½¿ç”¨è¶…æ—¶é‡ä¼ æ¥å®žçŽ°å¯é ä¼ è¾“ï¼šå¦‚æžœä¸€ä¸ªå·²ç»å‘é€çš„æŠ¥æ–‡æ®µåœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œé‚£ä¹ˆå°±é‡ä¼ è¿™ä¸ªæŠ¥æ–‡æ®µã€‚ ä¸€ä¸ªæŠ¥æ–‡æ®µä»Žå‘é€å†åˆ°æŽ¥æ”¶åˆ°ç¡®è®¤æ‰€ç»è¿‡çš„æ—¶é—´ç§°ä¸ºå¾€è¿”æ—¶é—´ RTTï¼ŒåŠ æƒå¹³å‡å¾€è¿”æ—¶é—´ RTTs è®¡ç®—å¦‚ä¸‹ï¼š å…¶ä¸­ï¼Œ0 â‰¤ a ï¼œ 1ï¼ŒRTTs éšç€ a çš„å¢žåŠ æ›´å®¹æ˜“å—åˆ° RTT çš„å½±å“ã€‚ è¶…æ—¶æ—¶é—´ RTO åº”è¯¥ç•¥å¤§äºŽ RTTsï¼ŒTCP ä½¿ç”¨çš„è¶…æ—¶æ—¶é—´è®¡ç®—å¦‚ä¸‹ï¼š å…¶ä¸­ RTTd ä¸ºåå·®çš„åŠ æƒå¹³å‡å€¼ã€‚ TCP æ»‘åŠ¨çª—å£ çª—å£æ˜¯ç¼“å­˜çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥æš‚æ—¶å­˜æ”¾å­—èŠ‚æµã€‚å‘é€æ–¹å’ŒæŽ¥æ”¶æ–¹å„æœ‰ä¸€ä¸ªçª—å£ï¼ŒæŽ¥æ”¶æ–¹é€šè¿‡ TCP æŠ¥æ–‡æ®µä¸­çš„çª—å£å­—æ®µå‘Šè¯‰å‘é€æ–¹è‡ªå·±çš„çª—å£å¤§å°ï¼Œå‘é€æ–¹æ ¹æ®è¿™ä¸ªå€¼å’Œå…¶å®ƒä¿¡æ¯è®¾ç½®è‡ªå·±çš„çª—å£å¤§å°ã€‚ å‘é€çª—å£å†…çš„å­—èŠ‚éƒ½å…è®¸è¢«å‘é€ï¼ŒæŽ¥æ”¶çª—å£å†…çš„å­—èŠ‚éƒ½å…è®¸è¢«æŽ¥æ”¶ã€‚å¦‚æžœå‘é€çª—å£å·¦éƒ¨çš„å­—èŠ‚å·²ç»å‘é€å¹¶ä¸”æ”¶åˆ°äº†ç¡®è®¤ï¼Œé‚£ä¹ˆå°±å°†å‘é€çª—å£å‘å³æ»‘åŠ¨ä¸€å®šè·ç¦»ï¼Œç›´åˆ°å·¦éƒ¨ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸æ˜¯å·²å‘é€å¹¶ä¸”å·²ç¡®è®¤çš„çŠ¶æ€ï¼›æŽ¥æ”¶çª—å£çš„æ»‘åŠ¨ç±»ä¼¼ï¼ŒæŽ¥æ”¶çª—å£å·¦éƒ¨å­—èŠ‚å·²ç»å‘é€ç¡®è®¤å¹¶äº¤ä»˜ä¸»æœºï¼Œå°±å‘å³æ»‘åŠ¨æŽ¥æ”¶çª—å£ã€‚ æŽ¥æ”¶çª—å£åªä¼šå¯¹çª—å£å†…æœ€åŽä¸€ä¸ªæŒ‰åºåˆ°è¾¾çš„å­—èŠ‚è¿›è¡Œç¡®è®¤ï¼Œä¾‹å¦‚æŽ¥æ”¶çª—å£å·²ç»æ”¶åˆ°çš„å­—èŠ‚ä¸º {31, 34, 35}ï¼Œå…¶ä¸­ {31} æŒ‰åºåˆ°è¾¾ï¼Œè€Œ {34, 35} å°±ä¸æ˜¯ï¼Œå› æ­¤åªå¯¹å­—èŠ‚ 31 è¿›è¡Œç¡®è®¤ã€‚å‘é€æ–¹å¾—åˆ°ä¸€ä¸ªå­—èŠ‚çš„ç¡®è®¤ä¹‹åŽï¼Œå°±çŸ¥é“è¿™ä¸ªå­—èŠ‚ä¹‹å‰çš„æ‰€æœ‰å­—èŠ‚éƒ½å·²ç»è¢«æŽ¥æ”¶ã€‚ TCP æµé‡æŽ§åˆ¶ æµé‡æŽ§åˆ¶æ˜¯ä¸ºäº†æŽ§åˆ¶å‘é€æ–¹å‘é€é€ŸçŽ‡ï¼Œä¿è¯æŽ¥æ”¶æ–¹æ¥å¾—åŠæŽ¥æ”¶ã€‚ æŽ¥æ”¶æ–¹å‘é€çš„ç¡®è®¤æŠ¥æ–‡ä¸­çš„çª—å£å­—æ®µå¯ä»¥ç”¨æ¥æŽ§åˆ¶å‘é€æ–¹çª—å£å¤§å°ï¼Œä»Žè€Œå½±å“å‘é€æ–¹çš„å‘é€é€ŸçŽ‡ã€‚å°†çª—å£å­—æ®µè®¾ç½®ä¸º 0ï¼Œåˆ™å‘é€æ–¹ä¸èƒ½å‘é€æ•°æ®ã€‚ TCP æ‹¥å¡žæŽ§åˆ¶ å¦‚æžœç½‘ç»œå‡ºçŽ°æ‹¥å¡žï¼Œåˆ†ç»„å°†ä¼šä¸¢å¤±ï¼Œæ­¤æ—¶å‘é€æ–¹ä¼šç»§ç»­é‡ä¼ ï¼Œä»Žè€Œå¯¼è‡´ç½‘ç»œæ‹¥å¡žç¨‹åº¦æ›´é«˜ã€‚å› æ­¤å½“å‡ºçŽ°æ‹¥å¡žæ—¶ï¼Œåº”å½“æŽ§åˆ¶å‘é€æ–¹çš„é€ŸçŽ‡ã€‚è¿™ä¸€ç‚¹å’Œæµé‡æŽ§åˆ¶å¾ˆåƒï¼Œä½†æ˜¯å‡ºå‘ç‚¹ä¸åŒã€‚æµé‡æŽ§åˆ¶æ˜¯ä¸ºäº†è®©æŽ¥æ”¶æ–¹èƒ½æ¥å¾—åŠæŽ¥æ”¶ï¼Œè€Œæ‹¥å¡žæŽ§åˆ¶æ˜¯ä¸ºäº†é™ä½Žæ•´ä¸ªç½‘ç»œçš„æ‹¥å¡žç¨‹åº¦ã€‚ TCP ä¸»è¦é€šè¿‡å››ä¸ªç®—æ³•æ¥è¿›è¡Œæ‹¥å¡žæŽ§åˆ¶ï¼šæ…¢å¼€å§‹ã€æ‹¥å¡žé¿å…ã€å¿«é‡ä¼ ã€å¿«æ¢å¤ã€‚ å‘é€æ–¹éœ€è¦ç»´æŠ¤ä¸€ä¸ªå«åšæ‹¥å¡žçª—å£ï¼ˆcwndï¼‰çš„çŠ¶æ€å˜é‡ï¼Œæ³¨æ„æ‹¥å¡žçª—å£ä¸Žå‘é€æ–¹çª—å£çš„åŒºåˆ«ï¼šæ‹¥å¡žçª—å£åªæ˜¯ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œå®žé™…å†³å®šå‘é€æ–¹èƒ½å‘é€å¤šå°‘æ•°æ®çš„æ˜¯å‘é€æ–¹çª—å£ã€‚ ä¸ºäº†ä¾¿äºŽè®¨è®ºï¼Œåšå¦‚ä¸‹å‡è®¾ï¼š æŽ¥æ”¶æ–¹æœ‰è¶³å¤Ÿå¤§çš„æŽ¥æ”¶ç¼“å­˜ï¼Œå› æ­¤ä¸ä¼šå‘ç”Ÿæµé‡æŽ§åˆ¶ï¼› è™½ç„¶ TCP çš„çª—å£åŸºäºŽå­—èŠ‚ï¼Œä½†æ˜¯è¿™é‡Œè®¾çª—å£çš„å¤§å°å•ä½ä¸ºæŠ¥æ–‡æ®µã€‚ 1. æ…¢å¼€å§‹ä¸Žæ‹¥å¡žé¿å… å‘é€çš„æœ€åˆæ‰§è¡Œæ…¢å¼€å§‹ï¼Œä»¤ cwnd = 1ï¼Œå‘é€æ–¹åªèƒ½å‘é€ 1 ä¸ªæŠ¥æ–‡æ®µï¼›å½“æ”¶åˆ°ç¡®è®¤åŽï¼Œå°† cwnd åŠ å€ï¼Œå› æ­¤ä¹‹åŽå‘é€æ–¹èƒ½å¤Ÿå‘é€çš„æŠ¥æ–‡æ®µæ•°é‡ä¸ºï¼š2ã€4ã€8 â€¦ æ³¨æ„åˆ°æ…¢å¼€å§‹æ¯ä¸ªè½®æ¬¡éƒ½å°† cwnd åŠ å€ï¼Œè¿™æ ·ä¼šè®© cwnd å¢žé•¿é€Ÿåº¦éžå¸¸å¿«ï¼Œä»Žè€Œä½¿å¾—å‘é€æ–¹å‘é€çš„é€Ÿåº¦å¢žé•¿é€Ÿåº¦è¿‡å¿«ï¼Œç½‘ç»œæ‹¥å¡žçš„å¯èƒ½æ€§ä¹Ÿå°±æ›´é«˜ã€‚è®¾ç½®ä¸€ä¸ªæ…¢å¼€å§‹é—¨é™ ssthreshï¼Œå½“ cwnd &gt;= ssthresh æ—¶ï¼Œè¿›å…¥æ‹¥å¡žé¿å…ï¼Œæ¯ä¸ªè½®æ¬¡åªå°† cwnd åŠ  1ã€‚ å¦‚æžœå‡ºçŽ°äº†è¶…æ—¶ï¼Œåˆ™ä»¤ ssthresh = cwnd / 2ï¼Œç„¶åŽé‡æ–°æ‰§è¡Œæ…¢å¼€å§‹ã€‚ 2. å¿«é‡ä¼ ä¸Žå¿«æ¢å¤ åœ¨æŽ¥æ”¶æ–¹ï¼Œè¦æ±‚æ¯æ¬¡æŽ¥æ”¶åˆ°æŠ¥æ–‡æ®µéƒ½åº”è¯¥å¯¹æœ€åŽä¸€ä¸ªå·²æ”¶åˆ°çš„æœ‰åºæŠ¥æ–‡æ®µè¿›è¡Œç¡®è®¤ã€‚ä¾‹å¦‚å·²ç»æŽ¥æ”¶åˆ° M1 å’Œ M2ï¼Œæ­¤æ—¶æ”¶åˆ° M4ï¼Œåº”å½“å‘é€å¯¹ M2 çš„ç¡®è®¤ã€‚ åœ¨å‘é€æ–¹ï¼Œå¦‚æžœæ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µä¸¢å¤±ï¼Œæ­¤æ—¶æ‰§è¡Œå¿«é‡ä¼ ï¼Œç«‹å³é‡ä¼ ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µã€‚ä¾‹å¦‚æ”¶åˆ°ä¸‰ä¸ª M2ï¼Œåˆ™ M3 ä¸¢å¤±ï¼Œç«‹å³é‡ä¼  M3ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæ˜¯ä¸¢å¤±ä¸ªåˆ«æŠ¥æ–‡æ®µï¼Œè€Œä¸æ˜¯ç½‘ç»œæ‹¥å¡žã€‚å› æ­¤æ‰§è¡Œå¿«æ¢å¤ï¼Œä»¤ ssthresh = cwnd / 2 ï¼Œcwnd = ssthreshï¼Œæ³¨æ„åˆ°æ­¤æ—¶ç›´æŽ¥è¿›å…¥æ‹¥å¡žé¿å…ã€‚ æ…¢å¼€å§‹å’Œå¿«æ¢å¤çš„å¿«æ…¢æŒ‡çš„æ˜¯ cwnd çš„è®¾å®šå€¼ï¼Œè€Œä¸æ˜¯ cwnd çš„å¢žé•¿é€ŸçŽ‡ã€‚æ…¢å¼€å§‹ cwnd è®¾å®šä¸º 1ï¼Œè€Œå¿«æ¢å¤ cwnd è®¾å®šä¸º ssthreshã€‚]]></content>
      <categories>
        <category>communication</category>
      </categories>
      <tags>
        <tag>communication</tag>
        <tag>network</tag>
        <tag>transport</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HBase å‘½ä»¤]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fbigdata%2Fhbase%2Fhbase-cli%2F</url>
    <content type="text"><![CDATA[HBase å‘½ä»¤ 1. è¿žæŽ¥ HBase 2. æŸ¥è¯¢å¸®åŠ© 3. åˆ›å»ºè¡¨ 4. æŸ¥çœ‹è¡¨ä¿¡æ¯ 5. æŸ¥çœ‹è¡¨è¯¦ç»†ä¿¡æ¯ 6. å‘è¡¨ä¸­å†™æ•°æ® 7. æ‰«æè¡¨ 8. æŸ¥è¯¢ row 9. ç¦ç”¨ã€å¯ç”¨è¡¨ 10. åˆ é™¤è¡¨ 11. åœæ­¢ HBase 1. è¿žæŽ¥ HBase $ ./bin/hbase shellhbase(main):001:0&gt; 2. æŸ¥è¯¢å¸®åŠ© help 3. åˆ›å»ºè¡¨ create 'table1','columnFamliy1','columnFamliy2' è¯´æ˜Žï¼š åˆ›å»ºä¸€å¼ åä¸º table1 çš„ HBase è¡¨ï¼ŒcolumnFamliy1ã€columnFamliy2 æ˜¯ table1 è¡¨çš„åˆ—æ—ã€‚ 4. æŸ¥çœ‹è¡¨ä¿¡æ¯ list 'table1' 5. æŸ¥çœ‹è¡¨è¯¦ç»†ä¿¡æ¯ describe 'table1' 6. å‘è¡¨ä¸­å†™æ•°æ® put 'table1', 'row1', 'columnFamliy1:a', 'valueA'put 'table1', 'row1', 'columnFamliy1:b', 'valueB'put 'table1', 'row1', 'columnFamliy1:c', 'valueC'put 'table1', 'row2', 'columnFamliy1:a', 'valueA'put 'table1', 'row2', 'columnFamliy1:b', 'valueB'put 'table1', 'row2', 'columnFamliy1:c', 'valueC'put 'table1', 'row1', 'columnFamliy2:a', 'valueA'put 'table1', 'row1', 'columnFamliy2:b', 'valueB'put 'table1', 'row1', 'columnFamliy2:c', 'valueC' 7. æ‰«æè¡¨ hbase&gt; scan 'hbase:meta'hbase&gt; scan 'hbase:meta', &#123;COLUMNS =&gt; 'info:regioninfo'&#125;hbase&gt; scan 'ns1:hbase&gt; scan 't1', &#123;COLUMNS =&gt; ['c1', 'c2'], LIMIT =&gt; 10, STARTROW =&gt; 'xyz'&#125;hbase&gt; scan 't1', &#123;COLUMNS =&gt; 'c1', TIMERANGE =&gt; [1303668804, 1303668904]&#125;hbase&gt; scan 't1', &#123;REVERSED =&gt; true&#125;hbase&gt; scan 't1', &#123;ALL_METRICS =&gt; true&#125;hbase&gt; scan 't1', &#123;METRICS =&gt; ['RPC_RETRIES', 'ROWS_FILTERED']&#125;hbase&gt; scan 't1', &#123;ROWPREFIXFILTER =&gt; 'row2', FILTER =&gt; " (QualifierFilter (&gt;=, 'binary:xyz')) AND (TimestampsFilter ( 123, 456))"&#125;hbase&gt; scan 't1', &#123;FILTER =&gt; org.apache.hadoop.hbase.filter.ColumnPaginationFilter.new(1, 0)&#125;hbase&gt; scan 't1', &#123;CONSISTENCY =&gt; 'TIMELINE'&#125;For setting the Operation Attributes hbase&gt; scan 't1', &#123; COLUMNS =&gt; ['c1', 'c2'], ATTRIBUTES =&gt; &#123;'mykey' =&gt; 'myvalue'&#125;&#125;hbase&gt; scan 't1', &#123; COLUMNS =&gt; ['c1', 'c2'], AUTHORIZATIONS =&gt; ['PRIVATE','SECRET']&#125;For experts, there is an additional option -- CACHE_BLOCKS -- whichswitches block caching for the scanner on (true) or off (false). Bydefault it is enabled. Examples:hbase&gt; scan 't1', &#123;COLUMNS =&gt; ['c1', 'c2'], CACHE_BLOCKS =&gt; false&#125; 8. æŸ¥è¯¢ row get 'table1', 'row1'get 'table1', 'row1', 'columnFamliy1'get 'table1', 'row1', 'columnFamliy1:a' 9. ç¦ç”¨ã€å¯ç”¨è¡¨ hbase(main):008:0&gt; disable 'test'0 row(s) in 1.1820 secondshbase(main):009:0&gt; enable 'test'0 row(s) in 0.1770 seconds 10. åˆ é™¤è¡¨ hbase(main):011:0&gt; drop 'test'0 row(s) in 0.1370 seconds 11. åœæ­¢ HBase $ ./bin/stop-hbase.shstopping hbase....................$]]></content>
  </entry>
  <entry>
    <title><![CDATA[HDFS å‘½ä»¤]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fbigdata%2Fhdfs%2Fhdfs-cli%2F</url>
    <content type="text"><![CDATA[HDFS å‘½ä»¤ åˆ—å‡ºç›®å½•çš„å†…å®¹ï¼š $ hdfs dfs -ls / å°†æ–‡ä»¶ä»Žæœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½åˆ°HDFSï¼š $ hdfs dfs -put songs.txt /user/adam ä»ŽHDFSè¯»å–æ–‡ä»¶å†…å®¹ï¼š $ hdfs dfs -cat /user/adam/songs.txt æ›´æ”¹æ–‡ä»¶çš„æƒé™ï¼š $ hdfs dfs -chmod 700 /user/adam/songs.txt å°†æ–‡ä»¶çš„å¤åˆ¶å› å­è®¾ç½®ä¸º4ï¼š $ hdfs dfs -setrep -w 4 /user/adam/songs.txt æ£€æŸ¥æ–‡ä»¶çš„å¤§å°ï¼š $ hdfs dfs -du -h /user/adam/songs.txt Create a subdirectory in your home directory.$ hdfs dfs -mkdir songs æ³¨æ„ï¼Œç›¸å¯¹è·¯å¾„æ€»æ˜¯å¼•ç”¨æ‰§è¡Œå‘½ä»¤çš„ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚HDFSä¸Šæ²¡æœ‰â€œå½“å‰â€ç›®å½•çš„æ¦‚å¿µï¼ˆæ¢å¥è¯è¯´ï¼Œæ²¡æœ‰â€œCDâ€å‘½ä»¤ï¼‰ï¼š å°†æ–‡ä»¶ç§»åˆ°æ–°åˆ›å»ºçš„å­ç›®å½•ï¼š $ hdfs dfs -mv songs.txt songs ä»ŽHDFSä¸­åˆ é™¤ä¸€ä¸ªç›®å½•ï¼š $ hdfs dfs -rm -r songs]]></content>
  </entry>
  <entry>
    <title><![CDATA[å†›äº‹]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fminds%2F%E4%BA%BA%E6%96%87%2F%E5%86%9B%E4%BA%8B%2FREADME%2F</url>
    <content type="text"><![CDATA[å†›äº‹ å†›äº‹æ˜¯ä¸Žæˆ˜äº‰ã€å†›é˜Ÿã€å†›äººç­‰æœ‰å…³äº‹åŠ¡çš„æ€»ç§°ã€‚ å…³é”®è¯ æˆ˜äº‰ã€æˆ˜å½¹ã€æˆ˜æ–—ã€æˆ˜å£«ã€æˆ˜ç•¥ã€æˆ˜æœ¯ã€æ­¦å™¨ã€å…µç§ã€è¿›æ”»ã€é˜²å¾¡ã€æŒ‡æŒ¥ã€å…µæ³•ã€å†›è¡”]]></content>
  </entry>
  <entry>
    <title><![CDATA[åˆç†ç¼–æŽ’ä½ çš„æŠ€æœ¯æ–‡æ¡£]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fmethod%2Fdoc-style%2F</url>
    <content type="text"><![CDATA[æŠ€æœ¯æ–‡æ¡£è§„èŒƒ æ–‡æ¡£é‡‡ç”¨ Markdown è¯­æ³•ä¹¦å†™ã€‚ ðŸ“š ã€Œå‚è€ƒã€Markdown è¯­æ³•å¯ä»¥å‚è€ƒï¼š https://github.com/guodongxiaren/README https://github.com/tchapi/markdown-cheatsheet 1. æ ‡é¢˜ 1.1. æ ‡é¢˜å±‚çº§ 1.2. æ ‡é¢˜åŽŸåˆ™ 2. æ–‡æœ¬ 2.1. å­—é—´è· 2.2. å¥å­ 2.3. å†™ä½œé£Žæ ¼ 2.4. è‹±æ–‡å¤„ç† 3. æ®µè½ 3.1. æ®µè½åŽŸåˆ™ 3.2. å¼•ç”¨ 3.3. å¼ºè°ƒ 4. æ•°å€¼ 4.1. åŠè§’æ•°å­— 4.2. åƒåˆ†å· 4.3. è´§å¸ 4.4. æ•°å€¼èŒƒå›´ 4.5. å˜åŒ–ç¨‹åº¦çš„è¡¨ç¤ºæ³• 5. ç¬¦å· 5.1. ç¬¦å·åŽŸåˆ™ 5.2. å¥å· 5.3. é€—å· 5.4. é¡¿å· 5.5. åˆ†å· 5.6. å¼•å· 5.7. åœ†æ‹¬å· 5.8. å†’å· 5.9. çœç•¥å· 5.10. æ„Ÿå¹å· 5.11. ç ´æŠ˜å· 5.12. è¿žæŽ¥å· 6. ç»“æž„ 6.1. ç›®å½•ç»“æž„ 6.2. æ–‡ä»¶å 7. Emoji 8. å‚è€ƒ 1. æ ‡é¢˜ 1.1. æ ‡é¢˜å±‚çº§ æ ‡é¢˜åˆ†ä¸ºå››çº§ã€‚ ä¸€çº§æ ‡é¢˜ï¼šæ–‡ç« çš„æ ‡é¢˜ äºŒçº§æ ‡é¢˜ï¼šæ–‡ç« å†…å®¹çš„å¤§æ ‡é¢˜ ä¸‰çº§æ ‡é¢˜ï¼šäºŒçº§æ ‡é¢˜ä¸‹ä¸€çº§çš„æ ‡é¢˜ å››çº§æ ‡é¢˜ï¼šä¸‰çº§æ ‡é¢˜ä¸‹ä¸€çº§çš„æ ‡é¢˜ 1.2. æ ‡é¢˜åŽŸåˆ™ ä¸€ç¯‡æ–‡ç« ä¸­åº”è¯¥å°½åŠ›é¿å…åŒåæ ‡é¢˜ã€‚ ä¸€çº§æ ‡é¢˜ä¸‹ï¼Œä¸èƒ½ç›´æŽ¥å‡ºçŽ°ä¸‰çº§æ ‡é¢˜ã€‚ æ ‡é¢˜è¦é¿å…å­¤ç«‹ç¼–å·ï¼ˆå³åŒçº§æ ‡é¢˜åªæœ‰ä¸€ä¸ªï¼‰ã€‚ ä¸‹çº§æ ‡é¢˜ä¸é‡å¤ä¸Šä¸€çº§æ ‡é¢˜çš„å†…å®¹ã€‚ è°¨æ…Žä½¿ç”¨å››çº§æ ‡é¢˜ï¼Œå°½é‡é¿å…å‡ºçŽ°ï¼Œä¿æŒå±‚çº§çš„ç®€å•å’Œé˜²æ­¢å‡ºçŽ°è¿‡äºŽå¤æ‚çš„ç« èŠ‚ã€‚å¦‚æžœä¸‰çº§æ ‡é¢˜ä¸‹æœ‰å¹¶åˆ—æ€§çš„å†…å®¹ï¼Œå»ºè®®åªä½¿ç”¨é¡¹ç›®åˆ—è¡¨ï¼ˆItem listï¼‰ã€‚ 2. æ–‡æœ¬ 2.1. å­—é—´è· å…¨è§’ä¸­æ–‡å­—ç¬¦ä¸ŽåŠè§’è‹±æ–‡å­—ç¬¦ä¹‹é—´ï¼Œåº”æœ‰ä¸€ä¸ªåŠè§’ç©ºæ ¼ã€‚ åä¾‹ï¼šæœ¬æ–‡ä»‹ç»å¦‚ä½•å¿«é€Ÿå¯åŠ¨Windowsç³»ç»Ÿã€‚æ­£ä¾‹ï¼šæœ¬æ–‡ä»‹ç»å¦‚ä½•å¿«é€Ÿå¯åŠ¨ Windows ç³»ç»Ÿã€‚ å…¨è§’ä¸­æ–‡å­—ç¬¦ä¸ŽåŠè§’é˜¿æ‹‰ä¼¯æ•°å­—ä¹‹é—´ï¼Œæœ‰æ²¡æœ‰åŠè§’ç©ºæ ¼éƒ½å¯ï¼Œä½†å¿…é¡»ä¿è¯é£Žæ ¼ç»Ÿä¸€ï¼Œä¸èƒ½ä¸¤ç§é£Žæ ¼æ··æ‚ã€‚ æ­£ä¾‹ï¼š2011å¹´5æœˆ15æ—¥ï¼Œæˆ‘è®¢è´­äº†5å°ç¬”è®°æœ¬ç”µè„‘ä¸Ž10å°å¹³æ¿ç”µè„‘ã€‚æ­£ä¾‹ï¼š2011 å¹´ 5 æœˆ 15 æ—¥ï¼Œæˆ‘è®¢è´­äº† 5 å°ç¬”è®°æœ¬ç”µè„‘ä¸Ž 10 å°å¹³æ¿ç”µè„‘ã€‚ åŠè§’çš„ç™¾åˆ†å·ï¼Œè§†åŒé˜¿æ‹‰ä¼¯æ•°å­—ã€‚ è‹±æ–‡å•ä½è‹¥ä¸ç¿»è¯‘ï¼Œå•ä½å‰çš„é˜¿æ‹‰ä¼¯æ•°å­—ä¸Žå•ä½é—´ä¸ç•™ç©ºæ ¼ã€‚ åä¾‹ï¼šä¸€éƒ¨å®¹é‡ä¸º 16 GB çš„æ™ºèƒ½æ‰‹æœºæ­£ä¾‹ï¼šä¸€éƒ¨å®¹é‡ä¸º 16GB çš„æ™ºèƒ½æ‰‹æœº åŠè§’è‹±æ–‡å­—ç¬¦å’ŒåŠè§’é˜¿æ‹‰ä¼¯æ•°å­—ï¼Œä¸Žå…¨è§’æ ‡ç‚¹ç¬¦å·ä¹‹é—´ä¸ç•™ç©ºæ ¼ã€‚ åä¾‹ï¼šä»–çš„ç”µè„‘æ˜¯ MacBook Air ã€‚æ­£ä¾‹ï¼šä»–çš„ç”µè„‘æ˜¯ MacBook Airã€‚ 2.2. å¥å­ é¿å…ä½¿ç”¨é•¿å¥ã€‚ä¸€ä¸ªå¥å­å»ºè®®ä¸è¶…è¿‡ 100 å­—æˆ–è€…æ­£æ–‡çš„ 3 è¡Œã€‚ å°½é‡ä½¿ç”¨ç®€å•å¥å’Œå¹¶åˆ—å¥ï¼Œé¿å…ä½¿ç”¨å¤åˆå¥ã€‚ 2.3. å†™ä½œé£Žæ ¼ å°½é‡ä¸ä½¿ç”¨è¢«åŠ¨è¯­æ€ï¼Œæ”¹ä¸ºä½¿ç”¨ä¸»åŠ¨è¯­æ€ã€‚ åä¾‹ï¼šå‡å¦‚æ­¤è½¯ä»¶å°šæœªè¢«å®‰è£…ï¼Œæ­£ä¾‹ï¼šå‡å¦‚å°šæœªå®‰è£…è¿™ä¸ªè½¯ä»¶ï¼Œ ä¸ä½¿ç”¨éžæ­£å¼çš„è¯­è¨€é£Žæ ¼ã€‚ åä¾‹ï¼šLady Gaga çš„æ¼”å”±ä¼šçœŸæ˜¯é…·æ¯™äº†ï¼Œä»Žæ²¡çœ‹è¿‡è¿™ä¹ˆç»™åŠ›çš„è¡¨æ¼”ï¼ï¼ï¼æ­£ä¾‹ï¼šæ— æ³•å‚åŠ æœ¬æ¬¡æ´»åŠ¨ï¼Œæˆ‘æ·±æ„Ÿé—æ†¾ã€‚ ç”¨å¯¹â€œçš„â€ã€â€œåœ°â€ã€â€œå¾—â€ã€‚ å¥¹éœ²å‡ºäº†å¼€å¿ƒçš„ç¬‘å®¹ã€‚ï¼ˆå½¢å®¹è¯ï¼‹çš„ï¼‹åè¯ï¼‰å¥¹å¼€å¿ƒåœ°ç¬‘äº†ã€‚ï¼ˆå‰¯è¯ï¼‹åœ°ï¼‹åŠ¨è¯ï¼‰å¥¹ç¬‘å¾—å¾ˆå¼€å¿ƒã€‚ï¼ˆåŠ¨è¯ï¼‹å¾—ï¼‹å‰¯è¯ï¼‰ ä½¿ç”¨ä»£è¯æ—¶ï¼ˆæ¯”å¦‚â€œå…¶â€ã€â€œè¯¥â€ã€â€œæ­¤â€ã€â€œè¿™â€ç­‰è¯ï¼‰ï¼Œå¿…é¡»æ˜Žç¡®æŒ‡ä»£çš„å†…å®¹ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªå«ä¹‰ã€‚ åä¾‹ï¼šä»Žç®¡ç†ç³»ç»Ÿå¯ä»¥ç›‘è§†ä¸­ç»§ç³»ç»Ÿå’Œå—å…¶ç›´æŽ¥æŽ§åˆ¶çš„åˆ†é…ç³»ç»Ÿã€‚æ­£ä¾‹ï¼šä»Žç®¡ç†ç³»ç»Ÿå¯ä»¥ç›‘è§†ä¸¤ä¸ªç³»ç»Ÿï¼šä¸­ç»§ç³»ç»Ÿå’Œå—ä¸­ç»§ç³»ç»Ÿç›´æŽ¥æŽ§åˆ¶çš„åˆ†é…ç³»ç»Ÿã€‚ åè¯å‰ä¸è¦ä½¿ç”¨è¿‡å¤šçš„å½¢å®¹è¯ã€‚ åä¾‹ï¼šæ­¤è®¾å¤‡çš„ä½¿ç”¨å¿…é¡»åœ¨æŽ¥å—è¿‡æœ¬å…¬å¸ä¸¾åŠžçš„æ­£å¼çš„è®¾å¤‡åŸ¹è®­çš„æŠ€å¸ˆçš„æŒ‡å¯¼ä¸‹è¿›è¡Œã€‚æ­£ä¾‹ï¼šæ­¤è®¾å¤‡å¿…é¡»åœ¨æŠ€å¸ˆçš„æŒ‡å¯¼ä¸‹ä½¿ç”¨ï¼Œä¸”æŒ‡å¯¼æŠ€å¸ˆå¿…é¡»æŽ¥å—è¿‡ç”±æœ¬å…¬å¸ä¸¾åŠžçš„æ­£å¼è®¾å¤‡åŸ¹è®­ã€‚ å•ä¸ªå¥å­çš„é•¿åº¦å°½é‡ä¿æŒåœ¨ 20 ä¸ªå­—ä»¥å†…ï¼›20 ï½ž 29 ä¸ªå­—çš„å¥å­ï¼Œå¯ä»¥æŽ¥å—ï¼›30 ï½ž 39 ä¸ªå­—çš„å¥å­ï¼Œè¯­ä¹‰å¿…é¡»æ˜Žç¡®ï¼Œæ‰èƒ½æŽ¥å—ï¼›å¤šäºŽ 40 ä¸ªå­—çš„å¥å­ï¼Œåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸èƒ½æŽ¥å—ã€‚ åä¾‹ï¼šæœ¬äº§å“é€‚ç”¨äºŽä»Žç”±ä¸€å°æœåŠ¡å™¨è¿›è¡ŒåŠ¨ä½œæŽ§åˆ¶çš„å•ä¸€èŠ‚ç‚¹ç»“æž„åˆ°ç”±å¤šå°æœåŠ¡å™¨è¿›è¡ŒåŠ¨ä½œæŽ§åˆ¶çš„å¹¶è¡Œå¤„ç†ç¨‹åºç»“æž„ç­‰å¤šç§ä½“ç³»ç»“æž„ã€‚æ­£ä¾‹ï¼šæœ¬äº§å“é€‚ç”¨äºŽå¤šç§ä½“ç³»ç»“æž„ã€‚æ— è®ºæ˜¯ç”±ä¸€å°æœåŠ¡å™¨ï¼ˆå•ä¸€èŠ‚ç‚¹ç»“æž„ï¼‰ï¼Œè¿˜æ˜¯ç”±å¤šå°æœåŠ¡å™¨ï¼ˆå¹¶è¡Œå¤„ç†ç»“æž„ï¼‰è¿›è¡ŒåŠ¨ä½œæŽ§åˆ¶ï¼Œå‡å¯ä»¥ä½¿ç”¨æœ¬äº§å“ã€‚ åŒæ ·ä¸€ä¸ªæ„æ€ï¼Œå°½é‡ä½¿ç”¨è‚¯å®šå¥è¡¨è¾¾ï¼Œä¸ä½¿ç”¨å¦å®šå¥è¡¨è¾¾ã€‚ åä¾‹ï¼šè¯·ç¡®è®¤æ²¡æœ‰æŽ¥é€šè£…ç½®çš„ç”µæºã€‚æ­£ä¾‹ï¼šè¯·ç¡®è®¤è£…ç½®çš„ç”µæºå·²å…³é—­ã€‚ é¿å…ä½¿ç”¨åŒé‡å¦å®šå¥ã€‚ åä¾‹ï¼šæ²¡æœ‰åˆ é™¤æƒé™çš„ç”¨æˆ·ï¼Œä¸èƒ½åˆ é™¤æ­¤æ–‡ä»¶ã€‚æ­£ä¾‹ï¼šç”¨æˆ·å¿…é¡»æ‹¥æœ‰åˆ é™¤æƒé™ï¼Œæ‰èƒ½åˆ é™¤æ­¤æ–‡ä»¶ã€‚ 2.4. è‹±æ–‡å¤„ç† è‹±æ–‡åŽŸæ–‡å¦‚æžœä½¿ç”¨äº†å¤æ•°å½¢å¼ï¼Œç¿»è¯‘æˆä¸­æ–‡æ—¶ï¼Œåº”è¯¥å°†å…¶è¿˜åŽŸä¸ºå•æ•°å½¢å¼ã€‚ è‹±æ–‡ï¼šâ‹¯information stored in random access memory (RAMs)â‹¯ä¸­æ–‡ï¼šâ€¦â€¦å­˜å‚¨åœ¨éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆRAMï¼‰é‡Œçš„ä¿¡æ¯â€¦â€¦ å¤–æ–‡ç¼©å†™å¯ä»¥ä½¿ç”¨åŠè§’åœ†ç‚¹(.)è¡¨ç¤ºç¼©å†™ã€‚ U.S.A.Apple, Inc. è¡¨ç¤ºä¸­æ–‡æ—¶ï¼Œè‹±æ–‡çœç•¥å·ï¼ˆâ‹¯ï¼‰åº”æ”¹ä¸ºä¸­æ–‡çœç•¥å·ï¼ˆâ€¦â€¦ï¼‰ã€‚ è‹±æ–‡ï¼š5 minutes laterâ‹¯ä¸­æ–‡ï¼š5 åˆ†é’Ÿè¿‡åŽ»äº†â‹¯â‹¯ è‹±æ–‡ä¹¦åæˆ–ç”µå½±åæ”¹ç”¨ä¸­æ–‡è¡¨è¾¾æ—¶ï¼ŒåŒå¼•å·åº”æ”¹ä¸ºä¹¦åå·ã€‚ è‹±æ–‡ï¼šHe published an article entitled "The Future of the Aviation".ä¸­æ–‡ï¼šä»–å‘è¡¨äº†ä¸€ç¯‡åä¸ºã€Šèˆªç©ºä¸šçš„æœªæ¥ã€‹çš„æ–‡ç« ã€‚ ç¬¬ä¸€æ¬¡å‡ºçŽ°è‹±æ–‡è¯æ±‡æ—¶ï¼Œåœ¨æ‹¬å·ä¸­ç»™å‡ºä¸­æ–‡æ ‡æ³¨ã€‚æ­¤åŽå†æ¬¡å‡ºçŽ°æ—¶ï¼Œç›´æŽ¥ä½¿ç”¨è‹±æ–‡ç¼©å†™å³å¯ã€‚ IOCï¼ˆInternational Olympic Committeeï¼Œå›½é™…å¥¥æž—åŒ¹å…‹å§”å‘˜ä¼šï¼‰ã€‚è¿™æ ·å®šä¹‰åŽï¼Œä¾¿å¯ä»¥ç›´æŽ¥ä½¿ç”¨â€œIOCâ€äº†ã€‚ ä¸“æœ‰åè¯ä¸­æ¯ä¸ªè¯ç¬¬ä¸€ä¸ªå­—æ¯å‡åº”å¤§å†™ï¼Œéžä¸“æœ‰åè¯åˆ™ä¸éœ€è¦å¤§å†™ã€‚ â€œAmerican Association of Physicists in Medicineâ€ï¼ˆç¾Žå›½åŒ»å­¦ç‰©ç†å­¦å®¶åä¼šï¼‰æ˜¯ä¸“æœ‰åè¯ï¼Œéœ€è¦å¤§å†™ã€‚â€œonline transaction processingâ€ï¼ˆåœ¨çº¿äº‹åŠ¡å¤„ç†ï¼‰ä¸æ˜¯ä¸“æœ‰åè¯ï¼Œä¸åº”å¤§å†™ã€‚ 3. æ®µè½ 3.1. æ®µè½åŽŸåˆ™ ä¸€ä¸ªæ®µè½åªèƒ½æœ‰ä¸€ä¸ªä¸»é¢˜ï¼Œæˆ–ä¸€ä¸ªä¸­å¿ƒå¥å­ã€‚ æ®µè½çš„ä¸­å¿ƒå¥å­æ”¾åœ¨æ®µé¦–ï¼Œå¯¹å…¨æ®µå†…å®¹è¿›è¡Œæ¦‚è¿°ã€‚åŽé¢é™ˆè¿°çš„å¥å­ä¸ºæ ¸å¿ƒå¥æœåŠ¡ã€‚ ä¸€ä¸ªæ®µè½çš„é•¿åº¦ä¸èƒ½è¶…è¿‡ä¸ƒè¡Œï¼Œæœ€ä½³æ®µè½é•¿åº¦å°äºŽç­‰äºŽå››è¡Œã€‚ æ®µè½çš„å¥å­è¯­æ°”è¦ä½¿ç”¨é™ˆè¿°å’Œè‚¯å®šè¯­æ°”ï¼Œé¿å…ä½¿ç”¨æ„Ÿå¹è¯­æ°”ã€‚ æ®µè½ä¹‹é—´ä½¿ç”¨ä¸€ä¸ªç©ºè¡Œéš”å¼€ã€‚ æ®µè½å¼€å¤´ä¸è¦ç•™å‡ºç©ºç™½å­—ç¬¦ã€‚ 3.2. å¼•ç”¨ å¼•ç”¨ç¬¬ä¸‰æ–¹å†…å®¹æ—¶ï¼Œåº”æ³¨æ˜Žå‡ºå¤„ã€‚ One manâ€™s constant is another manâ€™s variable. â€” Alan Perlis å¦‚æžœæ˜¯å…¨ç¯‡è½¬è½½ï¼Œè¯·åœ¨å…¨æ–‡å¼€å¤´æ˜¾è‘—ä½ç½®æ³¨æ˜Žä½œè€…å’Œå‡ºå¤„ï¼Œå¹¶é“¾æŽ¥è‡³åŽŸæ–‡ã€‚ æœ¬æ–‡è½¬è½½è‡ª WikiQuote ä½¿ç”¨å¤–éƒ¨å›¾ç‰‡æ—¶ï¼Œå¿…é¡»åœ¨å›¾ç‰‡ä¸‹æ–¹æˆ–æ–‡æœ«æ ‡æ˜Žæ¥æºã€‚ æœ¬æ–‡éƒ¨åˆ†å›¾ç‰‡æ¥è‡ª Wikipedia 3.3. å¼ºè°ƒ ä¸€äº›ç‰¹æ®Šçš„å¼ºè°ƒå†…å®¹å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼ä¹¦å†™ï¼š ðŸ”” ã€Žæ³¨æ„ã€ ðŸ’¡ ã€Žæç¤ºã€ ðŸ“š ã€Žå‚è€ƒã€ 4. æ•°å€¼ 4.1. åŠè§’æ•°å­— æ•°å­—ä¸€å¾‹ä½¿ç”¨åŠè§’å½¢å¼ï¼Œä¸å¾—ä½¿ç”¨å…¨è§’å½¢å¼ã€‚ åä¾‹ï¼š è¿™ä»¶å•†å“çš„ä»·æ ¼æ˜¯ï¼‘ï¼ï¼ï¼å…ƒã€‚æ­£ä¾‹ï¼š è¿™ä»¶å•†å“çš„ä»·æ ¼æ˜¯ 1000 å…ƒã€‚ 4.2. åƒåˆ†å· æ•°å€¼ä¸ºåƒä½ä»¥ä¸Šï¼Œåº”æ·»åŠ åƒåˆ†å·ï¼ˆåŠè§’é€—å·ï¼‰ã€‚ XXX å…¬å¸çš„å®žæ”¶èµ„æœ¬ä¸º RMB1,258,000ã€‚ å¯¹äºŽ 4 ï½ž 6 ä½çš„æ•°å€¼ï¼Œåƒåˆ†å·æ˜¯é€‰ç”¨çš„ï¼Œæ¯”å¦‚1000å’Œ1,000éƒ½å¯ä»¥æŽ¥å—ã€‚å¯¹äºŽ 7 ä½åŠä»¥ä¸Šçš„æ•°å€¼ï¼Œåƒåˆ†å·æ˜¯å¿…é¡»çš„ã€‚ å¤šä½å°æ•°è¦ä»Žå°æ•°ç‚¹åŽä»Žå·¦å‘å³æ·»åŠ åƒåˆ†å·ï¼Œæ¯”å¦‚4.234,345ã€‚ 4.3. è´§å¸ è´§å¸åº”ä¸ºé˜¿æ‹‰ä¼¯æ•°å­—ï¼Œå¹¶åœ¨æ•°å­—å‰å†™å‡ºè´§å¸ç¬¦å·ï¼Œæˆ–åœ¨æ•°å­—åŽå†™å‡ºè´§å¸ä¸­æ–‡åç§°ã€‚ $1,0001,000 ç¾Žå…ƒ 4.4. æ•°å€¼èŒƒå›´ è¡¨ç¤ºæ•°å€¼èŒƒå›´æ—¶ï¼Œç”¨ï½žè¿žæŽ¥ã€‚å‚è§ã€Šæ ‡ç‚¹ç¬¦å·ã€‹ä¸€èŠ‚çš„â€œè¿žæŽ¥å·â€éƒ¨åˆ†ã€‚ å¸¦æœ‰å•ä½æˆ–ç™¾åˆ†å·æ—¶ï¼Œä¸¤ä¸ªæ•°å­—éƒ½è¦åŠ ä¸Šå•ä½æˆ–ç™¾åˆ†å·ï¼Œä¸èƒ½åªåŠ åŽé¢ä¸€ä¸ªã€‚ åä¾‹ï¼š132ï½ž234kgæ­£ä¾‹ï¼š132kgï½ž234kgåä¾‹ï¼š67ï½ž89%æ­£ä¾‹ï¼š67%ï½ž89% 4.5. å˜åŒ–ç¨‹åº¦çš„è¡¨ç¤ºæ³• æ•°å­—çš„å¢žåŠ è¦ä½¿ç”¨â€œå¢žåŠ äº†â€ã€â€œå¢žåŠ åˆ°â€ã€‚â€œäº†â€è¡¨ç¤ºå¢žé‡ï¼Œâ€œåˆ°â€è¡¨ç¤ºå®šé‡ã€‚ å¢žåŠ åˆ°è¿‡åŽ»çš„ä¸¤å€ï¼ˆè¿‡åŽ»ä¸ºä¸€ï¼ŒçŽ°åœ¨ä¸ºäºŒï¼‰å¢žåŠ äº†ä¸¤å€ï¼ˆè¿‡åŽ»ä¸ºä¸€ï¼ŒçŽ°åœ¨ä¸ºä¸‰ï¼‰ æ•°å­—çš„å‡å°‘è¦ä½¿ç”¨â€œé™ä½Žäº†â€ã€â€œé™ä½Žåˆ°â€ã€‚â€œäº†â€è¡¨ç¤ºå¢žé‡ï¼Œâ€œåˆ°â€è¡¨ç¤ºå®šé‡ã€‚ é™ä½Žåˆ°ç™¾åˆ†ä¹‹å…«åï¼ˆå®šé¢æ˜¯ä¸€ç™¾ï¼ŒçŽ°åœ¨æ˜¯å…«åï¼‰é™ä½Žäº†ç™¾åˆ†ä¹‹å…«åï¼ˆåŽŸæ¥æ˜¯ä¸€ç™¾ï¼ŒçŽ°åœ¨æ˜¯äºŒåï¼‰ ä¸èƒ½ç”¨â€œé™ä½Ž N å€â€æˆ–â€œå‡å°‘ N å€â€çš„è¡¨ç¤ºæ³•ï¼Œè¦ç”¨â€œé™ä½Žç™¾åˆ†ä¹‹å‡ â€æˆ–â€œå‡å°‘ç™¾åˆ†ä¹‹å‡ â€ã€‚å› ä¸ºå‡å°‘ï¼ˆæˆ–é™ä½Žï¼‰ä¸€å€è¡¨ç¤ºæ•°å€¼åŽŸæ¥ä¸ºä¸€ç™¾ï¼ŒçŽ°åœ¨ç­‰äºŽé›¶ã€‚ 5. ç¬¦å· 5.1. ç¬¦å·åŽŸåˆ™ ä¸­æ–‡è¯­å¥çš„æ ‡ç‚¹ç¬¦å·ï¼Œå‡åº”è¯¥é‡‡å–å…¨è§’ç¬¦å·ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è§†è§‰çš„ä¸€è‡´ã€‚ å¦‚æžœæ•´å¥ä¸ºè‹±æ–‡ï¼Œåˆ™è¯¥å¥ä½¿ç”¨è‹±æ–‡/åŠè§’æ ‡ç‚¹ã€‚ å¥å·ã€é—®å·ã€å¹å·ã€é€—å·ã€é¡¿å·ã€åˆ†å·å’Œå†’å·ä¸å¾—å‡ºçŽ°åœ¨ä¸€è¡Œä¹‹é¦–ã€‚ 5.2. å¥å· ä¸­æ–‡è¯­å¥ä¸­çš„ç»“å°¾å¤„åº”è¯¥ç”¨å…¨è§’å¥å·ï¼ˆã€‚ï¼‰ã€‚ å¥å­æœ«å°¾ç”¨æ‹¬å·åŠ æ³¨æ—¶ï¼Œå¥å·åº”åœ¨æ‹¬å·ä¹‹å¤–ã€‚ åä¾‹ï¼šå…³äºŽæ–‡ä»¶çš„è¾“å‡ºï¼Œè¯·å‚ç…§ç¬¬ 1.3 èŠ‚ï¼ˆè§ç¬¬ 26 é¡µã€‚ï¼‰æ­£ä¾‹ï¼šå…³äºŽæ–‡ä»¶çš„è¾“å‡ºï¼Œè¯·å‚ç…§ç¬¬ 1.3 èŠ‚ï¼ˆè§ç¬¬ 26 é¡µï¼‰ã€‚ 5.3. é€—å· é€—å·ï¼Œè¡¨ç¤ºå¥å­å†…éƒ¨çš„ä¸€èˆ¬æ€§åœé¡¿ã€‚ æ³¨æ„é¿å…â€œä¸€é€—åˆ°åº•â€ï¼Œå³æ•´ä¸ªæ®µè½é™¤äº†ç»“å°¾ï¼Œå…¨éƒ¨åœé¡¿éƒ½ä½¿ç”¨é€—å·ã€‚ 5.4. é¡¿å· å¥å­å†…éƒ¨çš„å¹¶åˆ—è¯ï¼Œåº”è¯¥ç”¨å…¨è§’é¡¿å·(ã€) åˆ†éš”ï¼Œè€Œä¸ç”¨é€—å·ï¼Œå³ä½¿å¹¶åˆ—è¯æ˜¯è‹±è¯­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ åä¾‹ï¼šæˆ‘æœ€æ¬£èµçš„ç§‘æŠ€å…¬å¸æœ‰ Google, Facebook, è…¾è®¯, é˜¿é‡Œå’Œç™¾åº¦ç­‰ã€‚æ­£ä¾‹ï¼šæˆ‘æœ€æ¬£èµçš„ç§‘æŠ€å…¬å¸æœ‰ Googleã€Facebookã€è…¾è®¯ã€é˜¿é‡Œå’Œç™¾åº¦ç­‰ã€‚ è‹±æ–‡å¥å­ä¸­ï¼Œå¹¶åˆ—è¯è¯­ä¹‹é—´ä½¿ç”¨åŠè§’é€—å·ï¼ˆ,ï¼‰åˆ†éš”ã€‚ ä¾‹å¥ï¼šMicrosoft Office includes Word, Excel, PowerPoint, Outlook and other components. 5.5. åˆ†å· åˆ†å·ï¼›è¡¨ç¤ºå¤å¥å†…éƒ¨å¹¶åˆ—åˆ†å¥ä¹‹é—´çš„åœé¡¿ã€‚ 5.6. å¼•å· å¼•ç”¨æ—¶ï¼Œåº”è¯¥ä½¿ç”¨å…¨è§’åŒå¼•å·ï¼ˆâ€œ â€ï¼‰ï¼Œæ³¨æ„å‰åŽåŒå¼•å·ä¸åŒã€‚ ä¾‹å¥ï¼šè®¸å¤šäººéƒ½è®¤ä¸ºå®¢æˆ·æœåŠ¡çš„æ ¸å¿ƒæ˜¯â€œå‹å¥½â€å’Œâ€œä¸“ä¸šâ€ã€‚ å¼•å·é‡Œé¢è¿˜è¦ç”¨å¼•å·æ—¶ï¼Œå¤–é¢ä¸€å±‚ç”¨åŒå¼•å·ï¼Œé‡Œé¢ä¸€å±‚ç”¨å•å¼•å·ï¼ˆâ€˜ â€™ï¼‰ï¼Œæ³¨æ„å‰åŽå•å¼•å·ä¸åŒã€‚ ä¾‹å¥ï¼šé²å‹ƒè§£é‡Šé“ï¼šâ€œæˆ‘è¦æ”¾éŸ³ä¹ï¼Œå¯è¨åˆ©è¯´ï¼Œâ€˜ä¸è¡Œï¼â€™ã€‚â€ 5.7. åœ†æ‹¬å· è¡¥å……è¯´æ˜Žæ—¶ï¼Œä½¿ç”¨å…¨è§’åœ†æ‹¬å·ï¼ˆï¼‰ï¼Œæ‹¬å·å‰åŽä¸åŠ ç©ºæ ¼ã€‚ ä¾‹å¥ï¼šè¯·ç¡®è®¤æ‰€æœ‰çš„è¿žæŽ¥ï¼ˆç”µç¼†å’ŒæŽ¥æ’ä»¶ï¼‰å‡å®‰è£…ç‰¢å›ºã€‚ 5.8. å†’å· å…¨è§’å†’å·ï¼ˆï¼šï¼‰å¸¸ç”¨åœ¨éœ€è¦è§£é‡Šçš„è¯è¯­åŽè¾¹ï¼Œå¼•å‡ºè§£é‡Šå’Œè¯´æ˜Žã€‚ ä¾‹å¥ï¼šè¯·ç¡®è®¤ä»¥ä¸‹å‡ é¡¹å†…å®¹ï¼šæ—¶é—´ã€åœ°ç‚¹ã€æ´»åŠ¨åç§°ï¼Œä»¥åŠæ¥å®¾æ•°é‡ã€‚ è¡¨ç¤ºæ—¶é—´æ—¶ï¼Œåº”ä½¿ç”¨åŠè§’å†’å·ï¼ˆ:ï¼‰ã€‚ ä¾‹å¥ï¼šæ—©ä¸Š 8:00 5.9. çœç•¥å· çœç•¥å·â€¦â€¦è¡¨ç¤ºè¯­å¥æœªå®Œã€æˆ–è€…è¯­æ°”çš„ä¸è¿žç»­ã€‚å®ƒå ä¸¤ä¸ªæ±‰å­—ç©ºé—´ã€åŒ…å«å…­ä¸ªçœç•¥ç‚¹ï¼Œä¸è¦ä½¿ç”¨ã€‚ã€‚ã€‚æˆ–...ç­‰éžæ ‡å‡†å½¢å¼ã€‚ çœç•¥å·ä¸åº”ä¸Žâ€œç­‰â€è¿™ä¸ªè¯ä¸€èµ·ä½¿ç”¨ã€‚ åä¾‹ï¼šæˆ‘ä»¬ä¸ºä¼šé¤å‡†å¤‡äº†é¦™è•‰ã€è‹¹æžœã€æ¢¨â€¦ç­‰å„è‰²æ°´æžœã€‚æ­£ä¾‹ï¼šæˆ‘ä»¬ä¸ºä¼šé¤å‡†å¤‡äº†å„è‰²æ°´æžœï¼Œæœ‰é¦™è•‰ã€è‹¹æžœã€æ¢¨â€¦â€¦æ­£ä¾‹ï¼šæˆ‘ä»¬ä¸ºä¼šé¤å‡†å¤‡äº†é¦™è•‰ã€è‹¹æžœã€æ¢¨ç­‰å„è‰²æ°´æžœã€‚ 5.10. æ„Ÿå¹å· åº”è¯¥ä½¿ç”¨å¹³é™çš„è¯­æ°”å™è¿°ï¼Œå°½é‡é¿å…ä½¿ç”¨æ„Ÿå¹å·ï¼ã€‚ ä¸å¾—å¤šä¸ªæ„Ÿå¹å·è¿žç”¨ï¼Œæ¯”å¦‚ï¼ï¼å’Œ!!!ã€‚ 5.11. ç ´æŠ˜å· ç ´æŠ˜å·â€”â€”â€”â€”ä¸€èˆ¬ç”¨äºŽåšè¿›ä¸€æ­¥è§£é‡Šã€‚ç ´æŠ˜å·åº”å ä¸¤ä¸ªæ±‰å­—çš„ä½ç½®ã€‚ ä¾‹å¥ï¼šç›´è§‰â€”â€”â€”â€”å°½ç®¡å®ƒå¹¶ä¸æ€»æ˜¯å¯é çš„â€”â€”â€”â€”å‘Šè¯‰æˆ‘ï¼Œè¿™äº‹å¯èƒ½å‡ºäº†äº›é—®é¢˜ã€‚ 5.12. è¿žæŽ¥å· è¿žæŽ¥å·ç”¨äºŽè¿žæŽ¥ä¸¤ä¸ªç±»ä¼¼çš„è¯ã€‚ ä»¥ä¸‹åœºåˆåº”è¯¥ä½¿ç”¨ç›´çº¿è¿žæŽ¥å·ï¼ˆ-ï¼‰ï¼Œå ä¸€ä¸ªåŠè§’å­—ç¬¦çš„ä½ç½®ã€‚ ä¸¤ä¸ªåè¯çš„å¤åˆ å›¾è¡¨ç¼–å· ä¾‹å¥ï¼šæ°§åŒ–-è¿˜åŽŸååº”ä¾‹å¥ï¼šå›¾ 1-1 ä»¥ä¸‹åœºåˆåº”è¯¥ä½¿ç”¨æ³¢æµªè¿žæŽ¥å·ï¼ˆï½žï¼‰ï¼Œå ä¸€ä¸ªå…¨è§’å­—ç¬¦çš„ä½ç½®ã€‚ æ•°å€¼èŒƒå›´ï¼ˆä¾‹å¦‚æ—¥æœŸã€æ—¶é—´æˆ–æ•°å­—ï¼‰ ä¾‹å¥ï¼š2009 å¹´ï½ž2011 å¹´ æ³¨æ„ï¼Œæ³¢æµªè¿žæŽ¥å·å‰åŽä¸¤ä¸ªå€¼éƒ½åº”è¯¥åŠ ä¸Šå•ä½ã€‚ æ³¢æµªè¿žæŽ¥å·ä¹Ÿå¯ä»¥ç”¨æ±‰å­—â€œè‡³â€ä»£æ›¿ã€‚ ä¾‹å¥ï¼šå‘¨å›´æ¸©åº¦ï¼š-20Â°C è‡³ -10Â°C 6. ç»“æž„ 6.1. ç›®å½•ç»“æž„ æŠ€æœ¯æ‰‹å†Œç›®å½•ç»“æž„æ˜¯ä¸€éƒ¨å®Œæ•´çš„ä¹¦ï¼Œå»ºè®®é‡‡ç”¨ä¸‹é¢çš„ç»“æž„ã€‚ ç®€ä»‹ï¼ˆIntroductionï¼‰ - [å¿…é€‰][ç›®å½•|æ–‡ä»¶] æä¾›å¯¹äº§å“å’Œæ–‡æ¡£æœ¬èº«çš„æ€»ä½“çš„ã€æ‰¼è¦çš„è¯´æ˜Ž å…¥é—¨ç¯‡ï¼ˆQuickstartï¼‰ - [å¯é€‰][æ–‡ä»¶] å¦‚ä½•æœ€å¿«é€Ÿåœ°ä½¿ç”¨äº§å“ åŸºç¡€ç¯‡ï¼ˆBasicsï¼‰ - [å¿…é€‰][ç›®å½•] åˆç§°â€ä½¿ç”¨ç¯‡â€œï¼Œæä¾›åˆçº§çš„ä½¿ç”¨æ•™ç¨‹ çŽ¯å¢ƒå‡†å¤‡ï¼ˆPrerequisiteï¼‰ - [å¯é€‰][æ–‡ä»¶] è½¯ä»¶ä½¿ç”¨éœ€è¦æ»¡è¶³çš„å‰ç½®æ¡ä»¶ å®‰è£…ï¼ˆInstallationï¼‰ - [å¯é€‰][æ–‡ä»¶] è½¯ä»¶çš„å®‰è£…æ–¹æ³• é…ç½®ï¼ˆConfigurationï¼‰ - [å¯é€‰][ç›®å½•|æ–‡ä»¶] è½¯ä»¶çš„é…ç½® ç‰¹æ€§ï¼ˆFeatureï¼‰ - [å¿…é€‰][ç›®å½•|æ–‡ä»¶] è½¯ä»¶çš„åŠŸèƒ½ç‰¹æ€§ è¿›é˜¶ç¯‡ï¼ˆAdvancedï¼‰ - [å¯é€‰][ç›®å½•] åˆç§°â€å¼€å‘ç¯‡â€œï¼Œæä¾›ä¸­é«˜çº§çš„å¼€å‘æ•™ç¨‹ åŽŸç†ï¼ˆPrincipleï¼‰ - [å¯é€‰][ç›®å½•|æ–‡ä»¶] è½¯ä»¶çš„åŽŸç† è®¾è®¡ï¼ˆDesignï¼‰ - [å¯é€‰][ç›®å½•|æ–‡ä»¶] è½¯ä»¶çš„è®¾è®¡ï¼Œå¦‚ï¼šæž¶æž„ã€è®¾è®¡æ€æƒ³ç­‰ å®žæˆ˜ç¯‡ï¼ˆActionï¼‰ - [å¯é€‰][ç›®å½•] æä¾›ä¸€äº›å…·æœ‰å®žæˆ˜æ„ä¹‰çš„ç¤ºä¾‹è¯´æ˜Ž APIï¼ˆAPIï¼‰ - [å¯é€‰][ç›®å½•|æ–‡ä»¶] è½¯ä»¶ API çš„é€ä¸€ä»‹ç» å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰ - [å¯é€‰][ç›®å½•|æ–‡ä»¶] å¸¸è§é—®é¢˜è§£ç­” é™„å½•ï¼ˆAppendixï¼‰ - [å¯é€‰][ç›®å½•] ä¸å±žäºŽæ•™ç¨‹æœ¬èº«ã€ä½†å¯¹é˜…è¯»æ•™ç¨‹æœ‰å¸®åŠ©çš„å†…å®¹ å‘½ä»¤ï¼ˆCommandï¼‰ - [å¯é€‰][ç›®å½•] å‘½ä»¤ èµ„æºï¼ˆResourceï¼‰ - [å¿…é€‰][æ–‡ä»¶] èµ„æº æœ¯è¯­ï¼ˆGlossaryï¼‰ - [å¯é€‰][æ–‡ä»¶] åè¯è§£é‡Š æŠ€å·§ï¼ˆRecipeï¼‰ - [å¯é€‰][æ–‡ä»¶] æœ€ä½³å®žè·µ ç‰ˆæœ¬ï¼ˆChangelogï¼‰ - [å¯é€‰][æ–‡ä»¶] ç‰ˆæœ¬è¯´æ˜Ž åé¦ˆï¼ˆFeedbackï¼‰ - [å¯é€‰][æ–‡ä»¶] åé¦ˆæ–¹å¼ ä¸‹é¢æ˜¯ä¸¤ä¸ªçœŸå®žèŒƒä¾‹ï¼Œå¯å‚è€ƒã€‚ Redux æ‰‹å†Œ Atom æ‰‹å†Œ 6.2. æ–‡ä»¶å æ–‡æ¡£çš„æ–‡ä»¶åä¸å¾—å«æœ‰ç©ºæ ¼ã€‚ æ–‡ä»¶åå¿…é¡»ä½¿ç”¨åŠè§’å­—ç¬¦ï¼Œä¸å¾—ä½¿ç”¨å…¨è§’å­—ç¬¦ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œä¸­æ–‡ä¸èƒ½ç”¨äºŽæ–‡ä»¶åã€‚ åä¾‹ï¼š åè¯è§£é‡Š.mdæ­£ä¾‹ï¼š glossary.md æ–‡ä»¶åå»ºè®®åªä½¿ç”¨å°å†™å­—æ¯ï¼Œä¸ä½¿ç”¨å¤§å†™å­—æ¯ã€‚ åä¾‹ï¼šTroubleShooting.mdæ­£ä¾‹ï¼štroubleshooting.md ä¸ºäº†é†’ç›®ï¼ŒæŸäº›è¯´æ˜Žæ–‡ä»¶çš„æ–‡ä»¶åï¼Œå¯ä»¥ä½¿ç”¨å¤§å†™å­—æ¯ï¼Œæ¯”å¦‚READMEã€LICENSEã€‚ æ–‡ä»¶ååŒ…å«å¤šä¸ªå•è¯æ—¶ï¼Œå•è¯ä¹‹é—´å»ºè®®ä½¿ç”¨åŠè§’çš„è¿žè¯çº¿ï¼ˆ-ï¼‰åˆ†éš”ã€‚ åä¾‹ï¼šadvanced_usage.mdæ­£ä¾‹ï¼šadvanced-usage.md 7. Emoji åœ¨ markdown æ–‡æ¡£ä¸­ï¼Œæ™®éä¼šä½¿ç”¨ emojiï¼Œå¸®åŠ©ç†è§£å†…å®¹ã€‚ä½†æ˜¯ï¼Œå¦‚æžœæ»¥ç”¨ emojiï¼Œå¯èƒ½ä¼šé€‚å¾—å…¶åã€‚ è¿™é‡Œï¼Œå°†ä¸€äº›æ¯”è¾ƒçº¦å®šä¿—æˆçš„ emoji è¡¨æƒ…ä½¿ç”¨åœºæ™¯åˆ—ä¸¾ä¸€ä¸‹ï¼š ðŸ’¡ æç¤º - [æŽ¨è] ðŸ”” æ³¨æ„ã€è­¦å‘Š - [æŽ¨è] â­• æ­£ç¡® - [æŽ¨è] âŒ é”™è¯¯ - [æŽ¨è] â“ é—®é¢˜ - [æŽ¨è] â›” ç¦æ­¢ - [æŽ¨è] ðŸš§ æœªå®Œå¾…ç»­ã€æœ‰å¾…è¡¥å…… - [æŽ¨è] ðŸ“š å‚è€ƒã€å‚è€ƒèµ„æ–™ - [å¯é€‰] âŒ¨ æºç  - [å¯é€‰] 8. å‚è€ƒ äº§å“æ‰‹å†Œä¸­æ–‡å†™ä½œè§„èŒƒ, by åŽä¸º å†™ä½œè§„èŒƒå’Œæ ¼å¼è§„èŒƒ, by DaoCloud æŠ€æœ¯å†™ä½œæŠ€å·§åœ¨æ—¥æ±‰ç¿»è¯‘ä¸­çš„åº”ç”¨, by åˆ˜æ–¹ ç®€ä½“ä¸­æ–‡è§„èŒƒæŒ‡å—, by lengoo æ–‡æ¡£é£Žæ ¼æŒ‡å—, by LeanCloud è±Œè±†èšæ–‡æ¡ˆé£Žæ ¼æŒ‡å—, by è±Œè±†èš ä¸­æ–‡æ–‡æ¡ˆæŽ’ç‰ˆæŒ‡åŒ—, by sparanoid ä¸­æ–‡æŽ’ç‰ˆéœ€æ±‚, by W3C ä¸ºä»€ä¹ˆæ–‡ä»¶åè¦å°å†™ï¼Ÿ, by é˜®ä¸€å³°]]></content>
      <categories>
        <category>method</category>
      </categories>
      <tags>
        <tag>method</tag>
        <tag>doc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HBase]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fbigdata%2Fhbase%2FREADME%2F</url>
    <content type="text"><![CDATA[HBase ç®€ä»‹ åŸºç¡€ åŽŸç† æ•°æ®æ¨¡åž‹ HBase æž¶æž„ HBase å’Œ RDBMS API é™„å½• å‘½ä»¤è¡Œ æ›´å¤šå†…å®¹ æ‰©å±•é˜…è¯» å‚è€ƒèµ„æ–™ ç®€ä»‹ HBase æ˜¯å»ºç«‹åœ¨ HDFS åŸºç¡€ä¸Šçš„é¢å‘åˆ—çš„åˆ†å¸ƒå¼æ•°æ®åº“ã€‚ HBase å‚è€ƒäº†è°·æ­Œçš„ BigTable å»ºæ¨¡ï¼Œå®žçŽ°çš„ç¼–ç¨‹è¯­è¨€ä¸º Javaã€‚ å®ƒæ˜¯ Hadoop é¡¹ç›®çš„å­é¡¹ç›®ï¼Œè¿è¡ŒäºŽ HDFS æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šã€‚ HBase é€‚ç”¨åœºæ™¯ï¼šå®žæ—¶åœ°éšæœºè®¿é—®è¶…å¤§æ•°æ®é›†ã€‚ åœ¨ CAP ç†è®ºä¸­ï¼ŒHBase å±žäºŽ CP ç±»åž‹çš„ç³»ç»Ÿã€‚ åŸºç¡€ HBase ç»´æŠ¤ åŽŸç† æ•°æ®æ¨¡åž‹ HBase æ˜¯ä¸€ä¸ªé¢å‘åˆ—çš„æ•°æ®åº“ï¼Œåœ¨è¡¨ä¸­å®ƒç”±è¡ŒæŽ’åºã€‚ HBase è¡¨æ¨¡åž‹ç»“æž„ä¸ºï¼š è¡¨ï¼ˆtableï¼‰æ˜¯è¡Œçš„é›†åˆã€‚ è¡Œï¼ˆrowï¼‰æ˜¯åˆ—æ—çš„é›†åˆã€‚ åˆ—æ—ï¼ˆcolumn familyï¼‰æ˜¯åˆ—çš„é›†åˆã€‚ åˆ—ï¼ˆrowï¼‰æ˜¯é”®å€¼å¯¹çš„é›†åˆã€‚ HBase è¡¨çš„å•å…ƒæ ¼ï¼ˆcellï¼‰ç”±è¡Œå’Œåˆ—çš„åæ ‡äº¤å‰å†³å®šï¼Œæ˜¯æœ‰ç‰ˆæœ¬çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç‰ˆæœ¬å·æ˜¯è‡ªåŠ¨åˆ†é…çš„ï¼Œä¸º HBase æ’å…¥å•å…ƒæ ¼æ—¶çš„æ—¶é—´æˆ³ã€‚å•å…ƒæ ¼çš„å†…å®¹æ˜¯æœªè§£é‡Šçš„å­—èŠ‚æ•°ç»„ã€‚ è¡Œçš„é”®ä¹Ÿæ˜¯æœªè§£é‡Šçš„å­—èŠ‚æ•°ç»„ï¼Œæ‰€ä»¥ç†è®ºä¸Šï¼Œä»»ä½•æ•°æ®éƒ½å¯ä»¥é€šè¿‡åºåˆ—åŒ–è¡¨ç¤ºæˆå­—ç¬¦ä¸²æˆ–äºŒè¿›åˆ¶ï¼Œä»Žè€Œå­˜ä¸º HBase çš„é”®å€¼ã€‚ HBase æž¶æž„ å’Œ HDFSã€YARN ä¸€æ ·ï¼ŒHBase ä¹Ÿé‡‡ç”¨ master / slave æž¶æž„ï¼š HBase æœ‰ä¸€ä¸ª master èŠ‚ç‚¹ã€‚master èŠ‚ç‚¹è´Ÿè´£å°†åŒºåŸŸï¼ˆregionï¼‰åˆ†é…ç»™ region èŠ‚ç‚¹ï¼›æ¢å¤ region èŠ‚ç‚¹çš„æ•…éšœã€‚ HBase æœ‰å¤šä¸ª region èŠ‚ç‚¹ã€‚region èŠ‚ç‚¹è´Ÿè´£é›¶ä¸ªæˆ–å¤šä¸ªåŒºåŸŸï¼ˆregionï¼‰çš„ç®¡ç†å¹¶ç›¸åº”å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€‚region èŠ‚ç‚¹è¿˜è´Ÿè´£åŒºåŸŸçš„åˆ’åˆ†å¹¶é€šçŸ¥ master èŠ‚ç‚¹æœ‰äº†æ–°çš„å­åŒºåŸŸã€‚ HBase ä¾èµ– ZooKeeper æ¥å®žçŽ°æ•…éšœæ¢å¤ã€‚ Regin HBase è¡¨æŒ‰è¡Œé”®èŒƒå›´æ°´å¹³è‡ªåŠ¨åˆ’åˆ†ä¸ºåŒºåŸŸï¼ˆregionï¼‰ã€‚æ¯ä¸ªåŒºåŸŸç”±è¡¨ä¸­è¡Œçš„å­é›†æž„æˆã€‚æ¯ä¸ªåŒºåŸŸç”±å®ƒæ‰€å±žçš„è¡¨ã€å®ƒæ‰€å«çš„ç¬¬ä¸€è¡ŒåŠæœ€åŽä¸€è¡Œæ¥è¡¨ç¤ºã€‚ åŒºåŸŸåªä¸è¿‡æ˜¯è¡¨è¢«æ‹†åˆ†ï¼Œå¹¶åˆ†å¸ƒåœ¨åŒºåŸŸæœåŠ¡å™¨ã€‚ Master æœåŠ¡å™¨ åŒºåŸŸåˆ†é…ã€DDL(createã€delete)æ“ä½œç”± HBase master æœåŠ¡å™¨å¤„ç†ã€‚ master æœåŠ¡å™¨è´Ÿè´£åè°ƒ region æœåŠ¡å™¨ ååŠ©åŒºåŸŸå¯åŠ¨ï¼Œå‡ºçŽ°æ•…éšœæ¢å¤æˆ–è´Ÿè½½å‡è¡¡æƒ…å†µæ—¶ï¼Œé‡æ–°åˆ†é… region æœåŠ¡å™¨ ç›‘æŽ§é›†ç¾¤ä¸­çš„æ‰€æœ‰ region æœåŠ¡å™¨ æ”¯æŒ DDL æŽ¥å£ï¼ˆåˆ›å»ºã€åˆ é™¤ã€æ›´æ–°è¡¨ï¼‰ Regin æœåŠ¡å™¨ åŒºåŸŸæœåŠ¡å™¨è¿è¡Œåœ¨ HDFS æ•°æ®èŠ‚ç‚¹ä¸Šï¼Œå…·æœ‰ä»¥ä¸‹ç»„ä»¶ WAL - Write Ahead Log æ˜¯ HDFS ä¸Šçš„æ–‡ä»¶ã€‚WAL å­˜å‚¨å°šæœªæŒä¹…å­˜å‚¨åˆ°æ°¸ä¹…å­˜å‚¨çš„æ–°æ•°æ®ï¼Œå®ƒç”¨äºŽåœ¨å‘ç”Ÿæ•…éšœæ—¶è¿›è¡Œæ¢å¤ã€‚ BlockCache - æ˜¯è¯»ç¼“å­˜ã€‚å®ƒå°†é¢‘ç¹è¯»å–çš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚è‡³å°‘æœ€è¿‘ä½¿ç”¨çš„æ•°æ®åœ¨å®Œæ•´æ—¶è¢«é€å‡ºã€‚ MemStore - æ˜¯å†™ç¼“å­˜ã€‚å®ƒå­˜å‚¨å°šæœªå†™å…¥ç£ç›˜çš„æ–°æ•°æ®ã€‚åœ¨å†™å…¥ç£ç›˜ä¹‹å‰å¯¹å…¶è¿›è¡ŒæŽ’åºã€‚æ¯ä¸ªåŒºåŸŸæ¯ä¸ªåˆ—æ—æœ‰ä¸€ä¸ª MemStoreã€‚ Hfiles - å°†è¡Œå­˜å‚¨ä¸ºç£ç›˜ä¸Šçš„æŽ’åºé”®å€¼å¯¹ã€‚ ZooKeeper HBase ä½¿ç”¨ ZooKeeper ä½œä¸ºåˆ†å¸ƒå¼åè°ƒæœåŠ¡æ¥ç»´æŠ¤é›†ç¾¤ä¸­çš„æœåŠ¡å™¨çŠ¶æ€ã€‚Zookeeper ç»´æŠ¤å“ªäº›æœåŠ¡å™¨æ˜¯æ´»åŠ¨çš„å’Œå¯ç”¨çš„ï¼Œå¹¶æä¾›æœåŠ¡å™¨æ•…éšœé€šçŸ¥ã€‚é›†ç¾¤è‡³å°‘åº”è¯¥æœ‰ 3 ä¸ªèŠ‚ç‚¹ã€‚ HBase å’Œ RDBMS HBase RDBMS HBase æ— æ¨¡å¼ï¼Œå®ƒä¸å…·æœ‰å›ºå®šåˆ—æ¨¡å¼çš„æ¦‚å¿µ;ä»…å®šä¹‰åˆ—æ—ã€‚ RDBMS æœ‰å®ƒçš„æ¨¡å¼ï¼Œæè¿°è¡¨çš„æ•´ä½“ç»“æž„çš„çº¦æŸã€‚ å®ƒä¸“é—¨åˆ›å»ºä¸ºå®½è¡¨ã€‚ HBase æ˜¯æ¨ªå‘æ‰©å±•ã€‚ è¿™äº›éƒ½æ˜¯ç»†è€Œä¸“ä¸ºå°è¡¨ã€‚å¾ˆéš¾å½¢æˆè§„æ¨¡ã€‚ æ²¡æœ‰ä»»ä½•äº‹åŠ¡å­˜åœ¨äºŽ HBaseã€‚ RDBMS æ˜¯äº‹åŠ¡æ€§çš„ã€‚ å®ƒåè§„èŒƒåŒ–çš„æ•°æ®ã€‚ å®ƒå…·æœ‰è§„èŒƒåŒ–çš„æ•°æ®ã€‚ å®ƒç”¨äºŽåŠç»“æž„ä»¥åŠç»“æž„åŒ–æ•°æ®æ˜¯éžå¸¸å¥½çš„ã€‚ ç”¨äºŽç»“æž„åŒ–æ•°æ®éžå¸¸å¥½ã€‚ API Java API å½’çº³æ€»ç»“åœ¨è¿™é‡Œï¼šHbase Java API é™„å½• å‘½ä»¤è¡Œ HBase å‘½ä»¤è¡Œå¯ä»¥å‚è€ƒè¿™é‡Œï¼šHBase å‘½ä»¤è¡Œ æ›´å¤šå†…å®¹ æ‰©å±•é˜…è¯» HBase å‘½ä»¤ HBase é…ç½® å‚è€ƒèµ„æ–™ å®˜æ–¹ HBase å®˜ç½‘ HBase å®˜æ–¹æ–‡æ¡£ HBase å®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç‰ˆ HBase API æ–‡ç«  Bigtable: A Distributed Storage System for Structured Data https://mapr.com/blog/in-depth-look-hbase-architecture/]]></content>
  </entry>
  <entry>
    <title><![CDATA[UML æ•™ç¨‹]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fdesign%2FUML%2F</url>
    <content type="text"><![CDATA[UML æ•™ç¨‹ å…³é”®è¯ï¼šéƒ¨ç½²å›¾, ç»„ä»¶å›¾, åŒ…å›¾, ç±»å›¾, å¤åˆç»“æž„å›¾, å¯¹è±¡å›¾, æ´»åŠ¨å›¾, çŠ¶æ€æœºå›¾, ç”¨ä¾‹å›¾, é€šä¿¡å›¾, äº¤äº’æ¦‚è¿°å›¾, æ—¶åºå›¾, æ—¶é—´å›¾ ç®€ä»‹ éƒ¨ç½²å›¾ ç»„ä»¶å›¾ åŒ…å›¾ ç±»å›¾ å¤åˆç»“æž„å›¾ å¯¹è±¡å›¾ æ´»åŠ¨å›¾ çŠ¶æ€æœºå›¾ ç”¨ä¾‹å›¾ é€šä¿¡å›¾ äº¤äº’æ¦‚è¿°å›¾ æ—¶åºå›¾ æ—¶é—´å›¾ UML å·¥å…· æ›´å¤šå†…å®¹ ç®€ä»‹ UML å›¾ç±»åž‹ UML å›¾ç±»åž‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç»“æž„å¼å»ºæ¨¡å›¾ ç»“æž„å¼å»ºæ¨¡å›¾ï¼ˆStructure diagramsï¼‰å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿå¼çš„å»ºæ¨¡ã€‚ç»“æž„å›¾å®šä¹‰äº†ä¸€ä¸ªæ¨¡åž‹çš„é™æ€æž¶æž„ã€‚å®ƒä»¬é€šå¸¸è¢«ç”¨æ¥å¯¹é‚£äº›æž„æˆæ¨¡åž‹çš„â€˜è¦ç´ â€™å»ºæ¨¡ï¼Œè¯¸å¦‚ï¼šç±»ï¼Œå¯¹è±¡ï¼ŒæŽ¥å£å’Œç‰©ç†ç»„ä»¶ã€‚å¦å¤–ï¼Œå®ƒä»¬ä¹Ÿè¢«ç”¨æ¥å¯¹å…ƒç´ é—´å…³è”å’Œä¾èµ–å…³ç³»è¿›è¡Œå»ºæ¨¡ã€‚ ç±»å›¾ å¯¹è±¡å›¾ åŒ…å›¾ ç»„ä»¶å›¾ éƒ¨ç½²å›¾ å¤åˆç»“æž„å›¾ è¡Œä¸ºå¼å»ºæ¨¡å›¾ è¡Œä¸ºå¼å»ºæ¨¡å›¾ï¼ˆBehavior diagramsï¼‰å¼ºè°ƒç³»ç»Ÿæ¨¡åž‹ä¸­è§¦å‘çš„äº‹ã€‚è¡Œä¸ºå›¾ç”¨æ¥è®°å½•åœ¨ä¸€ä¸ªæ¨¡åž‹å†…éƒ¨ï¼Œéšæ—¶é—´çš„å˜åŒ–ï¼Œæ¨¡åž‹æ‰§è¡Œçš„äº¤äº’å˜åŒ–å’Œçž¬é—´çš„çŠ¶æ€ï¼›å¹¶è·Ÿè¸ªç³»ç»Ÿåœ¨çœŸå®žçŽ¯å¢ƒä¸‹å¦‚ä½•è¡¨çŽ°ï¼Œä»¥åŠè§‚å¯Ÿç³»ç»Ÿå¯¹ä¸€ä¸ªæ“ä½œæˆ–äº‹ä»¶çš„ååº”ï¼Œä»¥åŠå®ƒçš„ç»“æžœã€‚ æ´»åŠ¨å›¾ çŠ¶æ€å›¾ ç”¨ä¾‹å›¾ é€šä¿¡å›¾ äº¤äº’æ¦‚è¿°å›¾ æ—¶åºå›¾ æ—¶é—´å›¾ UML æ¦‚å¿µ UML ä»Žæ¥æºä¸­ä½¿ç”¨ç›¸å½“å¤šçš„æ¦‚å¿µã€‚æˆ‘ä»¬å°†ä¹‹å®šä¹‰äºŽç»Ÿä¸€å»ºæ¨¡è¯­è¨€æœ¯è¯­æ±‡è¡¨ã€‚ä¸‹é¢ä»…åˆ—ä»£è¡¨æ€§çš„æ¦‚å¿µã€‚ å¯¹äºŽç»“æž„è€Œè¨€ - æ‰§è¡Œè€…ï¼Œå±žæ€§ï¼Œç±»ï¼Œå…ƒä»¶ï¼ŒæŽ¥å£ï¼Œå¯¹è±¡ï¼ŒåŒ…ã€‚ å¯¹äºŽè¡Œä¸ºè€Œè¨€ - æ´»åŠ¨ï¼ˆUMLï¼‰ï¼Œäº‹ä»¶ï¼ˆUMLï¼‰ï¼Œæ¶ˆæ¯ï¼ˆUMLï¼‰ï¼Œæ–¹æ³•ï¼ˆUMLï¼‰ï¼Œæ“ä½œï¼ˆUMLï¼‰ï¼ŒçŠ¶æ€ï¼ˆUMLï¼‰ï¼Œç”¨ä¾‹ï¼ˆUMLï¼‰ã€‚ å¯¹äºŽå…³ç³»è€Œè¨€ - èšåˆï¼Œå…³è”ï¼Œç»„åˆï¼Œç›¸ä¾ï¼Œå¹¿ä¹‰åŒ–ï¼ˆor ç»§æ‰¿ï¼‰ã€‚ å…¶ä»–æ¦‚å¿µ æž„é€ åž‹â€”è¿™è§„èŒƒç¬¦å·åº”ç”¨åˆ°çš„æ¨¡åž‹ å¤šé‡æ€§â€”å¤šé‡æ€§æ ‡è®°æ³•ä¸Žèµ„æ–™åº“å»ºæ¨¡åŸºæ•°å¯¹åº”ï¼Œä¾‹å¦‚ï¼š1, 0..1, 1..* éƒ¨ç½²å›¾ éƒ¨ç½²å›¾ï¼ˆDeployment Diagramï¼‰ç”¨äºŽå¯¹ç³»ç»Ÿçš„ç‰©ç†ç»“æž„å»ºæ¨¡ã€‚éƒ¨ç½²å›¾å°†æ˜¾ç¤ºç³»ç»Ÿä¸­çš„è½¯ä»¶ç»„ä»¶å’Œç¡¬ä»¶ç»„ä»¶ä¹‹é—´çš„å…³ç³»ä»¥åŠå¤„ç†å·¥ä½œçš„ç‰©ç†åˆ†å¸ƒã€‚ èŠ‚ç‚¹ èŠ‚ç‚¹æ—¢å¯ä»¥æ˜¯ç¡¬ä»¶å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯è½¯ä»¶å…ƒç´ ã€‚å®ƒæ˜¾ç¤ºä¸ºä¸€ä¸ªç«‹æ–¹ä½“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ èŠ‚ç‚¹å®žä¾‹ å›¾å¯ä»¥æ˜¾ç¤ºèŠ‚ç‚¹å®žä¾‹ï¼Œå®žä¾‹ä¸ŽèŠ‚ç‚¹çš„åŒºåˆ†æ˜¯ï¼šå®žä¾‹çš„åç§°å¸¦ä¸‹åˆ’çº¿ï¼Œå†’å·æ”¾åœ¨å®ƒçš„åŸºæœ¬èŠ‚ç‚¹ç±»åž‹ä¹‹å‰ã€‚å®žä¾‹åœ¨å†’å·ä¹‹å‰å¯ä»¥æœ‰åç§°ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰åç§°ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªå…·åçš„è®¡ç®—æœºå®žä¾‹ã€‚ èŠ‚ç‚¹æž„é€ åž‹ ä¸ºèŠ‚ç‚¹æä¾›äº†è®¸å¤šæ ‡å‡†çš„æž„é€ åž‹ï¼Œåˆ†åˆ«å‘½åä¸º Â«cdromÂ»ï¼Œ Â«cd-romÂ»ï¼Œ Â«computerÂ»ï¼Œ Â«disk arrayÂ»ï¼Œ Â«pcÂ»ï¼Œ Â«pc clientÂ»ï¼Œ Â«pc serverÂ»ï¼Œ Â«secureÂ»ï¼Œ Â«serverÂ»ï¼Œ Â«storageÂ»ï¼Œ Â«unix serverÂ»ï¼Œ Â«user pcÂ»ã€‚ å¹¶åœ¨èŠ‚ç‚¹ç¬¦å·çš„å³ä¸Šè§’æ˜¾ç¤ºé€‚å½“çš„å›¾æ ‡ã€‚ å·¥ä»¶ å·¥ä»¶æ˜¯è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­çš„äº§å“ã€‚åŒ…æ‹¬è¿‡ç¨‹æ¨¡åž‹ï¼ˆå¦‚ï¼šç”¨ä¾‹æ¨¡åž‹ï¼Œè®¾è®¡æ¨¡åž‹ç­‰ï¼‰ï¼Œæºæ–‡ä»¶ï¼Œæ‰§è¡Œæ–‡ä»¶ï¼Œè®¾è®¡æ–‡æ¡£ï¼Œæµ‹è¯•æŠ¥å‘Šï¼Œæž„é€ åž‹ï¼Œç”¨æˆ·æ‰‹å†Œç­‰ç­‰ã€‚ å·¥ä»¶è¡¨ç¤ºä¸ºå¸¦æœ‰å·¥ä»¶åç§°çš„çŸ©å½¢ï¼Œå¹¶æ˜¾ç¤ºÂ«artifactÂ»å…³é”®å­—å’Œæ–‡æ¡£ç¬¦å·ã€‚ å…³è” åœ¨éƒ¨ç½²å›¾çš„ä¸Šä¸‹æ–‡è”ç³»ä¸­ï¼Œå…³è”ä»£è¡¨èŠ‚ç‚¹é—´çš„è”ç³»é€šé“ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªç½‘ç»œç³»ç»Ÿçš„éƒ¨ç½²å›¾ï¼Œæè¿°äº†ç½‘ç»œåè®®ä¸ºæž„é€ åž‹å’Œå…³è”ç»ˆç«¯çš„å¤šé‡æ€§ï¼Œ ä½œä¸ºå®¹å™¨çš„èŠ‚ç‚¹ èŠ‚ç‚¹å¯ä»¥åŒ…å«å…¶ä»–å…ƒç´ ï¼Œå¦‚ç»„ä»¶å’Œå·¥ä»¶ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªåµŒå…¥å¼ç³»ç»ŸæŸä¸ªéƒ¨åˆ†çš„éƒ¨ç½²å›¾ã€‚æå†™äº†ä¸€ä¸ªè¢«ä¸»æ¿èŠ‚ç‚¹åŒ…å«çš„å¯æ‰§è¡Œå·¥ä»¶ã€‚ ç»„ä»¶å›¾ ç»„ä»¶å›¾ï¼ˆComponent Diagramï¼‰æç»˜äº†ç»„æˆä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„æ¨¡å—å’ŒåµŒå…¥æŽ§ä»¶ã€‚ç»„ä»¶å›¾æ¯”ç±»å›¾å…·æœ‰æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼é€šå¸¸è¿è¡Œæ—¶ä¸€ä¸ªç»„ä»¶è¢«ä¸€ä¸ªæˆ–å¤šä¸ªç±»ï¼ˆæˆ–å¯¹è±¡ï¼‰å®žçŽ°ã€‚å®ƒä»¬è±¡ç§¯æœ¨é‚£æ ·ä½¿å¾—ç»„ä»¶èƒ½æœ€ç»ˆæž„æˆç³»ç»Ÿçš„ç»å¤§éƒ¨åˆ†ã€‚ ä¸Šå›¾æ¼”ç¤ºäº†ä¸€äº›ç»„ä»¶å’Œå®ƒä»¬çš„å†…éƒ¨å…³ç³»ã€‚è£…é…è¿žæŽ¥å™¨ï¼ˆAssembly connectorsï¼‰â€œè¿žæŽ¥â€ç”±&quot;Product&quot;å’Œ&quot;Customer&quot;çš„æä¾›æŽ¥å£åˆ°ç”± &quot;Order&quot;æŒ‡å®šçš„éœ€æ±‚æŽ¥å£ã€‚ ä¸€ä¸ªä¾èµ–å…³ç³»æ˜ å°„äº†å®¢æˆ·ç›¸å…³çš„å¸æˆ·ä¿¡æ¯åˆ°â€œOrderâ€éœ€è¦çš„ &quot;Payment&quot;éœ€æ±‚æŽ¥å£ã€‚ å®žé™…ä¸Šï¼Œç»„ä»¶å›¾åŒåŒ…å›¾å¾ˆç›¸ä¼¼ï¼Œå®ƒä»¬éƒ½æœ‰æ˜Žç¡®çš„ç•Œé™ï¼ŒæŠŠå…ƒç´ åˆ†ç»„åˆ°é€»è¾‘ç»“æž„ä¸­ã€‚ä»–ä»¬ä¹‹é—´çš„ä¸åŒæ˜¯ï¼šç»„ä»¶å›¾æä¾›äº†è¯­ä¹‰æ›´ä¸°å¯Œçš„åˆ†ç»„æœºåˆ¶ï¼Œåœ¨ç»„ä»¶å›¾ä¸­ï¼Œæ‰€æœ‰çš„æ¨¡åž‹å…ƒç´ éƒ½æ˜¯ç§æœ‰çš„ï¼Œè€ŒåŒ…å›¾åªæ˜¾ç¤ºå…¬æœ‰çš„æˆå‘˜ã€‚ è¡¨çŽ°ç»„ä»¶ ç»„ä»¶å¯è¡¨ç¤ºä¸ºå¸¦å…³é”®å­— Â«componentÂ»çš„çŸ©å½¢ç±»å…ƒï¼›ä¹Ÿå¯ç”¨å³ä¸Šè§’æœ‰ç»„ä»¶å›¾æ ‡çš„çŸ©å½¢è¡¨ç¤ºã€‚ è£…é…è¿žæŽ¥å™¨ è£…é…è¿žæŽ¥å™¨åœ¨ç»„ä»¶ â€œComponent1â€çš„éœ€æ±‚æŽ¥å£å’Œå¦ä¸€ä¸ªç»„ä»¶ â€œComponent2â€çš„æä¾›æŽ¥å£ä¹‹é—´å»ºç«‹æ¡¥æ¢; è¿™ä¸ªæ¡¥æ¢ä½¿å¾—ä¸€ä¸ªç»„ä»¶èƒ½æä¾›å¦ä¸€ä¸ªç»„ä»¶æ‰€éœ€è¦çš„æœåŠ¡ã€‚ å¸¦ç«¯å£ç»„ä»¶ ä½¿ç”¨ç«¯å£çš„ç»„ä»¶å›¾å…è®¸åœ¨å®ƒçš„çŽ¯å¢ƒæŒ‡å®šä¸€ä¸ªæœåŠ¡å’Œè¡Œä¸ºï¼ŒåŒæ—¶è¿™ä¸ªæœåŠ¡å’Œè¡Œä¸ºä¹Ÿæ˜¯ç»„ä»¶éœ€è¦çš„ã€‚å½“ç«¯å£è¿›è¡ŒåŒå‘æ“ä½œçš„æ—¶å€™ï¼Œå®ƒå¯ä»¥æŒ‡å®šè¾“å…¥å’Œè¾“å‡ºã€‚ä¸‹å›¾è¯¦è¿°äº†ç”¨äºŽåœ¨çº¿æœåŠ¡çš„å¸¦ç«¯å£ç»„ä»¶ï¼Œå®ƒæœ‰ä¸¤ä¸ªæä¾›æŽ¥å£ â€œorder entryâ€å’Œ â€œtrackingâ€ï¼Œä¹Ÿæœ‰ â€œpaymentâ€ éœ€æ±‚æŽ¥å£ã€‚ åŒ…å›¾ åŒ…å›¾ï¼ˆPackage Diagramï¼‰ç”¨æ¥è¡¨çŽ°åŒ…å’Œå®ƒæ‰€åŒ…å«å…ƒç´ çš„ç»„ç»‡ã€‚å½“ç”¨æ¥ä»£è¡¨ç±»å…ƒç´ æ—¶ï¼ŒåŒ…å›¾æä¾›äº†å‘½åç©ºé—´çš„å¯è§†åŒ–ã€‚åŒ…å›¾æœ€å¸¸ç”¨çš„ç”¨é€”æ˜¯ç”¨æ¥ç»„ç»‡ç”¨ä¾‹å›¾å’Œç±»å›¾ï¼Œå°½ç®¡å®ƒä¸å±€é™äºŽè¿™äº› UML å…ƒç´ ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªåŒ…å›¾çš„ä¾‹å­ã€‚ åŒ…ä¸­çš„å…ƒç´ å…±äº«ç›¸åŒçš„å‘½åç©ºé—´ï¼Œå› æ­¤ï¼Œä¸€ä¸ªæŒ‡å®šå‘½åç©ºé—´çš„å…ƒç´ å¿…é¡»æœ‰å”¯ä¸€çš„åç§°ã€‚ åŒ…å¯ä»¥ç”¨æ¥ä»£è¡¨ç‰©ç†æˆ–é€»è¾‘å…³ç³»ã€‚é€‰æ‹©æŠŠç±»åŒ…æ‹¬åœ¨æŒ‡å®šçš„åŒ…é‡Œï¼Œæœ‰åŠ©äºŽåœ¨åŒä¸€ä¸ªåŒ…é‡Œèµ‹äºˆè¿™äº›ç±»ç›¸åŒç»§æ‰¿å±‚æ¬¡ã€‚é€šå¸¸è®¤ä¸ºæŠŠé€šè¿‡å¤åˆç›¸å…³è”çš„ç±»ï¼Œä»¥åŠä¸Žå®ƒä»¬ç›¸åä½œçš„ç±»æ”¾åœ¨åŒä¸€ä¸ªåŒ…é‡Œã€‚ åœ¨ UML2.5 ä¸­ï¼ŒåŒ…ç”¨æ–‡ä»¶å¤¹æ¥è¡¨ç¤ºï¼ŒåŒ…ä¸­çš„å…ƒç´ å…±äº«åŒä¸€ä¸ªå‘½åç©ºé—´ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å¯è¯†åˆ«çš„ï¼Œå› æ­¤è¦æœ‰å”¯ä¸€çš„åç§°æˆ–ç±»åž‹ã€‚åŒ…å¿…é¡»æ˜¾ç¤ºåŒ…åï¼Œåœ¨é™„å±žæ–¹æ¡†éƒ¨åˆ†æœ‰é€‰æ‹©çš„æ˜¾ç¤ºåŒ…å†…çš„å…ƒç´ ã€‚ åŒ…çš„åˆå¹¶ - åŒ…ä¹‹é—´çš„åˆå¹¶è¿žæŽ¥ç¬¦Â«mergeÂ»å®šä¹‰äº†æºåŒ…å…ƒç´ ä¸Žç›®æ ‡åŒ…åŒåå…ƒç´ ä¹‹é—´çš„æ³›åŒ–å…³ç³»ã€‚æºåŒ…å…ƒç´ çš„å®šä¹‰è¢«æ‰©å±•æ¥åŒ…å«ç›®æ ‡åŒ…å…ƒç´ å®šä¹‰ã€‚å½“æºåŒ…å…ƒç´ ä¸Žç›®æ ‡åŒ…å†…æ²¡æœ‰åŒåå…ƒç´ æ—¶ï¼Œç›®æ ‡åŒ…å…ƒç´ çš„å®šä¹‰ä¸å—å½±å“ã€‚ åŒ…çš„å¯¼å…¥ - å¯¼å…¥è¿žæŽ¥ç¬¦ Â«importÂ»è¡¨æ˜Žç›®æ ‡åŒ…çš„å…ƒç´ ï¼Œåœ¨è¯¥ä¾‹ä¸­æ˜¯ä¸€ä¸ªç±» ï¼Œåœ¨æºåŒ…ä¸­è¢«å¼•ç”¨è¦ç”¨éžé™å®šä¿®é¥°åã€‚æºåŒ…çš„å‘½åç©ºé—´èŽ·å¾—ç›®æ ‡ç±»çš„æŽ¥å£ï¼Œç›®æ ‡åŒ…çš„å‘½åç©ºé—´åˆ™ä¸å—å½±å“ã€‚ åµŒå¥—è¿žæŽ¥ç¬¦ - æºåŒ…å’Œç›®æ ‡åŒ…é—´çš„åµŒå¥—è¿žæŽ¥ç¬¦è¯´æ˜Žç›®æ ‡åŒ…å®Œå…¨åŒ…å«æºåŒ…ã€‚ ç±»å›¾ ç±»å›¾ï¼ˆClass Diagramï¼‰å±•ç¤ºäº†é¢å‘å¯¹è±¡ç³»ç»Ÿçš„æž„é€ æ¨¡å—ã€‚æç»˜äº†æ¨¡åž‹æˆ–éƒ¨åˆ†æ¨¡åž‹çš„é™æ€è§†å›¾ï¼Œæ˜¾ç¤ºå®ƒåŒ…å«çš„å±žæ€§å’Œè¡Œä¸ºï¼Œè€Œä¸æ˜¯è¯¦ç»†æè¿°æ“ä½œçš„åŠŸèƒ½æˆ–å®Œå–„æ–¹æ³•ã€‚ç±»å›¾æœ€å¸¸ç”¨æ¥è¡¨è¾¾å¤šä¸ªç±»å’ŒæŽ¥å£ä¹‹é—´çš„å…³ç³»ã€‚æ³›åŒ–ï¼ˆGeneralizationsï¼‰ï¼Œèšåˆï¼ˆaggregationsï¼‰å’Œå…³è”ï¼ˆassociationsï¼‰åˆ†åˆ«æ˜¯ç±»ä¹‹é—´ç»§æ‰¿ï¼Œå¤åˆæˆ–åº”ç”¨ï¼ŒåŠè¿žæŽ¥çš„è¡¨çŽ°ã€‚ ä¸‹é¢çš„å›¾æ˜¾ç¤ºäº†ç±»ä¹‹é—´çš„èšåˆå…³ç³»ã€‚å¼±èšåˆï¼ˆæµ…è‰²ç®­å¤´ï¼‰è¡¨çŽ°åœ¨ç±» â€œAccountâ€ ä½¿ç”¨ â€œAddressBookâ€ï¼Œä½†æ˜¯ä¸å¿…è¦åŒ…å«å®ƒçš„ä¸€ä¸ªå®žä¾‹ã€‚å¼ºèšåˆï¼ˆå›¾ä¸­çš„é»‘è‰²ç®­å¤´ï¼‰è¡¨ç¤ºäº†ç›®æ ‡ç±»åŒ…å«æºç±»ï¼Œä¾‹å¦‚ï¼Œâ€œContactâ€ å’Œ &quot;ContactGroup&quot;å€¼è¢«åŒ…å«åœ¨ &quot;AddressBook&quot;ä¸­ã€‚ ç±»ï¼ˆClassesï¼‰ ç±»æ˜¯å®šä¹‰å¯¹è±¡æ‰€å…·æœ‰çš„å±žæ€§å’Œè¡Œä¸ºçš„å…ƒç´ ã€‚è¡Œä¸ºç”¨ç±»èƒ½ç†è§£çš„åˆé€‚æ¶ˆæ¯å’Œé€‚åˆæ¯æ¡æ¶ˆæ¯çš„æ“ä½œæ¥æè¿°ã€‚ ç±»ä¸­ä¹Ÿå¯èƒ½å®šä¹‰çº¦æŸï¼Œæ ‡è®°å€¼ï¼Œæž„é€ åž‹ã€‚ ç±»çš„æ ‡æŸ±ï¼ˆClass Notationï¼‰ ç±»ç”¨çŸ©å½¢è¡¨ç¤ºã€‚é™¤ç±»çš„åç§°å¤–ï¼Œè¿˜å¯ä»¥é€‰æ‹©æ€§åœ°æ˜¾ç¤ºå±žæ€§å’Œæ“ä½œã€‚ åˆ†æ åˆ†åˆ«ç”¨æ¥æ˜¾ç¤ºç±»çš„åç§°ï¼Œå±žæ€§å’Œæ“ä½œã€‚ åœ¨ä¸‹é¢å›¾ä¸­ï¼Œç±»çš„ç±»åæ˜¾ç¤ºåœ¨æœ€ä¸Šé¢çš„åˆ†æ ï¼Œå®ƒä¸‹é¢çš„åˆ†æ æ˜¾ç¤ºè¯¦ç»†å±žæ€§ï¼Œå¦‚ï¼šâ€œcenterâ€ å±žæ€§æ˜¾ç¤ºåˆå§‹åŒ–çš„å€¼ã€‚æœ€åŽé¢çš„åˆ†æ æ˜¾ç¤ºæ“ä½œï¼Œå¦‚ï¼š setWidthï¼ŒsetLength å’Œ setPosition ä»¥åŠä»–ä»¬çš„å‚æ•°ã€‚ å±žæ€§å’Œæ“ä½œåå‰çš„æ ‡æ³¨è¡¨ç¤ºäº†è¯¥å±žæ€§æˆ–æ“ä½œçš„å¯è§æ€§: å¦‚æžœä½¿ç”¨ &quot;+&quot;å·ï¼Œè¿™ä¸ªå±žæ€§æˆ–æ“ä½œæ˜¯å…¬å…±çš„ ; â€œ-â€ å·åˆ™ä»£è¡¨è¿™ä¸ªå±žæ€§æˆ–æ“ä½œæ˜¯ç§æœ‰çš„ã€‚ â€œ#â€œå·æ˜¯è¿™ä¸ªå±žæ€§æˆ–æ“ä½œè¢«å®šä¹‰ä¸ºä¿æŠ¤çš„ï¼Œâ€ ~â€ å·ä»£è¡¨åŒ…çš„å¯è§æ€§ã€‚ æŽ¥å£ï¼ˆInterfacesï¼‰ æŽ¥å£æ˜¯å®žæ–½è€…åŒæ„æ»¡è¶³çš„è¡Œä¸ºè§„èŒƒï¼Œæ˜¯ä¸€ç§çº¦å®šã€‚å®žçŽ°ä¸€ä¸ªæŽ¥å£ï¼Œç±»å¿…éœ€æ”¯æŒå…¶è¦æ±‚çš„è¡Œä¸ºï¼Œä½¿ç³»ç»ŸæŒ‰ç…§åŒæ ·çš„æ–¹å¼ï¼Œå³å…¬å…±çš„æŽ¥å£ï¼Œå¤„ç†ä¸ç›¸å…³çš„å…ƒç´ ã€‚ æŽ¥å£æœ‰ç›¸ä¼¼äºŽç±»çš„å¤–å½¢é£Žæ ¼ï¼Œå«æœ‰æŒ‡å®šçš„æ“ä½œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å¦‚æžœæ²¡æœ‰æ˜Žç¡®çš„è¯¦ç»†æ“ä½œï¼Œä¹Ÿå¯ä»¥ç”»æˆä¸€ä¸ªåœ†çŽ¯ã€‚å½“ç”»æˆåœ†çŽ¯çš„æ—¶å€™ï¼Œåˆ°è¿™ä¸ªçŽ¯å½¢æ ‡æŸ±çš„å®žçŽ°è¿žæŽ¥æ²¡æœ‰ç›®æ ‡ç®­å¤´ã€‚ è¡¨ï¼ˆTablesï¼‰ è¡¨å°½ç®¡ä¸æ˜¯åŸºæœ¬ UML çš„ä¸€éƒ¨åˆ†ï¼Œä»ç„¶æ˜¯â€œå›¾åž‹â€èƒ½å®Œæˆçš„å®žä¾‹ç”¨ã€‚åœ¨å³ä¸Šè§’ç”»ä¸€ä¸ªè¡¨çš„å°å›¾æ ‡æ¥è¡¨ç¤ºã€‚è¡¨å±žæ€§ç”¨â€œå›¾åž‹â€ Â«columnÂ»è¡¨ç¤ºã€‚ ç»å¤§å¤šæ•°è¡¨å•æœ‰ä¸€ä¸ªä¸»é”®ï¼Œæ˜¯ç”±ä¸€ä¸ªæˆ–å‡ ä¸ªå­—æ®µç»„æˆçš„ä¸€ä¸ªå”¯ä¸€çš„å­—ç ç»„åˆåŠ ä¸»é”®æ“ä½œæ¥è®¿é—®è¡¨æ ¼ï¼Œä¸»é”®æ“ä½œâ€œå›¾åž‹â€ä¸ºÂ«PKÂ»ã€‚ ä¸€äº›è¡¨æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå¤–é”®ï¼Œä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µåŠ ä¸€ä¸ªå¤–é”®æ“ä½œï¼Œæ˜ å°„åˆ°ç›¸å…³è¡¨çš„ä¸»é”®ä¸ŠåŽ»ï¼Œå¤–é”®æ“ä½œâ€œå›¾åž‹â€ä¸ºÂ«FKÂ»ã€‚ å…³è”ï¼ˆAssociationsï¼‰ å…³è”è¡¨æ˜Žä¸¤ä¸ªæ¨¡åž‹å…ƒç´ ä¹‹é—´æœ‰å…³ç³»ï¼Œé€šå¸¸ç”¨åœ¨ä¸€ä¸ªç±»ä¸­è¢«å®žçŽ°ä¸ºä¸€ä¸ªå®žä¾‹å˜é‡ã€‚è¿žæŽ¥ç¬¦å¯ä»¥åŒ…å«ä¸¤ç«¯çš„å‘½åçš„è§’è‰²ï¼ŒåŸºæ•°æ€§ï¼Œæ–¹å‘å’Œçº¦æŸã€‚å…³è”æ˜¯å…ƒç´ ä¹‹é—´æ™®é€šçš„å…³ç³»ã€‚å¦‚æžœå¤šäºŽä¸¤ä¸ªå…ƒç´ ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è±å½¢çš„å…³è”å…³ç³»ã€‚å½“ä»Žç±»å›¾ç”Ÿæˆä»£ç æ—¶ï¼Œå…³è”æœ«ç«¯çš„å¯¹è±¡å°†å˜æˆç›®æ ‡ç±»ä¸­å®žä¾‹å˜é‡ã€‚è§ä¸‹å›¾ç¤ºä¾‹ â€œplaysForâ€ å°†å˜æˆ&quot;Player&quot;ç±»ä¸­çš„å®žä¾‹å˜é‡ã€‚ æ³›åŒ–ï¼ˆGeneralizationsï¼‰ æ³›åŒ–è¢«ç”¨æ¥è¯´æ˜Žç»§æ‰¿å…³ç³»ã€‚è¿žæŽ¥ä»Žç‰¹å®šç±»å…ƒåˆ°ä¸€èˆ¬ç±»å…ƒã€‚æ³›åŒ–çš„å«ä¹‰æ˜¯æºç±»ç»§æ‰¿äº†ç›®æ ‡ç±»çš„ç‰¹æ€§ã€‚ä¸‹å›¾çš„å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªçˆ¶ç±»æ³›åŒ–ä¸€ä¸ªå­ç±»ï¼Œ ç±»â€œCircleâ€çš„ä¸€ä¸ªå®žä¾‹å°†ä¼šæœ‰å±žæ€§ â€œ x_positionâ€ï¼Œâ€œ y_positionâ€ ï¼Œ â€œradiusâ€ å’Œ æ–¹æ³• â€œdisplay()â€ã€‚ æ³¨æ„ï¼šç±» â€œShapeâ€ æ˜¯æŠ½è±¡çš„ï¼Œç±»åæ˜¾ç¤ºä¸ºæ–œä½“ã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†ä¸Žä¸Šå›¾ç›¸åŒä¿¡æ¯çš„è§†å›¾ã€‚ èšåˆï¼ˆAggregationsï¼‰ èšåˆé€šå¸¸è¢«ç”¨æ¥æè¿°ç”±æ›´å°çš„ç»„ä»¶æ‰€æž„æˆçš„å…ƒç´ ã€‚èšåˆå…³ç³»è¡¨ç¤ºä¸ºç™½è‰²è±å½¢ç®­å¤´æŒ‡å‘ç›®æ ‡ç±»æˆ–çˆ¶ç±»ã€‚ èšåˆçš„æ›´å¼ºå½¢å¼ -ç»„åˆèšåˆï¼ˆå¼ºèšåˆï¼‰ - æ˜¾ç¤ºä¸ºé»‘è‰²è±å½¢ç®­å¤´ï¼Œç”¨æ¥ç»„åˆæ¯æ¬¡æœ€å¤§åŒ–çš„åŒ…å«ç»„ä»¶ã€‚å¦‚æžœä¸€ä¸ªç»„åˆèšåˆçš„çˆ¶ç±»è¢«åˆ é™¤ï¼Œé€šå¸¸ä¸Žä»–ç›¸å…³çš„æ‰€æœ‰éƒ¨åˆ†éƒ½ä¼šè¢«åˆ é™¤ï¼Œä½†æ˜¯ï¼Œå¦‚æžœä¸€ä¸ªéƒ¨ä»¶ä»Žç»„åˆä¸­åŽ»æŽ‰ï¼Œå°†ä¸ç”¨åˆ é™¤æ•´ä¸ªç»„åˆã€‚ç»„åˆæ˜¯å¯è¿ï¼Œéžå¯¹ç§°çš„å…³ç³»å’Œé€’å½’çš„ã€‚ ä¸‹é¢çš„å›¾ç¤ºï¼šæ˜¾ç¤ºäº†å¼±èšåˆå’Œå¼ºèšåˆçš„ä¸åŒã€‚â€œ address bookâ€ ç”±è®¸å¤š â€œcontactsâ€ å’Œ â€œcontact groupsâ€ç»„æˆã€‚ â€œcontact groupâ€ æ˜¯ä¸€ä¸ªâ€œcontactsâ€çš„è™šåˆ†ç»„; â€œcontactâ€å¯ä»¥è¢«åŒ…å«åœ¨ä¸æ­¢ä¸€ä¸ª â€œ contact groupâ€ã€‚ å¦‚æžœä½ åˆ é™¤ä¸€ä¸ªâ€œ address bookâ€ï¼Œæ‰€æœ‰çš„ â€œcontactsâ€ å’Œ â€œcontact groupsâ€ ä¹Ÿå°†ä¼šè¢«åˆ é™¤ï¼›å¦‚æžœä½ åˆ é™¤â€œ contact groupâ€ï¼Œ æ²¡æœ‰ â€œcontactsâ€ä¼šè¢«åˆ é™¤ã€‚ å…³è”ç±»ï¼ˆAssociation Classesï¼‰ å…³è”ç±»æ˜¯ä¸€ä¸ªå…è®¸å…³è”è¿žæŽ¥æœ‰å±žæ€§å’Œæ“ä½œçš„æž„é€ ã€‚ä¸‹é¢çš„ç¤ºä¾‹ï¼šæ˜¾ç¤ºäº†è¿œä¸æ­¢ç®€å•è¿žæŽ¥ä¸¤ä¸ªç±»çš„è¿žæŽ¥ï¼Œå¦‚ç»™â€œemployeeâ€åˆ†é…é¡¹ç›®ã€‚â€œ employeeâ€åœ¨é¡¹ç›®ä¸­æ‰€èµ·çš„ä½œç”¨æ˜¯ä¸€ä¸ªå¤æ‚çš„å®žä½“ï¼Œæ—¢æœ‰è‡ªèº«çš„ä¹Ÿæœ‰ä¸å±žäºŽâ€œemployeeâ€ æˆ– â€œprojectâ€ ç±»çš„ç»†èŠ‚ã€‚ ä¾‹å¦‚ï¼Œâ€œ employeeâ€å¯ä»¥åŒæ—¶ä¸ºå‡ ä¸ªé¡¹ç›®å·¥ä½œï¼Œæœ‰ä¸åŒçš„èŒåŠ¡å¤´è¡”å’Œå¯¹åº”çš„å®‰å…¨æƒé™ã€‚ ä¾èµ–ï¼ˆDependenciesï¼‰ ä¾èµ–è¢«ç”¨æ¥æè¿°æ¨¡åž‹å…ƒç´ é—´å¹¿æ³›çš„ä¾èµ–å…³ç³»ã€‚é€šå¸¸åœ¨è®¾è®¡è¿‡ç¨‹æ—©æœŸæ˜¾ç¤ºä¸¤ä¸ªå…ƒç´ ä¹‹é—´å­˜åœ¨æŸç§å…³ç³»ï¼Œå› ä¸ºæ˜¯åˆæœŸè€Œä¸èƒ½ç¡®å®šå…·ä½“æ˜¯ä»€ä¹ˆå…³ç³»ï¼Œåœ¨è®¾è®¡è¿‡ç¨‹æœ«æœŸï¼Œè¯¥ç»§æ‰¿å…³ç³»ä¼šè¢«å½’å…¥å·²æœ‰æž„é€ åž‹ (æž„é€ åž‹ å¯ä»¥æ˜¯å®žä¾‹åŒ– Â«instantiateÂ»ï¼Œè·Ÿè¸ª Â«traceÂ»ï¼Œå¯¼å…¥ Â«importÂ»ï¼Œ å’Œå…¶å®ƒçš„å…³ç³»)ï¼Œæˆ–è¢«æ›¿æ¢æˆä¸€ä¸ªæ›´æ˜Žç¡®ç±»åž‹çš„è¿žæŽ¥ç¬¦ã€‚ è·Ÿè¸ªï¼ˆTracesï¼‰ è·Ÿè¸ªå…³ç³»æ˜¯ä¸€ç§ç‰¹æ®ŠåŒ–çš„ä¾èµ–å…³ç³»ã€‚è¿žæŽ¥æ¨¡åž‹å…ƒç´ æˆ–è·¨æ¨¡åž‹ä½†æ˜¯å…·æœ‰ç›¸åŒæ¦‚å¿µçš„æ¨¡åž‹å…ƒç´ é›†ã€‚è·Ÿè¸ªè¢«ç»å¸¸ç”¨æ¥è¿½è¸ªéœ€æ±‚å’Œæ¨¡åž‹çš„å˜åŒ–ã€‚ç”±äºŽå˜åŒ–æ˜¯åŒå‘çš„ï¼Œè¿™ç§ä¾èµ–å…³ç³»çš„é¡ºåºé€šå¸¸è¢«å¿½ç•¥ã€‚è¿™ç§å…³ç³»çš„å±žæ€§å¯ä»¥è¢«æŒ‡å®šä¸ºå•å‘æ˜ å°„ï¼Œä½†è·Ÿè¸ªæ˜¯åŒå‘çš„ï¼Œéžæ­£å¼çš„å’Œå¾ˆå°‘å¯è®¡ç®—çš„ã€‚ å®žçŽ°ï¼ˆRealizationsï¼‰ æ˜¯æºå¯¹è±¡æ‰§è¡Œæˆ–å®žçŽ°ç›®æ ‡ï¼Œå®žçŽ°è¢«ç”¨æ¥è¡¨è¾¾æ¨¡åž‹çš„å¯è·Ÿè¸ªæ€§å’Œå®Œæ•´æ€§ï¼ä¸šåŠ¡æ¨¡åž‹æˆ–éœ€æ±‚è¢«ä¸€ä¸ªæˆ–å¤šä¸ªç”¨ä¾‹å®žçŽ°ï¼Œç”¨ä¾‹åˆ™è¢«ç±»å®žçŽ°ï¼Œç±»è¢«ç»„ä»¶å®žçŽ°ï¼Œç­‰ç­‰ã€‚è¿™ç§å®žçŽ°è´¯ç©¿äºŽç³»ç»Ÿè®¾è®¡çš„æ˜ å°„éœ€æ±‚å’Œç±»ç­‰ï¼Œç›´è‡³æŠ½è±¡å»ºæ¨¡æ°´å¹³çº§ã€‚ä»Žè€Œç¡®ä¿æ•´ä¸ªç³»ç»Ÿçš„ä¸€å¼ å®å›¾ï¼Œå®ƒä¹Ÿåæ˜ ç³»ç»Ÿçš„æ‰€æœ‰å¾®å°ç»„æˆï¼Œä»¥åŠçº¦æŸå’Œå®šä¹‰å®ƒçš„ç»†èŠ‚ã€‚å®žçŽ°å…³ç³»ç”¨å¸¦è™šçº¿çš„å®žç®­å¤´è¡¨ç¤ºã€‚ åµŒå¥—ï¼ˆNestingsï¼‰ åµŒå¥—è¿žæŽ¥ç¬¦ç”¨æ¥è¡¨ç¤ºæºå…ƒç´ åµŒå¥—åœ¨ç›®æ ‡å…ƒç´ ä¸­ã€‚ä¸‹å›¾æ˜¾ç¤ºâ€œ inner classâ€çš„å®šä¹‰ï¼Œå°½ç®¡åœ¨ EA ä¸­ï¼Œæ›´å¤šåœ°æŒ‰ç…§ç€ä»–ä»¬åœ¨é¡¹ç›®å±‚æ¬¡è§†å›¾ä¸­çš„ä½ç½®æ¥æ˜¾ç¤ºè¿™ç§å…³ç³»ã€‚ å¤åˆç»“æž„å›¾ å¤åˆç»“æž„å›¾æ˜¾ç¤ºç±»çš„å†…éƒ¨ç»“æž„ï¼ŒåŒ…æ‹¬å®ƒä¸Žç³»ç»Ÿå…¶ä»–éƒ¨åˆ†çš„äº¤äº’ç‚¹ã€‚ä¹Ÿæ˜¾ç¤ºå„éƒ¨åˆ†çš„é…ç½®ä¸Žå…³ç³»ï¼Œè¿™äº›éƒ¨åˆ†ä¸€èµ·æ‰§è¡Œç±»å…ƒçš„è¡Œä¸ºã€‚ ç±»å…ƒç´ å·²ç»åœ¨ç±»å›¾éƒ¨åˆ†è¢«è¯¦ç»†åœ°é˜è¿°ï¼Œè¿™éƒ¨åˆ†ç”¨æ¥è¯´æ˜Žç±»è¡¨çŽ°å¤åˆå…ƒç´ çš„æ–¹å¼ï¼Œå¦‚ï¼šæš´éœ²æŽ¥å£ï¼ŒåŒ…å«ç«¯å£å’Œéƒ¨ä»¶ã€‚ éƒ¨ä»¶ éƒ¨ä»¶æ˜¯ä»£è¡¨ä¸€ç»„ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰å®žä¾‹çš„å…ƒç´ ï¼Œè¿™ç»„å®žä¾‹çš„æ‹¥æœ‰è€…æ˜¯ä¸€ç±»å…ƒå®žä¾‹ï¼Œä¾‹å¦‚ï¼šå¦‚æžœä¸€ä¸ªå›¾çš„å®žä¾‹æœ‰ä¸€ç»„å›¾å½¢å…ƒç´ ï¼Œåˆ™è¿™äº›å›¾å½¢å…ƒç´ å¯ä»¥è¢«è¡¨ç¤ºä¸ºéƒ¨ä»¶ï¼Œå¹¶å¯ä»¥å¯¹ä»–ä»¬ä¹‹é—´çš„æŸç§å…³ç³»å»ºæ¨¡ã€‚æ³¨æ„ï¼šä¸€ä¸ªéƒ¨ä»¶å¯ä»¥åœ¨å®ƒçš„çˆ¶ç±»è¢«åˆ é™¤ä¹‹å‰ä»Žçˆ¶ç±»ä¸­è¢«åŽ»æŽ‰ï¼Œè¿™æ ·éƒ¨ä»¶å°±ä¸ä¼šè¢«åŒæ—¶åˆ é™¤äº†ã€‚ éƒ¨ä»¶åœ¨ç±»æˆ–ç»„ä»¶å†…éƒ¨æ˜¾ç¤ºä¸ºä¸åŠ ä¿®é¥°çš„æ–¹æ¡†ã€‚ ç«¯å£ ç«¯å£æ˜¯ç±»åž‹åŒ–çš„å…ƒç´ ï¼Œä»£è¡¨ä¸€ä¸ªåŒ…å«ç±»å…ƒå®žä¾‹çš„å¤–éƒ¨å¯è§†çš„éƒ¨åˆ†ã€‚ç«¯å£å®šä¹‰äº†ç±»å…ƒå’Œå®ƒçš„çŽ¯å¢ƒä¹‹é—´çš„äº¤äº’ã€‚ç«¯å£æ˜¾ç¤ºåœ¨åŒ…å«å®ƒçš„éƒ¨ä»¶ï¼Œç±»æˆ–ç»„åˆç»“æž„çš„è¾¹ç¼˜ä¸Šã€‚ç«¯å£æŒ‡å®šäº†ç±»å…ƒæä¾›çš„æœåŠ¡ï¼Œä»¥åŠç±»å…ƒè¦æ±‚çŽ¯å¢ƒæä¾›çš„æœåŠ¡ã€‚ ç«¯å£æ˜¾ç¤ºä¸ºæ‰€å±žç±»å…ƒè¾¹ç•ŒæŒ‡å®šçš„æ–¹æ¡†ã€‚ æŽ¥å£ æŽ¥å£ä¸Žç±»ç›¸ä¼¼ï¼Œä½†æ˜¯æœ‰ä¸€äº›é™åˆ¶ï¼Œæ‰€æœ‰çš„æŽ¥å£æ“ä½œéƒ½æ˜¯å…¬å…±å’ŒæŠ½è±¡çš„ï¼Œä¸æä¾›ä»»ä½•é»˜è®¤çš„å®žçŽ°ã€‚æ‰€æœ‰çš„æŽ¥å£å±žæ€§éƒ½å¿…é¡»æ˜¯å¸¸é‡ã€‚ç„¶è€Œï¼Œå½“ä¸€ä¸ªç±»ä»Žä¸€ä¸ªå•ç‹¬çš„è¶…çº§ç±»ç»§æ‰¿è€Œæ¥ï¼Œå®ƒå¯ä»¥å®žçŽ°å¤šä¸ªæŽ¥å£ã€‚ å½“ä¸€ä¸ªæŽ¥å£åœ¨å›¾ä¸­å•åˆ—å‡ºæ¥ï¼Œå®ƒæ—¢å¯ä»¥æ˜¾ç¤ºä¸ºç±»å…ƒç´ çš„æ–¹æ¡†ï¼Œå¸¦ Â«interfaceÂ» å…³é”®å­—å’Œè¡¨æ˜Žå®ƒæ˜¯æŠ½è±¡çš„æ–œä½“åç§°ï¼Œä¹Ÿå¯ä»¥æ˜¾ç¤ºä¸ºåœ†çŽ¯ã€‚ æ³¨æ„ï¼šåœ†çŽ¯æ ‡æ³¨ä¸æ˜¾ç¤ºæŽ¥å£æ“ä½œã€‚å½“æŽ¥å£æ˜¾ç¤ºä¸ºç±»æ‰€æœ‰çš„æŽ¥å£ï¼Œå®ƒä»¬ä¼šè¢«å½“ä½œæš´éœ²æŽ¥å£å¼•ç”¨ã€‚æš´éœ²æŽ¥å£å¯ä»¥å®šä¹‰ä¸ºæ˜¯æä¾›çš„ï¼Œè¿˜æ˜¯éœ€æ±‚çš„ã€‚æä¾›æŽ¥å£ç¡®è®¤åŒ…å«å®ƒçš„ç±»å…ƒæä¾›æŒ‡å®šæŽ¥å£å…ƒç´ å®šä¹‰çš„æ“ä½œï¼Œå¯é€šè¿‡ç±»å’ŒæŽ¥å£é—´å®žçŽ°çš„è¿žæŽ¥æ¥å®šä¹‰ã€‚éœ€æ±‚æŽ¥å£è¯´æ˜Žè¯¥ç±»å…ƒèƒ½ä¸Žå…¶ä»–ç±»å…ƒè¿›è¡Œé€šä¿¡ï¼Œè¿™äº›ç±»å…ƒæä¾›äº†æŒ‡å®šæŽ¥å£å…ƒç´ æ‰€å®šä¹‰çš„æ“ä½œã€‚éœ€æ±‚æŽ¥å£å¯é€šè¿‡åœ¨ç±»å’ŒæŽ¥å£é—´å»ºç«‹ä¾èµ–è¿žæŽ¥æ¥å®šä¹‰ã€‚ æä¾›æŽ¥å£æ˜¾ç¤ºä¸ºâ€œå¸¦æ£’çƒä½“â€ï¼Œä¾é™„åœ¨ç±»å…ƒè¾¹ç¼˜ã€‚éœ€æ±‚æŽ¥å£æ˜¾ç¤ºä¸ºâ€œå¸¦æ£’æ¯ä½“â€ï¼Œä¹Ÿæ˜¯ä¾é™„åœ¨ç±»å…ƒè¾¹ç¼˜ã€‚ å§”æ‰˜ å§”æ‰˜è¿žæŽ¥å™¨ç”¨æ¥å®šä¹‰ç»„ä»¶å¤–éƒ¨ç«¯å£å’ŒæŽ¥å£çš„å†…éƒ¨å·¥ä½œæ–¹å¼ã€‚å§”æ‰˜è¿žæŽ¥å™¨è¡¨ç¤ºä¸ºå¸¦æœ‰ Â«delegateÂ» å…³é”®å­—çš„ç®­å¤´ã€‚å®ƒè¿žæŽ¥ç»„ä»¶çš„å¤–éƒ¨çº¦å®šï¼Œè¡¨çŽ°ä¸ºå®ƒçš„ç«¯å£ï¼Œåˆ°ç»„ä»¶éƒ¨ä»¶è¡Œä¸ºçš„å†…éƒ¨å®žçŽ°ã€‚ åä½œ åä½œå®šä¹‰äº†ä¸€ç³»åˆ—å…±åŒåä½œçš„è§’è‰²ï¼Œå®ƒä»¬é›†ä½“å±•ç¤ºä¸€ä¸ªæŒ‡å®šçš„è®¾è®¡åŠŸèƒ½ã€‚åä½œå›¾åº”ä»…ä»…æ˜¾ç¤ºå®ŒæˆæŒ‡å®šä»»åŠ¡æˆ–åŠŸèƒ½çš„è§’è‰²ä¸Žå±žæ€§ã€‚éš”ç¦»ä¸»è¦è§’è‰²æ˜¯ç”¨æ¥ç®€åŒ–ç»“æž„å’Œæ¾„æ¸…è¡Œä¸ºï¼Œä¹Ÿç”¨äºŽé‡ç”¨ã€‚ä¸€ä¸ªåä½œé€šå¸¸å®žçŽ°ä¸€ä¸ªæ¨¡å¼ã€‚ åä½œå…ƒç´ æ˜¾ç¤ºä¸ºæ¤­åœ†ã€‚ è§’è‰²ç»‘å®š è§’è‰²ç»‘å®šè¿žæŽ¥å™¨æ˜¯ä¸€æ¡ä»Žè¿žæŽ¥åä½œåˆ°æ‰€è¦å®Œæˆè¯¥ä»»åŠ¡ç±»å…ƒçš„è¿žçº¿ã€‚å®ƒæ˜¾ç¤ºä¸ºè™šçº¿ï¼Œå¹¶åœ¨ç±»å…ƒç«¯æ˜¾ç¤ºä½œç”¨åã€‚ è¡¨çŽ° è¡¨çŽ°è¿žæŽ¥å™¨ç”¨äºŽè¿žæŽ¥åä½œåˆ°ç±»å…ƒæ¥è¡¨ç¤ºæ­¤ç±»å…ƒä¸­ä½¿ç”¨äº†è¯¥åä½œã€‚æ˜¾ç¤ºä¸ºå¸¦å…³é”®å­— Â«representsÂ»çš„è™šçº¿ç®­å¤´ã€‚ å‘ç”Ÿ å‘ç”Ÿè¿žæŽ¥å™¨ç”¨äºŽè¿žæŽ¥åä½œåˆ°ç±»å…ƒæ¥è¡¨ç¤ºæ­¤åä½œè¡¨çŽ°äº†ï¼ˆåŒåŽŸæ–‡ï¼‰è¯¥ç±»å…ƒï¼›æ˜¾ç¤ºä¸ºå¸¦å…³é”®å­—Â«occurrenceÂ»çš„è™šçº¿ç®­å¤´ã€‚ å¯¹è±¡å›¾ å¯¹è±¡å›¾ï¼ˆObject Diagramï¼‰å¯ä»¥è®¤ä¸ºæ˜¯ç±»å›¾çš„ç‰¹æ®Šæƒ…å½¢ï¼Œæ˜¯ç±»å›¾å…ƒç´ å­é›†ï¼Œè¢«ç”¨æ¥åŠæ—¶å¼ºè°ƒåœ¨æŸäº›ç‚¹ï¼Œç±»çš„å®žä¾‹é—´çš„å…³ç³»ã€‚è¿™å¯¹ç†è§£ç±»å›¾å¾ˆæœ‰å¸®åŠ©ã€‚ä»–ä»¬åœ¨æž„é€ ä¸Šä¸Žç±»å›¾æ˜¾ç¤ºæ²¡æœ‰ä¸åŒï¼Œä½†æ˜¯åæ˜ å‡ºå¤šæ ·æ€§å’Œä½œç”¨ã€‚ ç±»å’Œå¯¹è±¡å…ƒç´  ä¸‹é¢çš„å›¾æ˜¾ç¤ºäº†ç±»å…ƒç´ å’Œå¯¹è±¡å…ƒç´ å¤–è§‚ä¸Šçš„ä¸åŒã€‚æ³¨æ„ï¼šç±»å…ƒç´ åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯åå­—æ ï¼Œå±žæ€§æ å’Œæ“ä½œæ ï¼›å¯¹è±¡å…ƒç´ é»˜è®¤ä¸ºæ²¡æœ‰åˆ†æ ã€‚åç§°æ˜¾ç¤ºä¹Ÿæœ‰ä¸åŒï¼šå¯¹è±¡åç§°æœ‰ä¸‹åˆ’çº¿ï¼Œå¹¶å¯èƒ½æ˜¾ç¤ºè¯¥å¯¹è±¡å®žä¾‹åŒ–æ‰€ç”¨ç±»å…ƒçš„åç§°ã€‚ è¿è¡ŒçŠ¶æ€ ç±»å…ƒå…ƒç´ å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„å±žæ€§å’Œæ“ä½œã€‚åœ¨å¯¹è±¡å®žä¾‹ä¸­ä¸ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ã€‚ä½†å¯èƒ½å®šä¹‰å¯¹è±¡çš„è¿è¡ŒçŠ¶æ€ï¼Œæ˜¾ç¤ºç‰¹æ®Šå®žä¾‹çš„å±žæ€§è®¾ç½®å€¼ã€‚ ç±»å’Œå¯¹è±¡å›¾ç¤ºä¾‹ ä¸‹å›¾æ˜¯ä¸€ä¸ªå¯¹è±¡å›¾ï¼Œå…¶ä¸­æ’å…¥äº†ç±»å®šä¹‰å›¾ã€‚å®ƒä¾‹ç¤ºå¦‚ä½•ç”¨å¯¹è±¡å›¾æ¥æµ‹è¯•ç±»å›¾ä¸­ä»»åŠ¡å¤šé‡æ€§çš„æ–¹æ³•ã€‚â€œcarâ€ ç±»å¯¹ â€œwheelâ€ ç±»æœ‰â€œ1 å¯¹å¤šâ€ çš„å¤šé‡æ€§ï¼Œä½†æ˜¯å¦‚æžœå·²ç»é€‰æ‹©ç”¨â€œ1 å¯¹ 4â€ æ¥æ›¿ä»£ï¼Œé‚£æ ·å°±ä¸ä¼šåœ¨å¯¹è±¡å›¾æ˜¾ç¤ºâ€œ3 ä¸ªè½®å­â€çš„æ±½è½¦ã€‚ æ´»åŠ¨å›¾ UML ä¸­ï¼Œæ´»åŠ¨å›¾ç”¨æ¥å±•ç¤ºæ´»åŠ¨çš„é¡ºåºã€‚æ˜¾ç¤ºäº†ä»Žèµ·å§‹ç‚¹åˆ°ç»ˆç‚¹çš„å·¥ä½œæµï¼Œæè¿°äº†æ´»åŠ¨å›¾ä¸­å­˜åœ¨äºŽäº‹ä»¶è¿›ç¨‹çš„åˆ¤æ–­è·¯å¾„ã€‚æ´»åŠ¨å›¾å¯ä»¥ç”¨æ¥è¯¦ç»†é˜è¿°æŸäº›æ´»åŠ¨æ‰§è¡Œä¸­å‘ç”Ÿå¹¶è¡Œå¤„ç†çš„æƒ…å†µã€‚æ´»åŠ¨å›¾å¯¹ä¸šåŠ¡å»ºæ¨¡ä¹Ÿæ¯”è¾ƒæœ‰ç”¨ï¼Œç”¨æ¥è¯¦ç»†æè¿°å‘ç”Ÿåœ¨ä¸šåŠ¡æ´»åŠ¨ä¸­çš„è¿‡ç¨‹ã€‚ ä¸€ä¸ªæ´»åŠ¨å›¾çš„ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºã€‚ ä¸‹é¢æè¿°ç»„æˆæ´»åŠ¨å›¾çš„å…ƒç´ ã€‚ æ´»åŠ¨ æ´»åŠ¨æ˜¯è¡Œä¸ºå‚æ•°åŒ–é¡ºåºçš„è§„èŒƒã€‚æ´»åŠ¨è¢«è¡¨ç¤ºä¸ºåœ†è§’çŸ©å½¢ï¼Œå†…å«å…¨éƒ¨çš„åŠ¨ä½œï¼Œå·¥ä½œæµå’Œå…¶ä»–ç»„æˆæ´»åŠ¨çš„å…ƒç´ ã€‚ åŠ¨ä½œ ä¸€ä¸ªåŠ¨ä½œä»£è¡¨æ´»åŠ¨ä¸­çš„ä¸€ä¸ªæ­¥éª¤ã€‚åŠ¨ä½œç”¨åœ†è§’çŸ©å½¢è¡¨ç¤ºã€‚ åŠ¨ä½œçº¦æŸ åŠ¨ä½œå¯ä»¥é™„å¸¦çº¦æŸï¼Œä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªå¸¦å‰ç½®æ¡ä»¶å’ŒåŽç½®æ¡ä»¶çš„åŠ¨ä½œã€‚ æŽ§åˆ¶æµ æŽ§åˆ¶æµæ˜¾ç¤ºä¸€ä¸ªåŠ¨ä½œåˆ°ä¸‹ä¸€ä¸ªåŠ¨ä½œçš„æµã€‚è¡¨ç¤ºä¸ºå¸¦ç®­å¤´å®žçº¿ åˆå§‹èŠ‚ç‚¹ ä¸€ä¸ªå¼€å§‹æˆ–èµ·å§‹ç‚¹ç”¨å¤§é»‘åœ†ç‚¹è¡¨ç¤ºï¼Œå¦‚ä¸‹å›¾ã€‚ ç»“æŸèŠ‚ç‚¹ ç»“æŸèŠ‚ç‚¹æœ‰ä¸¤ç§ç±»åž‹ï¼šæ´»åŠ¨ç»“æŸèŠ‚ç‚¹å’Œæµç»“æŸèŠ‚ç‚¹ã€‚æ´»åŠ¨ç»“æŸèŠ‚ç‚¹è¡¨ç¤ºä¸ºä¸­å¿ƒå¸¦é»‘ç‚¹çš„åœ†çŽ¯ã€‚ æµç»“æŸèŠ‚ç‚¹è¡¨ç¤ºä¸ºå†…éƒ¨ä¸ºå‰å·çš„åœ†çŽ¯ã€‚ è¿™ä¸¤ç§ä¸åŒç±»åž‹èŠ‚ç‚¹çš„åŒºåˆ«ä¸ºï¼šæµç»“æŸèŠ‚ç‚¹è¡¨æ˜Žå•ç‹¬çš„æŽ§åˆ¶æµçš„ç»ˆç‚¹ã€‚æ´»åŠ¨ç»“æŸç»ˆç‚¹æ˜¯æ´»åŠ¨å›¾å†…æ‰€æœ‰æŽ§åˆ¶æµçš„ç»“æŸã€‚ å¯¹è±¡å’Œå¯¹è±¡æµ å¯¹è±¡æµæ˜¯å¯¹è±¡å’Œæ•°æ®è½¬é€’çš„é€šé“ã€‚å¯¹è±¡æ˜¾ç¤ºä¸ºçŸ©å½¢ã€‚ å¯¹è±¡æµæ˜¾ç¤ºä¸ºå¸¦ç®­å¤´çš„è¿žæŽ¥å™¨ï¼Œè¡¨æ˜Žæ–¹å‘å’Œé€šè¿‡çš„å¯¹è±¡ã€‚ ä¸€ä¸ªå¯¹è±¡æµåœ¨å®ƒçš„è‡³å°‘ä¸€ä¸ªç»ˆç«¯æœ‰ä¸€ä¸ªå¯¹è±¡ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œå¯ä»¥é‡‡ç”¨å¸¦è¾“å…¥è¾“å‡ºå¼•è„šçš„é€Ÿè®°æ ‡æŸ±è¡¨ç¤ºã€‚ æ•°æ®å­˜å‚¨æ˜¾ç¤ºä¸ºå¸¦ Â«datastoreÂ» å…³é”®å­—çš„å¯¹è±¡ã€‚ åˆ¤æ–­èŠ‚ç‚¹å’Œåˆå¹¶èŠ‚ç‚¹ åˆ¤æ–­èŠ‚ç‚¹å’Œåˆå¹¶èŠ‚ç‚¹æ˜¯ç›¸åŒæ ‡æ³¨ï¼šè±å½¢ã€‚å®ƒä»¬å¯ä»¥è¢«å‘½åã€‚ä»Žåˆ¤æ–­èŠ‚ç‚¹å‡ºæ¥çš„æŽ§åˆ¶æµæœ‰ç›‘æŠ¤æ¡ä»¶ï¼Œå½“ç›‘æŠ¤æ¡ä»¶æ»¡è¶³æ—¶ï¼Œå¯ä»¥å¯¹æµæŽ§åˆ¶ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†åˆ¤æ–­èŠ‚ç‚¹å’Œåˆå¹¶èŠ‚ç‚¹çš„ä½¿ç”¨ã€‚ åˆ†å‰å’Œç»“åˆèŠ‚ç‚¹ åˆ†å‰å’Œç»“åˆèŠ‚ç‚¹æœ‰åŒæ ·çš„æ ‡æŸ±ï¼šåž‚ç›´æˆ–æ°´å¹³æ¡ï¼ˆæ–¹å‘å–å†³äºŽå·¥ä½œæµä»Žå·¦åˆ°å³ï¼Œè¿˜æ˜¯ä»Žä¸Šåˆ°ä¸‹ï¼‰ã€‚å®ƒä»¬è¯´æ˜Žäº†æŽ§åˆ¶çš„å¹¶å‘çº¿ç¨‹çš„èµ·å§‹å’Œç»ˆç‚¹ï¼Œä¸‹å›¾æ˜¾ç¤ºä»–ä»¬çš„ä½¿ç”¨ç¤ºä¾‹ã€‚ ç»“åˆèŠ‚ç‚¹ä¸Žåˆå¹¶èŠ‚ç‚¹ä¸åŒä¹‹å¤„åœ¨äºŽï¼šç»“åˆèŠ‚ç‚¹åŒæ­¥ä¸¤ä¸ªè¾“å…¥é‡ï¼Œäº§ç”Ÿä¸€ä¸ªå•ç‹¬çš„è¾“å‡ºé‡ã€‚æ¥è‡ªç»“åˆèŠ‚ç‚¹çš„è¾“å‡ºé‡è¦æŽ¥æ”¶åˆ°æ‰€æœ‰çš„è¾“å…¥é‡åŽæ‰èƒ½æ‰§è¡Œã€‚åˆå¹¶èŠ‚ç‚¹ç›´æŽ¥å°†æŽ§åˆ¶æµä¼ é€’é€šè¿‡ã€‚å¦‚æžœä¸¤ä¸ªæˆ–æ›´å¤šçš„è¾“å…¥é‡åˆ°è¾¾åˆå¹¶èŠ‚ç‚¹ã€‚åˆ™å®ƒçš„è¾“å‡ºæµæŒ‡å®šçš„åŠ¨ä½œä¼šè¢«æ‰§è¡Œä¸¤æ¬¡æˆ–æ›´å¤šæ¬¡ã€‚ æ‰©å±•åŸŸ æ‰©å±•åŸŸæ˜¯ä¼šæ‰§è¡Œå¤šæ¬¡çš„ç»“æž„æ´»åŠ¨åŸŸã€‚è¾“å…¥è¾“å‡ºæ‰©å±•èŠ‚ç‚¹è¡¨ç¤ºä¸ºä¸€ç»„â€œ3 åŽ¢â€ ï¼Œä»£è¡¨å¤šä¸ªé€‰æ‹©é¡¹ã€‚å…³é”®è¯ â€œiterativeâ€ï¼Œ â€œparallelâ€ æˆ– &quot;stream&quot;æ˜¾ç¤ºåœ¨åŒºåŸŸçš„å·¦ä¸Šè§’ å¼‚å¸¸å¤„ç†å™¨ å¼‚å¸¸å¤„ç†å™¨åœ¨æ´»åŠ¨å›¾ä¸­å¯ä»¥å»ºæ¨¡ã€‚ å¯ä¸­æ–­æ´»åŠ¨åŒº å¯ä¸­æ–­æ´»åŠ¨åŒºçŽ¯ç»•ä¸€ç»„å¯ä»¥ä¸­æ–­çš„åŠ¨ä½œã€‚åœ¨ä¸‹é¢éžå¸¸ç®€å•çš„ä¾‹å­ä¸­ï¼š å½“æŽ§åˆ¶è¢«ä¼ é€’åˆ°ç»“æŸè®¢å• â€œClose Orderâ€ åŠ¨ä½œï¼Œå®šå•å¤„ç†&quot;Process Order&quot; åŠ¨ä½œä¼šæ‰§è¡Œç›´åˆ°å®Œæˆï¼Œé™¤éž&quot;Cancel Request&quot;å–æ¶ˆè¯·æ±‚ä¸­æ–­è¢«æŽ¥å—ï¼Œè¿™ä¼šå°†æŽ§åˆ¶ä¼ é€’ç»™&quot;Cancel Order&quot;åŠ¨ä½œã€‚ åˆ†å‰² ä¸€ä¸ªæ´»åŠ¨åˆ†å‰²æ˜¾ç¤ºä¸ºåž‚ç›´æˆ–æ°´å¹³æ³³é“ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œåˆ†å‰²è¢«ç”¨æ¥åœ¨æ´»åŠ¨å›¾ä¸­åˆ†éš”åŠ¨ä½œï¼Œæœ‰åœ¨ &quot;accounting department&quot;ä¸­æ‰§è¡Œçš„ï¼Œæœ‰åœ¨ &quot;customer&quot;ä¸­æ‰§è¡Œçš„ã€‚ çŠ¶æ€æœºå›¾ çŠ¶æ€æœºå›¾ï¼ˆstate-machine-diagramï¼‰å¯¹ä¸€ä¸ªå•ç‹¬å¯¹è±¡çš„è¡Œä¸ºå»ºæ¨¡ï¼ŒæŒ‡æ˜Žå¯¹è±¡åœ¨å®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸé‡Œï¼Œå“åº”ä¸åŒäº‹ä»¶æ—¶ï¼Œæ‰§è¡Œç›¸å…³äº‹ä»¶çš„é¡ºåºã€‚ å¦‚ä¸‹ç¤ºä¾‹ï¼Œ ä¸‹åˆ—çš„çŠ¶æ€æœºå›¾æ˜¾ç¤ºäº†é—¨åœ¨å®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸé‡Œå¦‚ä½•è¿ä½œã€‚ é—¨å¯ä»¥å¤„äºŽä»¥ä¸‹çš„ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š &quot;Opened&quot;æ‰“å¼€çŠ¶æ€ï¼Œ &quot;Closed&quot;å…³é—­çŠ¶æ€ï¼Œæˆ–è€…&quot;Locked&quot;é”å®šçŠ¶æ€ã€‚ å®ƒåˆ†åˆ«å“åº”äº‹ä»¶ï¼šâ€œOpenâ€å¼€é—¨ï¼Œ â€œCloseâ€å…³é—¨ï¼Œ â€œLockâ€é”é—¨ å’Œ â€œUnlockâ€è§£é”ã€‚ æ³¨æ„ï¼šä¸æ˜¯æ‰€æœ‰çš„äº‹ä»¶ï¼Œåœ¨æ‰€æœ‰çš„çŠ¶æ€ä¸‹éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚å¦‚ï¼šä¸€ä¸ªé—¨æ‰“å¼€çš„æ—¶å€™æ˜¯ä¸å¯èƒ½é”å®šçš„ï¼Œé™¤éžä½ å…³ä¸Šé—¨ã€‚å¹¶ä¸”ï¼ŒçŠ¶æ€è½¬ç§»å¯èƒ½æœ‰é™„åŠ ç›‘æŠ¤æ¡ä»¶ï¼šå‡è®¾é—¨æ˜¯å¼€çš„ï¼Œå¦‚æžœâ€œdoorWay-&gt;isEmptyâ€ï¼ˆé—¨æ˜¯ç©ºçš„ï¼‰è¢«æ»¡è¶³ï¼Œé‚£ä¹ˆå®ƒåªèƒ½å“åº”å…³é—¨äº‹ä»¶ã€‚çŠ¶æ€æœºå›¾ä½¿ç”¨çš„è¯­æ³•å’Œçº¦å®šå°†åœ¨ä¸‹é¢çš„éƒ¨åˆ†è¿›è¡Œè®¨è®ºã€‚ çŠ¶æ€ çŠ¶æ€è¢«è¡¨ç¤ºä¸ºåœ†è§’çŸ©å½¢ï¼ŒçŠ¶æ€åå†™åœ¨é‡Œé¢ã€‚ èµ·å§‹å’Œç»“æŸçŠ¶æ€ åˆå§‹çŠ¶æ€è¡¨ç¤ºä¸ºå®žå¿ƒé»‘åœ†çŽ¯ï¼Œå¯ä»¥æ ‡æ³¨åç§°ã€‚ç»“æŸçŠ¶æ€è¡¨ç¤ºä¸ºä¸­å¿ƒå¸¦é»‘ç‚¹åœ†çŽ¯ï¼Œä¹Ÿå¯ä»¥è¢«æ ‡æ³¨åç§°ã€‚ è½¬ç§» ä¸€ä¸ªçŠ¶æ€åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€çš„è½¬ç§»è¡¨ç¤ºä¸ºå¸¦ç®­å¤´å®žçº¿ã€‚è½¬ç§»å¯ä»¥æœ‰ä¸€ä¸ªâ€œTriggerâ€è§¦å‘å™¨ï¼Œä¸€ä¸ªâ€œGuardâ€ç›‘æŠ¤æ¡ä»¶å’Œä¸€ä¸ªâ€œeffectâ€æ•ˆæžœã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š &quot;Trigger&quot;è§¦å‘å™¨æ˜¯è½¬ç§»çš„èµ·å› ï¼Œå®ƒå¯ä»¥æ˜¯æŸä¸ªæ¡ä»¶ä¸‹çš„ä¸€ä¸ªä¿¡å·ï¼Œä¸€ä¸ªäº‹ä»¶ï¼Œä¸€ä¸ªå˜åŒ–æˆ–ä¸€ä¸ªæ—¶é—´é€šè·¯ã€‚&quot;Guard&quot;ç›‘æŠ¤æ˜¯ä¸€ä¸ªæ¡ä»¶ï¼Œè€Œä¸”å¿…é¡»ä¸ºçœŸï¼Œä»¥ä¾¿äºŽè®©è§¦å‘å™¨å¼•èµ·è½¬ç§»ã€‚æ•ˆæžœ&quot;Effect&quot;æ˜¯ç›´æŽ¥ä½œç”¨åˆ°å¯¹è±¡ä¸Šçš„ä¸€ä¸ªåŠ¨ä½œï¼Œè¯¥å¯¹è±¡å…·æœ‰åšä¸ºè½¬ç§»ç»“æžœçš„çŠ¶æ€æœºã€‚ çŠ¶æ€æ´»åŠ¨ åœ¨ä¸Šé¢çš„çŠ¶æ€è½¬ç§»ç¤ºä¾‹ä¸­ï¼Œä¸€ä¸ªæ•ˆæžœä¸Žè¯¥è½¬ç§»ç›¸å…³è”ã€‚å¦‚æžœç›®æ ‡çŠ¶æ€æœ‰å¤šä¸ªè½¬ç§»åˆ°è¾¾ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªè½¬ç§»éƒ½æœ‰ç›¸åŒçš„æ•ˆæžœä¸Žå®ƒç›¸å…³è”ï¼Œé‚£æœ€å¥½å°†è¯¥æ•ˆæžœä¸Žç›®æ ‡çŠ¶æ€ç›¸å…³è”ï¼Œè€Œä¸ä¸Žè½¬ç§»ç›¸å…³è”ã€‚ä½ å¯ä»¥é€šè¿‡ä¸ºè¿™ä¸ªçŠ¶æ€å®šä¹‰åˆå§‹åŠ¨ä½œæ¥å®žçŽ°ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªå¸¦å…¥å£åŠ¨ä½œå’Œå‡ºå£åŠ¨ä½œçš„çŠ¶æ€ã€‚ å¯ä»¥å®šä¹‰å‘ç”Ÿåœ¨äº‹ä»¶ä¸Šçš„åŠ¨ä½œæˆ–ä¸€ç›´å‘ç”Ÿçš„åŠ¨ä½œã€‚æ¯ä¸€ç§ç±»åž‹çš„åŠ¨ä½œæ˜¯å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„ã€‚ è‡ªè½¬ç§» ä¸€ä¸ªçŠ¶æ€å¯èƒ½æœ‰ä¸€ä¸ªè¿”å›žåˆ°è‡ªèº«çš„è½¬ç§»ï¼Œå¦‚ä¸‹å›¾ã€‚æ•ˆæžœä¸Žè½¬ç§»å…³è”æ˜¯ååˆ†æœ‰å¸®åŠ©ã€‚ å¤åˆçŠ¶æ€ ä¸€ä¸ªçŠ¶æ€æœºå›¾å¯ä»¥æœ‰å­çŠ¶æ€æœºå›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¯é€‰æ‹©ä¸åŒæ–¹å¼æ˜¾ç¤ºç›¸åŒä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸Šé¢ç‰ˆæœ¬çš„æ ‡æ³¨è¯´æ˜Ž&quot;Check PIN&quot;çš„å­çŠ¶æ€æœºå›¾æ˜¾ç¤ºåœ¨å•ç‹¬çš„å›¾ä¸­ã€‚ å…¥å£ç‚¹ æœ‰æ—¶ï¼Œä½ ä¸æƒ³åœ¨æ­£å¸¸çš„åˆå§‹çŠ¶æ€è¿›å…¥å­çŠ¶æ€æœºã€‚ä¾‹å¦‚ä¸‹é¢çš„å­çŠ¶æ€æœºï¼Œå®ƒé€šå¸¸ä»Ž&quot;åˆå§‹åŒ–&quot;çŠ¶æ€å¼€å§‹ï¼Œä½†æ˜¯å¦‚æžœå› ä¸ºæŸäº›åŽŸå› ï¼Œå®ƒä¸å¿…æ‰§è¡Œåˆå§‹åŒ–ï¼Œå¯èƒ½é è½¬ç§»åˆ°æŒ‡å®šçš„å…¥å£ç‚¹æ¥ä»Ž â€œReadyâ€ çŠ¶æ€å¼€å§‹ã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†çŠ¶æ€æœºçš„ä¸Šä¸€å±‚ã€‚ å‡ºå£ç‚¹ æœ‰ä¸Žå…¥å£ç‚¹ç›¸ç±»ä¼¼çš„æ–¹å¼ï¼Œå®ƒå¯èƒ½ä¹ŸæŒ‡å®šå¯é€‰æ‹©çš„å‡ºå£ç‚¹ã€‚ä¸‹å›¾ç»™å‡ºäº†ä¸»å¤„ç†çŠ¶æ€æ‰§è¡ŒåŽï¼Œæ‰€æ‰§è¡ŒçŠ¶æ€çš„åŽ»å‘å°†å–å†³äºŽè¯¥çŠ¶æ€è½¬ç§»æ—¶æ‰€ä½¿ç”¨çš„è·¯å¾„ã€‚ é€‰æ‹©ä¼ªçŠ¶æ€ é€‰æ‹©ä¼ªçŠ¶æ€æ˜¾ç¤ºä¸ºè±å½¢ï¼Œæœ‰ä¸€ä¸ªè½¬ç§»è¾“å…¥ï¼Œä¸¤ä¸ªæˆ–å¤šä¸ªè¾“å‡ºã€‚ä¸‹å›¾æ˜¾ç¤ºä¸ç®¡åˆ°è¾¾å“ªä¸€ä¸ªçŠ¶æ€ï¼Œç»è¿‡é€‰æ‹©ä¼ªçŠ¶æ€åŽçš„åŽ»å‘ï¼Œå–å†³äºŽåœ¨ä¼ªçŠ¶æ€ä¸­æ‰§è¡Œæ—¶æ‰€é€‰æ‹©çš„æ¶ˆæ¯æ ¼å¼ã€‚ è¿žæŽ¥ä¼ªçŠ¶æ€ è¿žæŽ¥ä¼ªçŠ¶æ€ç”¨æ¥å°†å¤šä¸ªçŠ¶æ€è½¬ç§»é“¾æŽ¥åœ¨ä¸€èµ·ã€‚ä¸€ä¸ªå•ç‹¬çš„è¿žæŽ¥ä¼ªçŠ¶æ€å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥å’Œä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºï¼Œç›‘æŠ¤å¯èƒ½åº”ç”¨äºŽæ¯ä¸€ä¸ªè½¬ç§»ï¼Œè¿žæŽ¥æ˜¯æ²¡æœ‰è¯­ä¹‰çš„ã€‚è¿žæŽ¥å¯ä»¥æŠŠä¸€ä¸ªè¾“å…¥è½¬ç§»åˆ†æˆå¤šä¸ªè¾“å‡ºè½¬ç§»æ¥å®žçŽ°ä¸€ä¸ªé™æ€åˆ†æ”¯ã€‚ä¸Žä¹‹å¯¹ç…§çš„æ˜¯é€‰æ‹©ä¼ªçŠ¶æ€å®žçŽ°ä¸€ä¸ªåŠ¨æ€æ¡ä»¶åˆ†æ”¯ã€‚ ç»ˆæ­¢ä¼ªçŠ¶æ€ è¿›å…¥ç»ˆæ­¢ä¼ªçŠ¶æ€æ˜¯æŒ‡çŠ¶æ€æœºç”Ÿå‘½çº¿å·²ç»ç»ˆæ­¢ã€‚ç»ˆæ­¢ä¼ªçŠ¶æ€è¡¨ç¤ºä¸ºå‰å·ã€‚ åŽ†å²çŠ¶æ€ åŽ†å²çŠ¶æ€ç”¨æ¥å½“çŠ¶æ€æœºä¸­æ–­æ—¶ï¼Œæ¢å¤çŠ¶æ€æœºä¹‹å‰çŠ¶æ€ã€‚ä¸‹é¢ä¾‹å›¾è¯´æ˜Žäº†åŽ†å²çŠ¶æ€çš„ä½¿ç”¨ã€‚è¿™ä¸ªä¾‹å­æ˜¯å…³äºŽæ´—è¡£æœºçš„çŠ¶æ€æœºã€‚ åœ¨è¿™ä¸ªçŠ¶æ€æœºä¸­ï¼Œå½“æ´—è¡£æœºè¿è¡Œæ—¶ï¼Œå®ƒä¼šæŒ‰ç…§&quot;Washing&quot; åˆ° Rinsing&quot;å†åˆ°&quot;Spinning&quot;æ¥è¿›è¡Œã€‚å¦‚æžœç”µæºè¢«åˆ‡æ–­ ï¼Œæ´—è¡£æœºä¼šåœæ­¢è¿è¡Œå¹¶è¿›å…¥&quot;Power Off&quot; çŠ¶æ€ã€‚å½“ç”µæºæ¢å¤ï¼Œè¿è¡ŒçŠ¶æ€åœ¨&quot;History State&quot;ç¬¦å·å¤„è¿›å…¥ï¼Œè¡¨ç¤ºå®ƒä¼šä»Žä¸Šæ¬¡ç¦»å¼€çš„åœ°æ–¹æ¢å¤ã€‚ å¹¶å‘åŒº ä¸€ä¸ªçŠ¶æ€å¯ä»¥è¢«åˆ†æˆå‡ ä¸ªä¸åŒçš„åŒºï¼ŒåŒ…å«åŒæ—¶å­˜åœ¨å’Œæ‰§è¡Œçš„å­çŠ¶æ€ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºçŠ¶æ€ â€œApplying Brakesâ€ï¼Œ â€œfront brake&quot;å’Œ&quot;rear brakesâ€ å°†åŒæ—¶ç‹¬ç«‹è¿ä½œã€‚æ³¨æ„ä½¿ç”¨äº†åˆ†å‰å’Œç»“åˆä¼ªçŠ¶æ€è€Œä¸æ˜¯é€‰æ‹©å’Œåˆå¹¶ä¼ªçŠ¶æ€ã€‚è¿™äº›ç¬¦å·ç”¨æ¥åŒæ­¥å¹¶å‘çš„çº¿ç¨‹ã€‚ ç”¨ä¾‹å›¾ ç”¨ä¾‹å›¾ç”¨æ¥è®°å½•ç³»ç»Ÿçš„éœ€æ±‚ï¼Œå®ƒæä¾›ç³»ç»Ÿä¸Žç”¨æˆ·åŠå…¶ä»–å‚ä¸Žè€…çš„ä¸€ç§é€šä¿¡æ‰‹æ®µã€‚ æ‰§è¡Œè€… ç”¨ä¾‹å›¾æ˜¾ç¤ºäº†ç³»ç»Ÿå’Œç³»ç»Ÿå¤–å®žä½“ä¹‹é—´çš„äº¤äº’ã€‚è¿™äº›å®žä½“è¢«å¼•ç”¨ä¸ºæ‰§è¡Œè€…ã€‚æ‰§è¡Œè€…ä»£è¡¨è§’è‰²ï¼Œå¯ä»¥åŒ…æ‹¬ï¼šç”¨æˆ·ï¼Œå¤–éƒ¨ç¡¬ä»¶å’Œå…¶ä»–ç³»ç»Ÿã€‚æ‰§è¡Œè€…å¾€å¾€è¢«ç”»æˆç®€ç¬”ç”»å°äººã€‚ä¹Ÿå¯ä»¥ç”¨å¸¦Â«actorÂ»å…³é”®å­—çš„ç±»çŸ©å½¢è¡¨ç¤ºã€‚ åœ¨ä¸‹å›¾ä¸­ï¼Œæ‰§è¡Œè€…å¯ä»¥è¯¦ç»†çš„æ³›åŒ–å…¶ä»–æ‰§è¡Œè€…: ç”¨ä¾‹ ç”¨ä¾‹æ˜¯æœ‰æ„ä¹‰çš„å•ç‹¬å·¥ä½œå•å…ƒã€‚å®ƒå‘ç³»ç»Ÿå¤–éƒ¨çš„äººæˆ–äº‹æä¾›ä¸€ä¸ªæ˜“äºŽè§‚å¯Ÿçš„é«˜å±‚æ¬¡è¡Œä¸ºè§†å›¾ã€‚ ç”¨ä¾‹çš„æ ‡æ³¨ç¬¦å·æ˜¯ä¸€ä¸ªæ¤­åœ†ã€‚ ä½¿ç”¨ç”¨ä¾‹çš„ç¬¦å·æ˜¯å¸¦å¯é€‰æ‹©ç®­å¤´çš„è¿žæŽ¥çº¿ï¼Œç®­å¤´æ˜¾ç¤ºæŽ§åˆ¶çš„æ–¹å‘ã€‚ä¸‹å›¾è¯´æ˜Žæ‰§è¡Œè€… &quot;Customer&quot;ä½¿ç”¨ &quot;Withdraw&quot;ç”¨ä¾‹ã€‚ ç”¨é€”è¿žæŽ¥å™¨ï¼ˆuses connectorï¼‰å¯ä»¥æœ‰é€‰æ‹©æ€§çš„åœ¨æ¯ä¸€ä¸ªç«¯ç‚¹æœ‰å¤šé‡æ€§å€¼ï¼Œå¦‚ä¸‹å›¾ï¼Œæ˜¾ç¤ºå®¢æˆ·ä¸€æ¬¡å¯èƒ½åªæ‰§è¡Œä¸€æ¬¡å–æ¬¾äº¤æ˜“ã€‚ä½†æ˜¯é“¶è¡Œå¯ä»¥åŒæ—¶æ‰§è¡Œè®¸å¤šå–æ¬¾äº¤æ˜“ã€‚ ç”¨ä¾‹å®šä¹‰ ä¸€ä¸ªå…¸åž‹çš„ç”¨ä¾‹åŒ…æ‹¬: åç§°å’Œæè¿° - ç”¨ä¾‹é€šå¸¸ç”¨ä¸€ä¸ªåŠ¨è¯è¯ç»„å®šä¹‰ï¼Œè€Œä¸”æœ‰ä¸€ä¸ªç®€çŸ­çš„æ–‡å­—è¯´æ˜Žã€‚ éœ€æ±‚ - éœ€æ±‚å®šä¹‰äº†ä¸€ä¸ªç”¨ä¾‹å¿…é¡»æä¾›ç»™ç»ˆç«¯ç”¨æˆ·çš„æ­£å¼åŠŸèƒ½æ€§éœ€æ±‚ã€‚å®ƒä»¬ç¬¦åˆæž„é€ æ–¹æ³•å»ºç«‹çš„åŠŸèƒ½æ€§è§„èŒƒã€‚ä¸€ä¸ªéœ€æ±‚æ˜¯ç”¨ä¾‹å°†æ‰§è¡Œä¸€ä¸ªåŠ¨ä½œæˆ–æä¾›å¤šä¸ªå€¼ç»™ç³»ç»Ÿçš„çº¦å®šæˆ–æ‰¿è¯ºã€‚ çº¦æŸ - ä¸€ä¸ªçº¦æŸæ˜¯ä¸€ä¸ªç”¨ä¾‹è¿è¡Œçš„æ¡ä»¶æˆ–é™åˆ¶ã€‚å®ƒåŒ…æ‹¬ï¼šå‰ç½®æ¡ä»¶ï¼ŒåŽç½®æ¡ä»¶å’Œä¸å˜åŒ–æ¡ä»¶ ã€‚å‰ç½®æ¡ä»¶æŒ‡æ˜Žäº†ç”¨ä¾‹åœ¨å‘ç”Ÿä¹‹å‰éœ€è¦ç¬¦åˆçš„æ¡ä»¶ã€‚åŽç½®æ¡ä»¶ç”¨æ¥è¯´æ˜Žåœ¨ç”¨ä¾‹æ‰§è¡Œä¹‹åŽä¸€äº›æ¡ä»¶å¿…é¡»ä¸º&quot;çœŸ&quot;ã€‚ä¸å˜åŒ–æ¡ä»¶è¯´æ˜Žç”¨ä¾‹æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­è¯¥æ¡ä»¶å§‹ç»ˆä¸º&quot;çœŸ&quot;ã€‚ æƒ…å½¢ - æƒ…å½¢æ˜¯ç”¨ä¾‹çš„å®žä¾‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œäº‹ä»¶å‘ç”Ÿæµç¨‹çš„å½¢å¼æè¿°ã€‚å®ƒå®šä¹‰äº†ç³»ç»Ÿå’Œå¤–éƒ¨æ‰§è¡Œè€…ä¹‹é—´çš„äº‹ä»¶æŒ‡å®šé¡ºåºã€‚é€šå¸¸ç”¨æ–‡æœ¬æ–¹å¼æ¥è¡¨ç¤ºï¼Œå¹¶å¯¹åº”æ—¶åºå›¾ä¸­çš„æ–‡å­—æè¿°ã€‚ æƒ…å½¢å›¾ é™„åŠ ä¿¡æ¯ åŒ…å«ç”¨ä¾‹ ç”¨ä¾‹å¯èƒ½åŒ…å«å…¶ä»–ç”¨ä¾‹çš„åŠŸèƒ½æ¥ä½œä¸ºå®ƒæ­£å¸¸å¤„ç†çš„ä¸€éƒ¨åˆ†ã€‚é€šå¸¸å®ƒå‡è®¾ï¼Œä»»ä½•è¢«åŒ…å«çš„ç”¨ä¾‹åœ¨åŸºæœ¬ç¨‹åºè¿è¡Œæ—¶æ¯ä¸€æ¬¡éƒ½ä¼šè¢«è°ƒç”¨ã€‚ä¸‹é¢ä¾‹å­ï¼šç”¨ä¾‹â€œå¡çš„ç¡®è®¤â€ åœ¨è¿è¡Œæ—¶ï¼Œè¢«ç”¨ä¾‹â€œå–é’±â€å½“ä½œä¸€ä¸ªå­éƒ¨åˆ†ã€‚ ç”¨ä¾‹å¯ä»¥è¢«ä¸€ä¸ªæˆ–å¤šä¸ªç”¨ä¾‹åŒ…å«ã€‚é€šè¿‡æç‚¼é€šç”¨çš„è¡Œä¸ºï¼Œå°†å®ƒå˜æˆå¯ä»¥å¤šæ¬¡é‡å¤ä½¿ç”¨çš„ç”¨ä¾‹ã€‚æœ‰åŠ©äºŽé™ä½ŽåŠŸèƒ½é‡å¤çº§åˆ«ã€‚ æ‰©å±•ç”¨ä¾‹ ä¸€ä¸ªç”¨ä¾‹å¯ä»¥è¢«ç”¨æ¥æ‰©å±•å¦ä¸€ä¸ªç”¨ä¾‹çš„è¡Œä¸ºï¼Œé€šå¸¸ä½¿ç”¨åœ¨ç‰¹åˆ«æƒ…å†µä¸‹ã€‚ä¾‹å¦‚ï¼šå‡è®¾åœ¨ä¿®æ”¹ä¸€ä¸ªç‰¹åˆ«ç±»åž‹çš„å®¢æˆ·è®¢å•ä¹‹å‰ï¼Œç”¨æˆ·å¿…é¡»å¾—åˆ°æŸç§æ›´é«˜çº§åˆ«çš„è®¸å¯ï¼Œç„¶åŽâ€œèŽ·å¾—è®¸å¯â€ç”¨ä¾‹å°†æœ‰é€‰æ‹©çš„æ‰©å±•å¸¸è§„çš„â€œä¿®æ”¹è®¢å•â€ç”¨ä¾‹ã€‚ æ‰©å±•ç‚¹ - æ‰©å±•ç”¨ä¾‹çš„åŠ å…¥ç‚¹è¢«å®šä¹‰ä¸ºæ‰©å±•ç‚¹ã€‚ ç³»ç»Ÿè¾¹ç•Œ - å®ƒç”¨æ¥æ˜¾ç¤ºç”¨ä¾‹åœ¨ç³»ç»Ÿå†…éƒ¨ï¼Œæ‰§è¡Œè€…åœ¨ç³»ç»Ÿçš„å¤–éƒ¨ã€‚ é€šä¿¡å›¾ é€šä¿¡å›¾ï¼Œä»¥å‰ç§°ä¹‹ä¸ºåä½œå›¾ï¼Œæ˜¯ä¸€ç§äº¤äº’å›¾ï¼Œæ‰€æ˜¾ç¤ºæ¶ˆæ¯ä¸Žæ—¶åºå›¾ç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒæ›´ä¾§é‡äºŽå¯¹è±¡é—´çš„è”ç³»ã€‚ åœ¨é€šä¿¡å›¾ä¸­ï¼Œå¯¹è±¡ä¹‹é—´æ˜¾ç¤ºå…³è”è¿žæŽ¥å™¨ã€‚æ¶ˆæ¯é™„åŠ åˆ°è¿™äº›å…³è”ä¸Šï¼Œæ˜¾ç¤ºçŸ­ç®­å¤´æŒ‡å‘æ¶ˆæ¯æµçš„æ–¹å‘ã€‚æ¶ˆæ¯çš„é¡ºåºé€šè¿‡ç¼–å·ç æ˜¾ç¤ºã€‚ ä¸‹é¢çš„ä¸¤ä¸ªå›¾ç”¨é€šä¿¡å›¾å’Œæ—¶åºå›¾åˆ†åˆ«æ˜¾ç¤ºç›¸åŒçš„ä¿¡æ¯ã€‚å°½ç®¡æˆ‘ä»¬å¯èƒ½ä»Žé€šä¿¡å›¾çš„ç¼–å·ç å¾—åˆ°æ¶ˆæ¯é¡ºåºï¼Œä½†å®ƒä¸æ˜¯ç«‹å³å¯è§çš„ã€‚é€šä¿¡å›¾ååˆ†æ¸…æ¥šçš„æ˜¾ç¤ºäº†é‚»è¿‘å¯¹è±¡é—´å…¨éƒ¨å®Œæ•´çš„æ¶ˆæ¯ä¼ é€’ã€‚ äº¤äº’æ¦‚è¿°å›¾ ä¸€ä¸ªäº¤äº’æ¦‚è§ˆå›¾æ˜¯æ´»åŠ¨å›¾çš„ä¸€ç§å½¢å¼ï¼Œå®ƒçš„èŠ‚ç‚¹ä»£è¡¨äº¤äº’å›¾ã€‚äº¤äº’å›¾åŒ…å«æ—¶åºå›¾ï¼Œé€šä¿¡å›¾ï¼Œäº¤äº’æ¦‚è§ˆå›¾å’Œæ—¶é—´å›¾ã€‚ å¤§å¤šæ•°äº¤äº’æ¦‚è§ˆå›¾æ ‡æ³¨ä¸Žæ´»åŠ¨å›¾ä¸€æ ·ã€‚ä¾‹å¦‚ï¼šèµ·å§‹ï¼Œç»“æŸï¼Œåˆ¤æ–­ï¼Œåˆå¹¶ï¼Œåˆ†å‰å’Œç»“åˆèŠ‚ç‚¹æ˜¯å®Œå…¨ç›¸åŒã€‚å¹¶ä¸”ï¼Œäº¤äº’æ¦‚è§ˆå›¾ä»‹ç»äº†ä¸¤ç§æ–°çš„å…ƒç´ ï¼šäº¤äº’å‘ç”Ÿå’Œäº¤äº’å…ƒç´ ã€‚ äº¤äº’å‘ç”Ÿ äº¤äº’å‘ç”Ÿå¼•ç”¨çŽ°æœ‰çš„äº¤äº’å›¾ã€‚æ˜¾ç¤ºä¸ºä¸€ä¸ªå¼•ç”¨æ¡†ï¼Œå·¦ä¸Šè§’æ˜¾ç¤º â€œrefâ€ ã€‚è¢«å¼•ç”¨çš„å›¾åæ˜¾ç¤ºåœ¨æ¡†çš„ä¸­å¤®ã€‚ äº¤äº’å…ƒç´  äº¤äº’å…ƒç´ ä¸Žäº¤äº’å‘ç”Ÿç›¸ä¼¼ä¹‹å¤„åœ¨äºŽéƒ½æ˜¯åœ¨ä¸€ä¸ªçŸ©å½¢æ¡†ä¸­æ˜¾ç¤ºä¸€ä¸ªçŽ°æœ‰çš„äº¤äº’å›¾ã€‚ä¸åŒä¹‹å¤„åœ¨å†…éƒ¨æ˜¾ç¤ºå‚è€ƒå›¾çš„å†…å®¹ä¸åŒã€‚ å°†å®ƒä»¬æ”¾åœ¨ä¸€èµ· æ‰€æœ‰çš„æ´»åŠ¨å›¾æŽ§ä»¶ï¼Œéƒ½å¯ä»¥ç›¸åŒåœ°è¢«ä½¿ç”¨äºŽäº¤äº’æ¦‚è§ˆå›¾ï¼Œå¦‚ï¼šåˆ†å‰ï¼Œç»“åˆï¼Œåˆå¹¶ç­‰ç­‰ã€‚å®ƒæŠŠæŽ§åˆ¶é€»è¾‘æ”¾å…¥è¾ƒä½Žä¸€çº§çš„å›¾ä¸­ã€‚ä¸‹é¢çš„ä¾‹å­å°±è¯´æ˜Žäº†ä¸€ä¸ªå…¸åž‹çš„é”€å”®è¿‡ç¨‹ã€‚å­è¿‡ç¨‹æ˜¯ä»Žäº¤äº’å‘ç”ŸæŠ½è±¡è€Œæ¥ã€‚ æ—¶åºå›¾ æ—¶åºå›¾æ˜¯äº¤äº’å›¾çš„ä¸€ç§å½¢å¼ï¼Œå®ƒæ˜¾ç¤ºå¯¹è±¡æ²¿ç”Ÿå‘½çº¿å‘å±•ï¼Œå¯¹è±¡ä¹‹é—´éšæ—¶é—´çš„äº¤äº’è¡¨ç¤ºä¸ºä»Žæºç”Ÿå‘½çº¿æŒ‡å‘ç›®æ ‡ç”Ÿå‘½çº¿çš„æ¶ˆæ¯ã€‚æ—¶åºå›¾èƒ½å¾ˆå¥½åœ°æ˜¾ç¤ºé‚£äº›å¯¹è±¡ä¸Žå…¶å®ƒé‚£äº›å¯¹è±¡é€šä¿¡ï¼Œä»€ä¹ˆæ¶ˆæ¯è§¦å‘äº†è¿™äº›é€šä¿¡ï¼Œæ—¶åºå›¾ä¸èƒ½å¾ˆå¥½æ˜¾ç¤ºå¤æ‚è¿‡ç¨‹çš„é€»è¾‘ã€‚ ç”Ÿå‘½çº¿ ä¸€æ¡ç”Ÿå‘½çº¿åœ¨æ—¶åºå›¾ä¸­ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„å‚ä¸Žè€…ã€‚è¡¨ç¤ºä¸ºåŒ…å«å¯¹è±¡åçš„çŸ©å½¢ï¼Œå¦‚æžœå®ƒçš„åå­—æ˜¯&quot;self&quot;ï¼Œåˆ™è¯´æ˜Žè¯¥ç”Ÿå‘½çº¿ä»£è¡¨æŽ§åˆ¶å¸¦æ—¶åºå›¾çš„ç±»å…ƒã€‚ æœ‰æ—¶ï¼Œæ—¶åºå›¾ä¼šåŒ…å«ä¸€ä¸ªé¡¶ç«¯æ˜¯æ‰§è¡Œè€…çš„ç”Ÿå‘½çº¿ã€‚è¿™æƒ…å†µè¯´æ˜ŽæŽŒæ¡è¿™ä¸ªæ—¶åºå›¾çš„æ˜¯ç”¨ä¾‹ã€‚å¥å£®å›¾ä¸­çš„è¾¹ç•Œï¼ŒæŽ§åˆ¶å’Œå®žä½“å…ƒç´ ä¹Ÿå¯ä»¥æœ‰ç”Ÿå‘½çº¿ã€‚ æ¶ˆæ¯ æ¶ˆæ¯æ˜¾ç¤ºä¸ºç®­å¤´ã€‚æ¶ˆæ¯å¯ä»¥å®Œæˆä¼ è¾“ï¼Œä¹Ÿå¯èƒ½ä¸¢å¤±å’Œæ‰¾å›žï¼Œå®ƒå¯ä»¥æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œå³å¯ä»¥æ˜¯è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¿¡å·ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œç¬¬ä¸€æ¡æ¶ˆæ¯æ˜¯åŒæ­¥æ¶ˆæ¯(æ ‡ä¸ºå®žç®­å¤´)å®Œæˆä¼ è¾“ï¼Œå¹¶éšå«ä¸€æ¡è¿”å›žæ¶ˆæ¯ã€‚ç¬¬äºŒæ¡æ¶ˆæ¯æ˜¯å¼‚æ­¥æ¶ˆæ¯ (æ ‡ä¸ºå®žçº¿ç®­å¤´)ï¼Œç¬¬ä¸‰æ¡æ˜¯å¼‚æ­¥è¿”å›žæ¶ˆæ¯(æ ‡ä¸ºè™šçº¿)ã€‚ æ‰§è¡Œå‘ç”Ÿ å‘ä¸‹å»¶ä¼¸çš„ç»†æ¡çŠ¶çŸ©å½¢è¡¨ç¤ºæ‰§è¡Œäº‹ä»¶æˆ–æŽ§åˆ¶ç„¦ç‚¹çš„æ¿€æ´»ã€‚åœ¨ä¸Šå›¾ä¸­æœ‰ä¸‰ä¸ªæ‰§è¡Œäº‹ä»¶ã€‚ç¬¬ä¸€ä¸ªæ˜¯æºå¯¹è±¡å‘é€ä¸¤æ¡æ¶ˆæ¯å’Œæ”¶åˆ°ä¸¤æ¡å›žå¤ã€‚ç¬¬äºŒä¸ªæ˜¯ç›®æ ‡å¯¹è±¡æ”¶åˆ°ä¸€æ¡åŒæ­¥æ¶ˆæ¯å¹¶è¿”å›žä¸€æ¡å›žå¤ã€‚ç¬¬ä¸‰ä¸ªæ˜¯ç›®æ ‡å¯¹è±¡æ”¶åˆ°ä¸€æ¡å¼‚æ­¥æ¶ˆæ¯å¹¶è¿”å›žä¸€æ¡å›žå¤ã€‚ å†…éƒ¨é€šä¿¡ å†…éƒ¨æ¶ˆæ¯è¡¨çŽ°ä¸ºä¸€ä¸ªæ“ä½œçš„é€’å½’è°ƒç”¨ï¼Œæˆ–ä¸€ä¸ªæ–¹æ³•è°ƒç”¨å±žäºŽåŒä¸€ä¸ªå¯¹è±¡çš„å…¶ä»–æ–¹æ³•ã€‚æ˜¾ç¤ºä¸ºç”Ÿå‘½çº¿ä¸Šæ‰§è¡Œäº‹ä»¶çš„åµŒå¥—æŽ§åˆ¶ç„¦ç‚¹ã€‚ è¿·è·¯æ¶ˆæ¯å’Œæ‹¾å–æ¶ˆæ¯ è¿·è·¯æ¶ˆæ¯æ˜¯é‚£äº›å‘é€äº†å´æ²¡æœ‰åˆ°è¾¾æŒ‡å®šæŽ¥æ”¶è€…ï¼Œæˆ–è€…åˆ°è¾¾çš„æŽ¥æ”¶è€…ä¸å†å½“å‰å›¾ä¸­ã€‚æ‹¾å–æ¶ˆæ¯æ˜¯æ”¶åˆ°æ¥è‡ªé‚£äº›æœªçŸ¥çš„å‘é€è€…ï¼Œæˆ–è€…æ¥è‡ªæ²¡æœ‰æ˜¾ç¤ºåœ¨å½“å‰å›¾çš„å‘é€è€…çš„æ¶ˆæ¯ã€‚å®ƒä»¬éƒ½è¡¨æ˜Žæ˜¯åŽ»å¾€æˆ–æ¥è‡ªä¸€ä¸ªç»ˆç‚¹å…ƒç´ ã€‚ ç”Ÿå‘½çº¿å¼€å§‹ä¸Žç»“æŸ ç”Ÿå‘½çº¿å¯ä»¥åœ¨æ—¶åºå›¾æ—¶é—´åˆ»åº¦èŒƒå›´å†…åˆ›å»ºå’Œé”€æ¯ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç”Ÿå‘½çº¿è¢«åœæ­¢ç¬¦å·ï¼ˆå‰å·ï¼‰ç»ˆæ­¢ã€‚åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œç”Ÿå‘½çº¿é¡¶ç«¯çš„ç¬¦å·ï¼ˆChildï¼‰æ˜¾ç¤ºåœ¨æ¯”åˆ›å»ºå®ƒçš„å¯¹è±¡ç¬¦å·ï¼ˆparentï¼‰æ²¿é¡µé¢è¦ä½Žçš„ä½ç½®ä¸Šã€‚ä¸‹å›¾æ˜¾ç¤ºåˆ›å»ºå’Œç»ˆæ­¢å¯¹è±¡ã€‚ æ—¶é—´å’ŒæœŸé™çº¦æŸ æ¶ˆæ¯é»˜è®¤æ˜¾ç¤ºä¸ºæ°´å¹³çº¿ã€‚å› ä¸ºç”Ÿå‘½çº¿æ˜¾ç¤ºä¸ºæ²¿å±å¹•å‘ä¸‹çš„æ—¶é—´é€šé“ï¼Œæ‰€ä»¥å½“ç»™å®žæ—¶ç³»ç»Ÿå»ºæ¨¡ï¼Œæˆ–æ˜¯æœ‰æ—¶é—´çº¦æŸçš„ä¸šåŠ¡è¿‡ç¨‹å»ºæ¨¡ï¼Œè€ƒè™‘æ‰§è¡ŒåŠ¨ä½œæ‰€éœ€æ—¶é—´é•¿åº¦æ˜¯å¾ˆé‡è¦çš„ã€‚å› æ­¤å¯ä»¥ç»™æ¶ˆæ¯è®¾ç½®ä¸€ä¸ªæœŸé™çº¦æŸï¼Œè¿™æ ·çš„æ¶ˆæ¯æ˜¾ç¤ºä¸ºä¸‹æ–œçº¿ã€‚ å¤åˆç‰‡æ®µ å¦‚å‰é¢æ‰€è¯´ï¼Œæ—¶åºå›¾ä¸é€‚åˆè¡¨è¾¾å¤æ‚çš„è¿‡ç¨‹é€»è¾‘ã€‚åœ¨ä¸€ç§æƒ…å†µä¸‹ï¼Œæœ‰è®¸å¤šæœºåˆ¶å…è®¸æŠŠä¸€å®šç¨‹åº¦çš„è¿‡ç¨‹é€»è¾‘åŠ å…¥åˆ°å›¾ä¸­ï¼Œå¹¶æŠŠå®ƒä»¬æ”¾åˆ°å¤åˆç‰‡æ®µçš„æ ‡é¢˜ä¸‹ã€‚å¤åˆç‰‡æ®µæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå¤„ç†é¡ºåºè¢«åŒ…å«åœ¨ä¸€ä¸ªæ¡†æž¶ä¸­ï¼Œå¹¶åœ¨æŒ‡å®šåç§°çš„çŽ¯å¢ƒä¸‹æ‰§è¡Œã€‚ç‰‡æ®µå¯ä»¥æ˜¯: é€‰æ‹©æ€§ç‰‡æ®µ (æ˜¾ç¤º â€œaltâ€) ä¸º ifâ€¦thenâ€¦else ç»“æž„å»ºæ¨¡ã€‚ é€‰é¡¹ç‰‡æ®µ (æ˜¾ç¤º â€œoptâ€) ä¸º â€œswitchâ€(å¼€å…³) ç»“æž„å»ºæ¨¡ã€‚ ä¸­æ–­ç‰‡æ®µå¯¹è¢«å¤„ç†äº‹ä»¶çš„å¯é€‰æ‹©é¡ºåºå»ºæ¨¡ï¼Œè€Œä¸æ˜¯è¯¥å›¾çš„å…¶ä»–éƒ¨åˆ†ã€‚ å¹¶è¡Œç‰‡æ®µ(æ˜¾ç¤º â€œparâ€) ä¸ºå¹¶å‘å¤„ç†å»ºæ¨¡ã€‚ å¼±é¡ºåºç‰‡æ®µ (æ˜¾ç¤º â€œseqâ€) åŒ…å«äº†ä¸€ç»„æ¶ˆæ¯ï¼Œè¿™ç»„æ¶ˆæ¯å¿…é¡»åœ¨åŽç»§ç‰‡æ®µå¼€å§‹ä¹‹å‰è¢«å¤„ç†ã€‚ä½†ä¸ä¼šæŠŠç‰‡æ®µå†…æ¶ˆæ¯çš„å…ˆåŽé¡ºåºå¼ºåŠ åˆ°ä¸å…±äº«åŒä¸€æ¡ç”Ÿå‘½çº¿çš„æ¶ˆæ¯ä¸Šã€‚ ä¸¥æ ¼é¡ºåºç‰‡æ®µ (æ˜¾ç¤º â€œstrictâ€) åŒ…å«äº†ä¸€ç³»åˆ—éœ€è¦æŒ‰ç…§ç»™å®šé¡ºåºå¤„ç†çš„æ¶ˆæ¯ã€‚ éžç‰‡æ®µ (æ˜¾ç¤º â€œnegâ€) åŒ…å«äº†ä¸€ç³»åˆ—ä¸å¯ç”¨çš„æ¶ˆæ¯ã€‚ å…³é”®ç‰‡æ®µ å…·æœ‰å…³é”®éƒ¨åˆ†ã€‚ å¿½ç•¥ç‰‡æ®µ å£°æ˜Žä¸€ä¸ªæ²¡æœ‰æ„ä¹‰çš„æ¶ˆæ¯ï¼Œå¦‚æžœå®ƒå‡ºçŽ°åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ã€‚ è€ƒè™‘ç‰‡æ®µä¸Žå¿½ç•¥ç‰‡æ®µç›¸åï¼Œä¸åŒ…å«åœ¨è€ƒè™‘ç‰‡æ®µå†…çš„æ¶ˆæ¯éƒ½åº”è¯¥è¢«å¿½ç•¥ã€‚ æ–­è¨€ç‰‡æ®µ (æ˜¾ç¤º â€œassertâ€)æ ‡æ˜Žä»»ä½•æ²¡æœ‰æ˜¾ç¤ºä¸ºå£°æ˜Žæ“ä½œæ•°çš„é¡ºåºéƒ½æ˜¯æ— æ•ˆçš„ã€‚ å¾ªçŽ¯ç‰‡æ®µ åŒ…å«ä¸€ç³»åˆ—è¢«é‡å¤çš„æ¶ˆæ¯ã€‚ ä¸‹å›¾æ˜¾ç¤ºçš„æ˜¯å¾ªçŽ¯ç‰‡æ®µï¼š è¿™ä¹Ÿæ˜¯ä¸€ä¸ªç±»ä¼¼äºŽå¤åˆç‰‡æ®µçš„äº¤äº’å‘ç”Ÿã€‚ äº¤äº’å‘ç”Ÿè¢«å…¶ä»–å›¾å‚è€ƒï¼Œæ˜¾ç¤ºä¸ºå·¦ä¸Šè§’å¸¦&quot;ref&quot;ï¼Œå°†è¢«å‚è€ƒå›¾åæ˜¾ç¤ºåœ¨æ–¹æ¡†çš„ä¸­é—´ã€‚ é—¨ é—¨æ˜¯è¿žæŽ¥ç‰‡æ®µå†…æ¶ˆæ¯å’Œç‰‡æ®µå¤–æ¶ˆæ¯çš„è¿žæŽ¥ç‚¹ã€‚ åœ¨ EA ä¸­ï¼Œé—¨æ˜¾ç¤ºä¸ºç‰‡æ®µæ¡†æž¶ä¸Šçš„å°æ­£æ–¹å½¢ã€‚ä½œç”¨ä¸ºæ—¶åºå›¾ä¸Žé¡µé¢å¤–çš„è¿žæŽ¥å™¨ã€‚ ç”¨æ¥è¡¨ç¤ºè¿›æ¥çš„æ¶ˆæ¯æºï¼Œæˆ–è€…å‡ºåŽ»æ¶ˆæ¯çš„ç»ˆç‚¹ã€‚ä¸‹é¢ä¸¤ä¸ªå›¾æ˜¾ç¤ºå®ƒä»¬åœ¨å®žè·µä¸­çš„ä½¿ç”¨ã€‚æ³¨æ„ï¼š&quot; top level diagram&quot;ä¸­çš„é—¨ç”¨æ¶ˆæ¯ç®­å¤´æŒ‡å‘å‚è€ƒç‰‡æ®µï¼Œåœ¨è¿™é‡Œæ²¡æœ‰å¿…è¦æŠŠå®ƒç”»æˆæ–¹å—ã€‚ éƒ¨åˆ†åˆ†è§£ ä¸€ä¸ªå¯¹è±¡å¯ä»¥å¼•å‡ºå¤šæ¡ç”Ÿå‘½çº¿ï¼Œä½¿å¾—å¯¹è±¡å†…éƒ¨å’Œå¯¹è±¡ä¹‹é—´çš„æ¶ˆæ¯æ˜¾ç¤ºåœ¨åŒä¸€å›¾ä¸Šã€‚ çŠ¶æ€å¸¸é‡/å»¶ç»­ çŠ¶æ€å¸¸é‡æ˜¯ç”Ÿå‘½çº¿çš„çº¦æŸï¼Œè¿è¡Œæ—¶å§‹ç»ˆä¸º&quot;çœŸ&quot;ã€‚æ˜¾ç¤ºä¸ºä¸¤ä¾§åŠåœ†çš„çŸ©å½¢ï¼Œå¦‚ä¸‹å›¾ï¼š å»¶ç»­è™½ä¸ŽçŠ¶æ€å¸¸é‡æœ‰åŒæ ·çš„æ ‡æ³¨ï¼Œä½†æ˜¯è¢«ç”¨äºŽå¤åˆç‰‡æ®µï¼Œå¹¶å¯ä»¥å»¶ä¼¸è·¨è¶Šå¤šæ¡ç”Ÿå‘½çº¿ã€‚ æ—¶é—´å›¾ UML æ—¶é—´å›¾è¢«ç”¨æ¥æ˜¾ç¤ºéšæ—¶é—´å˜åŒ–ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ çš„å€¼æˆ–çŠ¶æ€çš„æ›´æ”¹ã€‚ä¹Ÿæ˜¾ç¤ºæ—¶æŽ§äº‹ä»¶ä¹‹é—´çš„äº¤äº’å’Œç®¡ç†å®ƒä»¬çš„æ—¶é—´å’ŒæœŸé™çº¦æŸã€‚ çŠ¶æ€ç”Ÿå‘½çº¿ çŠ¶æ€ç”Ÿå‘½çº¿æ˜¾ç¤ºéšæ—¶é—´å˜åŒ–ï¼Œä¸€ä¸ªå•é¡¹çŠ¶æ€çš„æ”¹å˜ã€‚ä¸è®ºæ—¶é—´å•ä½å¦‚ä½•é€‰æ‹©ï¼ŒX è½´æ˜¾ç¤ºç»è¿‡çš„æ—¶é—´ï¼ŒY è½´è¢«æ ‡ä¸ºç»™å‡ºçŠ¶æ€çš„åˆ—è¡¨ã€‚çŠ¶æ€ç”Ÿå‘½çº¿å¦‚ä¸‹æ‰€ç¤ºï¼š å€¼ç”Ÿå‘½çº¿ å€¼ç”Ÿå‘½çº¿æ˜¾ç¤ºéšæ—¶é—´å˜åŒ–ï¼Œä¸€ä¸ªå•é¡¹çš„å€¼çš„å˜åŒ–ã€‚X è½´æ˜¾ç¤ºç»è¿‡çš„æ—¶é—´ï¼Œæ—¶é—´å•ä½ä¸ºä»»æ„ï¼Œå’ŒçŠ¶æ€ç”Ÿå‘½çº¿ä¸€æ ·ã€‚å¹³è¡Œçº¿ä¹‹é—´æ˜¾ç¤ºå€¼ï¼Œæ¯æ¬¡å€¼å˜åŒ–ï¼Œå¹³è¡Œçº¿äº¤å‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å°†å®ƒä»¬æ”¾åœ¨ä¸€èµ· çŠ¶æ€å’Œå€¼çš„ç”Ÿå‘½çº¿èƒ½å åŠ ç»„åˆã€‚å®ƒä»¬å¿…é¡»æœ‰ç›¸åŒçš„ X è½´ã€‚ æ¶ˆæ¯å¯ä»¥ä»Žä¸€ä¸ªç”Ÿå‘½çº¿ä¼ é€’åˆ°å¦ä¸€ä¸ªã€‚æ¯ä¸€ä¸ªçŠ¶æ€å’Œå€¼çš„å˜æ¢èƒ½æœ‰ä¸€ä¸ªå®šä¹‰çš„äº‹ä»¶ï¼Œä¸€ä¸ªæ—¶é—´é™åˆ¶æ˜¯æŒ‡ä¸€ä¸ªäº‹ä»¶ä½•æ—¶å¿…é¡»å‘ç”Ÿï¼Œå’Œä¸€ä¸ªæœŸé™é™åˆ¶è¯´æ˜ŽçŠ¶æ€æˆ–å€¼å¤šé•¿æ—¶é—´å¿…é¡»æœ‰æ•ˆã€‚ä¸€æ—¦è¿™äº›å·²ç»è¢«åº”ç”¨ï¼Œå…¶æ—¶é—´å›¾å¯èƒ½æ˜¾ç¤ºå¦‚ä¸‹ã€‚ UML å·¥å…· UML å·¥å…·éžå¸¸å¤šï¼Œåˆ°åº•å“ªç§å·¥å…·å¥½ï¼ŒçœŸçš„æ˜¯ä»è€…è§ä»æ™ºè€…è§æ™ºã€‚è¿™é‡Œåˆ—ä¸¾ä¸€äº›æˆ‘æŽ¥è§¦è¿‡çš„ UML å·¥å…·ï¼š äº¿å›¾ å›½å†…å¼€å‘çš„ã€æ”¶è´¹çš„ç»˜å›¾å·¥å…·ã€‚å›¾å½¢æ¨¡æ¿ã€ç´ æéžå¸¸å…¨é¢ï¼Œæ ·å¼ä¹Ÿå¾ˆç²¾ç¾Žï¼Œå¯ä»¥å¯¼å‡ºä¸º wordã€pdfã€å›¾ç‰‡ã€‚ äº¿å›¾å®˜ç½‘ Visio Office çš„ç»˜å›¾å·¥å…·ï¼Œç‰¹ç‚¹æ˜¯ç®€å•ã€æ¸…æ™°ã€‚ Visio å®˜ç½‘ StarUML æ ·å¼ç²¾ç¾Žï¼ŒåŠŸèƒ½å…¨é¢çš„ UML å·¥å…·ã€‚ StarUML å®˜ç½‘ Astah æ ·å¼ä¸é”™ï¼ŒåŠŸèƒ½å…¨é¢çš„ç»˜å›¾å·¥å…·ã€‚ Astah å®˜ç½‘ ArgoUML UML å·¥å…·ã€‚ ArgoUML å®˜ç½‘ ProcessOn åœ¨çº¿ç»˜å›¾å·¥å…·ï¼Œç‰¹ç‚¹æ˜¯ç®€æ´ã€æ¸…æ™°ã€‚ ProcessOn å®˜ç½‘ drawio å¼€æºçš„åœ¨çº¿ç»˜å›¾å·¥å…·ï¼Œç‰¹ç‚¹æ˜¯ç®€æ´ã€æ¸…æ™°ã€‚ drawio å®˜ç½‘ æ›´å¤šå†…å®¹ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ å‚è€ƒèµ„æ–™ Wiki-UML Sparx UML æ•™ç¨‹ OMG UML UML Tutorial W3Cschool UML æ•™ç¨‹ UML å­¦ä¹ å…¥é—¨å°±è¿™ä¸€ç¯‡æ–‡ç«  http://www.cnblogs.com/ywqu/category/223486.html]]></content>
      <categories>
        <category>design</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>uml</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HBase Java API]]></title>
    <url>%2Fblog%2F2019%2F03%2F06%2Fbigdata%2Fhbase%2Fhbase-api-java%2F</url>
    <content type="text"><![CDATA[HBase Java API æ›´å¤šå†…å®¹ å‚è€ƒèµ„æ–™ æ›´å¤šå†…å®¹ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ å‚è€ƒèµ„æ–™ https://blog.csdn.net/jiyiqinlovexx/article/details/36526433 https://blog.csdn.net/u010967382/article/details/38046821]]></content>
  </entry>
  <entry>
    <title><![CDATA[è®¡ç®—æœºç½‘ç»œæ¦‚è¿°]]></title>
    <url>%2Fblog%2F2019%2F02%2F20%2Fcommunication%2Fnetwork-guide%2F</url>
    <content type="text"><![CDATA[è®¡ç®—æœºç½‘ç»œæ¦‚è¿° è®¡ç®—æœºç½‘ç»œæ˜¯æŒ‡å°†åœ°ç†ä½ç½®ä¸åŒçš„å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„å¤šå°è®¡ç®—æœºåŠå…¶å¤–éƒ¨è®¾å¤‡ï¼Œé€šè¿‡é€šä¿¡çº¿è·¯è¿žæŽ¥èµ·æ¥ï¼Œåœ¨ç½‘ç»œæ“ä½œç³»ç»Ÿï¼Œç½‘ç»œç®¡ç†è½¯ä»¶åŠç½‘ç»œé€šä¿¡åè®®çš„ç®¡ç†å’Œåè°ƒä¸‹ï¼Œå®žçŽ°èµ„æºå…±äº«å’Œä¿¡æ¯ä¼ é€’çš„è®¡ç®—æœºç³»ç»Ÿã€‚ ðŸ’¡ æŒ‡å— å­¦ä¹ ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹å…¥é—¨ä¸‰é—®ï¼š ä¸€ã€ä»€ä¹ˆæ˜¯è®¡ç®—æœºç½‘ç»œï¼Ÿ è®¡ç®—æœºç½‘ç»œæ˜¯æŒ‡å°†åœ°ç†ä½ç½®ä¸åŒçš„å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„å¤šå°è®¡ç®—æœºåŠå…¶å¤–éƒ¨è®¾å¤‡ï¼Œé€šè¿‡é€šä¿¡çº¿è·¯è¿žæŽ¥èµ·æ¥ï¼Œåœ¨ç½‘ç»œæ“ä½œç³»ç»Ÿï¼Œç½‘ç»œç®¡ç†è½¯ä»¶åŠç½‘ç»œé€šä¿¡åè®®çš„ç®¡ç†å’Œåè°ƒä¸‹ï¼Œå®žçŽ°èµ„æºå…±äº«å’Œä¿¡æ¯ä¼ é€’çš„è®¡ç®—æœºç³»ç»Ÿã€‚ â€”â€”æ‘˜è‡ªç™¾åº¦ç™¾ç§‘ äºŒã€ä¸ºä»€ä¹ˆå­¦ä¹ è®¡ç®—æœºç½‘ç»œï¼Ÿ è®¡ç®—æœºç½‘ç»œæ˜¯è®¡ç®—æœºç§‘å­¦çš„åŸºç¡€è¯¾ç¨‹ï¼Œä¹Ÿæ˜¯è®¡ç®—æœºä¸“ä¸šè€ƒç ”å¿…è€ƒç§‘ç›®ï¼Œå¯è§å…¶é‡è¦æ€§ã€‚ä½œä¸ºä¸€åç¨‹åºå‘˜ï¼Œäº†è§£è®¡ç®—æœºç½‘ç»œï¼Œå¯¹äºŽ Web é¢†åŸŸï¼Œé€šä¿¡é¢†åŸŸçš„å¼€å‘æœ‰èŽ«å¤§çš„å¸®åŠ©ã€‚ åœ¨æµè§ˆå™¨ä¸­è®¿é—®ç½‘é¡µçš„åŽŸç†æ˜¯ä»€ä¹ˆï¼ŸWifi æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿé˜²ç«å¢™æ˜¯å¦‚ä½•ä¿éšœç½‘ç»œå®‰å…¨çš„ï¼Ÿä»€ä¹ˆæ˜¯å®‰å…¨è¯ä¹¦ï¼ŸCookie å’Œ Session æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿã€‚ã€‚ã€‚ å¦‚æžœä½ æŽ¥è§¦è¿‡è¿™äº›æŠ€æœ¯ï¼Œå¦‚æžœä½ æƒ³äº†è§£è¿™äº›æŠ€æœ¯çš„åŽŸç†ï¼Œé‚£ä¹ˆä½ å°±æœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹è®¡ç®—æœºç½‘ç»œäº†ã€‚ ä¸‰ã€å¦‚ä½•å­¦ä¹ è®¡ç®—æœºç½‘ç»œï¼Ÿ æœ¬äººæœ‰ 2 å¹´é€šä¿¡é¢†åŸŸå¼€å‘ç»éªŒï¼Œä»Žäº‹é€šä¿¡è®¾å¤‡ä¸Šçš„åè®®å¼€å‘ã€‚å°±æˆ‘ä¸ªäººçš„å­¦ä¹ ç»éªŒæ¥çœ‹ï¼Œå­¦ä¹ è®¡ç®—æœºç½‘ç»œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹é˜¶æ®µï¼š åŸºç¡€é˜¶æ®µâ€”â€”ä¸€èˆ¬æ€§çš„äº†è§£ç½‘ç»œåè®®åˆ†å±‚åŠå„å±‚åŠŸèƒ½ äº†è§£è®¡ç®—æœºç½‘ç»œåè®®åˆ†å±‚ï¼ˆOSIï¼‰æœ‰å“ªäº›å±‚ï¼Œåˆ†å±‚çš„ä¾æ®æ˜¯ä»€ä¹ˆï¼ˆå³æ¯å±‚çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼‰ äº†è§£æ¯å±‚çš„ä¸»è¦é€šä¿¡è®¾å¤‡æœ‰å“ªäº›ï¼› äº†è§£æ¯å±‚æœ‰å“ªäº›é‡è¦ç½‘ç»œåè®®ï¼Œè¿™äº›åè®®æœ‰ä»€ä¹ˆä½œç”¨ï¼ŒåŸºæœ¬åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿ äº†è§£æ¯å±‚çš„ä¼ è¾“æ•°æ®å½¢å¼ï¼ˆå¦‚ï¼šæŠ¥æ–‡ã€å¸§ç­‰ï¼‰ è¿›é˜¶é˜¶æ®µâ€”â€”ç³»ç»Ÿå­¦ä¹ è®¡ç®—æœºç½‘ç»œçŸ¥è¯†ï¼Œå°†å„å±‚ä¸»è¦åè®®åŠŸèƒ½ä¸²è”èµ·æ¥ å­¦ä¹  TCP/IP è¯¦è§£ å· 1ã€å· 2ã€å· 3ï¼ˆå†…å®¹è¯¦å®žï¼Œä½†æ–‡å­—è¾ƒä¸ºæ™¦æ¶©ï¼Œä¸é€‚åˆåˆå­¦è€…ï¼‰ ä¸“ä¸šé˜¶æ®µâ€”â€”æ ¹æ®ä¸šåŠ¡é¢†åŸŸï¼Œæœ‰é’ˆå¯¹æ€§çš„å­¦ä¹  ç½‘ç»œåè®®å¾ˆå¤šï¼Œè€Œä¸”ä¸“ä¸šæ€§éžå¸¸å¼ºã€‚ç²¾é€šæ‰€æœ‰åè®®ï¼Œå‡ ä¹Žæ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥æœ‰å¿…è¦æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡é¢†åŸŸï¼Œæœ‰é’ˆå¯¹æ€§çš„æ·±å…¥å­¦ä¹ åè®®ã€‚å¦‚æžœä½ æ˜¯åš web å¼€å‘ï¼Œé‚£ä¹ˆä½ å¾ˆæœ‰å¿…è¦è®¤çœŸå­¦ä¹ ä¸€ä¸‹ HTTPã€DNS åè®®ï¼›å¦‚æžœä½ æ˜¯åšè·¯ç”±å™¨ã€äº¤æ¢æœºé¢†åŸŸé€šä¿¡å¼€å‘ï¼Œé‚£ä¹ˆä½ åº”è¯¥æ›´æ·±å…¥å­¦ä¹ ä¸€ä¸‹ IP/TCP/UDP åè®®ã€‚ã€‚ã€‚ å¦‚ä½•æ·±å…¥å­¦ä¹ åè®®ï¼Œæœ€å¥½çš„å­¦ä¹ æ–¹å¼ï¼Œå°±æ˜¯æ·±å…¥å­¦ä¹  RFCï¼Œå¹¶ç»“åˆå®žé™…çš„åè®®æŠ¥æ–‡åŽ»äº†è§£ã€‚ æ ¸å¿ƒæ¦‚å¿µ è®¡ç®—æœºç½‘ç»œ - è®¡ç®—æœºç½‘ç»œï¼ˆcomputer networkï¼‰ï¼Œé€šå¸¸ä¹Ÿç®€ç§°ç½‘ç»œï¼Œæ˜¯åˆ©ç”¨é€šä¿¡è®¾å¤‡å’Œçº¿è·¯å°†åœ°ç†ä½ç½®ä¸åŒçš„ã€åŠŸèƒ½ç‹¬ç«‹çš„å¤šä¸ªè®¡ç®—æœºç³»ç»Ÿè¿žæŽ¥èµ·æ¥ï¼Œä»¥åŠŸèƒ½å®Œå–„çš„ç½‘ç»œè½¯ä»¶å®žçŽ°ç½‘ç»œçš„ç¡¬ä»¶ã€è½¯ä»¶åŠèµ„æºå…±äº«å’Œä¿¡æ¯ä¼ é€’çš„ç³»ç»Ÿã€‚ç®€å•çš„è¯´å³è¿žæŽ¥ä¸¤å°æˆ–å¤šå°è®¡ç®—æœºè¿›è¡Œé€šä¿¡çš„ç³»ç»Ÿã€‚ äº’è”ç½‘ - äº’è”ç½‘ï¼ˆInternetï¼‰ï¼Œå³ç½‘ç»œçš„ç½‘ç»œã€‚ æ‹“æ‰‘ç»“æž„ è®¡ç®—æœºç½‘ç»œçš„æ‹“æ‰‘ç»“æž„å¯åˆ†ä¸ºï¼š ç½‘åž‹æ‹“æ‰‘ç½‘åž‹ç½‘ï¼ˆMesh networkï¼‰ çŽ¯åž‹æ‹“æ‰‘çŽ¯åž‹ç½‘ï¼ˆRing networkï¼‰ æ˜Ÿåž‹æ‹“æ‰‘æ˜Ÿåž‹ç½‘ï¼ˆStar networkï¼‰ æ ‘çŠ¶æ‹“æ‰‘æ ‘åž‹ç½‘ï¼ˆTree networkï¼‰ æ€»çº¿æ‹“æ‰‘æ€»çº¿ç½‘ï¼ˆBus networkï¼‰ ä½œç”¨èŒƒå›´ å¹¿åŸŸç½‘ WANï¼ˆWide Area Networkï¼‰ åŸŽåŸŸç½‘ MANï¼ˆMetropolitan Area Networkï¼‰ å±€åŸŸç½‘ LANï¼ˆLocal Area Networkï¼‰ ä¸ªäººåŒºåŸŸç½‘ PANï¼ˆPersonal Area Networkï¼‰ æ€§èƒ½æŒ‡æ ‡ é€ŸçŽ‡ - é€ŸçŽ‡çš„å•ä½æ˜¯ bit/sï¼ˆæ¯”ç‰¹æ¯ç§’ï¼‰ã€‚ å¸¦å®½ï¼ˆbandwidthï¼‰ - å¸¦å®½æœ‰ä»¥ä¸‹ä¸¤ç§ä¸åŒçš„æ„ä¹‰ã€‚ ä¿¡å·çš„å¸¦å®½æ˜¯æŒ‡è¯¥ä¿¡å·æ‰€åŒ…å«çš„å„ç§ä¸åŒé¢‘çŽ‡æˆåˆ†æ‰€å æ®çš„é¢‘çŽ‡èŒƒå›´ã€‚è¿™ç§æ„ä¹‰çš„å¸¦å®½çš„å•ä½æ˜¯èµ« ï¼ˆæˆ–åƒèµ«ï¼Œå…†èµ«ï¼Œå‰èµ«ç­‰ï¼‰ã€‚ ç½‘ç»œçš„å¸¦å®½è¡¨ç¤ºåœ¨å•ä½æ—¶é—´å†…ä»Žç½‘ç»œä¸­çš„æŸä¸€ç‚¹åˆ°å¦ä¸€ç‚¹æ‰€èƒ½é€šè¿‡çš„æœ€é«˜æ•°æ®çŽ‡ã€‚è¿™ç§æ„ä¹‰çš„å¸¦å®½çš„å•ä½æ˜¯ bit/sï¼ˆæ¯”ç‰¹æ¯ç§’ï¼‰ã€‚ åžåé‡ï¼ˆthroughputï¼‰ - åžåé‡è¡¨ç¤ºåœ¨å•ä½æ—¶é—´å†…é€šè¿‡æŸä¸ªç½‘ç»œï¼ˆæˆ–ä¿¡é“ã€æŽ¥å£ï¼‰çš„æ•°æ®é‡ã€‚ä¾‹å¦‚ï¼Œå¯¹äºŽä¸€ä¸ª 100 Mbit/s çš„ä»¥å¤ªç½‘ï¼Œå…¶é¢å®šé€ŸçŽ‡æ˜¯ 100 Mbit/sã€‚ æ—¶å»¶ï¼ˆdelayï¼‰ æ€»æ—¶å»¶ = æŽ’é˜Ÿæ—¶å»¶ + å¤„ç†æ—¶å»¶ + ä¼ è¾“æ—¶å»¶ + ä¼ æ’­æ—¶å»¶ ä½“ç³»ç»“æž„ ç‰©ç†å±‚ - å…³é”®è¯ï¼šè°ƒåˆ¶ã€è§£è°ƒã€æ•°å­—ä¿¡å·ã€æ¨¡æ‹Ÿä¿¡å·ã€é€šä¿¡åª’ä»‹ã€ä¿¡é“å¤ç”¨ æ•°æ®é“¾è·¯å±‚ - å…³é”®è¯ï¼šç‚¹å¯¹ç‚¹ä¿¡é“ã€å¹¿æ’­ä¿¡é“ã€PPPã€CSMA/CDã€å±€åŸŸç½‘ã€ä»¥å¤ªç½‘ã€MACã€é€‚é…å™¨ã€é›†çº¿å™¨ã€ç½‘æ¡¥ã€äº¤æ¢æœº ç½‘ç»œå±‚ - å…³é”®è¯ï¼šIPã€ICMPã€ARPã€è·¯ç”± ä¼ è¾“å±‚ - å…³é”®è¯ï¼šUDPã€TCPã€æ»‘åŠ¨çª—å£ã€æ‹¥å¡žæŽ§åˆ¶ã€ä¸‰æ¬¡æ¡æ‰‹ åº”ç”¨å±‚ - å…³é”®è¯ï¼šHTTPã€DNSã€FTPã€TELNETã€DHCP ç‰©ç†å±‚ï¼ˆPhysical Layerï¼‰ - ç‰©ç†å±‚åªæŽ¥æ”¶å’Œå‘é€ä¸€ä¸²æ¯”ç‰¹(bit)æµï¼Œä¸è€ƒè™‘ä¿¡æ¯çš„æ„ä¹‰å’Œä¿¡æ¯ç»“æž„ã€‚ æ•°æ®å•å…ƒï¼šæ¯”ç‰¹æµã€‚ å…¸åž‹è®¾å¤‡ï¼šå…‰çº¤ã€åŒè½´ç”µç¼†ã€åŒç»žçº¿ã€ä¸­ç»§å™¨å’Œé›†çº¿å™¨ã€‚ æ•°æ®é“¾è·¯å±‚ï¼ˆData Link Layerï¼‰ - ç½‘ç»œå±‚é’ˆå¯¹çš„è¿˜æ˜¯ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œè€Œä¸»æœºä¹‹é—´å¯ä»¥æœ‰å¾ˆå¤šé“¾è·¯ï¼Œé“¾è·¯å±‚åè®®å°±æ˜¯ä¸ºåŒä¸€é“¾è·¯çš„ä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚æ•°æ®é“¾è·¯å±‚æŠŠç½‘ç»œå±‚ä¼ ä¸‹æ¥çš„åˆ†ç»„å°è£…æˆå¸§ã€‚ ä¸»è¦åè®®ï¼šPPPã€CSMA/CD ç­‰ã€‚ æ•°æ®å•å…ƒï¼šå¸§ï¼ˆframeï¼‰ã€‚ å…¸åž‹è®¾å¤‡ï¼šäºŒå±‚äº¤æ¢æœºã€ç½‘æ¡¥ã€ç½‘å¡ã€‚ ç½‘ç»œå±‚ï¼ˆnetwork layerï¼‰ - ä¸ºåˆ†ç»„äº¤æ¢ç½‘ä¸Šçš„ä¸åŒä¸»æœºæä¾›é€šä¿¡æœåŠ¡ã€‚åœ¨å‘é€æ•°æ®æ—¶ï¼Œç½‘ç»œå±‚æŠŠè¿è¾“å±‚äº§ç”Ÿçš„æŠ¥æ–‡æ®µæˆ–ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„æˆ–åŒ…è¿›è¡Œä¼ é€ã€‚ ä¸»è¦åè®®ï¼šIPã€‚ æ•°æ®å•å…ƒï¼šIP æ•°æ®æŠ¥ï¼ˆpacketï¼‰ã€‚ å…¸åž‹è®¾å¤‡ï¼šç½‘å…³ã€è·¯ç”±å™¨ã€‚ ä¼ è¾“å±‚ï¼ˆtransport layerï¼‰ - ä¸ºä¸¤å°ä¸»æœºä¸­è¿›ç¨‹é—´çš„é€šä¿¡æä¾›é€šç”¨çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ ä¸»è¦åè®®ï¼šTCPã€UDPã€‚ æ•°æ®å•å…ƒï¼šæŠ¥æ–‡æ®µï¼ˆsegmentï¼‰æˆ–ç”¨æˆ·æ•°æ®æŠ¥ã€‚ ä¼šè¯å±‚ï¼ˆSession Layerï¼‰ - ä¼šè¯å±‚ä¸å‚ä¸Žå…·ä½“çš„ä¼ è¾“ï¼Œå®ƒæä¾›åŒ…æ‹¬è®¿é—®éªŒè¯å’Œä¼šè¯ç®¡ç†åœ¨å†…çš„å»ºç«‹å’Œç»´æŠ¤åº”ç”¨ä¹‹é—´é€šä¿¡çš„æœºåˆ¶ã€‚ è¡¨ç¤ºå±‚ï¼ˆPresentation Layerï¼‰ - è¡¨ç¤ºå±‚æ˜¯ä¸ºåœ¨åº”ç”¨è¿‡ç¨‹ä¹‹é—´ä¼ é€çš„ä¿¡æ¯æä¾›è¡¨ç¤ºæ–¹æ³•çš„æœåŠ¡ï¼Œå®ƒå…³å¿ƒçš„åªæ˜¯å‘å‡ºä¿¡æ¯çš„è¯­æ³•ä¸Žè¯­ä¹‰ã€‚è¡¨ç¤ºå±‚è¦å®ŒæˆæŸäº›ç‰¹å®šçš„åŠŸèƒ½ï¼Œä¸»è¦æœ‰ä¸åŒæ•°æ®ç¼–ç æ ¼å¼çš„è½¬æ¢ï¼Œæä¾›æ•°æ®åŽ‹ç¼©ã€è§£åŽ‹ç¼©æœåŠ¡ï¼Œå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€è§£å¯†ã€‚ åº”ç”¨å±‚ï¼ˆapplication layerï¼‰ - é€šè¿‡åº”ç”¨è¿›ç¨‹é—´çš„äº¤äº’æ¥å®Œæˆç‰¹å®šç½‘ç»œåº”ç”¨ã€‚åº”ç”¨å±‚åè®®å®šä¹‰çš„æ˜¯åº”ç”¨è¿›ç¨‹é—´é€šä¿¡å’Œäº¤äº’çš„è§„åˆ™ã€‚ ä¸»è¦åè®®ï¼šHTTPã€DNSã€SMTPã€Telnetã€FTPã€SNMP ç­‰ã€‚ æ•°æ®å•å…ƒï¼šæŠ¥æ–‡ï¼ˆmessageï¼‰ã€‚ ðŸ“š å­¦ä¹ èµ„æº ä¹¦ è°¢å¸Œä», è®¡ç®—æœºç½‘ç»œ - å›½å†…å¾ˆå¤šå¤§å­¦å°†å…¶ä½œä¸ºè®¡ç®—æœºç½‘ç»œè¯¾ç¨‹çš„æŒ‡å®šæ•™æï¼Œé€šä¿—æ˜“æ‡‚ï¼Œé€‚åˆä½œä¸ºå…¥é—¨æ•™æã€‚ WÂ·Richard Stevens, TCP/IP è¯¦è§£ å· 1ï¼šåè®® - TCP/IP è¯¦è§£ä¸‰éƒ¨æ›²ï¼Œé€‚åˆä½œä¸ºè¿›é˜¶æ•™æ WÂ·Richard Stevens, TCP/IP è¯¦è§£ å· 2ï¼šå®žçŽ° WÂ·Richard Stevens, TCP/IP è¯¦è§£ å· 3ï¼šTCP äº‹åŠ¡åè®®ã€HTTPã€NNTP å’Œ UNIX åŸŸåè®® ç«™ç‚¹ https://www.rfc-editor.org/ - åœ¨çº¿æŸ¥é˜…ã€ä¸‹è½½ RFC æ–‡æ¡£ ðŸšª ä¼ é€é—¨ | å›žé¦–é  |]]></content>
      <categories>
        <category>communication</category>
      </categories>
      <tags>
        <tag>communication</tag>
        <tag>network</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç½‘ç»œåè®®ä¹‹ DNS]]></title>
    <url>%2Fblog%2F2018%2F10%2F17%2Fcommunication%2Fdns%2F</url>
    <content type="text"><![CDATA[ç½‘ç»œåè®®ä¹‹ DNS ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ åŸŸåç³»ç»Ÿï¼ˆè‹±æ–‡ï¼šDomain Name Systemï¼Œç¼©å†™ï¼šDNSï¼‰æ˜¯äº’è”ç½‘çš„ä¸€é¡¹æœåŠ¡ã€‚å®ƒä½œä¸ºå°†åŸŸåå’Œ IP åœ°å€ç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œèƒ½å¤Ÿä½¿äººæ›´æ–¹ä¾¿åœ°è®¿é—®äº’è”ç½‘ã€‚DNS ä½¿ç”¨ TCP å’Œ UDP ç«¯å£ 53ã€‚å½“å‰ï¼Œå¯¹äºŽæ¯ä¸€çº§åŸŸåé•¿åº¦çš„é™åˆ¶æ˜¯ 63 ä¸ªå­—ç¬¦ï¼ŒåŸŸåæ€»é•¿åº¦åˆ™ä¸èƒ½è¶…è¿‡ 253 ä¸ªå­—ç¬¦ã€‚ å…³é”®è¯ï¼šDNS, åŸŸåè§£æž ç®€ä»‹ ä»€ä¹ˆæ˜¯ DNSï¼Ÿ ä»€ä¹ˆæ˜¯åŸŸåï¼Ÿ DNS çš„åˆ†å±‚ DNS æœåŠ¡ç±»åž‹ è®°å½•ç±»åž‹ åŸŸåè§£æž Linux ä¸Šçš„åŸŸåç›¸å…³å‘½ä»¤ hostname nslookup æ›´å¤šå†…å®¹ ç®€ä»‹ ä»€ä¹ˆæ˜¯ DNSï¼Ÿ DNS æ˜¯ä¸€ä¸ªåº”ç”¨å±‚åè®®ã€‚ åŸŸåç³»ç»Ÿ (DNS) çš„ä½œç”¨æ˜¯å°†äººç±»å¯è¯»çš„åŸŸå (å¦‚ï¼Œwww.example.com) è½¬æ¢ä¸ºæœºå™¨å¯è¯»çš„ IP åœ°å€ (å¦‚ï¼Œ192.0.2.44)ã€‚ ä»€ä¹ˆæ˜¯åŸŸåï¼Ÿ åŸŸåæ˜¯ç”±ä¸€ä¸²ç”¨ç‚¹åˆ†éš”ç¬¦ . ç»„æˆçš„äº’è”ç½‘ä¸ŠæŸä¸€å°è®¡ç®—æœºæˆ–è®¡ç®—æœºç»„çš„åç§°ï¼Œç”¨äºŽåœ¨æ•°æ®ä¼ è¾“æ—¶æ ‡è¯†è®¡ç®—æœºçš„æ–¹ä½ã€‚åŸŸåå¯ä»¥è¯´æ˜¯ä¸€ä¸ª IP åœ°å€çš„ä»£ç§°ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¾¿äºŽè®°å¿†åŽè€…ã€‚ä¾‹å¦‚ï¼Œwikipedia.org æ˜¯ä¸€ä¸ªåŸŸåï¼Œå’Œ IP åœ°å€ 208.80.152.2 ç›¸å¯¹åº”ã€‚äººä»¬å¯ä»¥ç›´æŽ¥è®¿é—® wikipedia.org æ¥ä»£æ›¿ IP åœ°å€ï¼Œç„¶åŽåŸŸåç³»ç»Ÿï¼ˆDNSï¼‰å°±ä¼šå°†å®ƒè½¬åŒ–æˆä¾¿äºŽæœºå™¨è¯†åˆ«çš„ IP åœ°å€ã€‚è¿™æ ·ï¼Œäººä»¬åªéœ€è¦è®°å¿† wikipedia.org è¿™ä¸€ä¸²å¸¦æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ï¼Œè€Œä¸éœ€è¦è®°å¿†æ²¡æœ‰å«ä¹‰çš„æ•°å­—ã€‚ DNS çš„åˆ†å±‚ åŸŸåç³»ç»Ÿæ˜¯åˆ†å±‚æ¬¡çš„ã€‚ åœ¨åŸŸåç³»ç»Ÿçš„å±‚æ¬¡ç»“æž„ä¸­ï¼Œå„ç§åŸŸåéƒ½éš¶å±žäºŽåŸŸåç³»ç»Ÿæ ¹åŸŸçš„ä¸‹çº§ã€‚åŸŸåçš„ç¬¬ä¸€çº§æ˜¯é¡¶çº§åŸŸï¼Œå®ƒåŒ…æ‹¬é€šç”¨é¡¶çº§åŸŸï¼Œä¾‹å¦‚ .comã€.net å’Œ .orgï¼›ä»¥åŠå›½å®¶å’Œåœ°åŒºé¡¶çº§åŸŸï¼Œä¾‹å¦‚ .usã€.cn å’Œ .tkã€‚é¡¶çº§åŸŸåä¸‹ä¸€å±‚æ˜¯äºŒçº§åŸŸåï¼Œä¸€çº§ä¸€çº§åœ°å¾€ä¸‹ã€‚è¿™äº›åŸŸåå‘äººä»¬æä¾›æ³¨å†ŒæœåŠ¡ï¼Œäººä»¬å¯ä»¥ç”¨å®ƒåˆ›å»ºå…¬å¼€çš„äº’è”ç½‘èµ„æºæˆ–è¿è¡Œç½‘ç«™ã€‚é¡¶çº§åŸŸåçš„ç®¡ç†æœåŠ¡ç”±å¯¹åº”çš„åŸŸåæ³¨å†Œç®¡ç†æœºæž„ï¼ˆåŸŸåæ³¨å†Œå±€ï¼‰è´Ÿè´£ï¼Œæ³¨å†ŒæœåŠ¡é€šå¸¸ç”±åŸŸåæ³¨å†Œå•†è´Ÿè´£ã€‚ DNS æœåŠ¡ç±»åž‹ æŽˆæƒåž‹ DNS - ä¸€ç§æŽˆæƒåž‹ DNS æœåŠ¡æä¾›ä¸€ç§æ›´æ–°æœºåˆ¶ï¼Œä¾›å¼€å‘äººå‘˜ç”¨äºŽç®¡ç†å…¶å…¬ç”¨ DNS åç§°ã€‚ç„¶åŽï¼Œå®ƒå“åº” DNS æŸ¥è¯¢ï¼Œå°†åŸŸåè½¬æ¢ä¸º IP åœ°å€ï¼Œä»¥ä¾¿è®¡ç®—æœºå¯ä»¥ç›¸äº’é€šä¿¡ã€‚æŽˆæƒåž‹ DNS å¯¹åŸŸæœ‰æœ€ç»ˆæŽˆæƒä¸”è´Ÿè´£æä¾›é€’å½’åž‹ DNS æœåŠ¡å™¨å¯¹ IP åœ°å€ä¿¡æ¯çš„å“åº”ã€‚Amazon Route 53 æ˜¯ä¸€ç§æŽˆæƒåž‹ DNS ç³»ç»Ÿã€‚ é€’å½’åž‹ DNS - å®¢æˆ·ç«¯é€šå¸¸ä¸ä¼šå¯¹æŽˆæƒåž‹ DNS æœåŠ¡ç›´æŽ¥è¿›è¡ŒæŸ¥è¯¢ã€‚è€Œæ˜¯é€šå¸¸è¿žæŽ¥åˆ°ç§°ä¸ºè§£æžç¨‹åºçš„å…¶ä»–ç±»åž‹ DNS æœåŠ¡ï¼Œæˆ–é€’å½’åž‹ DNS æœåŠ¡ã€‚é€’å½’åž‹ DNS æœåŠ¡å°±åƒæ˜¯æ—…é¦†çš„é—¨ç«¥ï¼šå°½ç®¡æ²¡æœ‰ä»»ä½•è‡ªèº«çš„ DNS è®°å½•ï¼Œä½†æ˜¯å¯å……å½“ä»£è¡¨æ‚¨èŽ·å¾— DNS ä¿¡æ¯çš„ä¸­é—´ç¨‹åºã€‚å¦‚æžœé€’å½’åž‹ DNS æ‹¥æœ‰å·²ç¼“å­˜æˆ–å­˜å‚¨ä¸€æ®µæ—¶é—´çš„ DNS å‚è€ƒï¼Œé‚£ä¹ˆå®ƒä¼šé€šè¿‡æä¾›æºæˆ– IP ä¿¡æ¯æ¥å“åº” DNS æŸ¥è¯¢ã€‚å¦‚æžœæ²¡æœ‰ï¼Œåˆ™å®ƒä¼šå°†æŸ¥è¯¢ä¼ é€’åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæŽˆæƒåž‹ DNS æœåŠ¡å™¨ä»¥æŸ¥æ‰¾ä¿¡æ¯ã€‚ è®°å½•ç±»åž‹ DNS ä¸­ï¼Œå¸¸è§çš„èµ„æºè®°å½•ç±»åž‹æœ‰ï¼š NS è®°å½•ï¼ˆåŸŸåæœåŠ¡ï¼‰ â”€ æŒ‡å®šè§£æžåŸŸåæˆ–å­åŸŸåçš„ DNS æœåŠ¡å™¨ã€‚ MX è®°å½•ï¼ˆé‚®ä»¶äº¤æ¢ï¼‰ â”€ æŒ‡å®šæŽ¥æ”¶ä¿¡æ¯çš„é‚®ä»¶æœåŠ¡å™¨ã€‚ A è®°å½•ï¼ˆåœ°å€ï¼‰ â”€ æŒ‡å®šåŸŸåå¯¹åº”çš„ IPv4 åœ°å€è®°å½•ã€‚ AAAA è®°å½•ï¼ˆåœ°å€ï¼‰ â”€ æŒ‡å®šåŸŸåå¯¹åº”çš„ IPv6 åœ°å€è®°å½•ã€‚ CNAMEï¼ˆè§„èŒƒï¼‰ â”€ ä¸€ä¸ªåŸŸåæ˜ å°„åˆ°å¦ä¸€ä¸ªåŸŸåæˆ– CNAME è®°å½•ï¼ˆ example.com æŒ‡å‘ www.example.com ï¼‰æˆ–æ˜ å°„åˆ°ä¸€ä¸ª Aè®°å½•ã€‚ PTR è®°å½•ï¼ˆåå‘è®°å½•ï¼‰ â”€ PTR è®°å½•ç”¨äºŽå®šä¹‰ä¸Ž IP åœ°å€ç›¸å…³è”çš„åç§°ã€‚ PTR è®°å½•æ˜¯ A æˆ– AAAA è®°å½•çš„é€†ã€‚ PTR è®°å½•æ˜¯å”¯ä¸€çš„ï¼Œå› ä¸ºå®ƒä»¬ä»¥ .arpa æ ¹å¼€å§‹å¹¶è¢«å§”æ´¾ç»™ IP åœ°å€çš„æ‰€æœ‰è€…ã€‚ è¯¦ç»†å¯ä»¥å‚è€ƒï¼šç»´åŸºç™¾ç§‘ - åŸŸåæœåŠ¡å™¨è®°å½•ç±»åž‹åˆ—è¡¨ åŸŸåè§£æž ä¸»æœºååˆ° IP åœ°å€çš„æ˜ å°„æœ‰ä¸¤ç§æ–¹å¼ï¼š é™æ€æ˜ å°„ - åœ¨æœ¬æœºä¸Šé…ç½®åŸŸåå’Œ IP çš„æ˜ å°„ï¼Œæ—¨åœ¨æœ¬æœºä¸Šä½¿ç”¨ã€‚Windows å’Œ Linux çš„ hosts æ–‡ä»¶ä¸­çš„å†…å®¹å°±å±žäºŽé™æ€æ˜ å°„ã€‚ åŠ¨æ€æ˜ å°„ - å»ºç«‹ä¸€å¥—åŸŸåè§£æžç³»ç»Ÿï¼ˆDNSï¼‰ï¼Œåªåœ¨ä¸“é—¨çš„ DNS æœåŠ¡å™¨ä¸Šé…ç½®ä¸»æœºåˆ° IP åœ°å€çš„æ˜ å°„ï¼Œç½‘ç»œä¸Šéœ€è¦ä½¿ç”¨ä¸»æœºåé€šä¿¡çš„è®¾å¤‡ï¼Œé¦–å…ˆéœ€è¦åˆ° DNS æœåŠ¡å™¨æŸ¥è¯¢ä¸»æœºæ‰€å¯¹åº”çš„ IP åœ°å€ã€‚ é€šè¿‡åŸŸååŽ»æŸ¥è¯¢åŸŸåæœåŠ¡å™¨ï¼Œå¾—åˆ° IP åœ°å€çš„è¿‡ç¨‹å«åšåŸŸåè§£æžã€‚åœ¨è§£æžåŸŸåæ—¶ï¼Œä¸€èˆ¬å…ˆé™æ€åŸŸåè§£æžï¼Œå†åŠ¨æ€è§£æžåŸŸåã€‚å¯ä»¥å°†ä¸€äº›å¸¸ç”¨çš„åŸŸåæ”¾å…¥é™æ€åŸŸåè§£æžè¡¨ä¸­ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æé«˜åŸŸåè§£æžæ•ˆçŽ‡ã€‚ ä¸Šå›¾å±•ç¤ºäº†ä¸€ä¸ªåŠ¨æ€åŸŸåè§£æžçš„æµç¨‹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š ç”¨æˆ·æ‰“å¼€ Web æµè§ˆå™¨ï¼Œåœ¨åœ°å€æ ä¸­è¾“å…¥ www.example.comï¼Œç„¶åŽæŒ‰ Enter é”®ã€‚ www.example.com çš„è¯·æ±‚è¢«è·¯ç”±åˆ° DNS è§£æžç¨‹åºï¼Œè¿™ä¸€èˆ¬ç”±ç”¨æˆ·çš„ Internet æœåŠ¡æä¾›å•† (ISP) è¿›è¡Œç®¡ç†ï¼Œä¾‹å¦‚æœ‰çº¿ Internet æœåŠ¡æä¾›å•†ã€DSL å®½å¸¦æä¾›å•†æˆ–å…¬å¸ç½‘ç»œã€‚ ISP çš„ DNS è§£æžç¨‹åºå°† www.example.com çš„è¯·æ±‚è½¬å‘åˆ° DNS æ ¹åç§°æœåŠ¡å™¨ã€‚ ISP çš„ DNS è§£æžç¨‹åºå†æ¬¡è½¬å‘ www.example.com çš„è¯·æ±‚ï¼Œè¿™æ¬¡è½¬å‘åˆ° .com åŸŸçš„ä¸€ä¸ª TLD åç§°æœåŠ¡å™¨ã€‚.com åŸŸçš„åç§°æœåŠ¡å™¨ä½¿ç”¨ä¸Ž example.com åŸŸç›¸å…³çš„å››ä¸ª Amazon Route 53 åç§°æœåŠ¡å™¨çš„åç§°æ¥å“åº”è¯¥è¯·æ±‚ã€‚ ISP çš„ DNS è§£æžç¨‹åºé€‰æ‹©ä¸€ä¸ª Amazon Route 53 åç§°æœåŠ¡å™¨ï¼Œå¹¶å°† www.example.com çš„è¯·æ±‚è½¬å‘åˆ°è¯¥åç§°æœåŠ¡å™¨ã€‚ Amazon Route 53 åç§°æœåŠ¡å™¨åœ¨ example.com æ‰˜ç®¡åŒºåŸŸä¸­æŸ¥æ‰¾ www.example.com è®°å½•ï¼ŒèŽ·å¾—ç›¸å…³å€¼ï¼Œä¾‹å¦‚ï¼ŒWeb æœåŠ¡å™¨çš„ IP åœ°å€ (192.0.2.44)ï¼Œå¹¶å°† IP åœ°å€è¿”å›žè‡³ DNS è§£æžç¨‹åºã€‚ ISP çš„ DNS è§£æžç¨‹åºæœ€ç»ˆèŽ·å¾—ç”¨æˆ·éœ€è¦çš„ IP åœ°å€ã€‚è§£æžç¨‹åºå°†æ­¤å€¼è¿”å›žè‡³ Web æµè§ˆå™¨ã€‚DNS è§£æžç¨‹åºè¿˜ä¼šå°† example.com çš„ IP åœ°å€ç¼“å­˜ (å­˜å‚¨) æ‚¨æŒ‡å®šçš„æ—¶é•¿ï¼Œä»¥ä¾¿å®ƒèƒ½å¤Ÿåœ¨ä¸‹æ¬¡æœ‰äººæµè§ˆ example.com æ—¶æ›´å¿«åœ°ä½œå‡ºå“åº”ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…å­˜æ´»æœŸ (TTL)ã€‚ Web æµè§ˆå™¨å°† www.example.com çš„è¯·æ±‚å‘é€åˆ°ä»Ž DNS è§£æžç¨‹åºä¸­èŽ·å¾—çš„ IP åœ°å€ã€‚è¿™æ˜¯æ‚¨çš„å†…å®¹æ‰€å¤„ä½ç½®ï¼Œä¾‹å¦‚ï¼Œåœ¨ Amazon EC2 å®žä¾‹ä¸­æˆ–é…ç½®ä¸ºç½‘ç«™ç»ˆç«¯èŠ‚ç‚¹çš„ Amazon S3 å­˜å‚¨æ¡¶ä¸­è¿è¡Œçš„ Web æœåŠ¡å™¨ã€‚ 192.0.2.44 ä¸Šçš„ Web æœåŠ¡å™¨æˆ–å…¶ä»–èµ„æºå°† www.example.com çš„ Web é¡µé¢è¿”å›žåˆ° Web æµè§ˆå™¨ï¼Œä¸” Web æµè§ˆå™¨ä¼šæ˜¾ç¤ºè¯¥é¡µé¢ã€‚ ðŸ”” æ³¨æ„ï¼šåªæœ‰é…ç½®äº†åŸŸåæœåŠ¡å™¨ï¼Œæ‰èƒ½æ‰§è¡ŒåŸŸåè§£æžã€‚ ä¾‹å¦‚ï¼Œåœ¨ Linux ä¸­æ‰§è¡Œ vim /etc/resolv.conf å‘½ä»¤ï¼Œåœ¨å…¶ä¸­æ·»åŠ ä¸‹é¢çš„å†…å®¹æ¥é…ç½®åŸŸåæœåŠ¡å™¨åœ°å€ï¼š &gt; nameserver 218.2.135.1&gt; Linux ä¸Šçš„åŸŸåç›¸å…³å‘½ä»¤ hostname hostname å‘½ä»¤ç”¨äºŽæŸ¥çœ‹å’Œè®¾ç½®ç³»ç»Ÿçš„ä¸»æœºåç§°ã€‚çŽ¯å¢ƒå˜é‡ HOSTNAME ä¹Ÿä¿å­˜äº†å½“å‰çš„ä¸»æœºåã€‚åœ¨ä½¿ç”¨ hostname å‘½ä»¤è®¾ç½®ä¸»æœºååŽï¼Œç³»ç»Ÿå¹¶ä¸ä¼šæ°¸ä¹…ä¿å­˜æ–°çš„ä¸»æœºåï¼Œé‡æ–°å¯åŠ¨æœºå™¨ä¹‹åŽè¿˜æ˜¯åŽŸæ¥çš„ä¸»æœºåã€‚å¦‚æžœéœ€è¦æ°¸ä¹…ä¿®æ”¹ä¸»æœºåï¼Œéœ€è¦åŒæ—¶ä¿®æ”¹ /etc/hosts å’Œ /etc/sysconfig/network çš„ç›¸å…³å†…å®¹ã€‚ å‚è€ƒï¼šhttp://man.linuxde.net/hostname ç¤ºä¾‹ï¼š $ hostnameAY1307311912260196fcZ nslookup nslookup å‘½ä»¤æ˜¯å¸¸ç”¨åŸŸåæŸ¥è¯¢å·¥å…·ï¼Œå°±æ˜¯æŸ¥ DNS ä¿¡æ¯ç”¨çš„å‘½ä»¤ã€‚ å‚è€ƒï¼šhttp://man.linuxde.net/nslookup ç¤ºä¾‹ï¼š [root@localhost ~]# nslookup www.jsdig.comServer: 202.96.104.15Address: 202.96.104.15#53Non-authoritative answer:www.jsdig.com canonical name = host.1.jsdig.com.Name: host.1.jsdig.comAddress: 100.42.212.8 æ›´å¤šå†…å®¹ ç»´åŸºç™¾ç§‘ - åŸŸå ç»´åŸºç™¾ç§‘ - åŸŸåç³»ç»Ÿ ç»´åŸºç™¾ç§‘ - åŸŸåæœåŠ¡å™¨è®°å½•ç±»åž‹åˆ—è¡¨ ä»€ä¹ˆæ˜¯ DNSï¼Ÿ RFC 1034 RFC 1035]]></content>
      <categories>
        <category>communication</category>
      </categories>
      <tags>
        <tag>communication</tag>
        <tag>network</tag>
        <tag>protocol</tag>
        <tag>application</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢]]></title>
    <url>%2Fblog%2F2018%2F10%2F13%2Fdesign%2Frefactor%2F%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E5%8F%98%E9%9D%A9%E7%9A%84%E9%9A%9C%E7%A2%8D%2F</url>
    <content type="text"><![CDATA[ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ ç¿»è¯‘è‡ªï¼šhttps://sourcemaking.com/refactoring/smells/change-preventers å˜é©çš„éšœç¢(Change Preventers)è¿™ç»„åå‘³é“æ„å‘³ç€ï¼šå½“ä½ éœ€è¦æ”¹å˜ä¸€å¤„ä»£ç æ—¶ï¼Œå´å‘çŽ°ä¸å¾—ä¸æ”¹å˜å…¶ä»–çš„åœ°æ–¹ã€‚è¿™ä½¿å¾—ç¨‹åºå¼€å‘å˜å¾—å¤æ‚ã€ä»£ä»·é«˜æ˜‚ã€‚ å‘æ•£å¼å˜åŒ– å¹³è¡Œç»§æ‰¿ä½“ç³» éœ°å¼¹å¼ä¿®æ”¹ æ‰©å±•é˜…è¯» å‚è€ƒèµ„æ–™ å‘æ•£å¼å˜åŒ– å‘æ•£å¼å˜åŒ–(Divergent Change) ç±»ä¼¼äºŽ éœ°å¼¹å¼ä¿®æ”¹(Shotgun Surgery) ï¼Œä½†å®žé™…ä¸Šå®Œå…¨ä¸åŒã€‚å‘æ•£å¼å˜åŒ–(Divergent Change) æ˜¯æŒ‡ä¸€ä¸ªç±»å—å¤šç§å˜åŒ–çš„å½±å“ã€‚éœ°å¼¹å¼ä¿®æ”¹(Shotgun Surgery) æ˜¯æŒ‡å¤šç§å˜åŒ–å¼•å‘å¤šä¸ªç±»ç›¸åº”çš„ä¿®æ”¹ã€‚ ç‰¹å¾ ä½ å‘çŽ°ä½ æƒ³è¦ä¿®æ”¹ä¸€ä¸ªå‡½æ•°ï¼Œå´å¿…é¡»è¦åŒæ—¶ä¿®æ”¹è®¸å¤šä¸ç›¸å…³çš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå½“ä½ æƒ³è¦æ·»åŠ ä¸€ä¸ªæ–°çš„äº§å“ç±»åž‹æ—¶ï¼Œä½ éœ€è¦åŒæ­¥ä¿®æ”¹å¯¹äº§å“è¿›è¡ŒæŸ¥æ‰¾ã€æ˜¾ç¤ºã€æŽ’åºçš„å‡½æ•°ã€‚ é—®é¢˜åŽŸå›  é€šå¸¸ï¼Œè¿™ç§å‘æ•£å¼ä¿®æ”¹æ˜¯ç”±äºŽç¼–ç¨‹ç»“æž„ä¸åˆç†æˆ–è€…â€œå¤åˆ¶-ç²˜è´´å¼ç¼–ç¨‹â€ã€‚ è§£å†³åŠžæ³• è¿ç”¨ æç‚¼ç±»(Extract Class) æ‹†åˆ†ç±»çš„è¡Œä¸ºã€‚ æ”¶ç›Š æé«˜ä»£ç ç»„ç»‡ç»“æž„ å‡å°‘é‡å¤ä»£ç  é‡æž„æ–¹æ³•è¯´æ˜Ž æç‚¼ç±»(Extract Class) é—®é¢˜ æŸä¸ªç±»åšäº†ä¸æ­¢ä¸€ä»¶äº‹ã€‚ è§£å†³ å»ºç«‹ä¸€ä¸ªæ–°ç±»ï¼Œå°†ç›¸å…³çš„å­—æ®µå’Œå‡½æ•°ä»Žæ—§ç±»æ¬ç§»åˆ°æ–°ç±»ã€‚ å¹³è¡Œç»§æ‰¿ä½“ç³» å¹³è¡Œç»§æ‰¿ä½“ç³»(Parallel Inheritance Hierarchies) å…¶å®žæ˜¯ éœ°å¼¹å¼ä¿®æ”¹(Shotgun Surgery) çš„ç‰¹æ®Šæƒ…å†µã€‚ ç‰¹å¾ æ¯å½“ä½ ä¸ºæŸä¸ªç±»æ·»åŠ ä¸€ä¸ªå­ç±»ï¼Œå¿…é¡»åŒæ—¶ä¸ºå¦ä¸€ä¸ªç±»ç›¸åº”æ·»åŠ ä¸€ä¸ªå­ç±»ã€‚è¿™ç§æƒ…å†µçš„å…¸åž‹ç‰¹å¾æ˜¯ï¼šæŸä¸ªç»§æ‰¿ä½“ç³»çš„ç±»åå‰ç¼€æˆ–ç±»ååŽç¼€å®Œå…¨ç›¸åŒã€‚ é—®é¢˜åŽŸå›  èµ·åˆçš„ç»§æ‰¿ä½“ç³»å¾ˆå°ï¼Œéšç€ä¸æ–­æ·»åŠ æ–°ç±»ï¼Œç»§æ‰¿ä½“ç³»è¶Šæ¥è¶Šå¤§ï¼Œä¹Ÿè¶Šæ¥è¶Šéš¾ä¿®æ”¹ã€‚ è§£å†³æ–¹æ³• ä¸€èˆ¬ç­–ç•¥æ˜¯ï¼šè®©ä¸€ä¸ªç»§æ‰¿ä½“ç³»çš„å®žä¾‹å¼•ç”¨å¦ä¸€ä¸ªç»§æ‰¿ä½“ç³»çš„å®žä¾‹ã€‚å¦‚æžœå†æŽ¥å†åŽ‰è¿ç”¨ æ¬ç§»å‡½æ•°(Move Method) å’Œ æ¬ç§»å­—æ®µ(Move Field)ï¼Œå°±å¯ä»¥æ¶ˆé™¤å¼•ç”¨ç«¯çš„ç»§æ‰¿ä½“ç³»ã€‚ æ”¶ç›Š æ›´å¥½çš„ä»£ç ç»„ç»‡ å‡å°‘é‡å¤ä»£ç  ä½•æ—¶å¿½ç•¥ æœ‰æ—¶å…·æœ‰å¹¶è¡Œç±»å±‚æ¬¡ç»“æž„åªæ˜¯ä¸€ç§ä¸ºäº†é¿å…ç¨‹åºä½“ç³»ç»“æž„æ›´æ··ä¹±çš„æ–¹æ³•ã€‚å¦‚æžœä½ å‘çŽ°å°è¯•æ¶ˆé™¤å¹³è¡Œç»§æ‰¿ä½“ç³»å¯¼è‡´ä»£ç æ›´åŠ ä¸‘é™‹ï¼Œé‚£ä¹ˆä½ åº”è¯¥å›žæ»šä½ çš„ä¿®æ”¹ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž æ¬ç§»å‡½æ•°(Move Method) é—®é¢˜ ä½ çš„ç¨‹åºä¸­ï¼Œæœ‰ä¸ªå‡½æ•°ä¸Žå…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»è¿›è¡Œæ›´å¤šäº¤æµï¼šè°ƒç”¨åŽè€…ï¼Œæˆ–è¢«åŽè€…è°ƒç”¨ã€‚ è§£å†³ åœ¨è¯¥å‡½æ•°æœ€å¸¸å¼•ç”¨çš„ç±»ä¸­å»ºç«‹ä¸€ä¸ªæœ‰ç€ç±»ä¼¼è¡Œä¸ºçš„æ–°å‡½æ•°ã€‚å°†æ—§å‡½æ•°å˜æˆä¸€ä¸ªå•çº¯çš„å§”æ‰˜å‡½æ•°ï¼Œæˆ–æ˜¯æ—§å‡½æ•°å®Œå…¨ç§»é™¤ã€‚ æ¬ç§»å­—æ®µ(Move Field) é—®é¢˜ åœ¨ä½ çš„ç¨‹åºä¸­ï¼ŒæŸä¸ªå­—æ®µè¢«å…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»æ›´å¤šåœ°ç”¨åˆ°ã€‚ è§£å†³ åœ¨ç›®æ ‡ç±»æ–°å»ºä¸€ä¸ªå­—æ®µï¼Œä¿®æ”¹æºå­—æ®µçš„æ‰€æœ‰ç”¨æˆ·ï¼Œä»¤ä»–ä»¬æ”¹ç”¨æ–°å­—æ®µã€‚ éœ°å¼¹å¼ä¿®æ”¹ éœ°å¼¹å¼ä¿®æ”¹(Shotgun Surgery) ç±»ä¼¼äºŽ å‘æ•£å¼å˜åŒ–(Divergent Change) ï¼Œä½†å®žé™…ä¸Šå®Œå…¨ä¸åŒã€‚å‘æ•£å¼å˜åŒ–(Divergent Change) æ˜¯æŒ‡ä¸€ä¸ªç±»å—å¤šç§å˜åŒ–çš„å½±å“ã€‚éœ°å¼¹å¼ä¿®æ”¹(Shotgun Surgery) æ˜¯æŒ‡å¤šç§å˜åŒ–å¼•å‘å¤šä¸ªç±»ç›¸åº”çš„ä¿®æ”¹ã€‚ ç‰¹å¾ ä»»ä½•ä¿®æ”¹éƒ½éœ€è¦åœ¨è®¸å¤šä¸åŒç±»ä¸Šåšå°å¹…åº¦ä¿®æ”¹ã€‚ é—®é¢˜åŽŸå›  ä¸€ä¸ªå•ä¸€çš„èŒè´£è¢«æ‹†åˆ†æˆå¤§é‡çš„ç±»ã€‚ è§£å†³æ–¹æ³• è¿ç”¨æ¬ç§»å‡½æ•°(Move Method) å’Œ æ¬ç§»å­—æ®µ(Move Field) æ¥æ¬ç§»ä¸åŒç±»ä¸­ç›¸åŒçš„è¡Œä¸ºåˆ°ä¸€ä¸ªç‹¬ç«‹ç±»ä¸­ã€‚å¦‚æžœæ²¡æœ‰é€‚åˆå­˜æ”¾æ¬ç§»å‡½æ•°æˆ–å­—æ®µçš„ç±»ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°ç±»ã€‚ é€šå¸¸ï¼Œå¯ä»¥è¿ç”¨ å°†ç±»å†…è”åŒ–(Inline Class) å°†ä¸€äº›åˆ—ç›¸å…³è¡Œä¸ºæ”¾è¿›åŒä¸€ä¸ªç±»ã€‚ æ”¶ç›Š æ›´å¥½çš„ä»£ç ç»„ç»‡ å‡å°‘é‡å¤ä»£ç  æ›´æ˜“ç»´æŠ¤ é‡æž„æ–¹æ³•è¯´æ˜Ž æ¬ç§»å‡½æ•°(Move Method) é—®é¢˜ ä½ çš„ç¨‹åºä¸­ï¼Œæœ‰ä¸ªå‡½æ•°ä¸Žå…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»è¿›è¡Œæ›´å¤šäº¤æµï¼šè°ƒç”¨åŽè€…ï¼Œæˆ–è¢«åŽè€…è°ƒç”¨ã€‚ è§£å†³ åœ¨è¯¥å‡½æ•°æœ€å¸¸å¼•ç”¨çš„ç±»ä¸­å»ºç«‹ä¸€ä¸ªæœ‰ç€ç±»ä¼¼è¡Œä¸ºçš„æ–°å‡½æ•°ã€‚å°†æ—§å‡½æ•°å˜æˆä¸€ä¸ªå•çº¯çš„å§”æ‰˜å‡½æ•°ï¼Œæˆ–æ˜¯æ—§å‡½æ•°å®Œå…¨ç§»é™¤ã€‚ æ¬ç§»å­—æ®µ(Move Field) é—®é¢˜ åœ¨ä½ çš„ç¨‹åºä¸­ï¼ŒæŸä¸ªå­—æ®µè¢«å…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»æ›´å¤šåœ°ç”¨åˆ°ã€‚ è§£å†³ åœ¨ç›®æ ‡ç±»æ–°å»ºä¸€ä¸ªå­—æ®µï¼Œä¿®æ”¹æºå­—æ®µçš„æ‰€æœ‰ç”¨æˆ·ï¼Œä»¤ä»–ä»¬æ”¹ç”¨æ–°å­—æ®µã€‚ å°†ç±»å†…è”åŒ–(Inline Class) é—®é¢˜ æŸä¸ªç±»æ²¡æœ‰åšå¤ªå¤šäº‹æƒ…ã€‚ è§£å†³ å°†è¿™ä¸ªç±»çš„æ‰€æœ‰ç‰¹æ€§æ¬ç§»åˆ°å¦ä¸€ä¸ªç±»ä¸­ï¼Œç„¶åŽç§»é™¤åŽŸç±»ã€‚ æ‰©å±•é˜…è¯» ä»£ç çš„åå‘³é“å’Œé‡æž„ ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿ ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡ ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢ ä»£ç åå‘³é“ä¹‹éžå¿…è¦çš„ ä»£ç åå‘³é“ä¹‹è€¦åˆ å‚è€ƒèµ„æ–™ é‡æž„â€”â€”æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ - by Martin Fowler https://sourcemaking.com/refactoring]]></content>
      <categories>
        <category>design</category>
        <category>refactor</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>refactor</tag>
        <tag>code-smell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»£ç åå‘³é“ä¹‹éžå¿…è¦çš„]]></title>
    <url>%2Fblog%2F2018%2F10%2F13%2Fdesign%2Frefactor%2F%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E9%9D%9E%E5%BF%85%E8%A6%81%E7%9A%84%2F</url>
    <content type="text"><![CDATA[ä»£ç åå‘³é“ä¹‹éžå¿…è¦çš„ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ ç¿»è¯‘è‡ªï¼šhttps://sourcemaking.com/refactoring/smells/dispensables éžå¿…è¦çš„(Dispensables)è¿™ç»„åå‘³é“æ„å‘³ç€ï¼šè¿™æ ·çš„ä»£ç å¯æœ‰å¯æ— ï¼Œå®ƒçš„å­˜åœ¨åè€Œå½±å“æ•´ä½“ä»£ç çš„æ•´æ´å’Œå¯è¯»æ€§ã€‚ å†—ä½™ç±» å¤¸å¤¸å…¶è°ˆæœªæ¥æ€§ çº¯ç¨šçš„æ•°æ®ç±» è¿‡å¤šçš„æ³¨é‡Š é‡å¤ä»£ç  æ‰©å±•é˜…è¯» å‚è€ƒèµ„æ–™ å†—ä½™ç±» å†—ä½™ç±»(Lazy Class) ç†è§£å’Œç»´æŠ¤æ€»æ˜¯è´¹æ—¶è´¹åŠ›çš„ã€‚å¦‚æžœä¸€ä¸ªç±»ä¸å€¼å¾—ä½ èŠ±è´¹ç²¾åŠ›ï¼Œå®ƒå°±åº”è¯¥è¢«åˆ é™¤ã€‚ é—®é¢˜åŽŸå›  ä¹Ÿè®¸ä¸€ä¸ªç±»çš„åˆå§‹è®¾è®¡æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå…¨çš„ç±»ï¼Œç„¶è€Œéšç€ä»£ç çš„å˜è¿ï¼Œå˜å¾—æ²¡ä»€ä¹ˆç”¨äº†ã€‚ åˆæˆ–è€…ç±»èµ·åˆçš„è®¾è®¡æ˜¯ä¸ºäº†æ”¯æŒæœªæ¥çš„åŠŸèƒ½æ‰©å±•ï¼Œç„¶è€Œå´ä¸€ç›´æœªæ´¾ä¸Šç”¨åœºã€‚ è§£å†³æ–¹æ³• æ²¡ä»€ä¹ˆç”¨çš„ç±»å¯ä»¥è¿ç”¨ å°†ç±»å†…è”åŒ–(Inline Class) æ¥å¹²æŽ‰ã€‚ å¦‚æžœå­ç±»ç”¨å¤„ä¸å¤§ï¼Œè¯•è¯• æŠ˜å ç»§æ‰¿ä½“ç³»(Collapse Hierarchy) ã€‚ æ”¶ç›Š å‡å°‘ä»£ç é‡ æ˜“äºŽç»´æŠ¤ ä½•æ—¶å¿½ç•¥ æœ‰æ—¶ï¼Œåˆ›å»ºå†—ä½™ç±»æ˜¯ä¸ºäº†æè¿°æœªæ¥å¼€å‘çš„æ„å›¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°è¯•åœ¨ä»£ç ä¸­ä¿æŒæ¸…æ™°å’Œç®€å•ä¹‹é—´çš„å¹³è¡¡ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž å°†ç±»å†…è”åŒ–(Inline Class) é—®é¢˜ æŸä¸ªç±»æ²¡æœ‰åšå¤ªå¤šäº‹æƒ…ã€‚ è§£å†³ å°†è¿™ä¸ªç±»çš„æ‰€æœ‰ç‰¹æ€§æ¬ç§»åˆ°å¦ä¸€ä¸ªç±»ä¸­ï¼Œç„¶åŽç§»é™¤åŽŸç±»ã€‚ æŠ˜å ç»§æ‰¿ä½“ç³»(Collapse Hierarchy) é—®é¢˜ è¶…ç±»å’Œå­ç±»ä¹‹é—´æ— å¤ªå¤§åŒºåˆ«ã€‚ è§£å†³ å°†å®ƒä»¬åˆä¸ºä¸€ä½“ã€‚ å¤¸å¤¸å…¶è°ˆæœªæ¥æ€§ å¤¸å¤¸å…¶è°ˆæœªæ¥æ€§(Speculative Generality) å­˜åœ¨æœªè¢«ä½¿ç”¨çš„ç±»ã€å‡½æ•°ã€å­—æ®µæˆ–å‚æ•°ã€‚ é—®é¢˜åŽŸå›  æœ‰æ—¶ï¼Œä»£ç ä»…ä»…ä¸ºäº†æ”¯æŒæœªæ¥çš„ç‰¹æ€§è€Œäº§ç”Ÿï¼Œç„¶è€Œå´ä¸€ç›´æœªå®žçŽ°ã€‚ç»“æžœï¼Œä»£ç å˜å¾—éš¾ä»¥ç†è§£å’Œç»´æŠ¤ã€‚ è§£å†³æ–¹æ³• å¦‚æžœä½ çš„æŸä¸ªæŠ½è±¡ç±»å…¶å®žæ²¡æœ‰å¤ªå¤§ä½œç”¨ï¼Œè¯·è¿ç”¨ æŠ˜å ç»§æ‰¿ä½“ç³»(Collapse Hierarch) ã€‚ ä¸å¿…è¦çš„å§”æ‰˜å¯è¿ç”¨ å°†ç±»å†…è”åŒ–(Inline Class) æ¶ˆé™¤ã€‚ æ— ç”¨çš„å‡½æ•°å¯è¿ç”¨ å†…è”å‡½æ•°(Inline Method) æ¶ˆé™¤ã€‚ å‡½æ•°ä¸­æœ‰æ— ç”¨çš„å‚æ•°åº”è¯¥è¿ç”¨ ç§»é™¤å‚æ•°(Remove Parameter) æ¶ˆé™¤ã€‚ æ— ç”¨å­—æ®µå¯ä»¥ç›´æŽ¥åˆ é™¤ã€‚ æ”¶ç›Š å‡å°‘ä»£ç é‡ã€‚ æ›´æ˜“ç»´æŠ¤ã€‚ ä½•æ—¶å¿½ç•¥ å¦‚æžœä½ åœ¨ä¸€ä¸ªæ¡†æž¶ä¸Šå·¥ä½œï¼Œåˆ›å»ºæ¡†æž¶æœ¬èº«æ²¡æœ‰ä½¿ç”¨çš„åŠŸèƒ½æ˜¯éžå¸¸åˆç†çš„ï¼Œåªè¦æ¡†æž¶çš„ç”¨æˆ·éœ€è¦è¿™ä¸ªåŠŸèƒ½ã€‚ åˆ é™¤å…ƒç´ ä¹‹å‰ï¼Œè¯·ç¡®ä¿å®ƒä»¬ä¸åœ¨å•å…ƒæµ‹è¯•ä¸­ä½¿ç”¨ã€‚å¦‚æžœæµ‹è¯•éœ€è¦ä»Žç±»ä¸­èŽ·å–æŸäº›å†…éƒ¨ä¿¡æ¯æˆ–æ‰§è¡Œç‰¹æ®Šçš„æµ‹è¯•ç›¸å…³æ“ä½œï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž æŠ˜å ç»§æ‰¿ä½“ç³»(Collapse Hierarchy) é—®é¢˜ è¶…ç±»å’Œå­ç±»ä¹‹é—´æ— å¤ªå¤§åŒºåˆ«ã€‚ è§£å†³ å°†å®ƒä»¬åˆä¸ºä¸€ä½“ã€‚ å°†ç±»å†…è”åŒ–(Inline Class) é—®é¢˜ æŸä¸ªç±»æ²¡æœ‰åšå¤ªå¤šäº‹æƒ…ã€‚ è§£å†³ å°†è¿™ä¸ªç±»çš„æ‰€æœ‰ç‰¹æ€§æ¬ç§»åˆ°å¦ä¸€ä¸ªç±»ä¸­ï¼Œç„¶åŽç§»é™¤åŽŸç±»ã€‚ å†…è”å‡½æ•°(Inline Method) é—®é¢˜ ä¸€ä¸ªå‡½æ•°çš„æœ¬ä½“æ¯”å‡½æ•°åæ›´æ¸…æ¥šæ˜“æ‡‚ã€‚ class PizzaDelivery &#123; //... int getRating() &#123; return moreThanFiveLateDeliveries() ? 2 : 1; &#125; boolean moreThanFiveLateDeliveries() &#123; return numberOfLateDeliveries &gt; 5; &#125;&#125; è§£å†³ åœ¨å‡½æ•°è°ƒç”¨ç‚¹æ’å…¥å‡½æ•°æœ¬ä½“ï¼Œç„¶åŽç§»é™¤è¯¥å‡½æ•°ã€‚ class PizzaDelivery &#123; //... int getRating() &#123; return numberOfLateDeliveries &gt; 5 ? 2 : 1; &#125;&#125; ç§»é™¤å‚æ•°(Remove Parameter) é—®é¢˜ å‡½æ•°æœ¬ä½“ä¸å†éœ€è¦æŸä¸ªå‚æ•°ã€‚ è§£å†³ å°†è¯¥å‚æ•°åŽ»é™¤ã€‚ çº¯ç¨šçš„æ•°æ®ç±» çº¯ç¨šçš„æ•°æ®ç±»(Data Class) æŒ‡çš„æ˜¯åªåŒ…å«å­—æ®µå’Œè®¿é—®å®ƒä»¬çš„ getter å’Œ setter å‡½æ•°çš„ç±»ã€‚è¿™äº›ä»…ä»…æ˜¯ä¾›å…¶ä»–ç±»ä½¿ç”¨çš„æ•°æ®å®¹å™¨ã€‚è¿™äº›ç±»ä¸åŒ…å«ä»»ä½•é™„åŠ åŠŸèƒ½ï¼Œå¹¶ä¸”ä¸èƒ½å¯¹è‡ªå·±æ‹¥æœ‰çš„æ•°æ®è¿›è¡Œç‹¬ç«‹æ“ä½œã€‚ é—®é¢˜åŽŸå›  å½“ä¸€ä¸ªæ–°åˆ›å»ºçš„ç±»åªåŒ…å«å‡ ä¸ªå…¬å…±å­—æ®µï¼ˆç”šè‡³å¯èƒ½å‡ ä¸ª getters / settersï¼‰æ˜¯å¾ˆæ­£å¸¸çš„ã€‚ä½†æ˜¯å¯¹è±¡çš„çœŸæ­£åŠ›é‡åœ¨äºŽå®ƒä»¬å¯ä»¥åŒ…å«ä½œç”¨äºŽæ•°æ®çš„è¡Œä¸ºç±»åž‹æˆ–æ“ä½œã€‚ è§£å†³æ–¹æ³• å¦‚æžœä¸€ä¸ªç±»æœ‰å…¬å…±å­—æ®µï¼Œä½ åº”è¯¥è¿ç”¨ å°è£…å­—æ®µ(Encapsulated Field) æ¥éšè—å­—æ®µçš„ç›´æŽ¥è®¿é—®æ–¹å¼ã€‚ å¦‚æžœè¿™äº›ç±»å«å®¹å™¨ç±»çš„å­—æ®µï¼Œä½ åº”è¯¥æ£€æŸ¥å®ƒä»¬æ˜¯ä¸æ˜¯å¾—åˆ°äº†æ°å½“çš„å°è£…ï¼›å¦‚æžœæ²¡æœ‰ï¼Œå°±è¿ç”¨ å°è£…é›†åˆ(Encapsulated Collection) æŠŠå®ƒä»¬å°è£…èµ·æ¥ã€‚ æ‰¾å‡ºè¿™äº› getter/setter å‡½æ•°è¢«å…¶ä»–ç±»è¿ç”¨çš„åœ°ç‚¹ã€‚å°è¯•ä»¥ æ¬ç§»å‡½æ•°(Move Method) æŠŠé‚£äº›è°ƒç”¨è¡Œä¸ºæ¬ç§»åˆ° çº¯ç¨šçš„æ•°æ®ç±»(Data Class) æ¥ã€‚å¦‚æžœæ— æ³•æ¬ç§»è¿™ä¸ªå‡½æ•°ï¼Œå°±è¿ç”¨ æç‚¼å‡½æ•°(Extract Method) äº§ç”Ÿä¸€ä¸ªå¯æ¬ç§»çš„å‡½æ•°ã€‚ åœ¨ç±»å·²ç»å……æ»¡äº†æ·±æ€ç†Ÿè™‘çš„å‡½æ•°ä¹‹åŽï¼Œä½ å¯èƒ½æƒ³è¦æ‘†è„±æ—§çš„æ•°æ®è®¿é—®æ–¹æ³•ï¼Œä»¥æä¾›é€‚åº”é¢è¾ƒå¹¿çš„ç±»æ•°æ®è®¿é—®æŽ¥å£ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥è¿ç”¨ ç§»é™¤è®¾ç½®å‡½æ•°(Remove Setting Method) å’Œ éšè—å‡½æ•°(Hide Method) ã€‚ æ”¶ç›Š æé«˜ä»£ç çš„å¯è¯»æ€§å’Œç»„ç»‡æ€§ã€‚ç‰¹å®šæ•°æ®çš„æ“ä½œçŽ°åœ¨è¢«é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œè€Œä¸æ˜¯åœ¨åˆ†æ•£åœ¨ä»£ç å„å¤„ã€‚ å¸®åŠ©ä½ å‘çŽ°å®¢æˆ·ç«¯ä»£ç çš„é‡å¤å¤„ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž å°è£…å­—æ®µ(Encapsulated Field) é—®é¢˜ ä½ çš„ç±»ä¸­å­˜åœ¨ public å­—æ®µã€‚ class Person &#123; public String name;&#125; è§£å†³ å°†å®ƒå£°æ˜Žä¸º privateï¼Œå¹¶æä¾›ç›¸åº”çš„è®¿é—®å‡½æ•°ã€‚ class Person &#123; private String name; public String getName() &#123; return name; &#125; public void setName(String arg) &#123; name = arg; &#125;&#125; å°è£…é›†åˆ(Encapsulated Collection) é—®é¢˜ æœ‰ä¸ªå‡½æ•°è¿”å›žä¸€ä¸ªé›†åˆã€‚ è§£å†³ è®©è¯¥å‡½æ•°è¿”å›žè¯¥é›†åˆçš„ä¸€ä¸ªåªè¯»å‰¯æœ¬ï¼Œå¹¶åœ¨è¿™ä¸ªç±»ä¸­æä¾›æ·»åŠ ã€ç§»é™¤é›†åˆå…ƒç´ çš„å‡½æ•°ã€‚ æ¬ç§»å‡½æ•°(Move Method) é—®é¢˜ ä½ çš„ç¨‹åºä¸­ï¼Œæœ‰ä¸ªå‡½æ•°ä¸Žå…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»è¿›è¡Œæ›´å¤šäº¤æµï¼šè°ƒç”¨åŽè€…ï¼Œæˆ–è¢«åŽè€…è°ƒç”¨ã€‚ è§£å†³ åœ¨è¯¥å‡½æ•°æœ€å¸¸å¼•ç”¨çš„ç±»ä¸­å»ºç«‹ä¸€ä¸ªæœ‰ç€ç±»ä¼¼è¡Œä¸ºçš„æ–°å‡½æ•°ã€‚å°†æ—§å‡½æ•°å˜æˆä¸€ä¸ªå•çº¯çš„å§”æ‰˜å‡½æ•°ï¼Œæˆ–æ˜¯æ—§å‡½æ•°å®Œå…¨ç§»é™¤ã€‚ æç‚¼å‡½æ•°(Extract Method) é—®é¢˜ ä½ æœ‰ä¸€æ®µä»£ç å¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ã€‚ void printOwing() &#123; printBanner(); //print details System.out.println("name: " + name); System.out.println("amount: " + getOutstanding());&#125; è§£å†³ ç§»åŠ¨è¿™æ®µä»£ç åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•°ä¸­ï¼Œä½¿ç”¨å‡½æ•°çš„è°ƒç”¨æ¥æ›¿ä»£è€ä»£ç ã€‚ void printOwing() &#123; printBanner(); printDetails(getOutstanding());&#125;void printDetails(double outstanding) &#123; System.out.println("name: " + name); System.out.println("amount: " + outstanding);&#125; ç§»é™¤è®¾ç½®å‡½æ•°(Remove Setting Method) é—®é¢˜ ç±»ä¸­çš„æŸä¸ªå­—æ®µåº”è¯¥åœ¨å¯¹è±¡åˆ›å»ºæ—¶è¢«è®¾å€¼ï¼Œç„¶åŽå°±ä¸å†æ”¹å˜ã€‚ è§£å†³ åŽ»æŽ‰è¯¥å­—æ®µçš„æ‰€æœ‰è®¾å€¼å‡½æ•°ã€‚ éšè—å‡½æ•°(Hide Method) é—®é¢˜ æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œä»Žæ¥æ²¡æœ‰è¢«å…¶ä»–ä»»ä½•ç±»ç”¨åˆ°ã€‚ è§£å†³ å°†è¿™ä¸ªå‡½æ•°ä¿®æ”¹ä¸º privateã€‚ è¿‡å¤šçš„æ³¨é‡Š è¿‡å¤šçš„æ³¨é‡Š(Comments) æ³¨é‡Šæœ¬èº«å¹¶ä¸æ˜¯åäº‹ã€‚ä½†æ˜¯å¸¸å¸¸æœ‰è¿™æ ·çš„æƒ…å†µï¼šä¸€æ®µä»£ç ä¸­å‡ºçŽ°é•¿é•¿çš„æ³¨é‡Šï¼Œè€Œå®ƒä¹‹æ‰€ä»¥å­˜åœ¨ï¼Œæ˜¯å› ä¸ºä»£ç å¾ˆç³Ÿç³•ã€‚ é—®é¢˜åŽŸå›  æ³¨é‡Šçš„ä½œè€…æ„è¯†åˆ°è‡ªå·±çš„ä»£ç ä¸ç›´è§‚æˆ–ä¸æ˜Žæ˜¾ï¼Œæ‰€ä»¥æƒ³ä½¿ç”¨æ³¨é‡Šæ¥è¯´æ˜Žè‡ªå·±çš„æ„å›¾ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ³¨é‡Šå°±åƒæ˜¯çƒ‚ä»£ç çš„é™¤è‡­å‰‚ã€‚ æœ€å¥½çš„æ³¨é‡Šæ˜¯ä¸ºå‡½æ•°æˆ–ç±»èµ·ä¸€ä¸ªæ°å½“çš„åå­—ã€‚ å¦‚æžœä½ è§‰å¾—ä¸€ä¸ªä»£ç ç‰‡æ®µæ²¡æœ‰æ³¨é‡Šå°±æ— æ³•ç†è§£ï¼Œè¯·å…ˆå°è¯•é‡æž„ï¼Œè¯•ç€è®©æ‰€æœ‰æ³¨é‡Šéƒ½å˜å¾—å¤šä½™ã€‚ è§£å†³æ–¹æ³• å¦‚æžœä¸€ä¸ªæ³¨é‡Šæ˜¯ä¸ºäº†è§£é‡Šä¸€ä¸ªå¤æ‚çš„è¡¨è¾¾å¼ï¼Œå¯ä»¥è¿ç”¨ æç‚¼å˜é‡(Extract Variable) å°†è¡¨è¾¾å¼åˆ‡åˆ†ä¸ºæ˜“ç†è§£çš„å­è¡¨è¾¾å¼ã€‚ å¦‚æžœä½ éœ€è¦é€šè¿‡æ³¨é‡Šæ¥è§£é‡Šä¸€æ®µä»£ç åšäº†ä»€ä¹ˆï¼Œè¯·è¯•è¯• æç‚¼å‡½æ•°(Extract Method) ã€‚ å¦‚æžœå‡½æ•°å·²ç»è¢«æç‚¼ï¼Œä½†ä»éœ€è¦æ³¨é‡Šå‡½æ•°åšäº†ä»€ä¹ˆï¼Œè¯•è¯•è¿ç”¨ å‡½æ•°æ”¹å(Rename Method) æ¥ä¸ºå‡½æ•°èµ·ä¸€ä¸ªå¯ä»¥è‡ªè§£é‡Šçš„åå­—ã€‚ å¦‚æžœéœ€è¦å¯¹ç³»ç»ŸæŸçŠ¶æ€è¿›è¡Œæ–­è¨€ï¼Œè¯·è¿ç”¨ å¼•å…¥æ–­è¨€(Introduce Assertion) ã€‚ æ”¶ç›Š ä»£ç å˜å¾—æ›´ç›´è§‚å’Œæ˜Žæ˜¾ã€‚ ä½•æ—¶å¿½ç•¥ æ³¨é‡Šæœ‰æ—¶å€™å¾ˆæœ‰ç”¨ï¼š å½“è§£é‡Šä¸ºä»€ä¹ˆæŸäº‹ç‰©è¦ä»¥ç‰¹æ®Šæ–¹å¼å®žçŽ°æ—¶ã€‚ å½“è§£é‡ŠæŸç§å¤æ‚ç®—æ³•æ—¶ã€‚ å½“ä½ å®žåœ¨ä¸çŸ¥å¯ä»¥åšäº›ä»€ä¹ˆæ—¶ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž æç‚¼å˜é‡(Extract Variable) é—®é¢˜ ä½ æœ‰ä¸ªéš¾ä»¥ç†è§£çš„è¡¨è¾¾å¼ã€‚ void renderBanner() &#123; if ((platform.toUpperCase().indexOf("MAC") &gt; -1) &amp;&amp; (browser.toUpperCase().indexOf("IE") &gt; -1) &amp;&amp; wasInitialized() &amp;&amp; resize &gt; 0 ) &#123; // do something &#125;&#125; è§£å†³ å°†è¡¨è¾¾å¼çš„ç»“æžœæˆ–å®ƒçš„å­è¡¨è¾¾å¼çš„ç»“æžœç”¨ä¸è¨€è‡ªæ˜Žçš„å˜é‡æ¥æ›¿ä»£ã€‚ void renderBanner() &#123; final boolean isMacOs = platform.toUpperCase().indexOf("MAC") &gt; -1; final boolean isIE = browser.toUpperCase().indexOf("IE") &gt; -1; final boolean wasResized = resize &gt; 0; if (isMacOs &amp;&amp; isIE &amp;&amp; wasInitialized() &amp;&amp; wasResized) &#123; // do something &#125;&#125; æç‚¼å‡½æ•°(Extract Method) é—®é¢˜ ä½ æœ‰ä¸€æ®µä»£ç å¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ã€‚ void printOwing() &#123; printBanner(); //print details System.out.println("name: " + name); System.out.println("amount: " + getOutstanding());&#125; è§£å†³ ç§»åŠ¨è¿™æ®µä»£ç åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•°ä¸­ï¼Œä½¿ç”¨å‡½æ•°çš„è°ƒç”¨æ¥æ›¿ä»£è€ä»£ç ã€‚ void printOwing() &#123; printBanner(); printDetails(getOutstanding());&#125;void printDetails(double outstanding) &#123; System.out.println("name: " + name); System.out.println("amount: " + outstanding);&#125; å‡½æ•°æ”¹å(Rename Method) é—®é¢˜ å‡½æ•°çš„åç§°æœªèƒ½æ°å½“çš„æ­ç¤ºå‡½æ•°çš„ç”¨é€”ã€‚ class Person &#123; public String getsnm();&#125; è§£å†³ ä¿®æ”¹å‡½æ•°åã€‚ class Person &#123; public String getSecondName();&#125; å¼•å…¥æ–­è¨€(Introduce Assertion) é—®é¢˜ æŸä¸€æ®µä»£ç éœ€è¦å¯¹ç¨‹åºçŠ¶æ€åšå‡ºæŸç§å‡è®¾ã€‚ double getExpenseLimit() &#123; // should have either expense limit or a primary project return (expenseLimit != NULL_EXPENSE) ? expenseLimit: primaryProject.getMemberExpenseLimit();&#125; è§£å†³ ä»¥æ–­è¨€æ˜Žç¡®è¡¨çŽ°è¿™ç§å‡è®¾ã€‚ double getExpenseLimit() &#123; Assert.isTrue(expenseLimit != NULL_EXPENSE || primaryProject != null); return (expenseLimit != NULL_EXPENSE) ? expenseLimit: primaryProject.getMemberExpenseLimit();&#125; æ³¨ï¼šè¯·ä¸è¦æ»¥ç”¨æ–­è¨€ã€‚ä¸è¦ä½¿ç”¨å®ƒæ¥æ£€æŸ¥â€åº”è¯¥ä¸ºçœŸâ€œçš„æ¡ä»¶ï¼Œåªèƒ½ä½¿ç”¨å®ƒæ¥æ£€æŸ¥â€œä¸€å®šå¿…é¡»ä¸ºçœŸâ€çš„æ¡ä»¶ã€‚å®žé™…ä¸Šï¼Œæ–­è¨€æ›´å¤šæ˜¯ç”¨äºŽè‡ªæˆ‘æ£€æµ‹ä»£ç çš„ä¸€ç§æ‰‹æ®µã€‚åœ¨äº§å“çœŸæ­£äº¤ä»˜æ—¶ï¼Œå¾€å¾€éƒ½ä¼šæ¶ˆé™¤æ‰€æœ‰æ–­è¨€ã€‚ é‡å¤ä»£ç  é‡å¤ä»£ç (Duplicate Code) é‡å¤ä»£ç å ªç§°ä¸ºä»£ç åå‘³é“ä¹‹é¦–ã€‚æ¶ˆé™¤é‡å¤ä»£ç æ€»æ˜¯æœ‰åˆ©æ— å®³çš„ã€‚ é—®é¢˜åŽŸå›  é‡å¤ä»£ç é€šå¸¸å‘ç”Ÿåœ¨å¤šä¸ªç¨‹åºå‘˜åŒæ—¶åœ¨åŒä¸€ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä¸Šå·¥ä½œæ—¶ã€‚ç”±äºŽä»–ä»¬æ­£åœ¨å¤„ç†ä¸åŒçš„ä»»åŠ¡ï¼Œä»–ä»¬å¯èƒ½ä¸çŸ¥é“ä»–ä»¬çš„åŒäº‹å·²ç»å†™äº†ç±»ä¼¼çš„ä»£ç ã€‚ è¿˜æœ‰ä¸€ç§æ›´éšæ™¦çš„é‡å¤ï¼Œç‰¹å®šéƒ¨åˆ†çš„ä»£ç çœ‹ä¸ŠåŽ»ä¸åŒä½†å®žé™…åœ¨åšåŒä¸€ä»¶äº‹ã€‚è¿™ç§é‡å¤ä»£ç å¾€å¾€éš¾ä»¥æ‰¾åˆ°å’Œæ¶ˆé™¤ã€‚ æœ‰æ—¶é‡å¤æ˜¯æœ‰ç›®çš„æ€§çš„ã€‚å½“æ€¥äºŽæ»¡è¶³ deadlineï¼Œå¹¶ä¸”çŽ°æœ‰ä»£ç å¯¹äºŽè¦äº¤ä»˜çš„ä»»åŠ¡æ˜¯â€œå‡ ä¹Žæ­£ç¡®çš„â€æ—¶ï¼Œæ–°æ‰‹ç¨‹åºå‘˜å¯èƒ½æ— æ³•æŠµæŠ—å¤åˆ¶å’Œç²˜è´´ç›¸å…³ä»£ç çš„è¯±æƒ‘ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç¨‹åºå‘˜åªæ˜¯å¤ªæ‡’æƒ°ã€‚ è§£å†³æ–¹æ³• åŒä¸€ä¸ªç±»çš„ä¸¤ä¸ªå‡½æ•°å«æœ‰ç›¸åŒçš„è¡¨è¾¾å¼ï¼Œè¿™æ—¶å¯ä»¥é‡‡ç”¨ æç‚¼å‡½æ•°(Extract Method) æç‚¼å‡ºé‡å¤çš„ä»£ç ï¼Œç„¶åŽè®©è¿™ä¸¤ä¸ªåœ°ç‚¹éƒ½è°ƒç”¨è¢«æç‚¼å‡ºæ¥çš„é‚£æ®µä»£ç ã€‚ å¦‚æžœä¸¤ä¸ªäº’ä¸ºå…„å¼Ÿçš„å­ç±»å«æœ‰é‡å¤ä»£ç ï¼š é¦–å…ˆå¯¹ä¸¤ä¸ªç±»éƒ½è¿ç”¨ æç‚¼å‡½æ•°(Extract Method) ï¼Œç„¶åŽå¯¹è¢«æç‚¼å‡ºæ¥çš„å‡½æ•°è¿ç”¨ å‡½æ•°ä¸Šç§»(Pull Up Method) ï¼Œå°†å®ƒæŽ¨å…¥è¶…ç±»ã€‚ å¦‚æžœé‡å¤ä»£ç åœ¨æž„é€ å‡½æ•°ä¸­ï¼Œè¿ç”¨ æž„é€ å‡½æ•°æœ¬ä½“ä¸Šç§»(Pull Up Constructor Body) ã€‚ å¦‚æžœé‡å¤ä»£ç åªæ˜¯ç›¸ä¼¼ä½†ä¸æ˜¯å®Œå…¨ç›¸åŒï¼Œè¿ç”¨ å¡‘é€ æ¨¡æ¿å‡½æ•°(Form Template Method) èŽ·å¾—ä¸€ä¸ª æ¨¡æ¿æ–¹æ³•æ¨¡å¼(Template Method) ã€‚ å¦‚æžœæœ‰äº›å‡½æ•°ä»¥ä¸åŒçš„ç®—æ³•åšç›¸åŒçš„äº‹ï¼Œä½ å¯ä»¥é€‰æ‹©å…¶ä¸­è¾ƒæ¸…æ™°åœ°ä¸€ä¸ªï¼Œå¹¶è¿ç”¨ æ›¿æ¢ç®—æ³•(Substitute Algorithm) å°†å…¶ä»–å‡½æ•°çš„ç®—æ³•æ›¿æ¢æŽ‰ã€‚ å¦‚æžœä¸¤ä¸ªæ¯«ä¸ç›¸å…³çš„ç±»ä¸­æœ‰é‡å¤ä»£ç ï¼š è¯·å°è¯•è¿ç”¨ æç‚¼è¶…ç±»(Extract Superclass) ï¼Œä»¥ä¾¿ä¸ºç»´æŠ¤æ‰€æœ‰å…ˆå‰åŠŸèƒ½çš„è¿™äº›ç±»åˆ›å»ºä¸€ä¸ªè¶…ç±»ã€‚ å¦‚æžœåˆ›å»ºè¶…ç±»ååˆ†å›°éš¾ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªç±»ä¸­è¿ç”¨ æç‚¼ç±»(Extract Class) ï¼Œå¹¶åœ¨å¦ä¸€ä¸ªç±»ä¸­ä½¿ç”¨è¿™ä¸ªæ–°çš„ç»„ä»¶ã€‚ å¦‚æžœå­˜åœ¨å¤§é‡çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œå¹¶ä¸”å®ƒä»¬æ‰§è¡Œå®Œå…¨ç›¸åŒçš„ä»£ç ï¼ˆä»…ä»…æ˜¯å®ƒä»¬çš„æ¡ä»¶ä¸åŒï¼‰ï¼Œå¯ä»¥è¿ç”¨ åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼(Consolidate Conditional Expression) å°†è¿™äº›æ“ä½œåˆå¹¶ä¸ºå•ä¸ªæ¡ä»¶ï¼Œå¹¶è¿ç”¨ æç‚¼å‡½æ•°(Extract Method) å°†è¯¥æ¡ä»¶æ”¾å…¥ä¸€ä¸ªåå­—å®¹æ˜“ç†è§£çš„ç‹¬ç«‹å‡½æ•°ä¸­ã€‚ å¦‚æžœæ¡ä»¶è¡¨è¾¾å¼çš„æ‰€æœ‰åˆ†æ”¯éƒ½æœ‰éƒ¨åˆ†ç›¸åŒçš„ä»£ç ç‰‡æ®µï¼šå¯ä»¥è¿ç”¨ åˆå¹¶é‡å¤çš„æ¡ä»¶ç‰‡æ®µ(Consolidate Duplicate Conditional Fragments) å°†å®ƒä»¬éƒ½å­˜åœ¨çš„ä»£ç ç‰‡æ®µç½®äºŽæ¡ä»¶è¡¨è¾¾å¼å¤–éƒ¨ã€‚ æ”¶ç›Š åˆå¹¶é‡å¤ä»£ç ä¼šç®€åŒ–ä»£ç çš„ç»“æž„ï¼Œå¹¶å‡å°‘ä»£ç é‡ã€‚ ä»£ç æ›´ç®€åŒ–ã€æ›´æ˜“ç»´æŠ¤ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž æç‚¼å‡½æ•°(Extract Method) é—®é¢˜ ä½ æœ‰ä¸€æ®µä»£ç å¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ã€‚ void printOwing() &#123; printBanner(); //print details System.out.println("name: " + name); System.out.println("amount: " + getOutstanding());&#125; è§£å†³ ç§»åŠ¨è¿™æ®µä»£ç åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•°ä¸­ï¼Œä½¿ç”¨å‡½æ•°çš„è°ƒç”¨æ¥æ›¿ä»£è€ä»£ç ã€‚ void printOwing() &#123; printBanner(); printDetails(getOutstanding());&#125;void printDetails(double outstanding) &#123; System.out.println("name: " + name); System.out.println("amount: " + outstanding);&#125; å‡½æ•°ä¸Šç§»(Pull Up Method) é—®é¢˜ æœ‰äº›å‡½æ•°ï¼Œåœ¨å„ä¸ªå­ç±»ä¸­äº§ç”Ÿå®Œå…¨ç›¸åŒçš„ç»“æžœã€‚ è§£å†³ å°†è¯¥å‡½æ•°ç§»è‡³è¶…ç±»ã€‚ æž„é€ å‡½æ•°æœ¬ä½“ä¸Šç§»(Pull Up Constructor Body) é—®é¢˜ ä½ åœ¨å„ä¸ªå­ç±»ä¸­æ‹¥æœ‰ä¸€äº›æž„é€ å‡½æ•°ï¼Œå®ƒä»¬çš„æœ¬ä½“å‡ ä¹Žå®Œå…¨ä¸€è‡´ã€‚ class Manager extends Employee &#123; public Manager(String name, String id, int grade) &#123; this.name = name; this.id = id; this.grade = grade; &#125; //...&#125; è§£å†³ åœ¨è¶…ç±»ä¸­æ–°å»ºä¸€ä¸ªæž„é€ å‡½æ•°ï¼Œå¹¶åœ¨å­ç±»æž„é€ å‡½æ•°ä¸­è°ƒç”¨å®ƒã€‚ class Manager extends Employee &#123; public Manager(String name, String id, int grade) &#123; super(name, id); this.grade = grade; &#125; //...&#125; å¡‘é€ æ¨¡æ¿å‡½æ•°(Form Template Method) é—®é¢˜ ä½ æœ‰ä¸€äº›å­ç±»ï¼Œå…¶ä¸­ç›¸åº”çš„æŸäº›å‡½æ•°ä»¥ç›¸åŒçš„é¡ºåºæ‰§è¡Œç±»ä¼¼çš„æ“ä½œï¼Œä½†å„ä¸ªæ“ä½œçš„ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚ è§£å†³ å°†è¿™äº›æ“ä½œåˆ†åˆ«æ”¾è¿›ç‹¬ç«‹å‡½æ•°ä¸­ï¼Œå¹¶ä¿æŒå®ƒä»¬éƒ½æœ‰ç›¸åŒçš„ç­¾åï¼ŒäºŽæ˜¯åŽŸå‡½æ•°ä¹Ÿå°±å˜å¾—ç›¸åŒäº†ã€‚ç„¶åŽå°†åŽŸå‡½æ•°ä¸Šç§»è‡³è¶…ç±»ã€‚ æ³¨ï¼šè¿™é‡Œåªæåˆ°å…·ä½“åšæ³•ï¼Œå»ºè®®äº†è§£ä¸€ä¸‹æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ã€‚ æ›¿æ¢ç®—æ³•(Substitute Algorithm) é—®é¢˜ ä½ æƒ³è¦æŠŠæŸä¸ªç®—æ³•æ›¿æ¢ä¸ºå¦ä¸€ä¸ªæ›´æ¸…æ™°çš„ç®—æ³•ã€‚ String foundPerson(String[] people)&#123; for (int i = 0; i &lt; people.length; i++) &#123; if (people[i].equals("Don"))&#123; return "Don"; &#125; if (people[i].equals("John"))&#123; return "John"; &#125; if (people[i].equals("Kent"))&#123; return "Kent"; &#125; &#125; return "";&#125; è§£å†³ å°†å‡½æ•°æœ¬ä½“æ›¿æ¢ä¸ºå¦ä¸€ä¸ªç®—æ³•ã€‚ String foundPerson(String[] people)&#123; List candidates = Arrays.asList(new String[] &#123;"Don", "John", "Kent"&#125;); for (int i=0; i &lt; people.length; i++) &#123; if (candidates.contains(people[i])) &#123; return people[i]; &#125; &#125; return "";&#125; æç‚¼è¶…ç±»(Extract Superclass) é—®é¢˜ ä¸¤ä¸ªç±»æœ‰ç›¸ä¼¼ç‰¹æ€§ã€‚ è§£å†³ ä¸ºè¿™ä¸¤ä¸ªç±»å»ºç«‹ä¸€ä¸ªè¶…ç±»ï¼Œå°†ç›¸åŒç‰¹æ€§ç§»è‡³è¶…ç±»ã€‚ æç‚¼ç±»(Extract Class) é—®é¢˜ æŸä¸ªç±»åšäº†ä¸æ­¢ä¸€ä»¶äº‹ã€‚ è§£å†³ å»ºç«‹ä¸€ä¸ªæ–°ç±»ï¼Œå°†ç›¸å…³çš„å­—æ®µå’Œå‡½æ•°ä»Žæ—§ç±»æ¬ç§»åˆ°æ–°ç±»ã€‚ åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼(Consolidate Conditional Expression) é—®é¢˜ ä½ æœ‰ä¸€ç³»åˆ—æ¡ä»¶åˆ†æ”¯ï¼Œéƒ½å¾—åˆ°ç›¸åŒç»“æžœã€‚ double disabilityAmount() &#123; if (seniority &lt; 2) &#123; return 0; &#125; if (monthsDisabled &gt; 12) &#123; return 0; &#125; if (isPartTime) &#123; return 0; &#125; // compute the disability amount //...&#125; è§£å†³ å°†è¿™äº›æ¡ä»¶åˆ†æ”¯åˆå¹¶ä¸ºä¸€ä¸ªæ¡ä»¶ï¼Œå¹¶å°†è¿™ä¸ªæ¡ä»¶æç‚¼ä¸ºä¸€ä¸ªç‹¬ç«‹å‡½æ•°ã€‚ double disabilityAmount() &#123; if (isNotEligableForDisability()) &#123; return 0; &#125; // compute the disability amount //...&#125; åˆå¹¶é‡å¤çš„æ¡ä»¶ç‰‡æ®µ(Consolidate Duplicate Conditional Fragments) é—®é¢˜ åœ¨æ¡ä»¶è¡¨è¾¾å¼çš„æ¯ä¸ªåˆ†æ”¯ä¸Šæœ‰ç€ç›¸åŒçš„ä¸€æ®µä»£ç ã€‚ if (isSpecialDeal()) &#123; total = price * 0.95; send();&#125;else &#123; total = price * 0.98; send();&#125; è§£å†³ å°†è¿™æ®µé‡å¤ä»£ç æ¬ç§»åˆ°æ¡ä»¶è¡¨è¾¾å¼ä¹‹å¤–ã€‚ if (isSpecialDeal()) &#123; total = price * 0.95;&#125;else &#123; total = price * 0.98;&#125;send(); æ‰©å±•é˜…è¯» ä»£ç çš„åå‘³é“å’Œé‡æž„ ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿ ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡ ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢ ä»£ç åå‘³é“ä¹‹éžå¿…è¦çš„ ä»£ç åå‘³é“ä¹‹è€¦åˆ å‚è€ƒèµ„æ–™ é‡æž„â€”â€”æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ - by Martin Fowler https://sourcemaking.com/refactoring]]></content>
      <categories>
        <category>design</category>
        <category>refactor</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>refactor</tag>
        <tag>code-smell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿]]></title>
    <url>%2Fblog%2F2018%2F10%2F13%2Fdesign%2Frefactor%2F%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E4%BB%A3%E7%A0%81%E8%87%83%E8%82%BF%2F</url>
    <content type="text"><![CDATA[ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ ç¿»è¯‘è‡ªï¼šhttps://sourcemaking.com/refactoring/smells/bloaters ä»£ç è‡ƒè‚¿(Bloated)è¿™ç»„åå‘³é“æ„å‘³ç€ï¼šä»£ç ä¸­çš„ç±»ã€å‡½æ•°ã€å­—æ®µæ²¡æœ‰ç»è¿‡åˆç†çš„ç»„ç»‡ï¼Œåªæ˜¯ç®€å•çš„å †ç Œèµ·æ¥ã€‚è¿™ä¸€ç±»åž‹çš„é—®é¢˜é€šå¸¸åœ¨ä»£ç çš„åˆæœŸå¹¶ä¸æ˜Žæ˜¾ï¼Œä½†æ˜¯éšç€ä»£ç è§„æ¨¡çš„å¢žé•¿è€Œé€æ¸ç§¯ç´¯ï¼ˆç‰¹åˆ«æ˜¯å½“æ²¡æœ‰äººåŠªåŠ›åŽ»æ ¹é™¤å®ƒä»¬æ—¶ï¼‰ã€‚ åŸºæœ¬ç±»åž‹åæ‰§ æ•°æ®æ³¥å›¢ è¿‡å¤§çš„ç±» è¿‡é•¿å‡½æ•° è¿‡é•¿å‚æ•°åˆ— æ‰©å±•é˜…è¯» å‚è€ƒèµ„æ–™ åŸºæœ¬ç±»åž‹åæ‰§ åŸºæœ¬ç±»åž‹åæ‰§(Primitive Obsession) ä½¿ç”¨åŸºæœ¬ç±»åž‹è€Œä¸æ˜¯å°å¯¹è±¡æ¥å®žçŽ°ç®€å•ä»»åŠ¡ï¼ˆä¾‹å¦‚è´§å¸ã€èŒƒå›´ã€ç”µè¯å·ç å­—ç¬¦ä¸²ç­‰ï¼‰ã€‚ ä½¿ç”¨å¸¸é‡ç¼–ç ä¿¡æ¯ï¼ˆä¾‹å¦‚ä¸€ä¸ªç”¨äºŽå¼•ç”¨ç®¡ç†å‘˜æƒé™çš„å¸¸é‡USER_ADMIN_ROLE = 1 ï¼‰ã€‚ ä½¿ç”¨å­—ç¬¦ä¸²å¸¸é‡ä½œä¸ºå­—æ®µååœ¨æ•°ç»„ä¸­ä½¿ç”¨ã€‚ é—®é¢˜åŽŸå›  ç±»ä¼¼å…¶ä»–å¤§éƒ¨åˆ†åå‘³é“ï¼ŒåŸºæœ¬ç±»åž‹åæ‰§è¯žç”ŸäºŽç±»åˆå»ºçš„æ—¶å€™ã€‚ä¸€å¼€å§‹ï¼Œå¯èƒ½åªæ˜¯ä¸å¤šçš„å­—æ®µï¼Œéšç€è¡¨ç¤ºçš„ç‰¹æ€§è¶Šæ¥è¶Šå¤šï¼ŒåŸºæœ¬æ•°æ®ç±»åž‹å­—æ®µä¹Ÿè¶Šæ¥è¶Šå¤šã€‚ åŸºæœ¬ç±»åž‹å¸¸å¸¸è¢«ç”¨äºŽè¡¨ç¤ºæ¨¡åž‹çš„ç±»åž‹ã€‚ä½ æœ‰ä¸€ç»„æ•°å­—æˆ–å­—ç¬¦ä¸²ç”¨æ¥è¡¨ç¤ºæŸä¸ªå®žä½“ã€‚ è¿˜æœ‰ä¸€ä¸ªåœºæ™¯ï¼šåœ¨æ¨¡æ‹Ÿåœºæ™¯ï¼Œå¤§é‡çš„å­—ç¬¦ä¸²å¸¸é‡è¢«ç”¨äºŽæ•°ç»„çš„ç´¢å¼•ã€‚ è§£å†³æ–¹æ³• å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½æ”¯æŒåŸºæœ¬æ•°æ®ç±»åž‹å’Œç»“æž„ç±»åž‹ï¼ˆç±»ã€ç»“æž„ä½“ç­‰ï¼‰ã€‚ç»“æž„ç±»åž‹å…è®¸ç¨‹åºå‘˜å°†åŸºæœ¬æ•°æ®ç±»åž‹ç»„ç»‡èµ·æ¥ï¼Œä»¥ä»£è¡¨æŸä¸€äº‹ç‰©çš„æ¨¡åž‹ã€‚ åŸºæœ¬æ•°æ®ç±»åž‹å¯ä»¥çœ‹æˆæ˜¯æœºæž„ç±»åž‹çš„ç§¯æœ¨å—ã€‚å½“åŸºæœ¬æ•°æ®ç±»åž‹æ•°é‡æˆè§„æ¨¡åŽï¼Œå°†å®ƒä»¬æœ‰ç»„ç»‡åœ°ç»“åˆèµ·æ¥ï¼Œå¯ä»¥æ›´æ–¹ä¾¿çš„ç®¡ç†è¿™äº›æ•°æ®ã€‚ å¦‚æžœä½ æœ‰å¤§é‡çš„åŸºæœ¬æ•°æ®ç±»åž‹å­—æ®µï¼Œå°±æœ‰å¯èƒ½å°†å…¶ä¸­éƒ¨åˆ†å­˜åœ¨é€»è¾‘è”ç³»çš„å­—æ®µç»„ç»‡èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªç±»ã€‚æ›´è¿›ä¸€æ­¥çš„æ˜¯ï¼Œå°†ä¸Žè¿™äº›æ•°æ®æœ‰å…³è”çš„æ–¹æ³•ä¹Ÿä¸€å¹¶ç§»å…¥ç±»ä¸­ã€‚ä¸ºäº†å®žçŽ°è¿™ä¸ªç›®æ ‡ï¼Œå¯ä»¥å°è¯• ä»¥ç±»å–ä»£ç±»åž‹ç (Replace Type Code with Class) ã€‚ å¦‚æžœåŸºæœ¬æ•°æ®ç±»åž‹å­—æ®µçš„å€¼æ˜¯ç”¨äºŽæ–¹æ³•çš„å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object) æˆ– ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object) ã€‚ å¦‚æžœæƒ³è¦æ›¿æ¢çš„æ•°æ®å€¼æ˜¯ç±»åž‹ç ï¼Œè€Œå®ƒå¹¶ä¸å½±å“è¡Œä¸ºï¼Œåˆ™å¯ä»¥è¿ç”¨ ä»¥ç±»å–ä»£ç±»åž‹ç (Replace Type Code with Class) å°†å®ƒæ›¿æ¢æŽ‰ã€‚å¦‚æžœä½ æœ‰ä¸Žç±»åž‹ç ç›¸å…³çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œå¯è¿ç”¨ ä»¥å­ç±»å–ä»£ç±»åž‹ç (Replace Type Code with Subclass) æˆ– ä»¥çŠ¶æ€/ç­–ç•¥æ¨¡å¼å–ä»£ç±»åž‹ç (Replace Type Code with State/Strategy) åŠ ä»¥å¤„ç†ã€‚ å¦‚æžœä½ å‘çŽ°è‡ªå·±æ­£ä»Žæ•°ç»„ä¸­æŒ‘é€‰æ•°æ®ï¼Œå¯è¿ç”¨ ä»¥å¯¹è±¡å–ä»£æ•°ç»„(Replace Array with Object) ã€‚ æ”¶ç›Š å¤šäºäº†ä½¿ç”¨å¯¹è±¡æ›¿ä»£åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œä½¿å¾—ä»£ç å˜å¾—æ›´åŠ çµæ´»ã€‚ ä»£ç å˜å¾—æ›´åŠ æ˜“è¯»å’Œæ›´åŠ æœ‰ç»„ç»‡ã€‚ç‰¹æ®Šæ•°æ®å¯ä»¥é›†ä¸­è¿›è¡Œæ“ä½œï¼Œè€Œä¸åƒä¹‹å‰é‚£æ ·åˆ†æ•£ã€‚ä¸ç”¨å†çŒœæµ‹è¿™äº›é™Œç”Ÿçš„å¸¸é‡çš„æ„ä¹‰ä»¥åŠå®ƒä»¬ä¸ºä»€ä¹ˆåœ¨æ•°ç»„ä¸­ã€‚ æ›´å®¹æ˜“å‘çŽ°é‡å¤ä»£ç ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž ä»¥ç±»å–ä»£ç±»åž‹ç (Replace Type Code with Class) é—®é¢˜ ç±»ä¹‹ä¸­æœ‰ä¸€ä¸ªæ•°å€¼ç±»åž‹ç ï¼Œä½†å®ƒå¹¶ä¸å½±å“ç±»çš„è¡Œä¸ºã€‚ è§£å†³ ä»¥ä¸€ä¸ªæ–°çš„ç±»æ›¿æ¢è¯¥æ•°å€¼ç±»åž‹ç ã€‚ å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object) é—®é¢˜ æŸäº›å‚æ•°æ€»æ˜¯å¾ˆè‡ªç„¶åœ°åŒæ—¶å‡ºçŽ°ã€‚ è§£å†³ ä»¥ä¸€ä¸ªå¯¹è±¡æ¥å–ä»£è¿™äº›å‚æ•°ã€‚ ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object) é—®é¢˜ ä½ ä»ŽæŸä¸ªå¯¹è±¡ä¸­å–å‡ºè‹¥å¹²å€¼ï¼Œå°†å®ƒä»¬ä½œä¸ºæŸä¸€æ¬¡å‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°ã€‚ int low = daysTempRange.getLow();int high = daysTempRange.getHigh();boolean withinPlan = plan.withinRange(low, high); è§£å†³ æ”¹ä¸ºä¼ é€’æ•´ä¸ªå¯¹è±¡ã€‚ boolean withinPlan = plan.withinRange(daysTempRange); ä»¥å­ç±»å–ä»£ç±»åž‹ç (Replace Type Code with Subclass) é—®é¢˜ ä½ æœ‰ä¸€ä¸ªä¸å¯å˜çš„ç±»åž‹ç ï¼Œå®ƒä¼šå½±å“ç±»çš„è¡Œä¸ºã€‚ è§£å†³ ä»¥å­ç±»å–ä»£è¿™ä¸ªç±»åž‹ç ã€‚ ä»¥çŠ¶æ€/ç­–ç•¥æ¨¡å¼å–ä»£ç±»åž‹ç (Replace Type Code with State/Strategy) é—®é¢˜ ä½ æœ‰ä¸€ä¸ªç±»åž‹ç ï¼Œå®ƒä¼šå½±å“ç±»çš„è¡Œä¸ºï¼Œä½†ä½ æ— æ³•é€šè¿‡ç»§æ‰¿æ¶ˆé™¤å®ƒã€‚ è§£å†³ ä»¥çŠ¶æ€å¯¹è±¡å–ä»£ç±»åž‹ç ã€‚ ä»¥å¯¹è±¡å–ä»£æ•°ç»„(Replace Array with Object) é—®é¢˜ ä½ æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ å„è‡ªä»£è¡¨ä¸åŒçš„ä¸œè¥¿ã€‚ String[] row = new String[3];row[0] = "Liverpool";row[1] = "15"; è§£å†³ ä»¥å¯¹è±¡æ›¿æ¢æ•°ç»„ã€‚å¯¹äºŽæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œä»¥ä¸€ä¸ªå­—æ®µæ¥è¡¨ç¤ºã€‚ Performance row = new Performance();row.setName("Liverpool");row.setWins("15"); æ•°æ®æ³¥å›¢ æ•°æ®æ³¥å›¢(Data Clumps) æœ‰æ—¶ï¼Œä»£ç çš„ä¸åŒéƒ¨åˆ†åŒ…å«ç›¸åŒçš„å˜é‡ç»„ï¼ˆä¾‹å¦‚ç”¨äºŽè¿žæŽ¥åˆ°æ•°æ®åº“çš„å‚æ•°ï¼‰ã€‚è¿™äº›ç»‘åœ¨ä¸€èµ·å‡ºçŽ°çš„æ•°æ®åº”è¯¥æ‹¥æœ‰è‡ªå·±çš„å¯¹è±¡ã€‚ é—®é¢˜åŽŸå›  é€šå¸¸ï¼Œæ•°æ®æ³¥å›¢çš„å‡ºçŽ°æ—¶å› ä¸ºç³Ÿç³•çš„ç¼–ç¨‹ç»“æž„æˆ–â€œå¤åˆ¶-ç²˜è´´å¼ç¼–ç¨‹â€ã€‚ æœ‰ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦æ˜¯æ•°æ®æ³¥å›¢çš„å¥½åŠžæ³•ï¼šåˆ æŽ‰ä¼—å¤šæ•°æ®ä¸­çš„ä¸€é¡¹ã€‚è¿™ä¹ˆåšï¼Œå…¶ä»–æ•°æ®æœ‰æ²¡æœ‰å› è€Œå¤±åŽ»æ„ä¹‰ï¼Ÿå¦‚æžœå®ƒä»¬ä¸å†æœ‰æ„ä¹‰ï¼Œè¿™å°±æ˜¯ä¸ªæ˜Žç¡®çš„ä¿¡å·ï¼šä½ åº”è¯¥ä¸ºå®ƒä»¬äº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚ è§£å†³æ–¹æ³• é¦–å…ˆæ‰¾å‡ºè¿™äº›æ•°æ®ä»¥å­—æ®µå½¢å¼å‡ºçŽ°çš„åœ°æ–¹ï¼Œè¿ç”¨ æç‚¼ç±»(Extract Class) å°†å®ƒä»¬æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹å¯¹è±¡ä¸­ã€‚ å¦‚æžœæ•°æ®æ³¥å›¢åœ¨å‡½æ•°çš„å‚æ•°åˆ—ä¸­å‡ºçŽ°ï¼Œè¿ç”¨ å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object) å°†å®ƒä»¬ç»„ç»‡æˆä¸€ä¸ªç±»ã€‚ å¦‚æžœæ•°æ®æ³¥å›¢çš„éƒ¨åˆ†æ•°æ®å‡ºçŽ°åœ¨å…¶ä»–å‡½æ•°ä¸­ï¼Œè€ƒè™‘è¿ç”¨ ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object) å°†æ•´ä¸ªæ•°æ®å¯¹è±¡ä¼ å…¥åˆ°å‡½æ•°ä¸­ã€‚ æ£€è§†ä¸€ä¸‹ä½¿ç”¨è¿™äº›å­—æ®µçš„ä»£ç ï¼Œä¹Ÿè®¸ï¼Œå°†å®ƒä»¬ç§»å…¥ä¸€ä¸ªæ•°æ®ç±»æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ã€‚ æ”¶ç›Š æé«˜ä»£ç æ˜“è¯»æ€§å’Œç»„ç»‡æ€§ã€‚å¯¹äºŽç‰¹æ®Šæ•°æ®çš„æ“ä½œï¼Œå¯ä»¥é›†ä¸­è¿›è¡Œå¤„ç†ï¼Œè€Œä¸åƒä»¥å‰é‚£æ ·åˆ†æ•£ã€‚ å‡å°‘ä»£ç é‡ã€‚ ä½•æ—¶å¿½ç•¥ æœ‰æ—¶ä¸ºäº†å¯¹è±¡ä¸­çš„éƒ¨åˆ†æ•°æ®è€Œå°†æ•´ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œå¯èƒ½ä¼šäº§ç”Ÿè®©ä¸¤ä¸ªç±»ä¹‹é—´ä¸æ”¶æ¬¢è¿Žçš„ä¾èµ–å…³ç³»ï¼Œè¿™ä¸­æƒ…å†µä¸‹å¯ä»¥ä¸ä¼ é€’æ•´ä¸ªå¯¹è±¡ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž æç‚¼ç±»(Extract Class) é—®é¢˜ æŸä¸ªç±»åšäº†ä¸æ­¢ä¸€ä»¶äº‹ã€‚ è§£å†³ å»ºç«‹ä¸€ä¸ªæ–°ç±»ï¼Œå°†ç›¸å…³çš„å­—æ®µå’Œå‡½æ•°ä»Žæ—§ç±»æ¬ç§»åˆ°æ–°ç±»ã€‚ å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object) é—®é¢˜ æŸäº›å‚æ•°æ€»æ˜¯å¾ˆè‡ªç„¶åœ°åŒæ—¶å‡ºçŽ°ã€‚ è§£å†³ ä»¥ä¸€ä¸ªå¯¹è±¡æ¥å–ä»£è¿™äº›å‚æ•°ã€‚ ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object) é—®é¢˜ ä½ ä»ŽæŸä¸ªå¯¹è±¡ä¸­å–å‡ºè‹¥å¹²å€¼ï¼Œå°†å®ƒä»¬ä½œä¸ºæŸä¸€æ¬¡å‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°ã€‚ int low = daysTempRange.getLow();int high = daysTempRange.getHigh();boolean withinPlan = plan.withinRange(low, high); è§£å†³ æ”¹ä¸ºä¼ é€’æ•´ä¸ªå¯¹è±¡ã€‚ boolean withinPlan = plan.withinRange(daysTempRange); è¿‡å¤§çš„ç±» è¿‡å¤§çš„ç±»(Large Class) ä¸€ä¸ªç±»å«æœ‰è¿‡å¤šå­—æ®µã€å‡½æ•°ã€ä»£ç è¡Œã€‚ é—®é¢˜åŽŸå›  ç±»é€šå¸¸ä¸€å¼€å§‹å¾ˆå°ï¼Œä½†æ˜¯éšç€ç¨‹åºçš„å¢žé•¿è€Œé€æ¸è†¨èƒ€ã€‚ ç±»ä¼¼äºŽè¿‡é•¿å‡½æ•°ï¼Œç¨‹åºå‘˜é€šå¸¸è§‰å¾—åœ¨ä¸€ä¸ªçŽ°å­˜ç±»ä¸­æ·»åŠ æ–°ç‰¹æ€§æ¯”åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»è¦å®¹æ˜“ã€‚ è§£å†³æ–¹æ³• è®¾è®¡æ¨¡å¼ä¸­æœ‰ä¸€æ¡é‡è¦åŽŸåˆ™ï¼šèŒè´£å•ä¸€åŽŸåˆ™ã€‚ä¸€ä¸ªç±»åº”è¯¥åªèµ‹äºˆå®ƒä¸€ä¸ªèŒè´£ã€‚å¦‚æžœå®ƒæ‰€æ‰¿æ‹…çš„èŒè´£å¤ªå¤šï¼Œå°±è¯¥è€ƒè™‘ä¸ºå®ƒå‡å‡è´Ÿã€‚ å¦‚æžœè¿‡å¤§ç±»ä¸­çš„éƒ¨åˆ†è¡Œä¸ºå¯ä»¥æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ æç‚¼ç±»(Extract Class)ã€‚ å¦‚æžœè¿‡å¤§ç±»ä¸­çš„éƒ¨åˆ†è¡Œä¸ºå¯ä»¥ç”¨ä¸åŒæ–¹å¼å®žçŽ°æˆ–ä½¿ç”¨äºŽç‰¹æ®Šåœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨ æç‚¼å­ç±»(Extract Subclass)ã€‚ å¦‚æžœæœ‰å¿…è¦ä¸ºå®¢æˆ·ç«¯æä¾›ä¸€ç»„æ“ä½œå’Œè¡Œä¸ºï¼Œå¯ä»¥ä½¿ç”¨ æç‚¼æŽ¥å£(Extract Interface)ã€‚ å¦‚æžœä½ çš„è¿‡å¤§ç±»æ˜¯ä¸ª GUI ç±»ï¼Œå¯èƒ½éœ€è¦æŠŠæ•°æ®å’Œè¡Œä¸ºç§»åˆ°ä¸€ä¸ªç‹¬ç«‹çš„é¢†åŸŸå¯¹è±¡åŽ»ã€‚ä½ å¯èƒ½éœ€è¦ä¸¤è¾¹å„ä¿ç•™ä¸€äº›é‡å¤æ•°æ®ï¼Œå¹¶ä¿æŒä¸¤è¾¹åŒæ­¥ã€‚ å¤åˆ¶è¢«ç›‘è§†æ•°æ®(Duplicate Observed Data) å¯ä»¥å‘Šè¯‰ä½ æ€Žä¹ˆåšã€‚ æ”¶ç›Š é‡æž„è¿‡å¤§çš„ç±»å¯ä»¥ä½¿ç¨‹åºå‘˜ä¸å¿…è®°ä½ä¸€ä¸ªç±»ä¸­å¤§é‡çš„å±žæ€§ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåˆ†å‰²è¿‡å¤§çš„ç±»å¯ä»¥é¿å…ä»£ç å’ŒåŠŸèƒ½çš„é‡å¤ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž æç‚¼ç±»(Extract Class) é—®é¢˜ æŸä¸ªç±»åšäº†ä¸æ­¢ä¸€ä»¶äº‹ã€‚ è§£å†³ å»ºç«‹ä¸€ä¸ªæ–°ç±»ï¼Œå°†ç›¸å…³çš„å­—æ®µå’Œå‡½æ•°ä»Žæ—§ç±»æ¬ç§»åˆ°æ–°ç±»ã€‚ æç‚¼å­ç±»(Extract Subclass) é—®é¢˜ ä¸€ä¸ªç±»ä¸­æœ‰äº›ç‰¹æ€§ä»…ç”¨äºŽç‰¹å®šåœºæ™¯ã€‚ è§£å†³ åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œå¹¶å°†ç”¨äºŽç‰¹æ®Šåœºæ™¯çš„ç‰¹æ€§ç½®å…¥å…¶ä¸­ã€‚ æç‚¼æŽ¥å£(Extract Interface) é—®é¢˜ å¤šä¸ªå®¢æˆ·ç«¯ä½¿ç”¨ä¸€ä¸ªç±»éƒ¨åˆ†ç›¸åŒçš„å‡½æ•°ã€‚å¦ä¸€ä¸ªåœºæ™¯æ˜¯ä¸¤ä¸ªç±»ä¸­çš„éƒ¨åˆ†å‡½æ•°ç›¸åŒã€‚ è§£å†³ ç§»åŠ¨ç›¸åŒçš„éƒ¨åˆ†å‡½æ•°åˆ°æŽ¥å£ä¸­ã€‚ å¤åˆ¶è¢«ç›‘è§†æ•°æ®(Duplicate Observed Data) é—®é¢˜ å¦‚æžœå­˜å‚¨åœ¨ç±»ä¸­çš„æ•°æ®æ˜¯è´Ÿè´£ GUI çš„ã€‚ è§£å†³ ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹æ³•æ˜¯å°†è´Ÿè´£ GUI çš„æ•°æ®æ”¾å…¥ä¸€ä¸ªç‹¬ç«‹çš„ç±»ï¼Œä»¥ç¡®ä¿ GUI æ•°æ®ä¸ŽåŸŸç±»ä¹‹é—´çš„è¿žæŽ¥å’ŒåŒæ­¥ã€‚ è¿‡é•¿å‡½æ•° è¿‡é•¿å‡½æ•°(Long Method) ä¸€ä¸ªå‡½æ•°å«æœ‰å¤ªå¤šè¡Œä»£ç ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä»»ä½•å‡½æ•°è¶…è¿‡ 10 è¡Œæ—¶ï¼Œä½ å°±å¯ä»¥è€ƒè™‘æ˜¯ä¸æ˜¯è¿‡é•¿äº†ã€‚ å‡½æ•°ä¸­çš„ä»£ç è¡Œæ•°åŽŸåˆ™ä¸Šä¸è¦è¶…è¿‡ 100 è¡Œã€‚ é—®é¢˜çš„åŽŸå›  é€šå¸¸æƒ…å†µä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°çš„éš¾åº¦è¦å¤§äºŽæ·»åŠ åŠŸèƒ½åˆ°ä¸€ä¸ªå·²å­˜åœ¨çš„å‡½æ•°ã€‚å¤§éƒ¨åˆ†äººéƒ½è§‰å¾—ï¼šâ€œæˆ‘å°±æ·»åŠ è¿™ä¹ˆä¸¤è¡Œä»£ç ï¼Œä¸ºæ­¤æ–°å»ºä¸€ä¸ªå‡½æ•°å®žåœ¨æ˜¯å°é¢˜å¤§åšäº†ã€‚â€äºŽæ˜¯ï¼Œå¼ ä¸‰åŠ ä¸¤è¡Œï¼ŒæŽå››åŠ ä¸¤è¡Œï¼ŒçŽ‹äº”åŠ ä¸¤è¡Œã€‚ã€‚ã€‚å‡½æ•°æ—¥ç›Šåºžå¤§ï¼Œæœ€ç»ˆçƒ‚çš„åƒä¸€é”…æµ†ç³Šï¼Œå†ä¹Ÿæ²¡äººèƒ½å®Œå…¨çœ‹æ‡‚äº†ã€‚äºŽæ˜¯å¤§å®¶å°±æ›´ä¸æ•¢è½»æ˜“åŠ¨è¿™ä¸ªå‡½æ•°äº†ï¼Œåªèƒ½æ¶æ€§å¾ªçŽ¯çš„å¾€å…¶ä¸­æ·»åŠ ä»£ç ã€‚æ‰€ä»¥ï¼Œå¦‚æžœä½ çœ‹åˆ°ä¸€ä¸ªè¶…è¿‡ 200 è¡Œçš„å‡½æ•°ï¼Œé€šå¸¸éƒ½æ˜¯å¤šä¸ªç¨‹åºå‘˜ä¸œæ‹¼è¥¿å‡‘å‡ºæ¥çš„ã€‚ è§£å†³å‡½æ•° ä¸€ä¸ªå¾ˆå¥½çš„æŠ€å·§æ˜¯ï¼šå¯»æ‰¾æ³¨é‡Šã€‚æ·»åŠ æ³¨é‡Šï¼Œä¸€èˆ¬æœ‰è¿™ä¹ˆå‡ ä¸ªåŽŸå› ï¼šä»£ç é€»è¾‘è¾ƒä¸ºæ™¦æ¶©æˆ–å¤æ‚ï¼›è¿™æ®µä»£ç åŠŸèƒ½ç›¸å¯¹ç‹¬ç«‹ï¼›ç‰¹æ®Šå¤„ç†ã€‚ å¦‚æžœä»£ç å‰æ–¹æœ‰ä¸€è¡Œæ³¨é‡Šï¼Œå°±æ˜¯åœ¨æé†’ä½ ï¼šå¯ä»¥å°†è¿™æ®µä»£ç æ›¿æ¢æˆä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸”å¯ä»¥åœ¨æ³¨é‡Šçš„åŸºç¡€ä¸Šç»™è¿™ä¸ªå‡½æ•°å‘½åã€‚å¦‚æžœå‡½æ•°æœ‰ä¸€ä¸ªæè¿°æ°å½“çš„åå­—ï¼Œå°±ä¸éœ€è¦åŽ»çœ‹å†…éƒ¨ä»£ç ç©¶ç«Ÿæ˜¯å¦‚ä½•å®žçŽ°çš„ã€‚å°±ç®—åªæœ‰ä¸€è¡Œä»£ç ï¼Œå¦‚æžœå®ƒéœ€è¦ä»¥æ³¨é‡Šæ¥è¯´æ˜Žï¼Œé‚£ä¹Ÿå€¼å¾—å°†å®ƒæç‚¼åˆ°ç‹¬ç«‹å‡½æ•°ä¸­ã€‚ ä¸ºäº†ç»™ä¸€ä¸ªå‡½æ•°ç˜¦èº«ï¼Œå¯ä»¥ä½¿ç”¨ æç‚¼å‡½æ•°(Extract Method)ã€‚ å¦‚æžœå±€éƒ¨å˜é‡å’Œå‚æ•°å¹²æ‰°æç‚¼å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ ä»¥æŸ¥è¯¢å–ä»£ä¸´æ—¶å˜é‡(Replace Temp with Query)ï¼Œå¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object) æˆ– ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object) ã€‚ å¦‚æžœå‰é¢ä¸¤æ¡æ²¡æœ‰å¸®åŠ©ï¼Œå¯ä»¥é€šè¿‡ ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°(Replace Method with Method Object) å°è¯•ç§»åŠ¨æ•´ä¸ªå‡½æ•°åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ä¸­ã€‚ æ¡ä»¶è¡¨è¾¾å¼å’Œå¾ªçŽ¯å¸¸å¸¸ä¹Ÿæ˜¯æç‚¼çš„ä¿¡å·ã€‚å¯¹äºŽæ¡ä»¶è¡¨è¾¾å¼ï¼Œå¯ä»¥ä½¿ç”¨ åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼(Decompose Conditional) ã€‚è‡³äºŽå¾ªçŽ¯ï¼Œåº”è¯¥ä½¿ç”¨ æç‚¼å‡½æ•°(Extract Method) å°†å¾ªçŽ¯å’Œå…¶å†…çš„ä»£ç æç‚¼åˆ°ç‹¬ç«‹å‡½æ•°ä¸­ã€‚ æ”¶ç›Š åœ¨æ‰€æœ‰ç±»åž‹çš„é¢å‘å¯¹è±¡ä»£ç ä¸­ï¼Œå‡½æ•°æ¯”è¾ƒçŸ­å°ç²¾æ‚çš„ç±»å¾€å¾€ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ã€‚ä¸€ä¸ªå‡½æ•°è¶Šé•¿ï¼Œå°±è¶Šä¸å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚ æ­¤å¤–ï¼Œè¿‡é•¿å‡½æ•°ä¸­å¾€å¾€å«æœ‰éš¾ä»¥å‘çŽ°çš„é‡å¤ä»£ç ã€‚ æ€§èƒ½ æ˜¯å¦åƒè®¸å¤šäººè¯´çš„é‚£æ ·ï¼Œå¢žåŠ å‡½æ•°çš„æ•°é‡ä¼šå½±å“æ€§èƒ½ï¼Ÿåœ¨å‡ ä¹Žç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§å½±å“æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒã€‚ æ­¤å¤–ï¼ŒçŽ°åœ¨æœ‰äº†æ¸…æ™°å’Œæ˜“è¯»çš„ä»£ç ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ï¼Œä½ å°†æ›´å®¹æ˜“æ‰¾åˆ°çœŸæ­£æœ‰æ•ˆçš„å‡½æ•°æ¥é‡ç»„ä»£ç å’Œæé«˜æ€§èƒ½ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž æç‚¼å‡½æ•°(Extract Method) é—®é¢˜ ä½ æœ‰ä¸€æ®µä»£ç å¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ã€‚ void printOwing() &#123; printBanner(); //print details System.out.println("name: " + name); System.out.println("amount: " + getOutstanding());&#125; è§£å†³ ç§»åŠ¨è¿™æ®µä»£ç åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•°ä¸­ï¼Œä½¿ç”¨å‡½æ•°çš„è°ƒç”¨æ¥æ›¿ä»£è€ä»£ç ã€‚ void printOwing() &#123; printBanner(); printDetails(getOutstanding());&#125;void printDetails(double outstanding) &#123; System.out.println("name: " + name); System.out.println("amount: " + outstanding);&#125; ä»¥æŸ¥è¯¢å–ä»£ä¸´æ—¶å˜é‡(Replace Temp with Query) é—®é¢˜ å°†è¡¨è¾¾å¼çš„ç»“æžœæ”¾åœ¨å±€éƒ¨å˜é‡ä¸­ï¼Œç„¶åŽåœ¨ä»£ç ä¸­ä½¿ç”¨ã€‚ double calculateTotal() &#123; double basePrice = quantity * itemPrice; if (basePrice &gt; 1000) &#123; return basePrice * 0.95; &#125; else &#123; return basePrice * 0.98; &#125;&#125; è§£å†³ å°†æ•´ä¸ªè¡¨è¾¾å¼ç§»åŠ¨åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ä¸­å¹¶è¿”å›žç»“æžœã€‚ä½¿ç”¨æŸ¥è¯¢å‡½æ•°æ¥æ›¿ä»£ä½¿ç”¨å˜é‡ã€‚å¦‚æžœéœ€è¦ï¼Œå¯ä»¥åœ¨å…¶ä»–å‡½æ•°ä¸­åˆå¹¶æ–°å‡½æ•°ã€‚ double calculateTotal() &#123; if (basePrice() &gt; 1000) &#123; return basePrice() * 0.95; &#125; else &#123; return basePrice() * 0.98; &#125;&#125;double basePrice() &#123; return quantity * itemPrice;&#125; å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object) é—®é¢˜ æŸäº›å‚æ•°æ€»æ˜¯å¾ˆè‡ªç„¶åœ°åŒæ—¶å‡ºçŽ°ã€‚ è§£å†³ ä»¥ä¸€ä¸ªå¯¹è±¡æ¥å–ä»£è¿™äº›å‚æ•°ã€‚ ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object) é—®é¢˜ ä½ ä»ŽæŸä¸ªå¯¹è±¡ä¸­å–å‡ºè‹¥å¹²å€¼ï¼Œå°†å®ƒä»¬ä½œä¸ºæŸä¸€æ¬¡å‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°ã€‚ int low = daysTempRange.getLow();int high = daysTempRange.getHigh();boolean withinPlan = plan.withinRange(low, high); è§£å†³ æ”¹ä¸ºä¼ é€’æ•´ä¸ªå¯¹è±¡ã€‚ boolean withinPlan = plan.withinRange(daysTempRange); ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°(Replace Method with Method Object) é—®é¢˜ ä½ æœ‰ä¸€ä¸ªè¿‡é•¿å‡½æ•°ï¼Œå®ƒçš„å±€éƒ¨å˜é‡äº¤ç»‡åœ¨ä¸€èµ·ï¼Œä»¥è‡´äºŽä½ æ— æ³•åº”ç”¨æç‚¼å‡½æ•°(Extract Method) ã€‚ class Order &#123; //... public double price() &#123; double primaryBasePrice; double secondaryBasePrice; double tertiaryBasePrice; // long computation. //... &#125;&#125; è§£å†³ å°†å‡½æ•°ç§»åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ç±»ä¸­ï¼Œä½¿å¾—å±€éƒ¨å˜é‡æˆäº†è¿™ä¸ªç±»çš„å­—æ®µã€‚ç„¶åŽï¼Œä½ å¯ä»¥å°†å‡½æ•°åˆ†å‰²æˆè¿™ä¸ªç±»ä¸­çš„å¤šä¸ªå‡½æ•°ã€‚ class Order &#123; //... public double price() &#123; return new PriceCalculator(this).compute(); &#125;&#125;class PriceCalculator &#123; private double primaryBasePrice; private double secondaryBasePrice; private double tertiaryBasePrice; public PriceCalculator(Order order) &#123; // copy relevant information from order object. //... &#125; public double compute() &#123; // long computation. //... &#125;&#125; åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼(Decompose Conditional) é—®é¢˜ ä½ æœ‰å¤æ‚çš„æ¡ä»¶è¡¨è¾¾å¼ã€‚ if (date.before(SUMMER_START) || date.after(SUMMER_END)) &#123; charge = quantity * winterRate + winterServiceCharge;&#125;else &#123; charge = quantity * summerRate;&#125; è§£å†³ æ ¹æ®æ¡ä»¶åˆ†æ”¯å°†æ•´ä¸ªæ¡ä»¶è¡¨è¾¾å¼åˆ†è§£æˆå‡ ä¸ªå‡½æ•°ã€‚ if (notSummer(date)) &#123; charge = winterCharge(quantity);&#125;else &#123; charge = summerCharge(quantity);&#125; è¿‡é•¿å‚æ•°åˆ— è¿‡é•¿å‚æ•°åˆ—(Long Parameter List) ä¸€ä¸ªå‡½æ•°æœ‰è¶…è¿‡ 3ã€4 ä¸ªå…¥å‚ã€‚ é—®é¢˜åŽŸå›  è¿‡é•¿å‚æ•°åˆ—å¯èƒ½æ˜¯å°†å¤šä¸ªç®—æ³•å¹¶åˆ°ä¸€ä¸ªå‡½æ•°ä¸­æ—¶å‘ç”Ÿçš„ã€‚å‡½æ•°ä¸­çš„å…¥å‚å¯ä»¥ç”¨æ¥æŽ§åˆ¶æœ€ç»ˆé€‰ç”¨å“ªä¸ªç®—æ³•åŽ»æ‰§è¡Œã€‚ è¿‡é•¿å‚æ•°åˆ—ä¹Ÿå¯èƒ½æ˜¯è§£è€¦ç±»ä¹‹é—´ä¾èµ–å…³ç³»æ—¶çš„å‰¯äº§å“ã€‚ä¾‹å¦‚ï¼Œç”¨äºŽåˆ›å»ºå‡½æ•°ä¸­æ‰€éœ€çš„ç‰¹å®šå¯¹è±¡çš„ä»£ç å·²ä»Žå‡½æ•°ç§»åŠ¨åˆ°è°ƒç”¨å‡½æ•°çš„ä»£ç å¤„ï¼Œä½†åˆ›å»ºçš„å¯¹è±¡æ˜¯ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å‡½æ•°ä¸­ã€‚å› æ­¤ï¼ŒåŽŸå§‹ç±»ä¸å†çŸ¥é“å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶ä¸”ä¾èµ–æ€§ä¹Ÿå·²ç»å‡å°‘ã€‚ä½†æ˜¯å¦‚æžœåˆ›å»ºçš„è¿™äº›å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªéƒ½å°†éœ€è¦å®ƒè‡ªå·±çš„å‚æ•°ï¼Œè¿™æ„å‘³ç€è¿‡é•¿å‚æ•°åˆ—ã€‚ å¤ªé•¿çš„å‚æ•°åˆ—éš¾ä»¥ç†è§£ï¼Œå¤ªå¤šå‚æ•°ä¼šé€ æˆå‰åŽä¸ä¸€è‡´ã€ä¸æ˜“ä½¿ç”¨ï¼Œè€Œä¸”ä¸€æ—¦éœ€è¦æ›´å¤šæ•°æ®ï¼Œå°±ä¸å¾—ä¸ä¿®æ”¹å®ƒã€‚ è§£å†³æ–¹æ¡ˆ å¦‚æžœå‘å·²æœ‰çš„å¯¹è±¡å‘å‡ºä¸€æ¡è¯·æ±‚å°±å¯ä»¥å–ä»£ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆä½ åº”è¯¥ä½¿ç”¨ ä»¥å‡½æ•°å–ä»£å‚æ•°(Replace Parameter with Methods) ã€‚åœ¨è¿™é‡Œï¼Œï¼Œâ€œå·²æœ‰çš„å¯¹è±¡â€å¯èƒ½æ˜¯å‡½æ•°æ‰€å±žç±»é‡Œçš„ä¸€ä¸ªå­—æ®µï¼Œä¹Ÿå¯èƒ½æ˜¯å¦ä¸€ä¸ªå‚æ•°ã€‚ ä½ è¿˜å¯ä»¥è¿ç”¨ ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object) å°†æ¥è‡ªåŒä¸€å¯¹è±¡çš„ä¸€å †æ•°æ®æ”¶é›†èµ·æ¥ï¼Œå¹¶ä»¥è¯¥å¯¹è±¡æ›¿æ¢å®ƒä»¬ã€‚ å¦‚æžœæŸäº›æ•°æ®ç¼ºä¹åˆç†çš„å¯¹è±¡å½’å±žï¼Œå¯ä½¿ç”¨ å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object) ä¸ºå®ƒä»¬åˆ¶é€ å‡ºä¸€ä¸ªâ€œå‚æ•°å¯¹è±¡â€ã€‚ æ”¶ç›Š æ›´æ˜“è¯»ï¼Œæ›´ç®€çŸ­çš„ä»£ç ã€‚ é‡æž„å¯èƒ½ä¼šæš´éœ²å‡ºä¹‹å‰æœªæ³¨æ„åˆ°çš„é‡å¤ä»£ç ã€‚ ä½•æ—¶å¿½ç•¥ è¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦çš„ä¾‹å¤–ï¼šæœ‰æ—¶å€™ä½ æ˜Žæ˜¾ä¸æƒ³é€ æˆ&quot;è¢«è°ƒç”¨å¯¹è±¡&quot;ä¸Ž&quot;è¾ƒå¤§å¯¹è±¡&quot;é—´çš„æŸç§ä¾èµ–å…³ç³»ã€‚è¿™æ—¶å€™å°†æ•°æ®ä»Žå¯¹è±¡ä¸­æ‹†è§£å‡ºæ¥å•ç‹¬ä½œä¸ºå‚æ•°ï¼Œä¹Ÿå¾ˆåˆæƒ…ç†ã€‚ä½†æ˜¯è¯·æ³¨æ„å…¶æ‰€å¼•å‘çš„ä»£ä»·ã€‚å¦‚æžœå‚æ•°åˆ—å¤ªé•¿æˆ–å˜åŒ–å¤ªé¢‘ç¹ï¼Œå°±éœ€è¦é‡æ–°è€ƒè™‘è‡ªå·±çš„ä¾èµ–ç»“æž„äº†ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž ä»¥å‡½æ•°å–ä»£å‚æ•°(Replace Parameter with Methods) é—®é¢˜ å¯¹è±¡è°ƒç”¨æŸä¸ªå‡½æ•°ï¼Œå¹¶å°†æ‰€å¾—ç»“æžœä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ã€‚è€ŒæŽ¥å—è¯¥å‚æ•°çš„å‡½æ•°æœ¬èº«ä¹Ÿèƒ½å¤Ÿè°ƒç”¨å‰ä¸€ä¸ªå‡½æ•°ã€‚ int basePrice = quantity * itemPrice;double seasonDiscount = this.getSeasonalDiscount();double fees = this.getFees();double finalPrice = discountedPrice(basePrice, seasonDiscount, fees); è§£å†³ è®©å‚æ•°æŽ¥å—è€…åŽ»é™¤è¯¥é¡¹å‚æ•°ï¼Œå¹¶ç›´æŽ¥è°ƒç”¨å‰ä¸€ä¸ªå‡½æ•°ã€‚ int basePrice = quantity * itemPrice;double finalPrice = discountedPrice(basePrice); ä¿æŒå¯¹è±¡å®Œæ•´(Preserve Whole Object) é—®é¢˜ ä½ ä»ŽæŸä¸ªå¯¹è±¡ä¸­å–å‡ºè‹¥å¹²å€¼ï¼Œå°†å®ƒä»¬ä½œä¸ºæŸä¸€æ¬¡å‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°ã€‚ int low = daysTempRange.getLow();int high = daysTempRange.getHigh();boolean withinPlan = plan.withinRange(low, high); è§£å†³ æ”¹ä¸ºä¼ é€’æ•´ä¸ªå¯¹è±¡ã€‚ boolean withinPlan = plan.withinRange(daysTempRange); å¼•å…¥å‚æ•°å¯¹è±¡(Introduce Parameter Object) é—®é¢˜ æŸäº›å‚æ•°æ€»æ˜¯å¾ˆè‡ªç„¶åœ°åŒæ—¶å‡ºçŽ°ã€‚ è§£å†³ ä»¥ä¸€ä¸ªå¯¹è±¡æ¥å–ä»£è¿™äº›å‚æ•°ã€‚ æ‰©å±•é˜…è¯» ä»£ç çš„åå‘³é“å’Œé‡æž„ ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿ ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡ ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢ ä»£ç åå‘³é“ä¹‹éžå¿…è¦çš„ ä»£ç åå‘³é“ä¹‹è€¦åˆ å‚è€ƒèµ„æ–™ é‡æž„â€”â€”æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ - by Martin Fowler https://sourcemaking.com/refactoring]]></content>
      <categories>
        <category>design</category>
        <category>refactor</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>refactor</tag>
        <tag>code-smell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡]]></title>
    <url>%2Fblog%2F2018%2F10%2F13%2Fdesign%2Frefactor%2F%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E6%BB%A5%E7%94%A8%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%2F</url>
    <content type="text"><![CDATA[ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ ç¿»è¯‘è‡ªï¼šhttps://sourcemaking.com/refactoring/smells/oo-abusers æ»¥ç”¨é¢å‘å¯¹è±¡(Object-Orientation Abusers)è¿™ç»„åå‘³é“æ„å‘³ç€ï¼šä»£ç éƒ¨åˆ†æˆ–å®Œå…¨åœ°è¿èƒŒäº†é¢å‘å¯¹è±¡ç¼–ç¨‹åŽŸåˆ™ã€‚ Switch å£°æ˜Ž ä¸´æ—¶å­—æ®µ å¼‚æ›²åŒå·¥çš„ç±» è¢«æ‹’ç»çš„é¦ˆèµ  æ‰©å±•é˜…è¯» å‚è€ƒèµ„æ–™ Switch å£°æ˜Ž Switch å£°æ˜Ž(Switch Statements) ä½ æœ‰ä¸€ä¸ªå¤æ‚çš„ switch è¯­å¥æˆ– if åºåˆ—è¯­å¥ã€‚ é—®é¢˜åŽŸå›  é¢å‘å¯¹è±¡ç¨‹åºçš„ä¸€ä¸ªæœ€æ˜Žæ˜¾ç‰¹å¾å°±æ˜¯ï¼šå°‘ç”¨ switch å’Œ case è¯­å¥ã€‚ä»Žæœ¬è´¨ä¸Šè¯´ï¼Œswitch è¯­å¥çš„é—®é¢˜åœ¨äºŽé‡å¤ï¼ˆif åºåˆ—ä¹ŸåŒæ ·å¦‚æ­¤ï¼‰ã€‚ä½ å¸¸ä¼šå‘çŽ° switch è¯­å¥æ•£å¸ƒäºŽä¸åŒåœ°ç‚¹ã€‚å¦‚æžœè¦ä¸ºå®ƒæ·»åŠ ä¸€ä¸ªæ–°çš„ case å­å¥ï¼Œå°±å¿…é¡»æ‰¾åˆ°æ‰€æœ‰ switch è¯­å¥å¹¶ä¿®æ”¹å®ƒä»¬ã€‚é¢å‘å¯¹è±¡ä¸­çš„å¤šæ€æ¦‚å¿µå¯ä¸ºæ­¤å¸¦æ¥ä¼˜é›…çš„è§£å†³åŠžæ³•ã€‚ å¤§å¤šæ•°æ—¶å€™ï¼Œä¸€çœ‹åˆ° switch è¯­å¥ï¼Œå°±åº”è¯¥è€ƒè™‘ä»¥å¤šæ€æ¥æ›¿æ¢å®ƒã€‚ è§£å†³æ–¹æ³• é—®é¢˜æ˜¯å¤šæ€è¯¥å‡ºçŽ°åœ¨å“ªï¼Ÿswitch è¯­å¥å¸¸å¸¸æ ¹æ®ç±»åž‹ç è¿›è¡Œé€‰æ‹©ï¼Œä½ è¦çš„æ˜¯â€œä¸Žè¯¥ç±»åž‹ç ç›¸å…³çš„å‡½æ•°æˆ–ç±»â€ï¼Œæ‰€ä»¥åº”è¯¥è¿ç”¨ æç‚¼å‡½æ•°(Extract Method) å°† switch è¯­å¥æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹å‡½æ•°ä¸­ï¼Œå†ä»¥ æ¬ç§»å‡½æ•°(Move Method) å°†å®ƒæ¬ç§»åˆ°éœ€è¦å¤šæ€æ€§çš„é‚£ä¸ªç±»é‡Œã€‚ å¦‚æžœä½ çš„ switch æ˜¯åŸºäºŽç±»åž‹ç æ¥è¯†åˆ«åˆ†æ”¯ï¼Œè¿™æ—¶å¯ä»¥è¿ç”¨ ä»¥å­ç±»å–ä»£ç±»åž‹ç (Replace Type Code with Subclass) æˆ– ä»¥çŠ¶æ€/ç­–ç•¥æ¨¡å¼å–ä»£ç±»åž‹ç (Replace Type Code with State/Strategy) ã€‚ ä¸€æ—¦å®Œæˆè¿™æ ·çš„ç»§æ‰¿ç»“æž„åŽï¼Œå°±å¯ä»¥è¿ç”¨ ä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼(Replace Conditional with Polymorphism) äº†ã€‚ å¦‚æžœæ¡ä»¶åˆ†æ”¯å¹¶ä¸å¤šå¹¶ä¸”å®ƒä»¬ä½¿ç”¨ä¸åŒå‚æ•°è°ƒç”¨ç›¸åŒçš„å‡½æ•°ï¼Œå¤šæ€å°±æ²¡å¿…è¦äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥è¿ç”¨ ä»¥æ˜Žç¡®å‡½æ•°å–ä»£å‚æ•°(Replace Parameter with Explicit Methods) ã€‚ å¦‚æžœä½ çš„é€‰æ‹©æ¡ä»¶ä¹‹ä¸€æ˜¯ nullï¼Œå¯ä»¥è¿ç”¨ å¼•å…¥ Null å¯¹è±¡(Introduce Null Object) ã€‚ æ”¶ç›Š æå‡ä»£ç ç»„ç»‡æ€§ã€‚ ä½•æ—¶å¿½ç•¥ å¦‚æžœä¸€ä¸ª switch æ“ä½œåªæ˜¯æ‰§è¡Œç®€å•çš„è¡Œä¸ºï¼Œå°±æ²¡æœ‰é‡æž„çš„å¿…è¦äº†ã€‚ switch å¸¸è¢«å·¥åŽ‚è®¾è®¡æ¨¡å¼æ—ï¼ˆå·¥åŽ‚æ–¹æ³•æ¨¡å¼(Factory Method)å’ŒæŠ½è±¡å·¥åŽ‚æ¨¡å¼(Abstract Factory)ï¼‰æ‰€ä½¿ç”¨ï¼Œè¿™ç§æƒ…å†µä¸‹ä¹Ÿæ²¡å¿…è¦é‡æž„ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž æç‚¼å‡½æ•°(Extract Method) é—®é¢˜ ä½ æœ‰ä¸€æ®µä»£ç å¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ã€‚ void printOwing() &#123; printBanner(); //print details System.out.println("name: " + name); System.out.println("amount: " + getOutstanding());&#125; è§£å†³ ç§»åŠ¨è¿™æ®µä»£ç åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•°ä¸­ï¼Œä½¿ç”¨å‡½æ•°çš„è°ƒç”¨æ¥æ›¿ä»£è€ä»£ç ã€‚ void printOwing() &#123; printBanner(); printDetails(getOutstanding());&#125;void printDetails(double outstanding) &#123; System.out.println("name: " + name); System.out.println("amount: " + outstanding);&#125; æ¬ç§»å‡½æ•°(Move Method) é—®é¢˜ ä½ çš„ç¨‹åºä¸­ï¼Œæœ‰ä¸ªå‡½æ•°ä¸Žå…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»è¿›è¡Œæ›´å¤šäº¤æµï¼šè°ƒç”¨åŽè€…ï¼Œæˆ–è¢«åŽè€…è°ƒç”¨ã€‚ è§£å†³ åœ¨è¯¥å‡½æ•°æœ€å¸¸å¼•ç”¨çš„ç±»ä¸­å»ºç«‹ä¸€ä¸ªæœ‰ç€ç±»ä¼¼è¡Œä¸ºçš„æ–°å‡½æ•°ã€‚å°†æ—§å‡½æ•°å˜æˆä¸€ä¸ªå•çº¯çš„å§”æ‰˜å‡½æ•°ï¼Œæˆ–æ˜¯æ—§å‡½æ•°å®Œå…¨ç§»é™¤ã€‚ ä»¥å­ç±»å–ä»£ç±»åž‹ç (Replace Type Code with Subclass) é—®é¢˜ ä½ æœ‰ä¸€ä¸ªä¸å¯å˜çš„ç±»åž‹ç ï¼Œå®ƒä¼šå½±å“ç±»çš„è¡Œä¸ºã€‚ è§£å†³ ä»¥å­ç±»å–ä»£è¿™ä¸ªç±»åž‹ç ã€‚ ä»¥çŠ¶æ€/ç­–ç•¥æ¨¡å¼å–ä»£ç±»åž‹ç (Replace Type Code with State/Strategy) é—®é¢˜ ä½ æœ‰ä¸€ä¸ªç±»åž‹ç ï¼Œå®ƒä¼šå½±å“ç±»çš„è¡Œä¸ºï¼Œä½†ä½ æ— æ³•é€šè¿‡ç»§æ‰¿æ¶ˆé™¤å®ƒã€‚ è§£å†³ ä»¥çŠ¶æ€å¯¹è±¡å–ä»£ç±»åž‹ç ã€‚ ä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼(Replace Conditional with Polymorphism) é—®é¢˜ ä½ æ‰‹ä¸Šæœ‰ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œå®ƒæ ¹æ®å¯¹è±¡ç±»åž‹çš„ä¸åŒè€Œé€‰æ‹©ä¸åŒçš„è¡Œä¸ºã€‚ class Bird &#123; //... double getSpeed() &#123; switch (type) &#123; case EUROPEAN: return getBaseSpeed(); case AFRICAN: return getBaseSpeed() - getLoadFactor() * numberOfCoconuts; case NORWEGIAN_BLUE: return (isNailed) ? 0 : getBaseSpeed(voltage); &#125; throw new RuntimeException("Should be unreachable"); &#125;&#125; è§£å†³ å°†è¿™ä¸ªæ¡ä»¶è¡¨è¾¾å¼çš„æ¯ä¸ªåˆ†æ”¯æ”¾è¿›ä¸€ä¸ªå­ç±»å†…çš„è¦†å†™å‡½æ•°ä¸­ï¼Œç„¶åŽå°†åŽŸå§‹å‡½æ•°å£°æ˜Žä¸ºæŠ½è±¡å‡½æ•°ã€‚ abstract class Bird &#123; //... abstract double getSpeed();&#125;class European extends Bird &#123; double getSpeed() &#123; return getBaseSpeed(); &#125;&#125;class African extends Bird &#123; double getSpeed() &#123; return getBaseSpeed() - getLoadFactor() * numberOfCoconuts; &#125;&#125;class NorwegianBlue extends Bird &#123; double getSpeed() &#123; return (isNailed) ? 0 : getBaseSpeed(voltage); &#125;&#125;// Somewhere in client codespeed = bird.getSpeed(); ä»¥æ˜Žç¡®å‡½æ•°å–ä»£å‚æ•°(Replace Parameter with Explicit Methods) é—®é¢˜ ä½ æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä¸­å®Œå…¨å–å†³äºŽå‚æ•°å€¼è€Œé‡‡å–ä¸åŒçš„è¡Œä¸ºã€‚ void setValue(String name, int value) &#123; if (name.equals("height")) &#123; height = value; return; &#125; if (name.equals("width")) &#123; width = value; return; &#125; Assert.shouldNeverReachHere();&#125; è§£å†³ é’ˆå¯¹è¯¥å‚æ•°çš„æ¯ä¸€ä¸ªå¯èƒ½å€¼ï¼Œå»ºç«‹ä¸€ä¸ªç‹¬ç«‹å‡½æ•°ã€‚ void setHeight(int arg) &#123; height = arg;&#125;void setWidth(int arg) &#123; width = arg;&#125; å¼•å…¥ Null å¯¹è±¡(Introduce Null Object) é—®é¢˜ ä½ éœ€è¦å†ä¸‰æ£€æŸ¥æŸå¯¹è±¡æ˜¯å¦ä¸º nullã€‚ if (customer == null) &#123; plan = BillingPlan.basic();&#125;else &#123; plan = customer.getPlan();&#125; è§£å†³ å°† null å€¼æ›¿æ¢ä¸º null å¯¹è±¡ã€‚ class NullCustomer extends Customer &#123; Plan getPlan() &#123; return new NullPlan(); &#125; // Some other NULL functionality.&#125;// Replace null values with Null-object.customer = (order.customer != null) ? order.customer : new NullCustomer();// Use Null-object as if it's normal subclass.plan = customer.getPlan(); ä¸´æ—¶å­—æ®µ ä¸´æ—¶å­—æ®µ(Temporary Field)çš„å€¼åªåœ¨ç‰¹å®šçŽ¯å¢ƒä¸‹æœ‰æ„ä¹‰ï¼Œç¦»å¼€è¿™ä¸ªçŽ¯å¢ƒï¼Œå®ƒä»¬å°±ä»€ä¹ˆä¹Ÿä¸æ˜¯äº†ã€‚ é—®é¢˜åŽŸå›  æœ‰æ—¶ä½ ä¼šçœ‹åˆ°è¿™æ ·çš„å¯¹è±¡ï¼šå…¶å†…æŸä¸ªå®žä¾‹å˜é‡ä»…ä¸ºæŸç§ç‰¹å®šæƒ…å†µè€Œè®¾ã€‚è¿™æ ·çš„ä»£ç è®©äººä¸æ˜“ç†è§£ï¼Œå› ä¸ºä½ é€šå¸¸è®¤ä¸ºå¯¹è±¡åœ¨æ‰€æœ‰æ—¶å€™éƒ½éœ€è¦å®ƒçš„æ‰€æœ‰å˜é‡ã€‚åœ¨å˜é‡æœªè¢«ä½¿ç”¨çš„æƒ…å†µä¸‹çŒœæµ‹å½“åˆè®¾ç½®ç›®çš„ï¼Œä¼šè®©ä½ å‘ç–¯ã€‚ é€šå¸¸ï¼Œä¸´æ—¶å­—æ®µæ˜¯åœ¨æŸä¸€ç®—æ³•éœ€è¦å¤§é‡è¾“å…¥æ—¶è€Œåˆ›å»ºã€‚å› æ­¤ï¼Œä¸ºäº†é¿å…å‡½æ•°æœ‰è¿‡å¤šå‚æ•°ï¼Œç¨‹åºå‘˜å†³å®šåœ¨ç±»ä¸­åˆ›å»ºè¿™äº›æ•°æ®çš„ä¸´æ—¶å­—æ®µã€‚è¿™äº›ä¸´æ—¶å­—æ®µä»…ä»…åœ¨ç®—æ³•ä¸­ä½¿ç”¨ï¼Œå…¶ä»–æ—¶å€™å´æ¯«æ— ç”¨å¤„ã€‚ è¿™ç§ä»£ç ä¸å¥½ç†è§£ã€‚ä½ æœŸæœ›æŸ¥çœ‹å¯¹è±¡å­—æ®µçš„æ•°æ®ï¼Œä½†æ˜¯å‡ºäºŽæŸç§åŽŸå› ï¼Œå®ƒä»¬æ€»æ˜¯ä¸ºç©ºã€‚ è§£å†³æ–¹æ³• å¯ä»¥é€šè¿‡ æç‚¼ç±»(Extract Class) å°†ä¸´æ—¶å­—æ®µå’Œæ“ä½œå®ƒä»¬çš„æ‰€æœ‰ä»£ç æç‚¼åˆ°ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸­ã€‚æ­¤å¤–ï¼Œä½ å¯ä»¥è¿ç”¨ ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°(Replace Method with Method Object) æ¥å®žçŽ°åŒæ ·çš„ç›®çš„ã€‚ å¼•å…¥ Null å¯¹è±¡(Introduce Null Object) åœ¨â€œå˜é‡ä¸åˆæ³•â€çš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ª null å¯¹è±¡ï¼Œä»Žè€Œé¿å…å†™å‡ºæ¡ä»¶è¡¨è¾¾å¼ã€‚ æ”¶ç›Š æ›´å¥½çš„ä»£ç æ¸…æ™°åº¦å’Œç»„ç»‡æ€§ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž æç‚¼ç±»(Extract Class) é—®é¢˜ æŸä¸ªç±»åšäº†ä¸æ­¢ä¸€ä»¶äº‹ã€‚ è§£å†³ å»ºç«‹ä¸€ä¸ªæ–°ç±»ï¼Œå°†ç›¸å…³çš„å­—æ®µå’Œå‡½æ•°ä»Žæ—§ç±»æ¬ç§»åˆ°æ–°ç±»ã€‚ ä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°(Replace Method with Method Object) é—®é¢˜ ä½ æœ‰ä¸€ä¸ªè¿‡é•¿å‡½æ•°ï¼Œå®ƒçš„å±€éƒ¨å˜é‡äº¤ç»‡åœ¨ä¸€èµ·ï¼Œä»¥è‡´äºŽä½ æ— æ³•åº”ç”¨æç‚¼å‡½æ•°(Extract Method) ã€‚ class Order &#123; //... public double price() &#123; double primaryBasePrice; double secondaryBasePrice; double tertiaryBasePrice; // long computation. //... &#125;&#125; è§£å†³ å°†å‡½æ•°ç§»åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ç±»ä¸­ï¼Œä½¿å¾—å±€éƒ¨å˜é‡æˆäº†è¿™ä¸ªç±»çš„å­—æ®µã€‚ç„¶åŽï¼Œä½ å¯ä»¥å°†å‡½æ•°åˆ†å‰²æˆè¿™ä¸ªç±»ä¸­çš„å¤šä¸ªå‡½æ•°ã€‚ class Order &#123; //... public double price() &#123; return new PriceCalculator(this).compute(); &#125;&#125;class PriceCalculator &#123; private double primaryBasePrice; private double secondaryBasePrice; private double tertiaryBasePrice; public PriceCalculator(Order order) &#123; // copy relevant information from order object. //... &#125; public double compute() &#123; // long computation. //... &#125;&#125; å¼•å…¥ Null å¯¹è±¡(Introduce Null Object) é—®é¢˜ ä½ éœ€è¦å†ä¸‰æ£€æŸ¥æŸå¯¹è±¡æ˜¯å¦ä¸º nullã€‚ if (customer == null) &#123; plan = BillingPlan.basic();&#125;else &#123; plan = customer.getPlan();&#125; è§£å†³ å°† null å€¼æ›¿æ¢ä¸º null å¯¹è±¡ã€‚ class NullCustomer extends Customer &#123; Plan getPlan() &#123; return new NullPlan(); &#125; // Some other NULL functionality.&#125;// Replace null values with Null-object.customer = (order.customer != null) ? order.customer : new NullCustomer();// Use Null-object as if it's normal subclass.plan = customer.getPlan(); å¼‚æ›²åŒå·¥çš„ç±» å¼‚æ›²åŒå·¥çš„ç±»(Alternative Classes with Different Interfaces) ä¸¤ä¸ªç±»ä¸­æœ‰ç€ä¸åŒçš„å‡½æ•°ï¼Œå´åœ¨åšç€åŒä¸€ä»¶äº‹ã€‚ é—®é¢˜åŽŸå›  è¿™ç§æƒ…å†µå¾€å¾€æ˜¯å› ä¸ºï¼šåˆ›å»ºè¿™ä¸ªç±»çš„ç¨‹åºå‘˜å¹¶ä¸çŸ¥é“å·²ç»æœ‰å®žçŽ°è¿™ä¸ªåŠŸèƒ½çš„ç±»å­˜åœ¨äº†ã€‚ è§£å†³æ–¹æ³• å¦‚æžœä¸¤ä¸ªå‡½æ•°åšåŒä¸€ä»¶äº‹ï¼Œå´æœ‰ç€ä¸åŒçš„ç­¾åï¼Œè¯·è¿ç”¨ å‡½æ•°æ”¹å(Rename Method) æ ¹æ®å®ƒä»¬çš„ç”¨é€”é‡æ–°å‘½åã€‚ è¿ç”¨ æ¬ç§»å‡½æ•°(Move Method) ã€ æ·»åŠ å‚æ•°(Add Parameter) å’Œ ä»¤å‡½æ•°æºå¸¦å‚æ•°(Parameterize Method) æ¥ä½¿å¾—æ–¹æ³•çš„åç§°å’Œå®žçŽ°ä¸€è‡´ã€‚ å¦‚æžœä¸¤ä¸ªç±»ä»…æœ‰éƒ¨åˆ†åŠŸèƒ½æ˜¯é‡å¤çš„ï¼Œå°è¯•è¿ç”¨ æç‚¼è¶…ç±»(Extract Superclass) ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå·²å­˜åœ¨çš„ç±»å°±æˆäº†è¶…ç±»ã€‚ å½“æœ€ç»ˆé€‰æ‹©å¹¶è¿ç”¨æŸç§æ–¹æ³•æ¥é‡æž„åŽï¼Œä¹Ÿè®¸ä½ å°±èƒ½åˆ é™¤å…¶ä¸­ä¸€ä¸ªç±»äº†ã€‚ æ”¶ç›Š æ¶ˆé™¤äº†ä¸å¿…è¦çš„é‡å¤ä»£ç ï¼Œä¸ºä»£ç ç˜¦èº«äº†ã€‚ ä»£ç æ›´æ˜“è¯»ï¼ˆä¸å†éœ€è¦çŒœæµ‹ä¸ºä»€ä¹ˆè¦æœ‰ä¸¤ä¸ªåŠŸèƒ½ç›¸åŒçš„ç±»ï¼‰ã€‚ ä½•æ—¶å¿½ç•¥ æœ‰æ—¶åˆå¹¶ç±»æ˜¯ä¸å¯èƒ½çš„ï¼Œæˆ–è€…æ˜¯å¦‚æ­¤å›°éš¾ä»¥è‡³äºŽæ²¡æœ‰æ„ä¹‰ã€‚ä¾‹å¦‚ï¼šä¸¤ä¸ªåŠŸèƒ½ç›¸ä¼¼çš„ç±»å­˜åœ¨äºŽä¸åŒçš„ lib åº“ä¸­ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž å‡½æ•°æ”¹å(Rename Method) é—®é¢˜ å‡½æ•°çš„åç§°æœªèƒ½æ°å½“çš„æ­ç¤ºå‡½æ•°çš„ç”¨é€”ã€‚ class Person &#123; public String getsnm();&#125; è§£å†³ ä¿®æ”¹å‡½æ•°åã€‚ class Person &#123; public String getSecondName();&#125; æ¬ç§»å‡½æ•°(Move Method) é—®é¢˜ ä½ çš„ç¨‹åºä¸­ï¼Œæœ‰ä¸ªå‡½æ•°ä¸Žå…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»è¿›è¡Œæ›´å¤šäº¤æµï¼šè°ƒç”¨åŽè€…ï¼Œæˆ–è¢«åŽè€…è°ƒç”¨ã€‚ è§£å†³ åœ¨è¯¥å‡½æ•°æœ€å¸¸å¼•ç”¨çš„ç±»ä¸­å»ºç«‹ä¸€ä¸ªæœ‰ç€ç±»ä¼¼è¡Œä¸ºçš„æ–°å‡½æ•°ã€‚å°†æ—§å‡½æ•°å˜æˆä¸€ä¸ªå•çº¯çš„å§”æ‰˜å‡½æ•°ï¼Œæˆ–æ˜¯æ—§å‡½æ•°å®Œå…¨ç§»é™¤ã€‚ æ·»åŠ å‚æ•°(Add Parameter) é—®é¢˜ æŸä¸ªå‡½æ•°éœ€è¦ä»Žè°ƒç”¨ç«¯å¾—åˆ°æ›´å¤šä¿¡æ¯ã€‚ class Customer &#123; public Contact getContact();&#125; è§£å†³ ä¸ºæ­¤å‡½æ•°æ·»åŠ ä¸€ä¸ªå¯¹è±¡å‡½æ•°ï¼Œè®©æ”¹å¯¹è±¡å¸¦è¿›å‡½æ•°æ‰€éœ€ä¿¡æ¯ã€‚ class Customer &#123; public Contact getContact(Date date);&#125; ä»¤å‡½æ•°æºå¸¦å‚æ•°(Parameterize Method) é—®é¢˜ è‹¥å¹²å‡½æ•°åšäº†ç±»ä¼¼çš„å·¥ä½œï¼Œä½†åœ¨å‡½æ•°æœ¬ä½“ä¸­å´åŒ…å«äº†ä¸åŒçš„å€¼ã€‚ **è§£å†³** å»ºç«‹å•ä¸€å‡½æ•°ï¼Œä»¥å‚æ•°è¡¨è¾¾å“ªäº›ä¸åŒçš„å€¼ã€‚ æç‚¼è¶…ç±»(Extract Superclass) é—®é¢˜ ä¸¤ä¸ªç±»æœ‰ç›¸ä¼¼ç‰¹æ€§ã€‚ è§£å†³ ä¸ºè¿™ä¸¤ä¸ªç±»å»ºç«‹ä¸€ä¸ªè¶…ç±»ï¼Œå°†ç›¸åŒç‰¹æ€§ç§»è‡³è¶…ç±»ã€‚ è¢«æ‹’ç»çš„é¦ˆèµ  è¢«æ‹’ç»çš„é¦ˆèµ (Refused Bequest) å­ç±»ä»…ä»…ä½¿ç”¨çˆ¶ç±»ä¸­çš„éƒ¨åˆ†æ–¹æ³•å’Œå±žæ€§ã€‚å…¶ä»–æ¥è‡ªçˆ¶ç±»çš„é¦ˆèµ æˆä¸ºäº†ç´¯èµ˜ã€‚ é—®é¢˜åŽŸå›  æœ‰äº›äººä»…ä»…æ˜¯æƒ³é‡ç”¨è¶…ç±»ä¸­çš„éƒ¨åˆ†ä»£ç è€Œåˆ›å»ºäº†å­ç±»ã€‚ä½†å®žé™…ä¸Šè¶…ç±»å’Œå­ç±»å®Œå…¨ä¸åŒã€‚ è§£å†³æ–¹æ³• å¦‚æžœç»§æ‰¿æ²¡æœ‰æ„ä¹‰å¹¶ä¸”å­ç±»å’Œçˆ¶ç±»ä¹‹é—´ç¡®å®žæ²¡æœ‰å…±åŒç‚¹ï¼Œå¯ä»¥è¿ç”¨ ä»¥å§”æ‰˜å–ä»£ç»§æ‰¿(Replace Inheritance with Delegation) æ¶ˆé™¤ç»§æ‰¿ã€‚ å¦‚æžœç»§æ‰¿æ˜¯é€‚å½“çš„ï¼Œåˆ™åŽ»é™¤å­ç±»ä¸­ä¸éœ€è¦çš„å­—æ®µå’Œæ–¹æ³•ã€‚è¿ç”¨ æç‚¼è¶…ç±»(Extract Superclass) å°†æ‰€æœ‰è¶…ç±»ä¸­å¯¹äºŽå­ç±»æœ‰ç”¨çš„å­—æ®µå’Œå‡½æ•°æå–å‡ºæ¥ï¼Œç½®å…¥ä¸€ä¸ªæ–°çš„è¶…ç±»ä¸­ï¼Œç„¶åŽè®©ä¸¤ä¸ªç±»éƒ½ç»§æ‰¿è‡ªå®ƒã€‚ æ”¶ç›Š æé«˜ä»£ç çš„æ¸…æ™°åº¦å’Œç»„ç»‡æ€§ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž ä»¥å§”æ‰˜å–ä»£ç»§æ‰¿(Replace Inheritance with Delegation) é—®é¢˜ æŸä¸ªå­ç±»åªä½¿ç”¨è¶…ç±»æŽ¥å£ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–æ˜¯æ ¹æœ¬ä¸éœ€è¦ç»§æ‰¿è€Œæ¥çš„æ•°æ®ã€‚ è§£å†³ åœ¨å­ç±»ä¸­æ–°å»ºä¸€ä¸ªå­—æ®µç”¨ä»¥ä¿å­˜è¶…ç±»ï¼› è°ƒæ•´å­ç±»å‡½æ•°ï¼Œä»¤å®ƒæ”¹è€Œå§”æ‰˜è¶…ç±»ï¼› ç„¶åŽåŽ»æŽ‰ä¸¤è€…ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ã€‚ æç‚¼è¶…ç±»(Extract Superclass) é—®é¢˜ ä¸¤ä¸ªç±»æœ‰ç›¸ä¼¼ç‰¹æ€§ã€‚ è§£å†³ ä¸ºè¿™ä¸¤ä¸ªç±»å»ºç«‹ä¸€ä¸ªè¶…ç±»ï¼Œå°†ç›¸åŒç‰¹æ€§ç§»è‡³è¶…ç±»ã€‚ æ‰©å±•é˜…è¯» ä»£ç çš„åå‘³é“å’Œé‡æž„ ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿ ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡ ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢ ä»£ç åå‘³é“ä¹‹éžå¿…è¦çš„ ä»£ç åå‘³é“ä¹‹è€¦åˆ å‚è€ƒèµ„æ–™ é‡æž„â€”â€”æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ - by Martin Fowler https://sourcemaking.com/refactoring]]></content>
      <categories>
        <category>design</category>
        <category>refactor</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>refactor</tag>
        <tag>code-smell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è´Ÿè½½å‡è¡¡]]></title>
    <url>%2Fblog%2F2018%2F10%2F13%2Fdesign%2Farchitecture%2F%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%2F</url>
    <content type="text"><![CDATA[è´Ÿè½½å‡è¡¡ 1. è´Ÿè½½å‡è¡¡åŽŸç† 2. è´Ÿè½½å‡è¡¡åˆ†ç±» 2.1. DNS è´Ÿè½½å‡è¡¡ 2.2. IP è´Ÿè½½å‡è¡¡ 2.3. é“¾è·¯å±‚è´Ÿè½½å‡è¡¡ 2.4. æ··åˆåž‹è´Ÿè½½å‡è¡¡ 3. è´Ÿè½½å‡è¡¡ç®—æ³• 3.1. è½®è¯¢ 3.2. éšæœº 3.3. æœ€å°‘è¿žæŽ¥ 3.4. Hashï¼ˆæºåœ°å€æ•£åˆ—ï¼‰ 3.5. åŠ æƒ 4. ç¡¬ä»¶è´Ÿè½½å‡è¡¡ 5. Ngnix è´Ÿè½½å‡è¡¡ 5.1. Ngnix ç‰¹ç‚¹ 5.2. Ngnix åŠŸèƒ½ 5.3. Ngnix æž¶æž„ 5.4. Ngnix å‡è¡¡ç­–ç•¥ 5.5. Ngnix åœºæ™¯ 6. LVS è´Ÿè½½å‡è¡¡ 6.1. LVS åŠŸèƒ½ 6.2. LVS æž¶æž„ 6.3. LVS å‡è¡¡ç­–ç•¥ 6.4. LVS åœºæ™¯ 7. HaProxy è´Ÿè½½å‡è¡¡ 7.1. HaProxy ç‰¹ç‚¹ 7.2. HaProxy å‡è¡¡ç­–ç•¥ 8. èµ„æ–™ 1. è´Ÿè½½å‡è¡¡åŽŸç† ç³»ç»Ÿçš„æ‰©å±•å¯åˆ†ä¸ºçºµå‘ï¼ˆåž‚ç›´ï¼‰æ‰©å±•å’Œæ¨ªå‘ï¼ˆæ°´å¹³ï¼‰æ‰©å±•ã€‚çºµå‘æ‰©å±•ï¼Œæ˜¯ä»Žå•æœºçš„è§’åº¦é€šè¿‡å¢žåŠ ç¡¬ä»¶å¤„ç†èƒ½åŠ›ï¼Œæ¯”å¦‚ CPU å¤„ç†èƒ½åŠ›ï¼Œå†…å­˜å®¹é‡ï¼Œç£ç›˜ç­‰æ–¹é¢ï¼Œå®žçŽ°æœåŠ¡å™¨å¤„ç†èƒ½åŠ›çš„æå‡ï¼Œä¸èƒ½æ»¡è¶³å¤§åž‹åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆç½‘ç«™ï¼‰ï¼Œå¤§æµé‡ï¼Œé«˜å¹¶å‘ï¼Œæµ·é‡æ•°æ®çš„é—®é¢˜ã€‚å› æ­¤éœ€è¦é‡‡ç”¨æ¨ªå‘æ‰©å±•çš„æ–¹å¼ï¼Œé€šè¿‡æ·»åŠ æœºå™¨æ¥æ»¡è¶³å¤§åž‹ç½‘ç«™æœåŠ¡çš„å¤„ç†èƒ½åŠ›ã€‚æ¯”å¦‚ï¼šä¸€å°æœºå™¨ä¸èƒ½æ»¡è¶³ï¼Œåˆ™å¢žåŠ ä¸¤å°æˆ–è€…å¤šå°æœºå™¨ï¼Œå…±åŒæ‰¿æ‹…è®¿é—®åŽ‹åŠ›ã€‚è¿™å°±æ˜¯å…¸åž‹çš„é›†ç¾¤å’Œè´Ÿè½½å‡è¡¡æž¶æž„ï¼šå¦‚ä¸‹å›¾ï¼š åº”ç”¨é›†ç¾¤ï¼šå°†åŒä¸€åº”ç”¨éƒ¨ç½²åˆ°å¤šå°æœºå™¨ä¸Šï¼Œç»„æˆå¤„ç†é›†ç¾¤ï¼ŒæŽ¥æ”¶è´Ÿè½½å‡è¡¡è®¾å¤‡åˆ†å‘çš„è¯·æ±‚ï¼Œè¿›è¡Œå¤„ç†ï¼Œå¹¶è¿”å›žç›¸åº”æ•°æ®ã€‚ è´Ÿè½½å‡è¡¡è®¾å¤‡ï¼šå°†ç”¨æˆ·è®¿é—®çš„è¯·æ±‚ï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåˆ†å‘åˆ°é›†ç¾¤ä¸­çš„ä¸€å°å¤„ç†æœåŠ¡å™¨ã€‚ï¼ˆä¸€ç§æŠŠç½‘ç»œè¯·æ±‚åˆ†æ•£åˆ°ä¸€ä¸ªæœåŠ¡å™¨é›†ç¾¤ä¸­çš„å¯ç”¨æœåŠ¡å™¨ä¸ŠåŽ»çš„è®¾å¤‡ï¼‰ è´Ÿè½½å‡è¡¡çš„ä½œç”¨ï¼ˆè§£å†³çš„é—®é¢˜ï¼‰ï¼š è§£å†³å¹¶å‘åŽ‹åŠ›ï¼Œæé«˜åº”ç”¨å¤„ç†æ€§èƒ½ï¼ˆå¢žåŠ åžåé‡ï¼ŒåŠ å¼ºç½‘ç»œå¤„ç†èƒ½åŠ›ï¼‰ï¼› æä¾›æ•…éšœè½¬ç§»ï¼Œå®žçŽ°é«˜å¯ç”¨ï¼› é€šè¿‡æ·»åŠ æˆ–å‡å°‘æœåŠ¡å™¨æ•°é‡ï¼Œæä¾›ç½‘ç«™ä¼¸ç¼©æ€§ï¼ˆæ‰©å±•æ€§ï¼‰ï¼› å®‰å…¨é˜²æŠ¤ï¼›ï¼ˆè´Ÿè½½å‡è¡¡è®¾å¤‡ä¸Šåšä¸€äº›è¿‡æ»¤ï¼Œé»‘ç™½åå•ç­‰å¤„ç†ï¼‰ 2. è´Ÿè½½å‡è¡¡åˆ†ç±» æ ¹æ®å®žçŽ°æŠ€æœ¯ä¸åŒï¼Œå¯åˆ†ä¸º DNS è´Ÿè½½å‡è¡¡ï¼ŒHTTP è´Ÿè½½å‡è¡¡ï¼ŒIP è´Ÿè½½å‡è¡¡ï¼Œé“¾è·¯å±‚è´Ÿè½½å‡è¡¡ç­‰ã€‚ 2.1. DNS è´Ÿè½½å‡è¡¡ æœ€æ—©çš„è´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œåˆ©ç”¨åŸŸåè§£æžå®žçŽ°è´Ÿè½½å‡è¡¡ï¼Œåœ¨ DNS æœåŠ¡å™¨ï¼Œé…ç½®å¤šä¸ª A è®°å½•ï¼Œè¿™äº› A è®°å½•å¯¹åº”çš„æœåŠ¡å™¨æž„æˆé›†ç¾¤ã€‚å¤§åž‹ç½‘ç«™æ€»æ˜¯éƒ¨åˆ†ä½¿ç”¨ DNS è§£æžï¼Œä½œä¸ºç¬¬ä¸€çº§è´Ÿè½½å‡è¡¡ã€‚å¦‚ä¸‹å›¾ï¼š ä¼˜ç‚¹ ä½¿ç”¨ç®€å•ï¼šè´Ÿè½½å‡è¡¡å·¥ä½œï¼Œäº¤ç»™ DNS æœåŠ¡å™¨å¤„ç†ï¼ŒçœæŽ‰äº†è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ç»´æŠ¤çš„éº»çƒ¦ æé«˜æ€§èƒ½ï¼šå¯ä»¥æ”¯æŒåŸºäºŽåœ°å€çš„åŸŸåè§£æžï¼Œè§£æžæˆè·ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡å™¨åœ°å€ï¼Œå¯ä»¥åŠ å¿«è®¿é—®é€Ÿåº¦ï¼Œæ”¹å–„æ€§èƒ½ï¼› ç¼ºç‚¹ å¯ç”¨æ€§å·®ï¼šDNS è§£æžæ˜¯å¤šçº§è§£æžï¼Œæ–°å¢ž/ä¿®æ”¹ DNS åŽï¼Œè§£æžæ—¶é—´è¾ƒé•¿ï¼›è§£æžè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è®¿é—®ç½‘ç«™å°†å¤±è´¥ï¼› æ‰©å±•æ€§ä½Žï¼šDNS è´Ÿè½½å‡è¡¡çš„æŽ§åˆ¶æƒåœ¨åŸŸåå•†é‚£é‡Œï¼Œæ— æ³•å¯¹å…¶åšæ›´å¤šçš„æ”¹å–„å’Œæ‰©å±•ï¼› ç»´æŠ¤æ€§å·®ï¼šä¹Ÿä¸èƒ½åæ˜ æœåŠ¡å™¨çš„å½“å‰è¿è¡ŒçŠ¶æ€ï¼›æ”¯æŒçš„ç®—æ³•å°‘ï¼›ä¸èƒ½åŒºåˆ†æœåŠ¡å™¨çš„å·®å¼‚ï¼ˆä¸èƒ½æ ¹æ®ç³»ç»Ÿä¸ŽæœåŠ¡çš„çŠ¶æ€æ¥åˆ¤æ–­è´Ÿè½½ï¼‰ å®žè·µå»ºè®® å°† DNS ä½œä¸ºç¬¬ä¸€çº§è´Ÿè½½å‡è¡¡ï¼ŒA è®°å½•å¯¹åº”ç€å†…éƒ¨è´Ÿè½½å‡è¡¡çš„ IP åœ°å€ï¼Œé€šè¿‡å†…éƒ¨è´Ÿè½½å‡è¡¡å°†è¯·æ±‚åˆ†å‘åˆ°çœŸå®žçš„ Web æœåŠ¡å™¨ä¸Šã€‚ä¸€èˆ¬ç”¨äºŽäº’è”ç½‘å…¬å¸ï¼Œå¤æ‚çš„ä¸šåŠ¡ç³»ç»Ÿä¸åˆé€‚ä½¿ç”¨ã€‚å¦‚ä¸‹å›¾ï¼š 2.2. IP è´Ÿè½½å‡è¡¡ åœ¨ç½‘ç»œå±‚é€šè¿‡ä¿®æ”¹è¯·æ±‚ç›®æ ‡åœ°å€è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ ç”¨æˆ·è¯·æ±‚æ•°æ®åŒ…ï¼Œåˆ°è¾¾è´Ÿè½½å‡è¡¡æœåŠ¡å™¨åŽï¼Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸è¿›ç¨‹èŽ·å–ç½‘ç»œæ•°æ®åŒ…ï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•å¾—åˆ°ä¸€å°çœŸå®žæœåŠ¡å™¨åœ°å€ï¼Œç„¶åŽå°†è¯·æ±‚ç›®çš„åœ°å€ä¿®æ”¹ä¸ºï¼ŒèŽ·å¾—çš„çœŸå®ž ip åœ°å€ï¼Œä¸éœ€è¦ç»è¿‡ç”¨æˆ·è¿›ç¨‹å¤„ç†ã€‚ çœŸå®žæœåŠ¡å™¨å¤„ç†å®ŒæˆåŽï¼Œå“åº”æ•°æ®åŒ…å›žåˆ°è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œå†å°†æ•°æ®åŒ…æºåœ°å€ä¿®æ”¹ä¸ºè‡ªèº«çš„ ip åœ°å€ï¼Œå‘é€ç»™ç”¨æˆ·æµè§ˆå™¨ã€‚å¦‚ä¸‹å›¾ï¼š IP è´Ÿè½½å‡è¡¡ï¼ŒçœŸå®žç‰©ç†æœåŠ¡å™¨è¿”å›žç»™è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œå­˜åœ¨ä¸¤ç§æ–¹å¼ï¼š è´Ÿè½½å‡è¡¡æœåŠ¡å™¨åœ¨ä¿®æ”¹ç›®çš„ ip åœ°å€çš„åŒæ—¶ä¿®æ”¹æºåœ°å€ã€‚å°†æ•°æ®åŒ…æºåœ°å€è®¾ä¸ºè‡ªèº«ç›˜ï¼Œå³æºåœ°å€è½¬æ¢ï¼ˆsnatï¼‰ã€‚ å°†è´Ÿè½½å‡è¡¡æœåŠ¡å™¨åŒæ—¶ä½œä¸ºçœŸå®žç‰©ç†æœåŠ¡å™¨é›†ç¾¤çš„ç½‘å…³æœåŠ¡å™¨ã€‚ ä¼˜ç‚¹ï¼šåœ¨å†…æ ¸è¿›ç¨‹å®Œæˆæ•°æ®åˆ†å‘ï¼Œæ¯”åœ¨åº”ç”¨å±‚åˆ†å‘æ€§èƒ½æ›´å¥½ï¼› ç¼ºç‚¹ï¼šæ‰€æœ‰è¯·æ±‚å“åº”éƒ½éœ€è¦ç»è¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œé›†ç¾¤æœ€å¤§åžåé‡å—é™äºŽè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ç½‘å¡å¸¦å®½ï¼› 2.3. é“¾è·¯å±‚è´Ÿè½½å‡è¡¡ åœ¨é€šä¿¡åè®®çš„æ•°æ®é“¾è·¯å±‚ä¿®æ”¹ mac åœ°å€ï¼Œè¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ æ•°æ®åˆ†å‘æ—¶ï¼Œä¸ä¿®æ”¹ ip åœ°å€ï¼ŒæŒ‡ä¿®æ”¹ç›®æ ‡ mac åœ°å€ï¼Œé…ç½®çœŸå®žç‰©ç†æœåŠ¡å™¨é›†ç¾¤æ‰€æœ‰æœºå™¨è™šæ‹Ÿ ip å’Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ ip åœ°å€ä¸€è‡´ï¼Œè¾¾åˆ°ä¸ä¿®æ”¹æ•°æ®åŒ…çš„æºåœ°å€å’Œç›®æ ‡åœ°å€ï¼Œè¿›è¡Œæ•°æ®åˆ†å‘çš„ç›®çš„ã€‚ å®žé™…å¤„ç†æœåŠ¡å™¨ ip å’Œæ•°æ®è¯·æ±‚ç›®çš„ ip ä¸€è‡´ï¼Œä¸éœ€è¦ç»è¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è¿›è¡Œåœ°å€è½¬æ¢ï¼Œå¯å°†å“åº”æ•°æ®åŒ…ç›´æŽ¥è¿”å›žç»™ç”¨æˆ·æµè§ˆå™¨ï¼Œé¿å…è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ç½‘å¡å¸¦å®½æˆä¸ºç“¶é¢ˆã€‚ä¹Ÿç§°ä¸ºç›´æŽ¥è·¯ç”±æ¨¡å¼ï¼ˆDR æ¨¡å¼ï¼‰ã€‚å¦‚ä¸‹å›¾ï¼š ä¼˜ç‚¹ï¼šæ€§èƒ½å¥½ï¼› ç¼ºç‚¹ï¼šé…ç½®å¤æ‚ï¼› å®žè·µå»ºè®®ï¼šDR æ¨¡å¼æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„ä¸€ç§è´Ÿè½½å‡è¡¡æ–¹å¼ã€‚ 2.4. æ··åˆåž‹è´Ÿè½½å‡è¡¡ ç”±äºŽå¤šä¸ªæœåŠ¡å™¨ç¾¤å†…ç¡¬ä»¶è®¾å¤‡ã€å„è‡ªçš„è§„æ¨¡ã€æä¾›çš„æœåŠ¡ç­‰çš„å·®å¼‚ï¼Œå¯ä»¥è€ƒè™‘ç»™æ¯ä¸ªæœåŠ¡å™¨ç¾¤é‡‡ç”¨æœ€åˆé€‚çš„è´Ÿè½½å‡è¡¡æ–¹å¼ï¼Œç„¶åŽåˆåœ¨è¿™å¤šä¸ªæœåŠ¡å™¨ç¾¤é—´å†ä¸€æ¬¡è´Ÿè½½å‡è¡¡æˆ–ç¾¤é›†èµ·æ¥ä»¥ä¸€ä¸ªæ•´ä½“å‘å¤–ç•Œæä¾›æœåŠ¡ï¼ˆå³æŠŠè¿™å¤šä¸ªæœåŠ¡å™¨ç¾¤å½“åšä¸€ä¸ªæ–°çš„æœåŠ¡å™¨ç¾¤ï¼‰ï¼Œä»Žè€Œè¾¾åˆ°æœ€ä½³çš„æ€§èƒ½ã€‚å°†è¿™ç§æ–¹å¼ç§°ä¹‹ä¸ºæ··åˆåž‹è´Ÿè½½å‡è¡¡ã€‚ æ­¤ç§æ–¹å¼æœ‰æ—¶ä¹Ÿç”¨äºŽå•å°å‡è¡¡è®¾å¤‡çš„æ€§èƒ½ä¸èƒ½æ»¡è¶³å¤§é‡è¿žæŽ¥è¯·æ±‚çš„æƒ…å†µä¸‹ã€‚æ˜¯ç›®å‰å¤§åž‹äº’è”ç½‘å…¬å¸ï¼Œæ™®éä½¿ç”¨çš„æ–¹å¼ã€‚ æ–¹å¼ä¸€ï¼Œå¦‚ä¸‹å›¾ï¼š ä»¥ä¸Šæ¨¡å¼é€‚åˆæœ‰åŠ¨é™åˆ†ç¦»çš„åœºæ™¯ï¼Œåå‘ä»£ç†æœåŠ¡å™¨ï¼ˆé›†ç¾¤ï¼‰å¯ä»¥èµ·åˆ°ç¼“å­˜å’ŒåŠ¨æ€è¯·æ±‚åˆ†å‘çš„ä½œç”¨ï¼Œå½“æ—¶é™æ€èµ„æºç¼“å­˜åœ¨ä»£ç†æœåŠ¡å™¨æ—¶ï¼Œåˆ™ç›´æŽ¥è¿”å›žåˆ°æµè§ˆå™¨ã€‚å¦‚æžœåŠ¨æ€é¡µé¢åˆ™è¯·æ±‚åŽé¢çš„åº”ç”¨è´Ÿè½½å‡è¡¡ï¼ˆåº”ç”¨é›†ç¾¤ï¼‰ã€‚ æ–¹å¼äºŒï¼Œå¦‚ä¸‹å›¾ï¼š ä»¥ä¸Šæ¨¡å¼ï¼Œé€‚åˆåŠ¨æ€è¯·æ±‚åœºæ™¯ã€‚ å› æ··åˆæ¨¡å¼ï¼Œå¯ä»¥æ ¹æ®å…·ä½“åœºæ™¯ï¼Œçµæ´»æ­é…å„ç§æ–¹å¼ï¼Œä»¥ä¸Šä¸¤ç§æ–¹å¼ä»…ä¾›å‚è€ƒã€‚ 3. è´Ÿè½½å‡è¡¡ç®—æ³• å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡ç®—æ³•æœ‰ï¼šè½®è¯¢ã€éšæœºã€æœ€å°‘è¿žæŽ¥ã€æºåœ°å€æ•£åˆ—ã€åŠ æƒç­‰æ–¹å¼ã€‚ 3.1. è½®è¯¢ å°†æ‰€æœ‰è¯·æ±‚ï¼Œä¾æ¬¡åˆ†å‘åˆ°æ¯å°æœåŠ¡å™¨ä¸Šï¼Œé€‚åˆæœåŠ¡å™¨ç¡¬ä»¶åŒç›¸åŒçš„åœºæ™¯ã€‚ ä¼˜ç‚¹ï¼šæœåŠ¡å™¨è¯·æ±‚æ•°ç›®ç›¸åŒï¼› ç¼ºç‚¹ï¼šæœåŠ¡å™¨åŽ‹åŠ›ä¸ä¸€æ ·ï¼Œä¸é€‚åˆæœåŠ¡å™¨é…ç½®ä¸åŒçš„æƒ…å†µï¼› 3.2. éšæœº è¯·æ±‚éšæœºåˆ†é…åˆ°å„ä¸ªæœåŠ¡å™¨ã€‚ ä¼˜ç‚¹ï¼šä½¿ç”¨ç®€å•ï¼› ç¼ºç‚¹ï¼šä¸é€‚åˆæœºå™¨é…ç½®ä¸åŒçš„åœºæ™¯ï¼› 3.3. æœ€å°‘è¿žæŽ¥ å°†è¯·æ±‚åˆ†é…åˆ°è¿žæŽ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ï¼ˆç›®å‰å¤„ç†è¯·æ±‚æœ€å°‘çš„æœåŠ¡å™¨ï¼‰ã€‚ ä¼˜ç‚¹ï¼šæ ¹æ®æœåŠ¡å™¨å½“å‰çš„è¯·æ±‚å¤„ç†æƒ…å†µï¼ŒåŠ¨æ€åˆ†é…ï¼› ç¼ºç‚¹ï¼šç®—æ³•å®žçŽ°ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ç›‘æŽ§æœåŠ¡å™¨è¯·æ±‚è¿žæŽ¥æ•°ï¼› 3.4. Hashï¼ˆæºåœ°å€æ•£åˆ—ï¼‰ æ ¹æ® IP åœ°å€è¿›è¡Œ Hash è®¡ç®—ï¼Œå¾—åˆ° IP åœ°å€ã€‚ ä¼˜ç‚¹ï¼šå°†æ¥è‡ªåŒä¸€ IP åœ°å€çš„è¯·æ±‚ï¼ŒåŒä¸€ä¼šè¯æœŸå†…ï¼Œè½¬å‘åˆ°ç›¸åŒçš„æœåŠ¡å™¨ï¼›å®žçŽ°ä¼šè¯ç²˜æ»žã€‚ ç¼ºç‚¹ï¼šç›®æ ‡æœåŠ¡å™¨å®•æœºåŽï¼Œä¼šè¯ä¼šä¸¢å¤±ï¼› 3.5. åŠ æƒ åœ¨è½®è¯¢ï¼Œéšæœºï¼Œæœ€å°‘é“¾æŽ¥ï¼ŒHashâ€™ç­‰ç®—æ³•çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡åŠ æƒçš„æ–¹å¼ï¼Œè¿›è¡Œè´Ÿè½½æœåŠ¡å™¨åˆ†é…ã€‚ ä¼˜ç‚¹ï¼šæ ¹æ®æƒé‡ï¼Œè°ƒèŠ‚è½¬å‘æœåŠ¡å™¨çš„è¯·æ±‚æ•°ç›®ï¼› ç¼ºç‚¹ï¼šä½¿ç”¨ç›¸å¯¹å¤æ‚ï¼› 4. ç¡¬ä»¶è´Ÿè½½å‡è¡¡ é‡‡ç”¨ç¡¬ä»¶çš„æ–¹å¼å®žçŽ°è´Ÿè½½å‡è¡¡ï¼Œä¸€èˆ¬æ˜¯å•ç‹¬çš„è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œä»·æ ¼æ˜‚è´µï¼Œä¸€èˆ¬åœŸè±ªçº§å…¬å¸å¯ä»¥è€ƒè™‘ï¼Œä¸šç•Œé¢†å…ˆçš„æœ‰ä¸¤æ¬¾ï¼ŒF5 å’Œ A10ã€‚ ä½¿ç”¨ç¡¬ä»¶è´Ÿè½½å‡è¡¡ï¼Œä¸»è¦è€ƒè™‘ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š ï¼ˆ1ï¼‰åŠŸèƒ½è€ƒè™‘ï¼šåŠŸèƒ½å…¨é¢æ”¯æŒå„å±‚çº§çš„è´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒå…¨é¢çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæ”¯æŒå…¨å±€è´Ÿè½½å‡è¡¡ï¼› ï¼ˆ2ï¼‰æ€§èƒ½è€ƒè™‘ï¼šä¸€èˆ¬è½¯ä»¶è´Ÿè½½å‡è¡¡æ”¯æŒåˆ° 5 ä¸‡çº§å¹¶å‘å·²ç»å¾ˆå›°éš¾äº†ï¼Œç¡¬ä»¶è´Ÿè½½å‡è¡¡å¯ä»¥æ”¯æŒ ï¼ˆ3ï¼‰ç¨³å®šæ€§ï¼šå•†ç”¨ç¡¬ä»¶è´Ÿè½½å‡è¡¡ï¼Œç»è¿‡äº†è‰¯å¥½çš„ä¸¥æ ¼çš„æµ‹è¯•ï¼Œä»Žç»è¿‡å¤§è§„æ¨¡ä½¿ç”¨ï¼Œåœ¨ç¨³å®šæ€§æ–¹é¢é«˜ï¼› ï¼ˆ4ï¼‰å®‰å…¨é˜²æŠ¤ï¼šç¡¬ä»¶å‡è¡¡è®¾å¤‡é™¤å…·å¤‡è´Ÿè½½å‡è¡¡åŠŸèƒ½å¤–ï¼Œè¿˜å…·å¤‡é˜²ç«å¢™ï¼Œé˜² DDOS æ”»å‡»ç­‰å®‰å…¨åŠŸèƒ½ï¼› ï¼ˆ5ï¼‰ç»´æŠ¤è§’åº¦ï¼šæä¾›è‰¯å¥½çš„ç»´æŠ¤ç®¡ç†ç•Œé¢ï¼Œå”®åŽæœåŠ¡å’ŒæŠ€æœ¯æ”¯æŒï¼› ï¼ˆ6ï¼‰åœŸè±ªå…¬å¸ï¼šF5 Big Ip ä»·æ ¼ï¼š15w~55w ä¸ç­‰ï¼›A10 ä»·æ ¼ï¼š55w-100w ä¸ç­‰ï¼› ç¼ºç‚¹ ï¼ˆ1ï¼‰ä»·æ ¼æ˜‚è´µï¼› ï¼ˆ2ï¼‰æ‰©å±•èƒ½åŠ›å·®ï¼› å°ç»“ ï¼ˆ1ï¼‰ä¸€èˆ¬ç¡¬ä»¶çš„è´Ÿè½½å‡è¡¡ä¹Ÿè¦åšåŒæœºé«˜å¯ç”¨ï¼Œå› æ­¤æˆæœ¬ä¼šæ¯”è¾ƒé«˜ã€‚ ï¼ˆ2ï¼‰äº’è”ç½‘å…¬å¸ä¸€èˆ¬ä½¿ç”¨å¼€æºè½¯ä»¶ï¼Œå› æ­¤å¤§éƒ¨åˆ†åº”ç”¨é‡‡ç”¨è½¯ä»¶è´Ÿè½½å‡è¡¡ï¼›éƒ¨åˆ†é‡‡ç”¨ç¡¬ä»¶è´Ÿè½½å‡è¡¡ã€‚ æ¯”å¦‚æŸäº’è”ç½‘å…¬å¸ï¼Œç›®å‰æ˜¯ä½¿ç”¨å‡ å° F5 åšå…¨å±€è´Ÿè½½å‡è¡¡ï¼Œå†…éƒ¨ä½¿ç”¨ Nginx ç­‰è½¯ä»¶è´Ÿè½½å‡è¡¡ã€‚ 5. Ngnix è´Ÿè½½å‡è¡¡ Ngnix æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ Web æœåŠ¡å™¨/åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå·¥ä½œåœ¨ä¸ƒå±‚ Http åè®®çš„è´Ÿè½½å‡è¡¡ç³»ç»Ÿã€‚å…·æœ‰é«˜æ€§èƒ½ã€é«˜å¹¶å‘ã€ä½Žå†…å­˜ä½¿ç”¨ç­‰ç‰¹ç‚¹ã€‚æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Http å’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚Nginx ä½¿ç”¨ epoll and kqueue ä½œä¸ºå¼€å‘æ¨¡åž‹ã€‚èƒ½å¤Ÿæ”¯æŒé«˜è¾¾ 50,000 ä¸ªå¹¶å‘è¿žæŽ¥æ•°çš„å“åº”ã€‚ æ“ä½œç³»ç»Ÿï¼šLiunxï¼ŒWindowsï¼ˆLinuxã€FreeBSDã€Solarisã€Mac OS Xã€AIX ä»¥åŠ Microsoft Windowsï¼‰ å¼€å‘è¯­è¨€ï¼šC å¹¶å‘æ€§èƒ½ï¼šå®˜æ–¹æ”¯æŒæ¯ç§’ 5 ä¸‡å¹¶å‘ï¼Œå®žé™…å›½å†…ä¸€èˆ¬åˆ°æ¯ç§’ 2 ä¸‡å¹¶å‘ï¼Œæœ‰ä¼˜åŒ–åˆ°æ¯ç§’ 10 ä¸‡å¹¶å‘çš„ã€‚å…·ä½“æ€§èƒ½çœ‹åº”ç”¨åœºæ™¯ã€‚ 5.1. Ngnix ç‰¹ç‚¹ 1.æ¨¡å—åŒ–è®¾è®¡ï¼šè‰¯å¥½çš„æ‰©å±•æ€§ï¼Œå¯ä»¥é€šè¿‡æ¨¡å—æ–¹å¼è¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚ 2.é«˜å¯é æ€§ï¼šä¸»æŽ§è¿›ç¨‹å’Œ worker æ˜¯åŒæ­¥å®žçŽ°çš„ï¼Œä¸€ä¸ª worker å‡ºçŽ°é—®é¢˜ï¼Œä¼šç«‹åˆ»å¯åŠ¨å¦ä¸€ä¸ª workerã€‚ 3.å†…å­˜æ¶ˆè€—ä½Žï¼šä¸€ä¸‡ä¸ªé•¿è¿žæŽ¥ï¼ˆkeep-aliveï¼‰,ä»…æ¶ˆè€— 2.5MB å†…å­˜ã€‚ 4.æ”¯æŒçƒ­éƒ¨ç½²ï¼šä¸ç”¨åœæ­¢æœåŠ¡å™¨ï¼Œå®žçŽ°æ›´æ–°é…ç½®æ–‡ä»¶ï¼Œæ›´æ¢æ—¥å¿—æ–‡ä»¶ã€æ›´æ–°æœåŠ¡å™¨ç¨‹åºç‰ˆæœ¬ã€‚ 5.å¹¶å‘èƒ½åŠ›å¼ºï¼šå®˜æ–¹æ•°æ®æ¯ç§’æ”¯æŒ 5 ä¸‡å¹¶å‘ï¼› 6.åŠŸèƒ½ä¸°å¯Œï¼šä¼˜ç§€çš„åå‘ä»£ç†åŠŸèƒ½å’Œçµæ´»çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ 5.2. Ngnix åŠŸèƒ½ åŸºæœ¬åŠŸèƒ½ æ”¯æŒé™æ€èµ„æºçš„ web æœåŠ¡å™¨ã€‚ http,smtp,pop3 åè®®çš„åå‘ä»£ç†æœåŠ¡å™¨ã€ç¼“å­˜ã€è´Ÿè½½å‡è¡¡ï¼› æ”¯æŒ FASTCGIï¼ˆfpmï¼‰ æ”¯æŒæ¨¡å—åŒ–ï¼Œè¿‡æ»¤å™¨ï¼ˆè®©æ–‡æœ¬å¯ä»¥å®žçŽ°åŽ‹ç¼©ï¼ŒèŠ‚çº¦å¸¦å®½ï¼‰,ssl åŠå›¾åƒå¤§å°è°ƒæ•´ã€‚ å†…ç½®çš„å¥åº·æ£€æŸ¥åŠŸèƒ½ åŸºäºŽåç§°å’Œ ip çš„è™šæ‹Ÿä¸»æœº å®šåˆ¶è®¿é—®æ—¥å¿— æ”¯æŒå¹³æ»‘å‡çº§ æ”¯æŒ KEEPALIVE æ”¯æŒ url rewrite æ”¯æŒè·¯å¾„åˆ«å æ”¯æŒåŸºäºŽ IP å’Œç”¨æˆ·åçš„è®¿é—®æŽ§åˆ¶ã€‚ æ”¯æŒä¼ è¾“é€ŸçŽ‡é™åˆ¶ï¼Œæ”¯æŒå¹¶å‘æ•°é™åˆ¶ã€‚ æ‰©å±•åŠŸèƒ½ æ€§èƒ½ Nginx çš„é«˜å¹¶å‘ï¼Œå®˜æ–¹æµ‹è¯•æ”¯æŒ 5 ä¸‡å¹¶å‘è¿žæŽ¥ã€‚å®žé™…ç”Ÿäº§çŽ¯å¢ƒèƒ½åˆ° 2-3 ä¸‡å¹¶å‘è¿žæŽ¥æ•°ã€‚10000 ä¸ªéžæ´»è·ƒçš„ HTTP keep-alive è¿žæŽ¥ä»…å ç”¨çº¦ 2.5MB å†…å­˜ã€‚ä¸‰ä¸‡å¹¶å‘è¿žæŽ¥ä¸‹ï¼Œ10 ä¸ª Nginx è¿›ç¨‹ï¼Œæ¶ˆè€—å†…å­˜ 150Mã€‚æ·˜å® tengine å›¢é˜Ÿæµ‹è¯•ç»“æžœæ˜¯â€œ24G å†…å­˜æœºå™¨ä¸Šï¼Œå¤„ç†å¹¶å‘è¯·æ±‚å¯è¾¾ 200 ä¸‡â€ã€‚ 5.3. Ngnix æž¶æž„ Nginx çš„åŸºæœ¬å·¥ä½œæ¨¡å¼ ä¸€ä¸ª master è¿›ç¨‹ï¼Œç”Ÿæˆä¸€ä¸ªæˆ–è€…å¤šä¸ª worker è¿›ç¨‹ã€‚ä½†æ˜¯è¿™é‡Œ master æ˜¯ä½¿ç”¨ root èº«ä»½å¯åŠ¨çš„ï¼Œå› ä¸º nginx è¦å·¥ä½œåœ¨ 80 ç«¯å£ã€‚è€Œåªæœ‰ç®¡ç†å‘˜æ‰æœ‰æƒé™å¯åŠ¨å°äºŽä½ŽäºŽ 1023 çš„ç«¯å£ã€‚master ä¸»è¦æ˜¯è´Ÿè´£çš„ä½œç”¨åªæ˜¯å¯åŠ¨ workerï¼ŒåŠ è½½é…ç½®æ–‡ä»¶ï¼Œè´Ÿè´£ç³»ç»Ÿçš„å¹³æ»‘å‡çº§ã€‚å…¶å®ƒçš„å·¥ä½œæ˜¯äº¤ç»™ workerã€‚é‚£ä¹ˆå½“ worker è¢«å¯åŠ¨ä¹‹åŽï¼Œä¹Ÿåªæ˜¯è´Ÿè´£ä¸€äº› web æœ€ç®€å•çš„å·¥ä½œï¼Œè€Œå…¶ä»–çš„å·¥ä½œéƒ½æ˜¯æœ‰ worker ä¸­è°ƒç”¨çš„æ¨¡å—æ¥å®žçŽ°çš„ã€‚ æ¨¡å—ä¹‹é—´æ˜¯ä»¥æµæ°´çº¿çš„æ–¹å¼å®žçŽ°åŠŸèƒ½çš„ã€‚æµæ°´çº¿ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ªç”¨æˆ·è¯·æ±‚ï¼Œç”±å¤šä¸ªæ¨¡å—ç»„åˆå„è‡ªçš„åŠŸèƒ½ä¾æ¬¡å®žçŽ°å®Œæˆçš„ã€‚æ¯”å¦‚ï¼šç¬¬ä¸€ä¸ªæ¨¡å—åªè´Ÿè´£åˆ†æžè¯·æ±‚é¦–éƒ¨ï¼Œç¬¬äºŒä¸ªæ¨¡å—åªè´Ÿè´£æŸ¥æ‰¾æ•°æ®ï¼Œç¬¬ä¸‰ä¸ªæ¨¡å—åªè´Ÿè´£åŽ‹ç¼©æ•°æ®ï¼Œä¾æ¬¡å®Œæˆå„è‡ªå·¥ä½œã€‚æ¥å®žçŽ°æ•´ä¸ªå·¥ä½œçš„å®Œæˆã€‚ ä»–ä»¬æ˜¯å¦‚ä½•å®žçŽ°çƒ­éƒ¨ç½²çš„å‘¢ï¼Ÿå…¶å®žæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬å‰é¢è¯´ master ä¸è´Ÿè´£å…·ä½“çš„å·¥ä½œï¼Œè€Œæ˜¯è°ƒç”¨ worker å·¥ä½œï¼Œä»–åªæ˜¯è´Ÿè´£è¯»å–é…ç½®æ–‡ä»¶ï¼Œå› æ­¤å½“ä¸€ä¸ªæ¨¡å—ä¿®æ”¹æˆ–è€…é…ç½®æ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œæ˜¯ç”± master è¿›è¡Œè¯»å–ï¼Œå› æ­¤æ­¤æ—¶ä¸ä¼šå½±å“åˆ° worker å·¥ä½œã€‚åœ¨ master è¿›è¡Œè¯»å–é…ç½®æ–‡ä»¶ä¹‹åŽï¼Œä¸ä¼šç«‹å³çš„æŠŠä¿®æ”¹çš„é…ç½®æ–‡ä»¶å‘ŠçŸ¥ workerã€‚è€Œæ˜¯è®©è¢«ä¿®æ”¹çš„ worker ç»§ç»­ä½¿ç”¨è€çš„é…ç½®æ–‡ä»¶å·¥ä½œï¼Œå½“ worker å·¥ä½œå®Œæ¯•ä¹‹åŽï¼Œç›´æŽ¥å½“æŽ‰è¿™ä¸ªå­è¿›ç¨‹ï¼Œæ›´æ¢æ–°çš„å­è¿›ç¨‹ï¼Œä½¿ç”¨æ–°çš„è§„åˆ™ã€‚ Nginx æ”¯æŒçš„ sendfile æœºåˆ¶ Sendfile æœºåˆ¶ï¼Œç”¨æˆ·å°†è¯·æ±‚å‘ç»™å†…æ ¸ï¼Œå†…æ ¸æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚è°ƒç”¨ç›¸åº”ç”¨æˆ·è¿›ç¨‹ï¼Œè¿›ç¨‹åœ¨å¤„ç†æ—¶éœ€è¦èµ„æºã€‚æ­¤æ—¶å†æŠŠè¯·æ±‚å‘ç»™å†…æ ¸ï¼ˆè¿›ç¨‹æ²¡æœ‰ç›´æŽ¥ IO çš„èƒ½åŠ›ï¼‰ï¼Œç”±å†…æ ¸åŠ è½½æ•°æ®ã€‚å†…æ ¸æŸ¥æ‰¾åˆ°æ•°æ®ä¹‹åŽï¼Œä¼šæŠŠæ•°æ®å¤åˆ¶ç»™ç”¨æˆ·è¿›ç¨‹ï¼Œç”±ç”¨æˆ·è¿›ç¨‹å¯¹æ•°æ®è¿›è¡Œå°è£…ï¼Œä¹‹åŽäº¤ç»™å†…æ ¸ï¼Œå†…æ ¸åœ¨è¿›è¡Œ tcp/ip é¦–éƒ¨çš„å°è£…ï¼Œæœ€åŽå†å‘ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ªåŠŸèƒ½ç”¨æˆ·è¿›ç¨‹åªæ˜¯å‘ç”Ÿäº†ä¸€ä¸ªå°è£…æŠ¥æ–‡çš„è¿‡ç¨‹ï¼Œå´è¦ç»•ä¸€å¤§åœˆã€‚å› æ­¤ nginx å¼•å…¥äº† sendfile æœºåˆ¶ï¼Œä½¿å¾—å†…æ ¸åœ¨æŽ¥å—åˆ°æ•°æ®ä¹‹åŽï¼Œä¸å†ä¾é ç”¨æˆ·è¿›ç¨‹ç»™äºˆå°è£…ï¼Œè€Œæ˜¯è‡ªå·±æŸ¥æ‰¾è‡ªå·±å°è£…ï¼Œå‡å°‘äº†ä¸€ä¸ªå¾ˆé•¿ä¸€æ®µæ—¶é—´çš„æµªè´¹ï¼Œè¿™æ˜¯ä¸€ä¸ªæå‡æ€§èƒ½çš„æ ¸å¿ƒç‚¹ã€‚ ä»¥ä¸Šå†…å®¹æ‘˜è‡ªç½‘å‹å‘å¸ƒçš„æ–‡ç« ï¼Œç®€å•ä¸€å¥è¯æ˜¯èµ„æºçš„å¤„ç†ï¼Œç›´æŽ¥é€šè¿‡å†…æ ¸å±‚è¿›è¡Œæ•°æ®ä¼ é€’ï¼Œé¿å…äº†æ•°æ®ä¼ é€’åˆ°åº”ç”¨å±‚ï¼Œåº”ç”¨å±‚å†ä¼ é€’åˆ°å†…æ ¸å±‚çš„å¼€é”€ã€‚ ç›®å‰é«˜å¹¶å‘çš„å¤„ç†ï¼Œä¸€èˆ¬éƒ½é‡‡ç”¨ sendfile æ¨¡å¼ã€‚é€šè¿‡ç›´æŽ¥æ“ä½œå†…æ ¸å±‚æ•°æ®ï¼Œå‡å°‘åº”ç”¨ä¸Žå†…æ ¸å±‚æ•°æ®ä¼ é€’ã€‚ Nginx é€šä¿¡æ¨¡åž‹ï¼ˆI/O å¤ç”¨æœºåˆ¶ï¼‰ å¼€å‘æ¨¡åž‹ï¼šepoll å’Œ kqueueã€‚ æ”¯æŒçš„äº‹ä»¶æœºåˆ¶ï¼škqueueã€epollã€rt signalsã€/dev/poll ã€event portsã€select ä»¥åŠ pollã€‚ æ”¯æŒçš„ kqueue ç‰¹æ€§åŒ…æ‹¬ EV_CLEARã€EV_DISABLEã€NOTE_LOWATã€EV_EOFï¼Œå¯ç”¨æ•°æ®çš„æ•°é‡ï¼Œé”™è¯¯ä»£ç . æ”¯æŒ sendfileã€sendfile64 å’Œ sendfilev;æ–‡ä»¶ AIOï¼›DIRECTIO;æ”¯æŒ Accept-filters å’Œ TCP_DEFER_ACCEP. ä»¥ä¸Šæ¦‚å¿µè¾ƒå¤šï¼Œå¤§å®¶è‡ªè¡Œç™¾åº¦æˆ–è°·æ­Œï¼ŒçŸ¥è¯†é¢†åŸŸæ˜¯ç½‘ç»œé€šä¿¡ï¼ˆBIO,NIO,AIOï¼‰å’Œå¤šçº¿ç¨‹æ–¹é¢çš„çŸ¥è¯†ã€‚ 5.4. Ngnix å‡è¡¡ç­–ç•¥ nginx çš„è´Ÿè½½å‡è¡¡ç­–ç•¥å¯ä»¥åˆ’åˆ†ä¸ºä¸¤å¤§ç±»ï¼šå†…ç½®ç­–ç•¥å’Œæ‰©å±•ç­–ç•¥ã€‚å†…ç½®ç­–ç•¥åŒ…å«åŠ æƒè½®è¯¢å’Œ ip hashï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹è¿™ä¸¤ç§ç­–ç•¥ä¼šç¼–è¯‘è¿› nginx å†…æ ¸ï¼Œåªéœ€åœ¨ nginx é…ç½®ä¸­æŒ‡æ˜Žå‚æ•°å³å¯ã€‚æ‰©å±•ç­–ç•¥æœ‰å¾ˆå¤šï¼Œå¦‚ fairã€é€šç”¨ hashã€consistent hash ç­‰ï¼Œé»˜è®¤ä¸ç¼–è¯‘è¿› nginx å†…æ ¸ã€‚ç”±äºŽåœ¨ nginx ç‰ˆæœ¬å‡çº§ä¸­è´Ÿè½½å‡è¡¡çš„ä»£ç æ²¡æœ‰æœ¬è´¨æ€§çš„å˜åŒ–ï¼Œå› æ­¤ä¸‹é¢å°†ä»¥ nginx1.0.15 ç¨³å®šç‰ˆä¸ºä¾‹ï¼Œä»Žæºç è§’åº¦åˆ†æžå„ä¸ªç­–ç•¥ã€‚ åŠ æƒè½®è¯¢ï¼ˆweighted round robinï¼‰ è½®è¯¢çš„åŽŸç†å¾ˆç®€å•ï¼Œé¦–å…ˆæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹è½®è¯¢çš„åŸºæœ¬æµç¨‹ã€‚å¦‚ä¸‹æ˜¯å¤„ç†ä¸€æ¬¡è¯·æ±‚çš„æµç¨‹å›¾ï¼š å›¾ä¸­æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼Œç¬¬ä¸€ï¼Œå¦‚æžœå¯ä»¥æŠŠåŠ æƒè½®è¯¢ç®—æ³•åˆ†ä¸ºå…ˆæ·±æœç´¢å’Œå…ˆå¹¿æœç´¢ï¼Œé‚£ä¹ˆ nginx é‡‡ç”¨çš„æ˜¯å…ˆæ·±æœç´¢ç®—æ³•ï¼Œå³å°†é¦–å…ˆå°†è¯·æ±‚éƒ½åˆ†ç»™é«˜æƒé‡çš„æœºå™¨ï¼Œç›´åˆ°è¯¥æœºå™¨çš„æƒå€¼é™åˆ°äº†æ¯”å…¶ä»–æœºå™¨ä½Žï¼Œæ‰å¼€å§‹å°†è¯·æ±‚åˆ†ç»™ä¸‹ä¸€ä¸ªé«˜æƒé‡çš„æœºå™¨ï¼›ç¬¬äºŒï¼Œå½“æ‰€æœ‰åŽç«¯æœºå™¨éƒ½ down æŽ‰æ—¶ï¼Œnginx ä¼šç«‹å³å°†æ‰€æœ‰æœºå™¨çš„æ ‡å¿—ä½æ¸…æˆåˆå§‹çŠ¶æ€ï¼Œä»¥é¿å…é€ æˆæ‰€æœ‰çš„æœºå™¨éƒ½å¤„åœ¨ timeout çš„çŠ¶æ€ï¼Œä»Žè€Œå¯¼è‡´æ•´ä¸ªå‰ç«¯è¢«å¤¯ä½ã€‚ ip hash ip hash æ˜¯ nginx å†…ç½®çš„å¦ä¸€ä¸ªè´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼Œæµç¨‹å’Œè½®è¯¢å¾ˆç±»ä¼¼ï¼Œåªæ˜¯å…¶ä¸­çš„ç®—æ³•å’Œå…·ä½“çš„ç­–ç•¥æœ‰äº›å˜åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š fair fair ç­–ç•¥æ˜¯æ‰©å±•ç­–ç•¥ï¼Œé»˜è®¤ä¸è¢«ç¼–è¯‘è¿› nginx å†…æ ¸ã€‚å…¶åŽŸç†æ˜¯æ ¹æ®åŽç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´åˆ¤æ–­è´Ÿè½½æƒ…å†µï¼Œä»Žä¸­é€‰å‡ºè´Ÿè½½æœ€è½»çš„æœºå™¨è¿›è¡Œåˆ†æµã€‚è¿™ç§ç­–ç•¥å…·æœ‰å¾ˆå¼ºçš„è‡ªé€‚åº”æ€§ï¼Œä½†æ˜¯å®žé™…çš„ç½‘ç»œçŽ¯å¢ƒå¾€å¾€ä¸æ˜¯é‚£ä¹ˆç®€å•ï¼Œå› æ­¤è¦æ…Žç”¨ã€‚ é€šç”¨ hashã€ä¸€è‡´æ€§ hash è¿™ä¸¤ç§ä¹Ÿæ˜¯æ‰©å±•ç­–ç•¥ï¼Œåœ¨å…·ä½“çš„å®žçŽ°ä¸Šæœ‰äº›å·®åˆ«ï¼Œé€šç”¨ hash æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ä»¥ nginx å†…ç½®çš„å˜é‡ä¸º key è¿›è¡Œ hashï¼Œä¸€è‡´æ€§ hash é‡‡ç”¨äº† nginx å†…ç½®çš„ä¸€è‡´æ€§ hash çŽ¯ï¼Œå¯ä»¥æ”¯æŒ memcacheã€‚ 5.5. Ngnix åœºæ™¯ Ngnix ä¸€èˆ¬ä½œä¸ºå…¥å£è´Ÿè½½å‡è¡¡æˆ–å†…éƒ¨è´Ÿè½½å‡è¡¡ï¼Œç»“åˆåå‘ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ã€‚ä»¥ä¸‹æž¶æž„ç¤ºä¾‹ï¼Œä»…ä¾›å‚è€ƒï¼Œå…·ä½“ä½¿ç”¨æ ¹æ®åœºæ™¯è€Œå®šã€‚ å…¥å£è´Ÿè½½å‡è¡¡æž¶æž„ Ngnix æœåŠ¡å™¨åœ¨ç”¨æˆ·è®¿é—®çš„æœ€å‰ç«¯ã€‚æ ¹æ®ç”¨æˆ·è¯·æ±‚å†è½¬å‘åˆ°å…·ä½“çš„åº”ç”¨æœåŠ¡å™¨æˆ–äºŒçº§è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼ˆLVSï¼‰ å†…éƒ¨è´Ÿè½½å‡è¡¡æž¶æž„ LVS ä½œä¸ºå…¥å£è´Ÿè½½å‡è¡¡ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°äºŒçº§ Ngnix æœåŠ¡å™¨ï¼ŒNgnix å†æ ¹æ®è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„åº”ç”¨æœåŠ¡å™¨ã€‚ Ngnix é«˜å¯ç”¨ åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåº”ç”¨åªéƒ¨ç½²ä¸€å°æœåŠ¡å™¨ä¼šå­˜åœ¨å•ç‚¹æ•…éšœï¼Œè´Ÿè½½å‡è¡¡åŒæ ·æœ‰ç±»ä¼¼çš„é—®é¢˜ã€‚ä¸€èˆ¬å¯é‡‡ç”¨ä¸»å¤‡æˆ–è´Ÿè½½å‡è¡¡è®¾å¤‡é›†ç¾¤çš„æ–¹å¼èŠ‚çº¦å•ç‚¹æ•…éšœæˆ–é«˜å¹¶å‘è¯·æ±‚åˆ†æµã€‚ Ngnix é«˜å¯ç”¨ï¼Œè‡³å°‘åŒ…å«ä¸¤ä¸ª Ngnix æœåŠ¡å™¨ï¼Œä¸€å°ä¸»æœåŠ¡å™¨ï¼Œä¸€å°å¤‡æœåŠ¡å™¨ï¼Œä¹‹é—´ä½¿ç”¨ Keepalived åšå¥åº·ç›‘æŽ§å’Œæ•…éšœæ£€æµ‹ã€‚å¼€æ”¾ VIP ç«¯å£ï¼Œé€šè¿‡é˜²ç«å¢™è¿›è¡Œå¤–éƒ¨æ˜ å°„ã€‚ DNS è§£æžå…¬ç½‘çš„ IP å®žé™…ä¸º VIPã€‚ 6. LVS è´Ÿè½½å‡è¡¡ LVS æ˜¯ä¸€ä¸ªå¼€æºçš„è½¯ä»¶ï¼Œç”±æ¯•ä¸šäºŽå›½é˜²ç§‘æŠ€å¤§å­¦çš„ç« æ–‡åµ©åšå£«äºŽ 1998 å¹´ 5 æœˆåˆ›ç«‹ï¼Œç”¨æ¥å®žçŽ° Linux å¹³å°ä¸‹çš„ç®€å•è´Ÿè½½å‡è¡¡ã€‚LVS æ˜¯ Linux Virtual Server çš„ç¼©å†™ï¼Œæ„æ€æ˜¯ Linux è™šæ‹ŸæœåŠ¡å™¨ã€‚ åŸºäºŽ IP å±‚çš„è´Ÿè½½å‡è¡¡è°ƒåº¦æŠ€æœ¯ï¼Œå®ƒåœ¨æ“ä½œç³»ç»Ÿæ ¸å¿ƒå±‚ä¸Šï¼Œå°†æ¥è‡ª IP å±‚çš„ TCP/UDP è¯·æ±‚å‡è¡¡åœ°è½¬ç§»åˆ°ä¸åŒçš„ æœåŠ¡å™¨ï¼Œä»Žè€Œå°†ä¸€ç»„æœåŠ¡å™¨æž„æˆä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„è™šæ‹ŸæœåŠ¡å™¨ã€‚ æ“ä½œç³»ç»Ÿï¼šLiunx å¼€å‘è¯­è¨€ï¼šC å¹¶å‘æ€§èƒ½ï¼šé»˜è®¤ 4096ï¼Œå¯ä»¥ä¿®æ”¹ä½†éœ€è¦é‡æ–°ç¼–è¯‘ã€‚ 6.1. LVS åŠŸèƒ½ LVS çš„ä¸»è¦åŠŸèƒ½æ˜¯å®žçŽ° IP å±‚ï¼ˆç½‘ç»œå±‚ï¼‰è´Ÿè½½å‡è¡¡ï¼Œæœ‰ NAT,TUN,DR ä¸‰ç§è¯·æ±‚è½¬å‘æ¨¡å¼ã€‚ LVS/NAT æ–¹å¼çš„è´Ÿè½½å‡è¡¡é›†ç¾¤ NAT æ˜¯æŒ‡ Network Address Translationï¼Œå®ƒçš„è½¬å‘æµç¨‹æ˜¯ï¼šDirector æœºå™¨æ”¶åˆ°å¤–ç•Œè¯·æ±‚ï¼Œæ”¹å†™æ•°æ®åŒ…çš„ç›®æ ‡åœ°å€ï¼ŒæŒ‰ç›¸åº”çš„è°ƒåº¦ç®—æ³•å°†å…¶å‘é€åˆ°ç›¸åº” Real Server ä¸Šï¼ŒReal Server å¤„ç†å®Œè¯¥è¯·æ±‚åŽï¼Œå°†ç»“æžœæ•°æ®åŒ…è¿”å›žåˆ°å…¶é»˜è®¤ç½‘å…³ï¼Œå³ Director æœºå™¨ä¸Šï¼ŒDirector æœºå™¨å†æ”¹å†™æ•°æ®åŒ…çš„æºåœ°å€ï¼Œæœ€åŽå°†å…¶è¿”å›žç»™å¤–ç•Œã€‚è¿™æ ·å°±å®Œæˆä¸€æ¬¡è´Ÿè½½è°ƒåº¦ã€‚ æž„æž¶ä¸€ä¸ªæœ€ç®€å•çš„ LVS/NAT æ–¹å¼çš„è´Ÿè½½å‡è¡¡é›†ç¾¤ Real Server å¯ä»¥æ˜¯ä»»ä½•çš„æ“ä½œç³»ç»Ÿï¼Œè€Œä¸”æ— éœ€åšä»»ä½•ç‰¹æ®Šçš„è®¾å®šï¼ŒæƒŸä¸€è¦åšçš„å°±æ˜¯å°†å…¶é»˜è®¤ç½‘å…³æŒ‡å‘ Director æœºå™¨ã€‚Real Server å¯ä»¥ä½¿ç”¨å±€åŸŸç½‘çš„å†…éƒ¨ IP(192.168.0.0/24)ã€‚Director è¦æœ‰ä¸¤å—ç½‘å¡ï¼Œä¸€å—ç½‘å¡ç»‘å®šä¸€ä¸ªå¤–éƒ¨ IP åœ°å€ (10.0.0.1)ï¼Œå¦ä¸€å—ç½‘å¡ç»‘å®šå±€åŸŸç½‘çš„å†…éƒ¨ IP(192.168.0.254)ï¼Œä½œä¸º Real Server çš„é»˜è®¤ç½‘å…³ã€‚ LVS/NAT æ–¹å¼å®žçŽ°èµ·æ¥æœ€ä¸ºç®€å•ï¼Œè€Œä¸” Real Server ä½¿ç”¨çš„æ˜¯å†…éƒ¨ IPï¼Œå¯ä»¥èŠ‚çœ Real IP çš„å¼€é”€ã€‚ä½†å› ä¸ºæ‰§è¡Œ NAT éœ€è¦é‡å†™æµç» Director çš„æ•°æ®åŒ…ï¼Œåœ¨é€Ÿåº¦ä¸Šæœ‰ä¸€å®šå»¶è¿Ÿï¼› å½“ç”¨æˆ·çš„è¯·æ±‚éžå¸¸çŸ­ï¼Œè€ŒæœåŠ¡å™¨çš„å›žåº”éžå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¹ Director å½¢æˆå¾ˆå¤§åŽ‹åŠ›ï¼Œæˆä¸ºæ–°çš„ç“¶é¢ˆï¼Œä»Žè€Œä½¿æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½å—åˆ°é™åˆ¶ã€‚ LVS/TUN æ–¹å¼çš„è´Ÿè½½å‡è¡¡é›†ç¾¤ TUN æ˜¯æŒ‡ IP Tunnelingï¼Œå®ƒçš„è½¬å‘æµç¨‹æ˜¯ï¼šDirector æœºå™¨æ”¶åˆ°å¤–ç•Œè¯·æ±‚ï¼ŒæŒ‰ç›¸åº”çš„è°ƒåº¦ç®—æ³•,é€šè¿‡ IP éš§é“å‘é€åˆ°ç›¸åº” Real Serverï¼ŒReal Server å¤„ç†å®Œè¯¥è¯·æ±‚åŽï¼Œå°†ç»“æžœæ•°æ®åŒ…ç›´æŽ¥è¿”å›žç»™å®¢æˆ·ã€‚è‡³æ­¤å®Œæˆä¸€æ¬¡è´Ÿè½½è°ƒåº¦ã€‚ æœ€ç®€å•çš„ LVS/TUN æ–¹å¼çš„è´Ÿè½½å‡è¡¡é›†ç¾¤æž¶æž„ä½¿ç”¨ IP Tunneling æŠ€æœ¯ï¼Œåœ¨ Director æœºå™¨å’Œ Real Server æœºå™¨ä¹‹é—´æž¶è®¾ä¸€ä¸ª IP Tunnelï¼Œé€šè¿‡ IP Tunnel å°†è´Ÿè½½åˆ†é…åˆ° Real Server æœºå™¨ä¸Šã€‚Director å’Œ Real Server ä¹‹é—´çš„å…³ç³»æ¯”è¾ƒæ¾æ•£ï¼Œå¯ä»¥æ˜¯åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨ä¸åŒçš„ç½‘ç»œä¸­ï¼Œåªè¦ä¸¤è€…èƒ½å¤Ÿé€šè¿‡ IP Tunnel ç›¸è¿žå°±è¡Œã€‚æ”¶åˆ°è´Ÿè½½åˆ†é…çš„ Real Server æœºå™¨å¤„ç†å®ŒåŽä¼šç›´æŽ¥å°†åé¦ˆæ•°æ®é€å›žç»™å®¢æˆ·ï¼Œè€Œä¸å¿…é€šè¿‡ Director æœºå™¨ã€‚å®žé™…åº”ç”¨ä¸­ï¼ŒæœåŠ¡å™¨å¿…é¡»æ‹¥æœ‰æ­£å¼çš„ IP åœ°å€ç”¨äºŽä¸Žå®¢æˆ·æœºç›´æŽ¥é€šä¿¡ï¼Œå¹¶ä¸”æ‰€æœ‰æœåŠ¡å™¨å¿…é¡»æ”¯æŒ IP éš§é“åè®®ã€‚ è¯¥æ–¹å¼ä¸­ Director å°†å®¢æˆ·è¯·æ±‚åˆ†é…åˆ°ä¸åŒçš„ Real Serverï¼ŒReal Server å¤„ç†è¯·æ±‚åŽç›´æŽ¥å›žåº”ç»™ç”¨æˆ·ï¼Œè¿™æ · Director å°±åªå¤„ç†å®¢æˆ·æœºä¸ŽæœåŠ¡å™¨çš„ä¸€åŠè¿žæŽ¥ï¼Œæžå¤§åœ°æé«˜äº† Director çš„è°ƒåº¦å¤„ç†èƒ½åŠ›ï¼Œä½¿é›†ç¾¤ç³»ç»Ÿèƒ½å®¹çº³æ›´å¤šçš„èŠ‚ç‚¹æ•°ã€‚å¦å¤– TUN æ–¹å¼ä¸­çš„ Real Server å¯ä»¥åœ¨ä»»ä½• LAN æˆ– WAN ä¸Šè¿è¡Œï¼Œè¿™æ ·å¯ä»¥æž„ç­‘è·¨åœ°åŸŸçš„é›†ç¾¤ï¼Œå…¶åº”å¯¹ç¾éš¾çš„èƒ½åŠ›ä¹Ÿæ›´å¼ºï¼Œä½†æ˜¯æœåŠ¡å™¨éœ€è¦ä¸º IP å°è£…ä»˜å‡ºä¸€å®šçš„èµ„æºå¼€é”€ï¼Œè€Œä¸”åŽç«¯çš„ Real Server å¿…é¡»æ˜¯æ”¯æŒ IP Tunneling çš„æ“ä½œç³»ç»Ÿã€‚ LVS/TUN æ–¹å¼çš„è´Ÿè½½å‡è¡¡é›†ç¾¤ DR æ˜¯æŒ‡ Direct Routingï¼Œå®ƒçš„è½¬å‘æµç¨‹æ˜¯ï¼šDirector æœºå™¨æ”¶åˆ°å¤–ç•Œè¯·æ±‚ï¼ŒæŒ‰ç›¸åº”çš„è°ƒåº¦ç®—æ³•å°†å…¶ç›´æŽ¥å‘é€åˆ°ç›¸åº” Real Serverï¼ŒReal Server å¤„ç†å®Œè¯¥è¯·æ±‚åŽï¼Œå°†ç»“æžœæ•°æ®åŒ…ç›´æŽ¥è¿”å›žç»™å®¢æˆ·ï¼Œå®Œæˆä¸€æ¬¡è´Ÿè½½è°ƒåº¦ã€‚ æž„æž¶ä¸€ä¸ªæœ€ç®€å•çš„ LVS/DR æ–¹å¼çš„è´Ÿè½½å‡è¡¡é›†ç¾¤ Real Server å’Œ Director éƒ½åœ¨åŒä¸€ä¸ªç‰©ç†ç½‘æ®µä¸­ï¼ŒDirector çš„ç½‘å¡ IP æ˜¯ 192.168.0.253ï¼Œå†ç»‘å®šå¦ä¸€ä¸ª IPï¼š 192.168.0.254 ä½œä¸ºå¯¹å¤–ç•Œçš„ virtual IPï¼Œå¤–ç•Œå®¢æˆ·é€šè¿‡è¯¥ IP æ¥è®¿é—®æ•´ä¸ªé›†ç¾¤ç³»ç»Ÿã€‚Real Server åœ¨ lo ä¸Šç»‘å®š IPï¼š192.168.0.254ï¼ŒåŒæ—¶åŠ å…¥ç›¸åº”çš„è·¯ç”±ã€‚ LVS/DR æ–¹å¼ä¸Žå‰é¢çš„ LVS/TUN æ–¹å¼æœ‰äº›ç±»ä¼¼ï¼Œå‰å°çš„ Director æœºå™¨ä¹Ÿæ˜¯åªéœ€è¦æŽ¥æ”¶å’Œè°ƒåº¦å¤–ç•Œçš„è¯·æ±‚ï¼Œè€Œä¸éœ€è¦è´Ÿè´£è¿”å›žè¿™äº›è¯·æ±‚çš„åé¦ˆç»“æžœï¼Œæ‰€ä»¥èƒ½å¤Ÿè´Ÿè½½æ›´å¤šçš„ Real Serverï¼Œæé«˜ Director çš„è°ƒåº¦å¤„ç†èƒ½åŠ›ï¼Œä½¿é›†ç¾¤ç³»ç»Ÿå®¹çº³æ›´å¤šçš„ Real Serverã€‚ä½† LVS/DR éœ€è¦æ”¹å†™è¯·æ±‚æŠ¥æ–‡çš„ MAC åœ°å€ï¼Œæ‰€ä»¥æ‰€æœ‰æœåŠ¡å™¨å¿…é¡»åœ¨åŒä¸€ç‰©ç†ç½‘æ®µå†…ã€‚ 6.2. LVS æž¶æž„ LVS æž¶è®¾çš„æœåŠ¡å™¨é›†ç¾¤ç³»ç»Ÿæœ‰ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šæœ€å‰ç«¯çš„è´Ÿè½½å‡è¡¡å±‚ï¼ˆLoader Balancerï¼‰ï¼Œä¸­é—´çš„æœåŠ¡å™¨ç¾¤ç»„å±‚ï¼Œç”¨ Server Array è¡¨ç¤ºï¼Œæœ€åº•å±‚çš„æ•°æ®å…±äº«å­˜å‚¨å±‚ï¼Œç”¨ Shared Storage è¡¨ç¤ºã€‚åœ¨ç”¨æˆ·çœ‹æ¥æ‰€æœ‰çš„åº”ç”¨éƒ½æ˜¯é€æ˜Žçš„ï¼Œç”¨æˆ·åªæ˜¯åœ¨ä½¿ç”¨ä¸€ä¸ªè™šæ‹ŸæœåŠ¡å™¨æä¾›çš„é«˜æ€§èƒ½æœåŠ¡ã€‚ LVS çš„ä½“ç³»æž¶æž„å¦‚å›¾ï¼š LVS çš„å„ä¸ªå±‚æ¬¡çš„è¯¦ç»†ä»‹ç»ï¼š Load Balancer å±‚ï¼šä½äºŽæ•´ä¸ªé›†ç¾¤ç³»ç»Ÿçš„æœ€å‰ç«¯ï¼Œæœ‰ä¸€å°æˆ–è€…å¤šå°è´Ÿè½½è°ƒåº¦å™¨ï¼ˆDirector Serverï¼‰ç»„æˆï¼ŒLVS æ¨¡å—å°±å®‰è£…åœ¨ Director Server ä¸Šï¼Œè€Œ Director çš„ä¸»è¦ä½œç”¨ç±»ä¼¼äºŽä¸€ä¸ªè·¯ç”±å™¨ï¼Œå®ƒå«æœ‰å®Œæˆ LVS åŠŸèƒ½æ‰€è®¾å®šçš„è·¯ç”±è¡¨ï¼Œé€šè¿‡è¿™äº›è·¯ç”±è¡¨æŠŠç”¨æˆ·çš„è¯·æ±‚åˆ†å‘ç»™ Server Array å±‚çš„åº”ç”¨æœåŠ¡å™¨ï¼ˆReal Serverï¼‰ä¸Šã€‚åŒæ—¶ï¼Œåœ¨ Director Server ä¸Šè¿˜è¦å®‰è£…å¯¹ Real Server æœåŠ¡çš„ç›‘æŽ§æ¨¡å— Ldirectordï¼Œæ­¤æ¨¡å—ç”¨äºŽç›‘æµ‹å„ä¸ª Real Server æœåŠ¡çš„å¥åº·çŠ¶å†µã€‚åœ¨ Real Server ä¸å¯ç”¨æ—¶æŠŠå®ƒä»Ž LVS è·¯ç”±è¡¨ä¸­å‰”é™¤ï¼Œæ¢å¤æ—¶é‡æ–°åŠ å…¥ã€‚ Server Array å±‚ï¼šç”±ä¸€ç»„å®žé™…è¿è¡Œåº”ç”¨æœåŠ¡çš„æœºå™¨ç»„æˆï¼ŒReal Server å¯ä»¥æ˜¯ WEB æœåŠ¡å™¨ã€MAIL æœåŠ¡å™¨ã€FTP æœåŠ¡å™¨ã€DNS æœåŠ¡å™¨ã€è§†é¢‘æœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼Œæ¯ä¸ª Real Server ä¹‹é—´é€šè¿‡é«˜é€Ÿçš„ LAN æˆ–åˆ†å¸ƒåœ¨å„åœ°çš„ WAN ç›¸è¿žæŽ¥ã€‚åœ¨å®žé™…çš„åº”ç”¨ä¸­ï¼ŒDirector Server ä¹Ÿå¯ä»¥åŒæ—¶å…¼ä»» Real Server çš„è§’è‰²ã€‚ Shared Storage å±‚ï¼šæ˜¯ä¸ºæ‰€æœ‰ Real Server æä¾›å…±äº«å­˜å‚¨ç©ºé—´å’Œå†…å®¹ä¸€è‡´æ€§çš„å­˜å‚¨åŒºåŸŸï¼Œåœ¨ç‰©ç†ä¸Šï¼Œä¸€èˆ¬æœ‰ç£ç›˜é˜µåˆ—è®¾å¤‡ç»„æˆï¼Œä¸ºäº†æä¾›å†…å®¹çš„ä¸€è‡´æ€§ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡ NFS ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿå…±äº«æ•° æ®ï¼Œä½†æ˜¯ NFS åœ¨ç¹å¿™çš„ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œæ€§èƒ½å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œæ­¤æ—¶å¯ä»¥é‡‡ç”¨é›†ç¾¤æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ Red hat çš„ GFS æ–‡ä»¶ç³»ç»Ÿï¼Œoracle æä¾›çš„ OCFS2 æ–‡ä»¶ç³»ç»Ÿç­‰ã€‚ ä»Žæ•´ä¸ª LVS ç»“æž„å¯ä»¥çœ‹å‡ºï¼ŒDirector Server æ˜¯æ•´ä¸ª LVS çš„æ ¸å¿ƒï¼Œç›®å‰ï¼Œç”¨äºŽ Director Server çš„æ“ä½œç³»ç»Ÿåªèƒ½æ˜¯ Linux å’Œ FreeBSDï¼Œlinux2.6 å†…æ ¸ä¸ç”¨ä»»ä½•è®¾ç½®å°±å¯ä»¥æ”¯æŒ LVS åŠŸèƒ½ï¼Œè€Œ FreeBSD ä½œä¸º Director Server çš„åº”ç”¨è¿˜ä¸æ˜¯å¾ˆå¤šï¼Œæ€§èƒ½ä¹Ÿä¸æ˜¯å¾ˆå¥½ã€‚å¯¹äºŽ Real Serverï¼Œå‡ ä¹Žå¯ä»¥æ˜¯æ‰€æœ‰çš„ç³»ç»Ÿå¹³å°ï¼ŒLinuxã€windowsã€Solarisã€AIXã€BSD ç³»åˆ—éƒ½èƒ½å¾ˆå¥½çš„æ”¯æŒã€‚ 6.3. LVS å‡è¡¡ç­–ç•¥ LVS é»˜è®¤æ”¯æŒå…«ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œç®€è¿°å¦‚ä¸‹ï¼š è½®è¯¢è°ƒåº¦ï¼ˆRound Robinï¼‰ è°ƒåº¦å™¨é€šè¿‡â€œè½®è¯¢â€è°ƒåº¦ç®—æ³•å°†å¤–éƒ¨è¯·æ±‚æŒ‰é¡ºåºè½®æµåˆ†é…åˆ°é›†ç¾¤ä¸­çš„çœŸå®žæœåŠ¡å™¨ä¸Šï¼Œå®ƒå‡ç­‰åœ°å¯¹å¾…æ¯ä¸€å°æœåŠ¡å™¨ï¼Œè€Œä¸ç®¡æœåŠ¡å™¨ä¸Šå®žé™…çš„è¿žæŽ¥æ•°å’Œç³»ç»Ÿè´Ÿè½½ã€‚ åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robinï¼‰ è°ƒåº¦å™¨é€šè¿‡â€œåŠ æƒè½®è¯¢â€è°ƒåº¦ç®—æ³•æ ¹æ®çœŸå®žæœåŠ¡å™¨çš„ä¸åŒå¤„ç†èƒ½åŠ›æ¥è°ƒåº¦è®¿é—®è¯·æ±‚ã€‚è¿™æ ·å¯ä»¥ä¿è¯å¤„ç†èƒ½åŠ›å¼ºçš„æœåŠ¡å™¨èƒ½å¤„ç†æ›´å¤šçš„è®¿é—®æµé‡ã€‚è°ƒåº¦å™¨å¯ä»¥è‡ªåŠ¨é—®è¯¢çœŸå®žæœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µï¼Œå¹¶åŠ¨æ€åœ°è°ƒæ•´å…¶æƒå€¼ã€‚ æœ€å°‘é“¾æŽ¥ï¼ˆLeast Connectionsï¼‰ è°ƒåº¦å™¨é€šè¿‡â€œæœ€å°‘è¿žæŽ¥â€è°ƒåº¦ç®—æ³•åŠ¨æ€åœ°å°†ç½‘ç»œè¯·æ±‚è°ƒåº¦åˆ°å·²å»ºç«‹çš„é“¾æŽ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ä¸Šã€‚å¦‚æžœé›†ç¾¤ç³»ç»Ÿçš„çœŸå®žæœåŠ¡å™¨å…·æœ‰ç›¸è¿‘çš„ç³»ç»Ÿæ€§èƒ½ï¼Œé‡‡ç”¨â€œæœ€å°è¿žæŽ¥â€è°ƒåº¦ç®—æ³•å¯ä»¥è¾ƒå¥½åœ°å‡è¡¡è´Ÿè½½ã€‚ åŠ æƒæœ€å°‘é“¾æŽ¥ï¼ˆWeighted Least Connectionsï¼‰ åœ¨é›†ç¾¤ç³»ç»Ÿä¸­çš„æœåŠ¡å™¨æ€§èƒ½å·®å¼‚è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œè°ƒåº¦å™¨é‡‡ç”¨â€œåŠ æƒæœ€å°‘é“¾æŽ¥â€è°ƒåº¦ç®—æ³•ä¼˜åŒ–è´Ÿè½½å‡è¡¡æ€§èƒ½ï¼Œå…·æœ‰è¾ƒé«˜æƒå€¼çš„æœåŠ¡å™¨å°†æ‰¿å—è¾ƒå¤§æ¯”ä¾‹çš„æ´»åŠ¨è¿žæŽ¥è´Ÿè½½ã€‚è°ƒåº¦å™¨å¯ä»¥è‡ªåŠ¨é—®è¯¢çœŸå®žæœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µï¼Œå¹¶åŠ¨æ€åœ°è°ƒæ•´å…¶æƒå€¼ã€‚ åŸºäºŽå±€éƒ¨æ€§çš„æœ€å°‘é“¾æŽ¥ï¼ˆLocality-Based Least Connectionsï¼‰ â€œåŸºäºŽå±€éƒ¨æ€§çš„æœ€å°‘é“¾æŽ¥â€è°ƒåº¦ç®—æ³•æ˜¯é’ˆå¯¹ç›®æ ‡ IP åœ°å€çš„è´Ÿè½½å‡è¡¡ï¼Œç›®å‰ä¸»è¦ç”¨äºŽ Cache é›†ç¾¤ç³»ç»Ÿã€‚è¯¥ç®—æ³•æ ¹æ®è¯·æ±‚çš„ç›®æ ‡ IP åœ°å€æ‰¾å‡ºè¯¥ç›®æ ‡ IP åœ°å€æœ€è¿‘ä½¿ç”¨çš„æœåŠ¡å™¨ï¼Œè‹¥è¯¥æœåŠ¡å™¨æ˜¯å¯ç”¨çš„ä¸”æ²¡æœ‰è¶…è½½ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¯¥æœåŠ¡å™¨ï¼›è‹¥æœåŠ¡å™¨ä¸å­˜åœ¨ï¼Œæˆ–è€…è¯¥æœåŠ¡å™¨è¶…è½½ä¸”æœ‰æœåŠ¡å™¨å¤„äºŽä¸€åŠçš„å·¥ä½œè´Ÿè½½ï¼Œåˆ™ç”¨â€œæœ€å°‘é“¾æŽ¥â€ çš„åŽŸåˆ™é€‰å‡ºä¸€ä¸ªå¯ç”¨çš„æœåŠ¡å™¨ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¯¥æœåŠ¡å™¨ã€‚ å¸¦å¤åˆ¶çš„åŸºäºŽå±€éƒ¨æ€§æœ€å°‘é“¾æŽ¥ï¼ˆLocality-Based Least Connections with Replicationï¼‰ â€œå¸¦å¤åˆ¶çš„åŸºäºŽå±€éƒ¨æ€§æœ€å°‘é“¾æŽ¥â€è°ƒåº¦ç®—æ³•ä¹Ÿæ˜¯é’ˆå¯¹ç›®æ ‡ IP åœ°å€çš„è´Ÿè½½å‡è¡¡ï¼Œç›®å‰ä¸»è¦ç”¨äºŽ Cache é›†ç¾¤ç³»ç»Ÿã€‚å®ƒä¸Ž LBLC ç®—æ³•çš„ä¸åŒä¹‹å¤„æ˜¯å®ƒè¦ç»´æŠ¤ä»Žä¸€ä¸ªç›®æ ‡ IP åœ°å€åˆ°ä¸€ç»„æœåŠ¡å™¨çš„æ˜ å°„ï¼Œè€Œ LBLC ç®—æ³•ç»´æŠ¤ä»Žä¸€ä¸ªç›®æ ‡ IP åœ°å€åˆ°ä¸€å°æœåŠ¡å™¨çš„æ˜ å°„ã€‚è¯¥ç®—æ³•æ ¹æ®è¯·æ±‚çš„ç›®æ ‡ IP åœ°å€æ‰¾å‡ºè¯¥ç›®æ ‡ IP åœ°å€å¯¹åº”çš„æœåŠ¡å™¨ç»„ï¼ŒæŒ‰â€œæœ€å°è¿žæŽ¥â€åŽŸåˆ™ä»ŽæœåŠ¡å™¨ç»„ä¸­é€‰å‡ºä¸€å°æœåŠ¡å™¨ï¼Œè‹¥æœåŠ¡å™¨æ²¡æœ‰è¶…è½½ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¯¥æœåŠ¡å™¨ï¼›è‹¥æœåŠ¡å™¨è¶…è½½ï¼Œåˆ™æŒ‰â€œæœ€å°è¿žæŽ¥â€åŽŸåˆ™ä»Žè¿™ä¸ªé›†ç¾¤ä¸­é€‰å‡ºä¸€å°æœåŠ¡å™¨ï¼Œå°†è¯¥æœåŠ¡å™¨åŠ å…¥åˆ°æœåŠ¡å™¨ç»„ä¸­ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¯¥æœåŠ¡å™¨ã€‚åŒæ—¶ï¼Œå½“è¯¥æœåŠ¡å™¨ç»„æœ‰ä¸€æ®µæ—¶é—´æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œå°†æœ€å¿™çš„æœåŠ¡å™¨ä»ŽæœåŠ¡å™¨ç»„ä¸­åˆ é™¤ï¼Œä»¥é™ä½Žå¤åˆ¶çš„ç¨‹åº¦ã€‚ ç›®æ ‡åœ°å€æ•£åˆ—ï¼ˆDestination Hashingï¼‰ â€œç›®æ ‡åœ°å€æ•£åˆ—â€è°ƒåº¦ç®—æ³•æ ¹æ®è¯·æ±‚çš„ç›®æ ‡ IP åœ°å€ï¼Œä½œä¸ºæ•£åˆ—é”®ï¼ˆHash Keyï¼‰ä»Žé™æ€åˆ†é…çš„æ•£åˆ—è¡¨æ‰¾å‡ºå¯¹åº”çš„æœåŠ¡å™¨ï¼Œè‹¥è¯¥æœåŠ¡å™¨æ˜¯å¯ç”¨çš„ä¸”æœªè¶…è½½ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¯¥æœåŠ¡å™¨ï¼Œå¦åˆ™è¿”å›žç©ºã€‚ æºåœ°å€æ•£åˆ—ï¼ˆSource Hashingï¼‰ â€œæºåœ°å€æ•£åˆ—â€è°ƒåº¦ç®—æ³•æ ¹æ®è¯·æ±‚çš„æº IP åœ°å€ï¼Œä½œä¸ºæ•£åˆ—é”®ï¼ˆHash Keyï¼‰ä»Žé™æ€åˆ†é…çš„æ•£åˆ—è¡¨æ‰¾å‡ºå¯¹åº”çš„æœåŠ¡å™¨ï¼Œè‹¥è¯¥æœåŠ¡å™¨æ˜¯å¯ç”¨çš„ä¸”æœªè¶…è½½ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¯¥æœåŠ¡å™¨ï¼Œå¦åˆ™è¿”å›žç©ºã€‚ é™¤å…·å¤‡ä»¥ä¸Šè´Ÿè½½å‡è¡¡ç®—æ³•å¤–ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰å‡è¡¡ç­–ç•¥ã€‚ 6.4. LVS åœºæ™¯ ä¸€èˆ¬ä½œä¸ºå…¥å£è´Ÿè½½å‡è¡¡æˆ–å†…éƒ¨è´Ÿè½½å‡è¡¡ï¼Œç»“åˆåå‘ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ã€‚ç›¸å…³æž¶æž„å¯å‚è€ƒ Ngnix åœºæ™¯æž¶æž„ã€‚ 7. HaProxy è´Ÿè½½å‡è¡¡ HAProxy ä¹Ÿæ˜¯ä½¿ç”¨è¾ƒå¤šçš„ä¸€æ¬¾è´Ÿè½½å‡è¡¡è½¯ä»¶ã€‚HAProxy æä¾›é«˜å¯ç”¨æ€§ã€è´Ÿè½½å‡è¡¡ä»¥åŠåŸºäºŽ TCP å’Œ HTTP åº”ç”¨çš„ä»£ç†ï¼Œæ”¯æŒè™šæ‹Ÿä¸»æœºï¼Œæ˜¯å…è´¹ã€å¿«é€Ÿå¹¶ä¸”å¯é çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ç‰¹åˆ«é€‚ç”¨äºŽé‚£äº›è´Ÿè½½ç‰¹å¤§çš„ web ç«™ç‚¹ã€‚è¿è¡Œæ¨¡å¼ä½¿å¾—å®ƒå¯ä»¥å¾ˆç®€å•å®‰å…¨çš„æ•´åˆåˆ°å½“å‰çš„æž¶æž„ä¸­ï¼ŒåŒæ—¶å¯ä»¥ä¿æŠ¤ä½ çš„ web æœåŠ¡å™¨ä¸è¢«æš´éœ²åˆ°ç½‘ç»œä¸Šã€‚ 7.1. HaProxy ç‰¹ç‚¹ æ”¯æŒä¸¤ç§ä»£ç†æ¨¡å¼ï¼šTCPï¼ˆå››å±‚ï¼‰å’Œ HTTPï¼ˆä¸ƒå±‚ï¼‰ï¼Œæ”¯æŒè™šæ‹Ÿä¸»æœºï¼› é…ç½®ç®€å•ï¼Œæ”¯æŒ url æ£€æµ‹åŽç«¯æœåŠ¡å™¨çŠ¶æ€ï¼› åšè´Ÿè½½å‡è¡¡è½¯ä»¶ä½¿ç”¨ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤„ç†é€Ÿåº¦é«˜äºŽ nginxï¼› TCP å±‚å¤šç”¨äºŽ Mysql ä»Žï¼ˆè¯»ï¼‰æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ã€‚ ï¼ˆå¯¹ Mysql è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå¯¹åŽç«¯çš„ DB èŠ‚ç‚¹è¿›è¡Œæ£€æµ‹å’Œè´Ÿè½½å‡è¡¡ï¼‰ èƒ½å¤Ÿè¡¥å…… Nginx çš„ä¸€äº›ç¼ºç‚¹æ¯”å¦‚ Session çš„ä¿æŒï¼ŒCookie å¼•å¯¼ç­‰å·¥ä½œ 7.2. HaProxy å‡è¡¡ç­–ç•¥ æ”¯æŒå››ç§å¸¸ç”¨ç®—æ³•ï¼š 1.roundrobinï¼šè½®è¯¢ï¼Œè½®æµåˆ†é…åˆ°åŽç«¯æœåŠ¡å™¨ï¼› 2.static-rrï¼šæ ¹æ®åŽç«¯æœåŠ¡å™¨æ€§èƒ½åˆ†é…ï¼› 3.leastconnï¼šæœ€å°è¿žæŽ¥è€…ä¼˜å…ˆå¤„ç†ï¼› 4.sourceï¼šæ ¹æ®è¯·æ±‚æº IPï¼Œä¸Ž Nginx çš„ IP_Hash ç±»ä¼¼ã€‚ 8. èµ„æ–™ å¤§åž‹ç½‘ç«™æž¶æž„ç³»åˆ—ï¼šè´Ÿè½½å‡è¡¡è¯¦è§£ï¼ˆ1ï¼‰ å¤§åž‹ç½‘ç«™æž¶æž„ç³»åˆ—ï¼šè´Ÿè½½å‡è¡¡è¯¦è§£ï¼ˆ2ï¼‰ å¤§åž‹ç½‘ç«™æž¶æž„ç³»åˆ—ï¼šè´Ÿè½½å‡è¡¡è¯¦è§£ï¼ˆ3ï¼‰ å¤§åž‹ç½‘ç«™æž¶æž„ç³»åˆ—ï¼šè´Ÿè½½å‡è¡¡è¯¦è§£ï¼ˆ4ï¼‰]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>load balance</tag>
        <tag>design</tag>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼åŽŸç†]]></title>
    <url>%2Fblog%2F2018%2F10%2F13%2Fdesign%2Farchitecture%2F%E5%88%86%E5%B8%83%E5%BC%8F%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼åŽŸç† 1. åˆ†å¸ƒå¼æœ¯è¯­ 1.1. å¼‚å¸¸ 1.2. è¶…æ—¶ 1.3. è¡¡é‡æŒ‡æ ‡ 2. æ•°æ®åˆ†å¸ƒ 2.1. å“ˆå¸Œåˆ†å¸ƒ 2.2. é¡ºåºåˆ†å¸ƒ 2.3. è´Ÿè½½å‡è¡¡ 3. åˆ†å¸ƒå¼ç†è®º 3.1. CAP 3.2. BASE 4. åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ 4.1. ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰ 4.2. è¡¥å¿äº‹åŠ¡ï¼ˆTCCï¼‰ 4.3. æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆå¼‚æ­¥ç¡®ä¿ï¼‰ 4.4. MQ äº‹åŠ¡æ¶ˆæ¯ 5. å…±è¯†æ€§é—®é¢˜ 5.1. Paxos 5.2. Raft 6. åˆ†å¸ƒå¼ç¼“å­˜é—®é¢˜z 6.1. ç¼“å­˜é›ªå´© 6.2. ç¼“å­˜ç©¿é€z 6.3. ç¼“å­˜é¢„çƒ­ 6.4. ç¼“å­˜æ›´æ–° 6.5. ç¼“å­˜é™çº§ 7. å‚è€ƒèµ„æ–™ 1. åˆ†å¸ƒå¼æœ¯è¯­ 1.1. å¼‚å¸¸ æœåŠ¡å™¨å®•æœº å†…å­˜é”™è¯¯ã€æœåŠ¡å™¨åœç”µç­‰éƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨å®•æœºï¼Œæ­¤æ—¶èŠ‚ç‚¹æ— æ³•æ­£å¸¸å·¥ä½œï¼Œç§°ä¸ºä¸å¯ç”¨ã€‚ æœåŠ¡å™¨å®•æœºä¼šå¯¼è‡´èŠ‚ç‚¹å¤±åŽ»æ‰€æœ‰å†…å­˜ä¿¡æ¯ï¼Œå› æ­¤éœ€è¦å°†å†…å­˜ä¿¡æ¯ä¿å­˜åˆ°æŒä¹…åŒ–ä»‹è´¨ä¸Šã€‚ ç½‘ç»œå¼‚å¸¸ æœ‰ä¸€ç§ç‰¹æ®Šçš„ç½‘ç»œå¼‚å¸¸ç§°ä¸ºâ€”â€”ç½‘ç»œåˆ†åŒº ï¼Œå³é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹è¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå†…éƒ¨å¯ä»¥é€šä¿¡ï¼Œä½†æ˜¯åŒºåŸŸä¹‹é—´æ— æ³•é€šä¿¡ã€‚ ç£ç›˜æ•…éšœ ç£ç›˜æ•…éšœæ˜¯ä¸€ç§å‘ç”Ÿæ¦‚çŽ‡å¾ˆé«˜çš„å¼‚å¸¸ã€‚ ä½¿ç”¨å†—ä½™æœºåˆ¶ï¼Œå°†æ•°æ®å­˜å‚¨åˆ°å¤šå°æœåŠ¡å™¨ã€‚ 1.2. è¶…æ—¶ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªè¯·æ±‚é™¤äº†æˆåŠŸå’Œå¤±è´¥ä¸¤ç§çŠ¶æ€ï¼Œè¿˜å­˜åœ¨ç€è¶…æ—¶çŠ¶æ€ã€‚ å¯ä»¥å°†æœåŠ¡å™¨çš„æ“ä½œè®¾è®¡ä¸ºå…·æœ‰ å¹‚ç­‰æ€§ ï¼Œå³æ‰§è¡Œå¤šæ¬¡çš„ç»“æžœä¸Žæ‰§è¡Œä¸€æ¬¡çš„ç»“æžœç›¸åŒã€‚å¦‚æžœä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå½“å‡ºçŽ°è¶…æ—¶çš„æ—¶å€™ï¼Œå¯ä»¥ä¸æ–­åœ°é‡æ–°è¯·æ±‚ç›´åˆ°æˆåŠŸã€‚ 1.3. è¡¡é‡æŒ‡æ ‡ æ€§èƒ½ å¸¸è§çš„æ€§èƒ½æŒ‡æ ‡æœ‰ï¼šåžåé‡ã€å“åº”æ—¶é—´ã€‚ å…¶ä¸­ï¼Œåžåé‡æŒ‡ç³»ç»Ÿåœ¨æŸä¸€æ®µæ—¶é—´å¯ä»¥å¤„ç†çš„è¯·æ±‚æ€»æ•°ï¼Œé€šå¸¸ä¸ºæ¯ç§’çš„è¯»æ“ä½œæ•°æˆ–è€…å†™æ“ä½œæ•°ï¼›å“åº”æ—¶é—´æŒ‡ä»ŽæŸä¸ªè¯·æ±‚å‘å‡ºåˆ°æŽ¥æ”¶åˆ°è¿”å›žç»“æžœæ¶ˆè€—çš„æ—¶é—´ã€‚ è¿™ä¸¤ä¸ªæŒ‡æ ‡å¾€å¾€æ˜¯çŸ›ç›¾çš„ï¼Œè¿½æ±‚é«˜åžåçš„ç³»ç»Ÿï¼Œå¾€å¾€å¾ˆéš¾åšåˆ°ä½Žå“åº”æ—¶é—´ï¼Œè§£é‡Šå¦‚ä¸‹ï¼š åœ¨æ— å¹¶å‘çš„ç³»ç»Ÿä¸­ï¼Œåžåé‡ä¸ºå“åº”æ—¶é—´çš„å€’æ•°ï¼Œä¾‹å¦‚å“åº”æ—¶é—´ä¸º 10 msï¼Œé‚£ä¹ˆåžåé‡ä¸º 100 req/sï¼Œå› æ­¤é«˜åžåä¹Ÿå°±æ„å‘³ç€ä½Žå“åº”æ—¶é—´ã€‚ ä½†æ˜¯åœ¨å¹¶å‘çš„ç³»ç»Ÿä¸­ï¼Œç”±äºŽä¸€ä¸ªè¯·æ±‚åœ¨è°ƒç”¨ I/O èµ„æºçš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œç­‰å¾…ã€‚æœåŠ¡å™¨ç«¯ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯å¼‚æ­¥ç­‰å¾…æ–¹å¼ï¼Œå³ç­‰å¾…çš„è¯·æ±‚è¢«é˜»å¡žä¹‹åŽä¸éœ€è¦ä¸€ç›´å ç”¨ CPU èµ„æºã€‚è¿™ç§æ–¹å¼èƒ½å¤§å¤§æé«˜ CPU èµ„æºçš„åˆ©ç”¨çŽ‡ï¼Œä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå•ä¸ªè¯·æ±‚åœ¨æ— å¹¶å‘çš„ç³»ç»Ÿä¸­å“åº”æ—¶é—´ä¸º 10 msï¼Œå¦‚æžœåœ¨å¹¶å‘çš„ç³»ç»Ÿä¸­ï¼Œé‚£ä¹ˆåžåé‡å°†å¤§äºŽ 100 req/sã€‚å› æ­¤ä¸ºäº†è¿½æ±‚é«˜åžåé‡ï¼Œé€šå¸¸ä¼šæé«˜å¹¶å‘ç¨‹åº¦ã€‚ä½†æ˜¯å¹¶å‘ç¨‹åº¦çš„å¢žåŠ ï¼Œä¼šå¯¼è‡´è¯·æ±‚çš„å¹³å‡å“åº”æ—¶é—´ä¹Ÿå¢žåŠ ï¼Œå› ä¸ºè¯·æ±‚ä¸èƒ½é©¬ä¸Šè¢«å¤„ç†ï¼Œéœ€è¦å’Œå…¶å®ƒè¯·æ±‚ä¸€èµ·è¿›è¡Œå¹¶å‘å¤„ç†ï¼Œå“åº”æ—¶é—´è‡ªç„¶å°±ä¼šå¢žé«˜ã€‚ å¯ç”¨æ€§ å¯ç”¨æ€§æŒ‡ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡çš„èƒ½åŠ›ã€‚å¯ä»¥ç”¨ç³»ç»Ÿå¯ç”¨æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼æ¥è¡¡é‡ï¼Œ4 ä¸ª 9 çš„å¯ç”¨æ€§è¡¨ç¤ºç³»ç»Ÿ 99.99% çš„æ—¶é—´æ˜¯å¯ç”¨çš„ã€‚ ä¸€è‡´æ€§ å¯ä»¥ä»Žä¸¤ä¸ªè§’åº¦ç†è§£ä¸€è‡´æ€§ï¼šä»Žå®¢æˆ·ç«¯çš„è§’åº¦ï¼Œè¯»å†™æ“ä½œæ˜¯å¦æ»¡è¶³æŸç§ç‰¹æ€§ï¼›ä»ŽæœåŠ¡å™¨çš„è§’åº¦ï¼Œå¤šä¸ªæ•°æ®å‰¯æœ¬ä¹‹é—´æ˜¯å¦ä¸€è‡´ã€‚ å¯æ‰©å±•æ€§ æŒ‡ç³»ç»Ÿé€šè¿‡æ‰©å±•é›†ç¾¤æœåŠ¡å™¨è§„æ¨¡æ¥æé«˜æ€§èƒ½çš„èƒ½åŠ›ã€‚ç†æƒ³çš„åˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦å®žçŽ°â€œçº¿æ€§å¯æ‰©å±•â€ï¼Œå³éšç€é›†ç¾¤è§„æ¨¡çš„å¢žåŠ ï¼Œç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ä¹Ÿä¼šçº¿æ€§å¢žåŠ ã€‚ 2. æ•°æ®åˆ†å¸ƒ åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿçš„æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸­ï¼Œå¸¸ç”¨çš„æ•°æ®åˆ†å¸ƒæ–¹å¼æœ‰å“ˆå¸Œåˆ†å¸ƒå’Œé¡ºåºåˆ†å¸ƒã€‚ æ•°æ®åº“çš„æ°´å¹³åˆ‡åˆ†ï¼ˆShardingï¼‰ä¹Ÿæ˜¯ä¸€ç§åˆ†å¸ƒå¼å­˜å‚¨æ–¹æ³•ï¼Œä¸‹é¢çš„æ•°æ®åˆ†å¸ƒæ–¹æ³•åŒæ ·é€‚ç”¨äºŽ Shardingã€‚ 2.1. å“ˆå¸Œåˆ†å¸ƒ å“ˆå¸Œåˆ†å¸ƒå°±æ˜¯å°†æ•°æ®è®¡ç®—å“ˆå¸Œå€¼ä¹‹åŽï¼ŒæŒ‰ç…§å“ˆå¸Œå€¼åˆ†é…åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚ä¾‹å¦‚æœ‰ N ä¸ªèŠ‚ç‚¹ï¼Œæ•°æ®çš„ä¸»é”®ä¸º keyï¼Œåˆ™å°†è¯¥æ•°æ®åˆ†é…çš„èŠ‚ç‚¹åºå·ä¸ºï¼šhash(key)%Nã€‚ ä¼ ç»Ÿçš„å“ˆå¸Œåˆ†å¸ƒç®—æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå½“èŠ‚ç‚¹æ•°é‡å˜åŒ–æ—¶ï¼Œä¹Ÿå°±æ˜¯ N å€¼å˜åŒ–ï¼Œé‚£ä¹ˆå‡ ä¹Žæ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦é‡æ–°åˆ†å¸ƒï¼Œå°†å¯¼è‡´å¤§é‡çš„æ•°æ®è¿ç§»ã€‚ ä¸€è‡´æ€§å“ˆå¸Œ Distributed Hash Tableï¼ˆDHTï¼‰ï¼šå¯¹äºŽå“ˆå¸Œç©ºé—´ [0, 2n-1]ï¼Œå°†è¯¥å“ˆå¸Œç©ºé—´çœ‹æˆä¸€ä¸ªå“ˆå¸ŒçŽ¯ï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹éƒ½é…ç½®åˆ°å“ˆå¸ŒçŽ¯ä¸Šã€‚æ¯ä¸ªæ•°æ®å¯¹è±¡é€šè¿‡å“ˆå¸Œå–æ¨¡å¾—åˆ°å“ˆå¸Œå€¼ä¹‹åŽï¼Œå­˜æ”¾åˆ°å“ˆå¸ŒçŽ¯ä¸­é¡ºæ—¶é’ˆæ–¹å‘ç¬¬ä¸€ä¸ªå¤§äºŽç­‰äºŽè¯¥å“ˆå¸Œå€¼çš„èŠ‚ç‚¹ä¸Šã€‚ ä¸€è‡´æ€§å“ˆå¸Œçš„ä¼˜ç‚¹æ˜¯åœ¨å¢žåŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹æ—¶åªä¼šå½±å“åˆ°å“ˆå¸ŒçŽ¯ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­æ–°å¢žèŠ‚ç‚¹ Xï¼Œåªéœ€è¦å°†æ•°æ®å¯¹è±¡ C é‡æ–°å­˜æ”¾åˆ°èŠ‚ç‚¹ X ä¸Šå³å¯ï¼Œå¯¹äºŽèŠ‚ç‚¹ Aã€Bã€D éƒ½æ²¡æœ‰å½±å“ã€‚ 2.2. é¡ºåºåˆ†å¸ƒ å“ˆå¸Œåˆ†å¸ƒå¼ç ´åäº†æ•°æ®çš„æœ‰åºæ€§ï¼Œé¡ºåºåˆ†å¸ƒåˆ™ä¸ä¼šã€‚ é¡ºåºåˆ†å¸ƒçš„æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªè¿žç»­çš„éƒ¨åˆ†ï¼ŒæŒ‰æ•°æ®çš„ ID æˆ–è€…æ—¶é—´åˆ†å¸ƒåˆ°ä¸åŒèŠ‚ç‚¹ä¸Šã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒUser è¡¨çš„ ID èŒƒå›´ä¸º 1 ~ 7000ï¼Œä½¿ç”¨é¡ºåºåˆ†å¸ƒå¯ä»¥å°†å…¶åˆ’åˆ†æˆå¤šä¸ªå­è¡¨ï¼Œå¯¹åº”çš„ä¸»é”®èŒƒå›´ä¸º 1 ~ 1000ï¼Œ1001 ~ 2000ï¼Œâ€¦ï¼Œ6001 ~ 7000ã€‚ é¡ºåºåˆ†å¸ƒçš„ä¼˜ç‚¹æ˜¯å¯ä»¥å……åˆ†åˆ©ç”¨æ¯ä¸ªèŠ‚ç‚¹çš„ç©ºé—´ï¼Œè€Œå“ˆå¸Œåˆ†å¸ƒå¾ˆéš¾æŽ§åˆ¶ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨å¤šå°‘æ•°æ®ã€‚ ä½†æ˜¯é¡ºåºåˆ†å¸ƒéœ€è¦ä½¿ç”¨ä¸€ä¸ªæ˜ å°„è¡¨æ¥å­˜å‚¨æ•°æ®åˆ°èŠ‚ç‚¹çš„æ˜ å°„ï¼Œè¿™ä¸ªæ˜ å°„è¡¨é€šå¸¸ä½¿ç”¨å•ç‹¬çš„èŠ‚ç‚¹æ¥å­˜å‚¨ã€‚å½“æ•°æ®é‡éžå¸¸å¤§æ—¶ï¼Œæ˜ å°„è¡¨ä¹Ÿéšç€å˜å¤§ï¼Œé‚£ä¹ˆä¸€ä¸ªèŠ‚ç‚¹å°±å¯èƒ½æ— æ³•å­˜æ”¾ä¸‹æ•´ä¸ªæ˜ å°„è¡¨ã€‚å¹¶ä¸”å•ä¸ªèŠ‚ç‚¹ç»´æŠ¤ç€æ•´ä¸ªæ˜ å°„è¡¨çš„å¼€é”€å¾ˆå¤§ï¼ŒæŸ¥æ‰¾é€Ÿåº¦ä¹Ÿä¼šå˜æ…¢ã€‚ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ä¸ªä¸­é—´å±‚ï¼Œä¹Ÿå°±æ˜¯ Meta è¡¨ï¼Œä»Žè€Œåˆ†æ‹…æ˜ å°„è¡¨çš„ç»´æŠ¤å·¥ä½œã€‚ 2.3. è´Ÿè½½å‡è¡¡ è¡¡é‡è´Ÿè½½çš„å› ç´ å¾ˆå¤šï¼Œå¦‚ CPUã€å†…å­˜ã€ç£ç›˜ç­‰èµ„æºä½¿ç”¨æƒ…å†µã€è¯»å†™è¯·æ±‚æ•°ç­‰ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿå­˜å‚¨åº”å½“èƒ½å¤Ÿè‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼Œå½“æŸä¸ªèŠ‚ç‚¹çš„è´Ÿè½½è¾ƒé«˜ï¼Œå°†å®ƒçš„éƒ¨åˆ†æ•°æ®è¿ç§»åˆ°å…¶å®ƒèŠ‚ç‚¹ã€‚ æ¯ä¸ªé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªæ€»æŽ§èŠ‚ç‚¹ï¼Œå…¶å®ƒèŠ‚ç‚¹ä¸ºå·¥ä½œèŠ‚ç‚¹ï¼Œç”±æ€»æŽ§èŠ‚ç‚¹æ ¹æ®å…¨å±€è´Ÿè½½ä¿¡æ¯è¿›è¡Œæ•´ä½“è°ƒåº¦ï¼Œå·¥ä½œèŠ‚ç‚¹å®šæ—¶å‘é€å¿ƒè·³åŒ…ï¼ˆHeartbeatï¼‰å°†èŠ‚ç‚¹è´Ÿè½½ç›¸å…³çš„ä¿¡æ¯å‘é€ç»™æ€»æŽ§èŠ‚ç‚¹ã€‚ ä¸€ä¸ªæ–°ä¸Šçº¿çš„å·¥ä½œèŠ‚ç‚¹ï¼Œç”±äºŽå…¶è´Ÿè½½è¾ƒä½Žï¼Œå¦‚æžœä¸åŠ æŽ§åˆ¶ï¼Œæ€»æŽ§èŠ‚ç‚¹ä¼šå°†å¤§é‡æ•°æ®åŒæ—¶è¿ç§»åˆ°è¯¥èŠ‚ç‚¹ä¸Šï¼Œé€ æˆè¯¥èŠ‚ç‚¹ä¸€æ®µæ—¶é—´å†…æ— æ³•å·¥ä½œã€‚å› æ­¤è´Ÿè½½å‡è¡¡æ“ä½œéœ€è¦å¹³æ»‘è¿›è¡Œï¼Œæ–°åŠ å…¥çš„èŠ‚ç‚¹éœ€è¦è¾ƒé•¿çš„ä¸€æ®µæ—¶é—´æ¥è¾¾åˆ°æ¯”è¾ƒå‡è¡¡çš„çŠ¶æ€ã€‚ 3. åˆ†å¸ƒå¼ç†è®º 3.1. CAP åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆCï¼šConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAï¼šAvailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼šPartition Toleranceï¼‰ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ã€‚ ä¸€è‡´æ€§ ä¸€è‡´æ€§æŒ‡çš„æ˜¯å¤šä¸ªæ•°æ®å‰¯æœ¬æ˜¯å¦èƒ½ä¿æŒä¸€è‡´çš„ç‰¹æ€§ã€‚ åœ¨ä¸€è‡´æ€§çš„æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿåœ¨æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œä¹‹åŽèƒ½å¤Ÿä»Žä¸€è‡´æ€§çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ å¯¹ç³»ç»Ÿçš„ä¸€ä¸ªæ•°æ®æ›´æ–°æˆåŠŸä¹‹åŽï¼Œå¦‚æžœæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½å¤Ÿè¯»å–åˆ°æœ€æ–°çš„å€¼ï¼Œè¯¥ç³»ç»Ÿå°±è¢«è®¤ä¸ºå…·æœ‰å¼ºä¸€è‡´æ€§ã€‚ å¯ç”¨æ€§ å¯ç”¨æ€§æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡çš„èƒ½åŠ›ï¼Œå¯ä»¥ç”¨ç³»ç»Ÿå¯ç”¨æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼æ¥è¡¡é‡ï¼Œ4 ä¸ª 9 çš„å¯ç”¨æ€§è¡¨ç¤ºç³»ç»Ÿ 99.99% çš„æ—¶é—´æ˜¯å¯ç”¨çš„ã€‚ åœ¨å¯ç”¨æ€§æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿæä¾›çš„æœåŠ¡ä¸€ç›´å¤„äºŽå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºŽç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›žç»“æžœã€‚ åˆ†åŒºå®¹å¿æ€§ ç½‘ç»œåˆ†åŒºæŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹è¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå†…éƒ¨å¯ä»¥é€šä¿¡ï¼Œä½†æ˜¯åŒºåŸŸä¹‹é—´æ— æ³•é€šä¿¡ã€‚ åœ¨åˆ†åŒºå®¹å¿æ€§æ¡ä»¶ä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦èƒ½å¯¹å¤–æä¾›ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éžæ˜¯æ•´ä¸ªç½‘ç»œçŽ¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚ æƒè¡¡ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºå®¹å¿æ€§å¿…ä¸å¯å°‘ï¼Œå› ä¸ºéœ€è¦æ€»æ˜¯å‡è®¾ç½‘ç»œæ˜¯ä¸å¯é çš„ã€‚å› æ­¤ï¼ŒCAP ç†è®ºå®žé™…åœ¨æ˜¯è¦åœ¨å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´åšæƒè¡¡ã€‚ å¯ç”¨æ€§å’Œä¸€è‡´æ€§å¾€å¾€æ˜¯å†²çªçš„ï¼Œå¾ˆéš¾éƒ½ä½¿å®ƒä»¬åŒæ—¶æ»¡è¶³ã€‚åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œ ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼ˆCPï¼‰ï¼Œå°±éœ€è¦è®©æ‰€æœ‰èŠ‚ç‚¹ä¸‹çº¿æˆä¸ºä¸å¯ç”¨çš„çŠ¶æ€ï¼Œç­‰å¾…åŒæ­¥å®Œæˆï¼› ä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼ˆAPï¼‰ï¼Œåœ¨åŒæ­¥è¿‡ç¨‹ä¸­å…è®¸è¯»å–æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å¯èƒ½ä¸ä¸€è‡´ã€‚ 3.2. BASE BASE æ˜¯åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ã€è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually Consistentï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚ BASE ç†è®ºæ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æžœï¼Œå®ƒçš„ç†è®ºçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚ åŸºæœ¬å¯ç”¨ æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºçŽ°æ•…éšœçš„æ—¶å€™ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚ ä¾‹å¦‚ï¼Œç”µå•†åœ¨åšä¿ƒé”€æ—¶ï¼Œä¸ºäº†ä¿è¯è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§çš„é¡µé¢ã€‚ è½¯çŠ¶æ€ æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡ŒåŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚ æœ€ç»ˆä¸€è‡´æ€§ æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åŽï¼Œæœ€ç»ˆèƒ½è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚ ACID è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨ä¼ ç»Ÿçš„æ•°æ®åº“ç³»ç»Ÿä¸Šã€‚è€Œ BASE è¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è¾¾åˆ°å¯ç”¨æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨å¤§åž‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚ åœ¨å®žé™…çš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å•å…ƒå’Œç»„ä»¶å¯¹ä¸€è‡´æ€§çš„è¦æ±‚æ˜¯ä¸åŒçš„ï¼Œå› æ­¤ ACID å’Œ BASE å¾€å¾€ä¼šç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚ 4. åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ 4.1. ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰ ä¸¤é˜¶æ®µæäº¤ï¼ˆTwo-phase Commitï¼Œ2PCï¼‰ ä¸»è¦ç”¨äºŽå®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„æ˜¯äº‹åŠ¡æ“ä½œè·¨è¶Šå¤šä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¦æ±‚æ»¡è¶³äº‹åŠ¡çš„ ACID ç‰¹æ€§ã€‚ é€šè¿‡å¼•å…¥åè°ƒè€…ï¼ˆCoordinatorï¼‰æ¥è°ƒåº¦å‚ä¸Žè€…çš„è¡Œä¸ºï¼Œå¹¶æœ€ç»ˆå†³å®šè¿™äº›å‚ä¸Žè€…æ˜¯å¦è¦çœŸæ­£æ‰§è¡Œäº‹åŠ¡ã€‚ è¿è¡Œè¿‡ç¨‹ å‡†å¤‡é˜¶æ®µ åè°ƒè€…è¯¢é—®å‚ä¸Žè€…äº‹åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå‚ä¸Žè€…å‘å›žäº‹åŠ¡æ‰§è¡Œç»“æžœã€‚ æäº¤é˜¶æ®µ å¦‚æžœäº‹åŠ¡åœ¨æ¯ä¸ªå‚ä¸Žè€…ä¸Šéƒ½æ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡åè°ƒè€…å‘é€é€šçŸ¥è®©å‚ä¸Žè€…æäº¤äº‹åŠ¡ï¼›å¦åˆ™ï¼Œåè°ƒè€…å‘é€é€šçŸ¥è®©å‚ä¸Žè€…å›žæ»šäº‹åŠ¡ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å‡†å¤‡é˜¶æ®µï¼Œå‚ä¸Žè€…æ‰§è¡Œäº†äº‹åŠ¡ï¼Œä½†æ˜¯è¿˜æœªæäº¤ã€‚åªæœ‰åœ¨æäº¤é˜¶æ®µæŽ¥æ”¶åˆ°åè°ƒè€…å‘æ¥çš„é€šçŸ¥åŽï¼Œæ‰è¿›è¡Œæäº¤æˆ–è€…å›žæ»šã€‚ é—®é¢˜ åŒæ­¥é˜»å¡ž æ‰€æœ‰äº‹åŠ¡å‚ä¸Žè€…åœ¨ç­‰å¾…å…¶å®ƒå‚ä¸Žè€…å“åº”çš„æ—¶å€™éƒ½å¤„äºŽåŒæ­¥é˜»å¡žçŠ¶æ€ï¼Œæ— æ³•è¿›è¡Œå…¶å®ƒæ“ä½œã€‚ å•ç‚¹é—®é¢˜ åè°ƒè€…åœ¨ 2PC ä¸­èµ·åˆ°éžå¸¸å¤§çš„ä½œç”¨ï¼Œå‘ç”Ÿæ•…éšœå°†ä¼šé€ æˆå¾ˆå¤§å½±å“ï¼Œç‰¹åˆ«æ˜¯åœ¨é˜¶æ®µäºŒå‘ç”Ÿæ•…éšœï¼Œæ‰€æœ‰å‚ä¸Žè€…ä¼šä¸€ç›´ç­‰å¾…çŠ¶æ€ï¼Œæ— æ³•å®Œæˆå…¶å®ƒæ“ä½œã€‚ æ•°æ®ä¸ä¸€è‡´ åœ¨é˜¶æ®µäºŒï¼Œå¦‚æžœåè°ƒè€…åªå‘é€äº†éƒ¨åˆ† Commit æ¶ˆæ¯ï¼Œæ­¤æ—¶ç½‘ç»œå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆåªæœ‰éƒ¨åˆ†å‚ä¸Žè€…æŽ¥æ”¶åˆ° Commit æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰éƒ¨åˆ†å‚ä¸Žè€…æäº¤äº†äº‹åŠ¡ï¼Œä½¿å¾—ç³»ç»Ÿæ•°æ®ä¸ä¸€è‡´ã€‚ å¤ªè¿‡ä¿å®ˆ ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¤±è´¥å°±ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼Œæ²¡æœ‰å®Œå–„çš„å®¹é”™æœºåˆ¶ã€‚ 2PC ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šå°½é‡ä¿è¯äº†æ•°æ®çš„å¼ºä¸€è‡´ï¼Œé€‚åˆå¯¹æ•°æ®å¼ºä¸€è‡´è¦æ±‚å¾ˆé«˜çš„å…³é”®é¢†åŸŸã€‚ï¼ˆå…¶å®žä¹Ÿä¸èƒ½ 100%ä¿è¯å¼ºä¸€è‡´ï¼‰ ç¼ºç‚¹ï¼šå®žçŽ°å¤æ‚ï¼Œç‰ºç‰²äº†å¯ç”¨æ€§ï¼Œå¯¹æ€§èƒ½å½±å“è¾ƒå¤§ï¼Œä¸é€‚åˆé«˜å¹¶å‘é«˜æ€§èƒ½åœºæ™¯ã€‚ 4.2. è¡¥å¿äº‹åŠ¡ï¼ˆTCCï¼‰ è¡¥å¿äº‹åŠ¡ï¼ˆTCCï¼‰å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šé’ˆå¯¹æ¯ä¸ªæ“ä½œï¼Œéƒ½è¦æ³¨å†Œä¸€ä¸ªä¸Žå…¶å¯¹åº”çš„ç¡®è®¤å’Œè¡¥å¿ï¼ˆæ’¤é”€ï¼‰æ“ä½œã€‚å®ƒåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š Try é˜¶æ®µä¸»è¦æ˜¯å¯¹ä¸šåŠ¡ç³»ç»Ÿåšæ£€æµ‹åŠèµ„æºé¢„ç•™ã€‚ Confirm é˜¶æ®µä¸»è¦æ˜¯å¯¹ä¸šåŠ¡ç³»ç»Ÿåšç¡®è®¤æäº¤ï¼ŒTry é˜¶æ®µæ‰§è¡ŒæˆåŠŸå¹¶å¼€å§‹æ‰§è¡Œ Confirm é˜¶æ®µæ—¶ï¼Œé»˜è®¤ Confirm é˜¶æ®µæ˜¯ä¸ä¼šå‡ºé”™çš„ã€‚å³ï¼šåªè¦ Try æˆåŠŸï¼ŒConfirm ä¸€å®šæˆåŠŸã€‚ Cancel é˜¶æ®µä¸»è¦æ˜¯åœ¨ä¸šåŠ¡æ‰§è¡Œé”™è¯¯ï¼Œéœ€è¦å›žæ»šçš„çŠ¶æ€ä¸‹æ‰§è¡Œçš„ä¸šåŠ¡å–æ¶ˆï¼Œé¢„ç•™èµ„æºé‡Šæ”¾ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ Bob è¦å‘ Smith è½¬è´¦ï¼Œæ€è·¯å¤§æ¦‚æ˜¯ï¼š é¦–å…ˆåœ¨ Try é˜¶æ®µï¼Œè¦å…ˆè°ƒç”¨è¿œç¨‹æŽ¥å£æŠŠ Smith å’Œ Bob çš„é’±ç»™å†»ç»“èµ·æ¥ã€‚ åœ¨ Confirm é˜¶æ®µï¼Œæ‰§è¡Œè¿œç¨‹è°ƒç”¨çš„è½¬è´¦çš„æ“ä½œï¼Œè½¬è´¦æˆåŠŸè¿›è¡Œè§£å†»ã€‚ å¦‚æžœç¬¬ 2 æ­¥æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆè½¬è´¦æˆåŠŸï¼Œå¦‚æžœç¬¬äºŒæ­¥æ‰§è¡Œå¤±è´¥ï¼Œåˆ™è°ƒç”¨è¿œç¨‹å†»ç»“æŽ¥å£å¯¹åº”çš„è§£å†»æ–¹æ³• (Cancel)ã€‚ TCC ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šè·Ÿ 2PC æ¯”èµ·æ¥ï¼Œå®žçŽ°ä»¥åŠæµç¨‹ç›¸å¯¹ç®€å•äº†ä¸€äº›ï¼Œä½†æ•°æ®çš„ä¸€è‡´æ€§æ¯” 2PC ä¹Ÿè¦å·®ä¸€äº›ã€‚ ç¼ºç‚¹ï¼šç¼ºç‚¹è¿˜æ˜¯æ¯”è¾ƒæ˜Žæ˜¾çš„ï¼Œåœ¨ 2,3 æ­¥ä¸­éƒ½æœ‰å¯èƒ½å¤±è´¥ã€‚TCC å±žäºŽåº”ç”¨å±‚çš„ä¸€ç§è¡¥å¿æ–¹å¼ï¼Œæ‰€ä»¥éœ€è¦ç¨‹åºå‘˜åœ¨å®žçŽ°çš„æ—¶å€™å¤šå†™å¾ˆå¤šè¡¥å¿çš„ä»£ç ï¼Œåœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œä¸€äº›ä¸šåŠ¡æµç¨‹å¯èƒ½ç”¨ TCC ä¸å¤ªå¥½å®šä¹‰åŠå¤„ç†ã€‚ 4.3. æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆå¼‚æ­¥ç¡®ä¿ï¼‰ æœ¬åœ°æ¶ˆæ¯è¡¨ä¸Žä¸šåŠ¡æ•°æ®è¡¨å¤„äºŽåŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œè¿™æ ·å°±èƒ½åˆ©ç”¨æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯åœ¨å¯¹è¿™ä¸¤ä¸ªè¡¨çš„æ“ä½œæ»¡è¶³äº‹åŠ¡ç‰¹æ€§ã€‚ åœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ“ä½œçš„ä¸€æ–¹å®Œæˆå†™ä¸šåŠ¡æ•°æ®çš„æ“ä½œä¹‹åŽå‘æœ¬åœ°æ¶ˆæ¯è¡¨å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œæœ¬åœ°äº‹åŠ¡èƒ½ä¿è¯è¿™ä¸ªæ¶ˆæ¯ä¸€å®šä¼šè¢«å†™å…¥æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­ã€‚ ä¹‹åŽå°†æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­çš„æ¶ˆæ¯è½¬å‘åˆ° Kafka ç­‰æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰ä¸­ï¼Œå¦‚æžœè½¬å‘æˆåŠŸåˆ™å°†æ¶ˆæ¯ä»Žæœ¬åœ°æ¶ˆæ¯è¡¨ä¸­åˆ é™¤ï¼Œå¦åˆ™ç»§ç»­é‡æ–°è½¬å‘ã€‚ åœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ“ä½œçš„å¦ä¸€æ–¹ä»Žæ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¹¶æ‰§è¡Œæ¶ˆæ¯ä¸­çš„æ“ä½œã€‚ è¿™ç§æ–¹æ¡ˆéµå¾ª BASE ç†è®ºï¼Œé‡‡ç”¨çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚ æœ¬åœ°æ¶ˆæ¯è¡¨åˆ©ç”¨äº†æœ¬åœ°äº‹åŠ¡æ¥å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—æ¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚ æœ¬åœ°æ¶ˆæ¯è¡¨ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šä¸€ç§éžå¸¸ç»å…¸çš„å®žçŽ°ï¼Œé¿å…äº†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå®žçŽ°äº†æœ€ç»ˆä¸€è‡´æ€§ã€‚ ç¼ºç‚¹ï¼šæ¶ˆæ¯è¡¨ä¼šè€¦åˆåˆ°ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œå¦‚æžœæ²¡æœ‰å°è£…å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œä¼šæœ‰å¾ˆå¤šæ‚æ´»éœ€è¦å¤„ç†ã€‚ 4.4. MQ äº‹åŠ¡æ¶ˆæ¯ æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹çš„ MQ æ˜¯æ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„ï¼Œæ¯”å¦‚ RocketMQï¼Œä»–ä»¬æ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„æ–¹å¼ä¹Ÿæ˜¯ç±»ä¼¼äºŽé‡‡ç”¨çš„äºŒé˜¶æ®µæäº¤ã€‚ä½†æ˜¯å¸‚é¢ä¸Šä¸€äº›ä¸»æµçš„ MQ éƒ½æ˜¯ä¸æ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„ï¼Œæ¯”å¦‚ RabbitMQ å’Œ Kafka éƒ½ä¸æ”¯æŒã€‚ ä»¥é˜¿é‡Œçš„ RocketMQ ä¸­é—´ä»¶ä¸ºä¾‹ï¼Œå…¶æ€è·¯å¤§è‡´ä¸ºï¼š Prepared æ¶ˆæ¯ï¼Œä¼šæ‹¿åˆ°æ¶ˆæ¯çš„åœ°å€ã€‚ æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ã€‚ é€šè¿‡ç¬¬ä¸€é˜¶æ®µæ‹¿åˆ°çš„åœ°å€åŽ»è®¿é—®æ¶ˆæ¯ï¼Œå¹¶ä¿®æ”¹çŠ¶æ€ã€‚ ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸šåŠ¡æ–¹æ³•å†…è¦æƒ³æ¶ˆæ¯é˜Ÿåˆ—æäº¤ä¸¤æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡å‘é€æ¶ˆæ¯å’Œä¸€æ¬¡ç¡®è®¤æ¶ˆæ¯ã€‚å¦‚æžœç¡®è®¤æ¶ˆæ¯å‘é€å¤±è´¥äº† RocketMQ ä¼šå®šæœŸæ‰«ææ¶ˆæ¯é›†ç¾¤ä¸­çš„äº‹åŠ¡æ¶ˆæ¯ï¼Œè¿™æ—¶å€™å‘çŽ°äº† Prepared æ¶ˆæ¯ï¼Œå®ƒä¼šå‘æ¶ˆæ¯å‘é€è€…ç¡®è®¤ï¼Œæ‰€ä»¥ç”Ÿäº§æ–¹éœ€è¦å®žçŽ°ä¸€ä¸ª check æŽ¥å£ï¼ŒRocketMQ ä¼šæ ¹æ®å‘é€ç«¯è®¾ç½®çš„ç­–ç•¥æ¥å†³å®šæ˜¯å›žæ»šè¿˜æ˜¯ç»§ç»­å‘é€ç¡®è®¤æ¶ˆæ¯ã€‚è¿™æ ·å°±ä¿è¯äº†æ¶ˆæ¯å‘é€ä¸Žæœ¬åœ°äº‹åŠ¡åŒæ—¶æˆåŠŸæˆ–åŒæ—¶å¤±è´¥ã€‚ MQ äº‹åŠ¡æ¶ˆæ¯ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šå®žçŽ°äº†æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸éœ€è¦ä¾èµ–æœ¬åœ°æ•°æ®åº“äº‹åŠ¡ã€‚ ç¼ºç‚¹ï¼šå®žçŽ°éš¾åº¦å¤§ï¼Œä¸»æµ MQ ä¸æ”¯æŒã€‚ 5. å…±è¯†æ€§é—®é¢˜ 5.1. Paxos ç”¨äºŽè¾¾æˆå…±è¯†æ€§é—®é¢˜ï¼Œå³å¯¹å¤šä¸ªèŠ‚ç‚¹äº§ç”Ÿçš„å€¼ï¼Œè¯¥ç®—æ³•èƒ½ä¿è¯åªé€‰å‡ºå”¯ä¸€ä¸€ä¸ªå€¼ã€‚ ä¸»è¦æœ‰ä¸‰ç±»èŠ‚ç‚¹ï¼š æè®®è€…ï¼ˆProposerï¼‰ï¼šæè®®ä¸€ä¸ªå€¼ï¼› æŽ¥å—è€…ï¼ˆAcceptorï¼‰ï¼šå¯¹æ¯ä¸ªæè®®è¿›è¡ŒæŠ•ç¥¨ï¼› å‘ŠçŸ¥è€…ï¼ˆLearnerï¼‰ï¼šè¢«å‘ŠçŸ¥æŠ•ç¥¨çš„ç»“æžœï¼Œä¸å‚ä¸ŽæŠ•ç¥¨è¿‡ç¨‹ã€‚ ç®—æ³•éœ€è¦æ»¡è¶³ safety å’Œ liveness ä¸¤æ–¹é¢çš„çº¦æŸè¦æ±‚ï¼ˆå®žé™…ä¸Šè¿™ä¸¤ä¸ªåŸºç¡€å±žæ€§æ˜¯å¤§éƒ¨åˆ†åˆ†å¸ƒå¼ç®—æ³•éƒ½è¯¥è€ƒè™‘çš„ï¼‰ï¼š safetyï¼šä¿è¯å†³è®®ç»“æžœæ˜¯å¯¹çš„ï¼Œæ— æ­§ä¹‰çš„ï¼Œä¸ä¼šå‡ºçŽ°é”™è¯¯æƒ…å†µã€‚ å†³è®®ï¼ˆvalueï¼‰åªæœ‰åœ¨è¢« proposers æå‡ºçš„ proposal æ‰èƒ½è¢«æœ€ç»ˆæ‰¹å‡†ï¼› åœ¨ä¸€æ¬¡æ‰§è¡Œå®žä¾‹ä¸­ï¼Œåªæ‰¹å‡†ï¼ˆchosenï¼‰ä¸€ä¸ªæœ€ç»ˆå†³è®®ï¼Œæ„å‘³ç€å¤šæ•°æŽ¥å—ï¼ˆacceptï¼‰çš„ç»“æžœèƒ½æˆä¸ºå†³è®®ï¼› livenessï¼šä¿è¯å†³è®®è¿‡ç¨‹èƒ½åœ¨æœ‰é™æ—¶é—´å†…å®Œæˆã€‚ å†³è®®æ€»ä¼šäº§ç”Ÿï¼Œå¹¶ä¸” learners èƒ½èŽ·å¾—è¢«æ‰¹å‡†ï¼ˆchosenï¼‰çš„å†³è®®ã€‚ åŸºæœ¬è¿‡ç¨‹åŒ…æ‹¬ proposer æå‡ºææ¡ˆï¼Œå…ˆäº‰å–å¤§å¤šæ•° acceptor çš„æ”¯æŒï¼Œè¶…è¿‡ä¸€åŠæ”¯æŒæ—¶ï¼Œåˆ™å‘é€ç»“æ¡ˆç»“æžœç»™æ‰€æœ‰äººè¿›è¡Œç¡®è®¤ã€‚ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜æ˜¯ proposer åœ¨æ­¤è¿‡ç¨‹ä¸­å‡ºçŽ°æ•…éšœï¼Œå¯ä»¥é€šè¿‡è¶…æ—¶æœºåˆ¶æ¥è§£å†³ã€‚æžä¸ºå‡‘å·§çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡æ–°çš„ä¸€è½®ææ¡ˆçš„ proposer éƒ½æ°å¥½æ•…éšœï¼Œç³»ç»Ÿåˆ™æ°¸è¿œæ— æ³•è¾¾æˆä¸€è‡´ï¼ˆæ¦‚çŽ‡å¾ˆå°ï¼‰ã€‚ Paxos èƒ½ä¿è¯åœ¨è¶…è¿‡ 1/21/21/2 çš„æ­£å¸¸èŠ‚ç‚¹å­˜åœ¨æ—¶ï¼Œç³»ç»Ÿèƒ½è¾¾æˆå…±è¯†ã€‚ å•ä¸ªææ¡ˆè€…+å¤šæŽ¥æ”¶è€… å¦‚æžœç³»ç»Ÿä¸­é™å®šåªæœ‰æŸä¸ªç‰¹å®šèŠ‚ç‚¹æ˜¯ææ¡ˆè€…ï¼Œé‚£ä¹ˆä¸€è‡´æ€§è‚¯å®šèƒ½è¾¾æˆï¼ˆåªæœ‰ä¸€ä¸ªæ–¹æ¡ˆï¼Œè¦ä¹ˆè¾¾æˆï¼Œè¦ä¹ˆå¤±è´¥ï¼‰ã€‚ææ¡ˆè€…åªè¦æ”¶åˆ°äº†æ¥è‡ªå¤šæ•°æŽ¥æ”¶è€…çš„æŠ•ç¥¨ï¼Œå³å¯è®¤ä¸ºé€šè¿‡ï¼Œå› ä¸ºç³»ç»Ÿä¸­ä¸å­˜åœ¨å…¶ä»–çš„ææ¡ˆã€‚ ä½†ä¸€æ—¦ææ¡ˆè€…æ•…éšœï¼Œåˆ™ç³»ç»Ÿæ— æ³•å·¥ä½œã€‚ å¤šä¸ªææ¡ˆè€…+å•ä¸ªæŽ¥æ”¶è€… é™å®šæŸä¸ªèŠ‚ç‚¹ä½œä¸ºæŽ¥æ”¶è€…ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå…±è¯†ä¹Ÿå¾ˆå®¹æ˜“è¾¾æˆï¼ŒæŽ¥æ”¶è€…æ”¶åˆ°å¤šä¸ªææ¡ˆï¼Œé€‰ç¬¬ä¸€ä¸ªææ¡ˆä½œä¸ºå†³è®®ï¼Œæ‹’ç»æŽ‰åŽç»­çš„ææ¡ˆå³å¯ã€‚ ç¼ºé™·ä¹Ÿæ˜¯å®¹æ˜“å‘ç”Ÿå•ç‚¹æ•…éšœï¼ŒåŒ…æ‹¬æŽ¥æ”¶è€…æ•…éšœæˆ–é¦–ä¸ªææ¡ˆè€…èŠ‚ç‚¹æ•…éšœã€‚ ä»¥ä¸Šä¸¤ç§æƒ…å½¢å…¶å®žç±»ä¼¼ä¸»ä»Žæ¨¡å¼ï¼Œè™½ç„¶ä¸é‚£ä¹ˆå¯é ï¼Œä½†å› ä¸ºåŽŸç†ç®€å•è€Œè¢«å¹¿æ³›é‡‡ç”¨ã€‚ å½“ææ¡ˆè€…å’ŒæŽ¥æ”¶è€…éƒ½æŽ¨å¹¿åˆ°å¤šä¸ªçš„æƒ…å½¢ï¼Œä¼šå‡ºçŽ°ä¸€äº›æŒ‘æˆ˜ã€‚ å¤šä¸ªææ¡ˆè€…+å¤šä¸ªæŽ¥æ”¶è€… æ—¢ç„¶é™å®šå•ææ¡ˆè€…æˆ–å•æŽ¥æ”¶è€…éƒ½ä¼šå‡ºçŽ°æ•…éšœï¼Œé‚£ä¹ˆå°±å¾—å…è®¸å‡ºçŽ°å¤šä¸ªææ¡ˆè€…å’Œå¤šä¸ªæŽ¥æ”¶è€…ã€‚é—®é¢˜ä¸€ä¸‹å­å˜å¾—å¤æ‚äº†ã€‚ ä¸€ç§æƒ…å†µæ˜¯åŒä¸€æ—¶é—´ç‰‡æ®µï¼ˆå¦‚ä¸€ä¸ªææ¡ˆå‘¨æœŸï¼‰å†…åªæœ‰ä¸€ä¸ªææ¡ˆè€…ï¼Œè¿™æ—¶å¯ä»¥é€€åŒ–åˆ°å•ææ¡ˆè€…çš„æƒ…å½¢ã€‚éœ€è¦è®¾è®¡ä¸€ç§æœºåˆ¶æ¥ä¿éšœææ¡ˆè€…çš„æ­£ç¡®äº§ç”Ÿï¼Œä¾‹å¦‚æŒ‰ç…§æ—¶é—´ã€åºåˆ—ã€æˆ–è€…å¤§å®¶çŒœæ‹³ï¼ˆå‡ºä¸€ä¸ªæ•°å­—æ¥æ¯”è¾ƒï¼‰ä¹‹ç±»ã€‚è€ƒè™‘åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿè¦å¤„ç†çš„å·¥ä½œé‡å¾ˆå¤§ï¼Œè¿™ä¸ªè¿‡ç¨‹è¦å°½é‡é«˜æ•ˆï¼Œæ»¡è¶³è¿™ä¸€æ¡ä»¶çš„æœºåˆ¶éžå¸¸éš¾è®¾è®¡ã€‚ å¦ä¸€ç§æƒ…å†µæ˜¯å…è®¸åŒä¸€æ—¶é—´ç‰‡æ®µå†…å¯ä»¥å‡ºçŽ°å¤šä¸ªææ¡ˆè€…ã€‚é‚£åŒä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½æ”¶åˆ°å¤šä»½ææ¡ˆï¼Œæ€Žä¹ˆå¯¹ä»–ä»¬è¿›è¡ŒåŒºåˆ†å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™é‡‡ç”¨åªæŽ¥å—ç¬¬ä¸€ä¸ªææ¡ˆè€Œæ‹’ç»åŽç»­ææ¡ˆçš„æ–¹æ³•ä¹Ÿä¸é€‚ç”¨ã€‚å¾ˆè‡ªç„¶çš„ï¼Œææ¡ˆéœ€è¦å¸¦ä¸Šä¸åŒçš„åºå·ã€‚èŠ‚ç‚¹éœ€è¦æ ¹æ®ææ¡ˆåºå·æ¥åˆ¤æ–­æŽ¥å—å“ªä¸ªã€‚æ¯”å¦‚æŽ¥å—å…¶ä¸­åºå·è¾ƒå¤§ï¼ˆå¾€å¾€æ„å‘³ç€æ˜¯æŽ¥å—æ–°æå‡ºçš„ï¼Œå› ä¸ºæ—§ææ¡ˆè€…æ•…éšœæ¦‚çŽ‡æ›´å¤§ï¼‰çš„ææ¡ˆã€‚ å¦‚ä½•ä¸ºææ¡ˆåˆ†é…åºå·å‘¢ï¼Ÿä¸€ç§å¯èƒ½æ–¹æ¡ˆæ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„ææ¡ˆæ•°å­—åŒºé—´å½¼æ­¤éš”ç¦»å¼€ï¼Œäº’ç›¸ä¸å†²çªã€‚ä¸ºäº†æ»¡è¶³é€’å¢žçš„éœ€æ±‚å¯ä»¥é…åˆç”¨æ—¶é—´æˆ³ä½œä¸ºå‰ç¼€å­—æ®µã€‚ æ­¤å¤–ï¼Œææ¡ˆè€…å³ä¾¿æ”¶åˆ°äº†å¤šæ•°æŽ¥æ”¶è€…çš„æŠ•ç¥¨ï¼Œä¹Ÿä¸æ•¢è¯´å°±ä¸€å®šé€šè¿‡ã€‚å› ä¸ºåœ¨æ­¤è¿‡ç¨‹ä¸­ç³»ç»Ÿå¯èƒ½è¿˜æœ‰å…¶å®ƒçš„ææ¡ˆã€‚ 5.2. Raft Raft ç®—æ³•æ˜¯ Paxos ç®—æ³•çš„ä¸€ç§ç®€åŒ–å®žçŽ°ã€‚ åŒ…æ‹¬ä¸‰ç§è§’è‰²ï¼šleaderã€candidate å’Œ followerï¼Œå…¶åŸºæœ¬è¿‡ç¨‹ä¸ºï¼š Leader é€‰ä¸¾ - æ¯ä¸ª candidate éšæœºç»è¿‡ä¸€å®šæ—¶é—´éƒ½ä¼šæå‡ºé€‰ä¸¾æ–¹æ¡ˆï¼Œæœ€è¿‘é˜¶æ®µä¸­å¾—ç¥¨æœ€å¤šè€…è¢«é€‰ä¸º leaderï¼› åŒæ­¥ log - leader ä¼šæ‰¾åˆ°ç³»ç»Ÿä¸­ log æœ€æ–°çš„è®°å½•ï¼Œå¹¶å¼ºåˆ¶æ‰€æœ‰çš„ follower æ¥åˆ·æ–°åˆ°è¿™ä¸ªè®°å½•ï¼› æ³¨ï¼šæ­¤å¤„ log å¹¶éžæ˜¯æŒ‡æ—¥å¿—æ¶ˆæ¯ï¼Œè€Œæ˜¯å„ç§äº‹ä»¶çš„å‘ç”Ÿè®°å½•ã€‚ å•ä¸ª Candidate çš„ç«žé€‰ æœ‰ä¸‰ç§èŠ‚ç‚¹ï¼šFollowerã€Candidate å’Œ Leaderã€‚Leader ä¼šå‘¨æœŸæ€§çš„å‘é€å¿ƒè·³åŒ…ç»™ Followerã€‚æ¯ä¸ª Follower éƒ½è®¾ç½®äº†ä¸€ä¸ªéšæœºçš„ç«žé€‰è¶…æ—¶æ—¶é—´ï¼Œä¸€èˆ¬ä¸º 150ms~300msï¼Œå¦‚æžœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ° Leader çš„å¿ƒè·³åŒ…ï¼Œå°±ä¼šå˜æˆ Candidateï¼Œè¿›å…¥ç«žé€‰é˜¶æ®µã€‚ ä¸‹å›¾è¡¨ç¤ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ€åˆé˜¶æ®µï¼Œæ­¤æ—¶åªæœ‰ Followerï¼Œæ²¡æœ‰ Leaderã€‚Follower A ç­‰å¾…ä¸€ä¸ªéšæœºçš„ç«žé€‰è¶…æ—¶æ—¶é—´ä¹‹åŽï¼Œæ²¡æ”¶åˆ° Leader å‘æ¥çš„å¿ƒè·³åŒ…ï¼Œå› æ­¤è¿›å…¥ç«žé€‰é˜¶æ®µã€‚ æ­¤æ—¶ A å‘é€æŠ•ç¥¨è¯·æ±‚ç»™å…¶å®ƒæ‰€æœ‰èŠ‚ç‚¹ã€‚ å…¶å®ƒèŠ‚ç‚¹ä¼šå¯¹è¯·æ±‚è¿›è¡Œå›žå¤ï¼Œå¦‚æžœè¶…è¿‡ä¸€åŠçš„èŠ‚ç‚¹å›žå¤äº†ï¼Œé‚£ä¹ˆè¯¥ Candidate å°±ä¼šå˜æˆ Leaderã€‚ ä¹‹åŽ Leader ä¼šå‘¨æœŸæ€§åœ°å‘é€å¿ƒè·³åŒ…ç»™ Followerï¼ŒFollower æŽ¥æ”¶åˆ°å¿ƒè·³åŒ…ï¼Œä¼šé‡æ–°å¼€å§‹è®¡æ—¶ã€‚ å¤šä¸ª Candidate ç«žé€‰ å¦‚æžœæœ‰å¤šä¸ª Follower æˆä¸º Candidateï¼Œå¹¶ä¸”æ‰€èŽ·å¾—ç¥¨æ•°ç›¸åŒï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°å¼€å§‹æŠ•ç¥¨ï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­ Candidate B å’Œ Candidate D éƒ½èŽ·å¾—ä¸¤ç¥¨ï¼Œå› æ­¤éœ€è¦é‡æ–°å¼€å§‹æŠ•ç¥¨ã€‚ å½“é‡æ–°å¼€å§‹æŠ•ç¥¨æ—¶ï¼Œç”±äºŽæ¯ä¸ªèŠ‚ç‚¹è®¾ç½®çš„éšæœºç«žé€‰è¶…æ—¶æ—¶é—´ä¸åŒï¼Œå› æ­¤èƒ½ä¸‹ä¸€æ¬¡å†æ¬¡å‡ºçŽ°å¤šä¸ª Candidate å¹¶èŽ·å¾—åŒæ ·ç¥¨æ•°çš„æ¦‚çŽ‡å¾ˆä½Žã€‚ åŒæ­¥æ—¥å¿— æ¥è‡ªå®¢æˆ·ç«¯çš„ä¿®æ”¹éƒ½ä¼šè¢«ä¼ å…¥ Leaderã€‚æ³¨æ„è¯¥ä¿®æ”¹è¿˜æœªè¢«æäº¤ï¼Œåªæ˜¯å†™å…¥æ—¥å¿—ä¸­ã€‚ Leader ä¼šæŠŠä¿®æ”¹å¤åˆ¶åˆ°æ‰€æœ‰ Followerã€‚ Leader ä¼šç­‰å¾…å¤§å¤šæ•°çš„ Follower ä¹Ÿè¿›è¡Œäº†ä¿®æ”¹ï¼Œç„¶åŽæ‰å°†ä¿®æ”¹æäº¤ã€‚ æ­¤æ—¶ Leader ä¼šé€šçŸ¥çš„æ‰€æœ‰ Follower è®©å®ƒä»¬ä¹Ÿæäº¤ä¿®æ”¹ï¼Œæ­¤æ—¶æ‰€æœ‰èŠ‚ç‚¹çš„å€¼è¾¾æˆä¸€è‡´ã€‚ 6. åˆ†å¸ƒå¼ç¼“å­˜é—®é¢˜ 6.1. ç¼“å­˜é›ªå´© ç¼“å­˜é›ªå´©æ˜¯æŒ‡ï¼šåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œç”±äºŽåŽŸæœ‰ç¼“å­˜å¤±æ•ˆï¼Œæ–°ç¼“å­˜æœªåˆ°æœŸé—´(ä¾‹å¦‚ï¼šæˆ‘ä»¬è®¾ç½®ç¼“å­˜æ—¶é‡‡ç”¨äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œåœ¨åŒä¸€æ—¶åˆ»å‡ºçŽ°å¤§é¢ç§¯çš„ç¼“å­˜è¿‡æœŸ)ï¼Œæ‰€æœ‰åŽŸæœ¬åº”è¯¥è®¿é—®ç¼“å­˜çš„è¯·æ±‚éƒ½åŽ»æŸ¥è¯¢æ•°æ®åº“äº†ï¼Œè€Œå¯¹æ•°æ®åº“ CPU å’Œå†…å­˜é€ æˆå·¨å¤§åŽ‹åŠ›ï¼Œä¸¥é‡çš„ä¼šé€ æˆæ•°æ®åº“å®•æœºã€‚ä»Žè€Œå½¢æˆä¸€ç³»åˆ—è¿žé”ååº”ï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚ è§£å†³æ–¹æ¡ˆï¼š ç”¨åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼ä¿è¯æ¥ä¿è¯ä¸ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹å¯¹æ•°æ®åº“ä¸€æ¬¡æ€§è¿›è¡Œè¯»å†™ï¼Œä»Žè€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ°åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚ è¿˜æœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ¡ˆï¼Œå°±æ˜¯å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€ï¼Œä¸è¦æ‰€æœ‰ç¼“å­˜æ—¶é—´é•¿åº¦éƒ½è®¾ç½®æˆ 5 åˆ†é’Ÿæˆ–è€… 10 åˆ†é’Ÿï¼›æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŽŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢žåŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚ 1-5 åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤çŽ‡å°±ä¼šé™ä½Žï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚ ç¼“å­˜å¤±æ•ˆæ—¶äº§ç”Ÿçš„é›ªå´©æ•ˆåº”ï¼Œå°†æ‰€æœ‰è¯·æ±‚å…¨éƒ¨æ”¾åœ¨æ•°æ®åº“ä¸Šï¼Œè¿™æ ·å¾ˆå®¹æ˜“å°±è¾¾åˆ°æ•°æ®åº“çš„ç“¶é¢ˆï¼Œå¯¼è‡´æœåŠ¡æ— æ³•æ­£å¸¸æä¾›ã€‚å°½é‡é¿å…è¿™ç§åœºæ™¯çš„å‘ç”Ÿã€‚ 6.2. ç¼“å­˜ç©¿é€ ç¼“å­˜ç©¿é€æ˜¯æŒ‡ï¼šç”¨æˆ·æŸ¥è¯¢çš„æ•°æ®ï¼Œåœ¨æ•°æ®åº“æ²¡æœ‰ï¼Œè‡ªç„¶åœ¨ç¼“å­˜ä¸­ä¹Ÿä¸ä¼šæœ‰ã€‚è¿™æ ·å°±å¯¼è‡´ç”¨æˆ·æŸ¥è¯¢çš„æ—¶å€™ï¼Œåœ¨ç¼“å­˜ä¸­æ‰¾ä¸åˆ°ï¼Œæ¯æ¬¡éƒ½è¦åŽ»æ•°æ®åº“å†æŸ¥è¯¢ä¸€éï¼Œç„¶åŽè¿”å›žç©ºï¼ˆç›¸å½“äºŽè¿›è¡Œäº†ä¸¤æ¬¡æ— ç”¨çš„æŸ¥è¯¢ï¼‰ã€‚è¿™æ ·è¯·æ±‚å°±ç»•è¿‡ç¼“å­˜ç›´æŽ¥æŸ¥æ•°æ®åº“ï¼Œè¿™ä¹Ÿæ˜¯ç»å¸¸æçš„ç¼“å­˜å‘½ä¸­çŽ‡é—®é¢˜ã€‚ å½“åœ¨æµé‡è¾ƒå¤§æ—¶ï¼Œå‡ºçŽ°è¿™æ ·çš„æƒ…å†µï¼Œä¸€ç›´è¯·æ±‚ DBï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æœåŠ¡æŒ‚æŽ‰ã€‚ è§£å†³æ–¹æ¡ˆï¼š åœ¨å°è£…çš„ç¼“å­˜ SET å’Œ GET éƒ¨åˆ†å¢žåŠ ä¸ªæ­¥éª¤ï¼Œå¦‚æžœæŸ¥è¯¢ä¸€ä¸ª KEY ä¸å­˜åœ¨ï¼Œå°±ä»¥è¿™ä¸ª KEY ä¸ºå‰ç¼€è®¾å®šä¸€ä¸ªæ ‡è¯† KEYï¼›ä»¥åŽå†æŸ¥è¯¢è¯¥ KEY çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ ‡è¯† KEYï¼Œå¦‚æžœæ ‡è¯† KEY å­˜åœ¨ï¼Œå°±è¿”å›žä¸€ä¸ªåå®šå¥½çš„éž false æˆ–è€… NULL å€¼ï¼Œç„¶åŽ APP åšç›¸åº”çš„å¤„ç†ï¼Œè¿™æ ·ç¼“å­˜å±‚å°±ä¸ä¼šè¢«ç©¿é€ã€‚å½“ç„¶è¿™ä¸ªéªŒè¯ KEY çš„å¤±æ•ˆæ—¶é—´ä¸èƒ½å¤ªé•¿ã€‚ å¦‚æžœä¸€ä¸ªæŸ¥è¯¢è¿”å›žçš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•°æ®ä¸å­˜åœ¨ï¼Œè¿˜æ˜¯ç³»ç»Ÿæ•…éšœï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æžœè¿›è¡Œç¼“å­˜ï¼Œä½†å®ƒçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œä¸€èˆ¬åªæœ‰å‡ åˆ†é’Ÿã€‚ é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ bitmap ä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢«è¿™ä¸ª bitmap æ‹¦æˆªæŽ‰ï¼Œä»Žè€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢åŽ‹åŠ›ã€‚ 6.3. ç¼“å­˜é¢„çƒ­ ç¼“å­˜é¢„çƒ­è¿™ä¸ªåº”è¯¥æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„æ¦‚å¿µï¼Œç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´éƒ½åº”è¯¥å¯ä»¥å¾ˆå®¹æ˜“çš„ç†è§£ï¼Œç¼“å­˜é¢„çƒ­å°±æ˜¯ç³»ç»Ÿä¸Šçº¿åŽï¼Œå°†ç›¸å…³çš„ç¼“å­˜æ•°æ®ç›´æŽ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚è¿™æ ·å°±å¯ä»¥é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åŽå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ï¼ç”¨æˆ·ç›´æŽ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ï¼ è§£å†³æ–¹æ¡ˆï¼š ç›´æŽ¥å†™ä¸ªç¼“å­˜åˆ·æ–°é¡µé¢ï¼Œä¸Šçº¿æ—¶æ‰‹å·¥æ“ä½œä¸‹ï¼› æ•°æ®é‡ä¸å¤§ï¼Œå¯ä»¥åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨è¿›è¡ŒåŠ è½½ï¼› å®šæ—¶åˆ·æ–°ç¼“å­˜ï¼› 6.4. ç¼“å­˜æ›´æ–° é™¤äº†ç¼“å­˜æœåŠ¡å™¨è‡ªå¸¦çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥ä¹‹å¤–ï¼ˆRedis é»˜è®¤çš„æœ‰ 6 ä¸­ç­–ç•¥å¯ä¾›é€‰æ‹©ï¼‰ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰çš„ç¼“å­˜æ·˜æ±°ï¼Œå¸¸è§çš„ç­–ç•¥æœ‰ä¸¤ç§ï¼š å®šæ—¶åŽ»æ¸…ç†è¿‡æœŸçš„ç¼“å­˜ï¼› å½“æœ‰ç”¨æˆ·è¯·æ±‚è¿‡æ¥æ—¶ï¼Œå†åˆ¤æ–­è¿™ä¸ªè¯·æ±‚æ‰€ç”¨åˆ°çš„ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸçš„è¯å°±åŽ»åº•å±‚ç³»ç»Ÿå¾—åˆ°æ–°æ•°æ®å¹¶æ›´æ–°ç¼“å­˜ã€‚ ä¸¤è€…å„æœ‰ä¼˜åŠ£ï¼Œç¬¬ä¸€ç§çš„ç¼ºç‚¹æ˜¯ç»´æŠ¤å¤§é‡ç¼“å­˜çš„ key æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œç¬¬äºŒç§çš„ç¼ºç‚¹å°±æ˜¯æ¯æ¬¡ç”¨æˆ·è¯·æ±‚è¿‡æ¥éƒ½è¦åˆ¤æ–­ç¼“å­˜å¤±æ•ˆï¼Œé€»è¾‘ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼å…·ä½“ç”¨å“ªç§æ–¹æ¡ˆï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„åº”ç”¨åœºæ™¯æ¥æƒè¡¡ã€‚ 6.5. ç¼“å­˜é™çº§ å½“è®¿é—®é‡å‰§å¢žã€æœåŠ¡å‡ºçŽ°é—®é¢˜ï¼ˆå¦‚å“åº”æ—¶é—´æ…¢æˆ–ä¸å“åº”ï¼‰æˆ–éžæ ¸å¿ƒæœåŠ¡å½±å“åˆ°æ ¸å¿ƒæµç¨‹çš„æ€§èƒ½æ—¶ï¼Œä»ç„¶éœ€è¦ä¿è¯æœåŠ¡è¿˜æ˜¯å¯ç”¨çš„ï¼Œå³ä½¿æ˜¯æœ‰æŸæœåŠ¡ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®ä¸€äº›å…³é”®æ•°æ®è¿›è¡Œè‡ªåŠ¨é™çº§ï¼Œä¹Ÿå¯ä»¥é…ç½®å¼€å…³å®žçŽ°äººå·¥é™çº§ã€‚ é™çº§çš„æœ€ç»ˆç›®çš„æ˜¯ä¿è¯æ ¸å¿ƒæœåŠ¡å¯ç”¨ï¼Œå³ä½¿æ˜¯æœ‰æŸçš„ã€‚è€Œä¸”æœ‰äº›æœåŠ¡æ˜¯æ— æ³•é™çº§çš„ï¼ˆå¦‚åŠ å…¥è´­ç‰©è½¦ã€ç»“ç®—ï¼‰ã€‚ 7. å‚è€ƒèµ„æ–™ æ¨ä¼ è¾‰. å¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ: åŽŸç†è§£æžä¸Žæž¶æž„å®žæˆ˜[M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2013. åŒºå—é“¾æŠ€æœ¯æŒ‡å— NEAT ALGORITHMS - PAXOS Raft: Understandable Distributed Consensus Paxos By Example èŠèŠåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå†è¯´è¯´è§£å†³æ–¹æ¡ˆ]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
        <tag>distributed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»£ç åå‘³é“ä¹‹è€¦åˆ]]></title>
    <url>%2Fblog%2F2018%2F10%2F13%2Fdesign%2Frefactor%2F%E4%BB%A3%E7%A0%81%E5%9D%8F%E5%91%B3%E9%81%93%E4%B9%8B%E8%80%A6%E5%90%88%2F</url>
    <content type="text"><![CDATA[ä»£ç åå‘³é“ä¹‹è€¦åˆ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ ç¿»è¯‘è‡ªï¼šhttps://sourcemaking.com/refactoring/smells/couplers è€¦åˆ(Couplers)è¿™ç»„åå‘³é“æ„å‘³ç€ï¼šä¸åŒç±»ä¹‹é—´è¿‡åº¦è€¦åˆã€‚ ä¸å®Œç¾Žçš„åº“ç±» ä¸­é—´äºº ä¾æ‹æƒ…ç»“ ç‹Žæ˜µå…³ç³» è¿‡åº¦è€¦åˆçš„æ¶ˆæ¯é“¾ æ‰©å±•é˜…è¯» å‚è€ƒèµ„æ–™ ä¸å®Œç¾Žçš„åº“ç±» ä¸å®Œç¾Žçš„åº“ç±»(Incomplete Library Class) å½“ä¸€ä¸ªç±»åº“å·²ç»ä¸èƒ½æ»¡è¶³å®žé™…éœ€è¦æ—¶ï¼Œä½ å°±ä¸å¾—ä¸æ”¹å˜è¿™ä¸ªåº“ï¼ˆå¦‚æžœè¿™ä¸ªåº“æ˜¯åªè¯»çš„ï¼Œé‚£å°±æ²¡è¾™äº†ï¼‰ã€‚ é—®é¢˜åŽŸå›  è®¸å¤šç¼–ç¨‹æŠ€æœ¯éƒ½å»ºç«‹åœ¨åº“ç±»çš„åŸºç¡€ä¸Šã€‚åº“ç±»çš„ä½œè€…æ²¡ç”¨æœªåœå…ˆçŸ¥çš„èƒ½åŠ›ï¼Œä¸èƒ½å› æ­¤è´£æ€ªä»–ä»¬ã€‚éº»çƒ¦çš„æ˜¯åº“å¾€å¾€æž„é€ çš„ä¸å¤Ÿå¥½ï¼Œè€Œä¸”å¾€å¾€ä¸å¯èƒ½è®©æˆ‘ä»¬ä¿®æ”¹å…¶ä¸­çš„ç±»ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ã€‚ è§£å†³æ–¹æ³• å¦‚æžœä½ åªæƒ³ä¿®æ”¹ç±»åº“çš„ä¸€ä¸¤ä¸ªå‡½æ•°ï¼Œå¯ä»¥è¿ç”¨ å¼•å…¥å¤–åŠ å‡½æ•°(Introduce Foreign Method)ï¼› å¦‚æžœæƒ³è¦æ·»åŠ ä¸€å¤§å †é¢å¤–è¡Œä¸ºï¼Œå°±å¾—è¿ç”¨ å¼•å…¥æœ¬åœ°æ‰©å±•(Introduce Local Extension) ã€‚ æ”¶ç›Š å‡å°‘ä»£ç é‡å¤ï¼ˆä½ ä¸ç”¨ä¸€è¨€ä¸åˆå°±è‡ªå·±åŠ¨æ‰‹å®žçŽ°ä¸€ä¸ªåº“çš„å…¨éƒ¨åŠŸèƒ½ï¼Œä»£ä»·å¤ªé«˜ï¼‰ ä½•æ—¶å¿½ç•¥ å¦‚æžœæ‰©å±•åº“ä¼šå¸¦æ¥é¢å¤–çš„å·¥ä½œé‡ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž å¼•å…¥å¤–åŠ å‡½æ•°(Introduce Foreign Method) é—®é¢˜ ä½ éœ€è¦ä¸ºæä¾›æœåŠ¡çš„ç±»å¢žåŠ ä¸€ä¸ªå‡½æ•°ï¼Œä½†ä½ æ— æ³•ä¿®æ”¹è¿™ä¸ªç±»ã€‚ class Report &#123; //... void sendReport() &#123; Date nextDay = new Date(previousEnd.getYear(), previousEnd.getMonth(), previousEnd.getDate() + 1); //... &#125;&#125; è§£å†³ åœ¨å®¢æˆ·ç±»ä¸­å»ºç«‹ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸€ä¸ªç¬¬ä¸€ä¸ªå‚æ•°å½¢å¼ä¼ å…¥ä¸€ä¸ªæœåŠ¡ç±»å®žä¾‹ã€‚ class Report &#123; //... void sendReport() &#123; Date newStart = nextDay(previousEnd); //... &#125; private static Date nextDay(Date arg) &#123; return new Date(arg.getYear(), arg.getMonth(), arg.getDate() + 1); &#125;&#125; å¼•å…¥æœ¬åœ°æ‰©å±•(Introduce Local Extension) é—®é¢˜ ä½ éœ€è¦ä¸ºæœåŠ¡ç±»æä¾›ä¸€äº›é¢å¤–å‡½æ•°ï¼Œä½†ä½ æ— æ³•ä¿®æ”¹è¿™ä¸ªç±»ã€‚ è§£å†³ å»ºç«‹ä¸€ä¸ªæ–°ç±»ï¼Œä½¿å®ƒåŒ…å«è¿™äº›é¢å¤–å‡½æ•°ï¼Œè®©è¿™ä¸ªæ‰©å±•å“æˆä¸ºæºç±»çš„å­ç±»æˆ–åŒ…è£…ç±»ã€‚ ä¸­é—´äºº ä¸­é—´äºº(Middle Man) å¦‚æžœä¸€ä¸ªç±»çš„ä½œç”¨ä»…ä»…æ˜¯æŒ‡å‘å¦ä¸€ä¸ªç±»çš„å§”æ‰˜ï¼Œä¸ºä»€ä¹ˆè¦å­˜åœ¨å‘¢ï¼Ÿ é—®é¢˜åŽŸå›  å¯¹è±¡çš„åŸºæœ¬ç‰¹å¾ä¹‹ä¸€å°±æ˜¯å°è£…ï¼šå¯¹å¤–éƒ¨ä¸–ç•Œéšè—å…¶å†…éƒ¨ç»†èŠ‚ã€‚å°è£…å¾€å¾€ä¼´éšå§”æ‰˜ã€‚ä½†æ˜¯äººä»¬å¯èƒ½è¿‡åº¦è¿ç”¨å§”æ‰˜ã€‚æ¯”å¦‚ï¼Œä½ ä¹Ÿè®¸ä¼šçœ‹åˆ°ä¸€ä¸ªç±»çš„å¤§éƒ¨åˆ†æœ‰ç”¨å·¥ä½œéƒ½å§”æ‰˜ç»™äº†å…¶ä»–ç±»ï¼Œç±»æœ¬èº«æˆäº†ä¸€ä¸ªç©ºå£³ï¼Œé™¤äº†å§”æ‰˜ä¹‹å¤–ä¸åšä»»ä½•äº‹æƒ…ã€‚ è§£å†³æ–¹æ³• åº”è¯¥è¿ç”¨ ç§»é™¤ä¸­é—´äºº(Remove Middle Man)ï¼Œç›´æŽ¥å’ŒçœŸæ­£è´Ÿè´£çš„å¯¹è±¡æ‰“äº¤é“ã€‚ æ”¶ç›Š å‡å°‘ç¬¨é‡çš„ä»£ç ã€‚ ä½•æ—¶å¿½ç•¥ å¦‚æžœæ˜¯ä»¥ä¸‹æƒ…å†µï¼Œä¸è¦åˆ é™¤å·²åˆ›å»ºçš„ä¸­é—´äººï¼š æ·»åŠ ä¸­é—´äººæ˜¯ä¸ºäº†é¿å…ç±»ä¹‹é—´ä¾èµ–å…³ç³»ã€‚ ä¸€äº›è®¾è®¡æ¨¡å¼æœ‰ç›®çš„åœ°åˆ›å»ºä¸­é—´äººï¼ˆä¾‹å¦‚ä»£ç†æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼ï¼‰ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž ç§»é™¤ä¸­é—´äºº(Remove Middle Man) é—®é¢˜ æŸä¸ªç±»åšäº†è¿‡å¤šçš„ç®€å•å§”æ‰˜åŠ¨ä½œã€‚ è§£å†³ è®©å®¢æˆ·ç›´æŽ¥è°ƒç”¨å§”æ‰˜ç±»ã€‚ ä¾æ‹æƒ…ç»“ ä¾æ‹æƒ…ç»“(Feature Envy) ä¸€ä¸ªå‡½æ•°è®¿é—®å…¶å®ƒå¯¹è±¡çš„æ•°æ®æ¯”è®¿é—®è‡ªå·±çš„æ•°æ®æ›´å¤šã€‚ é—®é¢˜åŽŸå›  è¿™ç§æ°”å‘³å¯èƒ½å‘ç”Ÿåœ¨å­—æ®µç§»åŠ¨åˆ°æ•°æ®ç±»ä¹‹åŽã€‚å¦‚æžœæ˜¯è¿™ç§æƒ…å†µï¼Œä½ å¯èƒ½æƒ³å°†æ•°æ®ç±»çš„æ“ä½œç§»åŠ¨åˆ°è¿™ä¸ªç±»ä¸­ã€‚ è§£å†³æ–¹æ³• As a basic rule, if things change at the same time, you should keep them in the same place. Usually data and functions that use this data are changed together (although exceptions are possible). æœ‰ä¸€ä¸ªåŸºæœ¬åŽŸåˆ™ï¼šåŒæ—¶ä¼šå‘ç”Ÿæ”¹å˜çš„äº‹æƒ…åº”è¯¥è¢«æ”¾åœ¨åŒä¸€ä¸ªåœ°æ–¹ã€‚é€šå¸¸ï¼Œæ•°æ®å’Œä½¿ç”¨è¿™äº›æ•°æ®çš„å‡½æ•°æ˜¯ä¸€èµ·æ”¹å˜çš„ã€‚ å¦‚æžœä¸€ä¸ªå‡½æ•°æ˜Žæ˜¾åº”è¯¥è¢«ç§»åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œå¯è¿ç”¨ æ¬ç§»å‡½æ•°(Move Method) ã€‚ å¦‚æžœä»…ä»…æ˜¯å‡½æ•°çš„éƒ¨åˆ†ä»£ç è®¿é—®å¦ä¸€ä¸ªå¯¹è±¡çš„æ•°æ®ï¼Œè¿ç”¨ æç‚¼å‡½æ•°(Extract Method) å°†è¿™éƒ¨åˆ†ä»£ç ç§»åˆ°ç‹¬ç«‹çš„å‡½æ•°ä¸­ã€‚ å¦‚æžœä¸€ä¸ªæ–¹æ³•ä½¿ç”¨æ¥è‡ªå…¶ä»–å‡ ä¸ªç±»çš„å‡½æ•°ï¼Œé¦–å…ˆç¡®å®šå“ªä¸ªç±»åŒ…å«å¤§å¤šæ•°ä½¿ç”¨çš„æ•°æ®ã€‚ç„¶åŽï¼Œå°†è¯¥æ–¹æ³•ä¸Žå…¶ä»–æ•°æ®ä¸€èµ·æ”¾åœ¨æ­¤ç±»ä¸­ã€‚æˆ–è€…ï¼Œä½¿ç”¨ æç‚¼å‡½æ•°(Extract Method) å°†æ–¹æ³•æ‹†åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Œå¯ä»¥æ”¾ç½®åœ¨ä¸åŒç±»ä¸­çš„ä¸åŒä½ç½®ã€‚ æ”¶ç›Š å‡å°‘é‡å¤ä»£ç ï¼ˆå¦‚æžœæ•°æ®å¤„ç†çš„ä»£ç æ”¾åœ¨ä¸­å¿ƒä½ç½®ï¼‰ã€‚ æ›´å¥½çš„ä»£ç ç»„ç»‡æ€§ï¼ˆå¤„ç†æ•°æ®çš„å‡½æ•°é è¿‘å®žé™…æ•°æ®ï¼‰ã€‚ ä½•æ—¶å¿½ç•¥ æœ‰æ—¶ï¼Œè¡Œä¸ºè¢«æœ‰æ„åœ°ä¸Žä¿å­˜æ•°æ®çš„ç±»åˆ†å¼€ã€‚è¿™é€šå¸¸çš„ä¼˜ç‚¹æ˜¯èƒ½å¤ŸåŠ¨æ€åœ°æ”¹å˜è¡Œä¸ºï¼ˆè§ç­–ç•¥è®¾è®¡æ¨¡å¼ï¼Œè®¿é—®è€…è®¾è®¡æ¨¡å¼å’Œå…¶ä»–æ¨¡å¼ï¼‰ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž æ¬ç§»å‡½æ•°(Move Method) é—®é¢˜ ä½ çš„ç¨‹åºä¸­ï¼Œæœ‰ä¸ªå‡½æ•°ä¸Žå…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»è¿›è¡Œæ›´å¤šäº¤æµï¼šè°ƒç”¨åŽè€…ï¼Œæˆ–è¢«åŽè€…è°ƒç”¨ã€‚ è§£å†³ åœ¨è¯¥å‡½æ•°æœ€å¸¸å¼•ç”¨çš„ç±»ä¸­å»ºç«‹ä¸€ä¸ªæœ‰ç€ç±»ä¼¼è¡Œä¸ºçš„æ–°å‡½æ•°ã€‚å°†æ—§å‡½æ•°å˜æˆä¸€ä¸ªå•çº¯çš„å§”æ‰˜å‡½æ•°ï¼Œæˆ–æ˜¯æ—§å‡½æ•°å®Œå…¨ç§»é™¤ã€‚ æç‚¼å‡½æ•°(Extract Method) é—®é¢˜ ä½ æœ‰ä¸€æ®µä»£ç å¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ã€‚ void printOwing() &#123; printBanner(); //print details System.out.println("name: " + name); System.out.println("amount: " + getOutstanding());&#125; è§£å†³ ç§»åŠ¨è¿™æ®µä»£ç åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•°ä¸­ï¼Œä½¿ç”¨å‡½æ•°çš„è°ƒç”¨æ¥æ›¿ä»£è€ä»£ç ã€‚ void printOwing() &#123; printBanner(); printDetails(getOutstanding());&#125;void printDetails(double outstanding) &#123; System.out.println("name: " + name); System.out.println("amount: " + outstanding);&#125; ç‹Žæ˜µå…³ç³» ç‹Žæ˜µå…³ç³»(Inappropriate Intimacy) ä¸€ä¸ªç±»å¤§é‡ä½¿ç”¨å¦ä¸€ä¸ªç±»çš„å†…éƒ¨å­—æ®µå’Œæ–¹æ³•ã€‚ é—®é¢˜åŽŸå›  ç±»å’Œç±»ä¹‹é—´åº”è¯¥å°½é‡å°‘çš„æ„ŸçŸ¥å½¼æ­¤ï¼ˆå‡å°‘è€¦åˆï¼‰ã€‚è¿™æ ·çš„ç±»æ›´å®¹æ˜“ç»´æŠ¤å’Œå¤ç”¨ã€‚ è§£å†³æ–¹æ³• æœ€ç®€å•çš„è§£å†³æ–¹æ³•æ˜¯è¿ç”¨ æ¬ç§»å‡½æ•°(Move Method) å’Œ æ¬ç§»å­—æ®µ(Move Field) æ¥è®©ç±»ä¹‹é—´æ–©æ–­ç¾ç»Šã€‚ ä½ ä¹Ÿå¯ä»¥çœ‹çœ‹æ˜¯å¦èƒ½è¿ç”¨ å°†åŒå‘å…³è”æ”¹ä¸ºå•å‘å…³è”(Change Bidirectional Association to Unidirectional) è®©å…¶ä¸­ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªè¯´åˆ†æ‰‹ã€‚ å¦‚æžœè¿™ä¸¤ä¸ªç±»å®žåœ¨æ˜¯æƒ…æ¯”é‡‘åšï¼Œéš¾åˆ†éš¾èˆï¼Œå¯ä»¥è¿ç”¨ æç‚¼ç±»(Extract Class) æŠŠäºŒè€…å…±åŒç‚¹æç‚¼åˆ°ä¸€ä¸ªæ–°ç±»ä¸­ï¼Œè®©å®ƒä»¬äº§ç”Ÿçˆ±çš„ç»“æ™¶ã€‚æˆ–è€…ï¼Œå¯ä»¥å°è¯•è¿ç”¨ éšè—å§”æ‰˜å…³ç³»(Hide Delegate) è®©å¦ä¸€ä¸ªç±»æ¥ä¸ºå®ƒä»¬ç‰µçº¿æ­æ¡¥ã€‚ ç»§æ‰¿å¾€å¾€é€ æˆç±»ä¹‹é—´è¿‡åˆ†ç´§å¯†ï¼Œå› ä¸ºå­ç±»å¯¹è¶…ç±»çš„äº†è§£æ€»æ˜¯è¶…è¿‡åŽè€…çš„ä¸»è§‚æ„¿æœ›ï¼Œå¦‚æžœä½ è§‰å¾—è¯¥è®©è¿™ä¸ªå­ç±»è‡ªå·±é—¯è¡ï¼Œè¯·è¿ç”¨ ä»¥å§”æ‰˜å–ä»£ç»§æ‰¿(Replace Inheritance with Delegation) æ¥è®©è¶…ç±»å’Œå­ç±»åˆ†å®¶ã€‚ æ”¶ç›Š æé«˜ä»£ç ç»„ç»‡æ€§ã€‚ æé«˜ä»£ç å¤ç”¨æ€§ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž æ¬ç§»å‡½æ•°(Move Method) é—®é¢˜ ä½ çš„ç¨‹åºä¸­ï¼Œæœ‰ä¸ªå‡½æ•°ä¸Žå…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»è¿›è¡Œæ›´å¤šäº¤æµï¼šè°ƒç”¨åŽè€…ï¼Œæˆ–è¢«åŽè€…è°ƒç”¨ã€‚ è§£å†³ åœ¨è¯¥å‡½æ•°æœ€å¸¸å¼•ç”¨çš„ç±»ä¸­å»ºç«‹ä¸€ä¸ªæœ‰ç€ç±»ä¼¼è¡Œä¸ºçš„æ–°å‡½æ•°ã€‚å°†æ—§å‡½æ•°å˜æˆä¸€ä¸ªå•çº¯çš„å§”æ‰˜å‡½æ•°ï¼Œæˆ–æ˜¯æ—§å‡½æ•°å®Œå…¨ç§»é™¤ã€‚ æ¬ç§»å­—æ®µ(Move Field) é—®é¢˜ åœ¨ä½ çš„ç¨‹åºä¸­ï¼ŒæŸä¸ªå­—æ®µè¢«å…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»æ›´å¤šåœ°ç”¨åˆ°ã€‚ è§£å†³ åœ¨ç›®æ ‡ç±»æ–°å»ºä¸€ä¸ªå­—æ®µï¼Œä¿®æ”¹æºå­—æ®µçš„æ‰€æœ‰ç”¨æˆ·ï¼Œä»¤ä»–ä»¬æ”¹ç”¨æ–°å­—æ®µã€‚ å°†åŒå‘å…³è”æ”¹ä¸ºå•å‘å…³è”(Change Bidirectional Association to Unidirectional) é—®é¢˜ ä¸¤ä¸ªç±»ä¹‹é—´æœ‰åŒå‘å…³è”ï¼Œä½†å…¶ä¸­ä¸€ä¸ªç±»å¦‚ä»Šä¸å†éœ€è¦å¦ä¸€ä¸ªç±»çš„ç‰¹æ€§ã€‚ è§£å†³ åŽ»é™¤ä¸å¿…è¦çš„å…³è”ã€‚ æç‚¼ç±»(Extract Class) é—®é¢˜ æŸä¸ªç±»åšäº†ä¸æ­¢ä¸€ä»¶äº‹ã€‚ è§£å†³ å»ºç«‹ä¸€ä¸ªæ–°ç±»ï¼Œå°†ç›¸å…³çš„å­—æ®µå’Œå‡½æ•°ä»Žæ—§ç±»æ¬ç§»åˆ°æ–°ç±»ã€‚ éšè—å§”æ‰˜å…³ç³»(Hide Delegate) é—®é¢˜ å®¢æˆ·é€šè¿‡ä¸€ä¸ªå§”æ‰˜ç±»æ¥è°ƒç”¨å¦ä¸€ä¸ªå¯¹è±¡ã€‚ è§£å†³ åœ¨æœåŠ¡ç±»ä¸Šå»ºç«‹å®¢æˆ·æ‰€éœ€çš„æ‰€æœ‰å‡½æ•°ï¼Œç”¨ä»¥éšè—å§”æ‰˜å…³ç³»ã€‚ ä»¥å§”æ‰˜å–ä»£ç»§æ‰¿(Replace Inheritance with Delegation) é—®é¢˜ æŸä¸ªå­ç±»åªä½¿ç”¨è¶…ç±»æŽ¥å£ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–æ˜¯æ ¹æœ¬ä¸éœ€è¦ç»§æ‰¿è€Œæ¥çš„æ•°æ®ã€‚ è§£å†³ åœ¨å­ç±»ä¸­æ–°å»ºä¸€ä¸ªå­—æ®µç”¨ä»¥ä¿å­˜è¶…ç±»ï¼›è°ƒæ•´å­ç±»å‡½æ•°ï¼Œä»¤å®ƒæ”¹è€Œå§”æ‰˜è¶…ç±»ï¼›ç„¶åŽåŽ»æŽ‰ä¸¤è€…ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ã€‚ è¿‡åº¦è€¦åˆçš„æ¶ˆæ¯é“¾ è¿‡åº¦è€¦åˆçš„æ¶ˆæ¯é“¾(Message Chains) æ¶ˆæ¯é“¾çš„å½¢å¼ç±»ä¼¼äºŽï¼šobj.getA().getB().getC()ã€‚ é—®é¢˜åŽŸå›  å¦‚æžœä½ çœ‹åˆ°ç”¨æˆ·å‘ä¸€ä¸ªå¯¹è±¡è¯·æ±‚å¦ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åŽå†å‘åŽè€…è¯·æ±‚å¦ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åŽå†è¯·æ±‚å¦ä¸€ä¸ªå¯¹è±¡â€¦â€¦è¿™å°±æ˜¯æ¶ˆæ¯é“¾ã€‚å®žé™…ä»£ç ä¸­ä½ çœ‹åˆ°çš„å¯èƒ½æ˜¯ä¸€é•¿ä¸² getThis()æˆ–ä¸€é•¿ä¸²ä¸´æ—¶å˜é‡ã€‚é‡‡å–è¿™ç§æ–¹å¼ï¼Œæ„å‘³å®¢æˆ·ä»£ç å°†ä¸ŽæŸ¥æ‰¾è¿‡ç¨‹ä¸­çš„å¯¼èˆªç´§å¯†è€¦åˆã€‚ä¸€æ—¦å¯¹è±¡é—´å…³ç³»å‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œå®¢æˆ·ç«¯å°±ä¸å¾—ä¸åšå‡ºç›¸åº”çš„ä¿®æ”¹ã€‚ è§£å†³æ–¹æ³• å¯ä»¥è¿ç”¨ éšè—å§”æ‰˜å…³ç³»(Hide Delegate) åˆ é™¤ä¸€ä¸ªæ¶ˆæ¯é“¾ã€‚ æœ‰æ—¶æ›´å¥½çš„é€‰æ‹©æ˜¯ï¼šå…ˆè§‚å¯Ÿæ¶ˆæ¯é“¾æœ€ç»ˆå¾—åˆ°çš„å¯¹è±¡æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„ã€‚çœ‹çœ‹èƒ½å¦ä»¥ æç‚¼å‡½æ•°(Extract Method)æŠŠä½¿ç”¨è¯¥å¯¹è±¡çš„ä»£ç æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹å‡½æ•°ä¸­ï¼Œå†è¿ç”¨ æ¬ç§»å‡½æ•°(Move Method) æŠŠè¿™ä¸ªå‡½æ•°æŽ¨å…¥æ¶ˆæ¯é“¾ã€‚ æ”¶ç›Š èƒ½å‡å°‘é“¾ä¸­ç±»ä¹‹é—´çš„ä¾èµ–ã€‚ èƒ½å‡å°‘ä»£ç é‡ã€‚ ä½•æ—¶å¿½ç•¥ è¿‡äºŽä¾µç•¥æ€§çš„å§”æ‰˜å¯èƒ½ä¼šä½¿ç¨‹åºå‘˜éš¾ä»¥ç†è§£åŠŸèƒ½æ˜¯å¦‚ä½•è§¦å‘çš„ã€‚ é‡æž„æ–¹æ³•è¯´æ˜Ž éšè—å§”æ‰˜å…³ç³»(Hide Delegate) é—®é¢˜ å®¢æˆ·é€šè¿‡ä¸€ä¸ªå§”æ‰˜ç±»æ¥è°ƒç”¨å¦ä¸€ä¸ªå¯¹è±¡ã€‚ è§£å†³ åœ¨æœåŠ¡ç±»ä¸Šå»ºç«‹å®¢æˆ·æ‰€éœ€çš„æ‰€æœ‰å‡½æ•°ï¼Œç”¨ä»¥éšè—å§”æ‰˜å…³ç³»ã€‚ æç‚¼å‡½æ•°(Extract Method) é—®é¢˜ ä½ æœ‰ä¸€æ®µä»£ç å¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ã€‚ void printOwing() &#123; printBanner(); //print details System.out.println("name: " + name); System.out.println("amount: " + getOutstanding());&#125; è§£å†³ ç§»åŠ¨è¿™æ®µä»£ç åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•°ä¸­ï¼Œä½¿ç”¨å‡½æ•°çš„è°ƒç”¨æ¥æ›¿ä»£è€ä»£ç ã€‚ void printOwing() &#123; printBanner(); printDetails(getOutstanding());&#125;void printDetails(double outstanding) &#123; System.out.println("name: " + name); System.out.println("amount: " + outstanding);&#125; æ¬ç§»å‡½æ•°(Move Method) é—®é¢˜ ä½ çš„ç¨‹åºä¸­ï¼Œæœ‰ä¸ªå‡½æ•°ä¸Žå…¶æ‰€é©»ç±»ä¹‹å¤–çš„å¦ä¸€ä¸ªç±»è¿›è¡Œæ›´å¤šäº¤æµï¼šè°ƒç”¨åŽè€…ï¼Œæˆ–è¢«åŽè€…è°ƒç”¨ã€‚ è§£å†³ åœ¨è¯¥å‡½æ•°æœ€å¸¸å¼•ç”¨çš„ç±»ä¸­å»ºç«‹ä¸€ä¸ªæœ‰ç€ç±»ä¼¼è¡Œä¸ºçš„æ–°å‡½æ•°ã€‚å°†æ—§å‡½æ•°å˜æˆä¸€ä¸ªå•çº¯çš„å§”æ‰˜å‡½æ•°ï¼Œæˆ–æ˜¯æ—§å‡½æ•°å®Œå…¨ç§»é™¤ã€‚ æ‰©å±•é˜…è¯» ä»£ç çš„åå‘³é“å’Œé‡æž„ ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿ ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡ ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢ ä»£ç åå‘³é“ä¹‹éžå¿…è¦çš„ ä»£ç åå‘³é“ä¹‹è€¦åˆ å‚è€ƒèµ„æ–™ é‡æž„â€”â€”æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ - by Martin Fowler https://sourcemaking.com/refactoring]]></content>
      <categories>
        <category>design</category>
        <category>refactor</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>refactor</tag>
        <tag>code-smell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»£ç çš„åå‘³é“å’Œé‡æž„]]></title>
    <url>%2Fblog%2F2018%2F10%2F13%2Fdesign%2Frefactor%2F%E4%BB%A3%E7%A0%81%E7%9A%84%E5%9D%8F%E5%91%B3%E9%81%93%E5%92%8C%E9%87%8D%E6%9E%84%2F</url>
    <content type="text"><![CDATA[ä»£ç çš„åå‘³é“å’Œé‡æž„ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ ç—‡ä¸Žè¯ å¯¹ä»£ç çš„åå‘³é“çš„æ€è€ƒ é‡æž„çš„åŽŸåˆ™ ä»£ç çš„åå‘³é“ ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿ ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡ ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢ ä»£ç åå‘³é“ä¹‹éžå¿…è¦çš„ ä»£ç åå‘³é“ä¹‹è€¦åˆ æ‰©å±•é˜…è¯» å‚è€ƒèµ„æ–™ ç¬¬ä¸€æ¬¡è¯»ã€Šé‡æž„:æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹æ—¶ï¼Œæˆ‘æ›¾æ•´ç†è¿‡ä¸€ä¸ªç®€å•çš„ç¬”è®°ã€‚æœ€è¿‘ï¼Œå› ä¸ºå‚ä¸Žä¸€ä¸ªé‡æž„é¡¹ç›®ï¼Œå†ä¸€æ¬¡æ¸©ä¹ äº†ã€Šé‡æž„:æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹ã€‚è¿‡ç¨‹ä¸­ï¼ŒèŒå‘äº†è®¤çœŸæ€»ç»“ã€æ•´ç†é‡æž„æ–¹æ³•çš„å†²åŠ¨ï¼ŒäºŽæ˜¯æœ‰äº†è¿™ç³»åˆ—æ–‡å­—ã€‚ ä»£ç çš„åå‘³é“è¿˜æœ‰å‡ ç¯‡æ²¡æœ‰å®Œç¨¿ï¼ŒåŽé¢æˆ‘ä¼šé™†ç»­è¡¥å……ã€‚ã€‚ã€‚ ç—‡ä¸Žè¯ å¯¹ä»£ç çš„åå‘³é“çš„æ€è€ƒ â€œæœ‰ç—…è¦æ—©æ²»ï¼Œä¸è¦æ”¾å¼ƒæ²»ç–—â€ã€‚å¤šä¹ˆæœ´ç´ çš„é“ç† ï¼Œäººäººéƒ½æ‡‚ã€‚ ç—…ï¼Œå°±æ˜¯ä¸å¥åº·ã€‚ äººæœ‰ç—…ï¼Œå¯ä»¥é€šè¿‡æ‰“é’ˆã€åƒè¯ã€åšæ‰‹æœ¯æ¥è¿›è¡Œæ²»ç–—ã€‚ å¦‚æžœæŠŠä»£ç çš„åå‘³é“ï¼ˆä»£ç è´¨é‡é—®é¢˜ï¼‰æ¯”ä½œç—…ç—‡ï¼Œé‚£ä¹ˆé‡æž„å°±æ˜¯æ²»ç–—ä»£ç çš„åå‘³é“çš„è¯ã€‚ ä¸ªäººè®¤ä¸ºï¼Œåœ¨é‡æž„è¿™ä»¶äº‹ä¸Šï¼Œä¹Ÿå¯ä»¥åº”ç”¨æ²»ç—…çš„é“ç†ï¼š é˜²ç—…äºŽæœªç„¶ã€‚ â€”â€” æ˜¥ç§‹æˆ˜å›½æ—¶æœŸçš„ä¸€ä»£ååŒ»æ‰é¹Šï¼Œæ›¾ç»æœ‰ä¸ªå¾ˆè‘—åçš„åŒ»å­¦ä¸»å¼ ï¼šé˜²ç—…äºŽæœªç„¶ã€‚ æˆ‘è§‰å¾—è¿™ä¸ªé“ç†åº”ç”¨äºŽè½¯ä»¶ä»£ç çš„é‡æž„äº¦ç„¶ã€‚ç¼–ç¨‹å‰è¦æœ‰åˆç†çš„è®¾è®¡ã€ç¼–ç¨‹æ—¶è¦æœ‰è‰¯å¥½çš„ç¼–ç¨‹é£Žæ ¼ï¼Œå°½é‡å‡å°‘é—®é¢˜ã€‚ä»Žè¿™ä¸ªå±‚é¢ä¸Šè¯´ï¼Œäº†è§£ä»£ç çš„åå‘³é“ï¼Œä¸ä»…ä»…æ˜¯ä¸ºäº†å‘çŽ°é—®é¢˜ã€è§£å†³é—®é¢˜ã€‚æ›´é‡è¦çš„ä½œç”¨æ˜¯ï¼šæŒ‡å¯¼æˆ‘ä»¬åœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­æœ‰æ„è¯†çš„åŽ»è§„é¿è¿™äº›é—®é¢˜ã€‚ å°ç—…ä¸åŒ»ï¼Œæ˜“å¾—å¤§ç—…ã€‚ â€”â€” åˆ˜å¤‡è¯´è¿‡ï¼šâ€œå‹¿ä»¥å–„å°è€Œä¸ä¸ºï¼Œå‹¿ä»¥æ¶å°è€Œä¸ºä¹‹â€ã€‚å‘çŽ°é—®é¢˜å°±åŠæ—¶ä¿®æ”¹ï¼Œä»£ç è´¨é‡è‡ªç„¶å®¹æ˜“è¿›å…¥è‰¯æ€§å¾ªçŽ¯ï¼›åä¹‹ï¼Œäº¦ç„¶ã€‚è¦é‡è§†ç§¯ç´¯çš„åŠ›é‡ï¼Œåˆ«æ€»ä»¥ä¸ºä»£ç å‡ºçŽ°ç‚¹å°é—®é¢˜ï¼Œé‚£éƒ½ä¸æ˜¯äº‹å„¿ã€‚ å¯¹ç—‡ä¸‹è¯ã€‚ â€”â€” ç¨‹åºå‡ºçŽ°äº†é—®é¢˜ï¼Œè¦åˆ†æžå‡ºé—®é¢˜çš„æ ¹æœ¬ï¼Œæœ‰é’ˆå¯¹æ€§çš„åˆ¶å®šåˆç†çš„é‡æž„æ–¹æ¡ˆã€‚å¤§å®¶éƒ½çŸ¥é“åƒé”™è¯çš„åŽæžœï¼ŒåŒæ ·çš„ï¼ŒçžŽæ”¹è¿˜ä¸å¦‚ä¸æ”¹ã€‚ å¿ŒçŒ›è¯ â€”â€” åŒ»ç—…ç”¨çŒ›è¯å®¹æ˜“äº§ç”Ÿå‰¯ä½œç”¨ã€‚æ¢ä¸€å¥ä¿—è¯­ï¼šæ­¥å­å¤§äº†å®¹æ˜“æ‰¯ç€è›‹ã€‚é‡æž„å¦‚æžœå¤§åˆ€é˜”æ–§çš„å¹²ï¼Œé‚£ä½ å°±è¦æœ‰éšæ—¶å¯èƒ½æ‰‘è¡—çš„å¿ƒç†å‡†å¤‡ã€‚æŽ¨å€’é‡æ¥ä¸æ˜¯é‡æž„ï¼Œè€Œæ˜¯é‡å†™ã€‚é‡æž„åº”è¯¥æ˜¯å¾ªåºæ¸è¿›ï¼Œæ­¥æ­¥ä¸ºè¥çš„è¿‡ç¨‹ã€‚å½“ä½ å‘çŽ°é‡å†™ä»£ç æ¯”é‡æž„ä»£ç æ›´ç®€å•ï¼Œå¾€å¾€è¯´æ˜Žä½ æ—©å°±è¯¥é‡æž„äº†ã€‚ é‡æž„çš„åŽŸåˆ™ å‰é¢æŠŠä»£ç è´¨é‡é—®é¢˜æ¯”ä½œç—…ç—‡ï¼Œè€ŒæŠŠé‡æž„æ¯”ä½œè¯ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å†è¿›ä¸€æ­¥è®¨è®ºä¸€ä¸‹é‡æž„çš„åŽŸåˆ™ã€‚ ä½•è°“é‡æž„(What) é‡æž„ï¼ˆRefactoringï¼‰ çš„å¸¸è§å®šä¹‰æ˜¯ï¼šä¸æ”¹å˜è½¯ä»¶ç³»ç»Ÿå¤–éƒ¨è¡Œä¸ºçš„å‰æä¸‹ï¼Œæ”¹å–„å®ƒçš„å†…éƒ¨ç»“æž„ã€‚ ä¸ªäººè§‰å¾—è¿™ä¸ªå®šä¹‰æœ‰ç‚¹ç”Ÿæ¶©ã€‚ä¸å¦¨ç†è§£ä¸ºï¼šé‡æž„æ˜¯ç»™ä»£ç æ²»ç—…çš„è¡Œä¸ºã€‚è€Œä»£ç æœ‰ç—…æ˜¯æŒ‡ä»£ç çš„è´¨é‡ï¼ˆå¯é æ€§ã€å®‰å…¨æ€§ã€å¯å¤ç”¨æ€§ã€å¯ç»´æŠ¤æ€§ï¼‰å’Œæ€§èƒ½æœ‰é—®é¢˜ã€‚ é‡æž„çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜ä»£ç çš„è´¨é‡å’Œæ€§èƒ½ã€‚ æ³¨ï¼šåŠŸèƒ½ä¸å…¨æˆ–è€…ä¸æ­£ç¡®ï¼Œé‚£æ˜¯æ®‹ç–¾ä»£ç ã€‚å°±åƒæ²»ç—…æ²»ä¸äº†æ®‹ç–¾ï¼Œé‡æž„ä¹Ÿè§£å†³ä¸äº†åŠŸèƒ½é—®é¢˜ã€‚ ä¸ºä½•é‡æž„(Why) ç¿»ç¿»ä¹¦ï¼Œä¸Šç½‘æœä¸€ä¸‹ï¼Œè°ˆåˆ°é‡æž„çš„ç†ç”±å¤§ä½“ç›¸åŒï¼š é‡æž„æ”¹è¿›è½¯ä»¶è®¾è®¡ é‡æž„ä½¿è½¯ä»¶æ›´å®¹æ˜“ç†è§£ é‡æž„å¸®åŠ©æ‰¾åˆ° bug é‡æž„æé«˜ç¼–ç¨‹é€Ÿåº¦ æ€»ä¹‹å°±æ˜¯ï¼Œé‡æž„å¯ä»¥æé«˜ä»£ç è´¨é‡ã€‚ ä½•æ—¶é‡æž„(When) å…³äºŽä½•æ—¶é‡æž„ï¼Œæˆ‘å…ˆå¼•ç”¨ä¸€ä¸‹ é‡æž„å¹¶éžéš¾åœ¨å¦‚ä½•åšï¼Œè€Œæ˜¯éš¾åœ¨ä½•æ—¶å¼€å§‹åš ä¸€æ–‡çš„è§‚ç‚¹ã€‚ å¯¹äºŽä¸€ä¸ªé«˜é€Ÿå‘å±•çš„å…¬å¸æ¥è¯´ï¼Œåœæ­¢ä¸šåŠ¡å¼€å‘ï¼Œä¸“é—¨æ¥åšé‡æž„é¡¹ç›®ï¼Œä»Žæ¥å°±ä¸æ˜¯ä¸€ä¸ªå¯æŽ¥å—çš„é€‰é¡¹ï¼Œâ€œè¾¹å¼€é£žæœºè¾¹æ¢å¼•æ“Žâ€æ‰æ˜¯è¿™ç§å…¬å¸æƒ³è¦çš„ã€‚ æˆ‘ä»¬ä¸å¦¨æ¥è¡¡é‡ä¸€ä¸‹é‡æž„çš„æˆæœ¬å’Œæ”¶ç›Šã€‚ é‡æž„çš„æˆæœ¬ é‡æž„æ˜¯æœ‰æˆæœ¬çš„ï¼Œè´¹æ—¶è´¹åŠ›ï¼ˆæ—¶é—´ã€äººåŠ›ï¼‰ä¸è¯´ï¼Œè¿˜æœ‰å¯èƒ½ä¼šä½¿æœ¬æ¥æ­£å¸¸è¿è¡Œçš„ç¨‹åºå‡ºé”™ã€‚æ‰€ä»¥ï¼Œå¾ˆå¤šäººéƒ½æŠ±ç€â€œä¸æ±‚æœ‰åŠŸï¼Œä½†æ±‚æ— è¿‡â€çš„å¿ƒç†å¾—è¿‡ä¸”è¿‡ã€‚ è¿˜æœ‰ä¸€ç§æˆæœ¬ï¼šé‡æž„ä½¿ç”¨è¾ƒæ–°ä¸”è¾ƒä¸ºå¤æ‚çš„æŠ€æœ¯ï¼Œå­¦ä¹ æ›²çº¿ä¸å¹³æ»‘ï¼Œå›¢é˜Ÿæˆå‘˜æŠ€æœ¯åˆ‡æ¢å›°éš¾ï¼ŒçŸ­æœŸå†…å¼€å‘æ•ˆçŽ‡å¯èƒ½ä¸å‡åé™ã€‚ ä½†æ˜¯ï¼Œå¦‚æžœä¸€ç›´æ”¾ä»»ä»£ç è…æœ½ä¸‹åŽ»ï¼ŒæŠ€æœ¯å€ºåŠ¡ä¼šè¶Šæ¥è¶Šæ²‰é‡ã€‚å½“ä»£ç æœ€ç»ˆå¿«è¦è·‘ä¸åŠ¨æ—¶ï¼Œæž¶æž„å¸ˆä»¬å¾€å¾€è¿˜æ˜¯ä¸å¾—ä¸ä½¿ç”¨æ¿€è¿›çš„æ‰‹æ®µæ¥æ²»ç–—ä»£ç çš„é¡½ç–¾ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªè¿‡ç¨‹é€šå¸¸éƒ½æ˜¯éžå¸¸ç—›è‹¦çš„ï¼Œè€Œä¸”æœ‰ç€å¾ˆé«˜çš„å¤±è´¥é£Žé™©ã€‚ é‡æž„çš„æ”¶ç›Š é‡æž„çš„æ”¶ç›Šæ˜¯æé«˜ä»£ç çš„è´¨é‡å’Œæ€§èƒ½ï¼Œå¹¶æé«˜æœªæ¥çš„å¼€å‘æ•ˆçŽ‡ã€‚ä½†æ˜¯ï¼Œåº”å½“çœ‹åˆ°ï¼Œé‡æž„å¾€å¾€å¹¶ä¸èƒ½åœ¨çŸ­æœŸå†…å¸¦æ¥å®žé™…çš„æ•ˆç›Šï¼Œæˆ–è€…å¾ˆéš¾ç›´è§‚çœ‹å‡ºæ•ˆç›Šã€‚è€Œå¯¹äºŽä¸€ä¸ªä¼ä¸šæ¥è¯´ï¼Œæ²¡æœ‰ä»€ä¹ˆæ¯”æ•ˆç›Šæ›´é‡è¦ã€‚æ¢å¥è¯è¯´ï¼Œæ²¡æœ‰å®žé™…æ•ˆç›Šçš„äº‹ï¼Œé€šå¸¸ä¹Ÿæ²¡æœ‰ä»·å€¼ã€‚å¾ˆå¤šé¢†å¯¼ï¼Œå°¤å…¶æ˜¯éžæŠ€æœ¯æ–¹å‘çš„é¢†å¯¼ï¼Œå¹¶ä¸å…³å¿ƒä½ åº”ç”¨äº†ä»€ä¹ˆæ–°æŠ€æœ¯ï¼Œè®©ä»£ç å˜å¾—å¤šä¹ˆä¼˜é›…ç­‰ç­‰ã€‚ é‡æž„çš„åˆé€‚æ—¶æœº ä»Žä»¥ä¸Šæ¥çœ‹ï¼Œé‡æž„å®žåœ¨æ˜¯ä¸ªåƒåŠ›ä¸è®¨å¥½çš„äº‹æƒ…ã€‚ äºŽæ˜¯ï¼Œå¾ˆå¤šäººå±ˆæœäºŽä¸‡æ¶çš„ KPI å’Œè¦å‘½çš„ deadlineï¼Œä¸€è¾¹åæ§½ç€ä»¥å‰çš„ä»£ç æ˜¯åžƒåœ¾ï¼Œä¸€è¾¹è‡ªå·±ä¹Ÿåœ¨é€ åžƒåœ¾ã€‚ ä½†æ˜¯ï¼Œ**é‡æž„æœ¬åº”è¯¥æ˜¯ä¸ªæ¸è¿›å¼çš„è¿‡ç¨‹ï¼Œä¸æ˜¯åªæœ‰ä¼¤ç­‹åŠ¨éª¨çš„æ”¹é€ æ‰å«é‡æž„ã€‚**å¦‚æžœéžè¦ç­‰åˆ°ä»£ç å·²ç»çƒ‚åˆ°ç—…å…¥è†è‚“ï¼Œå†ä½¿ç”¨æ¿€è¿›æ–¹å¼æ¥é‡æž„ï¼Œé‚£å¿…ç„¶æ˜¯å›°éš¾é‡é‡ï¼Œé£Žé™©æžé«˜ã€‚ ã€Šé‡æž„ã€‹ä¹¦ä¸­æåˆ°çš„é‡æž„æ—¶æœºåº”è¯¥åœ¨æ·»åŠ åŠŸèƒ½ã€ä¿®å¤åŠŸèƒ½ã€å®¡æŸ¥ä»£ç æ—¶ï¼Œä¸å»ºè®®ä¸“é—¨æŠ½å‡ºæ—¶é—´ä¸“é—¨åšé‡æž„é¡¹ç›®ã€‚ æˆ‘è®¤ä¸ºï¼Œå…¶æ€æƒ³å°±æ˜¯æŒ‡ï¼šé‡æž„åº”è¯¥æ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­å®žæ—¶çš„ã€æ¸è¿›çš„æ¼”åŒ–è¿‡ç¨‹ã€‚ é‡æž„çš„ä¸æ°å½“æ—¶æœº ä½†æ˜¯ï¼Œè¿™é‡Œæˆ‘ä¹Ÿè¦å¼ºè°ƒä¸€ä¸‹ï¼šä¸æ˜¯æ‰€æœ‰è½¯ä»¶å¼€å‘è¿‡ç¨‹éƒ½ä¸€å®šè¦é‡æž„ã€‚ è¾ƒèƒ½å‡¸æ˜¾é‡æž„ä»·å€¼çš„åœºæ™¯æ˜¯ï¼šä»£ç è§„æ¨¡è¾ƒå¤§ã€ç”Ÿå‘½å‘¨æœŸè¿˜è¾ƒé•¿ã€æ‰¿æ‹…äº†è¾ƒå¤šè´£ä»»ã€æœ‰ä¸€ä¸ªè¾ƒå¤§ï¼ˆä¸”è¾ƒä¸ç¨³å®šï¼Œäººå‘˜æµåŠ¨é¢‘ç¹ï¼‰å›¢é˜Ÿåœ¨å…¶ä¸Šå·¥ä½œçš„å•ä¸€ä»£ç åº“ã€‚ ä¸Žä¹‹ç›¸åï¼Œæœ‰ä¸€äº›åœºæ™¯çš„é‡æž„ä»·å€¼å°±å¾ˆå°ï¼š ä»£ç åº“ç”Ÿå‘½å‘¨æœŸå¿«è¦èµ°åˆ°å°¾å£°ï¼Œå¼€å‘é€æ¸å‡å°‘ï¼Œä»¥ç»´æŠ¤ä¸ºä¸»ã€‚ ä»£ç åº“å½“å‰ç‰ˆæœ¬é©¬ä¸Šè¦å‘å¸ƒäº†ï¼Œè¿™æ—¶é‡æž„æ— ç–‘æ˜¯ç»™è‡ªå·±æ‰¾éº»çƒ¦ã€‚ é‡æž„ä»£ä»·è¿‡äºŽæ²‰é‡ï¼šé‡æž„åŽåŠŸèƒ½çš„æ­£ç¡®æ€§ã€ç¨³å®šæ€§éš¾ä»¥ä¿éšœï¼›æŠ€æœ¯è¿‡äºŽè¶…å‰ï¼Œå›¢é˜Ÿæˆå‘˜æŠ€æœ¯è¿ç§»éš¾åº¦å¤ªå¤§ã€‚ å¦‚ä½•é‡æž„(How) é‡æž„è¡Œä¸ºåœ¨æˆ‘çœ‹æ¥ï¼Œä¹Ÿæ˜¯å¯ä»¥åˆ†å±‚çº§çš„ã€‚ç”±é«˜åˆ°ä½Žï¼Œè¶Šé«˜å±‚çº§éš¾åº¦è¶Šå¤§ï¼š æœåŠ¡ã€æ•°æ®åº“ çŽ°ä»£è½¯ä»¶å¾€å¾€ä¸šåŠ¡å¤æ‚ã€åºžå¤§ã€‚ä½¿ç”¨å¾®æœåŠ¡ã€æ•°æ®è¿ç§»æ¥æ‹†åˆ†ä¸šåŠ¡ï¼Œé™ä½Žä¸šåŠ¡å¤æ‚åº¦æˆä¸ºäº†ä¸»æµã€‚ä½†æ˜¯ï¼Œè¿™äº›æŠ€æœ¯çš„æµ‹è¯•ã€éƒ¨ç½²å¤æ‚ï¼ŒæŠ€æœ¯éš¾åº¦å¾ˆé«˜ã€‚ ç»„ä»¶ã€æ¨¡å—ã€æ¡†æž¶ ç»„ä»¶ã€æ¨¡å—ã€æ¡†æž¶çš„é‡æž„ï¼Œä¸»è¦æ˜¯é’ˆå¯¹ä»£ç çš„è®¾è®¡é—®é¢˜ã€‚è§£å†³çš„æ˜¯ä»£ç çš„æ•´ä½“ç»“æž„é—®é¢˜ã€‚éœ€è¦å¯¹æ¡†æž¶ã€è®¾è®¡æ¨¡å¼ã€åˆ†å¸ƒå¼ã€å¹¶å‘ç­‰ç­‰æœ‰è¶³å¤Ÿçš„äº†è§£ã€‚ ç±»ã€æŽ¥å£ã€å‡½æ•°ã€å­—æ®µ ã€Šé‡æž„ã€‹ä¸€ä¹¦æåˆ°äº†**â€œä»£ç çš„åå‘³é“â€**ä»¥åŠç›¸å…³çš„é‡æž„æ–¹æ³•ã€‚è¿™äº›éƒ½æ˜¯å¯¹ç±»ã€æŽ¥å£ã€å‡½æ•°ã€å­—æ®µçº§åˆ«ä»£ç çš„é‡æž„æ‰‹æ®µã€‚ç”±äºŽè¿™ä¸€çº§åˆ«çš„é‡æž„æ–¹æ³•è¾ƒä¸ºç®€å•ï¼Œæ‰€ä»¥å¯æ“ä½œæ€§è¾ƒå¼ºã€‚å…·ä½“ç»†èŠ‚å¯ä»¥é˜…è¯»ã€Šä»£ç çš„åå‘³é“ã€‹ç¯‡ç« ã€‚ å‰ä¸¤ç§å±‚çº§çš„é‡æž„å·²ç»æ¶‰åŠåˆ°æž¶æž„å±‚é¢ï¼Œå½±å“è¾ƒå¤§ï¼Œéš¾åº¦è¾ƒé«˜ï¼Œå¦‚æžœåŠŸåŠ›ä¸å¤Ÿä¸è¦è½»æ˜“å˜åŠ¨ã€‚ç”±äºŽè¿™ä¸¤ä¸ªå±‚çº§æ¶‰åŠé¢†åŸŸè¾ƒå¹¿ï¼Œè¿™é‡Œä¸åšè®ºè¿°ã€‚ æ­¤å¤„ä¸ºåˆ†å‰²çº¿ã€‚ä¸‹é¢æ˜¯ä»£ç çš„åå‘³é“ç³»åˆ—ã€‚ã€‚ã€‚ ä»£ç çš„åå‘³é“ ã€Šé‡æž„:æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹ä¸­ä»‹ç»äº† 22 ç§ä»£ç çš„åå‘³é“ä»¥åŠé‡æž„æ‰‹æ³•ã€‚è¿™äº›åå‘³é“å¯ä»¥è¿›ä¸€æ­¥å½’ç±»ã€‚æˆ‘æ€»è§‰å¾—å°†äº‹ç‰©åˆ†ç±»æœ‰åŠ©äºŽç†è§£å’Œè®°å¿†ã€‚æ‰€ä»¥æœ¬ç³»åˆ—å°†åå‘³é“æŒ‰ç…§ç‰¹æ€§åˆ†ç±»ï¼Œç„¶åŽé€ä¸€è®²è§£ã€‚ ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿ ä»£ç è‡ƒè‚¿(Bloated)è¿™ç»„åå‘³é“æ„å‘³ç€ï¼šä»£ç ä¸­çš„ç±»ã€å‡½æ•°ã€å­—æ®µæ²¡æœ‰ç»è¿‡åˆç†çš„ç»„ç»‡ï¼Œåªæ˜¯ç®€å•çš„å †ç Œèµ·æ¥ã€‚è¿™ä¸€ç±»åž‹çš„é—®é¢˜é€šå¸¸åœ¨ä»£ç çš„åˆæœŸå¹¶ä¸æ˜Žæ˜¾ï¼Œä½†æ˜¯éšç€ä»£ç è§„æ¨¡çš„å¢žé•¿è€Œé€æ¸ç§¯ç´¯ï¼ˆç‰¹åˆ«æ˜¯å½“æ²¡æœ‰äººåŠªåŠ›åŽ»æ ¹é™¤å®ƒä»¬æ—¶ï¼‰ã€‚ è¿‡é•¿å‡½æ•° è¿‡å¤§çš„ç±» åŸºæœ¬ç±»åž‹åæ‰§ è¿‡é•¿å‚æ•°åˆ— æ•°æ®æ³¥å›¢ ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡ æ»¥ç”¨é¢å‘å¯¹è±¡(Object-Orientation Abusers)è¿™ç»„åå‘³é“æ„å‘³ç€ï¼šä»£ç éƒ¨åˆ†æˆ–å®Œå…¨åœ°è¿èƒŒäº†é¢å‘å¯¹è±¡ç¼–ç¨‹åŽŸåˆ™ã€‚ switch å£°æ˜Ž ä¸´æ—¶å­—æ®µ è¢«æ‹’ç»çš„é¦ˆèµ  å¼‚æ›²åŒå·¥çš„ç±» ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢ å˜é©çš„éšœç¢(Change Preventers)è¿™ç»„åå‘³é“æ„å‘³ç€ï¼šå½“ä½ éœ€è¦æ”¹å˜ä¸€å¤„ä»£ç æ—¶ï¼Œå´å‘çŽ°ä¸å¾—ä¸æ”¹å˜å…¶ä»–çš„åœ°æ–¹ã€‚è¿™ä½¿å¾—ç¨‹åºå¼€å‘å˜å¾—å¤æ‚ã€ä»£ä»·é«˜æ˜‚ã€‚ å‘æ•£å¼å˜åŒ– éœ°å¼¹å¼ä¿®æ”¹ å¹³è¡Œç»§æ‰¿ä½“ç³» ä»£ç åå‘³é“ä¹‹éžå¿…è¦çš„ éžå¿…è¦çš„(Dispensables)è¿™ç»„åå‘³é“æ„å‘³ç€ï¼šè¿™æ ·çš„ä»£ç å¯æœ‰å¯æ— ï¼Œå®ƒçš„å­˜åœ¨åè€Œå½±å“æ•´ä½“ä»£ç çš„æ•´æ´å’Œå¯è¯»æ€§ã€‚ è¿‡å¤šçš„æ³¨é‡Š é‡å¤ä»£ç  å†—ä½™ç±» çº¯ç¨šçš„æ•°æ®ç±» å¤¸å¤¸å…¶è°ˆæœªæ¥æ€§ ä»£ç åå‘³é“ä¹‹è€¦åˆ è€¦åˆ(Couplers)è¿™ç»„åå‘³é“æ„å‘³ç€ï¼šä¸åŒç±»ä¹‹é—´è¿‡åº¦è€¦åˆã€‚ ä¾æ‹æƒ…ç»“ ç‹Žæ˜µå…³ç³» è¿‡åº¦è€¦åˆçš„æ¶ˆæ¯é“¾ ä¸­é—´äºº ä¸å®Œç¾Žçš„åº“ç±» æ‰©å±•é˜…è¯» ä»£ç çš„åå‘³é“å’Œé‡æž„ ä»£ç åå‘³é“ä¹‹ä»£ç è‡ƒè‚¿ ä»£ç åå‘³é“ä¹‹æ»¥ç”¨é¢å‘å¯¹è±¡ ä»£ç åå‘³é“ä¹‹å˜é©çš„éšœç¢ ä»£ç åå‘³é“ä¹‹éžå¿…è¦çš„ ä»£ç åå‘³é“ä¹‹è€¦åˆ å‚è€ƒèµ„æ–™ é‡æž„â€”â€”æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ - by Martin Fowler https://sourcemaking.com/refactoring]]></content>
      <categories>
        <category>design</category>
        <category>refactor</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>refactor</tag>
        <tag>code-smell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Sqoop]]></title>
    <url>%2Fblog%2F2018%2F09%2F04%2Fbigdata%2FSqoop%2F</url>
    <content type="text"><![CDATA[Sqoop Sqoop æ˜¯ä¸€ä¸ªä¸»è¦åœ¨ Hadoop å’Œå…³ç³»æ•°æ®åº“ä¹‹é—´è¿›è¡Œæ‰¹é‡æ•°æ®è¿ç§»çš„å·¥å…·ã€‚ Sqoop ç®€ä»‹ æä¾›å¤šç§ Sqoop è¿žæŽ¥å™¨ Sqoop ç‰ˆæœ¬ Sqoop åŽŸç† å¯¼å…¥ å¯¼å‡º Sqoop ç®€ä»‹ Sqoop æ˜¯ä¸€ä¸ªä¸»è¦åœ¨ Hadoop å’Œå…³ç³»æ•°æ®åº“ä¹‹é—´è¿›è¡Œæ‰¹é‡æ•°æ®è¿ç§»çš„å·¥å…·ã€‚ Hadoopï¼šHDFSã€Hiveã€HBaseã€Inceptorã€Hyperbase é¢å‘å¤§æ•°æ®é›†çš„æ‰¹é‡å¯¼å…¥å¯¼å‡º å°†è¾“å…¥æ•°æ®é›†åˆ†ä¸º N ä¸ªåˆ‡ç‰‡ï¼Œç„¶åŽå¯åŠ¨ N ä¸ª Map ä»»åŠ¡å¹¶è¡Œä¼ è¾“ æ”¯æŒå…¨é‡ã€å¢žé‡ä¸¤ç§ä¼ è¾“æ–¹å¼ æä¾›å¤šç§ Sqoop è¿žæŽ¥å™¨ å†…ç½®è¿žæŽ¥å™¨ ç»è¿‡ä¼˜åŒ–çš„ä¸“ç”¨ RDBMS è¿žæŽ¥å™¨ï¼šMySQLã€PostgreSQLã€Oracleã€DB2ã€SQL Serverã€Netzza ç­‰ é€šç”¨çš„ JDBC è¿žæŽ¥å™¨ï¼šæ”¯æŒ JDBC åè®®çš„æ•°æ®åº“ ç¬¬ä¸‰æ–¹è¿žæŽ¥å™¨ æ•°æ®ä»“åº“ï¼šTeradata NoSQL æ•°æ®åº“ï¼šCouchbase Sqoop ç‰ˆæœ¬ Sqoop 1 ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ æž¶æž„ç®€å• éƒ¨ç½²ç®€å• åŠŸèƒ½å…¨é¢ ç¨³å®šæ€§è¾ƒé«˜ é€Ÿåº¦è¾ƒå¿« ç¼ºç‚¹ è®¿é—®æ–¹å¼å•ä¸€ å‘½ä»¤è¡Œæ–¹å¼å®¹æ˜“å‡ºé”™ï¼Œæ ¼å¼ç´§è€¦åˆ å®‰å…¨æœºåˆ¶ä¸å¤Ÿå®Œå–„ï¼Œå­˜åœ¨å¯†ç æ³„éœ²é£Žé™© Sqoop 2 ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ è®¿é—®æ–¹å¼å¤šæ · é›†ä¸­ç®¡ç†è¿žæŽ¥å™¨ å®‰å…¨æœºåˆ¶è¾ƒå®Œå–„ æ”¯æŒå¤šç”¨æˆ· ç¼ºç‚¹ æž¶æž„è¾ƒå¤æ‚ éƒ¨ç½²è¾ƒç¹ç ç¨³å®šæ€§ä¸€èˆ¬ é€Ÿåº¦ä¸€èˆ¬ Sqoop åŽŸç† å¯¼å…¥ å¯¼å‡º]]></content>
      <categories>
        <category>bigdata</category>
      </categories>
      <tags>
        <tag>bigdata</tag>
        <tag>hadoop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flume]]></title>
    <url>%2Fblog%2F2018%2F09%2F04%2Fbigdata%2FFlume%2F</url>
    <content type="text"><![CDATA[Flume Sqoop æ˜¯ä¸€ä¸ªä¸»è¦åœ¨ Hadoop å’Œå…³ç³»æ•°æ®åº“ä¹‹é—´è¿›è¡Œæ‰¹é‡æ•°æ®è¿ç§»çš„å·¥å…·ã€‚ Flume ç®€ä»‹ ä»€ä¹ˆæ˜¯ Flume ï¼Ÿ åº”ç”¨åœºæ™¯ Flume åŽŸç† Flume åŸºæœ¬æ¦‚å¿µ Flume åŸºæœ¬ç»„ä»¶ Flume æ•°æ®æµ èµ„æº Flume ç®€ä»‹ ä»€ä¹ˆæ˜¯ Flume ï¼Ÿ Flume æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµ·é‡æ•°æ®é‡‡é›†ã€èšåˆå’Œä¼ è¾“ç³»ç»Ÿã€‚ ç‰¹ç‚¹ åŸºäºŽäº‹ä»¶çš„æµ·é‡æ•°æ®é‡‡é›† æ•°æ®æµæ¨¡åž‹ï¼šSource -&gt; Channel -&gt; Sink äº‹åŠ¡æœºåˆ¶ï¼šæ”¯æŒé‡è¯»é‡å†™ï¼Œä¿è¯æ¶ˆæ¯ä¼ é€’çš„å¯é æ€§ å†…ç½®ä¸°å¯Œæ’ä»¶ï¼šè½»æ¾ä¸Žå„ç§å¤–éƒ¨ç³»ç»Ÿé›†æˆ é«˜å¯ç”¨ï¼šAgent ä¸»å¤‡åˆ‡æ¢ Java å®žçŽ°ï¼šå¼€æºï¼Œä¼˜ç§€çš„ç³»ç»Ÿè®¾è®¡ åº”ç”¨åœºæ™¯ Flume åŽŸç† Flume åŸºæœ¬æ¦‚å¿µ Eventï¼šäº‹ä»¶ï¼Œæœ€å°æ•°æ®ä¼ è¾“å•å…ƒï¼Œç”± Header å’Œ Body ç»„æˆã€‚ Agentï¼šä»£ç†ï¼ŒJVM è¿›ç¨‹ï¼Œæœ€å°è¿è¡Œå•å…ƒï¼Œç”± Sourceã€Channelã€Sink ä¸‰ä¸ªåŸºæœ¬ç»„ä»¶æž„æˆï¼Œè´Ÿè´£å°†å¤–éƒ¨æ•°æ®æºäº§ç”Ÿçš„æ•°æ®ä»¥ Event çš„å½¢å¼ä¼ è¾“åˆ°ç›®çš„åœ° Sourceï¼šè´Ÿè´£å¯¹æŽ¥å„ç§å¤–éƒ¨æ•°æ®æºï¼Œå°†é‡‡é›†åˆ°çš„æ•°æ®å°è£…æˆ Eventï¼Œç„¶åŽå†™å…¥ Channel Channelï¼šEvent æš‚å­˜å®¹å™¨ï¼Œè´Ÿè´£ä¿å­˜ Source å‘é€çš„ Eventï¼Œç›´è‡³è¢« Sink æˆåŠŸè¯»å– Sinkï¼šè´Ÿè´£ä»Ž Channel è¯»å– Eventï¼Œç„¶åŽå°†å…¶å†™å…¥å¤–éƒ¨å­˜å‚¨ï¼Œæˆ–ä¼ è¾“ç»™ä¸‹ä¸€é˜¶æ®µçš„ Agent æ˜ å°„å…³ç³»ï¼š1 ä¸ª Source -&gt; å¤šä¸ª Channelï¼Œ1 ä¸ª Channel -&gt; å¤šä¸ª Sinkï¼Œ1 ä¸ª Sink -&gt; 1 ä¸ª Channel Flume åŸºæœ¬ç»„ä»¶ Source ç»„ä»¶ å¯¹æŽ¥å„ç§å¤–éƒ¨æ•°æ®æºï¼Œå°†é‡‡é›†åˆ°çš„æ•°æ®å°è£…æˆ Eventï¼Œç„¶åŽå†™å…¥ Channel ä¸€ä¸ª Source å¯å‘å¤šä¸ª Channel å‘é€ Event Flume å†…ç½®ç±»åž‹ä¸°å¯Œçš„ Sourceï¼ŒåŒæ—¶ç”¨æˆ·å¯è‡ªå®šä¹‰ Source Channel ç»„ä»¶ Event ä¸­è½¬æš‚å­˜åŒºï¼Œå­˜å‚¨ Source é‡‡é›†ä½†æœªè¢« Sink è¯»å–çš„ Event ä¸ºäº†å¹³è¡¡ Source é‡‡é›†ã€Sink è¯»å–çš„é€Ÿåº¦ï¼Œå¯è§†ä¸º Flume å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ— çº¿ç¨‹å®‰å…¨å¹¶å…·æœ‰äº‹åŠ¡æ€§ï¼Œæ”¯æŒ Source å†™å¤±è´¥é‡å†™å’Œ Sink è¯»å¤±è´¥é‡è¯» Sink ç»„ä»¶ ä»Ž Channel è¯»å– Eventï¼Œå°†å…¶å†™å…¥å¤–éƒ¨å­˜å‚¨ï¼Œæˆ–ä¼ è¾“åˆ°ä¸‹ä¸€é˜¶æ®µçš„ Agent ä¸€ä¸ª Sink åªèƒ½ä»Žä¸€ä¸ª Channel ä¸­è¯»å– Event Sink æˆåŠŸè¯»å– Event åŽï¼Œå‘ Channel æäº¤äº‹åŠ¡ï¼ŒEvent è¢«åˆ é™¤ï¼Œå¦åˆ™ Channel ä¼šç­‰å¾… Sink é‡æ–°è¯»å– Flume æ•°æ®æµ å•å±‚æž¶æž„ ä¼˜ç‚¹ï¼šæž¶æž„ç®€å•ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œå ç”¨èµ„æºè¾ƒå°‘ ç¼ºç‚¹ å¦‚æžœé‡‡é›†çš„æ•°æ®æºæˆ–Agentè¾ƒå¤šï¼Œå°†Eventå†™å…¥åˆ°HDFSä¼šäº§ç”Ÿå¾ˆå¤šå°æ–‡ä»¶ å¤–éƒ¨å­˜å‚¨å‡çº§ç»´æŠ¤æˆ–å‘ç”Ÿæ•…éšœï¼Œéœ€å¯¹é‡‡é›†å±‚çš„æ‰€æœ‰Agentåšå¤„ç†ï¼ŒäººåŠ›æˆæœ¬è¾ƒé«˜ï¼Œç³»ç»Ÿç¨³å®šæ€§è¾ƒå·® ç³»ç»Ÿå®‰å…¨æ€§è¾ƒå·® æ•°æ®æºç®¡ç†è¾ƒæ··ä¹± èµ„æº]]></content>
      <categories>
        <category>bigdata</category>
      </categories>
      <tags>
        <tag>bigdata</tag>
        <tag>hadoop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HDFS]]></title>
    <url>%2Fblog%2F2018%2F09%2F03%2Fbigdata%2FHDFS%2F</url>
    <content type="text"><![CDATA[HDFS HDFS æ˜¯ Hadoop åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚ å…³é”®è¯ï¼šåˆ†å¸ƒå¼ã€æ–‡ä»¶ç³»ç»Ÿ æ¦‚è¿° HDFS çš„ç‰¹ç‚¹ HDFS çš„æ¦‚å¿µ NameNode DataNode Block æ•°æ®å— Client Block å‰¯æœ¬ç­–ç•¥ æ•°æ®æµ HDFS è¯»æ–‡ä»¶ HDFS å†™æ–‡ä»¶ HDFS å®‰å…¨æ¨¡å¼ ä»€ä¹ˆæ˜¯å®‰å…¨æ¨¡å¼ï¼Ÿ ä½•æ—¶æ­£å¸¸ç¦»å¼€å®‰å…¨æ¨¡å¼ è§¦å‘å®‰å…¨æ¨¡å¼çš„åŽŸå›  æ•…éšœæŽ’æŸ¥ HDFS é«˜å¯ç”¨ NameNode çš„ HA æœºåˆ¶ åˆ©ç”¨ QJM å®žçŽ°å…ƒæ•°æ®é«˜å¯ç”¨ èµ„æº æ¦‚è¿° HDFS æ˜¯ Hadoop çš„æ ¸å¿ƒå­é¡¹ç›®ã€‚ HDFS æ˜¯ Hadoop Distributed File System çš„ç¼©å†™ï¼Œå³ Hadoop åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚ HDFS æ˜¯ä¸€ç§ç”¨äºŽå­˜å‚¨å…·æœ‰æµæ•°æ®è®¿é—®æ¨¡å¼çš„è¶…å¤§æ–‡ä»¶çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒè¿è¡Œåœ¨å»‰ä»·çš„æœºå™¨é›†ç¾¤ä¸Šã€‚ HDFS çš„ç‰¹ç‚¹ ä¼˜ç‚¹ é«˜å®¹é”™ - æ•°æ®å†—ä½™å¤šå‰¯æœ¬ï¼Œå‰¯æœ¬ä¸¢å¤±åŽè‡ªåŠ¨æ¢å¤ é«˜å¯ç”¨ - NameNode HAã€å®‰å…¨æ¨¡å¼ é«˜æ‰©å±• - èƒ½å¤Ÿå¤„ç† 10K èŠ‚ç‚¹çš„è§„æ¨¡ï¼›å¤„ç†æ•°æ®è¾¾åˆ° GBã€TBã€ç”šè‡³ PB çº§åˆ«çš„æ•°æ®ï¼›èƒ½å¤Ÿå¤„ç†ç™¾ä¸‡è§„æ¨¡ä»¥ä¸Šçš„æ–‡ä»¶æ•°é‡ï¼Œæ•°é‡ç›¸å½“ä¹‹å¤§ã€‚ æ‰¹å¤„ç† - æµå¼æ•°æ®è®¿é—®ï¼›æ•°æ®ä½ç½®æš´éœ²ç»™è®¡ç®—æ¡†æž¶ æž„å»ºåœ¨å»‰ä»·å•†ç”¨æœºå™¨ä¸Š - æä¾›äº†å®¹é”™å’Œæ¢å¤æœºåˆ¶ ç¼ºç‚¹ ä¸é€‚åˆä½Žå»¶è¿Ÿæ•°æ®è®¿é—® - é€‚åˆé«˜åžåçŽ‡çš„åœºæ™¯ï¼Œå°±æ˜¯åœ¨æŸä¸€æ—¶é—´å†…å†™å…¥å¤§é‡çš„æ•°æ®ã€‚ä½†æ˜¯å®ƒåœ¨ä½Žå»¶æ—¶çš„æƒ…å†µä¸‹æ˜¯ä¸è¡Œçš„ï¼Œæ¯”å¦‚æ¯«ç§’çº§ä»¥å†…è¯»å–æ•°æ®ï¼Œå®ƒæ˜¯å¾ˆéš¾åšåˆ°çš„ã€‚ ä¸é€‚åˆå¤§é‡å°æ–‡ä»¶å­˜å‚¨ å­˜å‚¨å¤§é‡å°æ–‡ä»¶(è¿™é‡Œçš„å°æ–‡ä»¶æ˜¯æŒ‡å°äºŽ HDFS ç³»ç»Ÿçš„ Block å¤§å°çš„æ–‡ä»¶ï¼ˆé»˜è®¤ 64Mï¼‰)çš„è¯ï¼Œå®ƒä¼šå ç”¨ NameNode å¤§é‡çš„å†…å­˜æ¥å­˜å‚¨æ–‡ä»¶ã€ç›®å½•å’Œå—ä¿¡æ¯ã€‚è¿™æ ·æ˜¯ä¸å¯å–çš„ï¼Œå› ä¸º NameNode çš„å†…å­˜æ€»æ˜¯æœ‰é™çš„ã€‚ ç£ç›˜å¯»é“æ—¶é—´è¶…è¿‡è¯»å–æ—¶é—´ ä¸æ”¯æŒå¹¶å‘å†™å…¥ - ä¸€ä¸ªæ–‡ä»¶åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªå†™å…¥è€… ä¸æ”¯æŒæ–‡ä»¶éšæœºä¿®æ”¹ - ä»…æ”¯æŒè¿½åŠ å†™å…¥ HDFS çš„æ¦‚å¿µ HDFS é‡‡ç”¨ Master/Slave æž¶æž„ã€‚ ä¸€ä¸ª HDFS é›†ç¾¤æ˜¯ç”±ä¸€ä¸ª Namenode å’Œä¸€å®šæ•°ç›®çš„ Datanodes ç»„æˆã€‚Namenode æ˜¯ä¸€ä¸ªä¸­å¿ƒæœåŠ¡å™¨ï¼Œè´Ÿè´£ç®¡ç†æ–‡ä»¶ç³»ç»Ÿçš„åå­—ç©ºé—´(namespace)ä»¥åŠå®¢æˆ·ç«¯å¯¹æ–‡ä»¶çš„è®¿é—®ã€‚é›†ç¾¤ä¸­çš„ Datanode ä¸€èˆ¬æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ä¸€ä¸ªï¼Œè´Ÿè´£ç®¡ç†å®ƒæ‰€åœ¨èŠ‚ç‚¹ä¸Šçš„å­˜å‚¨ã€‚HDFS æš´éœ²äº†æ–‡ä»¶ç³»ç»Ÿçš„åå­—ç©ºé—´ï¼Œç”¨æˆ·èƒ½å¤Ÿä»¥æ–‡ä»¶çš„å½¢å¼åœ¨ä¸Šé¢å­˜å‚¨æ•°æ®ã€‚ä»Žå†…éƒ¨çœ‹ï¼Œä¸€ä¸ªæ–‡ä»¶å…¶å®žè¢«åˆ†æˆä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å—ï¼Œè¿™äº›å—å­˜å‚¨åœ¨ä¸€ç»„ Datanode ä¸Šã€‚Namenode æ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿçš„åå­—ç©ºé—´æ“ä½œï¼Œæ¯”å¦‚æ‰“å¼€ã€å…³é—­ã€é‡å‘½åæ–‡ä»¶æˆ–ç›®å½•ã€‚å®ƒä¹Ÿè´Ÿè´£ç¡®å®šæ•°æ®å—åˆ°å…·ä½“ Datanode èŠ‚ç‚¹çš„æ˜ å°„ã€‚Datanode è´Ÿè´£å¤„ç†æ–‡ä»¶ç³»ç»Ÿå®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€‚åœ¨ Namenode çš„ç»Ÿä¸€è°ƒåº¦ä¸‹è¿›è¡Œæ•°æ®å—çš„åˆ›å»ºã€åˆ é™¤å’Œå¤åˆ¶ã€‚ NameNode NameNode å°±æ˜¯ master å·¥ä½œèŠ‚ç‚¹ã€‚ ç®¡ç†å‘½åç©ºé—´ ç®¡ç†å…ƒæ•°æ®ï¼šæ–‡ä»¶çš„ä½ç½®ã€æ‰€æœ‰è€…ã€æƒé™ã€æ•°æ®å—ç­‰ ç®¡ç† Block å‰¯æœ¬ç­–ç•¥ï¼šé»˜è®¤ 3 ä¸ªå‰¯æœ¬ å¤„ç†å®¢æˆ·ç«¯è¯»å†™è¯·æ±‚ï¼Œä¸º DataNode åˆ†é…ä»»åŠ¡ Active NameNode å’Œ Standby NameNode NameNode é€šè¿‡ HA æœºåˆ¶æ¥å®¹é”™ã€‚ Active NameNode - æ˜¯æ­£åœ¨å·¥ä½œçš„ NameNodeï¼› Standby NameNode - æ˜¯å¤‡ä»½çš„ NameNodeã€‚ Active NameNode å®•æœºåŽï¼ŒStandby NameNode å¿«é€Ÿå‡çº§ä¸ºæ–°çš„ Active NameNodeã€‚ Standby NameNode å‘¨æœŸæ€§åŒæ­¥ edits ç¼–è¾‘æ—¥å¿—ï¼Œå®šæœŸåˆå¹¶ fsimage ä¸Ž edits åˆ°æœ¬åœ°ç£ç›˜ã€‚ Hadoop 3.0 å…è®¸é…ç½®å¤šä¸ª Standby NameNodeã€‚ å…ƒæ•°æ®æ–‡ä»¶ editsï¼ˆç¼–è¾‘æ—¥å¿—æ–‡ä»¶ï¼‰ - ä¿å­˜äº†è‡ªæœ€æ–°æ£€æŸ¥ç‚¹ï¼ˆCheckpointï¼‰ä¹‹åŽçš„æ‰€æœ‰æ–‡ä»¶æ›´æ–°æ“ä½œã€‚ fsimageï¼ˆå…ƒæ•°æ®æ£€æŸ¥ç‚¹é•œåƒæ–‡ä»¶ï¼‰ - ä¿å­˜äº†æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰çš„ç›®å½•å’Œæ–‡ä»¶ä¿¡æ¯ï¼Œå¦‚ï¼šæŸä¸ªç›®å½•ä¸‹æœ‰å“ªäº›å­ç›®å½•å’Œæ–‡ä»¶ï¼Œä»¥åŠæ–‡ä»¶åã€æ–‡ä»¶å‰¯æœ¬æ•°ã€æ–‡ä»¶ç”±å“ªäº› Block ç»„æˆç­‰ã€‚ Active NameNode å†…å­˜ä¸­æœ‰ä¸€ä»½æœ€æ–°çš„å…ƒæ•°æ®ï¼ˆ= fsimage + editsï¼‰ã€‚ Standby NameNode åœ¨æ£€æŸ¥ç‚¹å®šæœŸå°†å†…å­˜ä¸­çš„å…ƒæ•°æ®ä¿å­˜åˆ° fsimage æ–‡ä»¶ä¸­ã€‚ DataNode **DataNode å°±æ˜¯ slave å·¥ä½œèŠ‚ç‚¹ã€‚**NameNode ä¸‹è¾¾å‘½ä»¤ï¼ŒDataNode æ‰§è¡Œå®žé™…çš„æ“ä½œã€‚ å­˜å‚¨ Block å’Œæ•°æ®æ ¡éªŒå’Œ æ‰§è¡Œå®¢æˆ·ç«¯å‘é€çš„è¯»å†™æ“ä½œ é€šè¿‡å¿ƒè·³æœºåˆ¶å®šæœŸï¼ˆé»˜è®¤ 3 ç§’ï¼‰å‘ NameNode æ±‡æŠ¥è¿è¡ŒçŠ¶æ€å’Œ Block åˆ—è¡¨ä¿¡æ¯ é›†ç¾¤å¯åŠ¨æ—¶ï¼ŒDataNode å‘ NameNode æä¾› Block åˆ—è¡¨ä¿¡æ¯ Block æ•°æ®å— HDFS æœ€å°å­˜å‚¨å•å…ƒ æ–‡ä»¶å†™å…¥ HDFS ä¼šè¢«åˆ‡åˆ†æˆè‹¥å¹²ä¸ª Block Block å¤§å°å›ºå®šï¼Œé»˜è®¤ä¸º 128MBï¼Œå¯è‡ªå®šä¹‰ è‹¥ä¸€ä¸ª Block çš„å¤§å°å°äºŽè®¾å®šå€¼ï¼Œä¸ä¼šå ç”¨æ•´ä¸ªå—ç©ºé—´ é»˜è®¤æƒ…å†µä¸‹æ¯ä¸ª Block æœ‰ 3 ä¸ªå‰¯æœ¬ Client å°†æ–‡ä»¶åˆ‡åˆ†ä¸º Block æ•°æ®å— ä¸Ž NameNode äº¤äº’ï¼ŒèŽ·å–æ–‡ä»¶å…ƒæ•°æ® ä¸Ž DataNode äº¤äº’ï¼Œè¯»å–æˆ–å†™å…¥æ•°æ® ç®¡ç† HDFS Block å‰¯æœ¬ç­–ç•¥ HDFS è¢«è®¾è®¡æˆèƒ½å¤Ÿåœ¨ä¸€ä¸ªå¤§é›†ç¾¤ä¸­è·¨æœºå™¨å¯é åœ°å­˜å‚¨è¶…å¤§æ–‡ä»¶ã€‚å®ƒå°†æ¯ä¸ªæ–‡ä»¶å­˜å‚¨æˆä¸€ç³»åˆ—çš„æ•°æ®å—ï¼Œé™¤äº†æœ€åŽä¸€ä¸ªï¼Œæ‰€æœ‰çš„æ•°æ®å—éƒ½æ˜¯åŒæ ·å¤§å°çš„ã€‚ä¸ºäº†å®¹é”™ï¼Œæ–‡ä»¶çš„æ‰€æœ‰æ•°æ®å—éƒ½ä¼šæœ‰å‰¯æœ¬ã€‚æ¯ä¸ªæ–‡ä»¶çš„æ•°æ®å—å¤§å°å’Œå‰¯æœ¬ç³»æ•°éƒ½æ˜¯å¯é…ç½®çš„ã€‚åº”ç”¨ç¨‹åºå¯ä»¥æŒ‡å®šæŸä¸ªæ–‡ä»¶çš„å‰¯æœ¬æ•°ç›®ã€‚å‰¯æœ¬ç³»æ•°å¯ä»¥åœ¨æ–‡ä»¶åˆ›å»ºçš„æ—¶å€™æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨ä¹‹åŽæ”¹å˜ã€‚HDFS ä¸­çš„æ–‡ä»¶éƒ½æ˜¯ä¸€æ¬¡æ€§å†™å…¥çš„ï¼Œå¹¶ä¸”ä¸¥æ ¼è¦æ±‚åœ¨ä»»ä½•æ—¶å€™åªèƒ½æœ‰ä¸€ä¸ªå†™å…¥è€…ã€‚ Namenode å…¨æƒç®¡ç†æ•°æ®å—çš„å¤åˆ¶ï¼Œå®ƒå‘¨æœŸæ€§åœ°ä»Žé›†ç¾¤ä¸­çš„æ¯ä¸ª Datanode æŽ¥æ”¶å¿ƒè·³ä¿¡å·å’Œå—çŠ¶æ€æŠ¥å‘Š(Blockreport)ã€‚æŽ¥æ”¶åˆ°å¿ƒè·³ä¿¡å·æ„å‘³ç€è¯¥ Datanode èŠ‚ç‚¹å·¥ä½œæ­£å¸¸ã€‚å—çŠ¶æ€æŠ¥å‘ŠåŒ…å«äº†ä¸€ä¸ªè¯¥ Datanode ä¸Šæ‰€æœ‰æ•°æ®å—çš„åˆ—è¡¨ã€‚ å‰¯æœ¬ 1ï¼šæ”¾åœ¨ Client æ‰€åœ¨èŠ‚ç‚¹ å¯¹äºŽè¿œç¨‹ Clientï¼Œç³»ç»Ÿä¼šéšæœºé€‰æ‹©èŠ‚ç‚¹ å‰¯æœ¬ 2ï¼šæ”¾åœ¨ä¸åŒçš„æœºæž¶èŠ‚ç‚¹ä¸Š å‰¯æœ¬ 3ï¼šæ”¾åœ¨ä¸Žç¬¬äºŒä¸ªå‰¯æœ¬åŒä¸€æœºæž¶çš„ä¸åŒèŠ‚ç‚¹ä¸Š å‰¯æœ¬ Nï¼šéšæœºé€‰æ‹© èŠ‚ç‚¹é€‰æ‹©ï¼šåŒç­‰æ¡ä»¶ä¸‹ä¼˜å…ˆé€‰æ‹©ç©ºé—²èŠ‚ç‚¹ æ•°æ®æµ HDFS è¯»æ–‡ä»¶ å®¢æˆ·ç«¯è°ƒç”¨ FileSyste å¯¹è±¡çš„ open() æ–¹æ³•åœ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸­æ‰“å¼€è¦è¯»å–çš„æ–‡ä»¶ã€‚ åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿé€šè¿‡ä½¿ç”¨ RPCï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰æ¥è°ƒç”¨ namenodeï¼Œç¡®å®šæ–‡ä»¶èµ·å§‹å—çš„ä½ç½®ã€‚ åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„ DistributedFileSystem ç±»è¿”å›žä¸€ä¸ªæ”¯æŒæ–‡ä»¶å®šä½çš„è¾“å…¥æµ FSDataInputStream å¯¹è±¡ï¼ŒFSDataInputStream å¯¹è±¡æŽ¥ç€å°è£… DFSInputStream å¯¹è±¡ï¼ˆå­˜å‚¨ç€æ–‡ä»¶èµ·å§‹å‡ ä¸ªå—çš„ datanode åœ°å€ï¼‰ï¼Œå®¢æˆ·ç«¯å¯¹è¿™ä¸ªè¾“å…¥æµè°ƒç”¨ read()æ–¹æ³•ã€‚ DFSInputStream è¿žæŽ¥è·ç¦»æœ€è¿‘çš„ datanodeï¼Œé€šè¿‡åå¤è°ƒç”¨ read æ–¹æ³•ï¼Œå°†æ•°æ®ä»Ž datanode ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚ åˆ°è¾¾å—çš„æœ«ç«¯æ—¶ï¼ŒDFSInputStream å…³é—­ä¸Žè¯¥ datanode çš„è¿žæŽ¥ï¼Œå¯»æ‰¾ä¸‹ä¸€ä¸ªå—çš„æœ€ä½³ datanodeã€‚ å®¢æˆ·ç«¯å®Œæˆè¯»å–ï¼Œå¯¹ FSDataInputStream è°ƒç”¨ close()æ–¹æ³•å…³é—­è¿žæŽ¥ã€‚ HDFS å†™æ–‡ä»¶ å®¢æˆ·ç«¯é€šè¿‡å¯¹ DistributedFileSystem å¯¹è±¡è°ƒç”¨ create() å‡½æ•°æ¥æ–°å»ºæ–‡ä»¶ã€‚ åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå¯¹ namenod åˆ›å»ºä¸€ä¸ª RPC è°ƒç”¨ï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿçš„å‘½åç©ºé—´ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶ã€‚ Namenode å¯¹æ–°å»ºæ–‡ä»¶è¿›è¡Œæ£€æŸ¥æ— è¯¯åŽï¼Œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿè¿”å›žç»™å®¢æˆ·ç«¯ä¸€ä¸ª FSDataOutputStream å¯¹è±¡ï¼ŒFSDataOutputStream å¯¹è±¡å°è£…ä¸€ä¸ª DFSoutPutstream å¯¹è±¡ï¼Œè´Ÿè´£å¤„ç† namenode å’Œ datanode ä¹‹é—´çš„é€šä¿¡ï¼Œå®¢æˆ·ç«¯å¼€å§‹å†™å…¥æ•°æ®ã€‚ FSDataOutputStream å°†æ•°æ®åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„æ•°æ®åŒ…ï¼Œå†™å…¥å†…éƒ¨é˜Ÿåˆ—â€œæ•°æ®é˜Ÿåˆ—â€ï¼ŒDataStreamer è´Ÿè´£å°†æ•°æ®åŒ…ä¾æ¬¡æµå¼ä¼ è¾“åˆ°ç”±ä¸€ç»„ namenode æž„æˆçš„ç®¡çº¿ä¸­ã€‚ DFSOutputStream ç»´æŠ¤ç€ç¡®è®¤é˜Ÿåˆ—æ¥ç­‰å¾… datanode æ”¶åˆ°ç¡®è®¤å›žæ‰§ï¼Œæ”¶åˆ°ç®¡é“ä¸­æ‰€æœ‰ datanode ç¡®è®¤åŽï¼Œæ•°æ®åŒ…ä»Žç¡®è®¤é˜Ÿåˆ—åˆ é™¤ã€‚ å®¢æˆ·ç«¯å®Œæˆæ•°æ®çš„å†™å…¥ï¼Œå¯¹æ•°æ®æµè°ƒç”¨ close() æ–¹æ³•ã€‚ namenode ç¡®è®¤å®Œæˆã€‚ HDFS å®‰å…¨æ¨¡å¼ ä»€ä¹ˆæ˜¯å®‰å…¨æ¨¡å¼ï¼Ÿ å®‰å…¨æ¨¡å¼æ˜¯ HDFS çš„ä¸€ç§ç‰¹æ®ŠçŠ¶æ€ï¼Œåœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼ŒHDFS åªæŽ¥æ”¶è¯»æ•°æ®è¯·æ±‚ï¼Œè€Œä¸æŽ¥æ”¶å†™å…¥ã€åˆ é™¤ã€ä¿®æ”¹ç­‰å˜æ›´è¯·æ±‚ã€‚ å®‰å…¨æ¨¡å¼æ˜¯ HDFS ç¡®ä¿ Block æ•°æ®å®‰å…¨çš„ä¸€ç§ä¿æŠ¤æœºåˆ¶ã€‚ Active NameNode å¯åŠ¨æ—¶ï¼ŒHDFS ä¼šè¿›å…¥å®‰å…¨æ¨¡å¼ï¼ŒDataNode ä¸»åŠ¨å‘ NameNode æ±‡æŠ¥å¯ç”¨ Block åˆ—è¡¨ç­‰ä¿¡æ¯ï¼Œåœ¨ç³»ç»Ÿè¾¾åˆ°å®‰å…¨æ ‡å‡†å‰ï¼ŒHDFS ä¸€ç›´å¤„äºŽâ€œåªè¯»â€çŠ¶æ€ã€‚ ä½•æ—¶æ­£å¸¸ç¦»å¼€å®‰å…¨æ¨¡å¼ Block ä¸ŠæŠ¥çŽ‡ï¼šDataNode ä¸ŠæŠ¥çš„å¯ç”¨ Block ä¸ªæ•° / NameNode å…ƒæ•°æ®è®°å½•çš„ Block ä¸ªæ•° å½“ Block ä¸ŠæŠ¥çŽ‡ &gt;= é˜ˆå€¼æ—¶ï¼ŒHDFS æ‰èƒ½ç¦»å¼€å®‰å…¨æ¨¡å¼ï¼Œé»˜è®¤é˜ˆå€¼ä¸º 0.999 ä¸å»ºè®®æ‰‹åŠ¨å¼ºåˆ¶é€€å‡ºå®‰å…¨æ¨¡å¼ è§¦å‘å®‰å…¨æ¨¡å¼çš„åŽŸå›  NameNode é‡å¯ NameNode ç£ç›˜ç©ºé—´ä¸è¶³ Block ä¸ŠæŠ¥çŽ‡ä½ŽäºŽé˜ˆå€¼ DataNode æ— æ³•æ­£å¸¸å¯åŠ¨ æ—¥å¿—ä¸­å‡ºçŽ°ä¸¥é‡å¼‚å¸¸ ç”¨æˆ·æ“ä½œä¸å½“ï¼Œå¦‚ï¼šå¼ºåˆ¶å…³æœºï¼ˆç‰¹åˆ«æ³¨æ„ï¼ï¼‰ æ•…éšœæŽ’æŸ¥ æ‰¾åˆ° DataNode ä¸èƒ½æ­£å¸¸å¯åŠ¨çš„åŽŸå› ï¼Œé‡å¯ DataNode æ¸…ç† NameNode ç£ç›˜ è°¨æ…Žæ“ä½œï¼Œæœ‰é—®é¢˜æ‰¾æ˜ŸçŽ¯ï¼Œä»¥å…ä¸¢å¤±æ•°æ® HDFS é«˜å¯ç”¨ NameNode çš„ HA æœºåˆ¶ Active NameNode å’Œ Standby NameNode å®žçŽ°ä¸»å¤‡ã€‚ åˆ©ç”¨ QJM å®žçŽ°å…ƒæ•°æ®é«˜å¯ç”¨ åŸºäºŽ Paxos ç®—æ³• QJM æœºåˆ¶ï¼ˆQuorum Journal Managerï¼‰ åªè¦ä¿è¯ Quorumï¼ˆæ³•å®šäººæ•°ï¼‰æ•°é‡çš„æ“ä½œæˆåŠŸï¼Œå°±è®¤ä¸ºè¿™æ˜¯ä¸€æ¬¡æœ€ç»ˆæˆåŠŸçš„æ“ä½œ QJM å…±äº«å­˜å‚¨ç³»ç»Ÿ éƒ¨ç½²å¥‡æ•°ï¼ˆ2N+1ï¼‰ä¸ª JournalNode JournalNode è´Ÿè´£å­˜å‚¨ edits ç¼–è¾‘æ—¥å¿— å†™ edits çš„æ—¶å€™ï¼Œåªè¦è¶…è¿‡åŠæ•°ï¼ˆï‚³N+1ï¼‰çš„ JournalNode è¿”å›žæˆåŠŸï¼Œå°±ä»£è¡¨æœ¬æ¬¡å†™å…¥æˆåŠŸ æœ€å¤šå¯å®¹å¿ N ä¸ª JournalNode å®•æœº åˆ©ç”¨ ZooKeeper å®žçŽ° Active èŠ‚ç‚¹é€‰ä¸¾ã€‚ èµ„æº HDFS å®˜æ–¹æ–‡æ¡£ HDFS çŸ¥è¯†ç‚¹æ€»ç»“ ã€ŠHadoop: The Definitive Guide, Fourth Editionã€‹ by Tom White http://hadoop.apache.org/docs/r1.0.4/cn/hdfs_design.html]]></content>
      <categories>
        <category>bigdata</category>
      </categories>
      <tags>
        <tag>bigdata</tag>
        <tag>hadoop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spark]]></title>
    <url>%2Fblog%2F2018%2F09%2F03%2Fbigdata%2FSpark%2F</url>
    <content type="text"><![CDATA[Spark Spark ç®€ä»‹ Spark æ¦‚å¿µ Spark ç‰¹ç‚¹ Spark åŽŸç† ç¼–ç¨‹æ¨¡åž‹ Spark ç®€ä»‹ Spark æ¦‚å¿µ å¤§è§„æ¨¡åˆ†å¸ƒå¼é€šç”¨è®¡ç®—å¼•æ“Ž Spark Coreï¼šæ ¸å¿ƒè®¡ç®—æ¡†æž¶ Spark SQLï¼šç»“æž„åŒ–æ•°æ®æŸ¥è¯¢ Spark Streamingï¼šå®žæ—¶æµå¤„ç† Spark MLibï¼šæœºå™¨å­¦ä¹  Spark GraphXï¼šå›¾è®¡ç®— å…·æœ‰é«˜åžåã€ä½Žå»¶æ—¶ã€é€šç”¨æ˜“æ‰©å±•ã€é«˜å®¹é”™ç­‰ç‰¹ç‚¹ é‡‡ç”¨ Scala è¯­è¨€å¼€å‘ æä¾›å¤šç§è¿è¡Œæ¨¡å¼ Spark ç‰¹ç‚¹ è®¡ç®—é«˜æ•ˆ åˆ©ç”¨å†…å­˜è®¡ç®—ã€Cache ç¼“å­˜æœºåˆ¶ï¼Œæ”¯æŒè¿­ä»£è®¡ç®—å’Œæ•°æ®å…±äº«ï¼Œå‡å°‘æ•°æ®è¯»å–çš„ IO å¼€é”€ åˆ©ç”¨ DAG å¼•æ“Žï¼Œå‡å°‘ä¸­é—´è®¡ç®—ç»“æžœå†™å…¥ HDFS çš„å¼€é”€ åˆ©ç”¨å¤šçº¿ç¨‹æ± æ¨¡åž‹ï¼Œå‡å°‘ä»»åŠ¡å¯åŠ¨å¼€é”€ï¼Œé¿å… Shuffle ä¸­ä¸å¿…è¦çš„æŽ’åºå’Œç£ç›˜ IO æ“ä½œ é€šç”¨æ˜“ç”¨ é€‚ç”¨äºŽæ‰¹å¤„ç†ã€æµå¤„ç†ã€äº¤äº’å¼è®¡ç®—ã€æœºå™¨å­¦ä¹ ç®—æ³•ç­‰åœºæ™¯ æä¾›äº†ä¸°å¯Œçš„å¼€å‘ APIï¼Œæ”¯æŒ Scalaã€Javaã€Pythonã€R ç­‰ è¿è¡Œæ¨¡å¼å¤šæ · Local æ¨¡å¼ Standalone æ¨¡å¼ YARN/Mesos æ¨¡å¼ è®¡ç®—é«˜æ•ˆ åˆ©ç”¨å†…å­˜è®¡ç®—ã€Cache ç¼“å­˜æœºåˆ¶ï¼Œæ”¯æŒè¿­ä»£è®¡ç®—å’Œæ•°æ®å…±äº«ï¼Œå‡å°‘æ•°æ®è¯»å–çš„ IO å¼€é”€ åˆ©ç”¨ DAG å¼•æ“Žï¼Œå‡å°‘ä¸­é—´è®¡ç®—ç»“æžœå†™å…¥ HDFS çš„å¼€é”€ åˆ©ç”¨å¤šçº¿ç¨‹æ± æ¨¡åž‹ï¼Œå‡å°‘ä»»åŠ¡å¯åŠ¨å¼€é”€ï¼Œé¿å… Shuffle ä¸­ä¸å¿…è¦çš„æŽ’åºå’Œç£ç›˜ IO æ“ä½œ é€šç”¨æ˜“ç”¨ é€‚ç”¨äºŽæ‰¹å¤„ç†ã€æµå¤„ç†ã€äº¤äº’å¼è®¡ç®—ã€æœºå™¨å­¦ä¹ ç­‰åœºæ™¯ æä¾›äº†ä¸°å¯Œçš„å¼€å‘ APIï¼Œæ”¯æŒ Scalaã€Javaã€Pythonã€R ç­‰ Spark åŽŸç† ç¼–ç¨‹æ¨¡åž‹ RDD å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼ˆResilient Distributed Datesetsï¼‰ åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­çš„åªè¯»å¯¹è±¡é›†åˆ ç”±å¤šä¸ª Partition ç»„æˆ é€šè¿‡è½¬æ¢æ“ä½œæž„é€  å¤±æ•ˆåŽè‡ªåŠ¨é‡æž„ï¼ˆå¼¹æ€§ï¼‰ å­˜å‚¨åœ¨å†…å­˜æˆ–ç£ç›˜ä¸­ Spark åŸºäºŽ RDD è¿›è¡Œè®¡ç®— RDD æ“ä½œï¼ˆOperatorï¼‰ Transformationï¼ˆè½¬æ¢ï¼‰ å°† Scala é›†åˆæˆ– Hadoop è¾“å…¥æ•°æ®æž„é€ æˆä¸€ä¸ªæ–° RDD é€šè¿‡å·²æœ‰çš„ RDD äº§ç”Ÿæ–° RDD æƒ°æ€§æ‰§è¡Œï¼šåªè®°å½•è½¬æ¢å…³ç³»ï¼Œä¸è§¦å‘è®¡ç®— ä¾‹å¦‚ï¼šmapã€filterã€flatmapã€unionã€distinctã€sortbykey Actionï¼ˆåŠ¨ä½œï¼‰ é€šè¿‡ RDD è®¡ç®—å¾—åˆ°ä¸€ä¸ªå€¼æˆ–ä¸€ç»„å€¼ çœŸæ­£è§¦å‘è®¡ç®— ä¾‹å¦‚ï¼šfirstã€countã€collectã€foreachã€saveAsTextFile RDD ä¾èµ–ï¼ˆDependencyï¼‰ çª„ä¾èµ–ï¼ˆNarrow Dependencyï¼‰ çˆ¶ RDD ä¸­çš„åˆ†åŒºæœ€å¤šåªèƒ½è¢«ä¸€ä¸ªå­ RDD çš„ä¸€ä¸ªåˆ†åŒºä½¿ç”¨ å­ RDD å¦‚æžœæœ‰éƒ¨åˆ†åˆ†åŒºæ•°æ®ä¸¢å¤±æˆ–æŸåï¼Œåªéœ€ä»Žå¯¹åº”çš„çˆ¶ RDD é‡æ–°è®¡ç®—æ¢å¤ ä¾‹å¦‚ï¼šmapã€filterã€union å®½ä¾èµ–ï¼ˆShuffle/Wide Dependency ï¼‰ å­ RDD åˆ†åŒºä¾èµ–çˆ¶ RDD çš„æ‰€æœ‰åˆ†åŒº å­ RDD å¦‚æžœéƒ¨åˆ†æˆ–å…¨éƒ¨åˆ†åŒºæ•°æ®ä¸¢å¤±æˆ–æŸåï¼Œå¿…é¡»ä»Žæ‰€æœ‰çˆ¶ RDD åˆ†åŒºé‡æ–°è®¡ç®— ç›¸å¯¹äºŽçª„ä¾èµ–ï¼Œå®½ä¾èµ–ä»˜å‡ºçš„ä»£ä»·è¦é«˜å¾ˆå¤šï¼Œå°½é‡é¿å…ä½¿ç”¨ ä¾‹å¦‚ï¼šgroupByKeyã€reduceByKeyã€sortByKey]]></content>
      <categories>
        <category>bigdata</category>
      </categories>
      <tags>
        <tag>bigdata</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MapReduce]]></title>
    <url>%2Fblog%2F2018%2F09%2F03%2Fbigdata%2FMapReduce%2F</url>
    <content type="text"><![CDATA[MapReduce MapReduce ç®€ä»‹ æ¦‚å¿µ æ€æƒ³ ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ ä¸é€‚ç”¨åœºæ™¯ MapReduce åŽŸç† Job &amp; Taskï¼ˆä½œä¸šä¸Žä»»åŠ¡ï¼‰ Splitï¼ˆåˆ‡ç‰‡ï¼‰ Map é˜¶æ®µï¼ˆæ˜ å°„ï¼‰ Reduce é˜¶æ®µï¼ˆåŒ–ç®€ï¼‰ Shuffle é˜¶æ®µï¼ˆæ´—ç‰Œï¼‰ Shuffle è¯¦è§£ Map ç«¯ Reduce ç«¯ ä½œä¸šè¿è¡Œæ¨¡å¼ JobTracker/TaskTracker æ¨¡å¼ï¼ˆHadoop 1.Xï¼‰ YARN æ¨¡å¼ï¼ˆHadoop 2.Xï¼‰ MapReduce ç®€ä»‹ æ¦‚å¿µ MapReduce æ˜¯ä¸€ä¸ªé¢å‘æ‰¹å¤„ç†çš„åˆ†å¸ƒå¼è®¡ç®—æ¡†æž¶ã€‚ ç¼–ç¨‹æ¨¡åž‹ï¼šMapReduce ç¨‹åºè¢«åˆ†ä¸º Mapï¼ˆæ˜ å°„ï¼‰é˜¶æ®µå’Œ Reduceï¼ˆåŒ–ç®€ï¼‰é˜¶æ®µã€‚ æ€æƒ³ åˆ†è€Œæ²»ä¹‹ï¼Œå¹¶è¡Œè®¡ç®— ç§»åŠ¨è®¡ç®—ï¼Œè€Œéžç§»åŠ¨æ•°æ® ç‰¹ç‚¹ è®¡ç®—è·Ÿç€æ•°æ®èµ° è‰¯å¥½çš„æ‰©å±•æ€§ï¼šè®¡ç®—èƒ½åŠ›éšç€èŠ‚ç‚¹æ•°å¢žåŠ ï¼Œè¿‘ä¼¼çº¿æ€§é€’å¢ž é«˜å®¹é”™ çŠ¶æ€ç›‘æŽ§ é€‚åˆæµ·é‡æ•°æ®çš„ç¦»çº¿æ‰¹å¤„ç† é™ä½Žäº†åˆ†å¸ƒå¼ç¼–ç¨‹çš„é—¨æ§› é€‚ç”¨åœºæ™¯ æ•°æ®ç»Ÿè®¡ï¼Œå¦‚ï¼šç½‘ç«™çš„ PVã€UV ç»Ÿè®¡ æœç´¢å¼•æ“Žæž„å»ºç´¢å¼• æµ·é‡æ•°æ®æŸ¥è¯¢ ä¸é€‚ç”¨åœºæ™¯ OLAP è¦æ±‚æ¯«ç§’æˆ–ç§’çº§è¿”å›žç»“æžœ æµè®¡ç®— æµè®¡ç®—çš„è¾“å…¥æ•°æ®é›†æ˜¯åŠ¨æ€çš„ï¼Œè€Œ MapReduce æ˜¯é™æ€çš„ DAG è®¡ç®— å¤šä¸ªä½œä¸šå­˜åœ¨ä¾èµ–å…³ç³»ï¼ŒåŽä¸€ä¸ªçš„è¾“å…¥æ˜¯å‰ä¸€ä¸ªçš„è¾“å‡ºï¼Œæž„æˆæœ‰å‘æ— çŽ¯å›¾ DAG æ¯ä¸ª MapReduce ä½œä¸šçš„è¾“å‡ºç»“æžœéƒ½ä¼šè½ç›˜ï¼Œé€ æˆå¤§é‡ç£ç›˜ IOï¼Œå¯¼è‡´æ€§èƒ½éžå¸¸ä½Žä¸‹ MapReduce åŽŸç† Job &amp; Taskï¼ˆä½œä¸šä¸Žä»»åŠ¡ï¼‰ ä½œä¸šæ˜¯å®¢æˆ·ç«¯è¯·æ±‚æ‰§è¡Œçš„ä¸€ä¸ªå·¥ä½œå•å…ƒ åŒ…æ‹¬è¾“å…¥æ•°æ®ã€MapReduce ç¨‹åºã€é…ç½®ä¿¡æ¯ ä»»åŠ¡æ˜¯å°†ä½œä¸šåˆ†è§£åŽå¾—åˆ°çš„ç»†åˆ†å·¥ä½œå•å…ƒ åˆ†ä¸º Map ä»»åŠ¡å’Œ Reduce ä»»åŠ¡ Splitï¼ˆåˆ‡ç‰‡ï¼‰ è¾“å…¥æ•°æ®è¢«åˆ’åˆ†æˆç­‰é•¿çš„å°æ•°æ®å—ï¼Œç§°ä¸ºè¾“å…¥åˆ‡ç‰‡ï¼ˆInput Splitï¼‰ï¼Œç®€ç§°åˆ‡ç‰‡ Split æ˜¯é€»è¾‘æ¦‚å¿µï¼Œä»…åŒ…å«å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚ï¼šæ•°æ®çš„èµ·å§‹ä½ç½®ã€é•¿åº¦ã€æ‰€åœ¨èŠ‚ç‚¹ç­‰ æ¯ä¸ª Split äº¤ç»™ä¸€ä¸ª Map ä»»åŠ¡å¤„ç†ï¼ŒSplit çš„æ•°é‡å†³å®š Map ä»»åŠ¡çš„æ•°é‡ Split çš„åˆ’åˆ†æ–¹å¼ç”±ç¨‹åºè®¾å®šï¼ŒSplit ä¸Ž HDFS Block æ²¡æœ‰ä¸¥æ ¼çš„å¯¹åº”å…³ç³» Split çš„å¤§å°é»˜è®¤ç­‰äºŽ Block å¤§å° Split è¶Šå°ï¼Œè´Ÿè½½è¶Šå‡è¡¡ï¼Œä½†é›†ç¾¤çš„å¼€é”€è¶Šå¤§ Map é˜¶æ®µï¼ˆæ˜ å°„ï¼‰ ç”±è‹¥å¹² Map ä»»åŠ¡ç»„æˆï¼Œä»»åŠ¡æ•°é‡ç”± Split æ•°é‡å†³å®š è¾“å…¥ï¼šSplit åˆ‡ç‰‡ï¼ˆkey-valueï¼‰ï¼Œè¾“å‡ºï¼šä¸­é—´è®¡ç®—ç»“æžœï¼ˆkey-valueï¼‰ Reduce é˜¶æ®µï¼ˆåŒ–ç®€ï¼‰ ç”±è‹¥å¹² Reduce ä»»åŠ¡ç»„æˆï¼Œä»»åŠ¡æ•°é‡ç”±ç¨‹åºæŒ‡å®š è¾“å…¥ï¼šMap é˜¶æ®µè¾“å‡ºçš„ä¸­é—´ç»“æžœï¼ˆkey-valueï¼‰ï¼Œè¾“å‡ºï¼šæœ€ç»ˆç»“æžœï¼ˆkey-valueï¼‰ Shuffle é˜¶æ®µï¼ˆæ´—ç‰Œï¼‰ Mapã€Reduce é˜¶æ®µçš„ä¸­é—´çŽ¯èŠ‚ï¼Œè´Ÿè´£æ‰§è¡Œ Partitionï¼ˆåˆ†åŒºï¼‰ã€Sortï¼ˆæŽ’åºï¼‰ã€Spillï¼ˆæº¢å†™ï¼‰ã€Mergeï¼ˆåˆå¹¶ï¼‰ã€æŠ“å–ï¼ˆFetchï¼‰ç­‰å·¥ä½œ Partition å†³å®šäº† Map ä»»åŠ¡è¾“å‡ºçš„æ¯æ¡æ•°æ®æ”¾å…¥å“ªä¸ªåˆ†åŒºï¼Œäº¤ç»™å“ªä¸ª Reduce ä»»åŠ¡å¤„ç† Reduce ä»»åŠ¡çš„æ•°é‡å†³å®šäº† Partition æ•°é‡ Partition ç¼–å· = Reduce ä»»åŠ¡ç¼–å· =â€œkey hashcode % reduce task numberâ€ é¿å…å’Œå‡å°‘ Shuffle æ˜¯ MapReduce ç¨‹åºè°ƒä¼˜çš„é‡ç‚¹ Shuffle è¯¦è§£ Map ç«¯ Map ä»»åŠ¡å°†ä¸­é—´ç»“æžœå†™å…¥ä¸“ç”¨å†…å­˜ç¼“å†²åŒº Bufferï¼ˆé»˜è®¤ 100Mï¼‰ï¼ŒåŒæ—¶è¿›è¡Œ Partition å’Œ Sortï¼ˆå…ˆæŒ‰â€œkey hashcode % reduce task numberâ€å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œåˆ†åŒºå†…å†æŒ‰ key æŽ’åºï¼‰ å½“ Buffer çš„æ•°æ®é‡è¾¾åˆ°é˜ˆå€¼ï¼ˆé»˜è®¤ 80%ï¼‰æ—¶ï¼Œå°†æ•°æ®æº¢å†™ï¼ˆSpillï¼‰åˆ°ç£ç›˜çš„ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶å†…æ•°æ®å…ˆåˆ†åŒºåŽæŽ’åº Map ä»»åŠ¡ç»“æŸå‰ï¼Œå°†å¤šä¸ªä¸´æ—¶æ–‡ä»¶åˆå¹¶ï¼ˆMergeï¼‰ä¸ºä¸€ä¸ª Map è¾“å‡ºæ–‡ä»¶ï¼Œæ–‡ä»¶å†…æ•°æ®å…ˆåˆ†åŒºåŽæŽ’åº Reduce ç«¯ Reduce ä»»åŠ¡ä»Žå¤šä¸ª Map è¾“å‡ºæ–‡ä»¶ä¸­ä¸»åŠ¨æŠ“å–ï¼ˆFetchï¼‰å±žäºŽè‡ªå·±çš„åˆ†åŒºæ•°æ®ï¼Œå…ˆå†™å…¥ Bufferï¼Œæ•°æ®é‡è¾¾åˆ°é˜ˆå€¼åŽï¼Œæº¢å†™åˆ°ç£ç›˜çš„ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ æ•°æ®æŠ“å–å®ŒæˆåŽï¼Œå°†å¤šä¸ªä¸´æ—¶æ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ª Reduce è¾“å…¥æ–‡ä»¶ï¼Œæ–‡ä»¶å†…æ•°æ®æŒ‰ key æŽ’åº ä½œä¸šè¿è¡Œæ¨¡å¼ JobTracker/TaskTracker æ¨¡å¼ï¼ˆHadoop 1.Xï¼‰ JobTracker èŠ‚ç‚¹ï¼ˆMasterï¼‰ è°ƒåº¦ä»»åŠ¡åœ¨ TaskTracker ä¸Šè¿è¡Œ è‹¥ä»»åŠ¡å¤±è´¥ï¼ŒæŒ‡å®šæ–° TaskTracker é‡æ–°è¿è¡Œ TaskTracker èŠ‚ç‚¹ï¼ˆSlaveï¼‰ æ‰§è¡Œä»»åŠ¡ï¼Œå‘é€è¿›åº¦æŠ¥å‘Š å­˜åœ¨çš„é—®é¢˜ JobTracker å­˜åœ¨å•ç‚¹æ•…éšœ JobTracker è´Ÿè½½å¤ªé‡ï¼ˆä¸Šé™ 4000 èŠ‚ç‚¹ï¼‰ JobTracker ç¼ºå°‘å¯¹èµ„æºçš„å…¨é¢ç®¡ç† TaskTracker å¯¹èµ„æºçš„æè¿°è¿‡äºŽç®€å• æºç å¾ˆéš¾ç†è§£ YARN æ¨¡å¼ï¼ˆHadoop 2.Xï¼‰ æäº¤ä½œä¸š æŸ¥çœ‹ä½œä¸š ç»ˆæ­¢ä½œä¸š]]></content>
      <categories>
        <category>bigdata</category>
      </categories>
      <tags>
        <tag>bigdata</tag>
        <tag>hadoop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[YARN]]></title>
    <url>%2Fblog%2F2018%2F09%2F03%2Fbigdata%2FYARN%2F</url>
    <content type="text"><![CDATA[YARN YARN çš„ç›®æ ‡æ˜¯è§£å†³ MapReduce çš„ç¼ºé™·ã€‚ MapReduce çš„ç¼ºé™·ï¼ˆHadoop 1.xï¼‰ YARN ç®€ä»‹ YARN ç³»ç»Ÿæž¶æž„ ResourceManagerï¼ˆRMï¼‰ NodeManagerï¼ˆNMï¼‰ ApplicationMasterï¼ˆAMï¼‰ Container YARN é«˜å¯ç”¨ YARN èµ„æºè°ƒåº¦ç­–ç•¥ FIFO Schedulerï¼ˆå…ˆè¿›å…ˆå‡ºè°ƒåº¦å™¨ï¼‰ Capacity Schedulerï¼ˆå®¹é‡è°ƒåº¦å™¨ï¼‰ Fair Schedulerï¼ˆå…¬å¹³è°ƒåº¦å™¨ï¼‰ èµ„æº MapReduce çš„ç¼ºé™·ï¼ˆHadoop 1.xï¼‰ èº«å…¼ä¸¤èŒï¼šè®¡ç®—æ¡†æž¶ + èµ„æºç®¡ç†æ¡†æž¶ JobTracker æ—¢åšèµ„æºç®¡ç†ï¼Œåˆåšä»»åŠ¡è°ƒåº¦ ä»»åŠ¡å¤ªé‡ï¼Œå¼€é”€è¿‡å¤§ å­˜åœ¨å•ç‚¹æ•…éšœ èµ„æºæè¿°æ¨¡åž‹è¿‡äºŽç®€å•ï¼Œèµ„æºåˆ©ç”¨çŽ‡è¾ƒä½Ž ä»…æŠŠ Task æ•°é‡çœ‹ä½œèµ„æºï¼Œæ²¡æœ‰è€ƒè™‘ CPU å’Œå†…å­˜ å¼ºåˆ¶æŠŠèµ„æºåˆ†æˆ Map Task Slot å’Œ Reduce Task Slot æ‰©å±•æ€§è¾ƒå·®ï¼Œé›†ç¾¤è§„æ¨¡ä¸Šé™ 4K æºç éš¾äºŽç†è§£ï¼Œå‡çº§ç»´æŠ¤å›°éš¾ YARN ç®€ä»‹ YARN(Yet Another Resource Negotiatorï¼Œå¦ä¸€ç§èµ„æºç®¡ç†å™¨)æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é€šç”¨èµ„æºç®¡ç†ç³»ç»Ÿã€‚ è®¾è®¡ç›®æ ‡ï¼šèšç„¦èµ„æºç®¡ç†ã€é€šç”¨ï¼ˆé€‚ç”¨å„ç§è®¡ç®—æ¡†æž¶ï¼‰ã€é«˜å¯ç”¨ã€é«˜æ‰©å±•ã€‚ YARN ç³»ç»Ÿæž¶æž„ ä¸»ä»Žç»“æž„ï¼ˆmaster/slaveï¼‰ å°† JobTracker çš„èµ„æºç®¡ç†ã€ä»»åŠ¡è°ƒåº¦åŠŸèƒ½åˆ†ç¦» ä¸‰ç§è§’è‰²ï¼š ResourceManagerï¼ˆMasterï¼‰ - é›†ç¾¤èµ„æºçš„ç»Ÿä¸€ç®¡ç†å’Œåˆ†é… NodeManagerï¼ˆSlaveï¼‰ - ç®¡ç†èŠ‚ç‚¹èµ„æºï¼Œä»¥åŠå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ ApplicationMasterï¼ˆæ–°è§’è‰²ï¼‰ - ç®¡ç†åº”ç”¨ç¨‹åºå®žä¾‹ï¼ŒåŒ…æ‹¬ä»»åŠ¡è°ƒåº¦å’Œèµ„æºç”³è¯· ResourceManagerï¼ˆRMï¼‰ ä¸»è¦åŠŸèƒ½ ç»Ÿä¸€ç®¡ç†é›†ç¾¤çš„æ‰€æœ‰èµ„æº å°†èµ„æºæŒ‰ç…§ä¸€å®šç­–ç•¥åˆ†é…ç»™å„ä¸ªåº”ç”¨ï¼ˆApplicationMasterï¼‰ æŽ¥æ”¶ NodeManager çš„èµ„æºä¸ŠæŠ¥ä¿¡æ¯ æ ¸å¿ƒç»„ä»¶ ç”¨æˆ·äº¤äº’æœåŠ¡ï¼ˆUser Serviceï¼‰ NodeManager ç®¡ç† ApplicationMaster ç®¡ç† Application ç®¡ç† å®‰å…¨ç®¡ç† èµ„æºç®¡ç† NodeManagerï¼ˆNMï¼‰ ä¸»è¦åŠŸèƒ½ ç®¡ç†å•ä¸ªèŠ‚ç‚¹çš„èµ„æº å‘ ResourceManager æ±‡æŠ¥èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ ç®¡ç† Container çš„ç”Ÿå‘½å‘¨æœŸ æ ¸å¿ƒç»„ä»¶ NodeStatusUpdater ContainerManager ContainerExecutor NodeHealthCheckerService Security WebServer ApplicationMasterï¼ˆAMï¼‰ ä¸»è¦åŠŸèƒ½ ç®¡ç†åº”ç”¨ç¨‹åºå®žä¾‹ å‘ ResourceManager ç”³è¯·ä»»åŠ¡æ‰§è¡Œæ‰€éœ€çš„èµ„æº ä»»åŠ¡è°ƒåº¦å’Œç›‘ç®¡ å®žçŽ°æ–¹å¼ éœ€è¦ä¸ºæ¯ä¸ªåº”ç”¨å¼€å‘ä¸€ä¸ª AM ç»„ä»¶ YARN æä¾› MapReduce çš„ ApplicationMaster å®žçŽ° é‡‡ç”¨åŸºäºŽäº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡åž‹ï¼Œç”±ä¸­å¤®äº‹ä»¶è°ƒåº¦å™¨ç»Ÿä¸€ç®¡ç†æ‰€æœ‰äº‹ä»¶ æ¯ç§ç»„ä»¶éƒ½æ˜¯ä¸€ç§äº‹ä»¶å¤„ç†å™¨ï¼Œåœ¨ä¸­å¤®äº‹ä»¶è°ƒåº¦å™¨ä¸­æ³¨å†Œ Container æ¦‚å¿µï¼šContainer å°è£…äº†èŠ‚ç‚¹ä¸Šè¿›ç¨‹çš„ç›¸å…³èµ„æºï¼Œæ˜¯ YARN ä¸­èµ„æºçš„æŠ½è±¡ åˆ†ç±»ï¼šè¿è¡Œ ApplicationMaster çš„ Container ã€è¿è¡Œåº”ç”¨ä»»åŠ¡çš„ Container YARN é«˜å¯ç”¨ ResourceManager é«˜å¯ç”¨ 1 ä¸ª Active RMã€å¤šä¸ª Standby RM å®•æœºåŽè‡ªåŠ¨å®žçŽ°ä¸»å¤‡åˆ‡æ¢ ZooKeeper çš„æ ¸å¿ƒä½œç”¨ Active èŠ‚ç‚¹é€‰ä¸¾ æ¢å¤ Active RM çš„åŽŸæœ‰çŠ¶æ€ä¿¡æ¯ é‡å¯ AMï¼Œæ€æ­»æ‰€æœ‰è¿è¡Œä¸­çš„ Container åˆ‡æ¢æ–¹å¼ï¼šæ‰‹åŠ¨ã€è‡ªåŠ¨ YARN èµ„æºè°ƒåº¦ç­–ç•¥ FIFO Schedulerï¼ˆå…ˆè¿›å…ˆå‡ºè°ƒåº¦å™¨ï¼‰ è°ƒåº¦ç­–ç•¥ å°†æ‰€æœ‰ä»»åŠ¡æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…ˆè¿›é˜Ÿåˆ—çš„å…ˆèŽ·å¾—èµ„æºï¼ŒæŽ’åœ¨åŽé¢çš„ä»»åŠ¡åªæœ‰ç­‰å¾… ç¼ºç‚¹ èµ„æºåˆ©ç”¨çŽ‡ä½Žï¼Œæ— æ³•äº¤å‰è¿è¡Œä»»åŠ¡ çµæ´»æ€§å·®ï¼Œå¦‚ï¼šç´§æ€¥ä»»åŠ¡æ— æ³•æ’é˜Ÿï¼Œè€—æ—¶é•¿çš„ä»»åŠ¡æ‹–æ…¢è€—æ—¶çŸ­çš„ä»»åŠ¡ Capacity Schedulerï¼ˆå®¹é‡è°ƒåº¦å™¨ï¼‰ æ ¸å¿ƒæ€æƒ³ - æå‰åšé¢„ç®—ï¼Œåœ¨é¢„ç®—æŒ‡å¯¼ä¸‹åˆ†äº«é›†ç¾¤èµ„æºã€‚ è°ƒåº¦ç­–ç•¥ é›†ç¾¤èµ„æºç”±å¤šä¸ªé˜Ÿåˆ—åˆ†äº« æ¯ä¸ªé˜Ÿåˆ—éƒ½è¦é¢„è®¾èµ„æºåˆ†é…çš„æ¯”ä¾‹ï¼ˆæå‰åšé¢„ç®—ï¼‰ ç©ºé—²èµ„æºä¼˜å…ˆåˆ†é…ç»™â€œå®žé™…èµ„æº/é¢„ç®—èµ„æºâ€æ¯”å€¼æœ€ä½Žçš„é˜Ÿåˆ— é˜Ÿåˆ—å†…éƒ¨é‡‡ç”¨ FIFO è°ƒåº¦ç­–ç•¥ ç‰¹ç‚¹ å±‚æ¬¡åŒ–çš„é˜Ÿåˆ—è®¾è®¡ï¼šå­é˜Ÿåˆ—å¯ä½¿ç”¨çˆ¶é˜Ÿåˆ—èµ„æº å®¹é‡ä¿è¯ï¼šæ¯ä¸ªé˜Ÿåˆ—éƒ½è¦é¢„è®¾èµ„æºå æ¯”ï¼Œé˜²æ­¢èµ„æºç‹¬å  å¼¹æ€§åˆ†é…ï¼šç©ºé—²èµ„æºå¯ä»¥åˆ†é…ç»™ä»»ä½•é˜Ÿåˆ—ï¼Œå½“å¤šä¸ªé˜Ÿåˆ—äº‰ç”¨æ—¶ï¼Œä¼šæŒ‰æ¯”ä¾‹è¿›è¡Œå¹³è¡¡ æ”¯æŒåŠ¨æ€ç®¡ç†ï¼šå¯ä»¥åŠ¨æ€è°ƒæ•´é˜Ÿåˆ—çš„å®¹é‡ã€æƒé™ç­‰å‚æ•°ï¼Œä¹Ÿå¯åŠ¨æ€å¢žåŠ ã€æš‚åœé˜Ÿåˆ— è®¿é—®æŽ§åˆ¶ï¼šç”¨æˆ·åªèƒ½å‘è‡ªå·±çš„é˜Ÿåˆ—ä¸­æäº¤ä»»åŠ¡ï¼Œä¸èƒ½è®¿é—®å…¶ä»–é˜Ÿåˆ— å¤šç§Ÿæˆ·ï¼šå¤šç”¨æˆ·å…±äº«é›†ç¾¤èµ„æº Fair Schedulerï¼ˆå…¬å¹³è°ƒåº¦å™¨ï¼‰ è°ƒåº¦ç­–ç•¥ å¤šé˜Ÿåˆ—å…¬å¹³å…±äº«é›†ç¾¤èµ„æº é€šè¿‡å¹³åˆ†çš„æ–¹å¼ï¼ŒåŠ¨æ€åˆ†é…èµ„æºï¼Œæ— éœ€é¢„å…ˆè®¾å®šèµ„æºåˆ†é…æ¯”ä¾‹ é˜Ÿåˆ—å†…éƒ¨å¯é…ç½®è°ƒåº¦ç­–ç•¥ï¼šFIFOã€Fairï¼ˆé»˜è®¤ï¼‰ èµ„æºæŠ¢å  ç»ˆæ­¢å…¶ä»–é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œä½¿å…¶è®©å‡ºæ‰€å èµ„æºï¼Œç„¶åŽå°†èµ„æºåˆ†é…ç»™å ç”¨èµ„æºé‡å°‘äºŽæœ€å°èµ„æºé‡é™åˆ¶çš„é˜Ÿåˆ— é˜Ÿåˆ—æƒé‡ å½“é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡ç­‰å¾…ï¼Œå¹¶ä¸”é›†ç¾¤ä¸­æœ‰ç©ºé—²èµ„æºæ—¶ï¼Œæ¯ä¸ªé˜Ÿåˆ—å¯ä»¥æ ¹æ®æƒé‡èŽ·å¾—ä¸åŒæ¯”ä¾‹çš„ç©ºé—²èµ„æº èµ„æº]]></content>
      <categories>
        <category>bigdata</category>
      </categories>
      <tags>
        <tag>bigdata</tag>
        <tag>hadoop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤§æ•°æ®ç®€ä»‹]]></title>
    <url>%2Fblog%2F2018%2F09%2F03%2Fbigdata%2Foverview%2F</url>
    <content type="text"><![CDATA[å¤§æ•°æ®ç®€ä»‹ ç®€ä»‹ ä»€ä¹ˆæ˜¯å¤§æ•°æ® åº”ç”¨åœºæ™¯ Hadoop ç¼–å¹´å² æŠ€æœ¯ä½“ç³» HDFS MapReduce Spark YARN Hive HBase ElasticSearch æœ¯è¯­ èµ„æº ç®€ä»‹ ä»€ä¹ˆæ˜¯å¤§æ•°æ® å¤§æ•°æ®æ˜¯æŒ‡è¶…å‡ºä¼ ç»Ÿæ•°æ®åº“å·¥å…·æ”¶é›†ã€å­˜å‚¨ã€ç®¡ç†å’Œåˆ†æžèƒ½åŠ›çš„æ•°æ®é›†ã€‚ä¸Žæ­¤åŒæ—¶ï¼ŒåŠæ—¶é‡‡é›†ã€å­˜å‚¨ã€èšåˆã€ç®¡ç†æ•°æ®ï¼Œä»¥åŠå¯¹æ•°æ®æ·±åº¦åˆ†æžçš„æ–°æŠ€æœ¯å’Œæ–°èƒ½åŠ›ï¼Œæ­£åœ¨å¿«é€Ÿå¢žé•¿ï¼Œå°±åƒé¢„æµ‹è®¡ç®—èŠ¯ç‰‡å¢žé•¿é€Ÿåº¦çš„æ‘©å°”å®šå¾‹ä¸€æ ·ã€‚ Volume - æ•°æ®è§„æ¨¡å·¨å¤§ Velocity - ç”Ÿæˆå’Œå¤„ç†é€Ÿåº¦æžå¿« Variety - æ•°æ®è§„æ¨¡å·¨å¤§ Value - ç”Ÿæˆå’Œå¤„ç†é€Ÿåº¦æžå¿« åº”ç”¨åœºæ™¯ åŸºäºŽå¤§æ•°æ®çš„æ•°æ®ä»“åº“ åŸºäºŽå¤§æ•°æ®çš„å®žæ—¶æµå¤„ç† Hadoop ç¼–å¹´å² æ—¶é—´ äº‹ä»¶ 2003.01 Googleå‘è¡¨äº†Google File Systemè®ºæ–‡ 2004.01 Googleå‘è¡¨äº†MapReduceè®ºæ–‡ 2006.02 Apache Hadoopé¡¹ç›®æ­£å¼å¯åŠ¨ï¼Œå¹¶æ”¯æŒMapReduceå’ŒHDFSç‹¬ç«‹å‘å±• 2006.11 Googleå‘è¡¨äº†Bigtableè®ºæ–‡ 2008.01 Hadoopæˆä¸ºApacheé¡¶çº§é¡¹ç›® 2009.03 ClouderaæŽ¨å‡ºä¸–ç•Œä¸Šé¦–ä¸ªHadoopå‘è¡Œç‰ˆâ€”â€”CDHï¼Œå¹¶å®Œå…¨å¼€æ”¾æºç  2012.03 HDFS NameNode HAåŠ å…¥Hadoopä¸»ç‰ˆæœ¬ 2014.02 Sparkä»£æ›¿MapReduceæˆä¸ºHadoopçš„ç¼ºçœè®¡ç®—å¼•æ“Žï¼Œå¹¶æˆä¸ºApacheé¡¶çº§é¡¹ç›® æŠ€æœ¯ä½“ç³» HDFS æ¦‚å¿µ Hadoop åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆHadoop Distributed File Systemï¼‰ åœ¨å¼€æºå¤§æ•°æ®æŠ€æœ¯ä½“ç³»ä¸­ï¼Œåœ°ä½æ— å¯æ›¿ä»£ ç‰¹ç‚¹ é«˜å®¹é”™ï¼šæ•°æ®å¤šå‰¯æœ¬ï¼Œå‰¯æœ¬ä¸¢å¤±åŽè‡ªåŠ¨æ¢å¤ é«˜å¯ç”¨ï¼šNameNode HAï¼Œå®‰å…¨æ¨¡å¼ é«˜æ‰©å±•ï¼š10K èŠ‚ç‚¹è§„æ¨¡ ç®€å•ä¸€è‡´æ€§æ¨¡åž‹ï¼šä¸€æ¬¡å†™å…¥å¤šæ¬¡è¯»å–ï¼Œæ”¯æŒè¿½åŠ ï¼Œä¸å…è®¸ä¿®æ”¹ æµå¼æ•°æ®è®¿é—®ï¼šæ‰¹é‡è¯»è€Œéžéšæœºè¯»ï¼Œå…³æ³¨åžåé‡è€Œéžæ—¶é—´ å¤§è§„æ¨¡æ•°æ®é›†ï¼šå…¸åž‹æ–‡ä»¶å¤§å° GB~TB çº§ï¼Œç™¾ä¸‡ä»¥ä¸Šæ–‡ä»¶æ•°é‡ï¼Œ PB ä»¥ä¸Šæ•°æ®è§„æ¨¡ æž„å»ºæˆæœ¬ä½Žä¸”å®‰å…¨å¯é ï¼šè¿è¡Œåœ¨å¤§é‡çš„å»‰ä»·å•†ç”¨æœºå™¨ä¸Šï¼Œç¡¬ä»¶é”™è¯¯æ˜¯å¸¸æ€ï¼Œæä¾›å®¹é”™æœºåˆ¶ MapReduce æ¦‚å¿µ é¢å‘æ‰¹å¤„ç†çš„åˆ†å¸ƒå¼è®¡ç®—æ¡†æž¶ ç¼–ç¨‹æ¨¡åž‹ï¼šå°† MapReduce ç¨‹åºåˆ†ä¸º Mapã€Reduce ä¸¤ä¸ªé˜¶æ®µ æ ¸å¿ƒæ€æƒ³ åˆ†è€Œæ²»ä¹‹ï¼Œåˆ†å¸ƒå¼è®¡ç®— ç§»åŠ¨è®¡ç®—ï¼Œè€Œéžç§»åŠ¨æ•°æ® ç‰¹ç‚¹ é«˜å®¹é”™ï¼šä»»åŠ¡å¤±è´¥ï¼Œè‡ªåŠ¨è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹é‡æ–°æ‰§è¡Œ é«˜æ‰©å±•ï¼šè®¡ç®—èƒ½åŠ›éšç€èŠ‚ç‚¹æ•°å¢žåŠ ï¼Œè¿‘ä¼¼çº¿æ€§é€’å¢ž é€‚ç”¨äºŽæµ·é‡æ•°æ®çš„ç¦»çº¿æ‰¹å¤„ç† é™ä½Žäº†åˆ†å¸ƒå¼ç¼–ç¨‹çš„é—¨æ§› Spark é«˜æ€§èƒ½åˆ†å¸ƒå¼é€šç”¨è®¡ç®—å¼•æ“Ž Spark Core - åŸºç¡€è®¡ç®—æ¡†æž¶ï¼ˆæ‰¹å¤„ç†ã€äº¤äº’å¼åˆ†æžï¼‰ Spark SQL - SQL å¼•æ“Žï¼ˆæµ·é‡ç»“æž„åŒ–æ•°æ®çš„é«˜æ€§èƒ½æŸ¥è¯¢ï¼‰ Spark Streaming - å®žæ—¶æµå¤„ç†ï¼ˆå¾®æ‰¹ï¼‰ Spark MLlib - æœºå™¨å­¦ä¹  Spark GraphX - å›¾è®¡ç®— é‡‡ç”¨ Scala è¯­è¨€å¼€å‘ ç‰¹ç‚¹ è®¡ç®—é«˜æ•ˆ - å†…å­˜è®¡ç®—ã€Cache ç¼“å­˜æœºåˆ¶ã€DAG å¼•æ“Žã€å¤šçº¿ç¨‹æ± æ¨¡åž‹ é€šç”¨æ˜“ç”¨ - é€‚ç”¨äºŽæ‰¹å¤„ç†ã€äº¤äº’å¼è®¡ç®—ã€æµå¤„ç†ã€æœºå™¨å­¦ä¹ ã€å›¾è®¡ç®—ç­‰å¤šç§åœºæ™¯ è¿è¡Œæ¨¡å¼å¤šæ · - Localã€Standaloneã€YARN/Mesos YARN æ¦‚å¿µ Yet Another Resource Negotiatorï¼Œå¦ä¸€ç§èµ„æºç®¡ç†å™¨ ä¸ºäº†è§£å†³ Hadoop 1.x ä¸­ MapReduce çš„å…ˆå¤©ç¼ºé™· åˆ†å¸ƒå¼é€šç”¨èµ„æºç®¡ç†ç³»ç»Ÿ è´Ÿè´£é›†ç¾¤èµ„æºçš„ç»Ÿä¸€ç®¡ç† ä»Ž Hadoop 2.x å¼€å§‹ï¼ŒYARN æˆä¸º Hadoop çš„æ ¸å¿ƒç»„ä»¶ ç‰¹ç‚¹ ä¸“æ³¨äºŽèµ„æºç®¡ç†å’Œä½œä¸šè°ƒåº¦ é€šç”¨ - é€‚ç”¨å„ç§è®¡ç®—æ¡†æž¶ï¼Œå¦‚ - MapReduceã€Spark é«˜å¯ç”¨ - ResourceManager é«˜å¯ç”¨ã€HDFS é«˜å¯ç”¨ é«˜æ‰©å±• Hive æ¦‚å¿µ Hadoop æ•°æ®ä»“åº“ - ä¼ä¸šå†³ç­–æ”¯æŒ SQL å¼•æ“Ž - å¯¹æµ·é‡ç»“æž„åŒ–æ•°æ®è¿›è¡Œé«˜æ€§èƒ½çš„ SQL æŸ¥è¯¢ é‡‡ç”¨ HDFS æˆ– HBase ä¸ºæ•°æ®å­˜å‚¨ é‡‡ç”¨ MapReduce æˆ– Spark ä¸ºè®¡ç®—æ¡†æž¶ ç‰¹ç‚¹ æä¾›ç±» SQL æŸ¥è¯¢è¯­è¨€ æ”¯æŒå‘½ä»¤è¡Œæˆ– JDBC/ODBC æä¾›çµæ´»çš„æ‰©å±•æ€§ æä¾›å¤æ‚æ•°æ®ç±»åž‹ã€æ‰©å±•å‡½æ•°ã€è„šæœ¬ç­‰ HBase æ¦‚å¿µ Hadoop Database Google BigTable çš„å¼€æºå®žçŽ° åˆ†å¸ƒå¼ NoSQL æ•°æ®åº“ åˆ—å¼å­˜å‚¨ - ä¸»è¦ç”¨äºŽåŠç»“æž„åŒ–ã€éžç»“æž„åŒ–æ•°æ® é‡‡ç”¨ HDFS ä¸ºæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ ç‰¹ç‚¹ é«˜æ€§èƒ½ - æ”¯æŒé«˜å¹¶å‘å†™å…¥å’ŒæŸ¥è¯¢ é«˜å¯ç”¨ - HDFS é«˜å¯ç”¨ã€Region é«˜å¯ç”¨ é«˜æ‰©å±• - æ•°æ®è‡ªåŠ¨åˆ‡åˆ†å’Œåˆ†å¸ƒï¼Œå¯åŠ¨æ€æ‰©å®¹ï¼Œæ— éœ€åœæœº æµ·é‡å­˜å‚¨ - å•è¡¨å¯å®¹çº³æ•°åäº¿è¡Œï¼Œä¸Šç™¾ä¸‡åˆ— ElasticSearch å¼€æºçš„åˆ†å¸ƒå¼å…¨æ–‡æ£€ç´¢å¼•æ“Ž åŸºäºŽ Lucene å®žçŽ°å…¨æ–‡æ•°æ®çš„å¿«é€Ÿå­˜å‚¨ã€æœç´¢å’Œåˆ†æž å¤„ç†å¤§è§„æ¨¡æ•°æ® - PB çº§ä»¥ä¸Š å…·æœ‰è¾ƒå¼ºçš„æ‰©å±•æ€§ï¼Œé›†ç¾¤è§„æ¨¡å¯è¾¾ä¸Šç™¾å° é¦–é€‰çš„åˆ†å¸ƒå¼æœç´¢å¼•æ“Ž æœ¯è¯­ æ•°æ®ä»“åº“ï¼ˆData Warehouseï¼‰ - æ•°æ®ä»“åº“ï¼Œæ˜¯ä¸ºä¼ä¸šæ‰€æœ‰çº§åˆ«çš„å†³ç­–åˆ¶å®šè¿‡ç¨‹ï¼Œæä¾›æ‰€æœ‰ç±»åž‹æ•°æ®æ”¯æŒçš„æˆ˜ç•¥é›†åˆã€‚å®ƒæ˜¯å•ä¸ªæ•°æ®å­˜å‚¨ï¼Œå‡ºäºŽåˆ†æžæ€§æŠ¥å‘Šå’Œå†³ç­–æ”¯æŒç›®çš„è€Œåˆ›å»ºã€‚ ä¸ºéœ€è¦ä¸šåŠ¡æ™ºèƒ½çš„ä¼ä¸šï¼Œæä¾›æŒ‡å¯¼ä¸šåŠ¡æµç¨‹æ”¹è¿›ã€ç›‘è§†æ—¶é—´ã€æˆæœ¬ã€è´¨é‡ä»¥åŠæŽ§åˆ¶ã€‚ èµ„æº awesome-bigdata Hadoop HBase Hive Impala Flume Kafka Spark Sqoop ElasticSearch]]></content>
      <categories>
        <category>bigdata</category>
      </categories>
      <tags>
        <tag>bigdata</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼æŠ€æœ¯é¢è¯•é¢˜]]></title>
    <url>%2Fblog%2F2018%2F07%2F10%2Fdesign%2Fdistributed%2Fdistributed-interview%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼æŠ€æœ¯é¢è¯•é¢˜ 1. åˆ†å¸ƒå¼ç¼“å­˜ 1.1. Redis æœ‰ä»€ä¹ˆæ•°æ®ç±»åž‹ï¼Ÿåˆ†åˆ«ç”¨äºŽä»€ä¹ˆåœºæ™¯ï¼Ÿ 1.2. Redis çš„ä¸»ä»Žå¤åˆ¶æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ 1.3. Redis çš„ key æ˜¯å¦‚ä½•å¯»å€çš„ï¼Ÿ 1.4. Redis çš„é›†ç¾¤æ¨¡å¼æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ 1.5. Redis å¦‚ä½•å®žçŽ°åˆ†å¸ƒå¼é”ï¼ŸZooKeeper å¦‚ä½•å®žçŽ°åˆ†å¸ƒå¼é”ï¼Ÿæ¯”è¾ƒäºŒè€…ä¼˜åŠ£ï¼Ÿ 1.6. Redis çš„æŒä¹…åŒ–æ–¹å¼ï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼ŸæŒä¹…åŒ–å®žçŽ°åŽŸç†ï¼Ÿ 1.7. Redis è¿‡æœŸç­–ç•¥æœ‰å“ªäº›ï¼Ÿ 1.8. Redis å’Œ Memcached æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ 1.9. ä¸ºä»€ä¹ˆå•çº¿ç¨‹çš„ Redis æ€§èƒ½åè€Œä¼˜äºŽå¤šçº¿ç¨‹çš„ Memcachedï¼Ÿ 2. åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰ 2.1. ä¸ºä»€ä¹ˆä½¿ç”¨ MQï¼Ÿ 2.2. å¦‚ä½•ä¿è¯ MQ çš„é«˜å¯ç”¨ï¼Ÿ 2.3. MQ æœ‰å“ªäº›å¸¸è§é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ 2.4. Kafka, ActiveMQ, RabbitMQ, RocketMQ å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ 3. åˆ†å¸ƒå¼æœåŠ¡ï¼ˆRPCï¼‰ 3.1. Dubbo çš„å®žçŽ°è¿‡ç¨‹ï¼Ÿ 3.2. Dubbo è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ 3.3. Dubbo é›†ç¾¤å®¹é”™ç­–ç•¥ ï¼Ÿ 3.4. åŠ¨æ€ä»£ç†ç­–ç•¥ï¼Ÿ 3.5. Dubbo æ”¯æŒå“ªäº›åºåˆ—åŒ–åè®®ï¼ŸHessianï¼ŸHessian çš„æ•°æ®ç»“æž„ï¼Ÿ 3.6. Protoco Buffer æ˜¯ä»€ä¹ˆï¼Ÿ 3.7. æ³¨å†Œä¸­å¿ƒæŒ‚äº†å¯ä»¥ç»§ç»­é€šä¿¡å—ï¼Ÿ 3.8. ZooKeeper åŽŸç†æ˜¯ä»€ä¹ˆï¼ŸZooKeeper æœ‰ä»€ä¹ˆç”¨ï¼Ÿ 3.9. Netty æœ‰ä»€ä¹ˆç”¨ï¼ŸNIO/BIO/AIO æœ‰ä»€ä¹ˆç”¨ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ 3.10. ä¸ºä»€ä¹ˆè¦è¿›è¡Œç³»ç»Ÿæ‹†åˆ†ï¼Ÿæ‹†åˆ†ä¸ç”¨ Dubbo å¯ä»¥å—ï¼Ÿ 3.11. Dubbo å’Œ Thrift æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ 1. åˆ†å¸ƒå¼ç¼“å­˜ 1.1. Redis æœ‰ä»€ä¹ˆæ•°æ®ç±»åž‹ï¼Ÿåˆ†åˆ«ç”¨äºŽä»€ä¹ˆåœºæ™¯ï¼Ÿ æ•°æ®ç±»åž‹ å¯ä»¥å­˜å‚¨çš„å€¼ æ“ä½œ STRING å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–è€…æµ®ç‚¹æ•° å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œ å¯¹æ•´æ•°å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢žæˆ–è€…è‡ªå‡æ“ä½œ LIST åˆ—è¡¨ ä»Žä¸¤ç«¯åŽ‹å…¥æˆ–è€…å¼¹å‡ºå…ƒç´  è¯»å–å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´  è¿›è¡Œä¿®å‰ªï¼Œåªä¿ç•™ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´  SET æ— åºé›†åˆ æ·»åŠ ã€èŽ·å–ã€ç§»é™¤å•ä¸ªå…ƒç´  æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºŽé›†åˆä¸­ è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›† ä»Žé›†åˆé‡Œé¢éšæœºèŽ·å–å…ƒç´  HASH åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨ æ·»åŠ ã€èŽ·å–ã€ç§»é™¤å•ä¸ªé”®å€¼å¯¹ èŽ·å–æ‰€æœ‰é”®å€¼å¯¹ æ£€æŸ¥æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ ZSET æœ‰åºé›†åˆ æ·»åŠ ã€èŽ·å–ã€åˆ é™¤å…ƒç´  æ ¹æ®åˆ†å€¼èŒƒå›´æˆ–è€…æˆå‘˜æ¥èŽ·å–å…ƒç´  è®¡ç®—ä¸€ä¸ªé”®çš„æŽ’å What Redis data structures look like 1.2. Redis çš„ä¸»ä»Žå¤åˆ¶æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ ä»ŽæœåŠ¡å™¨è¿žæŽ¥ä¸»æœåŠ¡å™¨ï¼Œå‘é€ SYNC å‘½ä»¤ï¼› ä¸»æœåŠ¡å™¨æŽ¥æ”¶åˆ° SYNC å‘½ååŽï¼Œå¼€å§‹æ‰§è¡Œ BGSAVE å‘½ä»¤ç”Ÿæˆ RDB æ–‡ä»¶å¹¶ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ­¤åŽæ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ï¼› ä¸»æœåŠ¡å™¨ BGSAVE æ‰§è¡Œå®ŒåŽï¼Œå‘æ‰€æœ‰ä»ŽæœåŠ¡å™¨å‘é€å¿«ç…§æ–‡ä»¶ï¼Œå¹¶åœ¨å‘é€æœŸé—´ç»§ç»­è®°å½•è¢«æ‰§è¡Œçš„å†™å‘½ä»¤ï¼› ä»ŽæœåŠ¡å™¨æ”¶åˆ°å¿«ç…§æ–‡ä»¶åŽä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥æ”¶åˆ°çš„å¿«ç…§ï¼› ä¸»æœåŠ¡å™¨å¿«ç…§å‘é€å®Œæ¯•åŽå¼€å§‹å‘ä»ŽæœåŠ¡å™¨å‘é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ï¼› ä»ŽæœåŠ¡å™¨å®Œæˆå¯¹å¿«ç…§çš„è½½å…¥ï¼Œå¼€å§‹æŽ¥æ”¶å‘½ä»¤è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ¥è‡ªä¸»æœåŠ¡å™¨ç¼“å†²åŒºçš„å†™å‘½ä»¤ï¼› 1.3. Redis çš„ key æ˜¯å¦‚ä½•å¯»å€çš„ï¼Ÿ èƒŒæ™¯ ï¼ˆ1ï¼‰redis ä¸­çš„æ¯ä¸€ä¸ªæ•°æ®åº“ï¼Œéƒ½ç”±ä¸€ä¸ª redisDb çš„ç»“æž„å­˜å‚¨ã€‚å…¶ä¸­ï¼š redisDb.id å­˜å‚¨ç€ redis æ•°æ®åº“ä»¥æ•´æ•°è¡¨ç¤ºçš„å·ç ã€‚ redisDb.dict å­˜å‚¨ç€è¯¥åº“æ‰€æœ‰çš„é”®å€¼å¯¹æ•°æ®ã€‚ redisDb.expires ä¿å­˜ç€æ¯ä¸€ä¸ªé”®çš„è¿‡æœŸæ—¶é—´ã€‚ ï¼ˆ2ï¼‰å½“ redis æœåŠ¡å™¨åˆå§‹åŒ–æ—¶ï¼Œä¼šé¢„å…ˆåˆ†é… 16 ä¸ªæ•°æ®åº“ï¼ˆè¯¥æ•°é‡å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®ï¼‰ï¼Œæ‰€æœ‰æ•°æ®åº“ä¿å­˜åˆ°ç»“æž„ redisServer çš„ä¸€ä¸ªæˆå‘˜ redisServer.db æ•°ç»„ä¸­ã€‚å½“æˆ‘ä»¬é€‰æ‹©æ•°æ®åº“ select number æ—¶ï¼Œç¨‹åºç›´æŽ¥é€šè¿‡ redisServer.db[number] æ¥åˆ‡æ¢æ•°æ®åº“ã€‚æœ‰æ—¶å€™å½“ç¨‹åºéœ€è¦çŸ¥é“è‡ªå·±æ˜¯åœ¨å“ªä¸ªæ•°æ®åº“æ—¶ï¼Œç›´æŽ¥è¯»å– redisDb.id å³å¯ã€‚ ï¼ˆ3ï¼‰redis çš„å­—å…¸ä½¿ç”¨å“ˆå¸Œè¡¨ä½œä¸ºå…¶åº•å±‚å®žçŽ°ã€‚dict ç±»åž‹ä½¿ç”¨çš„ä¸¤ä¸ªæŒ‡å‘å“ˆå¸Œè¡¨çš„æŒ‡é’ˆï¼Œå…¶ä¸­ 0 å·å“ˆå¸Œè¡¨ï¼ˆht[0]ï¼‰ä¸»è¦ç”¨äºŽå­˜å‚¨æ•°æ®åº“çš„æ‰€æœ‰é”®å€¼ï¼Œè€Œ 1 å·å“ˆå¸Œè¡¨ä¸»è¦ç”¨äºŽç¨‹åºå¯¹ 0 å·å“ˆå¸Œè¡¨è¿›è¡Œ rehash æ—¶ä½¿ç”¨ï¼Œrehash ä¸€èˆ¬æ˜¯åœ¨æ·»åŠ æ–°å€¼æ—¶ä¼šè§¦å‘ï¼Œè¿™é‡Œä¸åšè¿‡å¤šçš„èµ˜è¿°ã€‚æ‰€ä»¥ redis ä¸­æŸ¥æ‰¾ä¸€ä¸ª keyï¼Œå…¶å®žå°±æ˜¯å¯¹è¿›è¡Œè¯¥ dict ç»“æž„ä¸­çš„ ht[0] è¿›è¡ŒæŸ¥æ‰¾æ“ä½œã€‚ ï¼ˆ4ï¼‰æ—¢ç„¶æ˜¯å“ˆå¸Œï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“å°±ä¼šæœ‰å“ˆå¸Œç¢°æ’žï¼Œé‚£ä¹ˆå½“å¤šä¸ªé”®å“ˆå¸Œä¹‹åŽä¸ºåŒä¸€ä¸ªå€¼æ€Žä¹ˆåŠžå‘¢ï¼Ÿredis é‡‡å–é“¾è¡¨çš„æ–¹å¼æ¥å­˜å‚¨å¤šä¸ªå“ˆå¸Œç¢°æ’žçš„é”®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ ¹æ® key çš„å“ˆå¸Œå€¼æ‰¾åˆ°è¯¥åˆ—è¡¨åŽï¼Œå¦‚æžœåˆ—è¡¨çš„é•¿åº¦å¤§äºŽ 1ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦éåŽ†è¯¥é“¾è¡¨æ¥æ‰¾åˆ°æˆ‘ä»¬æ‰€æŸ¥æ‰¾çš„ keyã€‚å½“ç„¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹é“¾è¡¨é•¿åº¦éƒ½ä¸ºæ˜¯ 1ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦å¯çœ‹ä½œ o(1)ã€‚ å¯»å€ key çš„æ­¥éª¤ å½“æ‹¿åˆ°ä¸€ä¸ª key åŽï¼Œredis å…ˆåˆ¤æ–­å½“å‰åº“çš„ 0 å·å“ˆå¸Œè¡¨æ˜¯å¦ä¸ºç©ºï¼Œå³ï¼šif (dict-&gt;ht[0].size == 0)ã€‚å¦‚æžœä¸º true ç›´æŽ¥è¿”å›ž NULLã€‚ åˆ¤æ–­è¯¥ 0 å·å“ˆå¸Œè¡¨æ˜¯å¦éœ€è¦ rehashï¼Œå› ä¸ºå¦‚æžœåœ¨è¿›è¡Œ rehashï¼Œé‚£ä¹ˆä¸¤ä¸ªè¡¨ä¸­è€…æœ‰å¯èƒ½å­˜å‚¨è¯¥ keyã€‚å¦‚æžœæ­£åœ¨è¿›è¡Œ rehashï¼Œå°†è°ƒç”¨ä¸€æ¬¡_dictRehashStep æ–¹æ³•ï¼Œ_dictRehashStep ç”¨äºŽå¯¹æ•°æ®åº“å­—å…¸ã€ä»¥åŠå“ˆå¸Œé”®çš„å­—å…¸è¿›è¡Œè¢«åŠ¨ rehashï¼Œè¿™é‡Œä¸ä½œèµ˜è¿°ã€‚ è®¡ç®—å“ˆå¸Œè¡¨ï¼Œæ ¹æ®å½“å‰å­—å…¸ä¸Ž key è¿›è¡Œå“ˆå¸Œå€¼çš„è®¡ç®—ã€‚ æ ¹æ®å“ˆå¸Œå€¼ä¸Žå½“å‰å­—å…¸è®¡ç®—å“ˆå¸Œè¡¨çš„ç´¢å¼•å€¼ã€‚ æ ¹æ®ç´¢å¼•å€¼åœ¨å“ˆå¸Œè¡¨ä¸­å–å‡ºé“¾è¡¨ï¼ŒéåŽ†è¯¥é“¾è¡¨æ‰¾åˆ° key çš„ä½ç½®ã€‚ä¸€èˆ¬æƒ…å†µï¼Œè¯¥é“¾è¡¨é•¿åº¦ä¸º 1ã€‚ å½“ ht[0] æŸ¥æ‰¾å®Œäº†ä¹‹åŽï¼Œå†è¿›è¡Œäº†æ¬¡ rehash åˆ¤æ–­ï¼Œå¦‚æžœæœªåœ¨ rehashingï¼Œåˆ™ç›´æŽ¥ç»“æŸï¼Œå¦åˆ™å¯¹ ht[1]é‡å¤ 345 æ­¥éª¤ã€‚ 1.4. Redis çš„é›†ç¾¤æ¨¡å¼æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ Redis Cluster æ˜¯ Redis çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œåœ¨ Redis 3.0 ç‰ˆæœ¬æ­£å¼æŽ¨å‡ºçš„ã€‚ Redis Cluster åŽ»ä¸­å¿ƒåŒ–ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¿å­˜æ•°æ®å’Œæ•´ä¸ªé›†ç¾¤çŠ¶æ€ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å’Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹è¿žæŽ¥ã€‚ Redis Cluster èŠ‚ç‚¹åˆ†é… Redis Cluster ç‰¹ç‚¹ï¼š æ‰€æœ‰çš„ redis èŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONG æœºåˆ¶)ï¼Œå†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½ã€‚ èŠ‚ç‚¹çš„ fail æ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆã€‚ å®¢æˆ·ç«¯ä¸Ž redis èŠ‚ç‚¹ç›´è¿ž,ä¸éœ€è¦ä¸­é—´ proxy å±‚ã€‚å®¢æˆ·ç«¯ä¸éœ€è¦è¿žæŽ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿žæŽ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚ redis-cluster æŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383] å“ˆå¸Œæ§½ (hash slot)ä¸Šï¼ˆä¸ä¸€å®šæ˜¯å¹³å‡åˆ†é…ï¼‰,cluster è´Ÿè´£ç»´æŠ¤ node&lt;-&gt;slot&lt;-&gt;valueã€‚ Redis é›†ç¾¤é¢„åˆ†å¥½ 16384 ä¸ªæ¡¶ï¼Œå½“éœ€è¦åœ¨ Redis é›†ç¾¤ä¸­æ”¾ç½®ä¸€ä¸ª key-value æ—¶ï¼Œæ ¹æ® CRC16(key) mod 16384 çš„å€¼ï¼Œå†³å®šå°†ä¸€ä¸ª key æ”¾åˆ°å“ªä¸ªæ¡¶ä¸­ã€‚ Redis Cluster ä¸»ä»Žæ¨¡å¼ Redis Cluster ä¸ºäº†ä¿è¯æ•°æ®çš„é«˜å¯ç”¨æ€§ï¼ŒåŠ å…¥äº†ä¸»ä»Žæ¨¡å¼ã€‚ ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªä»ŽèŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹æä¾›æ•°æ®å­˜å–ï¼Œä»ŽèŠ‚ç‚¹åˆ™æ˜¯ä»Žä¸»èŠ‚ç‚¹æ‹‰å–æ•°æ®å¤‡ä»½ã€‚å½“è¿™ä¸ªä¸»èŠ‚ç‚¹æŒ‚æŽ‰åŽï¼Œå°±ä¼šæœ‰è¿™ä¸ªä»ŽèŠ‚ç‚¹é€‰å–ä¸€ä¸ªæ¥å……å½“ä¸»èŠ‚ç‚¹ï¼Œä»Žè€Œä¿è¯é›†ç¾¤ä¸ä¼šæŒ‚æŽ‰ã€‚æ‰€ä»¥ï¼Œåœ¨é›†ç¾¤å»ºç«‹çš„æ—¶å€™ï¼Œä¸€å®šè¦ä¸ºæ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½æ·»åŠ äº†ä»ŽèŠ‚ç‚¹ã€‚ Redis Sentinel Redis Sentinel ç”¨äºŽç®¡ç†å¤šä¸ª Redis æœåŠ¡å™¨ï¼Œå®ƒæœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼š ç›‘æŽ§ï¼ˆMonitoringï¼‰ - Sentinel ä¼šä¸æ–­åœ°æ£€æŸ¥ä½ çš„ä¸»æœåŠ¡å™¨å’Œä»ŽæœåŠ¡å™¨æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚ æé†’ï¼ˆNotificationï¼‰ - å½“è¢«ç›‘æŽ§çš„æŸä¸ª Redis æœåŠ¡å™¨å‡ºçŽ°é—®é¢˜æ—¶ï¼Œ Sentinel å¯ä»¥é€šè¿‡ API å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚ è‡ªåŠ¨æ•…éšœè¿ç§»ï¼ˆAutomatic failoverï¼‰ - å½“ä¸€ä¸ªä¸»æœåŠ¡å™¨ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œ Sentinel ä¼šå¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»æ“ä½œï¼Œ å®ƒä¼šå°†å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä¸­ä¸€ä¸ªä»ŽæœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ï¼Œ å¹¶è®©å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä»–ä»ŽæœåŠ¡å™¨æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»æœåŠ¡å™¨ï¼› å½“å®¢æˆ·ç«¯è¯•å›¾è¿žæŽ¥å¤±æ•ˆçš„ä¸»æœåŠ¡å™¨æ—¶ï¼Œ é›†ç¾¤ä¹Ÿä¼šå‘å®¢æˆ·ç«¯è¿”å›žæ–°ä¸»æœåŠ¡å™¨çš„åœ°å€ï¼Œ ä½¿å¾—é›†ç¾¤å¯ä»¥ä½¿ç”¨æ–°ä¸»æœåŠ¡å™¨ä»£æ›¿å¤±æ•ˆæœåŠ¡å™¨ã€‚ Redis é›†ç¾¤ä¸­åº”è¯¥æœ‰å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥è‡³å°‘æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ã€‚ å“¨å…µç›‘æŽ§é›†ç¾¤ä¸­çš„ä¸»æœåŠ¡å™¨å‡ºçŽ°æ•…éšœæ—¶ï¼Œéœ€è¦æ ¹æ® quorum é€‰ä¸¾å‡ºä¸€ä¸ªå“¨å…µæ¥æ‰§è¡Œæ•…éšœè½¬ç§»ã€‚é€‰ä¸¾éœ€è¦ majorityï¼Œå³å¤§å¤šæ•°å“¨å…µæ˜¯è¿è¡Œçš„ï¼ˆ2 ä¸ªå“¨å…µçš„ majority=2ï¼Œ3 ä¸ªå“¨å…µçš„ majority=2ï¼Œ5 ä¸ªå“¨å…µçš„ majority=3ï¼Œ4 ä¸ªå“¨å…µçš„ majority=2ï¼‰ã€‚ å‡è®¾é›†ç¾¤ä»…ä»…éƒ¨ç½² 2 ä¸ªèŠ‚ç‚¹ +----+ +----+| M1 |---------| R1 || S1 | | S2 |+----+ +----+ å¦‚æžœ M1 å’Œ S1 æ‰€åœ¨æœåŠ¡å™¨å®•æœºï¼Œåˆ™å“¨å…µåªæœ‰ 1 ä¸ªï¼Œæ— æ³•æ»¡è¶³ majority æ¥è¿›è¡Œé€‰ä¸¾ï¼Œå°±ä¸èƒ½æ‰§è¡Œæ•…éšœè½¬ç§»ã€‚ 1.5. Redis å¦‚ä½•å®žçŽ°åˆ†å¸ƒå¼é”ï¼ŸZooKeeper å¦‚ä½•å®žçŽ°åˆ†å¸ƒå¼é”ï¼Ÿæ¯”è¾ƒäºŒè€…ä¼˜åŠ£ï¼Ÿ åˆ†å¸ƒå¼é”çš„ä¸‰ç§å®žçŽ°ï¼š åŸºäºŽæ•°æ®åº“å®žçŽ°åˆ†å¸ƒå¼é”ï¼› åŸºäºŽç¼“å­˜ï¼ˆRedis ç­‰ï¼‰å®žçŽ°åˆ†å¸ƒå¼é”ï¼› åŸºäºŽ Zookeeper å®žçŽ°åˆ†å¸ƒå¼é”ï¼› æ•°æ®åº“å®žçŽ° Redis å®žçŽ° èŽ·å–é”çš„æ—¶å€™ï¼Œä½¿ç”¨ setnx åŠ é”ï¼Œå¹¶ä½¿ç”¨ expire å‘½ä»¤ä¸ºé”æ·»åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´åˆ™è‡ªåŠ¨é‡Šæ”¾é”ï¼Œé”çš„ value å€¼ä¸ºä¸€ä¸ªéšæœºç”Ÿæˆçš„ UUIDï¼Œé€šè¿‡æ­¤åœ¨é‡Šæ”¾é”çš„æ—¶å€™è¿›è¡Œåˆ¤æ–­ã€‚ èŽ·å–é”çš„æ—¶å€™è¿˜è®¾ç½®ä¸€ä¸ªèŽ·å–çš„è¶…æ—¶æ—¶é—´ï¼Œè‹¥è¶…è¿‡è¿™ä¸ªæ—¶é—´åˆ™æ”¾å¼ƒèŽ·å–é”ã€‚ é‡Šæ”¾é”çš„æ—¶å€™ï¼Œé€šè¿‡ UUID åˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥é”ï¼Œè‹¥æ˜¯è¯¥é”ï¼Œåˆ™æ‰§è¡Œ delete è¿›è¡Œé”é‡Šæ”¾ã€‚ ZooKeeper å®žçŽ° åˆ›å»ºä¸€ä¸ªç›®å½• mylockï¼› çº¿ç¨‹ A æƒ³èŽ·å–é”å°±åœ¨ mylock ç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼› èŽ·å– mylock ç›®å½•ä¸‹æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œç„¶åŽèŽ·å–æ¯”è‡ªå·±å°çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œå¦‚æžœä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜Žå½“å‰çº¿ç¨‹é¡ºåºå·æœ€å°ï¼ŒèŽ·å¾—é”ï¼› çº¿ç¨‹ B èŽ·å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œåˆ¤æ–­è‡ªå·±ä¸æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œè®¾ç½®ç›‘å¬æ¯”è‡ªå·±æ¬¡å°çš„èŠ‚ç‚¹ï¼› çº¿ç¨‹ A å¤„ç†å®Œï¼Œåˆ é™¤è‡ªå·±çš„èŠ‚ç‚¹ï¼Œçº¿ç¨‹ B ç›‘å¬åˆ°å˜æ›´äº‹ä»¶ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œå¦‚æžœæ˜¯åˆ™èŽ·å¾—é”ã€‚ å®žçŽ°å¯¹æ¯” ZooKeeper å…·å¤‡é«˜å¯ç”¨ã€å¯é‡å…¥ã€é˜»å¡žé”ç‰¹æ€§ï¼Œå¯è§£å†³å¤±æ•ˆæ­»é”é—®é¢˜ã€‚ ä½† ZooKeeper å› ä¸ºéœ€è¦é¢‘ç¹çš„åˆ›å»ºå’Œåˆ é™¤èŠ‚ç‚¹ï¼Œæ€§èƒ½ä¸Šä¸å¦‚ Redis æ–¹å¼ã€‚ 1.6. Redis çš„æŒä¹…åŒ–æ–¹å¼ï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼ŸæŒä¹…åŒ–å®žçŽ°åŽŸç†ï¼Ÿ RDB å¿«ç…§ï¼ˆsnapshotï¼‰ å°†å­˜åœ¨äºŽæŸä¸€æ—¶åˆ»çš„æ‰€æœ‰æ•°æ®éƒ½å†™å…¥åˆ°ç¡¬ç›˜ä¸­ã€‚ å¿«ç…§çš„åŽŸç† åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedis å°†æ•°æ®åº“å¿«ç…§ä¿å­˜åœ¨åå­—ä¸º dump.rdb çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚ä½ å¯ä»¥å¯¹ Redis è¿›è¡Œè®¾ç½®ï¼Œ è®©å®ƒåœ¨â€œN ç§’å†…æ•°æ®é›†è‡³å°‘æœ‰ M ä¸ªæ”¹åŠ¨â€è¿™ä¸€æ¡ä»¶è¢«æ»¡è¶³æ—¶ï¼Œ è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡æ•°æ®é›†ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ SAVE æˆ–è€… BGSAVEï¼Œæ‰‹åŠ¨è®© Redis è¿›è¡Œæ•°æ®é›†ä¿å­˜æ“ä½œã€‚è¿™ç§æŒä¹…åŒ–æ–¹å¼è¢«ç§°ä¸ºå¿«ç…§ã€‚ å½“ Redis éœ€è¦ä¿å­˜ dump.rdb æ–‡ä»¶æ—¶ï¼Œ æœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹æ“ä½œ: Redis åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ã€‚ å­è¿›ç¨‹å°†æ•°æ®é›†å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶å¿«ç…§æ–‡ä»¶ä¸­ã€‚ å½“å­è¿›ç¨‹å®Œæˆå¯¹æ–°å¿«ç…§æ–‡ä»¶çš„å†™å…¥æ—¶ï¼ŒRedis ç”¨æ–°å¿«ç…§æ–‡ä»¶æ›¿æ¢åŽŸæ¥çš„å¿«ç…§æ–‡ä»¶ï¼Œå¹¶åˆ é™¤æ—§çš„å¿«ç…§æ–‡ä»¶ã€‚ è¿™ç§å·¥ä½œæ–¹å¼ä½¿å¾— Redis å¯ä»¥ä»Žå†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼‰æœºåˆ¶ä¸­èŽ·ç›Šã€‚ å¿«ç…§çš„ä¼˜ç‚¹ å®ƒä¿å­˜äº†æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®é›†ï¼Œéžå¸¸é€‚ç”¨äºŽæ•°æ®é›†çš„å¤‡ä»½ã€‚ å¾ˆæ–¹ä¾¿ä¼ é€åˆ°å¦ä¸€ä¸ªè¿œç«¯æ•°æ®ä¸­å¿ƒæˆ–è€…äºšé©¬é€Šçš„ S3ï¼ˆå¯èƒ½åŠ å¯†ï¼‰ï¼Œéžå¸¸é€‚ç”¨äºŽç¾éš¾æ¢å¤ã€‚ å¿«ç…§åœ¨ä¿å­˜ RDB æ–‡ä»¶æ—¶çˆ¶è¿›ç¨‹å”¯ä¸€éœ€è¦åšçš„å°±æ˜¯ fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼ŒæŽ¥ä¸‹æ¥çš„å·¥ä½œå…¨éƒ¨ç”±å­è¿›ç¨‹æ¥åšï¼Œçˆ¶è¿›ç¨‹ä¸éœ€è¦å†åšå…¶ä»– IO æ“ä½œï¼Œæ‰€ä»¥å¿«ç…§æŒä¹…åŒ–æ–¹å¼å¯ä»¥æœ€å¤§åŒ– redis çš„æ€§èƒ½ã€‚ ä¸Ž AOF ç›¸æ¯”ï¼Œåœ¨æ¢å¤å¤§çš„æ•°æ®é›†çš„æ—¶å€™ï¼ŒDB æ–¹å¼ä¼šæ›´å¿«ä¸€äº›ã€‚ å¿«ç…§çš„ç¼ºç‚¹ å¦‚æžœä½ å¸Œæœ›åœ¨ redis æ„å¤–åœæ­¢å·¥ä½œï¼ˆä¾‹å¦‚ç”µæºä¸­æ–­ï¼‰çš„æƒ…å†µä¸‹ä¸¢å¤±çš„æ•°æ®æœ€å°‘çš„è¯ï¼Œé‚£ä¹ˆå¿«ç…§ä¸é€‚åˆä½ ã€‚ å¿«ç…§éœ€è¦ç»å¸¸ fork å­è¿›ç¨‹æ¥ä¿å­˜æ•°æ®é›†åˆ°ç¡¬ç›˜ä¸Šã€‚å½“æ•°æ®é›†æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œfork çš„è¿‡ç¨‹æ˜¯éžå¸¸è€—æ—¶çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ Redis åœ¨ä¸€äº›æ¯«ç§’çº§å†…ä¸èƒ½å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ AOF AOF æŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨æ‰§è¡Œçš„å†™æ“ä½œã€‚å½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŽŸå§‹çš„æ•°æ®ã€‚ AOF çš„åŽŸç† Redis åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ã€‚ å­è¿›ç¨‹å¼€å§‹å°†æ–° AOF æ–‡ä»¶çš„å†…å®¹å†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ã€‚ å¯¹äºŽæ‰€æœ‰æ–°æ‰§è¡Œçš„å†™å…¥å‘½ä»¤ï¼Œçˆ¶è¿›ç¨‹ä¸€è¾¹å°†å®ƒä»¬ç´¯ç§¯åˆ°ä¸€ä¸ªå†…å­˜ç¼“å­˜ä¸­ï¼Œä¸€è¾¹å°†è¿™äº›æ”¹åŠ¨è¿½åŠ åˆ°çŽ°æœ‰ AOF æ–‡ä»¶çš„æœ«å°¾ï¼Œè¿™æ ·æ ·å³ä½¿åœ¨é‡å†™çš„ä¸­é€”å‘ç”Ÿåœæœºï¼ŒçŽ°æœ‰çš„ AOF æ–‡ä»¶ä¹Ÿè¿˜æ˜¯å®‰å…¨çš„ã€‚ å½“å­è¿›ç¨‹å®Œæˆé‡å†™å·¥ä½œæ—¶ï¼Œå®ƒç»™çˆ¶è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œçˆ¶è¿›ç¨‹åœ¨æŽ¥æ”¶åˆ°ä¿¡å·ä¹‹åŽï¼Œå°†å†…å­˜ç¼“å­˜ä¸­çš„æ‰€æœ‰æ•°æ®è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶çš„æœ«å°¾ã€‚ æžå®šï¼çŽ°åœ¨ Redis åŽŸå­åœ°ç”¨æ–°æ–‡ä»¶æ›¿æ¢æ—§æ–‡ä»¶ï¼Œä¹‹åŽæ‰€æœ‰å‘½ä»¤éƒ½ä¼šç›´æŽ¥è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶çš„æœ«å°¾ã€‚ AOF çš„ä¼˜ç‚¹ ä½¿ç”¨é»˜è®¤çš„æ¯ç§’ fsync ç­–ç•¥ï¼ŒRedis çš„æ€§èƒ½ä¾ç„¶å¾ˆå¥½(fsync æ˜¯ç”±åŽå°çº¿ç¨‹è¿›è¡Œå¤„ç†çš„,ä¸»çº¿ç¨‹ä¼šå°½åŠ›å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚)ï¼Œä¸€æ—¦å‡ºçŽ°æ•…éšœï¼Œä½¿ç”¨ AOF ï¼Œä½ æœ€å¤šä¸¢å¤± 1 ç§’çš„æ•°æ®ã€‚ AOF æ–‡ä»¶æ˜¯ä¸€ä¸ªåªè¿›è¡Œè¿½åŠ çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸éœ€è¦å†™å…¥ seekï¼Œå³ä½¿ç”±äºŽæŸäº›åŽŸå› (ç£ç›˜ç©ºé—´å·²æ»¡ï¼Œå†™çš„è¿‡ç¨‹ä¸­å®•æœºç­‰ç­‰)æœªæ‰§è¡Œå®Œæ•´çš„å†™å…¥å‘½ä»¤ï¼Œä½ ä¹Ÿä¹Ÿå¯ä½¿ç”¨ redis-check-aof å·¥å…·ä¿®å¤è¿™äº›é—®é¢˜ã€‚ Redis å¯ä»¥åœ¨ AOF æ–‡ä»¶ä½“ç§¯å˜å¾—è¿‡å¤§æ—¶ï¼Œè‡ªåŠ¨åœ°åœ¨åŽå°å¯¹ AOF è¿›è¡Œé‡å†™ï¼šé‡å†™åŽçš„æ–° AOF æ–‡ä»¶åŒ…å«äº†æ¢å¤å½“å‰æ•°æ®é›†æ‰€éœ€çš„æœ€å°å‘½ä»¤é›†åˆã€‚æ•´ä¸ªé‡å†™æ“ä½œæ˜¯ç»å¯¹å®‰å…¨çš„ã€‚ AOF æ–‡ä»¶æœ‰åºåœ°ä¿å­˜äº†å¯¹æ•°æ®åº“æ‰§è¡Œçš„æ‰€æœ‰å†™å…¥æ“ä½œï¼Œè¿™äº›å†™å…¥æ“ä½œä»¥ Redis åè®®çš„æ ¼å¼ä¿å­˜ã€‚å› æ­¤ AOF æ–‡ä»¶çš„å†…å®¹éžå¸¸å®¹æ˜“è¢«äººè¯»æ‡‚ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œåˆ†æžï¼ˆparseï¼‰ä¹Ÿå¾ˆè½»æ¾ã€‚ AOF çš„ç¼ºç‚¹ å¯¹äºŽç›¸åŒçš„æ•°æ®é›†æ¥è¯´ï¼ŒAOF æ–‡ä»¶çš„ä½“ç§¯é€šå¸¸è¦å¤§äºŽ RDB æ–‡ä»¶çš„ä½“ç§¯ã€‚ æ ¹æ®æ‰€ä½¿ç”¨çš„ fsync ç­–ç•¥ï¼ŒAOF çš„é€Ÿåº¦å¯èƒ½ä¼šæ…¢äºŽå¿«ç…§ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ç§’ fsync çš„æ€§èƒ½ä¾ç„¶éžå¸¸é«˜ï¼Œè€Œå…³é—­ fsync å¯ä»¥è®© AOF çš„é€Ÿåº¦å’Œå¿«ç…§ä¸€æ ·å¿«ï¼Œå³ä½¿åœ¨é«˜è´Ÿè·ä¹‹ä¸‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸è¿‡åœ¨å¤„ç†å·¨å¤§çš„å†™å…¥è½½å…¥æ—¶ï¼Œå¿«ç…§å¯ä»¥æä¾›æ›´æœ‰ä¿è¯çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ï¼ˆlatencyï¼‰ã€‚ 1.7. Redis è¿‡æœŸç­–ç•¥æœ‰å“ªäº›ï¼Ÿ noeviction - å½“å†…å­˜ä½¿ç”¨è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œæ‰€æœ‰å¼•èµ·ç”³è¯·å†…å­˜çš„å‘½ä»¤ä¼šæŠ¥é”™ã€‚ allkeys-lru - åœ¨ä¸»é”®ç©ºé—´ä¸­ï¼Œä¼˜å…ˆç§»é™¤æœ€è¿‘æœªä½¿ç”¨çš„ keyã€‚ allkeys-random - åœ¨ä¸»é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ª keyã€‚ volatile-lru - åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œä¼˜å…ˆç§»é™¤æœ€è¿‘æœªä½¿ç”¨çš„ keyã€‚ volatile-random - åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ª keyã€‚ volatile-ttl - åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œå…·æœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„ key ä¼˜å…ˆç§»é™¤ã€‚ 1.8. Redis å’Œ Memcached æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ä¸¤è€…éƒ½æ˜¯éžå…³ç³»åž‹å†…å­˜é”®å€¼æ•°æ®åº“ã€‚æœ‰ä»¥ä¸‹ä¸»è¦ä¸åŒï¼š æ•°æ®ç±»åž‹ Memcached ä»…æ”¯æŒå­—ç¬¦ä¸²ç±»åž‹ï¼› è€Œ Redis æ”¯æŒäº”ç§ä¸åŒç§ç±»çš„æ•°æ®ç±»åž‹ï¼Œä½¿å¾—å®ƒå¯ä»¥æ›´çµæ´»åœ°è§£å†³é—®é¢˜ã€‚ æ•°æ®æŒä¹…åŒ– Memcached ä¸æ”¯æŒæŒä¹…åŒ–ï¼› Redis æ”¯æŒä¸¤ç§æŒä¹…åŒ–ç­–ç•¥ï¼šRDB å¿«ç…§å’Œ AOF æ—¥å¿—ã€‚ åˆ†å¸ƒå¼ Memcached ä¸æ”¯æŒåˆ†å¸ƒå¼ï¼Œåªèƒ½é€šè¿‡åœ¨å®¢æˆ·ç«¯ä½¿ç”¨åƒä¸€è‡´æ€§å“ˆå¸Œè¿™æ ·çš„åˆ†å¸ƒå¼ç®—æ³•æ¥å®žçŽ°åˆ†å¸ƒå¼å­˜å‚¨ï¼Œè¿™ç§æ–¹å¼åœ¨å­˜å‚¨å’ŒæŸ¥è¯¢æ—¶éƒ½éœ€è¦å…ˆåœ¨å®¢æˆ·ç«¯è®¡ç®—ä¸€æ¬¡æ•°æ®æ‰€åœ¨çš„èŠ‚ç‚¹ã€‚ Redis Cluster å®žçŽ°äº†åˆ†å¸ƒå¼çš„æ”¯æŒã€‚ å†…å­˜ç®¡ç†æœºåˆ¶ Memcached å°†å†…å­˜åˆ†å‰²æˆç‰¹å®šé•¿åº¦çš„å—æ¥å­˜å‚¨æ•°æ®ï¼Œä»¥å®Œå…¨è§£å†³å†…å­˜ç¢Žç‰‡çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä¼šä½¿å¾—å†…å­˜çš„åˆ©ç”¨çŽ‡ä¸é«˜ï¼Œä¾‹å¦‚å—çš„å¤§å°ä¸º 128 bytesï¼Œåªå­˜å‚¨ 100 bytes çš„æ•°æ®ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ 28 bytes å°±æµªè´¹æŽ‰äº†ã€‚ åœ¨ Redis ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½ä¸€ç›´å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥å°†ä¸€äº›å¾ˆä¹…æ²¡ç”¨çš„ value äº¤æ¢åˆ°ç£ç›˜ã€‚è€Œ Memcached çš„æ•°æ®åˆ™ä¼šä¸€ç›´åœ¨å†…å­˜ä¸­ã€‚ 1.9. ä¸ºä»€ä¹ˆå•çº¿ç¨‹çš„ Redis æ€§èƒ½åè€Œä¼˜äºŽå¤šçº¿ç¨‹çš„ Memcachedï¼Ÿ Redis å¿«é€Ÿçš„åŽŸå› ï¼š ç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼ˆéžå¸¸å¿«é€Ÿï¼‰ é‡‡ç”¨å•çº¿ç¨‹,é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«žäº‰æ¡ä»¶ éžé˜»å¡ž IO å†…éƒ¨å®žçŽ°é‡‡ç”¨ epollï¼Œé‡‡ç”¨äº† epoll+è‡ªå·±å®žçŽ°çš„ç®€å•çš„äº‹ä»¶æ¡†æž¶ã€‚epoll ä¸­çš„è¯»ã€å†™ã€å…³é—­ã€è¿žæŽ¥éƒ½è½¬åŒ–æˆäº†äº‹ä»¶ï¼Œç„¶åŽåˆ©ç”¨ epoll çš„å¤šè·¯å¤ç”¨ç‰¹æ€§ï¼Œç»ä¸åœ¨ io ä¸Šæµªè´¹ä¸€ç‚¹æ—¶é—´ã€‚ 2. åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰ 2.1. ä¸ºä»€ä¹ˆä½¿ç”¨ MQï¼Ÿ å¼‚æ­¥å¤„ç† - ç›¸æ¯”äºŽä¼ ç»Ÿçš„ä¸²è¡Œã€å¹¶è¡Œæ–¹å¼ï¼Œæé«˜äº†ç³»ç»Ÿåžåé‡ã€‚ åº”ç”¨è§£è€¦ - ç³»ç»Ÿé—´é€šè¿‡æ¶ˆæ¯é€šä¿¡ï¼Œä¸ç”¨å…³å¿ƒå…¶ä»–ç³»ç»Ÿçš„å¤„ç†ã€‚ æµé‡å‰Šé”‹ - å¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦æŽ§åˆ¶è¯·æ±‚é‡ï¼›å¯ä»¥ç¼“è§£çŸ­æ—¶é—´å†…çš„é«˜å¹¶å‘è¯·æ±‚ã€‚ æ—¥å¿—å¤„ç† - è§£å†³å¤§é‡æ—¥å¿—ä¼ è¾“ã€‚ æ¶ˆæ¯é€šè®¯ - æ¶ˆæ¯é˜Ÿåˆ—ä¸€èˆ¬éƒ½å†…ç½®äº†é«˜æ•ˆçš„é€šä¿¡æœºåˆ¶ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç”¨åœ¨çº¯çš„æ¶ˆæ¯é€šè®¯ã€‚æ¯”å¦‚å®žçŽ°ç‚¹å¯¹ç‚¹æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ–è€…èŠå¤©å®¤ç­‰ã€‚ 2.2. å¦‚ä½•ä¿è¯ MQ çš„é«˜å¯ç”¨ï¼Ÿ æ•°æ®å¤åˆ¶ å°†æ‰€æœ‰ Broker å’Œå¾…åˆ†é…çš„ Partition æŽ’åº å°†ç¬¬ i ä¸ª Partition åˆ†é…åˆ°ç¬¬ï¼ˆi mod nï¼‰ä¸ª Broker ä¸Š å°†ç¬¬ i ä¸ª Partition çš„ç¬¬ j ä¸ª Replica åˆ†é…åˆ°ç¬¬ï¼ˆ(i + j) mode nï¼‰ä¸ª Broker ä¸Š é€‰ä¸¾ä¸»æœåŠ¡å™¨ 2.3. MQ æœ‰å“ªäº›å¸¸è§é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ MQ çš„å¸¸è§é—®é¢˜æœ‰ï¼š æ¶ˆæ¯çš„é¡ºåºé—®é¢˜ æ¶ˆæ¯çš„é‡å¤é—®é¢˜ æ¶ˆæ¯çš„é¡ºåºé—®é¢˜ æ¶ˆæ¯æœ‰åºæŒ‡çš„æ˜¯å¯ä»¥æŒ‰ç…§æ¶ˆæ¯çš„å‘é€é¡ºåºæ¥æ¶ˆè´¹ã€‚ å‡å¦‚ç”Ÿäº§è€…äº§ç”Ÿäº† 2 æ¡æ¶ˆæ¯ï¼šM1ã€M2ï¼Œå‡å®š M1 å‘é€åˆ° S1ï¼ŒM2 å‘é€åˆ° S2ï¼Œå¦‚æžœè¦ä¿è¯ M1 å…ˆäºŽ M2 è¢«æ¶ˆè´¹ï¼Œæ€Žä¹ˆåšï¼Ÿ è§£å†³æ–¹æ¡ˆï¼š ï¼ˆ1ï¼‰ä¿è¯ç”Ÿäº§è€… - MQServer - æ¶ˆè´¹è€…æ˜¯ä¸€å¯¹ä¸€å¯¹ä¸€çš„å…³ç³» ç¼ºé™·ï¼š å¹¶è¡Œåº¦å°±ä¼šæˆä¸ºæ¶ˆæ¯ç³»ç»Ÿçš„ç“¶é¢ˆï¼ˆåžåé‡ä¸å¤Ÿï¼‰ æ›´å¤šçš„å¼‚å¸¸å¤„ç†ï¼Œæ¯”å¦‚ï¼šåªè¦æ¶ˆè´¹ç«¯å‡ºçŽ°é—®é¢˜ï¼Œå°±ä¼šå¯¼è‡´æ•´ä¸ªå¤„ç†æµç¨‹é˜»å¡žï¼Œæˆ‘ä»¬ä¸å¾—ä¸èŠ±è´¹æ›´å¤šçš„ç²¾åŠ›æ¥è§£å†³é˜»å¡žçš„é—®é¢˜ã€‚ ï¼ˆ2ï¼‰é€šè¿‡åˆç†çš„è®¾è®¡æˆ–è€…å°†é—®é¢˜åˆ†è§£æ¥è§„é¿ã€‚ ä¸å…³æ³¨ä¹±åºçš„åº”ç”¨å®žé™…å¤§é‡å­˜åœ¨ é˜Ÿåˆ—æ— åºå¹¶ä¸æ„å‘³ç€æ¶ˆæ¯æ— åº æ‰€ä»¥ä»Žä¸šåŠ¡å±‚é¢æ¥ä¿è¯æ¶ˆæ¯çš„é¡ºåºè€Œä¸ä»…ä»…æ˜¯ä¾èµ–äºŽæ¶ˆæ¯ç³»ç»Ÿï¼Œæ˜¯ä¸€ç§æ›´åˆç†çš„æ–¹å¼ã€‚ æ¶ˆæ¯çš„é‡å¤é—®é¢˜ é€ æˆæ¶ˆæ¯é‡å¤çš„æ ¹æœ¬åŽŸå› æ˜¯ï¼šç½‘ç»œä¸å¯è¾¾ã€‚ æ‰€ä»¥è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠžæ³•å°±æ˜¯ç»•è¿‡è¿™ä¸ªé—®é¢˜ã€‚é‚£ä¹ˆé—®é¢˜å°±å˜æˆäº†ï¼šå¦‚æžœæ¶ˆè´¹ç«¯æ”¶åˆ°ä¸¤æ¡ä¸€æ ·çš„æ¶ˆæ¯ï¼Œåº”è¯¥æ€Žæ ·å¤„ç†ï¼Ÿ æ¶ˆè´¹ç«¯å¤„ç†æ¶ˆæ¯çš„ä¸šåŠ¡é€»è¾‘ä¿æŒå¹‚ç­‰æ€§ã€‚åªè¦ä¿æŒå¹‚ç­‰æ€§ï¼Œä¸ç®¡æ¥å¤šå°‘æ¡é‡å¤æ¶ˆæ¯ï¼Œæœ€åŽå¤„ç†çš„ç»“æžœéƒ½ä¸€æ ·ã€‚ ä¿è¯æ¯æ¡æ¶ˆæ¯éƒ½æœ‰å”¯ä¸€ç¼–å·ä¸”ä¿è¯æ¶ˆæ¯å¤„ç†æˆåŠŸä¸ŽåŽ»é‡è¡¨çš„æ—¥å¿—åŒæ—¶å‡ºçŽ°ã€‚åˆ©ç”¨ä¸€å¼ æ—¥å¿—è¡¨æ¥è®°å½•å·²ç»å¤„ç†æˆåŠŸçš„æ¶ˆæ¯çš„ IDï¼Œå¦‚æžœæ–°åˆ°çš„æ¶ˆæ¯ ID å·²ç»åœ¨æ—¥å¿—è¡¨ä¸­ï¼Œé‚£ä¹ˆå°±ä¸å†å¤„ç†è¿™æ¡æ¶ˆæ¯ã€‚ 2.4. Kafka, ActiveMQ, RabbitMQ, RocketMQ å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ 3. åˆ†å¸ƒå¼æœåŠ¡ï¼ˆRPCï¼‰ 3.1. Dubbo çš„å®žçŽ°è¿‡ç¨‹ï¼Ÿ èŠ‚ç‚¹è§’è‰²ï¼š èŠ‚ç‚¹ è§’è‰²è¯´æ˜Ž Provider æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ Consumer è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ Registry æœåŠ¡æ³¨å†Œä¸Žå‘çŽ°çš„æ³¨å†Œä¸­å¿ƒ Monitor ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æŽ§ä¸­å¿ƒ Container æœåŠ¡è¿è¡Œå®¹å™¨ è°ƒç”¨å…³ç³»ï¼š åŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚ æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚ æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚ æ³¨å†Œä¸­å¿ƒè¿”å›žæœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æžœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºŽé•¿è¿žæŽ¥æŽ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚ æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»Žæä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºŽè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æžœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚ æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æŽ§ä¸­å¿ƒã€‚ 3.2. Dubbo è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ Random éšæœºï¼ŒæŒ‰æƒé‡è®¾ç½®éšæœºæ¦‚çŽ‡ã€‚ åœ¨ä¸€ä¸ªæˆªé¢ä¸Šç¢°æ’žçš„æ¦‚çŽ‡é«˜ï¼Œä½†è°ƒç”¨é‡è¶Šå¤§åˆ†å¸ƒè¶Šå‡åŒ€ï¼Œè€Œä¸”æŒ‰æ¦‚çŽ‡ä½¿ç”¨æƒé‡åŽä¹Ÿæ¯”è¾ƒå‡åŒ€ï¼Œæœ‰åˆ©äºŽåŠ¨æ€è°ƒæ•´æä¾›è€…æƒé‡ã€‚ RoundRobin è½®å¾ªï¼ŒæŒ‰å…¬çº¦åŽçš„æƒé‡è®¾ç½®è½®å¾ªæ¯”çŽ‡ã€‚ å­˜åœ¨æ…¢çš„æä¾›è€…ç´¯ç§¯è¯·æ±‚çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šç¬¬äºŒå°æœºå™¨å¾ˆæ…¢ï¼Œä½†æ²¡æŒ‚ï¼Œå½“è¯·æ±‚è°ƒåˆ°ç¬¬äºŒå°æ—¶å°±å¡åœ¨é‚£ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¡åœ¨è°ƒåˆ°ç¬¬äºŒå°ä¸Šã€‚ LeastActive æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°ï¼Œç›¸åŒæ´»è·ƒæ•°çš„éšæœºï¼Œæ´»è·ƒæ•°æŒ‡è°ƒç”¨å‰åŽè®¡æ•°å·®ã€‚ ä½¿æ…¢çš„æä¾›è€…æ”¶åˆ°æ›´å°‘è¯·æ±‚ï¼Œå› ä¸ºè¶Šæ…¢çš„æä¾›è€…çš„è°ƒç”¨å‰åŽè®¡æ•°å·®ä¼šè¶Šå¤§ã€‚ ConsistentHash ä¸€è‡´æ€§ Hashï¼Œç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚ å½“æŸä¸€å°æä¾›è€…æŒ‚æ—¶ï¼ŒåŽŸæœ¬å‘å¾€è¯¥æä¾›è€…çš„è¯·æ±‚ï¼ŒåŸºäºŽè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹³æ‘Šåˆ°å…¶å®ƒæä¾›è€…ï¼Œä¸ä¼šå¼•èµ·å‰§çƒˆå˜åŠ¨ã€‚ ç®—æ³•å‚è§ï¼šhttp://en.wikipedia.org/wiki/Consistent_hashing ç¼ºçœåªå¯¹ç¬¬ä¸€ä¸ªå‚æ•° Hashï¼Œå¦‚æžœè¦ä¿®æ”¹ï¼Œè¯·é…ç½® &lt;dubbo:parameter key=&quot;hash.arguments&quot; value=&quot;0,1&quot; /&gt; ç¼ºçœç”¨ 160 ä»½è™šæ‹ŸèŠ‚ç‚¹ï¼Œå¦‚æžœè¦ä¿®æ”¹ï¼Œè¯·é…ç½® &lt;dubbo:parameter key=&quot;hash.nodes&quot; value=&quot;320&quot; /&gt; 3.3. Dubbo é›†ç¾¤å®¹é”™ç­–ç•¥ ï¼Ÿ Failover - å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“å‡ºçŽ°å¤±è´¥ï¼Œé‡è¯•å…¶å®ƒæœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äºŽè¯»æ“ä½œï¼Œä½†é‡è¯•ä¼šå¸¦æ¥æ›´é•¿å»¶è¿Ÿã€‚å¯é€šè¿‡ retries=â€œ2â€ æ¥è®¾ç½®é‡è¯•æ¬¡æ•°(ä¸å«ç¬¬ä¸€æ¬¡)ã€‚ Failfast - å¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥ç«‹å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºŽéžå¹‚ç­‰æ€§çš„å†™æ“ä½œï¼Œæ¯”å¦‚æ–°å¢žè®°å½•ã€‚ Failsafe - å¤±è´¥å®‰å…¨ï¼Œå‡ºçŽ°å¼‚å¸¸æ—¶ï¼Œç›´æŽ¥å¿½ç•¥ã€‚é€šå¸¸ç”¨äºŽå†™å…¥å®¡è®¡æ—¥å¿—ç­‰æ“ä½œã€‚ Failback - å¤±è´¥è‡ªåŠ¨æ¢å¤ï¼ŒåŽå°è®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘ã€‚é€šå¸¸ç”¨äºŽæ¶ˆæ¯é€šçŸ¥æ“ä½œã€‚ Forking - å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›žã€‚é€šå¸¸ç”¨äºŽå®žæ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¯»æ“ä½œï¼Œä½†éœ€è¦æµªè´¹æ›´å¤šæœåŠ¡èµ„æºã€‚å¯é€šè¿‡ forks=â€œ2â€ æ¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°ã€‚ Broadcast - æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…ï¼Œé€ä¸ªè°ƒç”¨ï¼Œä»»æ„ä¸€å°æŠ¥é”™åˆ™æŠ¥é”™ã€‚é€šå¸¸ç”¨äºŽé€šçŸ¥æ‰€æœ‰æä¾›è€…æ›´æ–°ç¼“å­˜æˆ–æ—¥å¿—ç­‰æœ¬åœ°èµ„æºä¿¡æ¯ã€‚ 3.4. åŠ¨æ€ä»£ç†ç­–ç•¥ï¼Ÿ Dubbo ä½œä¸º RPC æ¡†æž¶ï¼Œé¦–å…ˆè¦å®Œæˆçš„å°±æ˜¯è·¨ç³»ç»Ÿï¼Œè·¨ç½‘ç»œçš„æœåŠ¡è°ƒç”¨ã€‚æ¶ˆè´¹æ–¹ä¸Žæä¾›æ–¹éµå¾ªç»Ÿä¸€çš„æŽ¥å£å®šä¹‰ï¼Œæ¶ˆè´¹æ–¹è°ƒç”¨æŽ¥å£æ—¶ï¼ŒDubbo å°†å…¶è½¬æ¢æˆç»Ÿä¸€æ ¼å¼çš„æ•°æ®ç»“æž„ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œæä¾›æ–¹æ ¹æ®è§„åˆ™æ‰¾åˆ°æŽ¥å£å®žçŽ°ï¼Œé€šè¿‡åå°„å®Œæˆè°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆè´¹æ–¹èŽ·å–çš„æ˜¯å¯¹è¿œç¨‹æœåŠ¡çš„ä¸€ä¸ªä»£ç†(Proxy)ï¼Œè€Œæä¾›æ–¹å› ä¸ºè¦æ”¯æŒä¸åŒçš„æŽ¥å£å®žçŽ°ï¼Œéœ€è¦ä¸€ä¸ªåŒ…è£…å±‚(Wrapper)ã€‚è°ƒç”¨çš„è¿‡ç¨‹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š æ¶ˆè´¹æ–¹çš„ Proxy å’Œæä¾›æ–¹çš„ Wrapper å¾—ä»¥è®© Dubbo æž„å»ºå‡ºå¤æ‚ã€ç»Ÿä¸€çš„ä½“ç³»ã€‚è€Œè¿™ç§åŠ¨æ€ä»£ç†ä¸ŽåŒ…è£…ä¹Ÿæ˜¯é€šè¿‡åŸºäºŽ SPI çš„æ’ä»¶æ–¹å¼å®žçŽ°çš„ï¼Œå®ƒçš„æŽ¥å£å°±æ˜¯ProxyFactoryã€‚ @SPI("javassist")public interface ProxyFactory &#123; @Adaptive(&#123;Constants.PROXY_KEY&#125;) &lt;T&gt; T getProxy(Invoker&lt;T&gt; invoker) throws RpcException; @Adaptive(&#123;Constants.PROXY_KEY&#125;) &lt;T&gt; Invoker&lt;T&gt; getInvoker(T proxy, Class&lt;T&gt; type, URL url) throws RpcException;&#125; ProxyFactory æœ‰ä¸¤ç§å®žçŽ°æ–¹å¼ï¼Œä¸€ç§æ˜¯åŸºäºŽ JDK çš„ä»£ç†å®žçŽ°ï¼Œä¸€ç§æ˜¯åŸºäºŽ javassist çš„å®žçŽ°ã€‚ProxyFactory æŽ¥å£ä¸Šå®šä¹‰äº†@SPI(â€œjavassistâ€)ï¼Œé»˜è®¤ä¸º javassist çš„å®žçŽ°ã€‚ 3.5. Dubbo æ”¯æŒå“ªäº›åºåˆ—åŒ–åè®®ï¼ŸHessianï¼ŸHessian çš„æ•°æ®ç»“æž„ï¼Ÿ dubbo åºåˆ—åŒ–ï¼Œé˜¿é‡Œå°šä¸æˆç†Ÿçš„ java åºåˆ—åŒ–å®žçŽ°ã€‚ hessian2 åºåˆ—åŒ–ï¼šhessian æ˜¯ä¸€ç§è·¨è¯­è¨€çš„é«˜æ•ˆäºŒè¿›åˆ¶çš„åºåˆ—åŒ–æ–¹å¼ï¼Œä½†è¿™é‡Œå®žé™…ä¸æ˜¯åŽŸç”Ÿçš„ hessian2 åºåˆ—åŒ–ï¼Œè€Œæ˜¯é˜¿é‡Œä¿®æ”¹è¿‡çš„ hessian liteï¼Œå®ƒæ˜¯ dubbo RPC é»˜è®¤å¯ç”¨çš„åºåˆ—åŒ–æ–¹å¼ã€‚ json åºåˆ—åŒ–ï¼šç›®å‰æœ‰ä¸¤ç§å®žçŽ°ï¼Œä¸€ç§æ˜¯é‡‡ç”¨çš„é˜¿é‡Œçš„ fastjson åº“ï¼Œå¦ä¸€ç§æ˜¯é‡‡ç”¨ dubbo ä¸­è‡ªå·²å®žçŽ°çš„ç®€å• json åº“ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œjson è¿™ç§æ–‡æœ¬åºåˆ—åŒ–æ€§èƒ½ä¸å¦‚äºŒè¿›åˆ¶åºåˆ—åŒ–ã€‚ java åºåˆ—åŒ–ï¼šä¸»è¦æ˜¯é‡‡ç”¨ JDK è‡ªå¸¦çš„ java åºåˆ—åŒ–å®žçŽ°ï¼Œæ€§èƒ½å¾ˆä¸ç†æƒ³ã€‚ Kryo å’Œ FSTï¼šKryo å’Œ FST çš„æ€§èƒ½ä¾ç„¶æ™®éä¼˜äºŽ hessian å’Œ dubbo åºåˆ—åŒ–ã€‚ Hessian åºåˆ—åŒ–ä¸Ž Java é»˜è®¤çš„åºåˆ—åŒ–åŒºåˆ«ï¼Ÿ Hessian æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ remoting on http å·¥å…·ï¼Œé‡‡ç”¨çš„æ˜¯ Binary RPC åè®®ï¼Œæ‰€ä»¥å®ƒå¾ˆé€‚åˆäºŽå‘é€äºŒè¿›åˆ¶æ•°æ®ï¼ŒåŒæ—¶åˆå…·æœ‰é˜²ç«å¢™ç©¿é€èƒ½åŠ›ã€‚ Hessian æ”¯æŒè·¨è¯­è¨€ä¸²è¡Œ æ¯” java åºåˆ—åŒ–å…·æœ‰æ›´å¥½çš„æ€§èƒ½å’Œæ˜“ç”¨æ€§ æ”¯æŒçš„è¯­è¨€æ¯”è¾ƒå¤š 3.6. Protoco Buffer æ˜¯ä»€ä¹ˆï¼Ÿ Protocol Buffer æ˜¯ Google å‡ºå“çš„ä¸€ç§è½»é‡ &amp; é«˜æ•ˆçš„ç»“æž„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œæ€§èƒ½æ¯” Jsonã€XML çœŸçš„å¼ºï¼å¤ªï¼å¤šï¼ Protocol Buffer çš„åºåˆ—åŒ– &amp; ååºåˆ—åŒ–ç®€å• &amp; é€Ÿåº¦å¿«çš„åŽŸå› æ˜¯ï¼š ç¼–ç  / è§£ç  æ–¹å¼ç®€å•ï¼ˆåªéœ€è¦ç®€å•çš„æ•°å­¦è¿ç®— = ä½ç§»ç­‰ç­‰ï¼‰ é‡‡ç”¨ Protocol Buffer è‡ªèº«çš„æ¡†æž¶ä»£ç  å’Œ ç¼–è¯‘å™¨ å…±åŒå®Œæˆ Protocol Buffer çš„æ•°æ®åŽ‹ç¼©æ•ˆæžœå¥½ï¼ˆå³åºåˆ—åŒ–åŽçš„æ•°æ®é‡ä½“ç§¯å°ï¼‰çš„åŽŸå› æ˜¯ï¼š é‡‡ç”¨äº†ç‹¬ç‰¹çš„ç¼–ç æ–¹å¼ï¼Œå¦‚ Varintã€Zigzag ç¼–ç æ–¹å¼ç­‰ç­‰ é‡‡ç”¨ T - L - V çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼šå‡å°‘äº†åˆ†éš”ç¬¦çš„ä½¿ç”¨ &amp; æ•°æ®å­˜å‚¨å¾—ç´§å‡‘ 3.7. æ³¨å†Œä¸­å¿ƒæŒ‚äº†å¯ä»¥ç»§ç»­é€šä¿¡å—ï¼Ÿ å¯ä»¥ã€‚Dubbo æ¶ˆè´¹è€…åœ¨åº”ç”¨å¯åŠ¨æ—¶ä¼šä»Žæ³¨å†Œä¸­å¿ƒæ‹‰å–å·²æ³¨å†Œçš„ç”Ÿäº§è€…çš„åœ°å€æŽ¥å£ï¼Œå¹¶ç¼“å­˜åœ¨æœ¬åœ°ã€‚æ¯æ¬¡è°ƒç”¨æ—¶ï¼ŒæŒ‰ç…§æœ¬åœ°å­˜å‚¨çš„åœ°å€è¿›è¡Œè°ƒç”¨ã€‚ 3.8. ZooKeeper åŽŸç†æ˜¯ä»€ä¹ˆï¼ŸZooKeeper æœ‰ä»€ä¹ˆç”¨ï¼Ÿ ZooKeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨åè°ƒç³»ç»Ÿï¼Œå·²ç»ç”¨åˆ°äº†è®¸å¤šåˆ†å¸ƒå¼é¡¹ç›®ä¸­ï¼Œç”¨æ¥å®Œæˆç»Ÿä¸€å‘½åæœåŠ¡ã€çŠ¶æ€åŒæ­¥æœåŠ¡ã€é›†ç¾¤ç®¡ç†ã€åˆ†å¸ƒå¼åº”ç”¨é…ç½®é¡¹çš„ç®¡ç†ç­‰å·¥ä½œã€‚ æ¯ä¸ª Server åœ¨å†…å­˜ä¸­å­˜å‚¨äº†ä¸€ä»½æ•°æ®ï¼› Zookeeper å¯åŠ¨æ—¶ï¼Œå°†ä»Žå®žä¾‹ä¸­é€‰ä¸¾ä¸€ä¸ª leaderï¼ˆPaxos åè®®ï¼‰ï¼› Leader è´Ÿè´£å¤„ç†æ•°æ®æ›´æ–°ç­‰æ“ä½œï¼ˆZab åè®®ï¼‰ï¼› ä¸€ä¸ªæ›´æ–°æ“ä½œæˆåŠŸï¼Œå½“ä¸”ä»…å½“å¤§å¤šæ•° Server åœ¨å†…å­˜ä¸­æˆåŠŸä¿®æ”¹æ•°æ®ã€‚ 3.9. Netty æœ‰ä»€ä¹ˆç”¨ï¼ŸNIO/BIO/AIO æœ‰ä»€ä¹ˆç”¨ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Netty æ˜¯ä¸€ä¸ªâ€œç½‘ç»œé€šè®¯æ¡†æž¶â€ã€‚ Netty è¿›è¡Œäº‹ä»¶å¤„ç†çš„æµç¨‹ã€‚Channelæ˜¯è¿žæŽ¥çš„é€šé“ï¼Œæ˜¯ ChannelEvent çš„äº§ç”Ÿè€…ï¼Œè€ŒChannelPipelineå¯ä»¥ç†è§£ä¸º ChannelHandler çš„é›†åˆã€‚ å‚è€ƒï¼šhttps://github.com/code4craft/netty-learning/blob/master/posts/ch1-overview.md IO çš„æ–¹å¼é€šå¸¸åˆ†ä¸ºå‡ ç§ï¼š åŒæ­¥é˜»å¡žçš„ BIO åŒæ­¥éžé˜»å¡žçš„ NIO å¼‚æ­¥éžé˜»å¡žçš„ AIO åœ¨ä½¿ç”¨åŒæ­¥ I/O çš„ç½‘ç»œåº”ç”¨ä¸­ï¼Œå¦‚æžœè¦åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼Œæˆ–æ˜¯åœ¨å®¢æˆ·ç«¯è¦åŒæ—¶å’Œå¤šä¸ªæœåŠ¡å™¨è¿›è¡Œé€šè®¯ï¼Œå°±å¿…é¡»ä½¿ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†ã€‚ NIO åŸºäºŽ Reactorï¼Œå½“ socket æœ‰æµå¯è¯»æˆ–å¯å†™å…¥ socket æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šç›¸åº”çš„é€šçŸ¥å¼•ç”¨ç¨‹åºè¿›è¡Œå¤„ç†ï¼Œåº”ç”¨å†å°†æµè¯»å–åˆ°ç¼“å†²åŒºæˆ–å†™å…¥æ“ä½œç³»ç»Ÿã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå·²ç»ä¸æ˜¯ä¸€ä¸ªè¿žæŽ¥å°±è¦å¯¹åº”ä¸€ä¸ªå¤„ç†çº¿ç¨‹äº†ï¼Œè€Œæ˜¯æœ‰æ•ˆçš„è¯·æ±‚ï¼Œå¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“è¿žæŽ¥æ²¡æœ‰æ•°æ®æ—¶ï¼Œæ˜¯æ²¡æœ‰å·¥ä½œçº¿ç¨‹æ¥å¤„ç†çš„ã€‚ ä¸Ž NIO ä¸åŒï¼Œå½“è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œåªé¡»ç›´æŽ¥è°ƒç”¨ API çš„ read æˆ– write æ–¹æ³•å³å¯ã€‚è¿™ä¸¤ç§æ–¹æ³•å‡ä¸ºå¼‚æ­¥çš„ï¼Œå¯¹äºŽè¯»æ“ä½œè€Œè¨€ï¼Œå½“æœ‰æµå¯è¯»å–æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†å¯è¯»çš„æµä¼ å…¥ read æ–¹æ³•çš„ç¼“å†²åŒºï¼Œå¹¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼›å¯¹äºŽå†™æ“ä½œè€Œè¨€ï¼Œå½“æ“ä½œç³»ç»Ÿå°† write æ–¹æ³•ä¼ é€’çš„æµå†™å…¥å®Œæ¯•æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸»åŠ¨é€šçŸ¥åº”ç”¨ç¨‹åºã€‚ å³å¯ä»¥ç†è§£ä¸ºï¼Œread/write æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå®ŒæˆåŽä¼šä¸»åŠ¨è°ƒç”¨å›žè°ƒå‡½æ•°ã€‚ å‚è€ƒï¼šhttps://blog.csdn.net/skiof007/article/details/52873421 3.10. ä¸ºä»€ä¹ˆè¦è¿›è¡Œç³»ç»Ÿæ‹†åˆ†ï¼Ÿæ‹†åˆ†ä¸ç”¨ Dubbo å¯ä»¥å—ï¼Ÿ ç³»ç»Ÿæ‹†åˆ†ä»Žèµ„æºè§’åº¦åˆ†ä¸ºï¼šåº”ç”¨æ‹†åˆ†å’Œæ•°æ®åº“æ‹†åˆ†ã€‚ ä»Žé‡‡ç”¨çš„å…ˆåŽé¡ºåºå¯åˆ†ä¸ºï¼šæ°´å¹³æ‰©å±•ã€åž‚ç›´æ‹†åˆ†ã€ä¸šåŠ¡æ‹†åˆ†ã€æ°´å¹³æ‹†åˆ†ã€‚ æ˜¯å¦ä½¿ç”¨æœåŠ¡ä¾æ®å®žé™…ä¸šåŠ¡åœºæ™¯æ¥å†³å®šã€‚ å½“åž‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒï¼Œä½¿å‰ç«¯åº”ç”¨èƒ½æ›´å¿«é€Ÿçš„å“åº”å¤šå˜çš„å¸‚åœºéœ€æ±‚ã€‚æ­¤æ—¶ï¼Œç”¨äºŽæé«˜ä¸šåŠ¡å¤ç”¨åŠæ•´åˆçš„åˆ†å¸ƒå¼æœåŠ¡æ¡†æž¶(RPC)æ˜¯å…³é”®ã€‚ å½“æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå®¹é‡çš„è¯„ä¼°ï¼Œå°æœåŠ¡èµ„æºçš„æµªè´¹ç­‰é—®é¢˜é€æ¸æ˜¾çŽ°ï¼Œæ­¤æ—¶éœ€å¢žåŠ ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒåŸºäºŽè®¿é—®åŽ‹åŠ›å®žæ—¶ç®¡ç†é›†ç¾¤å®¹é‡ï¼Œæé«˜é›†ç¾¤åˆ©ç”¨çŽ‡ã€‚æ­¤æ—¶ï¼Œç”¨äºŽæé«˜æœºå™¨åˆ©ç”¨çŽ‡çš„èµ„æºè°ƒåº¦å’Œæ²»ç†ä¸­å¿ƒ(SOA)æ˜¯å…³é”®ã€‚ 3.11. Dubbo å’Œ Thrift æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Thrift æ˜¯è·¨è¯­è¨€çš„ RPC æ¡†æž¶ã€‚ Dubbo æ”¯æŒæœåŠ¡æ²»ç†ï¼Œè€Œ Thrift ä¸æ”¯æŒã€‚]]></content>
      <categories>
        <category>design</category>
        <category>distributed</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>distributed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼åŸºæœ¬åŽŸç†]]></title>
    <url>%2Fblog%2F2018%2F07%2F09%2Fdesign%2Fdistributed%2Fdistributed-base%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼åŸºæœ¬åŽŸç† ç®€ä»‹ æ€§èƒ½ å¸¸è§çš„æ€§èƒ½æŒ‡æ ‡ï¼š åžåé‡(Throughput) - æ˜¯æŒ‡ç³»ç»Ÿåœ¨å•ä½æ—¶é—´å†…å¤„ç†è¯·æ±‚çš„æ•°é‡ã€‚ å“åº”æ—¶é—´(Response Time, RT) - æ˜¯æŒ‡ç³»ç»Ÿå¯¹è¯·æ±‚ä½œå‡ºå“åº”çš„æ—¶é—´ã€‚ å¹¶å‘ç”¨æˆ·æ•° - æ˜¯æŒ‡ç³»ç»Ÿå¯ä»¥åŒæ—¶æ‰¿è½½çš„æ­£å¸¸å·¥ä½œçš„åœ¨çº¿ç”¨æˆ·æ•°ã€‚ æ¯ç§’æŸ¥è¯¢çŽ‡ï¼ˆQPSï¼‰ - æ˜¯å¯¹ä¸€ä¸ªç‰¹å®šçš„æŸ¥è¯¢æœåŠ¡å™¨åœ¨è§„å®šæ—¶é—´å†…æ‰€å¤„ç†æµé‡å¤šå°‘çš„è¡¡é‡æ ‡å‡†ã€‚åœ¨å› ç‰¹ç½‘ä¸Šï¼Œä½œä¸ºåŸŸåç³»ç»ŸæœåŠ¡å™¨çš„æœºå™¨çš„æ€§èƒ½ç»å¸¸ç”¨æ¯ç§’æŸ¥è¯¢çŽ‡æ¥è¡¡é‡ã€‚å¯¹åº” fetches/secï¼Œå³æ¯ç§’çš„å“åº”è¯·æ±‚æ•°ï¼Œä¹Ÿå³æ˜¯æœ€å¤§åžåèƒ½åŠ›ã€‚ æ¯ç§’äº‹åŠ¡æ•°ï¼ˆTransaction Per Second, TPSï¼‰ - è¡¡é‡ç³»ç»Ÿå¤„ç†äº‹åŠ¡æˆ–äº¤æ˜“çš„èƒ½åŠ›ï¼Œå³æœåŠ¡å™¨å¯¹å®¢æˆ·è¯·æ±‚çš„èƒ½åŠ›ï¼Œæ¯ç§’å¤„ç†çš„äº‹åŠ¡æ•°ï¼Œä¸€èˆ¬åœ¨ LoadRunner ä¸Šä½¿ç”¨ï¼Œè®¾ç½®äº‹åŠ¡ï¼Œç„¶åŽç»Ÿè®¡å•ä½æ—¶é—´å†…ç³»ç»Ÿå¯ä»¥æˆåŠŸå®Œæˆå¤šå°‘ä¸ªå®šä¹‰çš„äº‹åŠ¡ã€‚ ç‚¹å‡»é‡ï¼ˆHits Per Secondï¼‰ - æœåŠ¡å™¨æ¯ç§’æ”¶åˆ°çš„ HTTP è¯·æ±‚æ•°ã€‚ QPS = å¹¶å‘é‡ / å¹³å‡å“åº”æ—¶é—´ åžåé‡å’Œå“åº”æ—¶é—´è¿™ä¸¤ä¸ªæŒ‡æ ‡å¾€å¾€æ˜¯çŸ›ç›¾çš„ï¼Œè¿½æ±‚é«˜åžåçš„ç³»ç»Ÿï¼Œå¾€å¾€å¾ˆéš¾åšåˆ°ä½Žå“åº”æ—¶é—´ï¼Œè§£é‡Šå¦‚ä¸‹ï¼š åœ¨æ— å¹¶å‘çš„ç³»ç»Ÿä¸­ï¼Œåžåé‡ä¸ºå“åº”æ—¶é—´çš„å€’æ•°ï¼Œä¾‹å¦‚å“åº”æ—¶é—´ä¸º 10 msï¼Œé‚£ä¹ˆåžåé‡ä¸º 100 req/sï¼Œå› æ­¤é«˜åžåä¹Ÿå°±æ„å‘³ç€ä½Žå“åº”æ—¶é—´ã€‚ ä½†æ˜¯åœ¨å¹¶å‘çš„ç³»ç»Ÿä¸­ï¼Œç”±äºŽä¸€ä¸ªè¯·æ±‚åœ¨è°ƒç”¨ I/O èµ„æºçš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œç­‰å¾…ã€‚æœåŠ¡å™¨ç«¯ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯å¼‚æ­¥ç­‰å¾…æ–¹å¼ï¼Œå³ç­‰å¾…çš„è¯·æ±‚è¢«é˜»å¡žä¹‹åŽä¸éœ€è¦ä¸€ç›´å ç”¨ CPU èµ„æºã€‚è¿™ç§æ–¹å¼èƒ½å¤§å¤§æé«˜ CPU èµ„æºçš„åˆ©ç”¨çŽ‡ï¼Œä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå•ä¸ªè¯·æ±‚åœ¨æ— å¹¶å‘çš„ç³»ç»Ÿä¸­å“åº”æ—¶é—´ä¸º 10 msï¼Œå¦‚æžœåœ¨å¹¶å‘çš„ç³»ç»Ÿä¸­ï¼Œé‚£ä¹ˆåžåé‡å°†å¤§äºŽ 100 req/sã€‚å› æ­¤ä¸ºäº†è¿½æ±‚é«˜åžåé‡ï¼Œé€šå¸¸ä¼šæé«˜å¹¶å‘ç¨‹åº¦ã€‚ä½†æ˜¯å¹¶å‘ç¨‹åº¦çš„å¢žåŠ ï¼Œä¼šå¯¼è‡´è¯·æ±‚çš„å¹³å‡å“åº”æ—¶é—´ä¹Ÿå¢žåŠ ï¼Œå› ä¸ºè¯·æ±‚ä¸èƒ½é©¬ä¸Šè¢«å¤„ç†ï¼Œéœ€è¦å’Œå…¶å®ƒè¯·æ±‚ä¸€èµ·è¿›è¡Œå¹¶å‘å¤„ç†ï¼Œå“åº”æ—¶é—´è‡ªç„¶å°±ä¼šå¢žé«˜ã€‚ å¯ç”¨æ€§ å¯ç”¨æ€§æŒ‡ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡çš„èƒ½åŠ›ã€‚å¯ä»¥ç”¨ç³»ç»Ÿå¯ç”¨æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼æ¥è¡¡é‡ï¼Œ4 ä¸ª 9 çš„å¯ç”¨æ€§è¡¨ç¤ºç³»ç»Ÿ 99.99% çš„æ—¶é—´æ˜¯å¯ç”¨çš„ã€‚ é‡è¦æœ¯è¯­ï¼š å¼‚å¸¸ æœåŠ¡å™¨å®•æœº - å†…å­˜é”™è¯¯ã€æœåŠ¡å™¨åœç”µç­‰éƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨å®•æœºï¼Œæ­¤æ—¶èŠ‚ç‚¹æ— æ³•æ­£å¸¸å·¥ä½œï¼Œç§°ä¸ºä¸å¯ç”¨ã€‚æœåŠ¡å™¨å®•æœºä¼šå¯¼è‡´èŠ‚ç‚¹å¤±åŽ»æ‰€æœ‰å†…å­˜ä¿¡æ¯ï¼Œå› æ­¤éœ€è¦å°†å†…å­˜ä¿¡æ¯ä¿å­˜åˆ°æŒä¹…åŒ–ä»‹è´¨ä¸Šã€‚ ç½‘ç»œå¼‚å¸¸ - æœ‰ä¸€ç§ç‰¹æ®Šçš„ç½‘ç»œå¼‚å¸¸ç§°ä¸ºâ€”â€”ç½‘ç»œåˆ†åŒº ï¼Œå³é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹è¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå†…éƒ¨å¯ä»¥é€šä¿¡ï¼Œä½†æ˜¯åŒºåŸŸä¹‹é—´æ— æ³•é€šä¿¡ã€‚ ç£ç›˜æ•…éšœ - ç£ç›˜æ•…éšœæ˜¯ä¸€ç§å‘ç”Ÿæ¦‚çŽ‡å¾ˆé«˜çš„å¼‚å¸¸ã€‚ä½¿ç”¨å†—ä½™æœºåˆ¶ï¼Œå°†æ•°æ®å­˜å‚¨åˆ°å¤šå°æœåŠ¡å™¨ã€‚ è¶…æ—¶ - åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªè¯·æ±‚é™¤äº†æˆåŠŸå’Œå¤±è´¥ä¸¤ç§çŠ¶æ€ï¼Œè¿˜å­˜åœ¨ç€è¶…æ—¶çŠ¶æ€ã€‚å¯ä»¥å°†æœåŠ¡å™¨çš„æ“ä½œè®¾è®¡ä¸ºå…·æœ‰ å¹‚ç­‰æ€§ ï¼Œå³æ‰§è¡Œå¤šæ¬¡çš„ç»“æžœä¸Žæ‰§è¡Œä¸€æ¬¡çš„ç»“æžœç›¸åŒã€‚å¦‚æžœä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå½“å‡ºçŽ°è¶…æ—¶çš„æ—¶å€™ï¼Œå¯ä»¥ä¸æ–­åœ°é‡æ–°è¯·æ±‚ç›´åˆ°æˆåŠŸã€‚ ä¸€è‡´æ€§ å¯ä»¥ä»Žä¸¤ä¸ªè§’åº¦ç†è§£ä¸€è‡´æ€§ï¼šä»Žå®¢æˆ·ç«¯çš„è§’åº¦ï¼Œè¯»å†™æ“ä½œæ˜¯å¦æ»¡è¶³æŸç§ç‰¹æ€§ï¼›ä»ŽæœåŠ¡å™¨çš„è§’åº¦ï¼Œå¤šä¸ªæ•°æ®å‰¯æœ¬ä¹‹é—´æ˜¯å¦ä¸€è‡´ã€‚ å¯æ‰©å±•æ€§ æŒ‡ç³»ç»Ÿé€šè¿‡æ‰©å±•é›†ç¾¤æœåŠ¡å™¨è§„æ¨¡æ¥æé«˜æ€§èƒ½çš„èƒ½åŠ›ã€‚ç†æƒ³çš„åˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦å®žçŽ°â€œçº¿æ€§å¯æ‰©å±•â€ï¼Œå³éšç€é›†ç¾¤è§„æ¨¡çš„å¢žåŠ ï¼Œç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ä¹Ÿä¼šçº¿æ€§å¢žåŠ ã€‚ æ•°æ®åˆ†å¸ƒ åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿçš„æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸­ï¼Œå¸¸ç”¨çš„æ•°æ®åˆ†å¸ƒæ–¹å¼æœ‰å“ˆå¸Œåˆ†å¸ƒå’Œé¡ºåºåˆ†å¸ƒã€‚ æ•°æ®åº“çš„æ°´å¹³åˆ‡åˆ†ï¼ˆShardingï¼‰ä¹Ÿæ˜¯ä¸€ç§åˆ†å¸ƒå¼å­˜å‚¨æ–¹æ³•ï¼Œä¸‹é¢çš„æ•°æ®åˆ†å¸ƒæ–¹æ³•åŒæ ·é€‚ç”¨äºŽ Shardingã€‚ å“ˆå¸Œåˆ†å¸ƒ å“ˆå¸Œåˆ†å¸ƒå°±æ˜¯å°†æ•°æ®è®¡ç®—å“ˆå¸Œå€¼ä¹‹åŽï¼ŒæŒ‰ç…§å“ˆå¸Œå€¼åˆ†é…åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚ä¾‹å¦‚æœ‰ N ä¸ªèŠ‚ç‚¹ï¼Œæ•°æ®çš„ä¸»é”®ä¸º keyï¼Œåˆ™å°†è¯¥æ•°æ®åˆ†é…çš„èŠ‚ç‚¹åºå·ä¸ºï¼šhash(key)%Nã€‚ ä¼ ç»Ÿçš„å“ˆå¸Œåˆ†å¸ƒç®—æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå½“èŠ‚ç‚¹æ•°é‡å˜åŒ–æ—¶ï¼Œä¹Ÿå°±æ˜¯ N å€¼å˜åŒ–ï¼Œé‚£ä¹ˆå‡ ä¹Žæ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦é‡æ–°åˆ†å¸ƒï¼Œå°†å¯¼è‡´å¤§é‡çš„æ•°æ®è¿ç§»ã€‚ ä¸€è‡´æ€§å“ˆå¸Œ Distributed Hash Tableï¼ˆDHTï¼‰ï¼šå¯¹äºŽå“ˆå¸Œç©ºé—´ [0, 2n-1]ï¼Œå°†è¯¥å“ˆå¸Œç©ºé—´çœ‹æˆä¸€ä¸ªå“ˆå¸ŒçŽ¯ï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹éƒ½é…ç½®åˆ°å“ˆå¸ŒçŽ¯ä¸Šã€‚æ¯ä¸ªæ•°æ®å¯¹è±¡é€šè¿‡å“ˆå¸Œå–æ¨¡å¾—åˆ°å“ˆå¸Œå€¼ä¹‹åŽï¼Œå­˜æ”¾åˆ°å“ˆå¸ŒçŽ¯ä¸­é¡ºæ—¶é’ˆæ–¹å‘ç¬¬ä¸€ä¸ªå¤§äºŽç­‰äºŽè¯¥å“ˆå¸Œå€¼çš„èŠ‚ç‚¹ä¸Šã€‚ ä¸€è‡´æ€§å“ˆå¸Œçš„ä¼˜ç‚¹æ˜¯åœ¨å¢žåŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹æ—¶åªä¼šå½±å“åˆ°å“ˆå¸ŒçŽ¯ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­æ–°å¢žèŠ‚ç‚¹ Xï¼Œåªéœ€è¦å°†æ•°æ®å¯¹è±¡ C é‡æ–°å­˜æ”¾åˆ°èŠ‚ç‚¹ X ä¸Šå³å¯ï¼Œå¯¹äºŽèŠ‚ç‚¹ Aã€Bã€D éƒ½æ²¡æœ‰å½±å“ã€‚ é¡ºåºåˆ†å¸ƒ å“ˆå¸Œåˆ†å¸ƒå¼ç ´åäº†æ•°æ®çš„æœ‰åºæ€§ï¼Œé¡ºåºåˆ†å¸ƒåˆ™ä¸ä¼šã€‚ é¡ºåºåˆ†å¸ƒçš„æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªè¿žç»­çš„éƒ¨åˆ†ï¼ŒæŒ‰æ•°æ®çš„ ID æˆ–è€…æ—¶é—´åˆ†å¸ƒåˆ°ä¸åŒèŠ‚ç‚¹ä¸Šã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒUser è¡¨çš„ ID èŒƒå›´ä¸º 1 ~ 7000ï¼Œä½¿ç”¨é¡ºåºåˆ†å¸ƒå¯ä»¥å°†å…¶åˆ’åˆ†æˆå¤šä¸ªå­è¡¨ï¼Œå¯¹åº”çš„ä¸»é”®èŒƒå›´ä¸º 1 ~ 1000ï¼Œ1001 ~ 2000ï¼Œâ€¦ï¼Œ6001 ~ 7000ã€‚ é¡ºåºåˆ†å¸ƒçš„ä¼˜ç‚¹æ˜¯å¯ä»¥å……åˆ†åˆ©ç”¨æ¯ä¸ªèŠ‚ç‚¹çš„ç©ºé—´ï¼Œè€Œå“ˆå¸Œåˆ†å¸ƒå¾ˆéš¾æŽ§åˆ¶ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨å¤šå°‘æ•°æ®ã€‚ ä½†æ˜¯é¡ºåºåˆ†å¸ƒéœ€è¦ä½¿ç”¨ä¸€ä¸ªæ˜ å°„è¡¨æ¥å­˜å‚¨æ•°æ®åˆ°èŠ‚ç‚¹çš„æ˜ å°„ï¼Œè¿™ä¸ªæ˜ å°„è¡¨é€šå¸¸ä½¿ç”¨å•ç‹¬çš„èŠ‚ç‚¹æ¥å­˜å‚¨ã€‚å½“æ•°æ®é‡éžå¸¸å¤§æ—¶ï¼Œæ˜ å°„è¡¨ä¹Ÿéšç€å˜å¤§ï¼Œé‚£ä¹ˆä¸€ä¸ªèŠ‚ç‚¹å°±å¯èƒ½æ— æ³•å­˜æ”¾ä¸‹æ•´ä¸ªæ˜ å°„è¡¨ã€‚å¹¶ä¸”å•ä¸ªèŠ‚ç‚¹ç»´æŠ¤ç€æ•´ä¸ªæ˜ å°„è¡¨çš„å¼€é”€å¾ˆå¤§ï¼ŒæŸ¥æ‰¾é€Ÿåº¦ä¹Ÿä¼šå˜æ…¢ã€‚ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ä¸ªä¸­é—´å±‚ï¼Œä¹Ÿå°±æ˜¯ Meta è¡¨ï¼Œä»Žè€Œåˆ†æ‹…æ˜ å°„è¡¨çš„ç»´æŠ¤å·¥ä½œã€‚ è´Ÿè½½å‡è¡¡ è¡¡é‡è´Ÿè½½çš„å› ç´ å¾ˆå¤šï¼Œå¦‚ CPUã€å†…å­˜ã€ç£ç›˜ç­‰èµ„æºä½¿ç”¨æƒ…å†µã€è¯»å†™è¯·æ±‚æ•°ç­‰ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿå­˜å‚¨åº”å½“èƒ½å¤Ÿè‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼Œå½“æŸä¸ªèŠ‚ç‚¹çš„è´Ÿè½½è¾ƒé«˜ï¼Œå°†å®ƒçš„éƒ¨åˆ†æ•°æ®è¿ç§»åˆ°å…¶å®ƒèŠ‚ç‚¹ã€‚ æ¯ä¸ªé›†ç¾¤éƒ½æœ‰ä¸€ä¸ªæ€»æŽ§èŠ‚ç‚¹ï¼Œå…¶å®ƒèŠ‚ç‚¹ä¸ºå·¥ä½œèŠ‚ç‚¹ï¼Œç”±æ€»æŽ§èŠ‚ç‚¹æ ¹æ®å…¨å±€è´Ÿè½½ä¿¡æ¯è¿›è¡Œæ•´ä½“è°ƒåº¦ï¼Œå·¥ä½œèŠ‚ç‚¹å®šæ—¶å‘é€å¿ƒè·³åŒ…ï¼ˆHeartbeatï¼‰å°†èŠ‚ç‚¹è´Ÿè½½ç›¸å…³çš„ä¿¡æ¯å‘é€ç»™æ€»æŽ§èŠ‚ç‚¹ã€‚ ä¸€ä¸ªæ–°ä¸Šçº¿çš„å·¥ä½œèŠ‚ç‚¹ï¼Œç”±äºŽå…¶è´Ÿè½½è¾ƒä½Žï¼Œå¦‚æžœä¸åŠ æŽ§åˆ¶ï¼Œæ€»æŽ§èŠ‚ç‚¹ä¼šå°†å¤§é‡æ•°æ®åŒæ—¶è¿ç§»åˆ°è¯¥èŠ‚ç‚¹ä¸Šï¼Œé€ æˆè¯¥èŠ‚ç‚¹ä¸€æ®µæ—¶é—´å†…æ— æ³•å·¥ä½œã€‚å› æ­¤è´Ÿè½½å‡è¡¡æ“ä½œéœ€è¦å¹³æ»‘è¿›è¡Œï¼Œæ–°åŠ å…¥çš„èŠ‚ç‚¹éœ€è¦è¾ƒé•¿çš„ä¸€æ®µæ—¶é—´æ¥è¾¾åˆ°æ¯”è¾ƒå‡è¡¡çš„çŠ¶æ€ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º CAP åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆCï¼šConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAï¼šAvailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼šPartition Toleranceï¼‰ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ã€‚ ï¼ˆä¸€ï¼‰ä¸€è‡´æ€§ ä¸€è‡´æ€§æŒ‡çš„æ˜¯å¤šä¸ªæ•°æ®å‰¯æœ¬æ˜¯å¦èƒ½ä¿æŒä¸€è‡´çš„ç‰¹æ€§ã€‚ åœ¨ä¸€è‡´æ€§çš„æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿåœ¨æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œä¹‹åŽèƒ½å¤Ÿä»Žä¸€è‡´æ€§çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ å¯¹ç³»ç»Ÿçš„ä¸€ä¸ªæ•°æ®æ›´æ–°æˆåŠŸä¹‹åŽï¼Œå¦‚æžœæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½å¤Ÿè¯»å–åˆ°æœ€æ–°çš„å€¼ï¼Œè¯¥ç³»ç»Ÿå°±è¢«è®¤ä¸ºå…·æœ‰å¼ºä¸€è‡´æ€§ã€‚ ï¼ˆäºŒï¼‰å¯ç”¨æ€§ å¯ç”¨æ€§æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡çš„èƒ½åŠ›ï¼Œå¯ä»¥ç”¨ç³»ç»Ÿå¯ç”¨æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼æ¥è¡¡é‡ï¼Œå¦‚ï¼š4 ä¸ª 9 çš„å¯ç”¨æ€§è¡¨ç¤ºç³»ç»Ÿ 99.99% çš„æ—¶é—´æ˜¯å¯ç”¨çš„ã€‚ åœ¨å¯ç”¨æ€§æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿæä¾›çš„æœåŠ¡ä¸€ç›´å¤„äºŽå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºŽç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›žç»“æžœã€‚ ï¼ˆä¸‰ï¼‰åˆ†åŒºå®¹å¿æ€§ ç½‘ç»œåˆ†åŒºæŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹è¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå†…éƒ¨å¯ä»¥é€šä¿¡ï¼Œä½†æ˜¯åŒºåŸŸä¹‹é—´æ— æ³•é€šä¿¡ã€‚ åœ¨åˆ†åŒºå®¹å¿æ€§æ¡ä»¶ä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦èƒ½å¯¹å¤–æä¾›ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éžæ˜¯æ•´ä¸ªç½‘ç»œçŽ¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚ ï¼ˆå››ï¼‰æƒè¡¡ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºå®¹å¿æ€§å¿…ä¸å¯å°‘ï¼Œå› ä¸ºéœ€è¦æ€»æ˜¯å‡è®¾ç½‘ç»œæ˜¯ä¸å¯é çš„ã€‚å› æ­¤ï¼ŒCAP ç†è®ºå®žé™…åœ¨æ˜¯è¦åœ¨å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´åšæƒè¡¡ã€‚ å¯ç”¨æ€§å’Œä¸€è‡´æ€§å¾€å¾€æ˜¯å†²çªçš„ï¼Œå¾ˆéš¾éƒ½ä½¿å®ƒä»¬åŒæ—¶æ»¡è¶³ã€‚åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œ ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼ˆCPï¼‰ï¼Œå°±éœ€è¦è®©æ‰€æœ‰èŠ‚ç‚¹ä¸‹çº¿æˆä¸ºä¸å¯ç”¨çš„çŠ¶æ€ï¼Œç­‰å¾…åŒæ­¥å®Œæˆï¼› ä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼ˆAPï¼‰ï¼Œåœ¨åŒæ­¥è¿‡ç¨‹ä¸­å…è®¸è¯»å–æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å¯èƒ½ä¸ä¸€è‡´ã€‚ BASE BASE æ˜¯åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ã€è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually Consistentï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚ BASE ç†è®ºæ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æžœï¼Œå®ƒçš„ç†è®ºçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚ åŸºæœ¬å¯ç”¨ - æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºçŽ°æ•…éšœçš„æ—¶å€™ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚ä¾‹å¦‚ï¼Œç”µå•†åœ¨åšä¿ƒé”€æ—¶ï¼Œä¸ºäº†ä¿è¯è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§çš„é¡µé¢ã€‚ è½¯çŠ¶æ€ - æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ã€‚å³å…è®¸ç³»ç»Ÿä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡ŒåŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚ æœ€ç»ˆä¸€è‡´æ€§ - æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åŽï¼Œæœ€ç»ˆèƒ½è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚ ACID è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨ä¼ ç»Ÿçš„æ•°æ®åº“ç³»ç»Ÿä¸Šã€‚è€Œ BASE è¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è¾¾åˆ°å¯ç”¨æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨å¤§åž‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚ åœ¨å®žé™…çš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å•å…ƒå’Œç»„ä»¶å¯¹ä¸€è‡´æ€§çš„è¦æ±‚æ˜¯ä¸åŒçš„ï¼Œå› æ­¤ ACID å’Œ BASE å¾€å¾€ä¼šç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚ å…±è¯†æ€§é—®é¢˜ Paxos ç”¨äºŽè¾¾æˆå…±è¯†æ€§é—®é¢˜ï¼Œå³å¯¹å¤šä¸ªèŠ‚ç‚¹äº§ç”Ÿçš„å€¼ï¼Œè¯¥ç®—æ³•èƒ½ä¿è¯åªé€‰å‡ºå”¯ä¸€ä¸€ä¸ªå€¼ã€‚ ä¸»è¦æœ‰ä¸‰ç±»èŠ‚ç‚¹ï¼š æè®®è€…ï¼ˆProposerï¼‰ï¼šæè®®ä¸€ä¸ªå€¼ï¼› æŽ¥å—è€…ï¼ˆAcceptorï¼‰ï¼šå¯¹æ¯ä¸ªæè®®è¿›è¡ŒæŠ•ç¥¨ï¼› å‘ŠçŸ¥è€…ï¼ˆLearnerï¼‰ï¼šè¢«å‘ŠçŸ¥æŠ•ç¥¨çš„ç»“æžœï¼Œä¸å‚ä¸ŽæŠ•ç¥¨è¿‡ç¨‹ã€‚ ç®—æ³•éœ€è¦æ»¡è¶³ safety å’Œ liveness ä¸¤æ–¹é¢çš„çº¦æŸè¦æ±‚ï¼ˆå®žé™…ä¸Šè¿™ä¸¤ä¸ªåŸºç¡€å±žæ€§æ˜¯å¤§éƒ¨åˆ†åˆ†å¸ƒå¼ç®—æ³•éƒ½è¯¥è€ƒè™‘çš„ï¼‰ï¼š safetyï¼šä¿è¯å†³è®®ç»“æžœæ˜¯å¯¹çš„ï¼Œæ— æ­§ä¹‰çš„ï¼Œä¸ä¼šå‡ºçŽ°é”™è¯¯æƒ…å†µã€‚ å†³è®®ï¼ˆvalueï¼‰åªæœ‰åœ¨è¢« proposers æå‡ºçš„ proposal æ‰èƒ½è¢«æœ€ç»ˆæ‰¹å‡†ï¼› åœ¨ä¸€æ¬¡æ‰§è¡Œå®žä¾‹ä¸­ï¼Œåªæ‰¹å‡†ï¼ˆchosenï¼‰ä¸€ä¸ªæœ€ç»ˆå†³è®®ï¼Œæ„å‘³ç€å¤šæ•°æŽ¥å—ï¼ˆacceptï¼‰çš„ç»“æžœèƒ½æˆä¸ºå†³è®®ï¼› livenessï¼šä¿è¯å†³è®®è¿‡ç¨‹èƒ½åœ¨æœ‰é™æ—¶é—´å†…å®Œæˆã€‚ å†³è®®æ€»ä¼šäº§ç”Ÿï¼Œå¹¶ä¸” learners èƒ½èŽ·å¾—è¢«æ‰¹å‡†ï¼ˆchosenï¼‰çš„å†³è®®ã€‚ åŸºæœ¬è¿‡ç¨‹åŒ…æ‹¬ proposer æå‡ºææ¡ˆï¼Œå…ˆäº‰å–å¤§å¤šæ•° acceptor çš„æ”¯æŒï¼Œè¶…è¿‡ä¸€åŠæ”¯æŒæ—¶ï¼Œåˆ™å‘é€ç»“æ¡ˆç»“æžœç»™æ‰€æœ‰äººè¿›è¡Œç¡®è®¤ã€‚ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜æ˜¯ proposer åœ¨æ­¤è¿‡ç¨‹ä¸­å‡ºçŽ°æ•…éšœï¼Œå¯ä»¥é€šè¿‡è¶…æ—¶æœºåˆ¶æ¥è§£å†³ã€‚æžä¸ºå‡‘å·§çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡æ–°çš„ä¸€è½®ææ¡ˆçš„ proposer éƒ½æ°å¥½æ•…éšœï¼Œç³»ç»Ÿåˆ™æ°¸è¿œæ— æ³•è¾¾æˆä¸€è‡´ï¼ˆæ¦‚çŽ‡å¾ˆå°ï¼‰ã€‚ Paxos èƒ½ä¿è¯åœ¨è¶…è¿‡ 1/21/21/2 çš„æ­£å¸¸èŠ‚ç‚¹å­˜åœ¨æ—¶ï¼Œç³»ç»Ÿèƒ½è¾¾æˆå…±è¯†ã€‚ å•ä¸ªææ¡ˆè€…+å¤šæŽ¥æ”¶è€… å¦‚æžœç³»ç»Ÿä¸­é™å®šåªæœ‰æŸä¸ªç‰¹å®šèŠ‚ç‚¹æ˜¯ææ¡ˆè€…ï¼Œé‚£ä¹ˆä¸€è‡´æ€§è‚¯å®šèƒ½è¾¾æˆï¼ˆåªæœ‰ä¸€ä¸ªæ–¹æ¡ˆï¼Œè¦ä¹ˆè¾¾æˆï¼Œè¦ä¹ˆå¤±è´¥ï¼‰ã€‚ææ¡ˆè€…åªè¦æ”¶åˆ°äº†æ¥è‡ªå¤šæ•°æŽ¥æ”¶è€…çš„æŠ•ç¥¨ï¼Œå³å¯è®¤ä¸ºé€šè¿‡ï¼Œå› ä¸ºç³»ç»Ÿä¸­ä¸å­˜åœ¨å…¶ä»–çš„ææ¡ˆã€‚ ä½†ä¸€æ—¦ææ¡ˆè€…æ•…éšœï¼Œåˆ™ç³»ç»Ÿæ— æ³•å·¥ä½œã€‚ å¤šä¸ªææ¡ˆè€…+å•ä¸ªæŽ¥æ”¶è€… é™å®šæŸä¸ªèŠ‚ç‚¹ä½œä¸ºæŽ¥æ”¶è€…ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå…±è¯†ä¹Ÿå¾ˆå®¹æ˜“è¾¾æˆï¼ŒæŽ¥æ”¶è€…æ”¶åˆ°å¤šä¸ªææ¡ˆï¼Œé€‰ç¬¬ä¸€ä¸ªææ¡ˆä½œä¸ºå†³è®®ï¼Œæ‹’ç»æŽ‰åŽç»­çš„ææ¡ˆå³å¯ã€‚ ç¼ºé™·ä¹Ÿæ˜¯å®¹æ˜“å‘ç”Ÿå•ç‚¹æ•…éšœï¼ŒåŒ…æ‹¬æŽ¥æ”¶è€…æ•…éšœæˆ–é¦–ä¸ªææ¡ˆè€…èŠ‚ç‚¹æ•…éšœã€‚ ä»¥ä¸Šä¸¤ç§æƒ…å½¢å…¶å®žç±»ä¼¼ä¸»ä»Žæ¨¡å¼ï¼Œè™½ç„¶ä¸é‚£ä¹ˆå¯é ï¼Œä½†å› ä¸ºåŽŸç†ç®€å•è€Œè¢«å¹¿æ³›é‡‡ç”¨ã€‚ å½“ææ¡ˆè€…å’ŒæŽ¥æ”¶è€…éƒ½æŽ¨å¹¿åˆ°å¤šä¸ªçš„æƒ…å½¢ï¼Œä¼šå‡ºçŽ°ä¸€äº›æŒ‘æˆ˜ã€‚ å¤šä¸ªææ¡ˆè€…+å¤šä¸ªæŽ¥æ”¶è€… æ—¢ç„¶é™å®šå•ææ¡ˆè€…æˆ–å•æŽ¥æ”¶è€…éƒ½ä¼šå‡ºçŽ°æ•…éšœï¼Œé‚£ä¹ˆå°±å¾—å…è®¸å‡ºçŽ°å¤šä¸ªææ¡ˆè€…å’Œå¤šä¸ªæŽ¥æ”¶è€…ã€‚é—®é¢˜ä¸€ä¸‹å­å˜å¾—å¤æ‚äº†ã€‚ ä¸€ç§æƒ…å†µæ˜¯åŒä¸€æ—¶é—´ç‰‡æ®µï¼ˆå¦‚ä¸€ä¸ªææ¡ˆå‘¨æœŸï¼‰å†…åªæœ‰ä¸€ä¸ªææ¡ˆè€…ï¼Œè¿™æ—¶å¯ä»¥é€€åŒ–åˆ°å•ææ¡ˆè€…çš„æƒ…å½¢ã€‚éœ€è¦è®¾è®¡ä¸€ç§æœºåˆ¶æ¥ä¿éšœææ¡ˆè€…çš„æ­£ç¡®äº§ç”Ÿï¼Œä¾‹å¦‚æŒ‰ç…§æ—¶é—´ã€åºåˆ—ã€æˆ–è€…å¤§å®¶çŒœæ‹³ï¼ˆå‡ºä¸€ä¸ªæ•°å­—æ¥æ¯”è¾ƒï¼‰ä¹‹ç±»ã€‚è€ƒè™‘åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿè¦å¤„ç†çš„å·¥ä½œé‡å¾ˆå¤§ï¼Œè¿™ä¸ªè¿‡ç¨‹è¦å°½é‡é«˜æ•ˆï¼Œæ»¡è¶³è¿™ä¸€æ¡ä»¶çš„æœºåˆ¶éžå¸¸éš¾è®¾è®¡ã€‚ å¦ä¸€ç§æƒ…å†µæ˜¯å…è®¸åŒä¸€æ—¶é—´ç‰‡æ®µå†…å¯ä»¥å‡ºçŽ°å¤šä¸ªææ¡ˆè€…ã€‚é‚£åŒä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½æ”¶åˆ°å¤šä»½ææ¡ˆï¼Œæ€Žä¹ˆå¯¹ä»–ä»¬è¿›è¡ŒåŒºåˆ†å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™é‡‡ç”¨åªæŽ¥å—ç¬¬ä¸€ä¸ªææ¡ˆè€Œæ‹’ç»åŽç»­ææ¡ˆçš„æ–¹æ³•ä¹Ÿä¸é€‚ç”¨ã€‚å¾ˆè‡ªç„¶çš„ï¼Œææ¡ˆéœ€è¦å¸¦ä¸Šä¸åŒçš„åºå·ã€‚èŠ‚ç‚¹éœ€è¦æ ¹æ®ææ¡ˆåºå·æ¥åˆ¤æ–­æŽ¥å—å“ªä¸ªã€‚æ¯”å¦‚æŽ¥å—å…¶ä¸­åºå·è¾ƒå¤§ï¼ˆå¾€å¾€æ„å‘³ç€æ˜¯æŽ¥å—æ–°æå‡ºçš„ï¼Œå› ä¸ºæ—§ææ¡ˆè€…æ•…éšœæ¦‚çŽ‡æ›´å¤§ï¼‰çš„ææ¡ˆã€‚ å¦‚ä½•ä¸ºææ¡ˆåˆ†é…åºå·å‘¢ï¼Ÿä¸€ç§å¯èƒ½æ–¹æ¡ˆæ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„ææ¡ˆæ•°å­—åŒºé—´å½¼æ­¤éš”ç¦»å¼€ï¼Œäº’ç›¸ä¸å†²çªã€‚ä¸ºäº†æ»¡è¶³é€’å¢žçš„éœ€æ±‚å¯ä»¥é…åˆç”¨æ—¶é—´æˆ³ä½œä¸ºå‰ç¼€å­—æ®µã€‚ æ­¤å¤–ï¼Œææ¡ˆè€…å³ä¾¿æ”¶åˆ°äº†å¤šæ•°æŽ¥æ”¶è€…çš„æŠ•ç¥¨ï¼Œä¹Ÿä¸æ•¢è¯´å°±ä¸€å®šé€šè¿‡ã€‚å› ä¸ºåœ¨æ­¤è¿‡ç¨‹ä¸­ç³»ç»Ÿå¯èƒ½è¿˜æœ‰å…¶å®ƒçš„ææ¡ˆã€‚ Raft Raft ç®—æ³•æ˜¯ Paxos ç®—æ³•çš„ä¸€ç§ç®€åŒ–å®žçŽ°ã€‚ åŒ…æ‹¬ä¸‰ç§è§’è‰²ï¼šleaderã€candidate å’Œ followerï¼Œå…¶åŸºæœ¬è¿‡ç¨‹ä¸ºï¼š Leader é€‰ä¸¾ - æ¯ä¸ª candidate éšæœºç»è¿‡ä¸€å®šæ—¶é—´éƒ½ä¼šæå‡ºé€‰ä¸¾æ–¹æ¡ˆï¼Œæœ€è¿‘é˜¶æ®µä¸­å¾—ç¥¨æœ€å¤šè€…è¢«é€‰ä¸º leaderï¼› åŒæ­¥ log - leader ä¼šæ‰¾åˆ°ç³»ç»Ÿä¸­ log æœ€æ–°çš„è®°å½•ï¼Œå¹¶å¼ºåˆ¶æ‰€æœ‰çš„ follower æ¥åˆ·æ–°åˆ°è¿™ä¸ªè®°å½•ï¼› æ³¨ï¼šæ­¤å¤„ log å¹¶éžæ˜¯æŒ‡æ—¥å¿—æ¶ˆæ¯ï¼Œè€Œæ˜¯å„ç§äº‹ä»¶çš„å‘ç”Ÿè®°å½•ã€‚ å•ä¸ª Candidate çš„ç«žé€‰ æœ‰ä¸‰ç§èŠ‚ç‚¹ï¼šFollowerã€Candidate å’Œ Leaderã€‚Leader ä¼šå‘¨æœŸæ€§çš„å‘é€å¿ƒè·³åŒ…ç»™ Followerã€‚æ¯ä¸ª Follower éƒ½è®¾ç½®äº†ä¸€ä¸ªéšæœºçš„ç«žé€‰è¶…æ—¶æ—¶é—´ï¼Œä¸€èˆ¬ä¸º 150ms~300msï¼Œå¦‚æžœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ° Leader çš„å¿ƒè·³åŒ…ï¼Œå°±ä¼šå˜æˆ Candidateï¼Œè¿›å…¥ç«žé€‰é˜¶æ®µã€‚ ä¸‹å›¾è¡¨ç¤ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ€åˆé˜¶æ®µï¼Œæ­¤æ—¶åªæœ‰ Followerï¼Œæ²¡æœ‰ Leaderã€‚Follower A ç­‰å¾…ä¸€ä¸ªéšæœºçš„ç«žé€‰è¶…æ—¶æ—¶é—´ä¹‹åŽï¼Œæ²¡æ”¶åˆ° Leader å‘æ¥çš„å¿ƒè·³åŒ…ï¼Œå› æ­¤è¿›å…¥ç«žé€‰é˜¶æ®µã€‚ æ­¤æ—¶ A å‘é€æŠ•ç¥¨è¯·æ±‚ç»™å…¶å®ƒæ‰€æœ‰èŠ‚ç‚¹ã€‚ å…¶å®ƒèŠ‚ç‚¹ä¼šå¯¹è¯·æ±‚è¿›è¡Œå›žå¤ï¼Œå¦‚æžœè¶…è¿‡ä¸€åŠçš„èŠ‚ç‚¹å›žå¤äº†ï¼Œé‚£ä¹ˆè¯¥ Candidate å°±ä¼šå˜æˆ Leaderã€‚ ä¹‹åŽ Leader ä¼šå‘¨æœŸæ€§åœ°å‘é€å¿ƒè·³åŒ…ç»™ Followerï¼ŒFollower æŽ¥æ”¶åˆ°å¿ƒè·³åŒ…ï¼Œä¼šé‡æ–°å¼€å§‹è®¡æ—¶ã€‚ å¤šä¸ª Candidate ç«žé€‰ å¦‚æžœæœ‰å¤šä¸ª Follower æˆä¸º Candidateï¼Œå¹¶ä¸”æ‰€èŽ·å¾—ç¥¨æ•°ç›¸åŒï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°å¼€å§‹æŠ•ç¥¨ï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­ Candidate B å’Œ Candidate D éƒ½èŽ·å¾—ä¸¤ç¥¨ï¼Œå› æ­¤éœ€è¦é‡æ–°å¼€å§‹æŠ•ç¥¨ã€‚ å½“é‡æ–°å¼€å§‹æŠ•ç¥¨æ—¶ï¼Œç”±äºŽæ¯ä¸ªèŠ‚ç‚¹è®¾ç½®çš„éšæœºç«žé€‰è¶…æ—¶æ—¶é—´ä¸åŒï¼Œå› æ­¤èƒ½ä¸‹ä¸€æ¬¡å†æ¬¡å‡ºçŽ°å¤šä¸ª Candidate å¹¶èŽ·å¾—åŒæ ·ç¥¨æ•°çš„æ¦‚çŽ‡å¾ˆä½Žã€‚ åŒæ­¥æ—¥å¿— æ¥è‡ªå®¢æˆ·ç«¯çš„ä¿®æ”¹éƒ½ä¼šè¢«ä¼ å…¥ Leaderã€‚æ³¨æ„è¯¥ä¿®æ”¹è¿˜æœªè¢«æäº¤ï¼Œåªæ˜¯å†™å…¥æ—¥å¿—ä¸­ã€‚ Leader ä¼šæŠŠä¿®æ”¹å¤åˆ¶åˆ°æ‰€æœ‰ Followerã€‚ Leader ä¼šç­‰å¾…å¤§å¤šæ•°çš„ Follower ä¹Ÿè¿›è¡Œäº†ä¿®æ”¹ï¼Œç„¶åŽæ‰å°†ä¿®æ”¹æäº¤ã€‚ æ­¤æ—¶ Leader ä¼šé€šçŸ¥çš„æ‰€æœ‰ Follower è®©å®ƒä»¬ä¹Ÿæäº¤ä¿®æ”¹ï¼Œæ­¤æ—¶æ‰€æœ‰èŠ‚ç‚¹çš„å€¼è¾¾æˆä¸€è‡´ã€‚ å‚è€ƒèµ„æ–™ æ¨ä¼ è¾‰. å¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ: åŽŸç†è§£æžä¸Žæž¶æž„å®žæˆ˜[M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2013. åŒºå—é“¾æŠ€æœ¯æŒ‡å— NEAT ALGORITHMS - PAXOS Raft: Understandable Distributed Consensus Paxos By Example]]></content>
      <categories>
        <category>design</category>
        <category>distributed</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>distributed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼æŠ€æœ¯å®žçŽ°]]></title>
    <url>%2Fblog%2F2018%2F07%2F09%2Fdesign%2Farchitecture%2F%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼æŠ€æœ¯å®žçŽ° 1. åˆ†å¸ƒå¼äº‹åŠ¡ 2. åˆ†å¸ƒå¼é” 2.1. åŸºäºŽæ•°æ®åº“å®žçŽ°åˆ†å¸ƒå¼é” 2.2. åŸºäºŽ Redis å®žçŽ°åˆ†å¸ƒå¼é” 2.3. åŸºäºŽ ZooKeeper å®žçŽ°åˆ†å¸ƒå¼é” 3. åˆ†å¸ƒå¼ Session 3.1. Sticky Sessions 3.2. Session Replication 3.3. Session Server 4. åˆ†å¸ƒå¼å­˜å‚¨ 5. åˆ†å¸ƒå¼ç¼“å­˜ 6. åˆ†å¸ƒå¼è®¡ç®— 7. è´Ÿè½½å‡è¡¡ 7.1. ç®—æ³• 7.2. å®žçŽ° 8. èµ„æ–™ 1. åˆ†å¸ƒå¼äº‹åŠ¡ å‚è€ƒï¼šåˆ†å¸ƒå¼åŽŸç†#4-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ 2. åˆ†å¸ƒå¼é” Java åŽŸç”Ÿ API è™½ç„¶æœ‰å¹¶å‘é”ï¼Œä½†å¹¶æ²¡æœ‰æä¾›åˆ†å¸ƒå¼é”çš„èƒ½åŠ›ï¼Œæ‰€ä»¥é’ˆå¯¹åˆ†å¸ƒå¼åœºæ™¯ä¸­çš„é”éœ€è¦è§£å†³çš„æ–¹æ¡ˆã€‚ åˆ†å¸ƒå¼é”çš„è§£å†³æ–¹æ¡ˆå¤§è‡´æœ‰ä»¥ä¸‹å‡ ç§ï¼š åŸºäºŽæ•°æ®åº“å®žçŽ° åŸºäºŽç¼“å­˜ï¼ˆredisï¼Œmemcached ç­‰ï¼‰å®žçŽ° åŸºäºŽ Zookeeper å®žçŽ° 2.1. åŸºäºŽæ•°æ®åº“å®žçŽ°åˆ†å¸ƒå¼é” å®žçŽ° 1. åˆ›å»ºè¡¨ CREATE TABLE `methodLock` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®', `method_name` varchar(64) NOT NULL DEFAULT '' COMMENT 'é”å®šçš„æ–¹æ³•å', `desc` varchar(1024) NOT NULL DEFAULT 'å¤‡æ³¨ä¿¡æ¯', `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ä¿å­˜æ•°æ®æ—¶é—´ï¼Œè‡ªåŠ¨ç”Ÿæˆ', PRIMARY KEY (`id`), UNIQUE KEY `uidx_method_name` (`method_name `) USING BTREE) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='é”å®šä¸­çš„æ–¹æ³•'; 2. èŽ·å–é” æƒ³è¦é”ä½æŸä¸ªæ–¹æ³•æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹ SQLï¼š insert into methodLock(method_name,desc) values (â€˜method_nameâ€™,â€˜descâ€™) å› ä¸ºæˆ‘ä»¬å¯¹ method_name åšäº†å”¯ä¸€æ€§çº¦æŸï¼Œè¿™é‡Œå¦‚æžœæœ‰å¤šä¸ªè¯·æ±‚åŒæ—¶æäº¤åˆ°æ•°æ®åº“çš„è¯ï¼Œæ•°æ®åº“ä¼šä¿è¯åªæœ‰ä¸€ä¸ªæ“ä½œå¯ä»¥æˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºæ“ä½œæˆåŠŸçš„é‚£ä¸ªçº¿ç¨‹èŽ·å¾—äº†è¯¥æ–¹æ³•çš„é”ï¼Œå¯ä»¥æ‰§è¡Œæ–¹æ³•ä½“å†…å®¹ã€‚ æˆåŠŸæ’å…¥åˆ™èŽ·å–é”ã€‚ 3. é‡Šæ”¾é” å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åŽï¼Œæƒ³è¦é‡Šæ”¾é”çš„è¯ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹ Sql: delete from methodLock where method_name ='method_name' é—®é¢˜ è¿™æŠŠé”å¼ºä¾èµ–æ•°æ®åº“çš„å¯ç”¨æ€§ã€‚å¦‚æžœæ•°æ®åº“æ˜¯ä¸€ä¸ªå•ç‚¹ï¼Œä¸€æ—¦æ•°æ®åº“æŒ‚æŽ‰ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸å¯ç”¨ã€‚ è¿™æŠŠé”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Œä¸€æ—¦è§£é”æ“ä½œå¤±è´¥ï¼Œå°±ä¼šå¯¼è‡´é”è®°å½•ä¸€ç›´åœ¨æ•°æ®åº“ä¸­ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•å†èŽ·å¾—åˆ°é”ã€‚ è¿™æŠŠé”åªèƒ½æ˜¯éžé˜»å¡žçš„ï¼Œå› ä¸ºæ•°æ®çš„ insert æ“ä½œï¼Œä¸€æ—¦æ’å…¥å¤±è´¥å°±ä¼šç›´æŽ¥æŠ¥é”™ã€‚æ²¡æœ‰èŽ·å¾—é”çš„çº¿ç¨‹å¹¶ä¸ä¼šè¿›å…¥æŽ’é˜Ÿé˜Ÿåˆ—ï¼Œè¦æƒ³å†æ¬¡èŽ·å¾—é”å°±è¦å†æ¬¡è§¦å‘èŽ·å¾—é”æ“ä½œã€‚ è¿™æŠŠé”æ˜¯éžé‡å…¥çš„ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰æ— æ³•å†æ¬¡èŽ·å¾—è¯¥é”ã€‚å› ä¸ºæ•°æ®ä¸­æ•°æ®å·²ç»å­˜åœ¨äº†ã€‚ è§£å†³åŠžæ³• å•ç‚¹é—®é¢˜å¯ä»¥ç”¨å¤šæ•°æ®åº“å®žä¾‹ï¼ŒåŒæ—¶å¡ž N ä¸ªè¡¨ï¼ŒN/2+1 ä¸ªæˆåŠŸå°±ä»»åŠ¡é”å®šæˆåŠŸ å†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œéš”ä¸€æ®µæ—¶é—´æ¸…é™¤ä¸€æ¬¡è¿‡æœŸçš„æ•°æ®ã€‚ å†™ä¸€ä¸ª while å¾ªçŽ¯ï¼Œä¸æ–­çš„é‡è¯•æ’å…¥ï¼Œç›´åˆ°æˆåŠŸã€‚ åœ¨æ•°æ®åº“è¡¨ä¸­åŠ ä¸ªå­—æ®µï¼Œè®°å½•å½“å‰èŽ·å¾—é”çš„æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸‹æ¬¡å†èŽ·å–é”çš„æ—¶å€™å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚æžœå½“å‰æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯åœ¨æ•°æ®åº“å¯ä»¥æŸ¥åˆ°çš„è¯ï¼Œç›´æŽ¥æŠŠé”åˆ†é…ç»™ä»–å°±å¯ä»¥äº†ã€‚ å°ç»“ ä¼˜ç‚¹: ç›´æŽ¥å€ŸåŠ©æ•°æ®åº“ï¼Œå®¹æ˜“ç†è§£ã€‚ ç¼ºç‚¹: ä¼šæœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼Œåœ¨è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­ä¼šä½¿æ•´ä¸ªæ–¹æ¡ˆå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚æ“ä½œæ•°æ®åº“éœ€è¦ä¸€å®šçš„å¼€é”€ï¼Œæ€§èƒ½é—®é¢˜éœ€è¦è€ƒè™‘ã€‚ 2.2. åŸºäºŽ Redis å®žçŽ°åˆ†å¸ƒå¼é” ç›¸æ¯”äºŽç”¨æ•°æ®åº“æ¥å®žçŽ°åˆ†å¸ƒå¼é”ï¼ŒåŸºäºŽç¼“å­˜å®žçŽ°çš„åˆ†å¸ƒå¼é”çš„æ€§èƒ½ä¼šæ›´å¥½ä¸€äº›ã€‚ç›®å‰æœ‰å¾ˆå¤šæˆç†Ÿçš„åˆ†å¸ƒå¼äº§å“ï¼ŒåŒ…æ‹¬ Redisã€memcacheã€Tair ç­‰ã€‚è¿™é‡Œä»¥ Redis ä¸¾ä¾‹ã€‚ Redis å‘½ä»¤ setnx - setnx key valï¼šå½“ä¸”ä»…å½“ key ä¸å­˜åœ¨æ—¶ï¼Œset ä¸€ä¸ª key ä¸º val çš„å­—ç¬¦ä¸²ï¼Œè¿”å›ž 1ï¼›è‹¥ key å­˜åœ¨ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œè¿”å›ž 0ã€‚ expire - expire key timeoutï¼šä¸º key è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸º secondï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´é”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…æ­»é”ã€‚ delete - delete keyï¼šåˆ é™¤ key å®žçŽ° å•ç‚¹å®žçŽ°æ­¥éª¤ï¼š èŽ·å–é”çš„ä½¿ç”¨ï¼Œä½¿ç”¨ setnx åŠ é”ï¼Œé”çš„ value å€¼ä¸ºä¸€ä¸ªéšæœºç”Ÿæˆçš„ UUIDï¼Œå†ä½¿ç”¨ expire è®¾ç½®ä¸€ä¸ªè¿‡æœŸå€¼ã€‚ èŽ·å–é”çš„æ—¶å€™è¿˜è®¾ç½®ä¸€ä¸ªèŽ·å–çš„è¶…æ—¶æ—¶é—´ï¼Œè‹¥è¶…è¿‡è¿™ä¸ªæ—¶é—´åˆ™æ”¾å¼ƒèŽ·å–é”ã€‚ é‡Šæ”¾é”çš„æ—¶å€™ï¼Œé€šè¿‡ UUID åˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥é”ï¼Œè‹¥æ˜¯è¯¥é”ï¼Œåˆ™æ‰§è¡Œ delete è¿›è¡Œé”é‡Šæ”¾ã€‚ é—®é¢˜ å•ç‚¹é—®é¢˜ã€‚å¦‚æžœå•æœº redis æŒ‚æŽ‰äº†ï¼Œé‚£ä¹ˆç¨‹åºä¼šè·Ÿç€å‡ºé”™ã€‚ å¦‚æžœè½¬ç§»ä½¿ç”¨ slave èŠ‚ç‚¹ï¼Œå¤åˆ¶ä¸æ˜¯åŒæ­¥å¤åˆ¶ï¼Œä¼šå‡ºçŽ°å¤šä¸ªç¨‹åºèŽ·å–é”çš„æƒ…å†µ å°ç»“ å¯ä»¥è€ƒè™‘ä½¿ç”¨ redisson çš„è§£å†³æ–¹æ¡ˆã€‚ 2.3. åŸºäºŽ ZooKeeper å®žçŽ°åˆ†å¸ƒå¼é” å®žçŽ° è¿™ä¹Ÿæ˜¯ ZooKeeper å®¢æˆ·ç«¯ curator çš„åˆ†å¸ƒå¼é”å®žçŽ°ã€‚ åˆ›å»ºä¸€ä¸ªç›®å½• mylockï¼› çº¿ç¨‹ A æƒ³èŽ·å–é”å°±åœ¨ mylock ç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼› èŽ·å– mylock ç›®å½•ä¸‹æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œç„¶åŽèŽ·å–æ¯”è‡ªå·±å°çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œå¦‚æžœä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜Žå½“å‰çº¿ç¨‹é¡ºåºå·æœ€å°ï¼ŒèŽ·å¾—é”ï¼› çº¿ç¨‹ B èŽ·å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œåˆ¤æ–­è‡ªå·±ä¸æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œè®¾ç½®ç›‘å¬æ¯”è‡ªå·±æ¬¡å°çš„èŠ‚ç‚¹ï¼› çº¿ç¨‹ A å¤„ç†å®Œï¼Œåˆ é™¤è‡ªå·±çš„èŠ‚ç‚¹ï¼Œçº¿ç¨‹ B ç›‘å¬åˆ°å˜æ›´äº‹ä»¶ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œå¦‚æžœæ˜¯åˆ™èŽ·å¾—é”ã€‚ å°ç»“ ZooKeeper ç‰ˆæœ¬çš„åˆ†å¸ƒå¼é”é—®é¢˜ç›¸å¯¹æ¯”è¾ƒæ¥è¯´å°‘ã€‚ é”çš„å ç”¨æ—¶é—´é™åˆ¶ï¼šredis å°±æœ‰å ç”¨æ—¶é—´é™åˆ¶ï¼Œè€Œ ZooKeeper åˆ™æ²¡æœ‰ï¼Œæœ€ä¸»è¦çš„åŽŸå› æ˜¯ redis ç›®å‰æ²¡æœ‰åŠžæ³•çŸ¥é“å·²ç»èŽ·å–é”çš„å®¢æˆ·ç«¯çš„çŠ¶æ€ï¼Œæ˜¯å·²ç»æŒ‚äº†å‘¢è¿˜æ˜¯æ­£åœ¨æ‰§è¡Œè€—æ—¶è¾ƒé•¿çš„ä¸šåŠ¡é€»è¾‘ã€‚è€Œ ZooKeeper é€šè¿‡ä¸´æ—¶èŠ‚ç‚¹å°±èƒ½æ¸…æ™°çŸ¥é“ï¼Œå¦‚æžœä¸´æ—¶èŠ‚ç‚¹å­˜åœ¨è¯´æ˜Žè¿˜åœ¨æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æžœä¸´æ—¶èŠ‚ç‚¹ä¸å­˜åœ¨è¯´æ˜Žå·²ç»æ‰§è¡Œå®Œæ¯•é‡Šæ”¾é”æˆ–è€…æ˜¯æŒ‚äº†ã€‚ç”±æ­¤çœ‹æ¥ redis å¦‚æžœèƒ½åƒ ZooKeeper ä¸€æ ·æ·»åŠ ä¸€äº›ä¸Žå®¢æˆ·ç«¯ç»‘å®šçš„ä¸´æ—¶é”®ï¼Œä¹Ÿæ˜¯ä¸€å¤§å¥½äº‹ã€‚ æ˜¯å¦å•ç‚¹æ•…éšœï¼šredis æœ¬èº«æœ‰å¾ˆå¤šä¸­çŽ©æ³•ï¼Œå¦‚å®¢æˆ·ç«¯ä¸€è‡´æ€§ hashï¼ŒæœåŠ¡å™¨ç«¯ sentinel æ–¹æ¡ˆæˆ–è€… cluster æ–¹æ¡ˆï¼Œå¾ˆéš¾åšåˆ°ä¸€ç§åˆ†å¸ƒå¼é”æ–¹å¼èƒ½åº”å¯¹æ‰€æœ‰è¿™äº›æ–¹æ¡ˆã€‚è€Œ ZooKeeper åªæœ‰ä¸€ç§çŽ©æ³•ï¼Œå¤šå°æœºå™¨çš„èŠ‚ç‚¹æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œæ²¡æœ‰ redis çš„é‚£ä¹ˆå¤šçš„éº»çƒ¦å› ç´ è¦è€ƒè™‘ã€‚ æ€»ä½“ä¸Šæ¥è¯´ ZooKeeper å®žçŽ°åˆ†å¸ƒå¼é”æ›´åŠ çš„ç®€å•ï¼Œå¯é æ€§æ›´é«˜ã€‚ä½† ZooKeeper å› ä¸ºéœ€è¦é¢‘ç¹çš„åˆ›å»ºå’Œåˆ é™¤èŠ‚ç‚¹ï¼Œæ€§èƒ½ä¸Šä¸å¦‚ Redis æ–¹å¼ã€‚ 3. åˆ†å¸ƒå¼ Session åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªç”¨æˆ·çš„ Session å¦‚æžœåªå­˜å‚¨åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆå½“è´Ÿè½½å‡è¡¡å™¨æŠŠç”¨æˆ·çš„ä¸‹ä¸€ä¸ªè¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¯¥æœåŠ¡å™¨æ²¡æœ‰ç”¨æˆ·çš„ Sessionï¼Œå°±å¯èƒ½å¯¼è‡´ç”¨æˆ·éœ€è¦é‡æ–°è¿›è¡Œç™»å½•ç­‰æ“ä½œã€‚ åˆ†å¸ƒå¼ Session çš„å‡ ç§å®žçŽ°ç­–ç•¥ï¼š ç²˜æ€§ session åº”ç”¨æœåŠ¡å™¨é—´çš„ session å¤åˆ¶å…±äº« åŸºäºŽ cache DB ç¼“å­˜çš„ session å…±äº« 3.1. Sticky Sessions éœ€è¦é…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼Œä½¿å¾—ä¸€ä¸ªç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚éƒ½è·¯ç”±åˆ°ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥æŠŠç”¨æˆ·çš„ Session å­˜æ”¾åœ¨è¯¥æœåŠ¡å™¨èŠ‚ç‚¹ä¸­ã€‚ ç¼ºç‚¹ï¼šå½“æœåŠ¡å™¨èŠ‚ç‚¹å®•æœºæ—¶ï¼Œå°†ä¸¢å¤±è¯¥æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ Sessionã€‚ 3.2. Session Replication åœ¨æœåŠ¡å™¨èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œ Session åŒæ­¥æ“ä½œï¼Œè¿™æ ·çš„è¯ç”¨æˆ·å¯ä»¥è®¿é—®ä»»ä½•ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ã€‚ ç¼ºç‚¹ï¼šå ç”¨è¿‡å¤šå†…å­˜ï¼›åŒæ­¥è¿‡ç¨‹å ç”¨ç½‘ç»œå¸¦å®½ä»¥åŠæœåŠ¡å™¨å¤„ç†å™¨æ—¶é—´ã€‚ 3.3. Session Server ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡å™¨å­˜å‚¨ Session æ•°æ®ï¼Œå¯ä»¥å­˜åœ¨ MySQL æ•°æ®åº“ä¸Šï¼Œä¹Ÿå¯ä»¥å­˜åœ¨ Redis æˆ–è€… Memcached è¿™ç§å†…å­˜åž‹æ•°æ®åº“ã€‚ ç¼ºç‚¹ï¼šéœ€è¦åŽ»å®žçŽ°å­˜å– Session çš„ä»£ç ã€‚ 4. åˆ†å¸ƒå¼å­˜å‚¨ é€šå¸¸æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š æ•°æ®åˆ†å¸ƒï¼šå°±æ˜¯æŠŠæ•°æ®åˆ†å—å­˜åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼ˆåˆ†åº“åˆ†è¡¨ï¼‰ã€‚ æ•°æ®å¤åˆ¶ï¼šè®©æ‰€æœ‰çš„æœåŠ¡å™¨éƒ½æœ‰ç›¸åŒçš„æ•°æ®ï¼Œæä¾›ç›¸å½“çš„æœåŠ¡ã€‚ å‚è€ƒï¼šåˆ†å¸ƒå¼åŽŸç†.md#2-æ•°æ®åˆ†å¸ƒ 5. åˆ†å¸ƒå¼ç¼“å­˜ ä½¿ç”¨ç¼“å­˜çš„å¥½å¤„ï¼š æå‡æ•°æ®è¯»å–é€Ÿåº¦ æå‡ç³»ç»Ÿæ‰©å±•èƒ½åŠ›ï¼Œé€šè¿‡æ‰©å±•ç¼“å­˜ï¼Œæå‡ç³»ç»Ÿæ‰¿è½½èƒ½åŠ› é™ä½Žå­˜å‚¨æˆæœ¬ï¼ŒCache+DB çš„æ–¹å¼å¯ä»¥æ‰¿æ‹…åŽŸæœ‰éœ€è¦å¤šå° DB æ‰èƒ½æ‰¿æ‹…çš„è¯·æ±‚é‡ï¼ŒèŠ‚çœæœºå™¨æˆæœ¬ æ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œé€šå¸¸ç¼“å­˜æœ‰ä»¥ä¸‹å‡ ç§ä½¿ç”¨æ–¹å¼ æ‡’æ±‰å¼(è¯»æ—¶è§¦å‘)ï¼šå†™å…¥ DB åŽ, ç„¶åŽæŠŠç›¸å…³çš„æ•°æ®ä¹Ÿå†™å…¥ Cache é¥¥é¥¿å¼(å†™æ—¶è§¦å‘)ï¼šå…ˆæŸ¥è¯¢ DB é‡Œçš„æ•°æ®, ç„¶åŽæŠŠç›¸å…³çš„æ•°æ®å†™å…¥ Cache å®šæœŸåˆ·æ–°ï¼šé€‚åˆå‘¨æœŸæ€§çš„è·‘æ•°æ®çš„ä»»åŠ¡ï¼Œæˆ–è€…åˆ—è¡¨åž‹çš„æ•°æ®ï¼Œè€Œä¸”ä¸è¦æ±‚ç»å¯¹å®žæ—¶æ€§ ç¼“å­˜åˆ†ç±»ï¼š åº”ç”¨å†…ç¼“å­˜ï¼šå¦‚ï¼šEHCache åˆ†å¸ƒå¼ç¼“å­˜ï¼šå¦‚ï¼šMemachedã€Redis å‚è€ƒï¼šåˆ†å¸ƒå¼åŽŸç†.md#6-åˆ†å¸ƒå¼ç¼“å­˜é—®é¢˜ 6. åˆ†å¸ƒå¼è®¡ç®— 7. è´Ÿè½½å‡è¡¡ 7.1. ç®—æ³• è½®è¯¢ï¼ˆRound Robinï¼‰ è½®è¯¢ç®—æ³•æŠŠæ¯ä¸ªè¯·æ±‚è½®æµå‘é€åˆ°æ¯ä¸ªæœåŠ¡å™¨ä¸Šã€‚ä¸‹å›¾ä¸­ï¼Œä¸€å…±æœ‰ 6 ä¸ªå®¢æˆ·ç«¯äº§ç”Ÿäº† 6 ä¸ªè¯·æ±‚ï¼Œè¿™ 6 ä¸ªè¯·æ±‚æŒ‰ (1, 2, 3, 4, 5, 6) çš„é¡ºåºå‘é€ã€‚æœ€åŽï¼Œ(1, 3, 5) çš„è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œ(2, 4, 6) çš„è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 2ã€‚ è¯¥ç®—æ³•æ¯”è¾ƒé€‚åˆæ¯ä¸ªæœåŠ¡å™¨çš„æ€§èƒ½å·®ä¸å¤šçš„åœºæ™¯ï¼Œå¦‚æžœæœ‰æ€§èƒ½å­˜åœ¨å·®å¼‚çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆæ€§èƒ½è¾ƒå·®çš„æœåŠ¡å™¨å¯èƒ½æ— æ³•æ‰¿æ‹…è¿‡å¤§çš„è´Ÿè½½ï¼ˆä¸‹å›¾çš„ Server 2ï¼‰ã€‚ åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robbinï¼‰ åŠ æƒè½®è¯¢æ˜¯åœ¨è½®è¯¢çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ€§èƒ½å·®å¼‚ï¼Œä¸ºæœåŠ¡å™¨èµ‹äºˆä¸€å®šçš„æƒå€¼ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒæœåŠ¡å™¨ 1 è¢«èµ‹äºˆçš„æƒå€¼ä¸º 5ï¼ŒæœåŠ¡å™¨ 2 è¢«èµ‹äºˆçš„æƒå€¼ä¸º 1ï¼Œé‚£ä¹ˆ (1, 2, 3, 4, 5) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œ(6) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 2ã€‚ æœ€å°‘è¿žæŽ¥ï¼ˆleast Connectionsï¼‰ ç”±äºŽæ¯ä¸ªè¯·æ±‚çš„è¿žæŽ¥æ—¶é—´ä¸ä¸€æ ·ï¼Œä½¿ç”¨è½®è¯¢æˆ–è€…åŠ æƒè½®è¯¢ç®—æ³•çš„è¯ï¼Œå¯èƒ½ä¼šè®©ä¸€å°æœåŠ¡å™¨å½“å‰è¿žæŽ¥æ•°è¿‡å¤§ï¼Œè€Œå¦ä¸€å°æœåŠ¡å™¨çš„è¿žæŽ¥è¿‡å°ï¼Œé€ æˆè´Ÿè½½ä¸å‡è¡¡ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼Œ(1, 3, 5) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œä½†æ˜¯ (1, 3) å¾ˆå¿«å°±æ–­å¼€è¿žæŽ¥ï¼Œæ­¤æ—¶åªæœ‰ (5) è¯·æ±‚è¿žæŽ¥æœåŠ¡å™¨ 1ï¼›(2, 4, 6) è¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨ 2ï¼Œåªæœ‰ (2) çš„è¿žæŽ¥æ–­å¼€ã€‚è¯¥ç³»ç»Ÿç»§ç»­è¿è¡Œæ—¶ï¼ŒæœåŠ¡å™¨ 2 ä¼šæ‰¿æ‹…è¿‡å¤§çš„è´Ÿè½½ã€‚ æœ€å°‘è¿žæŽ¥ç®—æ³•å°±æ˜¯å°†è¯·æ±‚å‘é€ç»™å½“å‰æœ€å°‘è¿žæŽ¥æ•°çš„æœåŠ¡å™¨ä¸Šã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒæœåŠ¡å™¨ 1 å½“å‰è¿žæŽ¥æ•°æœ€å°ï¼Œé‚£ä¹ˆæ–°åˆ°æ¥çš„è¯·æ±‚ 6 å°±ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1 ä¸Šã€‚ åŠ æƒæœ€å°‘è¿žæŽ¥ï¼ˆWeighted Least Connectionï¼‰ åœ¨æœ€å°‘è¿žæŽ¥çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ€§èƒ½ä¸ºæ¯å°æœåŠ¡å™¨åˆ†é…æƒé‡ï¼Œå†æ ¹æ®æƒé‡è®¡ç®—å‡ºæ¯å°æœåŠ¡å™¨èƒ½å¤„ç†çš„è¿žæŽ¥æ•°ã€‚ éšæœºç®—æ³•ï¼ˆRandomï¼‰ æŠŠè¯·æ±‚éšæœºå‘é€åˆ°æœåŠ¡å™¨ä¸Šã€‚å’Œè½®è¯¢ç®—æ³•ç±»ä¼¼ï¼Œè¯¥ç®—æ³•æ¯”è¾ƒé€‚åˆæœåŠ¡å™¨æ€§èƒ½å·®ä¸å¤šçš„åœºæ™¯ã€‚ æºåœ°å€å“ˆå¸Œæ³• (IP Hash) æºåœ°å€å“ˆå¸Œé€šè¿‡å¯¹å®¢æˆ·ç«¯ IP å“ˆå¸Œè®¡ç®—å¾—åˆ°çš„ä¸€ä¸ªæ•°å€¼ï¼Œç”¨è¯¥æ•°å€¼å¯¹æœåŠ¡å™¨æ•°é‡è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œå–æ¨¡ç»“æžœä¾¿æ˜¯ç›®æ ‡æœåŠ¡å™¨çš„åºå·ã€‚ ä¼˜ç‚¹ï¼šä¿è¯åŒä¸€ IP çš„å®¢æˆ·ç«¯éƒ½ä¼šè¢« hash åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šã€‚ ç¼ºç‚¹ï¼šä¸åˆ©äºŽé›†ç¾¤æ‰©å±•ï¼ŒåŽå°æœåŠ¡å™¨æ•°é‡å˜æ›´éƒ½ä¼šå½±å“ hash ç»“æžœã€‚å¯ä»¥é‡‡ç”¨ä¸€è‡´æ€§ Hash æ”¹è¿›ã€‚ 7.2. å®žçŽ° HTTP é‡å®šå‘ HTTP é‡å®šå‘è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ”¶åˆ° HTTP è¯·æ±‚ä¹‹åŽä¼šè¿”å›žæœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶å°†è¯¥åœ°å€å†™å…¥ HTTP é‡å®šå‘å“åº”ä¸­è¿”å›žç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æ”¶åˆ°åŽéœ€è¦å†æ¬¡å‘é€è¯·æ±‚ã€‚ ç¼ºç‚¹ï¼š ç”¨æˆ·è®¿é—®çš„å»¶è¿Ÿä¼šå¢žåŠ ï¼› å¦‚æžœè´Ÿè½½å‡è¡¡å™¨å®•æœºï¼Œå°±æ— æ³•è®¿é—®è¯¥ç«™ç‚¹ã€‚ DNS é‡å®šå‘ ä½¿ç”¨ DNS ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œæ ¹æ®è´Ÿè½½æƒ…å†µè¿”å›žä¸åŒæœåŠ¡å™¨çš„ IP åœ°å€ã€‚å¤§åž‹ç½‘ç«™åŸºæœ¬ä½¿ç”¨äº†è¿™ç§æ–¹å¼åšä¸ºç¬¬ä¸€çº§è´Ÿè½½å‡è¡¡æ‰‹æ®µï¼Œç„¶åŽåœ¨å†…éƒ¨ä½¿ç”¨å…¶å®ƒæ–¹å¼åšç¬¬äºŒçº§è´Ÿè½½å‡è¡¡ã€‚ ç¼ºç‚¹ï¼š DNS æŸ¥æ‰¾è¡¨å¯èƒ½ä¼šè¢«å®¢æˆ·ç«¯ç¼“å­˜èµ·æ¥ï¼Œé‚£ä¹ˆä¹‹åŽçš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«é‡å®šå‘åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨ã€‚ ä¿®æ”¹ MAC åœ°å€ ä½¿ç”¨ LVSï¼ˆLinux Virtual Serverï¼‰è¿™ç§é“¾è·¯å±‚è´Ÿè½½å‡è¡¡å™¨ï¼Œæ ¹æ®è´Ÿè½½æƒ…å†µä¿®æ”¹è¯·æ±‚çš„ MAC åœ°å€ã€‚ ä¿®æ”¹ IP åœ°å€ åœ¨ç½‘ç»œå±‚ä¿®æ”¹è¯·æ±‚çš„ç›®çš„ IP åœ°å€ã€‚ ä»£ç†è‡ªåŠ¨é…ç½® æ­£å‘ä»£ç†ä¸Žåå‘ä»£ç†çš„åŒºåˆ«ï¼š æ­£å‘ä»£ç†ï¼šå‘ç”Ÿåœ¨å®¢æˆ·ç«¯ï¼Œæ˜¯ç”±ç”¨æˆ·ä¸»åŠ¨å‘èµ·çš„ã€‚æ¯”å¦‚ç¿»å¢™ï¼Œå®¢æˆ·ç«¯é€šè¿‡ä¸»åŠ¨è®¿é—®ä»£ç†æœåŠ¡å™¨ï¼Œè®©ä»£ç†æœåŠ¡å™¨èŽ·å¾—éœ€è¦çš„å¤–ç½‘æ•°æ®ï¼Œç„¶åŽè½¬å‘å›žå®¢æˆ·ç«¯ã€‚ åå‘ä»£ç†ï¼šå‘ç”Ÿåœ¨æœåŠ¡å™¨ç«¯ï¼Œç”¨æˆ·ä¸çŸ¥é“ä»£ç†çš„å­˜åœ¨ã€‚ PAC æœåŠ¡å™¨æ˜¯ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªè¯·æ±‚æ˜¯å¦è¦ç»è¿‡ä»£ç†ã€‚ 8. èµ„æ–™ https://www.cnblogs.com/savorboard/p/distributed-system-transaction-consistency.html https://github.com/CyC2018/Interview-Notebook/blob/master/notes/åˆ†å¸ƒå¼é—®é¢˜åˆ†æž.md https://www.jianshu.com/p/453c6e7ff81c https://juejin.im/post/5a20cd8bf265da43163cdd9a https://github.com/redisson/redisson/wiki/8.-åˆ†å¸ƒå¼é”å’ŒåŒæ­¥å™¨ https://github.com/L316476844/distributed-session åˆ†å¸ƒå¼ç¼“å­˜æž¶æž„åŸºç¡€ é˜¿é‡Œ P8 æŠ€æœ¯ä¸“å®¶ç»†ç©¶åˆ†å¸ƒå¼ç¼“å­˜é—®é¢˜]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
        <tag>distributed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è´Ÿè½½å‡è¡¡]]></title>
    <url>%2Fblog%2F2018%2F07%2F05%2Fdesign%2Fdistributed%2Fdistributed-load-balance%2F</url>
    <content type="text"><![CDATA[è´Ÿè½½å‡è¡¡ è´Ÿè½½å‡è¡¡åŽŸç† ç³»ç»Ÿçš„æ‰©å±•å¯åˆ†ä¸ºåž‚ç›´æ‰©å±•å’Œæ°´å¹³æ‰©å±•ã€‚ åž‚ç›´æ‰©å±•ï¼Œæ˜¯ä»Žå•æœºçš„è§’åº¦é€šè¿‡å¢žåŠ ç¡¬ä»¶å¤„ç†èƒ½åŠ›ï¼Œæ¯”å¦‚ CPU å¤„ç†èƒ½åŠ›ï¼Œå†…å­˜å®¹é‡ï¼Œç£ç›˜ç­‰æ–¹é¢ï¼Œå®žçŽ°æœåŠ¡å™¨å¤„ç†èƒ½åŠ›çš„æå‡ã€‚è¿™ç§æ–¹å¼ä¸èƒ½æ»¡è¶³å¤§åž‹åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆç½‘ç«™ï¼‰ï¼Œå¤§æµé‡ï¼Œé«˜å¹¶å‘ï¼Œæµ·é‡æ•°æ®çš„é—®é¢˜ã€‚ æ°´å¹³æ‰©å±•ï¼Œæ˜¯é€šè¿‡æ·»åŠ æœºå™¨æ¥æ»¡è¶³å¤§åž‹ç½‘ç«™æœåŠ¡çš„å¤„ç†èƒ½åŠ›ã€‚æ¯”å¦‚ï¼šä¸€å°æœºå™¨ä¸èƒ½æ»¡è¶³ï¼Œåˆ™å¢žåŠ ä¸¤å°æˆ–è€…å¤šå°æœºå™¨ï¼Œå…±åŒæ‰¿æ‹…è®¿é—®åŽ‹åŠ›ã€‚ åº”ç”¨é›†ç¾¤ï¼šå°†åŒä¸€åº”ç”¨éƒ¨ç½²åˆ°å¤šå°æœºå™¨ä¸Šï¼Œç»„æˆå¤„ç†é›†ç¾¤ï¼ŒæŽ¥æ”¶è´Ÿè½½å‡è¡¡è®¾å¤‡åˆ†å‘çš„è¯·æ±‚ï¼Œè¿›è¡Œå¤„ç†ï¼Œå¹¶è¿”å›žç›¸åº”æ•°æ®ã€‚ è´Ÿè½½å‡è¡¡è®¾å¤‡ï¼šå°†ç”¨æˆ·è®¿é—®çš„è¯·æ±‚ï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåˆ†å‘åˆ°é›†ç¾¤ä¸­çš„ä¸€å°å¤„ç†æœåŠ¡å™¨ã€‚ï¼ˆä¸€ç§æŠŠç½‘ç»œè¯·æ±‚åˆ†æ•£åˆ°ä¸€ä¸ªæœåŠ¡å™¨é›†ç¾¤ä¸­çš„å¯ç”¨æœåŠ¡å™¨ä¸ŠåŽ»çš„è®¾å¤‡ï¼‰ è´Ÿè½½å‡è¡¡çš„ä½œç”¨ï¼ˆè§£å†³çš„é—®é¢˜ï¼‰ï¼š è§£å†³å¹¶å‘åŽ‹åŠ›ï¼Œæé«˜åº”ç”¨å¤„ç†æ€§èƒ½ï¼ˆå¢žåŠ åžåé‡ï¼ŒåŠ å¼ºç½‘ç»œå¤„ç†èƒ½åŠ›ï¼‰ï¼› æä¾›æ•…éšœè½¬ç§»ï¼Œå®žçŽ°é«˜å¯ç”¨ï¼› é€šè¿‡æ·»åŠ æˆ–å‡å°‘æœåŠ¡å™¨æ•°é‡ï¼Œæä¾›ç½‘ç«™ä¼¸ç¼©æ€§ï¼ˆæ‰©å±•æ€§ï¼‰ï¼› å®‰å…¨é˜²æŠ¤ï¼›ï¼ˆè´Ÿè½½å‡è¡¡è®¾å¤‡ä¸Šåšä¸€äº›è¿‡æ»¤ï¼Œé»‘ç™½åå•ç­‰å¤„ç†ï¼‰ è´Ÿè½½å‡è¡¡åˆ†ç±» æ ¹æ®å®žçŽ°æŠ€æœ¯ä¸åŒï¼Œå¯åˆ†ä¸ºåå‘ä»£ç†ã€HTTP é‡å®šå‘ã€DNS é‡å®šå‘ã€ä¿®æ”¹ IP åœ°å€ã€ä¿®æ”¹ MAC åœ°å€ç­‰ã€‚ åå‘ä»£ç† æ­£å‘ä»£ç†ä¸Žåå‘ä»£ç†çš„åŒºåˆ«ï¼š æ­£å‘ä»£ç†ï¼šå‘ç”Ÿåœ¨å®¢æˆ·ç«¯ï¼Œæ˜¯ç”±ç”¨æˆ·ä¸»åŠ¨å‘èµ·çš„ã€‚æ¯”å¦‚ç¿»å¢™ï¼Œå®¢æˆ·ç«¯é€šè¿‡ä¸»åŠ¨è®¿é—®ä»£ç†æœåŠ¡å™¨ï¼Œè®©ä»£ç†æœåŠ¡å™¨èŽ·å¾—éœ€è¦çš„å¤–ç½‘æ•°æ®ï¼Œç„¶åŽè½¬å‘å›žå®¢æˆ·ç«¯ã€‚ åå‘ä»£ç†ï¼šå‘ç”Ÿåœ¨æœåŠ¡å™¨ç«¯ï¼Œç”¨æˆ·ä¸çŸ¥é“ä»£ç†çš„å­˜åœ¨ã€‚ åå‘ä»£ç†çš„ä½œç”¨æ˜¯ä¿æŠ¤ç½‘ç«™å®‰å…¨ï¼Œæ‰€æœ‰äº’è”ç½‘çš„è¯·æ±‚éƒ½å¿…é¡»ç»è¿‡ä»£ç†æœåŠ¡å™¨ï¼Œç›¸å½“äºŽåœ¨ web æœåŠ¡å™¨å’Œå¯èƒ½çš„ç½‘ç»œæ”»å‡»ä¹‹é—´å»ºç«‹äº†ä¸€ä¸ªå±éšœã€‚ ä¼˜ç‚¹ï¼šéƒ¨ç½²ç®€å• ç¼ºç‚¹ï¼šå¯èƒ½æˆä¸ºç³»ç»Ÿç“¶é¢ˆ HTTP é‡å®šå‘ HTTP é‡å®šå‘æœåŠ¡å™¨æ”¶åˆ° HTTP è¯·æ±‚ä¹‹åŽä¼šè¿”å›žæœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶å°†è¯¥åœ°å€å†™å…¥ HTTP é‡å®šå‘å“åº”ä¸­è¿”å›žç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æ”¶åˆ°åŽéœ€è¦å†æ¬¡å‘é€è¯·æ±‚ã€‚ ç¼ºç‚¹ï¼š ç”¨æˆ·è®¿é—®çš„å»¶è¿Ÿä¼šå¢žåŠ ï¼› å¦‚æžœè´Ÿè½½å‡è¡¡å™¨å®•æœºï¼Œå°±æ— æ³•è®¿é—®è¯¥ç«™ç‚¹ã€‚ DNS é‡å®šå‘ ä½¿ç”¨ DNS ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œæ ¹æ®è´Ÿè½½æƒ…å†µè¿”å›žä¸åŒæœåŠ¡å™¨çš„ IP åœ°å€ã€‚ å¤§åž‹ç½‘ç«™åŸºæœ¬ä½¿ç”¨äº†è¿™ç§æ–¹å¼åšä¸ºç¬¬ä¸€çº§è´Ÿè½½å‡è¡¡æ‰‹æ®µï¼Œç„¶åŽåœ¨å†…éƒ¨ä½¿ç”¨å…¶å®ƒæ–¹å¼åšç¬¬äºŒçº§è´Ÿè½½å‡è¡¡ã€‚ ä¼˜ç‚¹ï¼š ä½¿ç”¨ç®€å•ï¼šè´Ÿè½½å‡è¡¡å·¥ä½œï¼Œäº¤ç»™ DNS æœåŠ¡å™¨å¤„ç†ï¼ŒçœæŽ‰äº†è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ç»´æŠ¤çš„éº»çƒ¦ æé«˜æ€§èƒ½ï¼šå¯ä»¥æ”¯æŒåŸºäºŽåœ°å€çš„åŸŸåè§£æžï¼Œè§£æžæˆè·ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡å™¨åœ°å€ï¼Œå¯ä»¥åŠ å¿«è®¿é—®é€Ÿåº¦ï¼Œæ”¹å–„æ€§èƒ½ï¼› ç¼ºç‚¹ï¼š å¯ç”¨æ€§å·®ï¼šDNS è§£æžæ˜¯å¤šçº§è§£æžï¼Œæ–°å¢ž/ä¿®æ”¹ DNS åŽï¼Œè§£æžæ—¶é—´è¾ƒé•¿ï¼›è§£æžè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è®¿é—®ç½‘ç«™å°†å¤±è´¥ï¼› æ‰©å±•æ€§ä½Žï¼šDNS è´Ÿè½½å‡è¡¡çš„æŽ§åˆ¶æƒåœ¨åŸŸåå•†é‚£é‡Œï¼Œæ— æ³•å¯¹å…¶åšæ›´å¤šçš„æ”¹å–„å’Œæ‰©å±•ï¼› ç»´æŠ¤æ€§å·®ï¼šä¹Ÿä¸èƒ½åæ˜ æœåŠ¡å™¨çš„å½“å‰è¿è¡ŒçŠ¶æ€ï¼›æ”¯æŒçš„ç®—æ³•å°‘ï¼›ä¸èƒ½åŒºåˆ†æœåŠ¡å™¨çš„å·®å¼‚ï¼ˆä¸èƒ½æ ¹æ®ç³»ç»Ÿä¸ŽæœåŠ¡çš„çŠ¶æ€æ¥åˆ¤æ–­è´Ÿè½½ï¼‰ å»ºè®®ï¼š å°† DNS ä½œä¸ºç¬¬ä¸€çº§è´Ÿè½½å‡è¡¡ï¼ŒA è®°å½•å¯¹åº”ç€å†…éƒ¨è´Ÿè½½å‡è¡¡çš„ IP åœ°å€ï¼Œé€šè¿‡å†…éƒ¨è´Ÿè½½å‡è¡¡å°†è¯·æ±‚åˆ†å‘åˆ°çœŸå®žçš„ Web æœåŠ¡å™¨ä¸Šã€‚ä¸€èˆ¬ç”¨äºŽäº’è”ç½‘å…¬å¸ï¼Œå¤æ‚çš„ä¸šåŠ¡ç³»ç»Ÿä¸åˆé€‚ä½¿ç”¨ã€‚ ä¿®æ”¹ IP åœ°å€ åœ¨ç½‘ç»œå±‚ä¿®æ”¹è¯·æ±‚çš„ç›®çš„ IP åœ°å€æ¥è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ ç”¨æˆ·è¯·æ±‚æ•°æ®åŒ…ï¼Œåˆ°è¾¾è´Ÿè½½å‡è¡¡æœåŠ¡å™¨åŽï¼Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸è¿›ç¨‹èŽ·å–ç½‘ç»œæ•°æ®åŒ…ï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•å¾—åˆ°ä¸€å°çœŸå®žæœåŠ¡å™¨åœ°å€ï¼Œç„¶åŽå°†è¯·æ±‚ç›®çš„åœ°å€ä¿®æ”¹ä¸ºï¼ŒèŽ·å¾—çš„çœŸå®ž ip åœ°å€ï¼Œä¸éœ€è¦ç»è¿‡ç”¨æˆ·è¿›ç¨‹å¤„ç†ã€‚çœŸå®žæœåŠ¡å™¨å¤„ç†å®ŒæˆåŽï¼Œå“åº”æ•°æ®åŒ…å›žåˆ°è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œå†å°†æ•°æ®åŒ…æºåœ°å€ä¿®æ”¹ä¸ºè‡ªèº«çš„ ip åœ°å€ï¼Œå‘é€ç»™ç”¨æˆ·æµè§ˆå™¨ã€‚ IP è´Ÿè½½å‡è¡¡ï¼ŒçœŸå®žç‰©ç†æœåŠ¡å™¨è¿”å›žç»™è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œå­˜åœ¨ä¸¤ç§æ–¹å¼ï¼š è´Ÿè½½å‡è¡¡æœåŠ¡å™¨åœ¨ä¿®æ”¹ç›®çš„ ip åœ°å€çš„åŒæ—¶ä¿®æ”¹æºåœ°å€ã€‚å°†æ•°æ®åŒ…æºåœ°å€è®¾ä¸ºè‡ªèº«ç›˜ï¼Œå³ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ã€‚ å°†è´Ÿè½½å‡è¡¡æœåŠ¡å™¨åŒæ—¶ä½œä¸ºçœŸå®žç‰©ç†æœåŠ¡å™¨é›†ç¾¤çš„ç½‘å…³æœåŠ¡å™¨ã€‚ ä¼˜ç‚¹ï¼šåœ¨å†…æ ¸è¿›ç¨‹å®Œæˆæ•°æ®åˆ†å‘ï¼Œæ¯”åœ¨åº”ç”¨å±‚åˆ†å‘æ€§èƒ½æ›´å¥½ï¼› ç¼ºç‚¹ï¼šæ‰€æœ‰è¯·æ±‚å“åº”éƒ½éœ€è¦ç»è¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œé›†ç¾¤æœ€å¤§åžåé‡å—é™äºŽè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ç½‘å¡å¸¦å®½ï¼› ä¿®æ”¹ MAC åœ°å€ ä½¿ç”¨ LVSï¼ˆLinux Virtual Serverï¼‰è¿™ç§é“¾è·¯å±‚è´Ÿè½½å‡è¡¡å™¨ï¼Œæ ¹æ®è´Ÿè½½æƒ…å†µä¿®æ”¹è¯·æ±‚çš„ MAC åœ°å€ã€‚ å®žé™…å¤„ç†æœåŠ¡å™¨ ip å’Œæ•°æ®è¯·æ±‚ç›®çš„ ip ä¸€è‡´ï¼Œä¸éœ€è¦ç»è¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è¿›è¡Œåœ°å€è½¬æ¢ï¼Œå¯å°†å“åº”æ•°æ®åŒ…ç›´æŽ¥è¿”å›žç»™ç”¨æˆ·æµè§ˆå™¨ï¼Œé¿å…è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ç½‘å¡å¸¦å®½æˆä¸ºç“¶é¢ˆã€‚ä¹Ÿç§°ä¸ºç›´æŽ¥è·¯ç”±æ¨¡å¼ï¼ˆDR æ¨¡å¼ï¼‰ã€‚ ä¼˜ç‚¹ï¼šæ€§èƒ½å¥½ï¼› ç¼ºç‚¹ï¼šé…ç½®å¤æ‚ï¼› å»ºè®®ï¼šDR æ¨¡å¼æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„ä¸€ç§è´Ÿè½½å‡è¡¡æ–¹å¼ã€‚ æ··åˆè´Ÿè½½å‡è¡¡ ç”±äºŽå¤šä¸ªæœåŠ¡å™¨ç¾¤å†…ç¡¬ä»¶è®¾å¤‡ã€å„è‡ªçš„è§„æ¨¡ã€æä¾›çš„æœåŠ¡ç­‰çš„å·®å¼‚ï¼Œå¯ä»¥è€ƒè™‘ç»™æ¯ä¸ªæœåŠ¡å™¨ç¾¤é‡‡ç”¨æœ€åˆé€‚çš„è´Ÿè½½å‡è¡¡æ–¹å¼ï¼Œç„¶åŽåˆåœ¨è¿™å¤šä¸ªæœåŠ¡å™¨ç¾¤é—´å†ä¸€æ¬¡è´Ÿè½½å‡è¡¡æˆ–ç¾¤é›†èµ·æ¥ä»¥ä¸€ä¸ªæ•´ä½“å‘å¤–ç•Œæä¾›æœåŠ¡ï¼ˆå³æŠŠè¿™å¤šä¸ªæœåŠ¡å™¨ç¾¤å½“åšä¸€ä¸ªæ–°çš„æœåŠ¡å™¨ç¾¤ï¼‰ï¼Œä»Žè€Œè¾¾åˆ°æœ€ä½³çš„æ€§èƒ½ã€‚å°†è¿™ç§æ–¹å¼ç§°ä¹‹ä¸ºæ··åˆåž‹è´Ÿè½½å‡è¡¡ã€‚ æ­¤ç§æ–¹å¼æœ‰æ—¶ä¹Ÿç”¨äºŽå•å°å‡è¡¡è®¾å¤‡çš„æ€§èƒ½ä¸èƒ½æ»¡è¶³å¤§é‡è¿žæŽ¥è¯·æ±‚çš„æƒ…å†µä¸‹ã€‚æ˜¯ç›®å‰å¤§åž‹äº’è”ç½‘å…¬å¸ï¼Œæ™®éä½¿ç”¨çš„æ–¹å¼ã€‚ æ–¹å¼ä¸€ï¼Œå¦‚ä¸‹å›¾ï¼š ä»¥ä¸Šæ¨¡å¼é€‚åˆæœ‰åŠ¨é™åˆ†ç¦»çš„åœºæ™¯ï¼Œåå‘ä»£ç†æœåŠ¡å™¨ï¼ˆé›†ç¾¤ï¼‰å¯ä»¥èµ·åˆ°ç¼“å­˜å’ŒåŠ¨æ€è¯·æ±‚åˆ†å‘çš„ä½œç”¨ï¼Œå½“æ—¶é™æ€èµ„æºç¼“å­˜åœ¨ä»£ç†æœåŠ¡å™¨æ—¶ï¼Œåˆ™ç›´æŽ¥è¿”å›žåˆ°æµè§ˆå™¨ã€‚å¦‚æžœåŠ¨æ€é¡µé¢åˆ™è¯·æ±‚åŽé¢çš„åº”ç”¨è´Ÿè½½å‡è¡¡ï¼ˆåº”ç”¨é›†ç¾¤ï¼‰ã€‚ æ–¹å¼äºŒï¼Œå¦‚ä¸‹å›¾ï¼š ä»¥ä¸Šæ¨¡å¼ï¼Œé€‚åˆåŠ¨æ€è¯·æ±‚åœºæ™¯ã€‚ å› æ··åˆæ¨¡å¼ï¼Œå¯ä»¥æ ¹æ®å…·ä½“åœºæ™¯ï¼Œçµæ´»æ­é…å„ç§æ–¹å¼ï¼Œä»¥ä¸Šä¸¤ç§æ–¹å¼ä»…ä¾›å‚è€ƒã€‚ è´Ÿè½½å‡è¡¡ç®—æ³• å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡ç®—æ³•æœ‰ï¼šè½®è¯¢ã€éšæœºã€æœ€å°‘è¿žæŽ¥ã€æºåœ°å€æ•£åˆ—ã€åŠ æƒç­‰æ–¹å¼ã€‚ è½®è¯¢ è½®è¯¢ï¼ˆRound Robinï¼‰ç®—æ³•å°†æ‰€æœ‰è¯·æ±‚ï¼Œä¾æ¬¡åˆ†å‘åˆ°æ¯å°æœåŠ¡å™¨ä¸Šï¼Œé€‚åˆæœåŠ¡å™¨ç¡¬ä»¶åŒç›¸åŒçš„åœºæ™¯ã€‚ ä¼˜ç‚¹ï¼šæœåŠ¡å™¨è¯·æ±‚æ•°ç›®ç›¸åŒï¼› ç¼ºç‚¹ï¼šæœåŠ¡å™¨åŽ‹åŠ›ä¸ä¸€æ ·ï¼Œä¸é€‚åˆæœåŠ¡å™¨é…ç½®ä¸åŒçš„æƒ…å†µï¼› ä¸‹å›¾ä¸­ï¼Œä¸€å…±æœ‰ 6 ä¸ªå®¢æˆ·ç«¯äº§ç”Ÿäº† 6 ä¸ªè¯·æ±‚ï¼Œè¿™ 6 ä¸ªè¯·æ±‚æŒ‰ (1, 2, 3, 4, 5, 6) çš„é¡ºåºå‘é€ã€‚æœ€åŽï¼Œ(1, 3, 5) çš„è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œ(2, 4, 6) çš„è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 2ã€‚ è¯¥ç®—æ³•æ¯”è¾ƒé€‚åˆæ¯ä¸ªæœåŠ¡å™¨çš„æ€§èƒ½å·®ä¸å¤šçš„åœºæ™¯ï¼Œå¦‚æžœæœ‰æ€§èƒ½å­˜åœ¨å·®å¼‚çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆæ€§èƒ½è¾ƒå·®çš„æœåŠ¡å™¨å¯èƒ½æ— æ³•æ‰¿æ‹…è¿‡å¤§çš„è´Ÿè½½ï¼ˆä¸‹å›¾çš„ Server 2ï¼‰ã€‚ ç®—æ³•ç¤ºä¾‹ï¼š private Integer pos = 0;public void roundRobin() &#123; List&lt;String&gt; keyList = new ArrayList&lt;String&gt;(serverMap.keySet()); String server = null; synchronized (pos) &#123; if (pos &gt; keyList.size()) &#123; pos = 0; &#125; server = keyList.get(pos); pos++; &#125; System.out.println(server);&#125; åŠ æƒè½®è¯¢ åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robbinï¼‰ç®—æ³•åœ¨è½®è¯¢ç®—æ³•çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡åŠ æƒçš„æ–¹å¼ï¼Œè¿›è¡Œè´Ÿè½½æœåŠ¡å™¨åˆ†é…ã€‚ ä¼˜ç‚¹ï¼šæ ¹æ®æƒé‡ï¼Œè°ƒèŠ‚è½¬å‘æœåŠ¡å™¨çš„è¯·æ±‚æ•°ç›®ï¼› ç¼ºç‚¹ï¼šä½¿ç”¨ç›¸å¯¹å¤æ‚ï¼› åŠ æƒè½®è¯¢æ˜¯åœ¨è½®è¯¢çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ€§èƒ½å·®å¼‚ï¼Œä¸ºæœåŠ¡å™¨èµ‹äºˆä¸€å®šçš„æƒå€¼ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒæœåŠ¡å™¨ 1 è¢«èµ‹äºˆçš„æƒå€¼ä¸º 5ï¼ŒæœåŠ¡å™¨ 2 è¢«èµ‹äºˆçš„æƒå€¼ä¸º 1ï¼Œé‚£ä¹ˆ (1, 2, 3, 4, 5) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œ(6) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 2ã€‚ ç®—æ³•ç¤ºä¾‹ï¼š public void weightRoundRobin() &#123; Set&lt;String&gt; keySet = serverMap.keySet(); List&lt;String&gt; servers = new ArrayList&lt;String&gt;(); for (Iterator&lt;String&gt; it = keySet.iterator(); it.hasNext(); ) &#123; String server = it.next(); int weithgt = serverMap.get(server); for (int i = 0; i &lt; weithgt; i++) &#123; servers.add(server); &#125; &#125; String server = null; synchronized (pos) &#123; if (pos &gt; keySet.size()) &#123; pos = 0; &#125; server = servers.get(pos); pos++; &#125; System.out.println(server);&#125; æœ€å°‘è¿žæŽ¥ æœ€å°‘è¿žæŽ¥ï¼ˆLeast Busyï¼‰ç®—æ³•å°†è¯·æ±‚åˆ†é…åˆ°è¿žæŽ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ï¼ˆç›®å‰å¤„ç†è¯·æ±‚æœ€å°‘çš„æœåŠ¡å™¨ï¼‰ã€‚ ä¼˜ç‚¹ï¼šæ ¹æ®æœåŠ¡å™¨å½“å‰çš„è¯·æ±‚å¤„ç†æƒ…å†µï¼ŒåŠ¨æ€åˆ†é…ï¼› ç¼ºç‚¹ï¼šç®—æ³•å®žçŽ°ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ç›‘æŽ§æœåŠ¡å™¨è¯·æ±‚è¿žæŽ¥æ•°ï¼› ç”±äºŽæ¯ä¸ªè¯·æ±‚çš„è¿žæŽ¥æ—¶é—´ä¸ä¸€æ ·ï¼Œä½¿ç”¨è½®è¯¢æˆ–è€…åŠ æƒè½®è¯¢ç®—æ³•çš„è¯ï¼Œå¯èƒ½ä¼šè®©ä¸€å°æœåŠ¡å™¨å½“å‰è¿žæŽ¥æ•°è¿‡å¤§ï¼Œè€Œå¦ä¸€å°æœåŠ¡å™¨çš„è¿žæŽ¥è¿‡å°ï¼Œé€ æˆè´Ÿè½½ä¸å‡è¡¡ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼Œ(1, 3, 5) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œä½†æ˜¯ (1, 3) å¾ˆå¿«å°±æ–­å¼€è¿žæŽ¥ï¼Œæ­¤æ—¶åªæœ‰ (5) è¯·æ±‚è¿žæŽ¥æœåŠ¡å™¨ 1ï¼›(2, 4, 6) è¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨ 2ï¼Œåªæœ‰ (2) çš„è¿žæŽ¥æ–­å¼€ã€‚è¯¥ç³»ç»Ÿç»§ç»­è¿è¡Œæ—¶ï¼ŒæœåŠ¡å™¨ 2 ä¼šæ‰¿æ‹…è¿‡å¤§çš„è´Ÿè½½ã€‚ æœ€å°‘è¿žæŽ¥ç®—æ³•å°±æ˜¯å°†è¯·æ±‚å‘é€ç»™å½“å‰æœ€å°‘è¿žæŽ¥æ•°çš„æœåŠ¡å™¨ä¸Šã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒæœåŠ¡å™¨ 1 å½“å‰è¿žæŽ¥æ•°æœ€å°ï¼Œé‚£ä¹ˆæ–°åˆ°æ¥çš„è¯·æ±‚ 6 å°±ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1 ä¸Šã€‚ åŠ æƒæœ€å°‘è¿žæŽ¥ åŠ æƒæœ€å°‘è¿žæŽ¥ï¼ˆWeighted Least Connectionï¼‰åœ¨æœ€å°‘è¿žæŽ¥çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ€§èƒ½ä¸ºæ¯å°æœåŠ¡å™¨åˆ†é…æƒé‡ï¼Œå†æ ¹æ®æƒé‡è®¡ç®—å‡ºæ¯å°æœåŠ¡å™¨èƒ½å¤„ç†çš„è¿žæŽ¥æ•°ã€‚ ### éšæœº éšæœºï¼ˆRandomï¼‰ç®—æ³•å°†è¯·æ±‚éšæœºåˆ†é…åˆ°å„ä¸ªæœåŠ¡å™¨ã€‚ ä¼˜ç‚¹ï¼šä½¿ç”¨ç®€å•ï¼› ç¼ºç‚¹ï¼šä¸é€‚åˆæœºå™¨é…ç½®ä¸åŒçš„åœºæ™¯ï¼› å’Œè½®è¯¢ç®—æ³•ç±»ä¼¼ï¼Œè¯¥ç®—æ³•æ¯”è¾ƒé€‚åˆæœåŠ¡å™¨æ€§èƒ½å·®ä¸å¤šçš„åœºæ™¯ã€‚ å“ˆå¸Œï¼ˆHashï¼‰ æ™®é€š Hash æ ¹æ® IP åœ°å€è¿›è¡Œ Hash è®¡ç®—ï¼Œå¾—åˆ° IP åœ°å€ã€‚ ä¼˜ç‚¹ï¼šå°†æ¥è‡ªåŒä¸€ IP åœ°å€çš„è¯·æ±‚ï¼ŒåŒä¸€ä¼šè¯æœŸå†…ï¼Œè½¬å‘åˆ°ç›¸åŒçš„æœåŠ¡å™¨ï¼›å®žçŽ°ä¼šè¯ç²˜æ»žã€‚ ç¼ºç‚¹ï¼šç›®æ ‡æœåŠ¡å™¨å®•æœºåŽï¼Œä¼šè¯ä¼šä¸¢å¤±ï¼› ç®—æ³•ç¤ºä¾‹ï¼š public void hash() &#123; List&lt;String&gt; keyList = new ArrayList&lt;String&gt;(serverMap.keySet()); String remoteIp = "192.168.2.215"; int hashCode = remoteIp.hashCode(); int idx = hashCode % keyList.size(); String server = keyList.get(Math.abs(idx)); System.out.println(server);&#125; ä¸€è‡´æ€§å“ˆå¸Œ ä¸€è‡´æ€§ Hashï¼Œç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚å½“æŸä¸€å°æä¾›è€…æŒ‚æ—¶ï¼ŒåŽŸæœ¬å‘å¾€è¯¥æä¾›è€…çš„è¯·æ±‚ï¼ŒåŸºäºŽè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹³æ‘Šåˆ°å…¶å®ƒæä¾›è€…ï¼Œä¸ä¼šå¼•èµ·å‰§çƒˆå˜åŠ¨ã€‚ ç¡¬ä»¶è´Ÿè½½å‡è¡¡ é‡‡ç”¨ç¡¬ä»¶çš„æ–¹å¼å®žçŽ°è´Ÿè½½å‡è¡¡ï¼Œä¸€èˆ¬æ˜¯å•ç‹¬çš„è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œä»·æ ¼æ˜‚è´µï¼Œä¸€èˆ¬åœŸè±ªçº§å…¬å¸å¯ä»¥è€ƒè™‘ï¼Œä¸šç•Œé¢†å…ˆçš„æœ‰ä¸¤æ¬¾ï¼ŒF5 å’Œ A10ã€‚ ä½¿ç”¨ç¡¬ä»¶è´Ÿè½½å‡è¡¡ï¼Œä¸»è¦è€ƒè™‘ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š åŠŸèƒ½è€ƒè™‘ï¼šåŠŸèƒ½å…¨é¢æ”¯æŒå„å±‚çº§çš„è´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒå…¨é¢çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæ”¯æŒå…¨å±€è´Ÿè½½å‡è¡¡ï¼› æ€§èƒ½è€ƒè™‘ï¼šä¸€èˆ¬è½¯ä»¶è´Ÿè½½å‡è¡¡æ”¯æŒåˆ° 5 ä¸‡çº§å¹¶å‘å·²ç»å¾ˆå›°éš¾äº†ï¼Œç¡¬ä»¶è´Ÿè½½å‡è¡¡å¯ä»¥æ”¯æŒ ç¨³å®šæ€§ï¼šå•†ç”¨ç¡¬ä»¶è´Ÿè½½å‡è¡¡ï¼Œç»è¿‡äº†è‰¯å¥½çš„ä¸¥æ ¼çš„æµ‹è¯•ï¼Œä»Žç»è¿‡å¤§è§„æ¨¡ä½¿ç”¨ï¼Œåœ¨ç¨³å®šæ€§æ–¹é¢é«˜ï¼› å®‰å…¨é˜²æŠ¤ï¼šç¡¬ä»¶å‡è¡¡è®¾å¤‡é™¤å…·å¤‡è´Ÿè½½å‡è¡¡åŠŸèƒ½å¤–ï¼Œè¿˜å…·å¤‡é˜²ç«å¢™ï¼Œé˜² DDOS æ”»å‡»ç­‰å®‰å…¨åŠŸèƒ½ï¼› ç»´æŠ¤è§’åº¦ï¼šæä¾›è‰¯å¥½çš„ç»´æŠ¤ç®¡ç†ç•Œé¢ï¼Œå”®åŽæœåŠ¡å’ŒæŠ€æœ¯æ”¯æŒï¼› åœŸè±ªå…¬å¸ï¼šF5 Big Ip ä»·æ ¼ï¼š15w~55w ä¸ç­‰ï¼›A10 ä»·æ ¼ï¼š55w-100w ä¸ç­‰ï¼› ç¼ºç‚¹ ä»·æ ¼æ˜‚è´µï¼› æ‰©å±•èƒ½åŠ›å·®ï¼› å°ç»“ ä¸€èˆ¬ç¡¬ä»¶çš„è´Ÿè½½å‡è¡¡ä¹Ÿè¦åšåŒæœºé«˜å¯ç”¨ï¼Œå› æ­¤æˆæœ¬ä¼šæ¯”è¾ƒé«˜ã€‚ äº’è”ç½‘å…¬å¸ä¸€èˆ¬ä½¿ç”¨å¼€æºè½¯ä»¶ï¼Œå› æ­¤å¤§éƒ¨åˆ†åº”ç”¨é‡‡ç”¨è½¯ä»¶è´Ÿè½½å‡è¡¡ï¼›éƒ¨åˆ†é‡‡ç”¨ç¡¬ä»¶è´Ÿè½½å‡è¡¡ã€‚ æ¯”å¦‚æŸäº’è”ç½‘å…¬å¸ï¼Œç›®å‰æ˜¯ä½¿ç”¨å‡ å° F5 åšå…¨å±€è´Ÿè½½å‡è¡¡ï¼Œå†…éƒ¨ä½¿ç”¨ Nginx ç­‰è½¯ä»¶è´Ÿè½½å‡è¡¡ã€‚ Ngnix è´Ÿè½½å‡è¡¡ Ngnix æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ Web æœåŠ¡å™¨/åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå·¥ä½œåœ¨ä¸ƒå±‚ Http åè®®çš„è´Ÿè½½å‡è¡¡ç³»ç»Ÿã€‚å…·æœ‰é«˜æ€§èƒ½ã€é«˜å¹¶å‘ã€ä½Žå†…å­˜ä½¿ç”¨ç­‰ç‰¹ç‚¹ã€‚æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Http å’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚Nginx ä½¿ç”¨ epoll and kqueue ä½œä¸ºå¼€å‘æ¨¡åž‹ã€‚èƒ½å¤Ÿæ”¯æŒé«˜è¾¾ 50,000 ä¸ªå¹¶å‘è¿žæŽ¥æ•°çš„å“åº”ã€‚ æ“ä½œç³»ç»Ÿï¼šLiunxï¼ŒWindowsï¼ˆLinuxã€FreeBSDã€Solarisã€Mac OS Xã€AIX ä»¥åŠ Microsoft Windowsï¼‰ å¼€å‘è¯­è¨€ï¼šC å¹¶å‘æ€§èƒ½ï¼šå®˜æ–¹æ”¯æŒæ¯ç§’ 5 ä¸‡å¹¶å‘ï¼Œå®žé™…å›½å†…ä¸€èˆ¬åˆ°æ¯ç§’ 2 ä¸‡å¹¶å‘ï¼Œæœ‰ä¼˜åŒ–åˆ°æ¯ç§’ 10 ä¸‡å¹¶å‘çš„ã€‚å…·ä½“æ€§èƒ½çœ‹åº”ç”¨åœºæ™¯ã€‚ Ngnix ç‰¹ç‚¹ æ¨¡å—åŒ–è®¾è®¡ï¼šè‰¯å¥½çš„æ‰©å±•æ€§ï¼Œå¯ä»¥é€šè¿‡æ¨¡å—æ–¹å¼è¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚ é«˜å¯é æ€§ï¼šä¸»æŽ§è¿›ç¨‹å’Œ worker æ˜¯åŒæ­¥å®žçŽ°çš„ï¼Œä¸€ä¸ª worker å‡ºçŽ°é—®é¢˜ï¼Œä¼šç«‹åˆ»å¯åŠ¨å¦ä¸€ä¸ª workerã€‚ å†…å­˜æ¶ˆè€—ä½Žï¼šä¸€ä¸‡ä¸ªé•¿è¿žæŽ¥ï¼ˆkeep-aliveï¼‰,ä»…æ¶ˆè€— 2.5MB å†…å­˜ã€‚ æ”¯æŒçƒ­éƒ¨ç½²ï¼šä¸ç”¨åœæ­¢æœåŠ¡å™¨ï¼Œå®žçŽ°æ›´æ–°é…ç½®æ–‡ä»¶ï¼Œæ›´æ¢æ—¥å¿—æ–‡ä»¶ã€æ›´æ–°æœåŠ¡å™¨ç¨‹åºç‰ˆæœ¬ã€‚ å¹¶å‘èƒ½åŠ›å¼ºï¼šå®˜æ–¹æ•°æ®æ¯ç§’æ”¯æŒ 5 ä¸‡å¹¶å‘ï¼› åŠŸèƒ½ä¸°å¯Œï¼šä¼˜ç§€çš„åå‘ä»£ç†åŠŸèƒ½å’Œçµæ´»çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ Ngnix åŠŸèƒ½ åŸºæœ¬åŠŸèƒ½ æ”¯æŒé™æ€èµ„æºçš„ web æœåŠ¡å™¨ã€‚ http,smtp,pop3 åè®®çš„åå‘ä»£ç†æœåŠ¡å™¨ã€ç¼“å­˜ã€è´Ÿè½½å‡è¡¡ï¼› æ”¯æŒ FASTCGIï¼ˆfpmï¼‰ æ”¯æŒæ¨¡å—åŒ–ï¼Œè¿‡æ»¤å™¨ï¼ˆè®©æ–‡æœ¬å¯ä»¥å®žçŽ°åŽ‹ç¼©ï¼ŒèŠ‚çº¦å¸¦å®½ï¼‰,ssl åŠå›¾åƒå¤§å°è°ƒæ•´ã€‚ å†…ç½®çš„å¥åº·æ£€æŸ¥åŠŸèƒ½ åŸºäºŽåç§°å’Œ ip çš„è™šæ‹Ÿä¸»æœº å®šåˆ¶è®¿é—®æ—¥å¿— æ”¯æŒå¹³æ»‘å‡çº§ æ”¯æŒ KEEPALIVE æ”¯æŒ url rewrite æ”¯æŒè·¯å¾„åˆ«å æ”¯æŒåŸºäºŽ IP å’Œç”¨æˆ·åçš„è®¿é—®æŽ§åˆ¶ã€‚ æ”¯æŒä¼ è¾“é€ŸçŽ‡é™åˆ¶ï¼Œæ”¯æŒå¹¶å‘æ•°é™åˆ¶ã€‚ æ‰©å±•åŠŸèƒ½ æ€§èƒ½ Nginx çš„é«˜å¹¶å‘ï¼Œå®˜æ–¹æµ‹è¯•æ”¯æŒ 5 ä¸‡å¹¶å‘è¿žæŽ¥ã€‚å®žé™…ç”Ÿäº§çŽ¯å¢ƒèƒ½åˆ° 2-3 ä¸‡å¹¶å‘è¿žæŽ¥æ•°ã€‚10000 ä¸ªéžæ´»è·ƒçš„ HTTP keep-alive è¿žæŽ¥ä»…å ç”¨çº¦ 2.5MB å†…å­˜ã€‚ä¸‰ä¸‡å¹¶å‘è¿žæŽ¥ä¸‹ï¼Œ10 ä¸ª Nginx è¿›ç¨‹ï¼Œæ¶ˆè€—å†…å­˜ 150Mã€‚æ·˜å® tengine å›¢é˜Ÿæµ‹è¯•ç»“æžœæ˜¯â€œ24G å†…å­˜æœºå™¨ä¸Šï¼Œå¤„ç†å¹¶å‘è¯·æ±‚å¯è¾¾ 200 ä¸‡â€ã€‚ Ngnix æž¶æž„ Nginx çš„åŸºæœ¬å·¥ä½œæ¨¡å¼ ä¸€ä¸ª master è¿›ç¨‹ï¼Œç”Ÿæˆä¸€ä¸ªæˆ–è€…å¤šä¸ª worker è¿›ç¨‹ã€‚ä½†æ˜¯è¿™é‡Œ master æ˜¯ä½¿ç”¨ root èº«ä»½å¯åŠ¨çš„ï¼Œå› ä¸º nginx è¦å·¥ä½œåœ¨ 80 ç«¯å£ã€‚è€Œåªæœ‰ç®¡ç†å‘˜æ‰æœ‰æƒé™å¯åŠ¨å°äºŽä½ŽäºŽ 1023 çš„ç«¯å£ã€‚master ä¸»è¦æ˜¯è´Ÿè´£çš„ä½œç”¨åªæ˜¯å¯åŠ¨ workerï¼ŒåŠ è½½é…ç½®æ–‡ä»¶ï¼Œè´Ÿè´£ç³»ç»Ÿçš„å¹³æ»‘å‡çº§ã€‚å…¶å®ƒçš„å·¥ä½œæ˜¯äº¤ç»™ workerã€‚é‚£ä¹ˆå½“ worker è¢«å¯åŠ¨ä¹‹åŽï¼Œä¹Ÿåªæ˜¯è´Ÿè´£ä¸€äº› web æœ€ç®€å•çš„å·¥ä½œï¼Œè€Œå…¶ä»–çš„å·¥ä½œéƒ½æ˜¯æœ‰ worker ä¸­è°ƒç”¨çš„æ¨¡å—æ¥å®žçŽ°çš„ã€‚ æ¨¡å—ä¹‹é—´æ˜¯ä»¥æµæ°´çº¿çš„æ–¹å¼å®žçŽ°åŠŸèƒ½çš„ã€‚æµæ°´çº¿ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ªç”¨æˆ·è¯·æ±‚ï¼Œç”±å¤šä¸ªæ¨¡å—ç»„åˆå„è‡ªçš„åŠŸèƒ½ä¾æ¬¡å®žçŽ°å®Œæˆçš„ã€‚æ¯”å¦‚ï¼šç¬¬ä¸€ä¸ªæ¨¡å—åªè´Ÿè´£åˆ†æžè¯·æ±‚é¦–éƒ¨ï¼Œç¬¬äºŒä¸ªæ¨¡å—åªè´Ÿè´£æŸ¥æ‰¾æ•°æ®ï¼Œç¬¬ä¸‰ä¸ªæ¨¡å—åªè´Ÿè´£åŽ‹ç¼©æ•°æ®ï¼Œä¾æ¬¡å®Œæˆå„è‡ªå·¥ä½œã€‚æ¥å®žçŽ°æ•´ä¸ªå·¥ä½œçš„å®Œæˆã€‚ ä»–ä»¬æ˜¯å¦‚ä½•å®žçŽ°çƒ­éƒ¨ç½²çš„å‘¢ï¼Ÿå…¶å®žæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬å‰é¢è¯´ master ä¸è´Ÿè´£å…·ä½“çš„å·¥ä½œï¼Œè€Œæ˜¯è°ƒç”¨ worker å·¥ä½œï¼Œä»–åªæ˜¯è´Ÿè´£è¯»å–é…ç½®æ–‡ä»¶ï¼Œå› æ­¤å½“ä¸€ä¸ªæ¨¡å—ä¿®æ”¹æˆ–è€…é…ç½®æ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œæ˜¯ç”± master è¿›è¡Œè¯»å–ï¼Œå› æ­¤æ­¤æ—¶ä¸ä¼šå½±å“åˆ° worker å·¥ä½œã€‚åœ¨ master è¿›è¡Œè¯»å–é…ç½®æ–‡ä»¶ä¹‹åŽï¼Œä¸ä¼šç«‹å³çš„æŠŠä¿®æ”¹çš„é…ç½®æ–‡ä»¶å‘ŠçŸ¥ workerã€‚è€Œæ˜¯è®©è¢«ä¿®æ”¹çš„ worker ç»§ç»­ä½¿ç”¨è€çš„é…ç½®æ–‡ä»¶å·¥ä½œï¼Œå½“ worker å·¥ä½œå®Œæ¯•ä¹‹åŽï¼Œç›´æŽ¥å½“æŽ‰è¿™ä¸ªå­è¿›ç¨‹ï¼Œæ›´æ¢æ–°çš„å­è¿›ç¨‹ï¼Œä½¿ç”¨æ–°çš„è§„åˆ™ã€‚ Nginx æ”¯æŒçš„ sendfile æœºåˆ¶ Sendfile æœºåˆ¶ï¼Œç”¨æˆ·å°†è¯·æ±‚å‘ç»™å†…æ ¸ï¼Œå†…æ ¸æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚è°ƒç”¨ç›¸åº”ç”¨æˆ·è¿›ç¨‹ï¼Œè¿›ç¨‹åœ¨å¤„ç†æ—¶éœ€è¦èµ„æºã€‚æ­¤æ—¶å†æŠŠè¯·æ±‚å‘ç»™å†…æ ¸ï¼ˆè¿›ç¨‹æ²¡æœ‰ç›´æŽ¥ IO çš„èƒ½åŠ›ï¼‰ï¼Œç”±å†…æ ¸åŠ è½½æ•°æ®ã€‚å†…æ ¸æŸ¥æ‰¾åˆ°æ•°æ®ä¹‹åŽï¼Œä¼šæŠŠæ•°æ®å¤åˆ¶ç»™ç”¨æˆ·è¿›ç¨‹ï¼Œç”±ç”¨æˆ·è¿›ç¨‹å¯¹æ•°æ®è¿›è¡Œå°è£…ï¼Œä¹‹åŽäº¤ç»™å†…æ ¸ï¼Œå†…æ ¸åœ¨è¿›è¡Œ tcp/ip é¦–éƒ¨çš„å°è£…ï¼Œæœ€åŽå†å‘ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ªåŠŸèƒ½ç”¨æˆ·è¿›ç¨‹åªæ˜¯å‘ç”Ÿäº†ä¸€ä¸ªå°è£…æŠ¥æ–‡çš„è¿‡ç¨‹ï¼Œå´è¦ç»•ä¸€å¤§åœˆã€‚å› æ­¤ nginx å¼•å…¥äº† sendfile æœºåˆ¶ï¼Œä½¿å¾—å†…æ ¸åœ¨æŽ¥å—åˆ°æ•°æ®ä¹‹åŽï¼Œä¸å†ä¾é ç”¨æˆ·è¿›ç¨‹ç»™äºˆå°è£…ï¼Œè€Œæ˜¯è‡ªå·±æŸ¥æ‰¾è‡ªå·±å°è£…ï¼Œå‡å°‘äº†ä¸€ä¸ªå¾ˆé•¿ä¸€æ®µæ—¶é—´çš„æµªè´¹ï¼Œè¿™æ˜¯ä¸€ä¸ªæå‡æ€§èƒ½çš„æ ¸å¿ƒç‚¹ã€‚ ä»¥ä¸Šå†…å®¹æ‘˜è‡ªç½‘å‹å‘å¸ƒçš„æ–‡ç« ï¼Œç®€å•ä¸€å¥è¯æ˜¯èµ„æºçš„å¤„ç†ï¼Œç›´æŽ¥é€šè¿‡å†…æ ¸å±‚è¿›è¡Œæ•°æ®ä¼ é€’ï¼Œé¿å…äº†æ•°æ®ä¼ é€’åˆ°åº”ç”¨å±‚ï¼Œåº”ç”¨å±‚å†ä¼ é€’åˆ°å†…æ ¸å±‚çš„å¼€é”€ã€‚ ç›®å‰é«˜å¹¶å‘çš„å¤„ç†ï¼Œä¸€èˆ¬éƒ½é‡‡ç”¨ sendfile æ¨¡å¼ã€‚é€šè¿‡ç›´æŽ¥æ“ä½œå†…æ ¸å±‚æ•°æ®ï¼Œå‡å°‘åº”ç”¨ä¸Žå†…æ ¸å±‚æ•°æ®ä¼ é€’ã€‚ Nginx é€šä¿¡æ¨¡åž‹ï¼ˆI/O å¤ç”¨æœºåˆ¶ï¼‰ å¼€å‘æ¨¡åž‹ï¼šepoll å’Œ kqueueã€‚ æ”¯æŒçš„äº‹ä»¶æœºåˆ¶ï¼škqueueã€epollã€rt signalsã€/dev/poll ã€event portsã€select ä»¥åŠ pollã€‚ æ”¯æŒçš„ kqueue ç‰¹æ€§åŒ…æ‹¬ EV_CLEARã€EV_DISABLEã€NOTE_LOWATã€EV_EOFï¼Œå¯ç”¨æ•°æ®çš„æ•°é‡ï¼Œé”™è¯¯ä»£ç . æ”¯æŒ sendfileã€sendfile64 å’Œ sendfilev;æ–‡ä»¶ AIOï¼›DIRECTIO;æ”¯æŒ Accept-filters å’Œ TCP_DEFER_ACCEP. ä»¥ä¸Šæ¦‚å¿µè¾ƒå¤šï¼Œå¤§å®¶è‡ªè¡Œç™¾åº¦æˆ–è°·æ­Œï¼ŒçŸ¥è¯†é¢†åŸŸæ˜¯ç½‘ç»œé€šä¿¡ï¼ˆBIO,NIO,AIOï¼‰å’Œå¤šçº¿ç¨‹æ–¹é¢çš„çŸ¥è¯†ã€‚ Ngnix å‡è¡¡ç­–ç•¥ nginx çš„è´Ÿè½½å‡è¡¡ç­–ç•¥å¯ä»¥åˆ’åˆ†ä¸ºä¸¤å¤§ç±»ï¼šå†…ç½®ç­–ç•¥å’Œæ‰©å±•ç­–ç•¥ã€‚å†…ç½®ç­–ç•¥åŒ…å«åŠ æƒè½®è¯¢å’Œ ip hashï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹è¿™ä¸¤ç§ç­–ç•¥ä¼šç¼–è¯‘è¿› nginx å†…æ ¸ï¼Œåªéœ€åœ¨ nginx é…ç½®ä¸­æŒ‡æ˜Žå‚æ•°å³å¯ã€‚æ‰©å±•ç­–ç•¥æœ‰å¾ˆå¤šï¼Œå¦‚ fairã€é€šç”¨ hashã€consistent hash ç­‰ï¼Œé»˜è®¤ä¸ç¼–è¯‘è¿› nginx å†…æ ¸ã€‚ç”±äºŽåœ¨ nginx ç‰ˆæœ¬å‡çº§ä¸­è´Ÿè½½å‡è¡¡çš„ä»£ç æ²¡æœ‰æœ¬è´¨æ€§çš„å˜åŒ–ï¼Œå› æ­¤ä¸‹é¢å°†ä»¥ nginx1.0.15 ç¨³å®šç‰ˆä¸ºä¾‹ï¼Œä»Žæºç è§’åº¦åˆ†æžå„ä¸ªç­–ç•¥ã€‚ åŠ æƒè½®è¯¢ï¼ˆweighted round robinï¼‰ è½®è¯¢çš„åŽŸç†å¾ˆç®€å•ï¼Œé¦–å…ˆæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹è½®è¯¢çš„åŸºæœ¬æµç¨‹ã€‚å¦‚ä¸‹æ˜¯å¤„ç†ä¸€æ¬¡è¯·æ±‚çš„æµç¨‹å›¾ï¼š å›¾ä¸­æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼Œç¬¬ä¸€ï¼Œå¦‚æžœå¯ä»¥æŠŠåŠ æƒè½®è¯¢ç®—æ³•åˆ†ä¸ºå…ˆæ·±æœç´¢å’Œå…ˆå¹¿æœç´¢ï¼Œé‚£ä¹ˆ nginx é‡‡ç”¨çš„æ˜¯å…ˆæ·±æœç´¢ç®—æ³•ï¼Œå³å°†é¦–å…ˆå°†è¯·æ±‚éƒ½åˆ†ç»™é«˜æƒé‡çš„æœºå™¨ï¼Œç›´åˆ°è¯¥æœºå™¨çš„æƒå€¼é™åˆ°äº†æ¯”å…¶ä»–æœºå™¨ä½Žï¼Œæ‰å¼€å§‹å°†è¯·æ±‚åˆ†ç»™ä¸‹ä¸€ä¸ªé«˜æƒé‡çš„æœºå™¨ï¼›ç¬¬äºŒï¼Œå½“æ‰€æœ‰åŽç«¯æœºå™¨éƒ½ down æŽ‰æ—¶ï¼Œnginx ä¼šç«‹å³å°†æ‰€æœ‰æœºå™¨çš„æ ‡å¿—ä½æ¸…æˆåˆå§‹çŠ¶æ€ï¼Œä»¥é¿å…é€ æˆæ‰€æœ‰çš„æœºå™¨éƒ½å¤„åœ¨ timeout çš„çŠ¶æ€ï¼Œä»Žè€Œå¯¼è‡´æ•´ä¸ªå‰ç«¯è¢«å¤¯ä½ã€‚ ip hash ip hash æ˜¯ nginx å†…ç½®çš„å¦ä¸€ä¸ªè´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼Œæµç¨‹å’Œè½®è¯¢å¾ˆç±»ä¼¼ï¼Œåªæ˜¯å…¶ä¸­çš„ç®—æ³•å’Œå…·ä½“çš„ç­–ç•¥æœ‰äº›å˜åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š fair fair ç­–ç•¥æ˜¯æ‰©å±•ç­–ç•¥ï¼Œé»˜è®¤ä¸è¢«ç¼–è¯‘è¿› nginx å†…æ ¸ã€‚å…¶åŽŸç†æ˜¯æ ¹æ®åŽç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´åˆ¤æ–­è´Ÿè½½æƒ…å†µï¼Œä»Žä¸­é€‰å‡ºè´Ÿè½½æœ€è½»çš„æœºå™¨è¿›è¡Œåˆ†æµã€‚è¿™ç§ç­–ç•¥å…·æœ‰å¾ˆå¼ºçš„è‡ªé€‚åº”æ€§ï¼Œä½†æ˜¯å®žé™…çš„ç½‘ç»œçŽ¯å¢ƒå¾€å¾€ä¸æ˜¯é‚£ä¹ˆç®€å•ï¼Œå› æ­¤è¦æ…Žç”¨ã€‚ é€šç”¨ hashã€ä¸€è‡´æ€§ hash è¿™ä¸¤ç§ä¹Ÿæ˜¯æ‰©å±•ç­–ç•¥ï¼Œåœ¨å…·ä½“çš„å®žçŽ°ä¸Šæœ‰äº›å·®åˆ«ï¼Œé€šç”¨ hash æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ä»¥ nginx å†…ç½®çš„å˜é‡ä¸º key è¿›è¡Œ hashï¼Œä¸€è‡´æ€§ hash é‡‡ç”¨äº† nginx å†…ç½®çš„ä¸€è‡´æ€§ hash çŽ¯ï¼Œå¯ä»¥æ”¯æŒ memcacheã€‚ Ngnix åœºæ™¯ Ngnix ä¸€èˆ¬ä½œä¸ºå…¥å£è´Ÿè½½å‡è¡¡æˆ–å†…éƒ¨è´Ÿè½½å‡è¡¡ï¼Œç»“åˆåå‘ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ã€‚ä»¥ä¸‹æž¶æž„ç¤ºä¾‹ï¼Œä»…ä¾›å‚è€ƒï¼Œå…·ä½“ä½¿ç”¨æ ¹æ®åœºæ™¯è€Œå®šã€‚ å…¥å£è´Ÿè½½å‡è¡¡æž¶æž„ Ngnix æœåŠ¡å™¨åœ¨ç”¨æˆ·è®¿é—®çš„æœ€å‰ç«¯ã€‚æ ¹æ®ç”¨æˆ·è¯·æ±‚å†è½¬å‘åˆ°å…·ä½“çš„åº”ç”¨æœåŠ¡å™¨æˆ–äºŒçº§è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼ˆLVSï¼‰ å†…éƒ¨è´Ÿè½½å‡è¡¡æž¶æž„ LVS ä½œä¸ºå…¥å£è´Ÿè½½å‡è¡¡ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°äºŒçº§ Ngnix æœåŠ¡å™¨ï¼ŒNgnix å†æ ¹æ®è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„åº”ç”¨æœåŠ¡å™¨ã€‚ Ngnix é«˜å¯ç”¨ åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåº”ç”¨åªéƒ¨ç½²ä¸€å°æœåŠ¡å™¨ä¼šå­˜åœ¨å•ç‚¹æ•…éšœï¼Œè´Ÿè½½å‡è¡¡åŒæ ·æœ‰ç±»ä¼¼çš„é—®é¢˜ã€‚ä¸€èˆ¬å¯é‡‡ç”¨ä¸»å¤‡æˆ–è´Ÿè½½å‡è¡¡è®¾å¤‡é›†ç¾¤çš„æ–¹å¼èŠ‚çº¦å•ç‚¹æ•…éšœæˆ–é«˜å¹¶å‘è¯·æ±‚åˆ†æµã€‚ Ngnix é«˜å¯ç”¨ï¼Œè‡³å°‘åŒ…å«ä¸¤ä¸ª Ngnix æœåŠ¡å™¨ï¼Œä¸€å°ä¸»æœåŠ¡å™¨ï¼Œä¸€å°å¤‡æœåŠ¡å™¨ï¼Œä¹‹é—´ä½¿ç”¨ Keepalived åšå¥åº·ç›‘æŽ§å’Œæ•…éšœæ£€æµ‹ã€‚å¼€æ”¾ VIP ç«¯å£ï¼Œé€šè¿‡é˜²ç«å¢™è¿›è¡Œå¤–éƒ¨æ˜ å°„ã€‚ DNS è§£æžå…¬ç½‘çš„ IP å®žé™…ä¸º VIPã€‚ LVS è´Ÿè½½å‡è¡¡ LVS æ˜¯ä¸€ä¸ªå¼€æºçš„è½¯ä»¶ï¼Œç”±æ¯•ä¸šäºŽå›½é˜²ç§‘æŠ€å¤§å­¦çš„ç« æ–‡åµ©åšå£«äºŽ 1998 å¹´ 5 æœˆåˆ›ç«‹ï¼Œç”¨æ¥å®žçŽ° Linux å¹³å°ä¸‹çš„ç®€å•è´Ÿè½½å‡è¡¡ã€‚LVS æ˜¯ Linux Virtual Server çš„ç¼©å†™ï¼Œæ„æ€æ˜¯ Linux è™šæ‹ŸæœåŠ¡å™¨ã€‚ åŸºäºŽ IP å±‚çš„è´Ÿè½½å‡è¡¡è°ƒåº¦æŠ€æœ¯ï¼Œå®ƒåœ¨æ“ä½œç³»ç»Ÿæ ¸å¿ƒå±‚ä¸Šï¼Œå°†æ¥è‡ª IP å±‚çš„ TCP/UDP è¯·æ±‚å‡è¡¡åœ°è½¬ç§»åˆ°ä¸åŒçš„ æœåŠ¡å™¨ï¼Œä»Žè€Œå°†ä¸€ç»„æœåŠ¡å™¨æž„æˆä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„è™šæ‹ŸæœåŠ¡å™¨ã€‚ æ“ä½œç³»ç»Ÿï¼šLiunx å¼€å‘è¯­è¨€ï¼šC å¹¶å‘æ€§èƒ½ï¼šé»˜è®¤ 4096ï¼Œå¯ä»¥ä¿®æ”¹ä½†éœ€è¦é‡æ–°ç¼–è¯‘ã€‚ LVS åŠŸèƒ½ LVS çš„ä¸»è¦åŠŸèƒ½æ˜¯å®žçŽ° IP å±‚ï¼ˆç½‘ç»œå±‚ï¼‰è´Ÿè½½å‡è¡¡ï¼Œæœ‰ NAT,TUN,DR ä¸‰ç§è¯·æ±‚è½¬å‘æ¨¡å¼ã€‚ LVS/NAT æ–¹å¼çš„è´Ÿè½½å‡è¡¡é›†ç¾¤ NAT æ˜¯æŒ‡ Network Address Translationï¼Œå®ƒçš„è½¬å‘æµç¨‹æ˜¯ï¼šDirector æœºå™¨æ”¶åˆ°å¤–ç•Œè¯·æ±‚ï¼Œæ”¹å†™æ•°æ®åŒ…çš„ç›®æ ‡åœ°å€ï¼ŒæŒ‰ç›¸åº”çš„è°ƒåº¦ç®—æ³•å°†å…¶å‘é€åˆ°ç›¸åº” Real Server ä¸Šï¼ŒReal Server å¤„ç†å®Œè¯¥è¯·æ±‚åŽï¼Œå°†ç»“æžœæ•°æ®åŒ…è¿”å›žåˆ°å…¶é»˜è®¤ç½‘å…³ï¼Œå³ Director æœºå™¨ä¸Šï¼ŒDirector æœºå™¨å†æ”¹å†™æ•°æ®åŒ…çš„æºåœ°å€ï¼Œæœ€åŽå°†å…¶è¿”å›žç»™å¤–ç•Œã€‚è¿™æ ·å°±å®Œæˆä¸€æ¬¡è´Ÿè½½è°ƒåº¦ã€‚ æž„æž¶ä¸€ä¸ªæœ€ç®€å•çš„ LVS/NAT æ–¹å¼çš„è´Ÿè½½å‡è¡¡é›†ç¾¤ Real Server å¯ä»¥æ˜¯ä»»ä½•çš„æ“ä½œç³»ç»Ÿï¼Œè€Œä¸”æ— éœ€åšä»»ä½•ç‰¹æ®Šçš„è®¾å®šï¼ŒæƒŸä¸€è¦åšçš„å°±æ˜¯å°†å…¶é»˜è®¤ç½‘å…³æŒ‡å‘ Director æœºå™¨ã€‚Real Server å¯ä»¥ä½¿ç”¨å±€åŸŸç½‘çš„å†…éƒ¨ IP(192.168.0.0/24)ã€‚Director è¦æœ‰ä¸¤å—ç½‘å¡ï¼Œä¸€å—ç½‘å¡ç»‘å®šä¸€ä¸ªå¤–éƒ¨ IP åœ°å€ (10.0.0.1)ï¼Œå¦ä¸€å—ç½‘å¡ç»‘å®šå±€åŸŸç½‘çš„å†…éƒ¨ IP(192.168.0.254)ï¼Œä½œä¸º Real Server çš„é»˜è®¤ç½‘å…³ã€‚ LVS/NAT æ–¹å¼å®žçŽ°èµ·æ¥æœ€ä¸ºç®€å•ï¼Œè€Œä¸” Real Server ä½¿ç”¨çš„æ˜¯å†…éƒ¨ IPï¼Œå¯ä»¥èŠ‚çœ Real IP çš„å¼€é”€ã€‚ä½†å› ä¸ºæ‰§è¡Œ NAT éœ€è¦é‡å†™æµç» Director çš„æ•°æ®åŒ…ï¼Œåœ¨é€Ÿåº¦ä¸Šæœ‰ä¸€å®šå»¶è¿Ÿï¼› å½“ç”¨æˆ·çš„è¯·æ±‚éžå¸¸çŸ­ï¼Œè€ŒæœåŠ¡å™¨çš„å›žåº”éžå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¹ Director å½¢æˆå¾ˆå¤§åŽ‹åŠ›ï¼Œæˆä¸ºæ–°çš„ç“¶é¢ˆï¼Œä»Žè€Œä½¿æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½å—åˆ°é™åˆ¶ã€‚ LVS/TUN æ–¹å¼çš„è´Ÿè½½å‡è¡¡é›†ç¾¤ TUN æ˜¯æŒ‡ IP Tunnelingï¼Œå®ƒçš„è½¬å‘æµç¨‹æ˜¯ï¼šDirector æœºå™¨æ”¶åˆ°å¤–ç•Œè¯·æ±‚ï¼ŒæŒ‰ç›¸åº”çš„è°ƒåº¦ç®—æ³•,é€šè¿‡ IP éš§é“å‘é€åˆ°ç›¸åº” Real Serverï¼ŒReal Server å¤„ç†å®Œè¯¥è¯·æ±‚åŽï¼Œå°†ç»“æžœæ•°æ®åŒ…ç›´æŽ¥è¿”å›žç»™å®¢æˆ·ã€‚è‡³æ­¤å®Œæˆä¸€æ¬¡è´Ÿè½½è°ƒåº¦ã€‚ æœ€ç®€å•çš„ LVS/TUN æ–¹å¼çš„è´Ÿè½½å‡è¡¡é›†ç¾¤æž¶æž„ä½¿ç”¨ IP Tunneling æŠ€æœ¯ï¼Œåœ¨ Director æœºå™¨å’Œ Real Server æœºå™¨ä¹‹é—´æž¶è®¾ä¸€ä¸ª IP Tunnelï¼Œé€šè¿‡ IP Tunnel å°†è´Ÿè½½åˆ†é…åˆ° Real Server æœºå™¨ä¸Šã€‚Director å’Œ Real Server ä¹‹é—´çš„å…³ç³»æ¯”è¾ƒæ¾æ•£ï¼Œå¯ä»¥æ˜¯åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨ä¸åŒçš„ç½‘ç»œä¸­ï¼Œåªè¦ä¸¤è€…èƒ½å¤Ÿé€šè¿‡ IP Tunnel ç›¸è¿žå°±è¡Œã€‚æ”¶åˆ°è´Ÿè½½åˆ†é…çš„ Real Server æœºå™¨å¤„ç†å®ŒåŽä¼šç›´æŽ¥å°†åé¦ˆæ•°æ®é€å›žç»™å®¢æˆ·ï¼Œè€Œä¸å¿…é€šè¿‡ Director æœºå™¨ã€‚å®žé™…åº”ç”¨ä¸­ï¼ŒæœåŠ¡å™¨å¿…é¡»æ‹¥æœ‰æ­£å¼çš„ IP åœ°å€ç”¨äºŽä¸Žå®¢æˆ·æœºç›´æŽ¥é€šä¿¡ï¼Œå¹¶ä¸”æ‰€æœ‰æœåŠ¡å™¨å¿…é¡»æ”¯æŒ IP éš§é“åè®®ã€‚ è¯¥æ–¹å¼ä¸­ Director å°†å®¢æˆ·è¯·æ±‚åˆ†é…åˆ°ä¸åŒçš„ Real Serverï¼ŒReal Server å¤„ç†è¯·æ±‚åŽç›´æŽ¥å›žåº”ç»™ç”¨æˆ·ï¼Œè¿™æ · Director å°±åªå¤„ç†å®¢æˆ·æœºä¸ŽæœåŠ¡å™¨çš„ä¸€åŠè¿žæŽ¥ï¼Œæžå¤§åœ°æé«˜äº† Director çš„è°ƒåº¦å¤„ç†èƒ½åŠ›ï¼Œä½¿é›†ç¾¤ç³»ç»Ÿèƒ½å®¹çº³æ›´å¤šçš„èŠ‚ç‚¹æ•°ã€‚å¦å¤– TUN æ–¹å¼ä¸­çš„ Real Server å¯ä»¥åœ¨ä»»ä½• LAN æˆ– WAN ä¸Šè¿è¡Œï¼Œè¿™æ ·å¯ä»¥æž„ç­‘è·¨åœ°åŸŸçš„é›†ç¾¤ï¼Œå…¶åº”å¯¹ç¾éš¾çš„èƒ½åŠ›ä¹Ÿæ›´å¼ºï¼Œä½†æ˜¯æœåŠ¡å™¨éœ€è¦ä¸º IP å°è£…ä»˜å‡ºä¸€å®šçš„èµ„æºå¼€é”€ï¼Œè€Œä¸”åŽç«¯çš„ Real Server å¿…é¡»æ˜¯æ”¯æŒ IP Tunneling çš„æ“ä½œç³»ç»Ÿã€‚ LVS/TUN æ–¹å¼çš„è´Ÿè½½å‡è¡¡é›†ç¾¤ DR æ˜¯æŒ‡ Direct Routingï¼Œå®ƒçš„è½¬å‘æµç¨‹æ˜¯ï¼šDirector æœºå™¨æ”¶åˆ°å¤–ç•Œè¯·æ±‚ï¼ŒæŒ‰ç›¸åº”çš„è°ƒåº¦ç®—æ³•å°†å…¶ç›´æŽ¥å‘é€åˆ°ç›¸åº” Real Serverï¼ŒReal Server å¤„ç†å®Œè¯¥è¯·æ±‚åŽï¼Œå°†ç»“æžœæ•°æ®åŒ…ç›´æŽ¥è¿”å›žç»™å®¢æˆ·ï¼Œå®Œæˆä¸€æ¬¡è´Ÿè½½è°ƒåº¦ã€‚ æž„æž¶ä¸€ä¸ªæœ€ç®€å•çš„ LVS/DR æ–¹å¼çš„è´Ÿè½½å‡è¡¡é›†ç¾¤ Real Server å’Œ Director éƒ½åœ¨åŒä¸€ä¸ªç‰©ç†ç½‘æ®µä¸­ï¼ŒDirector çš„ç½‘å¡ IP æ˜¯ 192.168.0.253ï¼Œå†ç»‘å®šå¦ä¸€ä¸ª IPï¼š 192.168.0.254 ä½œä¸ºå¯¹å¤–ç•Œçš„ virtual IPï¼Œå¤–ç•Œå®¢æˆ·é€šè¿‡è¯¥ IP æ¥è®¿é—®æ•´ä¸ªé›†ç¾¤ç³»ç»Ÿã€‚Real Server åœ¨ lo ä¸Šç»‘å®š IPï¼š192.168.0.254ï¼ŒåŒæ—¶åŠ å…¥ç›¸åº”çš„è·¯ç”±ã€‚ LVS/DR æ–¹å¼ä¸Žå‰é¢çš„ LVS/TUN æ–¹å¼æœ‰äº›ç±»ä¼¼ï¼Œå‰å°çš„ Director æœºå™¨ä¹Ÿæ˜¯åªéœ€è¦æŽ¥æ”¶å’Œè°ƒåº¦å¤–ç•Œçš„è¯·æ±‚ï¼Œè€Œä¸éœ€è¦è´Ÿè´£è¿”å›žè¿™äº›è¯·æ±‚çš„åé¦ˆç»“æžœï¼Œæ‰€ä»¥èƒ½å¤Ÿè´Ÿè½½æ›´å¤šçš„ Real Serverï¼Œæé«˜ Director çš„è°ƒåº¦å¤„ç†èƒ½åŠ›ï¼Œä½¿é›†ç¾¤ç³»ç»Ÿå®¹çº³æ›´å¤šçš„ Real Serverã€‚ä½† LVS/DR éœ€è¦æ”¹å†™è¯·æ±‚æŠ¥æ–‡çš„ MAC åœ°å€ï¼Œæ‰€ä»¥æ‰€æœ‰æœåŠ¡å™¨å¿…é¡»åœ¨åŒä¸€ç‰©ç†ç½‘æ®µå†…ã€‚ LVS æž¶æž„ LVS æž¶è®¾çš„æœåŠ¡å™¨é›†ç¾¤ç³»ç»Ÿæœ‰ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šæœ€å‰ç«¯çš„è´Ÿè½½å‡è¡¡å±‚ï¼ˆLoader Balancerï¼‰ï¼Œä¸­é—´çš„æœåŠ¡å™¨ç¾¤ç»„å±‚ï¼Œç”¨ Server Array è¡¨ç¤ºï¼Œæœ€åº•å±‚çš„æ•°æ®å…±äº«å­˜å‚¨å±‚ï¼Œç”¨ Shared Storage è¡¨ç¤ºã€‚åœ¨ç”¨æˆ·çœ‹æ¥æ‰€æœ‰çš„åº”ç”¨éƒ½æ˜¯é€æ˜Žçš„ï¼Œç”¨æˆ·åªæ˜¯åœ¨ä½¿ç”¨ä¸€ä¸ªè™šæ‹ŸæœåŠ¡å™¨æä¾›çš„é«˜æ€§èƒ½æœåŠ¡ã€‚ LVS çš„ä½“ç³»æž¶æž„å¦‚å›¾ï¼š LVS çš„å„ä¸ªå±‚æ¬¡çš„è¯¦ç»†ä»‹ç»ï¼š Load Balancer å±‚ï¼šä½äºŽæ•´ä¸ªé›†ç¾¤ç³»ç»Ÿçš„æœ€å‰ç«¯ï¼Œæœ‰ä¸€å°æˆ–è€…å¤šå°è´Ÿè½½è°ƒåº¦å™¨ï¼ˆDirector Serverï¼‰ç»„æˆï¼ŒLVS æ¨¡å—å°±å®‰è£…åœ¨ Director Server ä¸Šï¼Œè€Œ Director çš„ä¸»è¦ä½œç”¨ç±»ä¼¼äºŽä¸€ä¸ªè·¯ç”±å™¨ï¼Œå®ƒå«æœ‰å®Œæˆ LVS åŠŸèƒ½æ‰€è®¾å®šçš„è·¯ç”±è¡¨ï¼Œé€šè¿‡è¿™äº›è·¯ç”±è¡¨æŠŠç”¨æˆ·çš„è¯·æ±‚åˆ†å‘ç»™ Server Array å±‚çš„åº”ç”¨æœåŠ¡å™¨ï¼ˆReal Serverï¼‰ä¸Šã€‚åŒæ—¶ï¼Œåœ¨ Director Server ä¸Šè¿˜è¦å®‰è£…å¯¹ Real Server æœåŠ¡çš„ç›‘æŽ§æ¨¡å— Ldirectordï¼Œæ­¤æ¨¡å—ç”¨äºŽç›‘æµ‹å„ä¸ª Real Server æœåŠ¡çš„å¥åº·çŠ¶å†µã€‚åœ¨ Real Server ä¸å¯ç”¨æ—¶æŠŠå®ƒä»Ž LVS è·¯ç”±è¡¨ä¸­å‰”é™¤ï¼Œæ¢å¤æ—¶é‡æ–°åŠ å…¥ã€‚ Server Array å±‚ï¼šç”±ä¸€ç»„å®žé™…è¿è¡Œåº”ç”¨æœåŠ¡çš„æœºå™¨ç»„æˆï¼ŒReal Server å¯ä»¥æ˜¯ WEB æœåŠ¡å™¨ã€MAIL æœåŠ¡å™¨ã€FTP æœåŠ¡å™¨ã€DNS æœåŠ¡å™¨ã€è§†é¢‘æœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼Œæ¯ä¸ª Real Server ä¹‹é—´é€šè¿‡é«˜é€Ÿçš„ LAN æˆ–åˆ†å¸ƒåœ¨å„åœ°çš„ WAN ç›¸è¿žæŽ¥ã€‚åœ¨å®žé™…çš„åº”ç”¨ä¸­ï¼ŒDirector Server ä¹Ÿå¯ä»¥åŒæ—¶å…¼ä»» Real Server çš„è§’è‰²ã€‚ Shared Storage å±‚ï¼šæ˜¯ä¸ºæ‰€æœ‰ Real Server æä¾›å…±äº«å­˜å‚¨ç©ºé—´å’Œå†…å®¹ä¸€è‡´æ€§çš„å­˜å‚¨åŒºåŸŸï¼Œåœ¨ç‰©ç†ä¸Šï¼Œä¸€èˆ¬æœ‰ç£ç›˜é˜µåˆ—è®¾å¤‡ç»„æˆï¼Œä¸ºäº†æä¾›å†…å®¹çš„ä¸€è‡´æ€§ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡ NFS ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿå…±äº«æ•° æ®ï¼Œä½†æ˜¯ NFS åœ¨ç¹å¿™çš„ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œæ€§èƒ½å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œæ­¤æ—¶å¯ä»¥é‡‡ç”¨é›†ç¾¤æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ Red hat çš„ GFS æ–‡ä»¶ç³»ç»Ÿï¼Œoracle æä¾›çš„ OCFS2 æ–‡ä»¶ç³»ç»Ÿç­‰ã€‚ ä»Žæ•´ä¸ª LVS ç»“æž„å¯ä»¥çœ‹å‡ºï¼ŒDirector Server æ˜¯æ•´ä¸ª LVS çš„æ ¸å¿ƒï¼Œç›®å‰ï¼Œç”¨äºŽ Director Server çš„æ“ä½œç³»ç»Ÿåªèƒ½æ˜¯ Linux å’Œ FreeBSDï¼Œlinux2.6 å†…æ ¸ä¸ç”¨ä»»ä½•è®¾ç½®å°±å¯ä»¥æ”¯æŒ LVS åŠŸèƒ½ï¼Œè€Œ FreeBSD ä½œä¸º Director Server çš„åº”ç”¨è¿˜ä¸æ˜¯å¾ˆå¤šï¼Œæ€§èƒ½ä¹Ÿä¸æ˜¯å¾ˆå¥½ã€‚å¯¹äºŽ Real Serverï¼Œå‡ ä¹Žå¯ä»¥æ˜¯æ‰€æœ‰çš„ç³»ç»Ÿå¹³å°ï¼ŒLinuxã€windowsã€Solarisã€AIXã€BSD ç³»åˆ—éƒ½èƒ½å¾ˆå¥½çš„æ”¯æŒã€‚ LVS å‡è¡¡ç­–ç•¥ LVS é»˜è®¤æ”¯æŒå…«ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œç®€è¿°å¦‚ä¸‹ï¼š è½®è¯¢è°ƒåº¦ï¼ˆRound Robinï¼‰ è°ƒåº¦å™¨é€šè¿‡â€œè½®è¯¢â€è°ƒåº¦ç®—æ³•å°†å¤–éƒ¨è¯·æ±‚æŒ‰é¡ºåºè½®æµåˆ†é…åˆ°é›†ç¾¤ä¸­çš„çœŸå®žæœåŠ¡å™¨ä¸Šï¼Œå®ƒå‡ç­‰åœ°å¯¹å¾…æ¯ä¸€å°æœåŠ¡å™¨ï¼Œè€Œä¸ç®¡æœåŠ¡å™¨ä¸Šå®žé™…çš„è¿žæŽ¥æ•°å’Œç³»ç»Ÿè´Ÿè½½ã€‚ åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robinï¼‰ è°ƒåº¦å™¨é€šè¿‡â€œåŠ æƒè½®è¯¢â€è°ƒåº¦ç®—æ³•æ ¹æ®çœŸå®žæœåŠ¡å™¨çš„ä¸åŒå¤„ç†èƒ½åŠ›æ¥è°ƒåº¦è®¿é—®è¯·æ±‚ã€‚è¿™æ ·å¯ä»¥ä¿è¯å¤„ç†èƒ½åŠ›å¼ºçš„æœåŠ¡å™¨èƒ½å¤„ç†æ›´å¤šçš„è®¿é—®æµé‡ã€‚è°ƒåº¦å™¨å¯ä»¥è‡ªåŠ¨é—®è¯¢çœŸå®žæœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µï¼Œå¹¶åŠ¨æ€åœ°è°ƒæ•´å…¶æƒå€¼ã€‚ æœ€å°‘é“¾æŽ¥ï¼ˆLeast Connectionsï¼‰ è°ƒåº¦å™¨é€šè¿‡â€œæœ€å°‘è¿žæŽ¥â€è°ƒåº¦ç®—æ³•åŠ¨æ€åœ°å°†ç½‘ç»œè¯·æ±‚è°ƒåº¦åˆ°å·²å»ºç«‹çš„é“¾æŽ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ä¸Šã€‚å¦‚æžœé›†ç¾¤ç³»ç»Ÿçš„çœŸå®žæœåŠ¡å™¨å…·æœ‰ç›¸è¿‘çš„ç³»ç»Ÿæ€§èƒ½ï¼Œé‡‡ç”¨â€œæœ€å°è¿žæŽ¥â€è°ƒåº¦ç®—æ³•å¯ä»¥è¾ƒå¥½åœ°å‡è¡¡è´Ÿè½½ã€‚ åŠ æƒæœ€å°‘é“¾æŽ¥ï¼ˆWeighted Least Connectionsï¼‰ åœ¨é›†ç¾¤ç³»ç»Ÿä¸­çš„æœåŠ¡å™¨æ€§èƒ½å·®å¼‚è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œè°ƒåº¦å™¨é‡‡ç”¨â€œåŠ æƒæœ€å°‘é“¾æŽ¥â€è°ƒåº¦ç®—æ³•ä¼˜åŒ–è´Ÿè½½å‡è¡¡æ€§èƒ½ï¼Œå…·æœ‰è¾ƒé«˜æƒå€¼çš„æœåŠ¡å™¨å°†æ‰¿å—è¾ƒå¤§æ¯”ä¾‹çš„æ´»åŠ¨è¿žæŽ¥è´Ÿè½½ã€‚è°ƒåº¦å™¨å¯ä»¥è‡ªåŠ¨é—®è¯¢çœŸå®žæœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µï¼Œå¹¶åŠ¨æ€åœ°è°ƒæ•´å…¶æƒå€¼ã€‚ åŸºäºŽå±€éƒ¨æ€§çš„æœ€å°‘é“¾æŽ¥ï¼ˆLocality-Based Least Connectionsï¼‰ â€œåŸºäºŽå±€éƒ¨æ€§çš„æœ€å°‘é“¾æŽ¥â€è°ƒåº¦ç®—æ³•æ˜¯é’ˆå¯¹ç›®æ ‡ IP åœ°å€çš„è´Ÿè½½å‡è¡¡ï¼Œç›®å‰ä¸»è¦ç”¨äºŽ Cache é›†ç¾¤ç³»ç»Ÿã€‚è¯¥ç®—æ³•æ ¹æ®è¯·æ±‚çš„ç›®æ ‡ IP åœ°å€æ‰¾å‡ºè¯¥ç›®æ ‡ IP åœ°å€æœ€è¿‘ä½¿ç”¨çš„æœåŠ¡å™¨ï¼Œè‹¥è¯¥æœåŠ¡å™¨æ˜¯å¯ç”¨çš„ä¸”æ²¡æœ‰è¶…è½½ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¯¥æœåŠ¡å™¨ï¼›è‹¥æœåŠ¡å™¨ä¸å­˜åœ¨ï¼Œæˆ–è€…è¯¥æœåŠ¡å™¨è¶…è½½ä¸”æœ‰æœåŠ¡å™¨å¤„äºŽä¸€åŠçš„å·¥ä½œè´Ÿè½½ï¼Œåˆ™ç”¨â€œæœ€å°‘é“¾æŽ¥â€ çš„åŽŸåˆ™é€‰å‡ºä¸€ä¸ªå¯ç”¨çš„æœåŠ¡å™¨ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¯¥æœåŠ¡å™¨ã€‚ å¸¦å¤åˆ¶çš„åŸºäºŽå±€éƒ¨æ€§æœ€å°‘é“¾æŽ¥ï¼ˆLocality-Based Least Connections with Replicationï¼‰ â€œå¸¦å¤åˆ¶çš„åŸºäºŽå±€éƒ¨æ€§æœ€å°‘é“¾æŽ¥â€è°ƒåº¦ç®—æ³•ä¹Ÿæ˜¯é’ˆå¯¹ç›®æ ‡ IP åœ°å€çš„è´Ÿè½½å‡è¡¡ï¼Œç›®å‰ä¸»è¦ç”¨äºŽ Cache é›†ç¾¤ç³»ç»Ÿã€‚å®ƒä¸Ž LBLC ç®—æ³•çš„ä¸åŒä¹‹å¤„æ˜¯å®ƒè¦ç»´æŠ¤ä»Žä¸€ä¸ªç›®æ ‡ IP åœ°å€åˆ°ä¸€ç»„æœåŠ¡å™¨çš„æ˜ å°„ï¼Œè€Œ LBLC ç®—æ³•ç»´æŠ¤ä»Žä¸€ä¸ªç›®æ ‡ IP åœ°å€åˆ°ä¸€å°æœåŠ¡å™¨çš„æ˜ å°„ã€‚è¯¥ç®—æ³•æ ¹æ®è¯·æ±‚çš„ç›®æ ‡ IP åœ°å€æ‰¾å‡ºè¯¥ç›®æ ‡ IP åœ°å€å¯¹åº”çš„æœåŠ¡å™¨ç»„ï¼ŒæŒ‰â€œæœ€å°è¿žæŽ¥â€åŽŸåˆ™ä»ŽæœåŠ¡å™¨ç»„ä¸­é€‰å‡ºä¸€å°æœåŠ¡å™¨ï¼Œè‹¥æœåŠ¡å™¨æ²¡æœ‰è¶…è½½ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¯¥æœåŠ¡å™¨ï¼›è‹¥æœåŠ¡å™¨è¶…è½½ï¼Œåˆ™æŒ‰â€œæœ€å°è¿žæŽ¥â€åŽŸåˆ™ä»Žè¿™ä¸ªé›†ç¾¤ä¸­é€‰å‡ºä¸€å°æœåŠ¡å™¨ï¼Œå°†è¯¥æœåŠ¡å™¨åŠ å…¥åˆ°æœåŠ¡å™¨ç»„ä¸­ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¯¥æœåŠ¡å™¨ã€‚åŒæ—¶ï¼Œå½“è¯¥æœåŠ¡å™¨ç»„æœ‰ä¸€æ®µæ—¶é—´æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œå°†æœ€å¿™çš„æœåŠ¡å™¨ä»ŽæœåŠ¡å™¨ç»„ä¸­åˆ é™¤ï¼Œä»¥é™ä½Žå¤åˆ¶çš„ç¨‹åº¦ã€‚ ç›®æ ‡åœ°å€æ•£åˆ—ï¼ˆDestination Hashingï¼‰ â€œç›®æ ‡åœ°å€æ•£åˆ—â€è°ƒåº¦ç®—æ³•æ ¹æ®è¯·æ±‚çš„ç›®æ ‡ IP åœ°å€ï¼Œä½œä¸ºæ•£åˆ—é”®ï¼ˆHash Keyï¼‰ä»Žé™æ€åˆ†é…çš„æ•£åˆ—è¡¨æ‰¾å‡ºå¯¹åº”çš„æœåŠ¡å™¨ï¼Œè‹¥è¯¥æœåŠ¡å™¨æ˜¯å¯ç”¨çš„ä¸”æœªè¶…è½½ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¯¥æœåŠ¡å™¨ï¼Œå¦åˆ™è¿”å›žç©ºã€‚ æºåœ°å€æ•£åˆ—ï¼ˆSource Hashingï¼‰ â€œæºåœ°å€æ•£åˆ—â€è°ƒåº¦ç®—æ³•æ ¹æ®è¯·æ±‚çš„æº IP åœ°å€ï¼Œä½œä¸ºæ•£åˆ—é”®ï¼ˆHash Keyï¼‰ä»Žé™æ€åˆ†é…çš„æ•£åˆ—è¡¨æ‰¾å‡ºå¯¹åº”çš„æœåŠ¡å™¨ï¼Œè‹¥è¯¥æœåŠ¡å™¨æ˜¯å¯ç”¨çš„ä¸”æœªè¶…è½½ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¯¥æœåŠ¡å™¨ï¼Œå¦åˆ™è¿”å›žç©ºã€‚ é™¤å…·å¤‡ä»¥ä¸Šè´Ÿè½½å‡è¡¡ç®—æ³•å¤–ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰å‡è¡¡ç­–ç•¥ã€‚ LVS åœºæ™¯ ä¸€èˆ¬ä½œä¸ºå…¥å£è´Ÿè½½å‡è¡¡æˆ–å†…éƒ¨è´Ÿè½½å‡è¡¡ï¼Œç»“åˆåå‘ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ã€‚ç›¸å…³æž¶æž„å¯å‚è€ƒ Ngnix åœºæ™¯æž¶æž„ã€‚ HaProxy è´Ÿè½½å‡è¡¡ HAProxy ä¹Ÿæ˜¯ä½¿ç”¨è¾ƒå¤šçš„ä¸€æ¬¾è´Ÿè½½å‡è¡¡è½¯ä»¶ã€‚HAProxy æä¾›é«˜å¯ç”¨æ€§ã€è´Ÿè½½å‡è¡¡ä»¥åŠåŸºäºŽ TCP å’Œ HTTP åº”ç”¨çš„ä»£ç†ï¼Œæ”¯æŒè™šæ‹Ÿä¸»æœºï¼Œæ˜¯å…è´¹ã€å¿«é€Ÿå¹¶ä¸”å¯é çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ç‰¹åˆ«é€‚ç”¨äºŽé‚£äº›è´Ÿè½½ç‰¹å¤§çš„ web ç«™ç‚¹ã€‚è¿è¡Œæ¨¡å¼ä½¿å¾—å®ƒå¯ä»¥å¾ˆç®€å•å®‰å…¨çš„æ•´åˆåˆ°å½“å‰çš„æž¶æž„ä¸­ï¼ŒåŒæ—¶å¯ä»¥ä¿æŠ¤ä½ çš„ web æœåŠ¡å™¨ä¸è¢«æš´éœ²åˆ°ç½‘ç»œä¸Šã€‚ HaProxy ç‰¹ç‚¹ æ”¯æŒä¸¤ç§ä»£ç†æ¨¡å¼ï¼šTCPï¼ˆå››å±‚ï¼‰å’Œ HTTPï¼ˆä¸ƒå±‚ï¼‰ï¼Œæ”¯æŒè™šæ‹Ÿä¸»æœºï¼› é…ç½®ç®€å•ï¼Œæ”¯æŒ url æ£€æµ‹åŽç«¯æœåŠ¡å™¨çŠ¶æ€ï¼› åšè´Ÿè½½å‡è¡¡è½¯ä»¶ä½¿ç”¨ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤„ç†é€Ÿåº¦é«˜äºŽ nginxï¼› TCP å±‚å¤šç”¨äºŽ Mysql ä»Žï¼ˆè¯»ï¼‰æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ã€‚ ï¼ˆå¯¹ Mysql è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå¯¹åŽç«¯çš„ DB èŠ‚ç‚¹è¿›è¡Œæ£€æµ‹å’Œè´Ÿè½½å‡è¡¡ï¼‰ èƒ½å¤Ÿè¡¥å…… Nginx çš„ä¸€äº›ç¼ºç‚¹æ¯”å¦‚ Session çš„ä¿æŒï¼ŒCookie å¼•å¯¼ç­‰å·¥ä½œ HaProxy å‡è¡¡ç­–ç•¥ æ”¯æŒå››ç§å¸¸ç”¨ç®—æ³•ï¼š roundrobinï¼šè½®è¯¢ï¼Œè½®æµåˆ†é…åˆ°åŽç«¯æœåŠ¡å™¨ï¼› static-rrï¼šæ ¹æ®åŽç«¯æœåŠ¡å™¨æ€§èƒ½åˆ†é…ï¼› leastconnï¼šæœ€å°è¿žæŽ¥è€…ä¼˜å…ˆå¤„ç†ï¼› sourceï¼šæ ¹æ®è¯·æ±‚æº IPï¼Œä¸Ž Nginx çš„ IP_Hash ç±»ä¼¼ã€‚ èµ„æ–™ å¤§åž‹ç½‘ç«™æž¶æž„ç³»åˆ—ï¼šè´Ÿè½½å‡è¡¡è¯¦è§£ï¼ˆ1ï¼‰ å¤§åž‹ç½‘ç«™æž¶æž„ç³»åˆ—ï¼šè´Ÿè½½å‡è¡¡è¯¦è§£ï¼ˆ2ï¼‰ å¤§åž‹ç½‘ç«™æž¶æž„ç³»åˆ—ï¼šè´Ÿè½½å‡è¡¡è¯¦è§£ï¼ˆ3ï¼‰ å¤§åž‹ç½‘ç«™æž¶æž„ç³»åˆ—ï¼šè´Ÿè½½å‡è¡¡è¯¦è§£ï¼ˆ4ï¼‰ https://segmentfault.com/a/1190000004492447]]></content>
      <categories>
        <category>design</category>
        <category>distributed</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>distributed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç½‘ç«™çš„é«˜æ€§èƒ½æž¶æž„]]></title>
    <url>%2Fblog%2F2018%2F07%2F05%2Fdesign%2Farchitecture%2F%E7%BD%91%E7%AB%99%E7%9A%84%E9%AB%98%E6%80%A7%E8%83%BD%E6%9E%B6%E6%9E%84%2F</url>
    <content type="text"><![CDATA[ç½‘ç«™çš„é«˜æ€§èƒ½æž¶æž„ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ 1. æ€§èƒ½æµ‹è¯• 1.1. æ€§èƒ½æŒ‡æ ‡ 1.2. æ€§èƒ½æµ‹è¯•æ–¹æ³• 1.3. æ€§èƒ½æµ‹è¯•æŠ¥å‘Š 1.4. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ 2. å‰ç«¯æ€§èƒ½ä¼˜åŒ– 2.1. æµè§ˆå™¨è®¿é—®ä¼˜åŒ– 2.2. CDN 2.3. åå‘ä»£ç† 3. åº”ç”¨æœåŠ¡æ€§èƒ½ä¼˜åŒ– 3.1. åˆ†å¸ƒå¼ç¼“å­˜ 3.2. å¼‚æ­¥æ“ä½œ 3.3. ä½¿ç”¨é›†ç¾¤ 3.4. ä»£ç ä¼˜åŒ– 4. å­˜å‚¨æ€§èƒ½ä¼˜åŒ– 4.1. æœºæ¢°é”®ç›˜å’Œå›ºæ€ç¡¬ç›˜ 4.2. B+æ•°å’Œ LSM æ ‘ 4.3. RAID å’Œ HDFS 5. èµ„æ–™ 1. æ€§èƒ½æµ‹è¯• 1.1. æ€§èƒ½æŒ‡æ ‡ ç½‘ç«™æ€§èƒ½æµ‹è¯•çš„ä¸»è¦æŒ‡æ ‡æœ‰ï¼š å“åº”æ—¶é—´ - å“åº”æ—¶é—´(RT)æ˜¯æŒ‡ä»Žå®¢æˆ·ç«¯å‘ä¸€ä¸ªè¯·æ±‚å¼€å§‹è®¡æ—¶ï¼Œåˆ°å®¢æˆ·ç«¯æŽ¥æ”¶åˆ°ä»ŽæœåŠ¡å™¨ç«¯è¿”å›žçš„å“åº”ç»“æžœç»“æŸæ‰€ç»åŽ†çš„æ—¶é—´ï¼Œå“åº”æ—¶é—´ç”±è¯·æ±‚å‘é€æ—¶é—´ã€ç½‘ç»œä¼ è¾“æ—¶é—´å’ŒæœåŠ¡å™¨å¤„ç†æ—¶é—´ä¸‰éƒ¨åˆ†ç»„æˆã€‚ å¹¶å‘æ•° - ç³»ç»ŸåŒæ—¶å¤„ç†çš„è¯·æ±‚ã€äº‹åŠ¡æ•°ã€‚ åžåé‡ - TPS(æ¯ç§’äº‹åŠ¡æ•°)ã€HPS(æ¯ç§’ HTTP è¯·æ±‚æ•°)ã€QPS(æ¯ç§’æŸ¥è¯¢æ•°)ã€‚ æ€§èƒ½è®¡æ•°å™¨ - ç³»ç»Ÿè´Ÿè½½ã€å¯¹è±¡ä¸Žçº¿ç¨‹æ•°ã€å†…å­˜ä½¿ç”¨ã€CPU ä½¿ç”¨ã€ç£ç›˜ä¸Žç½‘ç»œ IO ç­‰ã€‚è¿™äº›æŒ‡æ ‡ä¹Ÿæ˜¯ç³»ç»Ÿç›‘æŽ§çš„é‡è¦å‚æ•°ã€‚ 1.2. æ€§èƒ½æµ‹è¯•æ–¹æ³• æ€§èƒ½æµ‹è¯• è´Ÿè½½æµ‹è¯• åŽ‹åŠ›æµ‹è¯• ç¨³å®šæ€§æµ‹è¯• 1.3. æ€§èƒ½æµ‹è¯•æŠ¥å‘Š æ€§èƒ½æµ‹è¯•æŠ¥å‘Šç¤ºä¾‹ï¼š 1.4. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ æ€§èƒ½åˆ†æž - å¦‚æžœè¯·æ±‚å“åº”æ…¢ï¼Œå­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚éœ€è¦å¯¹è¯·æ±‚ç»åŽ†çš„å„ä¸ªçŽ¯èŠ‚é€ä¸€åˆ†æžï¼ŒæŽ’æŸ¥å¯èƒ½å‡ºçŽ°æ€§èƒ½ç“¶é¢ˆçš„åœ°æ–¹ï¼Œå®šä½é—®é¢˜ã€‚æ£€æŸ¥ç›‘æŽ§æ•°æ®ï¼Œåˆ†æžå½±å“æ€§èƒ½çš„ä¸»è¦å› ç´ ï¼šå†…å­˜ã€ç£ç›˜ã€ç½‘ç»œã€CPUï¼Œå¯èƒ½æ˜¯ä»£ç æˆ–æž¶æž„è®¾è®¡ä¸åˆç†ï¼Œåˆæˆ–è€…æ˜¯ç³»ç»Ÿèµ„æºç¡®å®žä¸è¶³ã€‚ æ€§èƒ½ä¼˜åŒ– - æ€§èƒ½ä¼˜åŒ–æ ¹æ®ç½‘ç«™åˆ†å±‚æž¶æž„ï¼Œå¤§è‡´å¯åˆ†ä¸ºå‰ç«¯æ€§èƒ½ä¼˜åŒ–ã€åº”ç”¨æœåŠ¡æ€§èƒ½ä¼˜åŒ–ã€å­˜å‚¨æœåŠ¡æ€§èƒ½ä¼˜åŒ–ã€‚ 2. å‰ç«¯æ€§èƒ½ä¼˜åŒ– 2.1. æµè§ˆå™¨è®¿é—®ä¼˜åŒ– å‡å°‘ HTTP è¯·æ±‚ - HTTP è¯·æ±‚éœ€è¦å»ºç«‹é€šä¿¡é“¾è·¯ï¼Œè¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œå¼€é”€é«˜æ˜‚ï¼Œæ‰€ä»¥å‡å°‘ HTTP è¯·æ±‚æ•°å¯ä»¥æœ‰æ•ˆæé«˜è®¿é—®æ€§èƒ½ã€‚å‡å°‘ HTTP çš„ä¸»è¦æ‰‹æ®µæ˜¯åˆå¹¶ Cssã€JavaScriptã€å›¾ç‰‡ã€‚ ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜ - å› ä¸ºé™æ€èµ„æºæ–‡ä»¶æ›´æ–°é¢‘çŽ‡ä½Žï¼Œå¯ä»¥ç¼“å­˜æµè§ˆå™¨ä¸­ä»¥æé«˜æ€§èƒ½ã€‚è®¾ç½® HTTP å¤´ä¸­çš„ Cache-Control å’Œ Expires å±žæ€§ï¼Œå¯ä»¥è®¾å®šæµè§ˆå™¨ç¼“å­˜ã€‚ å¯ç”¨åŽ‹ç¼© - åœ¨æœåŠ¡å™¨ç«¯åŽ‹ç¼©é™æ€èµ„æºæ–‡ä»¶ï¼Œåœ¨æµè§ˆå™¨ç«¯è§£åŽ‹ç¼©ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘ä¼ è¾“çš„æ•°æ®é‡ã€‚ç”±äºŽæ–‡æœ¬æ–‡ä»¶åŽ‹ç¼©çŽ‡å¯è¾¾ 80% ä»¥ä¸Šï¼Œæ‰€ä»¥å¯ä»¥å¯¹é™æ€èµ„æºï¼Œå¦‚ Htmlã€Cssã€JavaScrip è¿›è¡ŒåŽ‹ç¼©ã€‚ CSS æ”¾åœ¨é¡µé¢æœ€ä¸Šé¢ï¼ŒJavaScript æ”¾åœ¨é¡µé¢æœ€ä¸‹é¢ - æµè§ˆå™¨ä¼šåœ¨ä¸‹è½½å®Œå…¨éƒ¨çš„ Css åŽæ‰å¯¹æ•´ä¸ªé¡µé¢è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥æœ€å¥½çš„åšæ³•æ˜¯å°† Css æ”¾åœ¨é¡µé¢æœ€ä¸Šé¢ï¼Œè®©æµè§ˆå™¨å°½å¿«ä¸‹è½½ Cssï¼›JavaScript åˆ™ç›¸åï¼Œæµè§ˆå™¨åŠ è½½ JavaScript åŽç«‹å³æ‰§è¡Œï¼Œå¯èƒ½ä¼šé˜»å¡žæ•´ä¸ªé¡µé¢ï¼Œé€ æˆé¡µé¢æ˜¾ç¤ºç¼“æ…¢ï¼Œå› æ­¤ JavaScript æœ€å¥½æ”¾åœ¨é¡µé¢æœ€ä¸‹é¢ã€‚ å‡å°‘ Cookie ä¼ è¾“ - Cookie åŒ…å«åœ¨ HTTP æ¯æ¬¡çš„è¯·æ±‚å’Œå“åº”ä¸­ï¼Œå¤ªå¤§çš„ Cookie ä¼šä¸¥é‡å½±å“æ•°æ®ä¼ è¾“ã€‚ 2.2. CDN CDN ä¸€èˆ¬ç¼“å­˜çš„æ˜¯é™æ€èµ„æºã€‚ CDN çš„æœ¬è´¨ä»ç„¶æ˜¯ä¸€ä¸ªç¼“å­˜ï¼Œè€Œä¸”å°†æ•°æ®ç¼“å­˜åœ¨ç¦»ç”¨æˆ·æœ€è¿‘çš„åœ°æ–¹ï¼Œä½¿ç”¨æˆ·å·²æœ€å¿«é€Ÿåº¦èŽ·å–æ•°æ®ï¼Œå³æ‰€è°“ç½‘ç»œè®¿é—®ç¬¬ä¸€è·³ã€‚ 2.3. åå‘ä»£ç† ä¼ ç»Ÿä»£ç†æœåŠ¡å™¨ä½äºŽæµè§ˆå™¨ä¸€ä¾§ï¼Œä»£ç†æµè§ˆå™¨å°† HTTP è¯·æ±‚å‘é€åˆ°äº’è”ç½‘ä¸Šï¼Œè€Œåå‘ä»£ç†æœåŠ¡å™¨ä½äºŽç½‘ç«™æœºæˆ¿ä¸€ä¾§ï¼Œä»£ç†ç½‘ç«™æœåŠ¡å™¨æŽ¥æ”¶ HTTP è¯·æ±‚ã€‚ åå‘ä»£ç†æœåŠ¡å™¨å¯ä»¥é…ç½®ç¼“å­˜åŠŸèƒ½åŠ é€Ÿ Web è¯·æ±‚ï¼Œå½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®é™æ€å†…å®¹æ—¶ï¼Œé™æ€å†…å®¹å°±ä¼šè¢«ç¼“å­˜åœ¨åå‘ä»£ç†æœåŠ¡å™¨ä¸Šã€‚ åå‘ä»£ç†è¿˜å¯ä»¥å®žçŽ°è´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡æž„å»ºçš„é›†ç¾¤å¯ä»¥æé«˜ç³»ç»Ÿæ€»ä½“å¤„ç†èƒ½åŠ›ã€‚ å› ä¸ºæ‰€æœ‰è¯·æ±‚éƒ½å¿…é¡»å…ˆç»è¿‡åå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ‰€ä»¥å¯ä»¥å±è”½ä¸€äº›æ”»å‡» IPï¼Œè¾¾åˆ°ä¿æŠ¤ç½‘ç«™å®‰å…¨çš„ä½œç”¨ã€‚ 3. åº”ç”¨æœåŠ¡æ€§èƒ½ä¼˜åŒ– 3.1. åˆ†å¸ƒå¼ç¼“å­˜ ç½‘ç«™æ€§èƒ½ä¼˜åŒ–ç¬¬ä¸€å®šå¾‹ï¼šä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ç¼“å­˜ä¼˜åŒ–æ€§èƒ½ã€‚ ç¼“å­˜åŽŸç† ç¼“å­˜æŒ‡å°†æ•°æ®å­˜å‚¨åœ¨ç›¸å¯¹è¾ƒé«˜è®¿é—®é€Ÿåº¦çš„å­˜å‚¨ä»‹è´¨ä¸­ï¼Œä»¥ä¾›ç³»ç»Ÿå¤„ç†ã€‚ä¸€æ–¹é¢ç¼“å­˜è®¿é—®é€Ÿåº¦å¿«ï¼Œå¯ä»¥å‡å°‘æ•°æ®è®¿é—®çš„æ—¶é—´ï¼Œå¦ä¸€æ–¹é¢å¦‚æžœç¼“å­˜çš„æ•°æ®æ˜¯ç»è¿‡è®¡ç®—å¤„ç†å¾—åˆ°çš„ï¼Œé‚£ä¹ˆè¢«ç¼“å­˜çš„æ•°æ®æ— éœ€é‡å¤è®¡ç®—å³å¯ç›´æŽ¥ä½¿ç”¨ï¼Œå› æ­¤ç¼“å­˜è¿˜èµ·åˆ°å‡å°‘è®¡ç®—æ—¶é—´çš„ä½œç”¨ã€‚ ç¼“å­˜çš„æœ¬è´¨æ˜¯ä¸€ä¸ªå†…å­˜ HASH è¡¨ã€‚ ç¼“å­˜ä¸»è¦ç”¨æ¥å­˜æ”¾é‚£äº›è¯»å†™æ¯”å¾ˆé«˜ã€å¾ˆå°‘å˜åŒ–çš„æ•°æ®ï¼Œå¦‚å•†å“çš„ç±»ç›®ä¿¡æ¯ï¼Œçƒ­é—¨è¯çš„æœç´¢åˆ—è¡¨ä¿¡æ¯ã€çƒ­é—¨å•†å“ä¿¡æ¯ç­‰ã€‚ åˆç†ä½¿ç”¨ç¼“å­˜ ç¼“å­˜æ•°æ®çš„é€‰æ‹©ï¼š ä¸è¦å­˜å‚¨é¢‘ç¹ä¿®æ”¹çš„æ•°æ® ä¸è¦å­˜å‚¨éžçƒ­ç‚¹æ•°æ® æ•°æ®ä¸ä¸€è‡´å’Œè„è¯»ï¼š ç¼“å­˜æœ‰æœ‰æ•ˆæœŸï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šæ—¶é—´çš„æ•°æ®ä¸ä¸€è‡´å’Œè„è¯»é—®é¢˜ã€‚å¦‚æžœä¸èƒ½æŽ¥å—ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ•°æ®æ›´æ–°ç«‹å³æ›´æ–°ç¼“å­˜ç­–ç•¥ éœ€è¦è€ƒè™‘ç¼“å­˜é—®é¢˜ï¼šç¼“å­˜é›ªå´©ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜é¢„çƒ­ 3.2. å¼‚æ­¥æ“ä½œ å¼‚æ­¥å¤„ç†ä¸€èˆ¬æ˜¯é€šè¿‡åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ã€‚ å¼‚æ­¥å¤„ç†å¯ä»¥è§£å†³ä¸€ä¸‹é—®é¢˜ï¼š å¼‚æ­¥å¤„ç† åº”ç”¨è§£è€¦ æµé‡å‰Šé”‹ æ—¥å¿—å¤„ç† æ¶ˆæ¯é€šè®¯ 3.3. ä½¿ç”¨é›†ç¾¤ åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡æŠ€æœ¯ä¸ºä¸€ä¸ªåº”ç”¨æž„å»ºä¸€ä¸ªç”±å¤šå°æœåŠ¡å™¨ç»„æˆçš„æœåŠ¡å™¨é›†ç¾¤ï¼Œå°†å¹¶å‘è®¿é—®è¯·æ±‚åˆ†å‘åˆ°å¤šå°æœåŠ¡å™¨ä¸Šå¤„ç†ï¼Œé¿å…å•ä¸€æœåŠ¡å™¨å› è´Ÿè½½åŽ‹åŠ›è¿‡å¤§è€Œå“åº”ç¼“æ…¢ï¼Œä½¿ç”¨æˆ·è¯·æ±‚å…·æœ‰æ›´å¥½çš„å“åº”å»¶è¿Ÿç‰¹æ€§ã€‚ 3.4. ä»£ç ä¼˜åŒ– å¤šçº¿ç¨‹ ä»Žèµ„æºåˆ©ç”¨çš„è§’åº¦çœ‹ï¼Œä½¿ç”¨å¤šçº¿ç¨‹çš„åŽŸå› ä¸»è¦æœ‰ä¸¤ä¸ªï¼šIO é˜»å¡žå’Œå¤š CPUã€‚ çº¿ç¨‹æ•°å¹¶éžè¶Šå¤šè¶Šå¥½ï¼Œé‚£ä¹ˆå¯åŠ¨å¤šå°‘çº¿ç¨‹åˆé€‚å‘¢ï¼Ÿ æœ‰ä¸ªå‚è€ƒå…¬å¼ï¼š å¯åŠ¨çº¿ç¨‹æ•° = (ä»»åŠ¡æ‰§è¡Œæ—¶é—´ / (ä»»åŠ¡æ‰§è¡Œæ—¶é—´ - IO ç­‰å¾…æ—¶é—´)) * CPU å†…æ ¸æ•° æœ€ä½³å¯åŠ¨çº¿ç¨‹æ•°å’Œ CPU å†…æ ¸æ•°æˆæ­£æ¯”ï¼Œå’Œ IO é˜»å¡žæ—¶é—´æˆåæ¯”ã€‚å¦‚æžœä»»åŠ¡éƒ½æ˜¯ CPU è®¡ç®—åž‹ä»»åŠ¡ï¼Œé‚£ä¹ˆçº¿ç¨‹æ•°æœ€å¤šä¸è¦è¶…è¿‡ CPU å†…æ ¸æ•°ï¼Œå› ä¸ºå¯åŠ¨å†å¤šçº¿ç¨‹ï¼ŒCPU ä¹Ÿæ¥ä¸åŠè°ƒåº¦ï¼›ç›¸åå¦‚æžœæ˜¯ä»»åŠ¡éœ€è¦ç­‰å¾…ç£ç›˜æ“ä½œï¼Œç½‘ç»œå“åº”ï¼Œé‚£ä¹ˆå¤šå¯åŠ¨çº¿ç¨‹æœ‰åŠ©äºŽä»»åŠ¡å¹¶ç½šèµŒï¼Œæé«˜ç³»ç»Ÿåžåé‡ã€‚ çº¿ç¨‹å®‰å…¨é—®é¢˜ å°†å¯¹è±¡è®¾è®¡ä¸ºæ— çŠ¶æ€å¯¹è±¡ ä½¿ç”¨å±€éƒ¨å¯¹è±¡ å¹¶å‘è®¿é—®èµ„æºæ—¶ä½¿ç”¨é” èµ„æºå¤ç”¨ åº”è¯¥å°½é‡å‡å°‘é‚£äº›å¼€é”€å¾ˆå¤§çš„ç³»ç»Ÿèµ„æºçš„åˆ›å»ºå’Œé”€æ¯ï¼Œå¦‚æ•°æ®åº“è¿žæŽ¥ã€ç½‘ç»œé€šä¿¡è¿žæŽ¥ã€çº¿ç¨‹ã€å¤æ‚å¯¹è±¡ç­‰ã€‚ä»Žç¼–ç¨‹è§’åº¦ï¼Œèµ„æºå¤ç”¨ä¸»è¦æœ‰ä¸¤ç§æ¨¡å¼ï¼šå•ä¾‹æ¨¡å¼å’Œå¯¹è±¡æ± ã€‚ æ•°æ®ç»“æž„ æ ¹æ®å…·ä½“åœºæ™¯ï¼Œé€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æž„ã€‚ åžƒåœ¾å›žæ”¶ å¦‚æžœ Web åº”ç”¨è¿è¡Œåœ¨ JVM ç­‰å…·æœ‰åžƒåœ¾å›žæ”¶åŠŸèƒ½çš„çŽ¯å¢ƒä¸­ï¼Œé‚£ä¹ˆåžƒåœ¾å›žæ”¶å¯èƒ½ä¼šå¯¹ç³»ç»Ÿçš„æ€§èƒ½ç‰¹æ€§äº§ç”Ÿå·¨å¤§å½±å“ã€‚ç«‹å³åžƒåœ¾å›žæ”¶æœºåˆ¶æœ‰åŠ©äºŽç¨‹åºä¼˜åŒ–å’Œå‚æ•°è°ƒä¼˜ï¼Œä»¥åŠç¼–å†™å†…å­˜å®‰å…¨çš„ä»£ç ã€‚ 4. å­˜å‚¨æ€§èƒ½ä¼˜åŒ– 4.1. æœºæ¢°é”®ç›˜å’Œå›ºæ€ç¡¬ç›˜ è€ƒè™‘ä½¿ç”¨å›ºæ€ç¡¬ç›˜æ›¿ä»£æœºæ¢°é”®ç›˜ï¼Œå› ä¸ºå®ƒçš„è¯»å†™é€Ÿåº¦æ›´å¿«ã€‚ 4.2. B+æ•°å’Œ LSM æ ‘ ä¼ ç»Ÿå…³ç³»æ•°æ®åº“çš„æ•°æ®åº“ç´¢å¼•ä¸€èˆ¬éƒ½ä½¿ç”¨ä¸¤çº§ç´¢å¼•çš„ B+ æ ‘ç»“æž„ï¼Œæ ‘çš„å±‚æ¬¡æœ€å¤šä¸‰å±‚ã€‚å› æ­¤å¯èƒ½éœ€è¦ 5 æ¬¡ç£ç›˜è®¿é—®æ‰èƒ½æ›´æ–°ä¸€æ¡è®°å½•ï¼ˆä¸‰æ¬¡ç£ç›˜è®¿é—®èŽ·å¾—æ•°æ®ç´¢å¼•åŠè¡Œ IDï¼Œç„¶åŽå†è¿›è¡Œä¸€æ¬¡æ•°æ®æ–‡ä»¶è¯»æ“ä½œåŠä¸€æ¬¡æ•°æ®æ–‡ä»¶å†™æ“ä½œï¼‰ã€‚ ç”±äºŽç£ç›˜è®¿é—®æ˜¯éšæœºçš„ï¼Œä¼ ç»Ÿæœºæ¢°é”®ç›˜åœ¨æ•°æ®éšæœºè®¿é—®æ—¶æ€§èƒ½è¾ƒå·®ï¼Œæ¯æ¬¡æ•°æ®è®¿é—®éƒ½éœ€è¦å¤šæ¬¡è®¿é—®ç£ç›˜å½±å“æ•°æ®è®¿é—®æ€§èƒ½ã€‚ è®¸å¤š Nosql æ•°æ®åº“ä¸­çš„ç´¢å¼•é‡‡ç”¨ LSM æ ‘ä½œä¸ºä¸»è¦æ•°æ®ç»“æž„ã€‚LSM æ ‘å¯è§†ä¸ºä¸€ä¸ª N é˜¶åˆå¹¶æ ‘ã€‚æ•°æ®å†™æ“ä½œéƒ½åœ¨å†…å­˜ä¸­è¿›è¡Œã€‚åœ¨ LSM æ ‘ä¸Šè¿›è¡Œä¸€æ¬¡æ•°æ®æ›´æ–°ä¸éœ€è¦ç£ç›˜è®¿é—®ï¼Œé€Ÿåº¦è¿œå¿«äºŽ B+ æ ‘ã€‚ 4.3. RAID å’Œ HDFS HDFS(åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ) æ›´è¢«å¤§åž‹ç½‘ç«™æ‰€é’çã€‚å®ƒå¯ä»¥é…åˆ MapReduce å¹¶å‘è®¡ç®—ä»»åŠ¡æ¡†æž¶è¿›è¡Œå¤§æ•°æ®å¤„ç†ï¼Œå¯ä»¥åœ¨æ•´ä¸ªé›†ç¾¤ä¸Šå¹¶å‘è®¿é—®æ‰€æœ‰ç£ç›˜ï¼Œæ— éœ€ RAID æ”¯æŒã€‚ 5. èµ„æ–™ å¤§åž‹ç½‘ç«™æŠ€æœ¯æž¶æž„]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤§åž‹åˆ†å¸ƒå¼ç½‘ç«™æž¶æž„]]></title>
    <url>%2Fblog%2F2018%2F07%2F05%2Fdesign%2Farchitecture%2F%E5%A4%A7%E5%9E%8B%E5%88%86%E5%B8%83%E5%BC%8F%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%2F</url>
    <content type="text"><![CDATA[å¤§åž‹åˆ†å¸ƒå¼ç½‘ç«™æž¶æž„ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ 1. å¤§åž‹åˆ†å¸ƒå¼ç½‘ç«™æž¶æž„æ¦‚è¿° 1.1. å¤§åž‹ç½‘ç«™çš„ç‰¹ç‚¹ 1.2. å¤§åž‹ç½‘ç«™æž¶æž„ç›®æ ‡ 1.3. å¤§åž‹ç½‘ç«™æž¶æž„æ¨¡å¼ 1.4. é«˜æ€§èƒ½æž¶æž„ 1.5. é«˜å¯ç”¨æž¶æž„ 1.6. å¯ä¼¸ç¼©æž¶æž„ 1.7. å¯æ‰©å±•æž¶æž„ 1.8. å®‰å…¨æž¶æž„ 1.9. æ•æ·æ€§ 1.10. å¤§åž‹æž¶æž„ä¸¾ä¾‹ 2. ç”µå•†ç½‘ç«™æž¶æž„æ¡ˆä¾‹ 2.1. ç½‘ç«™åˆçº§æž¶æž„ 2.2. ç³»ç»Ÿå®¹é‡é¢„ä¼° 2.3. ç½‘ç«™æž¶æž„åˆ†æž 2.4. ç½‘ç«™æž¶æž„ä¼˜åŒ– 2.5. æž¶æž„æ€»ç»“ 3. èµ„æ–™ 1. å¤§åž‹åˆ†å¸ƒå¼ç½‘ç«™æž¶æž„æ¦‚è¿° 1.1. å¤§åž‹ç½‘ç«™çš„ç‰¹ç‚¹ ç”¨æˆ·å¤šï¼Œåˆ†å¸ƒå¹¿æ³› å¤§æµé‡ï¼Œé«˜å¹¶å‘ æµ·é‡æ•°æ®ï¼ŒæœåŠ¡é«˜å¯ç”¨ å®‰å…¨çŽ¯å¢ƒæ¶åŠ£ï¼Œæ˜“å—ç½‘ç»œæ”»å‡» åŠŸèƒ½å¤šï¼Œå˜æ›´å¿«ï¼Œé¢‘ç¹å‘å¸ƒ ä»Žå°åˆ°å¤§ï¼Œæ¸è¿›å‘å±• ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒ å…è´¹æœåŠ¡ï¼Œä»˜è´¹ä½“éªŒ 1.2. å¤§åž‹ç½‘ç«™æž¶æž„ç›®æ ‡ é«˜æ€§èƒ½ï¼šæä¾›å¿«é€Ÿçš„è®¿é—®ä½“éªŒã€‚ é«˜å¯ç”¨ï¼šç½‘ç«™æœåŠ¡ä¸€ç›´å¯ä»¥æ­£å¸¸è®¿é—®ã€‚ å¯ä¼¸ç¼©ï¼šé€šè¿‡ç¡¬ä»¶å¢žåŠ /å‡å°‘ï¼Œæé«˜/é™ä½Žå¤„ç†èƒ½åŠ›ã€‚ å®‰å…¨æ€§ï¼šæä¾›ç½‘ç«™å®‰å…¨è®¿é—®å’Œæ•°æ®åŠ å¯†ï¼Œå®‰å…¨å­˜å‚¨ç­‰ç­–ç•¥ã€‚ æ‰©å±•æ€§ï¼šæ–¹ä¾¿çš„é€šè¿‡æ–°å¢ž/ç§»é™¤æ–¹å¼ï¼Œå¢žåŠ /å‡å°‘æ–°çš„åŠŸèƒ½/æ¨¡å—ã€‚ æ•æ·æ€§ï¼šéšéœ€åº”å˜ï¼Œå¿«é€Ÿå“åº”ï¼› 1.3. å¤§åž‹ç½‘ç«™æž¶æž„æ¨¡å¼ åˆ†å±‚ï¼šä¸€èˆ¬å¯åˆ†ä¸ºï¼Œåº”ç”¨å±‚ï¼ŒæœåŠ¡å±‚ï¼Œæ•°æ®å±‚ï¼Œç®¡ç†å±‚ï¼Œåˆ†æžå±‚ï¼› åˆ†å‰²ï¼šä¸€èˆ¬æŒ‰ç…§ä¸šåŠ¡/æ¨¡å—/åŠŸèƒ½ç‰¹ç‚¹è¿›è¡Œåˆ’åˆ†ï¼Œæ¯”å¦‚åº”ç”¨å±‚åˆ†ä¸ºé¦–é¡µï¼Œç”¨æˆ·ä¸­å¿ƒã€‚ åˆ†å¸ƒå¼ï¼šå°†åº”ç”¨åˆ†å¼€éƒ¨ç½²ï¼ˆæ¯”å¦‚å¤šå°ç‰©ç†æœºï¼‰ï¼Œé€šè¿‡è¿œç¨‹è°ƒç”¨ååŒå·¥ä½œã€‚ é›†ç¾¤ï¼šä¸€ä¸ªåº”ç”¨/æ¨¡å—/åŠŸèƒ½éƒ¨ç½²å¤šä»½ï¼ˆå¦‚ï¼šå¤šå°ç‰©ç†æœºï¼‰ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡å…±åŒæä¾›å¯¹å¤–è®¿é—®ã€‚ ç¼“å­˜ï¼šå°†æ•°æ®æ”¾åœ¨è·ç¦»åº”ç”¨æˆ–ç”¨æˆ·æœ€è¿‘çš„ä½ç½®ï¼ŒåŠ å¿«è®¿é—®é€Ÿåº¦ã€‚ å¼‚æ­¥ï¼šå°†åŒæ­¥çš„æ“ä½œå¼‚æ­¥åŒ–ã€‚å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚ï¼Œä¸ç­‰å¾…æœåŠ¡ç«¯å“åº”ï¼Œç­‰æœåŠ¡ç«¯å¤„ç†å®Œæ¯•åŽï¼Œä½¿ç”¨é€šçŸ¥æˆ–è½®è¯¢çš„æ–¹å¼å‘ŠçŸ¥è¯·æ±‚æ–¹ã€‚ä¸€èˆ¬æŒ‡ï¼šè¯·æ±‚â€”â€”å“åº”â€”â€”é€šçŸ¥ æ¨¡å¼ã€‚ å†—ä½™ï¼šå¢žåŠ å‰¯æœ¬ï¼Œæé«˜å¯ç”¨æ€§ï¼Œå®‰å…¨æ€§ï¼Œæ€§èƒ½ã€‚ å®‰å…¨ï¼šå¯¹å·²çŸ¥é—®é¢˜æœ‰æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œå¯¹æœªçŸ¥/æ½œåœ¨é—®é¢˜å»ºç«‹å‘çŽ°å’Œé˜²å¾¡æœºåˆ¶ã€‚ è‡ªåŠ¨åŒ–ï¼šå°†é‡å¤çš„ï¼Œä¸éœ€è¦äººå·¥å‚ä¸Žçš„äº‹æƒ…ï¼Œé€šè¿‡å·¥å…·çš„æ–¹å¼ï¼Œä½¿ç”¨æœºå™¨å®Œæˆã€‚ æ•æ·æ€§ï¼šç§¯æžæŽ¥å—éœ€æ±‚å˜æ›´ï¼Œå¿«é€Ÿå“åº”ä¸šåŠ¡å‘å±•éœ€æ±‚ã€‚ 1.4. é«˜æ€§èƒ½æž¶æž„ ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒï¼Œæä¾›å¿«é€Ÿçš„ç½‘é¡µè®¿é—®ä½“éªŒã€‚ä¸»è¦å‚æ•°æœ‰è¾ƒçŸ­çš„å“åº”æ—¶é—´ï¼Œè¾ƒå¤§çš„å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œè¾ƒé«˜çš„åžåé‡ï¼Œç¨³å®šçš„æ€§èƒ½å‚æ•°ã€‚ å¯åˆ†ä¸ºå‰ç«¯ä¼˜åŒ–ï¼Œåº”ç”¨å±‚ä¼˜åŒ–ï¼Œä»£ç å±‚ä¼˜åŒ–ï¼Œå­˜å‚¨å±‚ä¼˜åŒ–ã€‚ å‰ç«¯ä¼˜åŒ–ï¼šç½‘ç«™ä¸šåŠ¡é€»è¾‘ä¹‹å‰çš„éƒ¨åˆ†ï¼› æµè§ˆå™¨ä¼˜åŒ–ï¼šå‡å°‘ Http è¯·æ±‚æ•°ï¼Œä½¿ç”¨æµè§ˆå™¨ç¼“å­˜ï¼Œå¯ç”¨åŽ‹ç¼©ï¼ŒCss Js ä½ç½®ï¼ŒJs å¼‚æ­¥ï¼Œå‡å°‘ Cookie ä¼ è¾“ï¼› CDN åŠ é€Ÿï¼Œåå‘ä»£ç†ï¼› åº”ç”¨å±‚ä¼˜åŒ–ï¼šå¤„ç†ç½‘ç«™ä¸šåŠ¡çš„æœåŠ¡å™¨ã€‚ä½¿ç”¨ç¼“å­˜ï¼Œå¼‚æ­¥ï¼Œé›†ç¾¤ ä»£ç ä¼˜åŒ–ï¼šåˆç†çš„æž¶æž„ï¼Œå¤šçº¿ç¨‹ï¼Œèµ„æºå¤ç”¨ï¼ˆå¯¹è±¡æ± ï¼Œçº¿ç¨‹æ± ç­‰ï¼‰ï¼Œè‰¯å¥½çš„æ•°æ®ç»“æž„ï¼ŒJVM è°ƒä¼˜ï¼Œå•ä¾‹ï¼ŒCache ç­‰ï¼› å­˜å‚¨ä¼˜åŒ–ï¼šç¼“å­˜ï¼Œå›ºæ€ç¡¬ç›˜ï¼Œå…‰çº¤ä¼ è¾“ï¼Œä¼˜åŒ–è¯»å†™ï¼Œç£ç›˜å†—ä½™ï¼Œåˆ†å¸ƒå¼å­˜å‚¨ï¼ˆHDFSï¼‰ï¼ŒNOSQL ç­‰ï¼› 1.5. é«˜å¯ç”¨æž¶æž„ å¤§åž‹ç½‘ç«™åº”è¯¥åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥æ­£å¸¸è®¿é—®ã€‚æ­£å¸¸æä¾›å¯¹å¤–æœåŠ¡ã€‚å› ä¸ºå¤§åž‹ç½‘ç«™çš„å¤æ‚æ€§ï¼Œåˆ†å¸ƒå¼ï¼Œå»‰ä»·æœåŠ¡å™¨ï¼Œå¼€æºæ•°æ®åº“ï¼Œæ“ä½œç³»ç»Ÿç­‰ç‰¹ç‚¹ã€‚è¦ä¿è¯é«˜å¯ç”¨æ˜¯å¾ˆå›°éš¾çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç½‘ç«™çš„æ•…éšœæ˜¯ä¸å¯é¿å…çš„ã€‚ å¦‚ä½•æé«˜å¯ç”¨æ€§ï¼Œå°±æ˜¯éœ€è¦è¿«åˆ‡è§£å†³çš„é—®é¢˜ã€‚é¦–å…ˆï¼Œéœ€è¦ä»Žæž¶æž„çº§åˆ«ï¼Œåœ¨è§„åˆ’çš„æ—¶å€™ï¼Œå°±è€ƒè™‘å¯ç”¨æ€§ã€‚è¡Œä¸šå†…ä¸€èˆ¬ç”¨å‡ ä¸ª 9 è¡¨ç¤ºå¯ç”¨æ€§æŒ‡æ ‡ã€‚æ¯”å¦‚å››ä¸ª 9ï¼ˆ99.99ï¼‰ï¼Œä¸€å¹´å†…å…è®¸çš„ä¸å¯ç”¨æ—¶é—´æ˜¯ 53 åˆ†é’Ÿã€‚ ä¸åŒå±‚çº§ä½¿ç”¨çš„ç­–ç•¥ä¸åŒï¼Œä¸€èˆ¬é‡‡ç”¨å†—ä½™å¤‡ä»½å’Œå¤±æ•ˆè½¬ç§»è§£å†³é«˜å¯ç”¨é—®é¢˜ã€‚ åº”ç”¨å±‚ï¼šä¸€èˆ¬è®¾è®¡ä¸ºæ— çŠ¶æ€çš„ï¼Œå¯¹äºŽæ¯æ¬¡è¯·æ±‚ï¼Œä½¿ç”¨å“ªä¸€å°æœåŠ¡å™¨å¤„ç†æ˜¯æ²¡æœ‰å½±å“çš„ã€‚ä¸€èˆ¬ä½¿ç”¨è´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼ˆéœ€è¦è§£å†³ Session åŒæ­¥é—®é¢˜ï¼‰ï¼Œå®žçŽ°é«˜å¯ç”¨ã€‚ æœåŠ¡å±‚ï¼šè´Ÿè½½å‡è¡¡ï¼Œåˆ†çº§ç®¡ç†ï¼Œå¿«é€Ÿå¤±è´¥ï¼ˆè¶…æ—¶è®¾ç½®ï¼‰ï¼Œå¼‚æ­¥è°ƒç”¨ï¼ŒæœåŠ¡é™çº§ï¼Œå¹‚ç­‰è®¾è®¡ç­‰ã€‚ æ•°æ®å±‚ï¼šå†—ä½™å¤‡ä»½ï¼ˆå†·ï¼Œçƒ­å¤‡[åŒæ­¥ï¼Œå¼‚æ­¥]ï¼Œæ¸©å¤‡ï¼‰ï¼Œå¤±æ•ˆè½¬ç§»ï¼ˆç¡®è®¤ï¼Œè½¬ç§»ï¼Œæ¢å¤ï¼‰ã€‚æ•°æ®é«˜å¯ç”¨æ–¹é¢è‘—åçš„ç†è®ºåŸºç¡€æ˜¯ CAP ç†è®ºï¼ˆæŒä¹…æ€§ï¼Œå¯ç”¨æ€§ï¼Œæ•°æ®ä¸€è‡´æ€§[å¼ºä¸€è‡´ï¼Œç”¨æˆ·ä¸€è‡´ï¼Œæœ€ç»ˆä¸€è‡´]ï¼‰ 1.6. å¯ä¼¸ç¼©æž¶æž„ ä¼¸ç¼©æ€§æ˜¯æŒ‡åœ¨ä¸æ”¹å˜åŽŸæœ‰æž¶æž„è®¾è®¡çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡æ·»åŠ /å‡å°‘ç¡¬ä»¶ï¼ˆæœåŠ¡å™¨ï¼‰çš„æ–¹å¼ï¼Œæé«˜/é™ä½Žç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚ åº”ç”¨å±‚ï¼šå¯¹åº”ç”¨è¿›è¡Œåž‚ç›´æˆ–æ°´å¹³åˆ‡åˆ†ã€‚ç„¶åŽé’ˆå¯¹å•ä¸€åŠŸèƒ½è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼ˆDNS,HTTP[åå‘ä»£ç†],IP,é“¾è·¯å±‚ï¼‰ã€‚ æœåŠ¡å±‚ï¼šä¸Žåº”ç”¨å±‚ç±»ä¼¼ï¼› æ•°æ®å±‚ï¼šåˆ†åº“ï¼Œåˆ†è¡¨ï¼ŒNOSQL ç­‰ï¼›å¸¸ç”¨ç®—æ³• Hashï¼Œä¸€è‡´æ€§ Hashã€‚ 1.7. å¯æ‰©å±•æž¶æž„ å¯ä»¥æ–¹ä¾¿çš„è¿›è¡ŒåŠŸèƒ½æ¨¡å—çš„æ–°å¢ž/ç§»é™¤ï¼Œæä¾›ä»£ç /æ¨¡å—çº§åˆ«è‰¯å¥½çš„å¯æ‰©å±•æ€§ã€‚ æ¨¡å—åŒ–ï¼Œç»„ä»¶åŒ–ï¼šé«˜å†…èšï¼Œå†…è€¦åˆï¼Œæé«˜å¤ç”¨æ€§ï¼Œæ‰©å±•æ€§ã€‚ ç¨³å®šæŽ¥å£ï¼šå®šä¹‰ç¨³å®šçš„æŽ¥å£ï¼Œåœ¨æŽ¥å£ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå†…éƒ¨ç»“æž„å¯ä»¥â€œéšæ„â€å˜åŒ–ã€‚ è®¾è®¡æ¨¡å¼ï¼šåº”ç”¨é¢å‘å¯¹è±¡æ€æƒ³ï¼ŒåŽŸåˆ™ï¼Œä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Œè¿›è¡Œä»£ç å±‚é¢çš„è®¾è®¡ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ï¼šæ¨¡å—åŒ–çš„ç³»ç»Ÿï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œäº¤äº’ï¼Œä½¿æ¨¡å—ä¹‹é—´çš„ä¾èµ–è§£è€¦ã€‚ åˆ†å¸ƒå¼æœåŠ¡ï¼šå…¬ç”¨æ¨¡å—æœåŠ¡åŒ–ï¼Œæä¾›å…¶ä»–ç³»ç»Ÿä½¿ç”¨ï¼Œæé«˜å¯é‡ç”¨æ€§ï¼Œæ‰©å±•æ€§ã€‚ 1.8. å®‰å…¨æž¶æž„ å¯¹å·²çŸ¥é—®é¢˜æœ‰æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œå¯¹æœªçŸ¥/æ½œåœ¨é—®é¢˜å»ºç«‹å‘çŽ°å’Œé˜²å¾¡æœºåˆ¶ã€‚å¯¹äºŽå®‰å…¨é—®é¢˜ï¼Œé¦–å…ˆè¦æé«˜å®‰å…¨æ„è¯†ï¼Œå»ºç«‹ä¸€ä¸ªå®‰å…¨çš„æœ‰æ•ˆæœºåˆ¶ï¼Œä»Žæ”¿ç­–å±‚é¢ï¼Œç»„ç»‡å±‚é¢è¿›è¡Œä¿éšœã€‚æ¯”å¦‚æœåŠ¡å™¨å¯†ç ä¸èƒ½æ³„éœ²ï¼Œå¯†ç æ¯æœˆæ›´æ–°ï¼Œå¹¶ä¸”ä¸‰æ¬¡å†…ä¸èƒ½é‡å¤ï¼›æ¯å‘¨å®‰å…¨æ‰«æç­‰ã€‚ä»¥åˆ¶åº¦åŒ–çš„æ–¹å¼ï¼ŒåŠ å¼ºå®‰å…¨ä½“ç³»çš„å»ºè®¾ã€‚åŒæ—¶ï¼Œéœ€è¦æ³¨æ„ä¸Žå®‰å…¨æœ‰å…³çš„å„ä¸ªçŽ¯èŠ‚ã€‚å®‰å…¨é—®é¢˜ä¸å®¹å¿½è§†ã€‚åŒ…æ‹¬åŸºç¡€è®¾æ–½å®‰å…¨ï¼Œåº”ç”¨ç³»ç»Ÿå®‰å…¨ï¼Œæ•°æ®ä¿å¯†å®‰å…¨ç­‰ã€‚ åŸºç¡€è®¾æ–½å®‰å…¨ï¼šç¡¬ä»¶é‡‡è´­ï¼Œæ“ä½œç³»ç»Ÿï¼Œç½‘ç»œçŽ¯å¢ƒæ–¹é¢çš„å®‰å…¨ã€‚ä¸€èˆ¬é‡‡ç”¨ï¼Œæ­£è§„æ¸ é“è´­ä¹°é«˜è´¨é‡çš„äº§å“ï¼Œé€‰æ‹©å®‰å…¨çš„æ“ä½œç³»ç»Ÿï¼ŒåŠæ—¶ä¿®è¡¥æ¼æ´žï¼Œå®‰è£…æ€æ¯’è½¯ä»¶é˜²ç«å¢™ã€‚é˜²èŒƒç—…æ¯’ï¼ŒåŽé—¨ã€‚è®¾ç½®é˜²ç«å¢™ç­–ç•¥ï¼Œå»ºç«‹ DDOS é˜²å¾¡ç³»ç»Ÿï¼Œä½¿ç”¨æ”»å‡»æ£€æµ‹ç³»ç»Ÿï¼Œè¿›è¡Œ å­ç½‘éš”ç¦»ç­‰æ‰‹æ®µã€‚ â€‹ åº”ç”¨ç³»ç»Ÿå®‰å…¨ï¼šåœ¨ç¨‹åºå¼€å‘æ—¶ï¼Œå¯¹å·²çŸ¥å¸¸ç”¨é—®é¢˜ï¼Œä½¿ç”¨æ­£ç¡®çš„æ–¹å¼ï¼Œåœ¨ä»£ç å±‚é¢è§£å†³æŽ‰ã€‚é˜²æ­¢è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ï¼Œæ³¨å…¥æ”»å‡»ï¼Œè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰ï¼Œé”™è¯¯ä¿¡æ¯ï¼ŒHTML æ³¨é‡Šï¼Œæ–‡ä»¶ä¸Šä¼ ï¼Œè·¯å¾„éåŽ†ç­‰ã€‚è¿˜å¯ä»¥ä½¿ç”¨ Web åº”ç”¨é˜²ç«å¢™ï¼ˆæ¯”å¦‚ï¼šModSecurityï¼‰ï¼Œè¿›è¡Œå®‰å…¨æ¼æ´žæ‰«æç­‰æŽªæ–½ï¼ŒåŠ å¼ºåº”ç”¨çº§åˆ«çš„å®‰å…¨ã€‚ â€‹ æ•°æ®ä¿å¯†å®‰å…¨ï¼šå­˜å‚¨å®‰å…¨ï¼ˆå­˜åœ¨åœ¨å¯é çš„è®¾å¤‡ï¼Œå®žæ—¶ï¼Œå®šæ—¶å¤‡ä»½ï¼‰ï¼Œä¿å­˜å®‰å…¨ï¼ˆé‡è¦çš„ä¿¡æ¯åŠ å¯†ä¿å­˜ï¼Œé€‰æ‹©åˆé€‚çš„äººå‘˜å¤æ‚ä¿å­˜å’Œæ£€æµ‹ç­‰ï¼‰ï¼Œä¼ è¾“å®‰å…¨ï¼ˆé˜²æ­¢æ•°æ®çªƒå–å’Œæ•°æ®ç¯¡æ”¹ï¼‰ï¼› â€‹ å¸¸ç”¨çš„åŠ è§£å¯†ç®—æ³•ï¼ˆå•é¡¹æ•£åˆ—åŠ å¯†[MD5,SHA]ï¼Œå¯¹ç§°åŠ å¯†[DES,3DES,RC]ï¼‰ï¼Œéžå¯¹ç§°åŠ å¯†[RSA]ç­‰ã€‚ 1.9. æ•æ·æ€§ ç½‘ç«™çš„æž¶æž„è®¾è®¡ï¼Œè¿ç»´ç®¡ç†è¦é€‚åº”å˜åŒ–ï¼Œæä¾›é«˜ä¼¸ç¼©æ€§ï¼Œé«˜æ‰©å±•æ€§ã€‚æ–¹ä¾¿çš„åº”å¯¹å¿«é€Ÿçš„ä¸šåŠ¡å‘å±•ï¼Œçªå¢žé«˜æµé‡è®¿é—®ç­‰è¦æ±‚ã€‚ é™¤ä¸Šé¢ä»‹ç»çš„æž¶æž„è¦ç´ å¤–ï¼Œè¿˜éœ€è¦å¼•å…¥æ•æ·ç®¡ç†ï¼Œæ•æ·å¼€å‘çš„æ€æƒ³ã€‚ä½¿ä¸šåŠ¡ï¼Œäº§å“ï¼ŒæŠ€æœ¯ï¼Œè¿ç»´ç»Ÿä¸€èµ·æ¥ï¼Œéšéœ€åº”å˜ï¼Œå¿«é€Ÿå“åº”ã€‚ 1.10. å¤§åž‹æž¶æž„ä¸¾ä¾‹ ä»¥ä¸Šé‡‡ç”¨ä¸ƒå±‚é€»è¾‘æž¶æž„ï¼Œç¬¬ä¸€å±‚å®¢æˆ·å±‚ï¼Œç¬¬äºŒå±‚å‰ç«¯ä¼˜åŒ–å±‚ï¼Œç¬¬ä¸‰å±‚åº”ç”¨å±‚ï¼Œç¬¬å››å±‚æœåŠ¡å±‚ï¼Œç¬¬äº”å±‚æ•°æ®å­˜å‚¨å±‚ï¼Œç¬¬å…­å±‚å¤§æ•°æ®å­˜å‚¨å±‚ï¼Œç¬¬ä¸ƒå±‚å¤§æ•°æ®å¤„ç†å±‚ã€‚ å®¢æˆ·å±‚ï¼šæ”¯æŒ PC æµè§ˆå™¨å’Œæ‰‹æœº APPã€‚å·®åˆ«æ˜¯æ‰‹æœº APP å¯ä»¥ç›´æŽ¥è®¿é—®é€šè¿‡ IP è®¿é—®ï¼Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚ å‰ç«¯å±‚ï¼šä½¿ç”¨ DNS è´Ÿè½½å‡è¡¡ï¼ŒCDN æœ¬åœ°åŠ é€Ÿä»¥åŠåå‘ä»£ç†æœåŠ¡ï¼› åº”ç”¨å±‚ï¼šç½‘ç«™åº”ç”¨é›†ç¾¤ï¼›æŒ‰ç…§ä¸šåŠ¡è¿›è¡Œåž‚ç›´æ‹†åˆ†ï¼Œæ¯”å¦‚å•†å“åº”ç”¨ï¼Œä¼šå‘˜ä¸­å¿ƒç­‰ï¼› æœåŠ¡å±‚ï¼šæä¾›å…¬ç”¨æœåŠ¡ï¼Œæ¯”å¦‚ç”¨æˆ·æœåŠ¡ï¼Œè®¢å•æœåŠ¡ï¼Œæ”¯ä»˜æœåŠ¡ç­‰ï¼› æ•°æ®å±‚ï¼šæ”¯æŒå…³ç³»åž‹æ•°æ®åº“é›†ç¾¤ï¼ˆæ”¯æŒè¯»å†™åˆ†ç¦»ï¼‰ï¼ŒNOSQL é›†ç¾¤ï¼Œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿé›†ç¾¤ï¼›ä»¥åŠåˆ†å¸ƒå¼ Cacheï¼› å¤§æ•°æ®å­˜å‚¨å±‚ï¼šæ”¯æŒåº”ç”¨å±‚å’ŒæœåŠ¡å±‚çš„æ—¥å¿—æ•°æ®æ”¶é›†ï¼Œå…³ç³»æ•°æ®åº“å’Œ NOSQL æ•°æ®åº“çš„ç»“æž„åŒ–å’ŒåŠç»“æž„åŒ–æ•°æ®æ”¶é›†ï¼› å¤§æ•°æ®å¤„ç†å±‚ï¼šé€šè¿‡ Mapreduce è¿›è¡Œç¦»çº¿æ•°æ®åˆ†æžæˆ– Storm å®žæ—¶æ•°æ®åˆ†æžï¼Œå¹¶å°†å¤„ç†åŽçš„æ•°æ®å­˜å…¥å…³ç³»åž‹æ•°æ®åº“ã€‚ï¼ˆå®žé™…ä½¿ç”¨ä¸­ï¼Œç¦»çº¿æ•°æ®å’Œå®žæ—¶æ•°æ®ä¼šæŒ‰ç…§ä¸šåŠ¡è¦æ±‚è¿›è¡Œåˆ†ç±»å¤„ç†ï¼Œå¹¶å­˜å…¥ä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œä¾›åº”ç”¨å±‚æˆ–æœåŠ¡å±‚ä½¿ç”¨ï¼‰ã€‚ 2. ç”µå•†ç½‘ç«™æž¶æž„æ¡ˆä¾‹ 2.1. ç½‘ç«™åˆçº§æž¶æž„ ä¸€èˆ¬ç½‘ç«™ï¼Œåˆšå¼€å§‹çš„åšæ³•ï¼Œæ˜¯ä¸‰å°æœåŠ¡å™¨ï¼Œä¸€å°éƒ¨ç½²åº”ç”¨ï¼Œä¸€å°éƒ¨ç½²æ•°æ®åº“ï¼Œä¸€å°éƒ¨ç½² NFS æ–‡ä»¶ç³»ç»Ÿã€‚ è¿™æ˜¯å‰å‡ å¹´æ¯”è¾ƒä¼ ç»Ÿçš„åšæ³•ï¼Œä¹‹å‰è§åˆ°ä¸€ä¸ªç½‘ç«™ 10 ä¸‡å¤šä¼šå‘˜ï¼Œåž‚ç›´æœè£…è®¾è®¡é—¨æˆ·ï¼ŒN å¤šå›¾ç‰‡ã€‚ä½¿ç”¨äº†ä¸€å°æœåŠ¡å™¨éƒ¨ç½²äº†åº”ç”¨ï¼Œæ•°æ®åº“ä»¥åŠå›¾ç‰‡å­˜å‚¨ã€‚å‡ºçŽ°äº†å¾ˆå¤šæ€§èƒ½é—®é¢˜ã€‚ å¦‚ä¸‹å›¾ï¼š ä½†æ˜¯ï¼Œç›®å‰ä¸»æµçš„ç½‘ç«™æž¶æž„å·²ç»å‘ç”Ÿäº†ç¿»å¤©è¦†åœ°çš„å˜åŒ–ã€‚ä¸€èˆ¬éƒ½ä¼šé‡‡ç”¨é›†ç¾¤çš„æ–¹å¼ï¼Œè¿›è¡Œé«˜å¯ç”¨è®¾è®¡ã€‚è‡³å°‘æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ã€‚ ï¼ˆ1ï¼‰ ä½¿ç”¨é›†ç¾¤å¯¹åº”ç”¨æœåŠ¡å™¨è¿›è¡Œå†—ä½™ï¼Œå®žçŽ°é«˜å¯ç”¨ï¼›ï¼ˆè´Ÿè½½å‡è¡¡è®¾å¤‡å¯ä¸Žåº”ç”¨ä¸€å—éƒ¨ç½²ï¼‰ ä½¿ç”¨æ•°æ®åº“ä¸»å¤‡æ¨¡å¼ï¼Œå®žçŽ°æ•°æ®å¤‡ä»½å’Œé«˜å¯ç”¨ï¼› 2.2. ç³»ç»Ÿå®¹é‡é¢„ä¼° é¢„ä¼°æ­¥éª¤ï¼š ï¼ˆ1ï¼‰ æ³¨å†Œç”¨æˆ·æ•°-æ—¥å‡ UV é‡-æ¯æ—¥çš„ PV é‡-æ¯å¤©çš„å¹¶å‘é‡ï¼› ï¼ˆ2ï¼‰ å³°å€¼é¢„ä¼°ï¼šå¹³å¸¸é‡çš„ 2~3 å€ï¼› ï¼ˆ3ï¼‰ æ ¹æ®å¹¶å‘é‡ï¼ˆå¹¶å‘ï¼Œäº‹åŠ¡æ•°ï¼‰ï¼Œå­˜å‚¨å®¹é‡è®¡ç®—ç³»ç»Ÿå®¹é‡ã€‚ å®¢æˆ·éœ€æ±‚ï¼š3~5 å¹´ç”¨æˆ·æ•°è¾¾åˆ° 1000 ä¸‡æ³¨å†Œç”¨æˆ·ï¼› æ¯ç§’å¹¶å‘æ•°é¢„ä¼°ï¼š ï¼ˆ1ï¼‰ æ¯å¤©çš„ UV ä¸º 200 ä¸‡ï¼ˆäºŒå…«åŽŸåˆ™ï¼‰ï¼› ï¼ˆ2ï¼‰ æ¯æ—¥æ¯å¤©ç‚¹å‡»æµè§ˆ 30 æ¬¡ï¼› ï¼ˆ3ï¼‰ PV é‡ï¼š200*30=6000 ä¸‡ï¼› ï¼ˆ4ï¼‰ é›†ä¸­è®¿é—®é‡ï¼š240.2=4.8 å°æ—¶ä¼šæœ‰ 6000 ä¸‡0.8=4800 ä¸‡ï¼ˆäºŒå…«åŽŸåˆ™ï¼‰ï¼› ï¼ˆ5ï¼‰ æ¯åˆ†å¹¶å‘é‡ï¼š4.8*60=288 åˆ†é’Ÿï¼Œæ¯åˆ†é’Ÿè®¿é—® 4800/288=16.7 ä¸‡ï¼ˆçº¦ç­‰äºŽï¼‰ï¼› ï¼ˆ6ï¼‰ æ¯ç§’å¹¶å‘é‡ï¼š16.7 ä¸‡/60=2780ï¼ˆçº¦ç­‰äºŽï¼‰ï¼› ï¼ˆ7ï¼‰ å‡è®¾ï¼šé«˜å³°æœŸä¸ºå¹³å¸¸å€¼çš„ä¸‰å€ï¼Œåˆ™æ¯ç§’çš„å¹¶å‘æ•°å¯ä»¥è¾¾åˆ° 8340 æ¬¡ã€‚ ï¼ˆ8ï¼‰ 1 æ¯«ç§’=1.3 æ¬¡è®¿é—®ï¼› æ²¡å¥½å¥½å­¦æ•°å­¦åŽæ‚”äº†å§ï¼Ÿï¼ï¼ˆä¸çŸ¥é“ä»¥ä¸Šç®—æ˜¯å¦æœ‰é”™è¯¯ï¼Œå‘µå‘µ~~ï¼‰ æœåŠ¡å™¨é¢„ä¼°ï¼šï¼ˆä»¥ tomcat æœåŠ¡å™¨ä¸¾ä¾‹ï¼‰ ï¼ˆ1ï¼‰ æŒ‰ä¸€å° web æœåŠ¡å™¨ï¼Œæ”¯æŒæ¯ç§’ 300 ä¸ªå¹¶å‘è®¡ç®—ã€‚å¹³å¸¸éœ€è¦ 10 å°æœåŠ¡å™¨ï¼ˆçº¦ç­‰äºŽï¼‰ï¼›[tomcat é»˜è®¤é…ç½®æ˜¯ 150] ï¼ˆ2ï¼‰ é«˜å³°æœŸï¼šéœ€è¦ 30 å°æœåŠ¡å™¨ï¼› å®¹é‡é¢„ä¼°ï¼š70/90 åŽŸåˆ™ ç³»ç»Ÿ CPU ä¸€èˆ¬ç»´æŒåœ¨ 70%å·¦å³çš„æ°´å¹³ï¼Œé«˜å³°æœŸè¾¾åˆ° 90%çš„æ°´å¹³ï¼Œæ˜¯ä¸æµªè´¹èµ„æºï¼Œå¹¶æ¯”è¾ƒç¨³å®šçš„ã€‚å†…å­˜ï¼ŒIO ç±»ä¼¼ã€‚ ä»¥ä¸Šé¢„ä¼°ä»…ä¾›å‚è€ƒï¼Œå› ä¸ºæœåŠ¡å™¨é…ç½®ï¼Œä¸šåŠ¡é€»è¾‘å¤æ‚åº¦ç­‰éƒ½æœ‰å½±å“ã€‚åœ¨æ­¤ CPUï¼Œç¡¬ç›˜ï¼Œç½‘ç»œç­‰ä¸å†è¿›è¡Œè¯„ä¼°ã€‚ 2.3. ç½‘ç«™æž¶æž„åˆ†æž æ ¹æ®ä»¥ä¸Šé¢„ä¼°ï¼Œæœ‰å‡ ä¸ªé—®é¢˜ï¼š éœ€è¦éƒ¨ç½²å¤§é‡çš„æœåŠ¡å™¨ï¼Œé«˜å³°æœŸè®¡ç®—ï¼Œå¯èƒ½è¦éƒ¨ç½² 30 å° Web æœåŠ¡å™¨ã€‚å¹¶ä¸”è¿™ä¸‰åå°æœåŠ¡å™¨ï¼Œåªæœ‰ç§’æ€ï¼Œæ´»åŠ¨æ—¶æ‰ä¼šç”¨åˆ°ï¼Œå­˜åœ¨å¤§é‡çš„æµªè´¹ã€‚ æ‰€æœ‰çš„åº”ç”¨éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ï¼Œåº”ç”¨ä¹‹é—´è€¦åˆä¸¥é‡ã€‚éœ€è¦è¿›è¡Œåž‚ç›´åˆ‡åˆ†å’Œæ°´å¹³åˆ‡åˆ†ã€‚ å¤§é‡åº”ç”¨å­˜åœ¨å†—ä½™ä»£ç  æœåŠ¡å™¨ SESSION åŒæ­¥è€—è´¹å¤§é‡å†…å­˜å’Œç½‘ç»œå¸¦å®½ æ•°æ®éœ€è¦é¢‘ç¹è®¿é—®æ•°æ®åº“ï¼Œæ•°æ®åº“è®¿é—®åŽ‹åŠ›å·¨å¤§ã€‚ å¤§åž‹ç½‘ç«™ä¸€èˆ¬éœ€è¦åšä»¥ä¸‹æž¶æž„ä¼˜åŒ–ï¼ˆä¼˜åŒ–æ˜¯æž¶æž„è®¾è®¡æ—¶ï¼Œå°±è¦è€ƒè™‘çš„ï¼Œä¸€èˆ¬ä»Žæž¶æž„/ä»£ç çº§åˆ«è§£å†³ï¼Œè°ƒä¼˜ä¸»è¦æ˜¯ç®€å•å‚æ•°çš„è°ƒæ•´ï¼Œæ¯”å¦‚ JVM è°ƒä¼˜ï¼›å¦‚æžœè°ƒä¼˜æ¶‰åŠå¤§é‡ä»£ç æ”¹é€ ï¼Œå°±ä¸æ˜¯è°ƒä¼˜äº†ï¼Œå±žäºŽé‡æž„ï¼‰ï¼š ä¸šåŠ¡æ‹†åˆ† åº”ç”¨é›†ç¾¤éƒ¨ç½²ï¼ˆåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œé›†ç¾¤éƒ¨ç½²å’Œè´Ÿè½½å‡è¡¡ï¼‰ å¤šçº§ç¼“å­˜ å•ç‚¹ç™»å½•ï¼ˆåˆ†å¸ƒå¼ Sessionï¼‰ æ•°æ®åº“é›†ç¾¤ï¼ˆè¯»å†™åˆ†ç¦»ï¼Œåˆ†åº“åˆ†è¡¨ï¼‰ æœåŠ¡åŒ– æ¶ˆæ¯é˜Ÿåˆ— å…¶ä»–æŠ€æœ¯ 2.4. ç½‘ç«™æž¶æž„ä¼˜åŒ– ä¸šåŠ¡æ‹†åˆ† æ ¹æ®ä¸šåŠ¡å±žæ€§è¿›è¡Œåž‚ç›´åˆ‡åˆ†ï¼Œåˆ’åˆ†ä¸ºäº§å“å­ç³»ç»Ÿï¼Œè´­ç‰©å­ç³»ç»Ÿï¼Œæ”¯ä»˜å­ç³»ç»Ÿï¼Œè¯„è®ºå­ç³»ç»Ÿï¼Œå®¢æœå­ç³»ç»Ÿï¼ŒæŽ¥å£å­ç³»ç»Ÿï¼ˆå¯¹æŽ¥å¦‚è¿›é”€å­˜ï¼ŒçŸ­ä¿¡ç­‰å¤–éƒ¨ç³»ç»Ÿï¼‰ã€‚ æ ¹æ®ä¸šåŠ¡å­ç³»ç»Ÿè¿›è¡Œç­‰çº§å®šä¹‰ï¼Œå¯åˆ†ä¸ºæ ¸å¿ƒç³»ç»Ÿå’Œéžæ ¸å¿ƒç³»ç»Ÿã€‚æ ¸å¿ƒç³»ç»Ÿï¼šäº§å“å­ç³»ç»Ÿï¼Œè´­ç‰©å­ç³»ç»Ÿï¼Œæ”¯ä»˜å­ç³»ç»Ÿï¼›éžæ ¸å¿ƒï¼šè¯„è®ºå­ç³»ç»Ÿï¼Œå®¢æœå­ç³»ç»Ÿï¼ŒæŽ¥å£å­ç³»ç»Ÿã€‚ ä¸šåŠ¡æ‹†åˆ†ä½œç”¨ï¼šæå‡ä¸ºå­ç³»ç»Ÿå¯ç”±ä¸“é—¨çš„å›¢é˜Ÿå’Œéƒ¨é—¨è´Ÿè´£ï¼Œä¸“ä¸šçš„äººåšä¸“ä¸šçš„äº‹ï¼Œè§£å†³æ¨¡å—ä¹‹é—´è€¦åˆä»¥åŠæ‰©å±•æ€§é—®é¢˜ï¼›æ¯ä¸ªå­ç³»ç»Ÿå•ç‹¬éƒ¨ç½²ï¼Œé¿å…é›†ä¸­éƒ¨ç½²å¯¼è‡´ä¸€ä¸ªåº”ç”¨æŒ‚äº†ï¼Œå…¨éƒ¨åº”ç”¨ä¸å¯ç”¨çš„é—®é¢˜ã€‚ ç­‰çº§å®šä¹‰ä½œç”¨ï¼šç”¨äºŽæµé‡çªå‘æ—¶ï¼Œå¯¹å…³é”®åº”ç”¨è¿›è¡Œä¿æŠ¤ï¼Œå®žçŽ°ä¼˜é›…é™çº§ï¼›ä¿æŠ¤å…³é”®åº”ç”¨ä¸å—åˆ°å½±å“ã€‚ æ‹†åˆ†åŽçš„æž¶æž„å›¾ï¼š å‚è€ƒéƒ¨ç½²æ–¹æ¡ˆ 2 ï¼ˆ1ï¼‰ å¦‚ä¸Šå›¾æ¯ä¸ªåº”ç”¨å•ç‹¬éƒ¨ç½² ï¼ˆ2ï¼‰ æ ¸å¿ƒç³»ç»Ÿå’Œéžæ ¸å¿ƒç³»ç»Ÿç»„åˆéƒ¨ç½² åº”ç”¨é›†ç¾¤éƒ¨ç½²ï¼ˆåˆ†å¸ƒå¼ï¼Œé›†ç¾¤ï¼Œè´Ÿè½½å‡è¡¡ï¼‰ â€‹ åˆ†å¸ƒå¼éƒ¨ç½²ï¼šå°†ä¸šåŠ¡æ‹†åˆ†åŽçš„åº”ç”¨å•ç‹¬éƒ¨ç½²ï¼Œåº”ç”¨ç›´æŽ¥é€šè¿‡ RPC è¿›è¡Œè¿œç¨‹é€šä¿¡ï¼› â€‹ é›†ç¾¤éƒ¨ç½²ï¼šç”µå•†ç½‘ç«™çš„é«˜å¯ç”¨è¦æ±‚ï¼Œæ¯ä¸ªåº”ç”¨è‡³å°‘éƒ¨ç½²ä¸¤å°æœåŠ¡å™¨è¿›è¡Œé›†ç¾¤éƒ¨ç½²ï¼› â€‹ è´Ÿè½½å‡è¡¡ï¼šæ˜¯é«˜å¯ç”¨ç³»ç»Ÿå¿…é¡»çš„ï¼Œä¸€èˆ¬åº”ç”¨é€šè¿‡è´Ÿè½½å‡è¡¡å®žçŽ°é«˜å¯ç”¨ï¼Œåˆ†å¸ƒå¼æœåŠ¡é€šè¿‡å†…ç½®çš„è´Ÿè½½å‡è¡¡å®žçŽ°é«˜å¯ç”¨ï¼Œå…³ç³»åž‹æ•°æ®åº“é€šè¿‡ä¸»å¤‡æ–¹å¼å®žçŽ°é«˜å¯ç”¨ã€‚ é›†ç¾¤éƒ¨ç½²åŽæž¶æž„å›¾ï¼š å¤šçº§ç¼“å­˜ ç¼“å­˜æŒ‰ç…§å­˜æ”¾çš„ä½ç½®ä¸€èˆ¬å¯åˆ†ä¸ºä¸¤ç±»ï¼šæœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ã€‚æœ¬æ¡ˆä¾‹é‡‡ç”¨äºŒçº§ç¼“å­˜çš„æ–¹å¼ï¼Œè¿›è¡Œç¼“å­˜çš„è®¾è®¡ã€‚ä¸€çº§ç¼“å­˜ä¸ºæœ¬åœ°ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜ä¸ºåˆ†å¸ƒå¼ç¼“å­˜ã€‚ï¼ˆè¿˜æœ‰é¡µé¢ç¼“å­˜ï¼Œç‰‡æ®µç¼“å­˜ç­‰ï¼Œé‚£æ˜¯æ›´ç»†ç²’åº¦çš„åˆ’åˆ†ï¼‰ ä¸€çº§ç¼“å­˜ï¼Œç¼“å­˜æ•°æ®å­—å…¸ï¼Œå’Œå¸¸ç”¨çƒ­ç‚¹æ•°æ®ç­‰åŸºæœ¬ä¸å¯å˜/æœ‰è§„åˆ™å˜åŒ–çš„ä¿¡æ¯ï¼ŒäºŒçº§ç¼“å­˜ç¼“å­˜éœ€è¦çš„æ‰€æœ‰ç¼“å­˜ã€‚å½“ä¸€çº§ç¼“å­˜è¿‡æœŸæˆ–ä¸å¯ç”¨æ—¶ï¼Œè®¿é—®äºŒçº§ç¼“å­˜çš„æ•°æ®ã€‚å¦‚æžœäºŒçº§ç¼“å­˜ä¹Ÿæ²¡æœ‰ï¼Œåˆ™è®¿é—®æ•°æ®åº“ã€‚ ç¼“å­˜çš„æ¯”ä¾‹ï¼Œä¸€èˆ¬ 1:4ï¼Œå³å¯è€ƒè™‘ä½¿ç”¨ç¼“å­˜ã€‚ï¼ˆç†è®ºä¸Šæ˜¯ 1:2 å³å¯ï¼‰ã€‚ â€‹ æ ¹æ®ä¸šåŠ¡ç‰¹æ€§å¯ä½¿ç”¨ä»¥ä¸‹ç¼“å­˜è¿‡æœŸç­–ç•¥ï¼š ï¼ˆ1ï¼‰ ç¼“å­˜è‡ªåŠ¨è¿‡æœŸï¼› ï¼ˆ2ï¼‰ ç¼“å­˜è§¦å‘è¿‡æœŸï¼› å•ç‚¹ç™»å½•ï¼ˆåˆ†å¸ƒå¼ Sessionï¼‰ ç³»ç»Ÿåˆ†å‰²ä¸ºå¤šä¸ªå­ç³»ç»Ÿï¼Œç‹¬ç«‹éƒ¨ç½²åŽï¼Œä¸å¯é¿å…çš„ä¼šé‡åˆ°ä¼šè¯ç®¡ç†çš„é—®é¢˜ã€‚ä¸€èˆ¬å¯é‡‡ç”¨ Session åŒæ­¥ï¼ŒCookiesï¼Œåˆ†å¸ƒå¼ Session æ–¹å¼ã€‚ç”µå•†ç½‘ç«™ä¸€èˆ¬é‡‡ç”¨åˆ†å¸ƒå¼ Session å®žçŽ°ã€‚ å†è¿›ä¸€æ­¥å¯ä»¥æ ¹æ®åˆ†å¸ƒå¼ Sessionï¼Œå»ºç«‹å®Œå–„çš„å•ç‚¹ç™»å½•æˆ–è´¦æˆ·ç®¡ç†ç³»ç»Ÿã€‚ â€‹ æµç¨‹è¯´æ˜Ž ï¼ˆ1ï¼‰ ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•æ—¶ï¼Œå°†ä¼šè¯ä¿¡æ¯ï¼ˆç”¨æˆ· Id å’Œç”¨æˆ·ä¿¡æ¯ï¼‰ï¼Œæ¯”å¦‚ä»¥ç”¨æˆ· Id ä¸º Keyï¼Œå†™å…¥åˆ†å¸ƒå¼ Sessionï¼› ï¼ˆ2ï¼‰ ç”¨æˆ·å†æ¬¡ç™»å½•æ—¶ï¼ŒèŽ·å–åˆ†å¸ƒå¼ Sessionï¼Œæ˜¯å¦æœ‰ä¼šè¯ä¿¡æ¯ï¼Œå¦‚æžœæ²¡æœ‰åˆ™è°ƒåˆ°ç™»å½•é¡µï¼› ï¼ˆ3ï¼‰ ä¸€èˆ¬é‡‡ç”¨ Cache ä¸­é—´ä»¶å®žçŽ°ï¼Œå»ºè®®ä½¿ç”¨ Redisï¼Œå› ä¸ºå®ƒæœ‰æŒä¹…åŒ–åŠŸèƒ½ï¼Œæ–¹ä¾¿åˆ†å¸ƒå¼ Session å®•æœºåŽï¼Œå¯ä»¥ä»ŽæŒä¹…åŒ–å­˜å‚¨ä¸­åŠ è½½ä¼šè¯ä¿¡æ¯ï¼› ï¼ˆ4ï¼‰ å­˜å…¥ä¼šè¯æ—¶ï¼Œå¯ä»¥è®¾ç½®ä¼šè¯ä¿æŒçš„æ—¶é—´ï¼Œæ¯”å¦‚ 15 åˆ†é’Ÿï¼Œè¶…è¿‡åŽè‡ªåŠ¨è¶…æ—¶ï¼› ç»“åˆ Cache ä¸­é—´ä»¶ï¼Œå®žçŽ°çš„åˆ†å¸ƒå¼ Sessionï¼Œå¯ä»¥å¾ˆå¥½çš„æ¨¡æ‹Ÿ Session ä¼šè¯ã€‚ æ•°æ®åº“é›†ç¾¤ï¼ˆè¯»å†™åˆ†ç¦»ï¼Œåˆ†åº“åˆ†è¡¨ï¼‰ å¤§åž‹ç½‘ç«™éœ€è¦å­˜å‚¨æµ·é‡çš„æ•°æ®ï¼Œä¸ºè¾¾åˆ°æµ·é‡æ•°æ®å­˜å‚¨ï¼Œé«˜å¯ç”¨ï¼Œé«˜æ€§èƒ½ä¸€èˆ¬é‡‡ç”¨å†—ä½™çš„æ–¹å¼è¿›è¡Œç³»ç»Ÿè®¾è®¡ã€‚ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼è¯»å†™åˆ†ç¦»å’Œåˆ†åº“åˆ†è¡¨ã€‚ è¯»å†™åˆ†ç¦»ï¼šä¸€èˆ¬è§£å†³è¯»æ¯”ä¾‹è¿œå¤§äºŽå†™æ¯”ä¾‹çš„åœºæ™¯ï¼Œå¯é‡‡ç”¨ä¸€ä¸»ä¸€å¤‡ï¼Œä¸€ä¸»å¤šå¤‡æˆ–å¤šä¸»å¤šå¤‡æ–¹å¼ã€‚ æœ¬æ¡ˆä¾‹åœ¨ä¸šåŠ¡æ‹†åˆ†çš„åŸºç¡€ä¸Šï¼Œç»“åˆåˆ†åº“åˆ†è¡¨å’Œè¯»å†™åˆ†ç¦»ã€‚å¦‚ä¸‹å›¾ï¼š ï¼ˆ1ï¼‰ ä¸šåŠ¡æ‹†åˆ†åŽï¼šæ¯ä¸ªå­ç³»ç»Ÿéœ€è¦å•ç‹¬çš„åº“ï¼› ï¼ˆ2ï¼‰ å¦‚æžœå•ç‹¬çš„åº“å¤ªå¤§ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡ç‰¹æ€§ï¼Œè¿›è¡Œå†æ¬¡åˆ†åº“ï¼Œæ¯”å¦‚å•†å“åˆ†ç±»åº“ï¼Œäº§å“åº“ï¼› ï¼ˆ3ï¼‰ åˆ†åº“åŽï¼Œå¦‚æžœè¡¨ä¸­æœ‰æ•°æ®é‡å¾ˆå¤§çš„ï¼Œåˆ™è¿›è¡Œåˆ†è¡¨ï¼Œä¸€èˆ¬å¯ä»¥æŒ‰ç…§ Idï¼Œæ—¶é—´ç­‰è¿›è¡Œåˆ†è¡¨ï¼›ï¼ˆé«˜çº§çš„ç”¨æ³•æ˜¯ä¸€è‡´æ€§ Hashï¼‰ ï¼ˆ4ï¼‰ åœ¨åˆ†åº“ï¼Œåˆ†è¡¨çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œè¯»å†™åˆ†ç¦»ï¼› ç›¸å…³ä¸­é—´ä»¶å¯å‚è€ƒ Cobarï¼ˆé˜¿é‡Œï¼Œç›®å‰å·²ä¸åœ¨ç»´æŠ¤ï¼‰ï¼ŒTDDLï¼ˆé˜¿é‡Œï¼‰ï¼ŒAtlasï¼ˆå¥‡è™Ž 360ï¼‰ï¼ŒMyCatï¼ˆåœ¨ Cobar åŸºç¡€ä¸Šï¼Œå›½å†…å¾ˆå¤šç‰›äººï¼Œå·ç§°å›½å†…ç¬¬ä¸€å¼€æºé¡¹ç›®ï¼‰ã€‚ åˆ†åº“åˆ†è¡¨åŽåºåˆ—çš„é—®é¢˜ï¼ŒJOINï¼Œäº‹åŠ¡çš„é—®é¢˜ï¼Œä¼šåœ¨åˆ†åº“åˆ†è¡¨ä¸»é¢˜åˆ†äº«ä¸­ï¼Œä»‹ç»ã€‚ æœåŠ¡åŒ– â€‹å°†å¤šä¸ªå­ç³»ç»Ÿå…¬ç”¨çš„åŠŸèƒ½/æ¨¡å—ï¼Œè¿›è¡ŒæŠ½å–ï¼Œä½œä¸ºå…¬ç”¨æœåŠ¡ä½¿ç”¨ã€‚æ¯”å¦‚æœ¬æ¡ˆä¾‹çš„ä¼šå‘˜å­ç³»ç»Ÿå°±å¯ä»¥æŠ½å–ä¸ºå…¬ç”¨çš„æœåŠ¡ã€‚ æ¶ˆæ¯é˜Ÿåˆ— â€‹ æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥è§£å†³å­ç³»ç»Ÿ/æ¨¡å—ä¹‹é—´çš„è€¦åˆï¼Œå®žçŽ°å¼‚æ­¥ï¼Œé«˜å¯ç”¨ï¼Œé«˜æ€§èƒ½çš„ç³»ç»Ÿã€‚æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ‡å‡†é…ç½®ã€‚æœ¬æ¡ˆä¾‹ä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸»è¦åº”ç”¨åœ¨è´­ç‰©ï¼Œé…é€çŽ¯èŠ‚ã€‚ ï¼ˆ1ï¼‰ ç”¨æˆ·ä¸‹å•åŽï¼Œå†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒåŽç›´æŽ¥è¿”å›žå®¢æˆ·ç«¯ï¼› ï¼ˆ2ï¼‰ åº“å­˜å­ç³»ç»Ÿï¼šè¯»å–æ¶ˆæ¯é˜Ÿåˆ—ä¿¡æ¯ï¼Œå®Œæˆå‡åº“å­˜ï¼› ï¼ˆ3ï¼‰ é…é€å­ç³»ç»Ÿï¼šè¯»å–æ¶ˆæ¯é˜Ÿåˆ—ä¿¡æ¯ï¼Œè¿›è¡Œé…é€ï¼› ç›®å‰ä½¿ç”¨è¾ƒå¤šçš„ MQ æœ‰ Active MQ,Rabbit MQ,Zero MQï¼ŒMS MQ ç­‰ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯è¿›è¡Œé€‰æ‹©ã€‚å»ºè®®å¯ä»¥ç ”ç©¶ä¸‹ Rabbit MQã€‚ å…¶ä»–æž¶æž„ï¼ˆæŠ€æœ¯ï¼‰ é™¤äº†ä»¥ä¸Šä»‹ç»çš„ä¸šåŠ¡æ‹†åˆ†ï¼Œåº”ç”¨é›†ç¾¤ï¼Œå¤šçº§ç¼“å­˜ï¼Œå•ç‚¹ç™»å½•ï¼Œæ•°æ®åº“é›†ç¾¤ï¼ŒæœåŠ¡åŒ–ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¤–ã€‚è¿˜æœ‰ CDNï¼Œåå‘ä»£ç†ï¼Œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå¤§æ•°æ®å¤„ç†ç­‰ç³»ç»Ÿã€‚ æ­¤å¤„ä¸è¯¦ç»†ä»‹ç»ï¼Œå¤§å®¶å¯ä»¥é—®åº¦å¨˜/Googleï¼Œæœ‰æœºä¼šçš„è¯ä¹Ÿå¯ä»¥åˆ†äº«ç»™å¤§å®¶ã€‚ 2.5. æž¶æž„æ€»ç»“ ä»¥ä¸Šæ˜¯æœ¬æ¬¡åˆ†äº«çš„æž¶æž„æ€»ç»“ï¼Œå…¶ä¸­ç»†èŠ‚å¯å‚è€ƒå‰é¢åˆ†äº«çš„å†…å®¹ã€‚å…¶ä¸­è¿˜æœ‰å¾ˆå¤šå¯ä»¥ä¼˜åŒ–å’Œç»†åŒ–çš„åœ°æ–¹ï¼Œå› ä¸ºæ˜¯æ¡ˆä¾‹åˆ†äº«ï¼Œä¸»è¦é’ˆå¯¹é‡è¦éƒ¨åˆ†åšäº†ä»‹ç»ï¼Œå·¥ä½œä¸­éœ€è¦å¤§å®¶æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯è¿›è¡Œæž¶æž„è®¾è®¡ã€‚ ä»¥ä¸Šæ˜¯ç”µå•†ç½‘ç«™æž¶æž„æ¡ˆä¾‹çš„åˆ†äº«ä¸€å…±æœ‰ä¸‰ç¯‡ï¼Œä»Žç”µå•†ç½‘ç«™çš„éœ€æ±‚ï¼Œåˆ°å•æœºæž¶æž„ï¼Œé€æ­¥æ¼”å˜ä¸ºå¸¸ç”¨çš„ï¼Œå¯ä¾›å‚è€ƒçš„åˆ†å¸ƒå¼æž¶æž„çš„åŽŸåž‹ã€‚é™¤å…·å¤‡åŠŸèƒ½éœ€æ±‚å¤–ï¼Œè¿˜å…·å¤‡ä¸€å®šçš„é«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨ï¼Œå¯ä¼¸ç¼©ï¼Œå¯æ‰©å±•ç­‰éžåŠŸèƒ½è´¨é‡éœ€æ±‚ï¼ˆæž¶æž„ç›®æ ‡ï¼‰ã€‚ 3. èµ„æ–™ å¤§åž‹åˆ†å¸ƒå¼ç½‘ç«™æž¶æž„æŠ€æœ¯æ€»ç»“ å¤§åž‹ç½‘ç«™æž¶æž„ç³»åˆ—ï¼šç”µå•†ç½‘ç«™æž¶æž„æ¡ˆä¾‹(1) å¤§åž‹ç½‘ç«™æž¶æž„ç³»åˆ—ï¼šç”µå•†ç½‘ç«™æž¶æž„æ¡ˆä¾‹(2) å¤§åž‹ç½‘ç«™æž¶æž„ç³»åˆ—ï¼šç”µå•†ç½‘ç«™æž¶æž„æ¡ˆä¾‹(3)]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
        <tag>distributed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤§åž‹ç½‘ç«™æž¶æž„æ¦‚è¿°]]></title>
    <url>%2Fblog%2F2018%2F07%2F05%2Fdesign%2Farchitecture%2F%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E6%A6%82%E8%BF%B0%2F</url>
    <content type="text"><![CDATA[å¤§åž‹ç½‘ç«™æž¶æž„æ¦‚è¿° ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ 1. å¤§åž‹ç½‘ç«™ç³»ç»Ÿçš„ç‰¹ç‚¹ 2. å¤§åž‹ç½‘ç«™æž¶æž„æ¼”åŒ–åŽ†ç¨‹ 2.1. åˆå§‹é˜¶æ®µæž¶æž„ 2.2. åº”ç”¨æœåŠ¡å’Œæ•°æ®æœåŠ¡åˆ†ç¦» 2.3. ä½¿ç”¨ç¼“å­˜æ”¹å–„æ€§èƒ½ 2.4. ä½¿ç”¨åº”ç”¨æœåŠ¡å™¨é›†ç¾¤ 2.5. æ•°æ®åº“è¯»å†™åˆ†ç¦» 2.6. åå‘ä»£ç†å’Œ CDN åŠ é€Ÿ 2.7. åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå’Œåˆ†å¸ƒå¼æ•°æ®åº“ 2.8. ä½¿ç”¨ NoSQL å’Œæœç´¢å¼•æ“Ž 2.9. ä¸šåŠ¡æ‹†åˆ† 2.10. åˆ†å¸ƒå¼æœåŠ¡ 3. å¤§åž‹ç½‘ç«™æž¶æž„æ¨¡å¼ 3.1. åˆ†å±‚ 3.2. åˆ†å‰² 3.3. åˆ†å¸ƒå¼ 3.4. é›†ç¾¤ 3.5. ç¼“å­˜ 3.6. å¼‚æ­¥ 3.7. å†—ä½™ 3.8. è‡ªåŠ¨åŒ– 3.9. å®‰å…¨ 4. å¤§åž‹ç½‘ç«™æ ¸å¿ƒæž¶æž„è¦ç´  4.1. æ€§èƒ½ 4.2. å¯ç”¨æ€§ 4.3. ä¼¸ç¼©æ€§ 4.4. æ‰©å±•æ€§ 4.5. å®‰å…¨æ€§ 5. èµ„æ–™ 1. å¤§åž‹ç½‘ç«™ç³»ç»Ÿçš„ç‰¹ç‚¹ é«˜å¹¶å‘ã€å¤§æµé‡ é«˜å¯ç”¨ æµ·é‡æ•°æ® ç”¨æˆ·åˆ†å¸ƒå¹¿æ³›ï¼Œç½‘ç»œæƒ…å†µå¤æ‚ å®‰å…¨çŽ¯å¢ƒæ¶åŠ£ éœ€æ±‚å¿«é€Ÿå˜æ›´ï¼Œè¿­ä»£é¢‘ç¹ æ¸è¿›å¼å‘å±• 2. å¤§åž‹ç½‘ç«™æž¶æž„æ¼”åŒ–åŽ†ç¨‹ 2.1. åˆå§‹é˜¶æ®µæž¶æž„ é—®é¢˜ï¼šç½‘ç«™è¿è¥åˆæœŸï¼Œè®¿é—®ç”¨æˆ·å°‘ï¼Œä¸€å°æœåŠ¡å™¨ç»°ç»°æœ‰ä½™ã€‚ ç‰¹å¾ï¼šåº”ç”¨ç¨‹åºã€æ•°æ®åº“ã€æ–‡ä»¶ç­‰æ‰€æœ‰çš„èµ„æºéƒ½åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šã€‚ æè¿°ï¼šé€šå¸¸æœåŠ¡å™¨æ“ä½œç³»ç»Ÿä½¿ç”¨ linuxï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨ PHP å¼€å‘ï¼Œç„¶åŽéƒ¨ç½²åœ¨ Apache ä¸Šï¼Œæ•°æ®åº“ä½¿ç”¨ Mysqlï¼Œé€šä¿—ç§°ä¸º LAMPã€‚æ±‡é›†å„ç§å…è´¹å¼€æºè½¯ä»¶ä»¥åŠä¸€å°å»‰ä»·æœåŠ¡å™¨å°±å¯ä»¥å¼€å§‹ç³»ç»Ÿçš„å‘å±•ä¹‹è·¯äº†ã€‚ 2.2. åº”ç”¨æœåŠ¡å’Œæ•°æ®æœåŠ¡åˆ†ç¦» é—®é¢˜ï¼šè¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·è®¿é—®å¯¼è‡´æ€§èƒ½è¶Šæ¥è¶Šå·®ï¼Œè¶Šæ¥è¶Šå¤šçš„æ•°æ®å¯¼è‡´å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œä¸€å°æœåŠ¡å™¨å·²ä¸è¶³ä»¥æ”¯æ’‘ã€‚ ç‰¹å¾ï¼šåº”ç”¨æœåŠ¡å™¨ã€æ•°æ®åº“æœåŠ¡å™¨ã€æ–‡ä»¶æœåŠ¡å™¨åˆ†åˆ«ç‹¬ç«‹éƒ¨ç½²ã€‚ æè¿°ï¼šä¸‰å°æœåŠ¡å™¨å¯¹æ€§èƒ½è¦æ±‚å„ä¸ç›¸åŒï¼šåº”ç”¨æœåŠ¡å™¨è¦å¤„ç†å¤§é‡ä¸šåŠ¡é€»è¾‘ï¼Œå› æ­¤éœ€è¦æ›´å¿«æ›´å¼ºå¤§çš„ CPUï¼›æ•°æ®åº“æœåŠ¡å™¨éœ€è¦å¿«é€Ÿç£ç›˜æ£€ç´¢å’Œæ•°æ®ç¼“å­˜ï¼Œå› æ­¤éœ€è¦æ›´å¿«çš„ç¡¬ç›˜å’Œæ›´å¤§çš„å†…å­˜ï¼›æ–‡ä»¶æœåŠ¡å™¨éœ€è¦å­˜å‚¨å¤§é‡æ–‡ä»¶ï¼Œå› æ­¤éœ€è¦æ›´å¤§å®¹é‡çš„ç¡¬ç›˜ã€‚ 2.3. ä½¿ç”¨ç¼“å­˜æ”¹å–„æ€§èƒ½ é—®é¢˜ï¼šéšç€ç”¨æˆ·é€æ¸å¢žå¤šï¼Œæ•°æ®åº“åŽ‹åŠ›å¤ªå¤§å¯¼è‡´è®¿é—®å»¶è¿Ÿã€‚ ç‰¹å¾ï¼šç”±äºŽç½‘ç«™è®¿é—®å’Œè´¢å¯Œåˆ†é…ä¸€æ ·éµå¾ªäºŒå…«å®šå¾‹ï¼š80% çš„ä¸šåŠ¡è®¿é—®é›†ä¸­åœ¨ 20% çš„æ•°æ®ä¸Šã€‚å°†æ•°æ®åº“ä¸­è®¿é—®è¾ƒé›†ä¸­çš„å°‘éƒ¨åˆ†æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥å‡å°‘æ•°æ®åº“çš„è®¿é—®æ¬¡æ•°ï¼Œé™ä½Žæ•°æ®åº“çš„è®¿é—®åŽ‹åŠ›ã€‚ æè¿°ï¼šç¼“å­˜åˆ†ä¸ºä¸¤ç§ï¼šåº”ç”¨æœåŠ¡å™¨ä¸Šçš„æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜æœåŠ¡å™¨ä¸Šçš„è¿œç¨‹ç¼“å­˜ï¼Œæœ¬åœ°ç¼“å­˜è®¿é—®é€Ÿåº¦æ›´å¿«ï¼Œä½†ç¼“å­˜æ•°æ®é‡æœ‰é™ï¼ŒåŒæ—¶å­˜åœ¨ä¸Žåº”ç”¨ç¨‹åºäº‰ç”¨å†…å­˜çš„æƒ…å†µã€‚åˆ†å¸ƒå¼ç¼“å­˜å¯ä»¥é‡‡ç”¨é›†ç¾¤æ–¹å¼ï¼Œç†è®ºä¸Šå¯ä»¥åšåˆ°ä¸å—å†…å­˜å®¹é‡é™åˆ¶çš„ç¼“å­˜æœåŠ¡ã€‚ 2.4. ä½¿ç”¨åº”ç”¨æœåŠ¡å™¨é›†ç¾¤ é—®é¢˜ï¼šä½¿ç”¨ç¼“å­˜åŽï¼Œæ•°æ®åº“è®¿é—®åŽ‹åŠ›å¾—åˆ°æœ‰æ•ˆç¼“è§£ã€‚ä½†æ˜¯å•ä¸€åº”ç”¨æœåŠ¡å™¨èƒ½å¤Ÿå¤„ç†çš„è¯·æ±‚è¿žæŽ¥æœ‰é™ï¼Œåœ¨è®¿é—®é«˜å³°æœŸï¼Œæˆä¸ºç“¶é¢ˆã€‚ ç‰¹å¾ï¼šå¤šå°æœåŠ¡å™¨é€šè¿‡è´Ÿè½½å‡è¡¡åŒæ—¶å‘å¤–éƒ¨æä¾›æœåŠ¡ï¼Œè§£å†³å•ä¸€æœåŠ¡å™¨å¤„ç†èƒ½åŠ›å’Œå­˜å‚¨ç©ºé—´ä¸è¶³çš„é—®é¢˜ã€‚ æè¿°ï¼šä½¿ç”¨é›†ç¾¤æ˜¯ç³»ç»Ÿè§£å†³é«˜å¹¶å‘ã€æµ·é‡æ•°æ®é—®é¢˜çš„å¸¸ç”¨æ‰‹æ®µã€‚é€šè¿‡å‘é›†ç¾¤ä¸­è¿½åŠ èµ„æºï¼Œæå‡ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œä½¿å¾—æœåŠ¡å™¨çš„è´Ÿè½½åŽ‹åŠ›ä¸å†æˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç“¶é¢ˆã€‚ 2.5. æ•°æ®åº“è¯»å†™åˆ†ç¦» é—®é¢˜ï¼šç½‘ç«™ä½¿ç”¨ç¼“å­˜åŽï¼Œä½¿ç»å¤§éƒ¨åˆ†æ•°æ®è¯»æ“ä½œè®¿é—®éƒ½å¯ä»¥ä¸é€šè¿‡æ•°æ®åº“å°±èƒ½å®Œæˆï¼Œä½†æ˜¯ä»æœ‰ä¸€éƒ¨åˆ†è¯»æ“ä½œå’Œå…¨éƒ¨çš„å†™æ“ä½œéœ€è¦è®¿é—®æ•°æ®åº“ï¼Œåœ¨ç½‘ç«™çš„ç”¨æˆ·è¾¾åˆ°ä¸€å®šè§„æ¨¡åŽï¼Œæ•°æ®åº“å› ä¸ºè´Ÿè½½åŽ‹åŠ›è¿‡é«˜è€Œæˆä¸ºç½‘ç«™çš„ç“¶é¢ˆã€‚ ç‰¹å¾ï¼šç›®å‰å¤§éƒ¨åˆ†çš„ä¸»æµæ•°æ®åº“éƒ½æä¾›ä¸»ä»Žçƒ­å¤‡åŠŸèƒ½ï¼Œé€šè¿‡é…ç½®ä¸¤å°æ•°æ®åº“ä¸»ä»Žå…³ç³»ï¼Œå¯ä»¥å°†ä¸€å°æ•°æ®åº“æœåŠ¡å™¨çš„æ•°æ®æ›´æ–°åŒæ­¥åˆ°ä¸€å°æœåŠ¡å™¨ä¸Šã€‚ç½‘ç«™åˆ©ç”¨æ•°æ®åº“çš„ä¸»ä»Žçƒ­å¤‡åŠŸèƒ½ï¼Œå®žçŽ°æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œä»Žè€Œæ”¹å–„æ•°æ®åº“è´Ÿè½½åŽ‹åŠ›ã€‚ æè¿°ï¼šåº”ç”¨æœåŠ¡å™¨åœ¨å†™æ“ä½œçš„æ—¶å€™ï¼Œè®¿é—®ä¸»æ•°æ®åº“ï¼Œä¸»æ•°æ®åº“é€šè¿‡ä¸»ä»Žå¤åˆ¶æœºåˆ¶å°†æ•°æ®æ›´æ–°åŒæ­¥åˆ°ä»Žæ•°æ®åº“ã€‚è¿™æ ·å½“åº”ç”¨æœåŠ¡å™¨åœ¨è¯»æ“ä½œçš„æ—¶å€™ï¼Œè®¿é—®ä»Žæ•°æ®åº“èŽ·å¾—æ•°æ®ã€‚ä¸ºäº†ä¾¿äºŽåº”ç”¨ç¨‹åºè®¿é—®è¯»å†™åˆ†ç¦»åŽçš„æ•°æ®åº“ï¼Œé€šå¸¸åœ¨åº”ç”¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ä¸“é—¨çš„æ•°æ®è®¿é—®æ¨¡å—ï¼Œä½¿æ•°æ®åº“è¯»å†™åˆ†ç¦»çš„å¯¹åº”ç”¨é€æ˜Žã€‚ 2.6. åå‘ä»£ç†å’Œ CDN åŠ é€Ÿ é—®é¢˜ï¼šä¸­å›½ç½‘ç»œçŽ¯å¢ƒå¤æ‚ï¼Œä¸åŒåœ°åŒºçš„ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶ï¼Œé€Ÿåº¦å·®åˆ«ä¹Ÿæžå¤§ã€‚ ç‰¹å¾ï¼šé‡‡ç”¨ CDN å’Œåå‘ä»£ç†åŠ å¿«ç³»ç»Ÿçš„é™æ€èµ„æºè®¿é—®é€Ÿåº¦ã€‚ æè¿°ï¼šCDN å’Œåå‘ä»£ç†çš„åŸºæœ¬åŽŸç†éƒ½æ˜¯ç¼“å­˜ï¼ŒåŒºåˆ«åœ¨äºŽ CDN éƒ¨ç½²åœ¨ç½‘ç»œæä¾›å•†çš„æœºæˆ¿ï¼Œä½¿ç”¨æˆ·åœ¨è¯·æ±‚ç½‘ç«™æœåŠ¡æ—¶ï¼Œå¯ä»¥ä»Žè·ç¦»è‡ªå·±æœ€è¿‘çš„ç½‘ç»œæä¾›å•†æœºæˆ¿èŽ·å–æ•°æ®ï¼›è€Œåå‘ä»£ç†åˆ™éƒ¨ç½²åœ¨ç½‘ç«™çš„ä¸­å¿ƒæœºæˆ¿ï¼Œå½“ç”¨æˆ·è¯·æ±‚åˆ°è¾¾ä¸­å¿ƒæœºæˆ¿åŽï¼Œé¦–å…ˆè®¿é—®çš„æœåŠ¡å™¨æ—¶åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¦‚æžœåå‘ä»£ç†æœåŠ¡å™¨ä¸­ç¼“å­˜ç€ç”¨æˆ·è¯·æ±‚çš„èµ„æºï¼Œå°±å°†å…¶ç›´æŽ¥è¿”å›žç»™ç”¨æˆ·ã€‚ 2.7. åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå’Œåˆ†å¸ƒå¼æ•°æ®åº“ é—®é¢˜ï¼šéšç€å¤§åž‹ç½‘ç«™ä¸šåŠ¡æŒç»­å¢žé•¿ï¼Œæ•°æ®åº“ç»è¿‡è¯»å†™åˆ†ç¦»ï¼Œä»Žä¸€å°æœåŠ¡å™¨æ‹†åˆ†ä¸ºä¸¤å°æœåŠ¡å™¨ï¼Œä¾ç„¶ä¸èƒ½æ»¡è¶³éœ€æ±‚ã€‚ ç‰¹å¾ï¼šæ•°æ®åº“é‡‡ç”¨åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿé‡‡ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚ æè¿°ï¼šåˆ†å¸ƒå¼æ•°æ®åº“æ˜¯æ•°æ®åº“æ‹†åˆ†çš„æœ€åŽæ–¹æ³•ï¼Œåªæœ‰åœ¨å•è¡¨æ•°æ®è§„æ¨¡éžå¸¸åºžå¤§çš„æ—¶å€™æ‰ä½¿ç”¨ã€‚ä¸åˆ°ä¸å¾—å·²æ—¶ï¼Œæ›´å¸¸ç”¨çš„æ•°æ®åº“æ‹†åˆ†æ‰‹æ®µæ˜¯ä¸šåŠ¡åˆ†åº“ï¼Œå°†ä¸åŒçš„ä¸šåŠ¡æ•°æ®åº“éƒ¨ç½²åœ¨ä¸åŒçš„ç‰©ç†æœåŠ¡å™¨ä¸Šã€‚ 2.8. ä½¿ç”¨ NoSQL å’Œæœç´¢å¼•æ“Ž é—®é¢˜ï¼šéšç€ç½‘ç«™ä¸šåŠ¡è¶Šæ¥è¶Šå¤æ‚ï¼Œå¯¹æ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„éœ€æ±‚ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ã€‚ ç‰¹å¾ï¼šç³»ç»Ÿå¼•å…¥ NoSQL æ•°æ®åº“åŠæœç´¢å¼•æ“Žã€‚ æè¿°ï¼šNoSQL æ•°æ®åº“åŠæœç´¢å¼•æ“Žå¯¹å¯ä¼¸ç¼©çš„åˆ†å¸ƒå¼ç‰¹æ€§å…·æœ‰æ›´å¥½çš„æ”¯æŒã€‚åº”ç”¨æœåŠ¡å™¨é€šè¿‡ç»Ÿä¸€æ•°æ®è®¿é—®æ¨¡å—è®¿é—®å„ç§æ•°æ®ï¼Œå‡è½»åº”ç”¨ç¨‹åºç®¡ç†è¯¸å¤šæ•°æ®æºçš„éº»çƒ¦ã€‚ 2.9. ä¸šåŠ¡æ‹†åˆ† é—®é¢˜ï¼šå¤§åž‹ç½‘ç«™çš„ä¸šåŠ¡åœºæ™¯æ—¥ç›Šå¤æ‚ï¼Œåˆ†ä¸ºå¤šä¸ªäº§å“çº¿ã€‚ ç‰¹å¾ï¼šé‡‡ç”¨åˆ†è€Œæ²»ä¹‹çš„æ‰‹æ®µå°†æ•´ä¸ªç½‘ç«™ä¸šåŠ¡åˆ†æˆä¸åŒçš„äº§å“çº¿ã€‚ç³»ç»Ÿä¸ŠæŒ‰ç…§ä¸šåŠ¡è¿›è¡Œæ‹†åˆ†æ”¹é€ ï¼Œåº”ç”¨æœåŠ¡å™¨æŒ‰ç…§ä¸šåŠ¡åŒºåˆ†è¿›è¡Œåˆ†åˆ«éƒ¨ç½²ã€‚ æè¿°ï¼šåº”ç”¨ä¹‹é—´å¯ä»¥é€šè¿‡è¶…é“¾æŽ¥å»ºç«‹å…³ç³»ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œæ•°æ®åˆ†å‘ï¼Œå½“ç„¶æ›´å¤šçš„è¿˜æ˜¯é€šè¿‡è®¿é—®åŒä¸€ä¸ªæ•°æ®å­˜å‚¨ç³»ç»Ÿæ¥æž„æˆä¸€ä¸ªå…³è”çš„å®Œæ•´ç³»ç»Ÿã€‚ çºµå‘æ‹†åˆ†ï¼šå°†ä¸€ä¸ªå¤§åº”ç”¨æ‹†åˆ†ä¸ºå¤šä¸ªå°åº”ç”¨ï¼Œå¦‚æžœæ–°ä¸šåŠ¡è¾ƒä¸ºç‹¬ç«‹ï¼Œé‚£ä¹ˆå°±ç›´æŽ¥å°†å…¶è®¾è®¡éƒ¨ç½²ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ Web åº”ç”¨ç³»ç»Ÿã€‚çºµå‘æ‹†åˆ†ç›¸å¯¹è¾ƒä¸ºç®€å•ï¼Œé€šè¿‡æ¢³ç†ä¸šåŠ¡ï¼Œå°†è¾ƒå°‘ç›¸å…³çš„ä¸šåŠ¡å‰¥ç¦»å³å¯ã€‚ æ¨ªå‘æ‹†åˆ†ï¼šå°†å¤ç”¨çš„ä¸šåŠ¡æ‹†åˆ†å‡ºæ¥ï¼Œç‹¬ç«‹éƒ¨ç½²ä¸ºåˆ†å¸ƒå¼æœåŠ¡ï¼Œæ–°å¢žä¸šåŠ¡åªéœ€è¦è°ƒç”¨è¿™äº›åˆ†å¸ƒå¼æœåŠ¡æ¨ªå‘æ‹†åˆ†éœ€è¦è¯†åˆ«å¯å¤ç”¨çš„ä¸šåŠ¡ï¼Œè®¾è®¡æœåŠ¡æŽ¥å£ï¼Œè§„èŒƒæœåŠ¡ä¾èµ–å…³ç³»ã€‚ 2.10. åˆ†å¸ƒå¼æœåŠ¡ é—®é¢˜ï¼šéšç€ä¸šåŠ¡è¶Šæ‹†è¶Šå°ï¼Œå­˜å‚¨ç³»ç»Ÿè¶Šæ¥è¶Šåºžå¤§ï¼Œåº”ç”¨ç³»ç»Ÿæ•´ä½“å¤æ‚ç¨‹åº¦å‘ˆæŒ‡æ•°çº§ä¸Šå‡ï¼Œéƒ¨ç½²ç»´æŠ¤è¶Šæ¥è¶Šå›°éš¾ã€‚ç”±äºŽæ‰€æœ‰åº”ç”¨è¦å’Œæ‰€æœ‰æ•°æ®åº“ç³»ç»Ÿè¿žæŽ¥ï¼Œæœ€ç»ˆå¯¼è‡´æ•°æ®åº“è¿žæŽ¥èµ„æºä¸è¶³ï¼Œæ‹’ç»æœåŠ¡ã€‚ ç‰¹å¾ï¼šå…¬å…±ä¸šåŠ¡æå–å‡ºæ¥ï¼Œç‹¬ç«‹éƒ¨ç½²ã€‚ç”±è¿™äº›å¯å¤ç”¨çš„ä¸šåŠ¡è¿žæŽ¥æ•°æ®åº“ï¼Œé€šè¿‡åˆ†å¸ƒå¼æœåŠ¡æä¾›å…±ç”¨ä¸šåŠ¡æœåŠ¡ã€‚ 3. å¤§åž‹ç½‘ç«™æž¶æž„æ¨¡å¼ 3.1. åˆ†å±‚ å¤§åž‹ç½‘ç«™æž¶æž„ä¸­å¸¸é‡‡ç”¨åˆ†å±‚ç»“æž„ï¼Œå°†è½¯ä»¶ç³»ç»Ÿåˆ†ä¸ºåº”ç”¨å±‚ã€æœåŠ¡å±‚ã€æ•°æ®å±‚ï¼š åº”ç”¨å±‚ - è´Ÿè´£å…·ä½“ä¸šåŠ¡å’Œè§†å›¾å±•ç¤ºã€‚å¦‚ç½‘ç«™é¦–é¡µåŠæœç´¢è¾“å…¥å’Œç»“æžœå±•ç¤ºã€‚ æœåŠ¡å±‚ - ä¸ºåº”ç”¨å±‚æä¾›æœåŠ¡æ”¯æŒã€‚å¦‚ç”¨æˆ·ç®¡ç†æœåŠ¡ã€è´­ç‰©è½¦æœåŠ¡ç­‰ã€‚ åº”ç”¨å±‚ - æä¾›æ•°æ®å­˜å‚¨è®¿é—®æœåŠ¡ã€‚å¦‚æ•°æ®åº“ã€ç¼“å­˜ã€æ–‡ä»¶ã€æœç´¢å¼•æ“Žç­‰ã€‚ åˆ†å±‚æž¶æž„çš„çº¦æŸï¼šç¦æ­¢è·¨å±‚æ¬¡çš„è°ƒç”¨ï¼ˆåº”ç”¨å±‚ç›´æŽ¥è°ƒç”¨æ•°æ®å±‚ï¼‰åŠé€†å‘è°ƒç”¨ï¼ˆæ•°æ®å±‚è°ƒç”¨æœåŠ¡å±‚ï¼Œæˆ–è€…æœåŠ¡å±‚è°ƒç”¨åº”ç”¨å±‚ï¼‰ã€‚ åˆ†å±‚ç»“æž„å†…éƒ¨è¿˜å¯ä»¥ç»§ç»­åˆ†å±‚ï¼Œå¦‚åº”ç”¨å¯ä»¥å†ç»†åˆ†ä¸ºè§†å›¾å±‚å’Œä¸šåŠ¡é€»è¾‘å±‚ï¼›æœåŠ¡å±‚ä¹Ÿå¯ä»¥ç»†åˆ†ä¸ºæ•°æ®æŽ¥å£å±‚å’Œé€»è¾‘å¤„ç†å±‚ã€‚ 3.2. åˆ†å‰² å°†ä¸åŒçš„åŠŸèƒ½å’ŒæœåŠ¡åˆ†å‰²å¼€æ¥ï¼ŒåŒ…è£…æˆé«˜å†…èšä½Žè€¦åˆçš„æ¨¡å—å•å…ƒã€‚è¿™æœ‰åŠ©äºŽè½¯ä»¶çš„å¼€å‘å’Œç»´æŠ¤ï¼Œä¾¿äºŽä¸åŒæ¨¡å—çš„åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œæé«˜ç½‘ç«™çš„å¹¶å‘å¤„ç†èƒ½åŠ›å’ŒåŠŸèƒ½æ‰©å±•èƒ½åŠ›ã€‚ 3.3. åˆ†å¸ƒå¼ å¤§äºŽå¤§åž‹ç½‘ç«™ï¼Œåˆ†å±‚å’Œåˆ†å‰²çš„ä¸€ä¸ªä¸»è¦ç›®çš„æ˜¯ä¸ºäº†åˆ‡åˆ†åŽçš„æ¨¡å—ä¾¿äºŽåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå³å°†ä¸åŒæ¨¡å—éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡è¿œç¨‹è°ƒç”¨ååŒå·¥ä½œã€‚ åˆ†å¸ƒå¼æ„å‘³å¯ä»¥ç”¨æ›´å¤šçš„æœºå™¨å·¥ä½œï¼Œé‚£ä¹ˆ CPUã€å†…å­˜ã€å­˜å‚¨èµ„æºä¹Ÿå°±æ›´ä¸°å¯Œï¼Œèƒ½å¤Ÿå¤„ç†çš„å¹¶å‘è®¿é—®å’Œæ•°æ®é‡å°±è¶Šå¤§ï¼Œè¿›è€Œèƒ½å¤Ÿä¸ºæ›´å¤šçš„ç”¨æˆ·æä¾›æœåŠ¡ã€‚ åˆ†å¸ƒå¼ä¹Ÿå¼•å…¥äº†ä¸€äº›é—®é¢˜ï¼š æœåŠ¡è°ƒç”¨å¿…é¡»é€šè¿‡ç½‘ç»œï¼Œç½‘ç»œå»¶è¿Ÿä¼šå½±å“æ€§èƒ½ æœåŠ¡å™¨è¶Šå¤šï¼Œå®•æœºæ¦‚çŽ‡ä¹Ÿè¶Šå¤§ï¼Œæ˜¯å¯ç”¨æ€§é™ä½Ž æ•°æ®ä¸€è‡´æ€§éžå¸¸å›°éš¾ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ä¹Ÿéš¾ä»¥ä¿è¯ ç½‘ç«™ä¾èµ–é”™ç»¼å¤æ‚ï¼Œå¼€å‘ç®¡ç†ç»´æŠ¤å›°éš¾ å¸¸ç”¨çš„åˆ†å¸ƒå¼æ–¹æ¡ˆï¼š åˆ†å¸ƒå¼åº”ç”¨å’ŒæœåŠ¡ åˆ†å¸ƒå¼é™æ€èµ„æº åˆ†å¸ƒå¼æ•°æ®å’Œå­˜å‚¨ åˆ†å¸ƒå¼è®¡ç®— 3.4. é›†ç¾¤ é›†ç¾¤å³å¤šå°æœåŠ¡å™¨éƒ¨ç½²ç›¸åŒåº”ç”¨æž„æˆä¸€ä¸ªé›†ç¾¤ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡è®¾å¤‡å…±åŒå¯¹å¤–æä¾›æœåŠ¡ã€‚ é›†ç¾¤éœ€è¦å…·å¤‡ä¼¸ç¼©æ€§å’Œæ•…éšœè½¬ç§»æœºåˆ¶ï¼šä¼¸ç¼©æ€§æ˜¯æŒ‡å¯ä»¥æ ¹æ®ç”¨æˆ·è®¿é—®é‡å‘é›†ç¾¤æ·»åŠ æˆ–å‡å°‘æœºå™¨ï¼›æ•…éšœè½¬ç§»æ˜¯æŒ‡ï¼Œå½“æŸå°æœºå™¨å‡ºçŽ°æ•…éšœæ—¶ï¼Œè´Ÿè½½å‡è¡¡è®¾å¤‡æˆ–å¤±æ•ˆè½¬ç§»æœºåˆ¶å°†è¯·æ±‚è½¬å‘åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨ä¸Šï¼Œä»Žè€Œä¸å½±å“ç”¨æˆ·ä½¿ç”¨ã€‚ 3.5. ç¼“å­˜ ç¼“å­˜å°±æ˜¯å°†æ•°æ®å­˜æ”¾åœ¨è·ç¦»æœ€è¿‘çš„ä½ç½®ä»¥åŠ å¿«å¤„ç†é€Ÿåº¦ã€‚ç¼“å­˜æ˜¯æ”¹å–„è½¯ä»¶æ€§èƒ½çš„ç¬¬ä¸€æ‰‹æ®µã€‚ ç½‘ç«™åº”ç”¨ä¸­ï¼Œç¼“å­˜é™¤äº†å¯ä»¥åŠ å¿«æ•°æ®è®¿é—®é€Ÿåº¦ä»¥å¤–ï¼Œè¿˜å¯ä»¥å‡è½»åŽç«¯åº”ç”¨å’Œæ•°æ®å­˜å‚¨çš„è´Ÿè½½åŽ‹åŠ›ã€‚ å¸¸è§ç¼“å­˜æ‰‹æ®µï¼š CDN åå‘ä»£ç† æœ¬åœ°ç¼“å­˜ åˆ†å¸ƒå¼ç¼“å­˜ ä½¿ç”¨ç¼“å­˜æœ‰ä¸¤ä¸ªå‰æï¼š æ•°æ®è®¿é—®çƒ­ç‚¹ä¸å‡åŒ€ï¼Œé¢‘ç¹è®¿é—®çš„æ•°æ®åº”è¯¥æ”¾åœ¨ç¼“å­˜ä¸­ æ•°æ®åœ¨æŸä¸ªæ—¶é—´æ®µæœ‰æ•ˆï¼Œä¸è¿‡å¾ˆå¿«è¿‡æœŸï¼Œå¦åˆ™ç¼“å­˜æ•°æ®ä¼šå› å·²ç»å¤±æ•ˆè€Œäº§ç”Ÿè„è¯» 3.6. å¼‚æ­¥ è½¯ä»¶å‘å±•çš„ä¸€ä¸ªé‡è¦ç›®æ ‡å’Œé©±åŠ¨åŠ›æ˜¯é™ä½Žè½¯ä»¶è€¦åˆæ€§ã€‚äº‹ç‰©ä¹‹é—´ç›´æŽ¥å…³ç³»è¶Šå°‘ï¼Œå½¼æ­¤å½±å“å°±è¶Šå°ï¼Œä¹Ÿå°±æ›´å®¹æ˜“ç‹¬ç«‹å‘å±•ã€‚ å¤§åž‹ç½‘ç«™æž¶æž„ä¸­ï¼Œç³»ç»Ÿè§£è€¦çš„æ‰‹æ®µé™¤äº†åˆ†å±‚ã€åˆ†å‰²ã€åˆ†å¸ƒå¼ç­‰ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦æ‰‹æ®µâ€”â€”å¼‚æ­¥ã€‚ ä¸šåŠ¡é—´çš„æ¶ˆæ¯ä¼ é€’ä¸æ˜¯åŒæ­¥è°ƒç”¨ï¼Œè€Œæ˜¯å°†ä¸€ä¸ªä¸šåŠ¡æ“ä½œæ‹†åˆ†æˆå¤šé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µé—´é€šè¿‡å…±äº«æ•°æ®çš„æ–¹å¼å¼‚æ­¥æ‰§è¡Œè¿›è¡Œåä½œã€‚ åœ¨å•ä¸€æœåŠ¡å™¨å†…éƒ¨å¯é€šè¿‡å¤šçº¿ç¨‹å…±äº«å†…å­˜é˜Ÿåˆ—çš„æ–¹å¼å®žçŽ°å¼‚æ­¥ï¼Œå¤„åœ¨ä¸šåŠ¡æ“ä½œå‰é¢çš„çº¿ç¨‹å°†æ“ä½œè¾“å‡ºåˆ°é˜Ÿåˆ—ï¼ŒåŽé¢çš„çº¿ç¨‹ä»Žé˜Ÿåˆ—ä¸­è¯»å–æ•°æ®è¿›è¡Œå¤„ç†ï¼› åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªæœåŠ¡å™¨é›†ç¾¤é€šè¿‡åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—å®žçŽ°å¼‚æ­¥ã€‚ å¼‚æ­¥æž¶æž„æ˜¯å…¸åž‹çš„ç”Ÿäº§è€…æ¶ˆè´¹æ¨¡å¼ï¼ŒäºŒè€…ä¸å­˜åœ¨ç›´æŽ¥è°ƒç”¨ã€‚å¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—è¿˜æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š æé«˜ç³»ç»Ÿå¯ç”¨æ€§ åŠ å¿«å“åº”é€Ÿåº¦ æ¶ˆé™¤å¹¶å‘è®¿é—®é«˜å³° 3.7. å†—ä½™ å¤§åž‹ç½‘ç«™ï¼Œå‡ºçŽ°æœåŠ¡å™¨å®•æœºæ˜¯å¿…ç„¶äº‹ä»¶ã€‚è¦ä¿è¯éƒ¨åˆ†æœåŠ¡å™¨å®•æœºçš„æƒ…å†µä¸‹ç½‘ç«™ä¾ç„¶å¯ä»¥ç»§ç»­æœåŠ¡ï¼Œä¸ä¸¢å¤±æ•°æ®ï¼Œå°±éœ€è¦ä¸€å®šç¨‹åº¦çš„æœåŠ¡å™¨å†—ä½™è¿è¡Œï¼Œæ•°æ®å†—ä½™å¤‡ä»½ã€‚è¿™æ ·å½“æŸå°æœåŠ¡å™¨å®•æœºæ˜¯ï¼Œå¯ä»¥å°†å…¶ä¸Šçš„æœåŠ¡å’Œæ•°æ®è®¿é—®è½¬ç§»åˆ°å…¶ä»–æœºå™¨ä¸Šã€‚ è®¿é—®å’Œè´Ÿè½½å¾ˆå°çš„æœåŠ¡ä¹Ÿå¿…é¡»éƒ¨ç½² è‡³å°‘ä¸¤å°æœåŠ¡å™¨æž„æˆä¸€ä¸ªé›†ç¾¤ï¼Œç›®çš„å°±æ˜¯é€šè¿‡å†—ä½™å®žçŽ°æœåŠ¡é«˜å¯ç”¨ã€‚æ•°æ®é™¤äº†å®šæœŸå¤‡ä»½ï¼Œå­˜æ¡£ä¿å­˜ï¼Œå®žçŽ° å†·å¤‡ä»½ å¤–ï¼›ä¸ºäº†ä¿è¯åœ¨çº¿ä¸šåŠ¡é«˜å¯ç”¨ï¼Œè¿˜éœ€è¦å¯¹æ•°æ®åº“è¿›è¡Œä¸»ä»Žåˆ†ç¦»ï¼Œå®žæ—¶åŒæ­¥å®žçŽ° çƒ­å¤‡ä»½ã€‚ ä¸ºäº†æŠµå¾¡åœ°éœ‡ã€æµ·å•¸ç­‰ä¸å¯æŠ—å› ç´ å¯¼è‡´çš„ç½‘ç«™å®Œå…¨ç˜«ç—ªï¼ŒæŸäº›å¤§åž‹ç½‘ç«™ä¼šå¯¹æ•´ä¸ªæ•°æ®ä¸­å¿ƒè¿›è¡Œå¤‡ä»½ï¼Œå…¨çƒèŒƒå›´å†…éƒ¨ç½² ç¾å¤‡æ•°æ®ä¸­å¿ƒã€‚ç½‘ç«™ç¨‹åºå’Œæ•°æ®å®žæ—¶åŒæ­¥åˆ°å¤šä¸ªç¾å¤‡æ•°æ®ä¸­å¿ƒã€‚ 3.8. è‡ªåŠ¨åŒ– å¤§åž‹ç½‘ç«™æž¶æž„çš„è‡ªåŠ¨åŒ–æž¶æž„è®¾è®¡ä¸»è¦é›†ä¸­åœ¨å‘å¸ƒè¿ç»´æ–¹é¢ï¼š å‘å¸ƒè¿‡ç¨‹è‡ªåŠ¨åŒ– è‡ªåŠ¨åŒ–ä»£ç ç®¡ç† è‡ªåŠ¨åŒ–æµ‹è¯• è‡ªåŠ¨åŒ–å®‰å…¨ç›‘æµ‹ è‡ªåŠ¨åŒ–éƒ¨ç½² è¿ç»´è‡ªåŠ¨åŒ– è‡ªåŠ¨åŒ–ç›‘æŽ§ è‡ªåŠ¨åŒ–æŠ¥è­¦ è‡ªåŠ¨åŒ–å¤±æ•ˆè½¬ç§» è‡ªåŠ¨åŒ–å¤±æ•ˆæ¢å¤ è‡ªåŠ¨åŒ–é™çº§ è‡ªåŠ¨åŒ–åˆ†é…èµ„æº 3.9. å®‰å…¨ å¯†ç  å’Œ æ‰‹æœºæ ¡éªŒç  è¿›è¡Œèº«ä»½è®¤è¯ ç™»å½•ã€äº¤æ˜“ç­‰é‡è¦æ“ä½œéœ€è¦å¯¹ç½‘ç»œé€šä¿¡è¿›è¡Œ åŠ å¯†ï¼Œå­˜å‚¨çš„æ•æ„Ÿæ•°æ®å¦‚ç”¨æˆ·ä¿¡æ¯ç­‰ä¹Ÿè¿›è¡ŒåŠ å¯†å¤„ç† é˜²æ­¢æœºå™¨äººç¨‹åºæ”»å‡»ç½‘ç«™ï¼Œä½¿ç”¨ éªŒè¯ç  è¿›è¡Œè¯†åˆ« å¯¹å¸¸è§ç”¨äºŽ æ”»å‡» ç½‘ç«™çš„ XSS æ”»å‡»ã€SQL æ³¨å…¥ã€è¿›è¡Œç¼–ç è½¬æ¢ç­‰ç›¸åº”å¤„ç† å¯¹åžƒåœ¾ä¿¡æ¯ã€æ•æ„Ÿä¿¡æ¯è¿›è¡Œ è¿‡æ»¤ å¯¹äº¤æ˜“è½¬è´¦ç­‰é‡è¦æ“ä½œæ ¹æ®äº¤æ˜“æ¨¡å¼å’Œäº¤æ˜“ä¿¡æ¯è¿›è¡Œ é£Žé™©æŽ§åˆ¶ 4. å¤§åž‹ç½‘ç«™æ ¸å¿ƒæž¶æž„è¦ç´  æž¶æž„ çš„ä¸€ç§é€šä¿—è¯´æ³•æ˜¯ï¼šæœ€é«˜å±‚æ¬¡çš„è§„åˆ’ï¼Œéš¾ä»¥æ”¹å˜çš„å†³å®šã€‚ é™¤äº†ç³»ç»ŸåŠŸèƒ½éœ€æ±‚å¤–ï¼Œæž¶æž„è¿˜éœ€è¦å…³æ³¨ä»¥ä¸‹æž¶æž„è¦ç´ ï¼š 4.1. æ€§èƒ½ æ€§èƒ½é—®é¢˜æ— å¤„ä¸åœ¨ï¼Œæ‰€ä»¥ç½‘ç«™æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µä¹Ÿååˆ†ç¹å¤šï¼š å‰ç«¯ æµè§ˆå™¨ç¼“å­˜ é™æ€èµ„æºåŽ‹ç¼© åˆç†å¸ƒå±€é¡µé¢ å‡å°‘ cookie ä¼ è¾“ CDN åº”ç”¨æœåŠ¡å™¨ æœ¬åœ°ç¼“å­˜ åˆ†å¸ƒå¼ç¼“å­˜ å¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ— é›†ç¾¤ ä»£ç å±‚é¢ï¼šä½¿ç”¨å¤šçº¿ç¨‹ã€æ”¹å–„å†…å­˜ç®¡ç† æ•°æ®åº“ ç´¢å¼• æ•°æ®åº“ç¼“å­˜ SQL ä¼˜åŒ– 4.2. å¯ç”¨æ€§ å¯ç”¨æ€§æŒ‡éƒ¨åˆ†æœåŠ¡å™¨å‡ºçŽ°æ•…éšœæ—¶ï¼Œè¿˜èƒ½å¦å¯¹ç”¨æˆ·æä¾›æœåŠ¡ å†—ä½™ é€šè¿‡è´Ÿè½½å‡è¡¡è®¾å¤‡å»ºç«‹é›†ç¾¤å…±åŒå¯¹å¤–æä¾›æœåŠ¡ æ•°æ®å­˜å‚¨åœ¨å¤šå°æœåŠ¡å™¨ï¼Œäº’ç›¸å¤‡ä»½ è‡ªåŠ¨åŒ–ï¼šé€šè¿‡é¢„å‘å¸ƒéªŒè¯ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€è‡ªåŠ¨åŒ–å‘å¸ƒã€ç°åº¦å‘å¸ƒç­‰æ‰‹æ®µï¼Œå‡å°‘å°†æ•…éšœå¼•å…¥çº¿ä¸ŠçŽ¯å¢ƒçš„å¯èƒ½ 4.3. ä¼¸ç¼©æ€§ è¡¡é‡ä¼¸ç¼©çš„æ ‡å‡†å°±æ˜¯æ˜¯å¦å¯ä»¥ç”¨å¤šå°æœåŠ¡å™¨æž„å»ºé›†ç¾¤ï¼Œæ˜¯å¦å®¹æ˜“å‘é›†ç¾¤ä¸­å¢žåˆ æœåŠ¡å™¨èŠ‚ç‚¹ã€‚å¢žåˆ æœåŠ¡å™¨èŠ‚ç‚¹åŽæ˜¯å¦å¯ä»¥æä¾›å’Œä¹‹å‰æ— å·®åˆ«çš„æœåŠ¡ã€‚é›†ç¾¤ä¸­å¯å®¹çº³çš„æ€»æœåŠ¡å™¨æ•°æ˜¯å¦æœ‰é™åˆ¶ã€‚ åº”ç”¨æœåŠ¡å™¨é›†ç¾¤ - åªè¦æœåŠ¡å™¨ä¸Šä¿å­˜æ•°æ®ï¼Œåˆ™æ‰€æœ‰æœåŠ¡å™¨éƒ½æ˜¯å¯¹ç­‰çš„ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡è®¾å¤‡å‘é›†ç¾¤ä¸­ä¸æ–­åŠ å…¥æœåŠ¡å™¨å³å¯ ç¼“å­˜æœåŠ¡å™¨é›†ç¾¤ - åŠ å…¥æ–°çš„æœåŠ¡å™¨å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜è·¯ç”±å¤±æ•ˆï¼Œè¿›è€Œå¯¼è‡´é›†ç¾¤ä¸­çš„å¤§éƒ¨åˆ†ç¼“å­˜æ•°æ®éƒ½æ— æ³•è®¿é—®ã€‚è™½ç„¶ç¼“å­˜æ•°æ®å¯ä»¥é€šè¿‡æ•°æ®åº“é‡æ–°åŠ è½½ï¼Œä½†æ˜¯å¦‚æžœåº”ç”¨ä¸¥é‡ä¾èµ–ç¼“å­˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç½‘ç«™å´©æºƒã€‚éœ€è¦æ”¹è¿›ç¼“å­˜è·¯ç”±ç®—æ³•ä¿è¯ç¼“å­˜æ•°æ®çš„å¯è®¿é—®æ€§ã€‚ å…³ç³»åž‹æ•°æ®åº“é›†ç¾¤ - å…³ç³»åž‹æ•°æ®åº“è™½ç„¶æ”¯æŒæ•°æ®å¤åˆ¶ï¼Œä¸»ä»Žçƒ­å¤‡ç­‰æœºåˆ¶ï¼Œä½†æ˜¯å¾ˆéš¾åšåˆ°å¤§è§„æ¨¡é›†ç¾¤çš„å¯ä¼¸ç¼©æ€§ï¼Œå› æ­¤å…³ç³»åž‹æ•°æ®åº“çš„é›†ç¾¤ä¼¸ç¼©æ€§æ–¹æ¡ˆå¿…é¡»åœ¨æ•°æ®åº“ä¹‹å¤–å®žçŽ°ï¼Œé€šè¿‡è·¯ç”±åˆ†åŒºç­‰æ‰‹æ®µå°†éƒ¨ç½²æœ‰å¤šä¸ªæ•°æ®åº“çš„æœåŠ¡å™¨ç»„æˆä¸€ä¸ªé›†ç¾¤ã€‚ NOSql æ•°æ®åº“é›†ç¾¤ - ç”±äºŽå…ˆå¤©å°±æ˜¯ä¸ºäº†åº”å¯¹æµ·é‡æ•°æ®è€Œäº§ç”Ÿï¼Œå› æ­¤å¯¹ä¼¸ç¼©æ€§çš„æ”¯æŒé€šå¸¸éƒ½éžå¸¸å¥½ã€‚ 4.4. æ‰©å±•æ€§ è¡¡é‡æ‰©å±•æ€§çš„æ ‡å‡†å°±æ˜¯å¢žåŠ æ–°çš„ä¸šåŠ¡äº§å“æ—¶ï¼Œæ˜¯å¦å¯ä»¥å®žçŽ°å¯¹çŽ°æœ‰äº§å“é€æ˜Žæ— å½±å“ï¼Œä¸éœ€è¦ä»»ä½•æ”¹åŠ¨æˆ–å¾ˆå°‘æ”¹åŠ¨ï¼Œæ—¢æœ‰åŠŸèƒ½å°±å¯ä»¥ä¸Šçº¿æ–°äº§å“ã€‚ä¸»è¦æ‰‹æ®µæœ‰ï¼šäº‹ä»¶é©±åŠ¨æž¶æž„å’Œåˆ†å¸ƒå¼æœåŠ¡ã€‚ 4.5. å®‰å…¨æ€§ å®‰å…¨æ€§ä¿æŠ¤ç½‘ç«™ä¸å—æ¶æ„æ”»å‡»ï¼Œä¿æŠ¤ç½‘ç«™é‡è¦æ•°æ®ä¸è¢«çªƒå–ã€‚ 5. èµ„æ–™ å¤§åž‹ç½‘ç«™æŠ€æœ¯æž¶æž„]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç½‘ç«™çš„å¯æ‰©å±•æž¶æž„]]></title>
    <url>%2Fblog%2F2018%2F07%2F05%2Fdesign%2Farchitecture%2F%E7%BD%91%E7%AB%99%E7%9A%84%E5%8F%AF%E6%89%A9%E5%B1%95%E6%9E%B6%E6%9E%84%2F</url>
    <content type="text"><![CDATA[ç½‘ç«™çš„å¯æ‰©å±•æž¶æž„ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ 1. æž„å»ºå¯æ‰©å±•çš„ç½‘ç«™æž¶æž„ 2. åˆ©ç”¨åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—é™ä½Žç³»ç»Ÿè€¦åˆæ€§ 2.1. äº‹ä»¶é©±åŠ¨æž¶æž„ 2.2. åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ— 3. åˆ©ç”¨åˆ†å¸ƒå¼æœåŠ¡æ‰“é€ å¯å¤ç”¨çš„ä¸šåŠ¡å¹³å° 4. å¯æ‰©å±•çš„æ•°æ®ç»“æž„ 5. èµ„æ–™ æ‰©å±•æ€§ï¼ˆExtensibilityï¼‰ - æŒ‡å¯¹çŽ°æœ‰ç³»ç»Ÿå½±å“æœ€å°çš„æƒ…å†µä¸‹ï¼Œç³»ç»ŸåŠŸèƒ½å¯æŒç»­æ‰©å±•æˆ–æå‡çš„èƒ½åŠ›ã€‚è¡¨çŽ°åœ¨ç³»ç»ŸåŸºç¡€è®¾æ–½ç¨³å®šä¸éœ€è¦ç»å¸¸å˜æ›´ï¼Œåº”ç”¨ä¹‹é—´è¾ƒå°‘ä¾èµ–å’Œè€¦åˆï¼Œå¯¹éœ€æ±‚å˜æ›´å¯ä»¥æ•æ·å“åº”ã€‚å®ƒæ˜¯ç³»ç»Ÿæž¶æž„è®¾è®¡å±‚é¢çš„å¼€é—­åŽŸåˆ™ï¼ˆå¯¹æ‰©å±•å¼€æ”¾ã€å¯¹ä¿®æ”¹å…³é—­ï¼‰ï¼Œæž¶æž„è®¾è®¡è€ƒè™‘æœªæ¥åŠŸèƒ½æ‰©å±•ï¼Œå½“ç³»ç»Ÿå¢žåŠ æ–°åŠŸèƒ½æ—¶ï¼Œä¸éœ€è¦å¯¹çŽ°æœ‰ç³»ç»Ÿçš„ç»“æž„å’Œä»£ç è¿›è¡Œä¿®æ”¹ã€‚ ä¼¸ç¼©æ€§ï¼ˆScalabilityï¼‰ - æŒ‡ç³»ç»Ÿèƒ½å¤Ÿé€šè¿‡å¢žåŠ å‡å°‘è‡ªèº«èµ„æºè§„æ¨¡çš„æ–¹å¼å¢žå‡è‡ªå·±è®¡ç®—å¤„ç†äº‹åŠ¡çš„èƒ½åŠ›ã€‚å¦‚æžœè¿™ç§å¢žå‡æ˜¯æˆæ¯”ä¾‹çš„ï¼Œå°±è¢«ç§°ä½œçº¿æ€§ä¼¸ç¼©æ€§ã€‚åœ¨ç½‘ç«™æž¶æž„ä¸­ ï¼Œé€šå¸¸æŒ‡åˆ©ç”¨é›†ç¾¤çš„æ–¹å¼å¢žåŠ æœåŠ¡å™¨æ•°é‡ã€æé«˜ç³»ç»Ÿçš„æ•´ä½“äº‹åŠ¡åžåèƒ½åŠ›ã€‚ 1. æž„å»ºå¯æ‰©å±•çš„ç½‘ç«™æž¶æž„ ä½Žè€¦åˆçš„ç³»ç»Ÿæ›´å®¹æ˜“æ‰©å±•ã€å¤ç”¨ã€‚ è®¾è®¡ç½‘ç«™å¯æ‰©å±•æž¶æž„çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ¨¡å—åŒ–ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šï¼Œé™ä½Žæ¨¡å—é—´çš„è€¦åˆæ€§ï¼Œæé«˜æ¨¡å—çš„å¤ç”¨æ€§ã€‚ åˆ†å±‚å’Œåˆ†å‰²ä¸ä»…å¯ä»¥è¿›è¡Œæž¶æž„ä¼¸ç¼©ï¼Œä¹Ÿæ˜¯æ¨¡å—åŒ–è®¾è®¡çš„é‡è¦æ‰‹æ®µï¼Œåˆ©ç”¨åˆ†å±‚å’Œåˆ†å‰²çš„æ–¹å¼å°†è½¯ä»¶åˆ†å‰²ä¸ºè‹¥å¹²ä¸ªä½Žè€¦åˆçš„ç‹¬ç«‹çš„ç»„ä»¶æ¨¡å—ï¼Œè¿™äº›ç»„ä»¶æ¨¡å—ä»¥æ¶ˆæ¯ä¼ é€’åŠä¾èµ–è°ƒç”¨çš„æ–¹å¼èšåˆæˆä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿã€‚ åœ¨å¤§åž‹ç½‘ç«™ä¸­ï¼Œè¿™äº›æ¨¡å—é€šè¿‡åˆ†å¸ƒå¼éƒ¨ç½²çš„æ–¹å¼ï¼Œç‹¬ç«‹çš„æ¨¡å—éƒ¨ç½²åœ¨ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šï¼Œä»Žç‰©ç†ä¸Šåˆ†ç¦»æ¨¡å—é—´çš„è€¦åˆå…³ç³»ï¼Œè¿›ä¸€æ­¥é™ä½Žè€¦åˆæ€§æé«˜å¤ç”¨æ€§ã€‚ 2. åˆ©ç”¨åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—é™ä½Žç³»ç»Ÿè€¦åˆæ€§ 2.1. äº‹ä»¶é©±åŠ¨æž¶æž„ äº‹ä»¶é©±åŠ¨æž¶æž„é€šè¿‡åœ¨ä½Žè€¦åˆçš„æ¨¡å—é—´ä¼ è¾“äº‹ä»¶æ¶ˆæ¯ï¼Œä»¥ä¿æŒæ¨¡å—çš„æ¾æ•£è€¦åˆï¼Œå¹¶å€ŸåŠ©äº‹ä»¶æ¶ˆæ¯çš„é€šä¿¡å®Œæˆæ¨¡å—é—´åˆä½œã€‚å…¸åž‹çš„äº‹ä»¶é©±åŠ¨æž¶æž„å°±æ˜¯æ“ä½œç³»ç»Ÿä¸­å¸¸è§çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ã€‚åœ¨å¤§åž‹ç½‘ç«™ä¸­ï¼Œæœ€å¸¸è§çš„å®žçŽ°æ‰‹æ®µå°±æ˜¯åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ã€‚ 2.2. åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ— æ¶ˆæ¯ç”Ÿäº§è€…åº”ç”¨ç¨‹åºé€šè¿‡è¿œç¨‹è®¿é—®æŽ¥å£å°†æ¶ˆæ¯æŽ¨é€ç»™æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å°†æ¶ˆæ¯å†™å…¥æœ¬åœ°å†…å­˜é˜Ÿåˆ—åŽç«‹å³è¿”å›žæˆåŠŸå“åº”ç»™æ¶ˆæ¯ç”Ÿäº§è€…ã€‚æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨æ ¹æ®æ¶ˆæ¯è®¢é˜…åˆ—è¡¨æŸ¥æ‰¾è®¢é˜…è¯¥æ¶ˆæ¯çš„æ¶ˆæ¯æ¶ˆè´¹è€…åº”ç”¨ç¨‹åºï¼Œå°†æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æŒ‰ç…§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŽŸåˆ™å°†æ¶ˆæ¯é€šè¿‡è¿œç¨‹é€šä¿¡æŽ¥å£å‘é€ç»™æ¶ˆæ¯æ¶ˆè´¹è€…ç¨‹åºã€‚ åœ¨ä¼¸ç¼©æ€§æ–¹é¢ï¼Œç”±äºŽæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨ä¸Šçš„æ•°æ®å¯ä»¥çœ‹ä½œæ˜¯å³æ—¶å¤„ç†çš„ï¼Œå› æ­¤ç±»ä¼¼äºŽæ— çŠ¶æ€çš„æœåŠ¡å™¨ï¼Œä¼¸ç¼©æ€§è®¾è®¡æ¯”è¾ƒç®€å•ã€‚å°†æ–°æœåŠ¡å™¨åŠ å…¥åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—é›†ç¾¤ä¸­ï¼Œé€šçŸ¥ç”Ÿäº§è€…æœåŠ¡å™¨æ›´æ”¹æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨åˆ—è¡¨å³å¯ã€‚ åœ¨å¯ç”¨æ€§æ–¹é¢ï¼Œä¸ºäº†é¿å…æ¶ˆè´¹è€…è¿›ç¨‹å¤„ç†ç¼“æ…¢ï¼Œåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å†…å­˜ç©ºé—´ä¸è¶³é€ æˆçš„é—®é¢˜ï¼Œå¦‚æžœå†…å­˜é˜Ÿåˆ—å·²æ»¡ï¼Œä¼šå°†æ¶ˆæ¯å†™å…¥ç£ç›˜ï¼Œæ¶ˆæ¯æŽ¨é€æ¨¡å—åœ¨å°†å†…å­˜é˜Ÿåˆ—æ¶ˆæ¯å¤„ç†å®Œæˆä»¥åŽï¼Œå°†ç£ç›˜å†…å®¹åŠ è½½åˆ°å†…å­˜é˜Ÿåˆ—ç»§ç»­å¤„ç†ã€‚ 3. åˆ©ç”¨åˆ†å¸ƒå¼æœåŠ¡æ‰“é€ å¯å¤ç”¨çš„ä¸šåŠ¡å¹³å° åˆ†å¸ƒå¼æœåŠ¡åˆ™é€šè¿‡æŽ¥å£åˆ†è§£ç³»ç»Ÿè€¦åˆæ€§ï¼Œä¸åŒå­ç³»ç»Ÿé€šè¿‡ç›¸åŒçš„æŽ¥å£æè¿°è¿›è¡ŒæœåŠ¡è°ƒç”¨ã€‚ å¤§åž‹ç½‘ç«™åˆ†å¸ƒå¼æœåŠ¡çš„éœ€æ±‚ä¸Žç‰¹ç‚¹ï¼š è´Ÿè½½å‡è¡¡ å¤±æ•ˆè½¬ç§» é«˜æ•ˆçš„è¿œç¨‹é€šä¿¡ æ•´åˆå¼‚æž„ç³»ç»Ÿ å¯¹åº”ç”¨æœ€å°‘ä¾µå…¥ ç‰ˆæœ¬ç®¡ç† å®žæ—¶ç›‘æŽ§ 4. å¯æ‰©å±•çš„æ•°æ®ç»“æž„ ä¼ ç»Ÿçš„å…³ç³»åž‹æ•°æ®åº“ä¸ºäº†ä¿è¯å…³ç³»è¿ç®—çš„æ­£ç¡®æ€§ï¼Œåœ¨è®¾è®¡æ•°æ®åº“è¡¨ç»“æž„çš„æ—¶å€™ï¼Œå°±éœ€è¦æŒ‡å®šè¡¨çš„ schema â€”â€”å­—æ®µåç§°ï¼Œæ•°æ®ç±»åž‹ç­‰ï¼Œå¹¶è¦éµå¾ªç‰¹å®šçš„è®¾è®¡èŒƒå¼ã€‚è¿™äº›è§„èŒƒå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šéš¾ä»¥é¢å¯¹éœ€æ±‚å˜æ›´å¸¦æ¥çš„æŒ‘æˆ˜ï¼Œæ‰€ä»¥æœ‰äººé€šè¿‡é¢„å…ˆè®¾è®¡ä¸€äº›å†—ä½™å­—æ®µæ¥åº”å¯¹ã€‚ è®¸å¤š NoSql æ•°æ®åº“ä½¿ç”¨ ColumnFamily è®¾è®¡æ¥è®¾è®¡å¯æ‰©å±•çš„æ•°æ®ç»“æž„ã€‚ 5. èµ„æ–™ å¤§åž‹ç½‘ç«™æŠ€æœ¯æž¶æž„]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç½‘ç«™å…¸åž‹æ•…éšœ]]></title>
    <url>%2Fblog%2F2018%2F07%2F05%2Fdesign%2Farchitecture%2F%E7%BD%91%E7%AB%99%E5%85%B8%E5%9E%8B%E6%95%85%E9%9A%9C%2F</url>
    <content type="text"><![CDATA[ç½‘ç«™å…¸åž‹æ•…éšœ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ 1. æµ·é‡æ—¥å¿—è€—å°½ç£ç›˜ç©ºé—´å¼•å‘çš„æ•…éšœ 2. é«˜å¹¶å‘è®¿é—®æ•°æ®åº“å¼•å‘çš„æ•…éšœ 3. é«˜å¹¶å‘æƒ…å†µä¸‹é”å¼•å‘çš„æ•…éšœ 4. ç¼“å­˜å¼•å‘çš„æ•…éšœ 5. åº”ç”¨å¯åŠ¨ä¸åŒæ­¥å¼•å‘çš„æ•…éšœ 6. å¤§æ–‡ä»¶è¯»å†™ç‹¬å ç£ç›˜å¼•å‘çš„æ•…éšœ 7. èµ„æ–™ 1. æµ·é‡æ—¥å¿—è€—å°½ç£ç›˜ç©ºé—´å¼•å‘çš„æ•…éšœ çŽ°è±¡ï¼šåº”ç”¨å‘å¸ƒåŽï¼Œç¡¬ç›˜ç©ºé—´ä½ŽäºŽè­¦æˆ’å€¼ï¼ŒæœåŠ¡å™¨å®•æœºã€‚ åˆ†æžï¼šåº”ç”¨éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸æ–­æ‰“å°æ—¥å¿—ï¼Œä½†ä¸å®šæœŸæ¸…ç†æ—¥å¿—ï¼Œå¯¼è‡´ç£ç›˜ç©ºé—´æœ€ç»ˆè¢«è€—å°½ã€‚ æ€»ç»“ï¼š åº”ç”¨è‡ªèº«çš„æ—¥å¿—å’Œç¬¬ä¸‰æ–¹ç»„ä»¶æ—¥å¿—åº”åˆ†åˆ«é…ç½®ã€‚ æ—¥å¿—è¾“å‡ºçº§åˆ«ä¸è¦è®¾ç½®å¤ªä½Žï¼Œå¯¼è‡´æ‰“å°å¾ˆå¤šæ— å…³ç—›ç—’çš„ä¿¡æ¯ã€‚ 2. é«˜å¹¶å‘è®¿é—®æ•°æ®åº“å¼•å‘çš„æ•…éšœ çŽ°è±¡ï¼šæ•°æ®åº“è´Ÿè½½å±…é«˜ä¸ä¸‹ã€‚ åˆ†æžï¼šæŸæ¡ sql æ‰§è¡Œé¢‘çŽ‡éžå¸¸é«˜ï¼Œè¿½æŸ¥å‘çŽ°ï¼Œè¢«ç½‘ç«™é¦–é¡µè°ƒç”¨ã€‚ æ€»ç»“ï¼šé¦–é¡µä¸åº”è¯¥è®¿é—®æ•°æ®åº“ã€‚ 3. é«˜å¹¶å‘æƒ…å†µä¸‹é”å¼•å‘çš„æ•…éšœ çŽ°è±¡ï¼šåº”ç”¨ä¸å®šæ—¶åœ°å› ä¸ºå“åº”è¶…æ—¶è€ŒæŠ¥è­¦ï¼Œä½†æ˜¯å¾ˆå¿«åˆè¶…æ—¶æŽ¥è§¦ï¼Œæ¢å¤æ­£å¸¸ã€‚ åˆ†æžï¼šæŸä¸ªå•ä¾‹å¯¹è±¡ä¸­å¤šå¤„ä½¿ç”¨äº† synchronizedï¼Œç”±äºŽ this å¯¹è±¡åªæœ‰ä¸€ä¸ªï¼Œæ‰€æœ‰çš„å¹¶å‘è¯·æ±‚éƒ½è¦æŽ’é˜ŸèŽ·å¾—è€…å”¯ä¸€çš„ä¸€æŠŠé”ã€‚ æ€»ç»“ï¼šä½¿ç”¨é”æ“ä½œè¦è°¨æ…Žã€‚ 4. ç¼“å­˜å¼•å‘çš„æ•…éšœ çŽ°è±¡ï¼šæ²¡æœ‰æ–°åº”ç”¨å‘å¸ƒï¼Œä½†æ˜¯æ•°æ®åº“çªç„¶è´Ÿè½½é£™å‡ï¼Œå¹¶å¾ˆå¿«å¤±åŽ»å“åº”ã€‚ åˆ†æžï¼šç¼“å­˜æœåŠ¡å™¨ç®¡ç†å¤±å½“ã€‚ æ€»ç»“ï¼šå½“ç½‘ç«™æž¶æž„å¯¹ç¼“å­˜ä¾èµ–æ€§å¾ˆå¼ºæ—¶ï¼Œåº”è¯¥é‡è§†å¯¹ç¼“å­˜æœåŠ¡çš„ç®¡ç†ã€‚ 5. åº”ç”¨å¯åŠ¨ä¸åŒæ­¥å¼•å‘çš„æ•…éšœ çŽ°è±¡ï¼šæŸåº”ç”¨å‘å¸ƒåŽï¼ŒæœåŠ¡å™¨ç«‹å³å´©æºƒã€‚ åˆ†æžï¼šåŽå°æœåŠ¡è¿˜æ²¡å‡†å¤‡å¥½ï¼Œå‰å°åº”ç”¨å°±å¼€å§‹æŽ¥å—è¯·æ±‚ï¼Œå¯¼è‡´æ•…éšœã€‚ æ€»ç»“ï¼šå‘å¸ƒè„šæœ¬ä¸­ä¸æ–­ç”¨ curl å‘½ä»¤è®¿é—®åŽå°åº”ç”¨ç‰¹å®šé¡µé¢ï¼Œç›´åˆ°æ”¶åˆ° OKï¼Œå†å¯åŠ¨å‰å°åº”ç”¨ã€‚ 6. å¤§æ–‡ä»¶è¯»å†™ç‹¬å ç£ç›˜å¼•å‘çš„æ•…éšœ çŽ°è±¡ï¼šä¸Šä¼ å›¾ç‰‡éžå¸¸æ…¢ã€‚ åˆ†æžï¼šæ–‡ä»¶å­˜å‚¨æœ€æœ‰å¯èƒ½å‡ºé”™çš„åœ°æ–¹æ˜¯å­˜å‚¨æœåŠ¡å™¨ã€‚æ£€æŸ¥å‘çŽ°ï¼Œå¤§éƒ¨åˆ†æ–‡ä»¶å¤§å°æ¯”è¾ƒå°ï¼Œå°‘æ•°å‡ ä¸ªæ–‡ä»¶éžå¸¸å¤§ï¼Œè¯»å†™å¤§æ–‡ä»¶æ¯”è¾ƒè€—æ—¶ï¼Œåœ¨è¿™ä¸ªè¯»å†™æ—¶é—´å†…ï¼Œç£ç›˜åŸºæœ¬è¢«å¤§æ–‡ä»¶æ“ä½œç‹¬å ï¼Œå¯¼è‡´å…¶ä»–ç”¨æˆ·çš„æ–‡ä»¶æ“ä½œç¼“æ…¢ã€‚ æ€»ç»“ï¼šæ–‡ä»¶å­˜å‚¨ä¸‹éœ€è¦æ ¹æ®ä¸åŒæ–‡ä»¶ç±»åž‹å’Œç”¨é€”è¿›è¡Œç®¡ç†ã€‚ 7. èµ„æ–™ å¤§åž‹ç½‘ç«™æŠ€æœ¯æž¶æž„]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼æž¶æž„]]></title>
    <url>%2Fblog%2F2018%2F07%2F05%2Fdesign%2Farchitecture%2F%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼æž¶æž„ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ åˆ†å¸ƒå¼æž¶æž„çš„æ¼”è¿› åˆ†å¸ƒå¼æž¶æž„çš„é—®é¢˜ åˆ†å¸ƒå¼æž¶æž„çš„å…³é”®æŠ€æœ¯ æ¶ˆæ¯é˜Ÿåˆ— æœåŠ¡åŒ– æœåŠ¡æ€»çº¿ åˆ†å¸ƒå¼æž¶æž„çš„é€šä¿¡æ¨¡å¼ request/response æ¨¡å¼ï¼ˆåŒæ­¥æ¨¡å¼ï¼‰ Callbackï¼ˆå¼‚æ­¥æ¨¡å¼ï¼‰ Future æ¨¡å¼ Oneway æ¨¡å¼ Reliable æ¨¡å¼ èµ„æ–™ åˆ†å¸ƒå¼æž¶æž„çš„æ¼”è¿› åˆ†å¸ƒå¼æž¶æž„çš„é—®é¢˜ å½“æœåŠ¡è¶Šæ¥è¶Šå¤šæ—¶ï¼ŒæœåŠ¡ URL é…ç½®ç®¡ç†å˜å¾—éžå¸¸å›°éš¾ï¼ŒF5 ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨çš„å•ç‚¹åŽ‹åŠ›ä¹Ÿè¶Šæ¥è¶Šå¤§ã€‚ å½“è¿›ä¸€æ­¥å‘å±•ï¼ŒæœåŠ¡é—´ä¾èµ–å…³ç³»å˜å¾—é”™è¸ªå¤æ‚ï¼Œç”šè‡³åˆ†ä¸æ¸…å“ªä¸ªåº”ç”¨è¦åœ¨å“ªä¸ªåº”ç”¨ä¹‹å‰å¯åŠ¨ï¼Œæž¶æž„å¸ˆéƒ½ä¸èƒ½å®Œæ•´çš„æè¿°åº”ç”¨çš„æž¶æž„å…³ç³»ã€‚ æŽ¥ç€ï¼ŒæœåŠ¡çš„è°ƒç”¨é‡è¶Šæ¥è¶Šå¤§ï¼ŒæœåŠ¡çš„å®¹é‡é—®é¢˜å°±æš´éœ²å‡ºæ¥ï¼Œè¿™ä¸ªæœåŠ¡éœ€è¦å¤šå°‘æœºå™¨æ”¯æ’‘ï¼Ÿä»€ä¹ˆæ—¶å€™è¯¥åŠ æœºå™¨ï¼Ÿ æœåŠ¡å¤šäº†ï¼Œæ²Ÿé€šæˆæœ¬ä¹Ÿå¼€å§‹ä¸Šå‡ï¼Œè°ƒæŸä¸ªæœåŠ¡å¤±è´¥è¯¥æ‰¾è°ï¼ŸæœåŠ¡çš„å‚æ•°éƒ½æœ‰ä»€ä¹ˆçº¦å®šï¼Ÿ ä¸€ä¸ªæœåŠ¡æœ‰å¤šä¸ªä¸šåŠ¡æ¶ˆè´¹è€…ï¼Œå¦‚ä½•ç¡®ä¿æœåŠ¡è´¨é‡ï¼Ÿ éšç€æœåŠ¡çš„ä¸åœå‡çº§ï¼Œæ€»æœ‰äº›æ„æƒ³ä¸åˆ°çš„äº‹å‘ç”Ÿï¼Œæ¯”å¦‚ cache å†™é”™äº†å¯¼è‡´å†…å­˜æº¢å‡ºï¼Œæ•…éšœä¸å¯é¿å…ï¼Œæ¯æ¬¡æ ¸å¿ƒæœåŠ¡ä¸€æŒ‚ï¼Œå½±å“ä¸€å¤§ç‰‡ï¼Œäººå¿ƒæ…Œæ…Œï¼Œå¦‚ä½•æŽ§åˆ¶æ•…éšœçš„å½±å“é¢ï¼ŸæœåŠ¡æ˜¯å¦å¯ä»¥åŠŸèƒ½é™çº§ï¼Ÿæˆ–è€…èµ„æºåŠ£åŒ–ï¼Ÿ åˆ†å¸ƒå¼æž¶æž„çš„å…³é”®æŠ€æœ¯ æ¶ˆæ¯é˜Ÿåˆ— æ¶ˆæ¯é˜Ÿåˆ—é€šè¿‡æ¶ˆæ¯å¯¹è±¡åˆ†è§£ç³»ç»Ÿè€¦åˆæ€§ï¼Œä¸åŒå­ç³»ç»Ÿå¤„ç†åŒä¸€ä¸ªæ¶ˆæ¯ã€‚ æ¶ˆæ¯é˜Ÿåˆ—æ¡†æž¶ æ¶ˆæ¯é˜Ÿåˆ—åŽŸç† æœåŠ¡åŒ– æœåŠ¡æ¡†æž¶é€šè¿‡æŽ¥å£åˆ†è§£ç³»ç»Ÿè€¦åˆæ€§ï¼Œä¸åŒå­ç³»ç»Ÿé€šè¿‡ç›¸åŒçš„æŽ¥å£æè¿°è¿›è¡ŒæœåŠ¡å¯ç”¨ã€‚ æœåŠ¡æ¡†æž¶æ˜¯ä¸€ä¸ªç‚¹å¯¹ç‚¹æ¨¡åž‹ã€‚ æœåŠ¡æ¡†æž¶é¢å‘åŒæž„ç³»ç»Ÿã€‚ é€‚åˆï¼šç§»åŠ¨åº”ç”¨ã€äº’è”ç½‘åº”ç”¨ã€å¤–éƒ¨ç³»ç»Ÿã€‚ æœåŠ¡åŒ–æ¡†æž¶ æœåŠ¡åŒ–åŽŸç† æœåŠ¡æ²»ç† æœåŠ¡æ²»ç†æ˜¯æœåŠ¡æ¡†æž¶/æœåŠ¡æ€»çº¿çš„æ ¸å¿ƒåŠŸèƒ½ã€‚æ‰€è°“æœåŠ¡æ²»ç†ï¼Œæ˜¯æŒ‡æœåŠ¡çš„æä¾›æ–¹å’Œæ¶ˆè´¹æ–¹è¾¾æˆä¸€è‡´çš„çº¦å®šï¼Œä¿è¯æœåŠ¡çš„é«˜è´¨é‡ã€‚æœåŠ¡æ²»ç†åŠŸèƒ½å¯ä»¥è§£å†³å°†æŸäº›ç‰¹å®šæµé‡å¼•å…¥æŸä¸€æ‰¹æœºå™¨ï¼Œä»¥åŠé™åˆ¶æŸäº›éžæ³•æ¶ˆè´¹è€…çš„æ¶æ„è®¿é—®ï¼Œå¹¶åœ¨æä¾›è€…å¤„ç†é‡è¾¾åˆ°ä¸€å®šç¨‹åº¦æ˜¯ï¼Œæ‹’ç»æŽ¥å—æ–°çš„è®¿é—®ã€‚ å½“å‰æ¯”è¾ƒæµè¡Œçš„æœåŠ¡æ²»ç†æ¡†æž¶ï¼šDubboã€‚ æœåŠ¡æ€»çº¿ æœåŠ¡æ€»çº¿åŒæœåŠ¡æ¡†æž¶ä¸€æ ·ï¼Œå‡æ˜¯é€šè¿‡æŽ¥å£åˆ†è§£ç³»ç»Ÿè€¦åˆæ€§ï¼Œä¸åŒå­ç³»ç»Ÿé€šè¿‡ç›¸åŒçš„æŽ¥å£æè¿°è¿›è¡ŒæœåŠ¡å¯ç”¨ã€‚ æœåŠ¡æ€»çº¿æ˜¯ä¸€ä¸ªæ€»çº¿å¼çš„æ¨¡åž‹ã€‚ æœåŠ¡æ€»çº¿é¢å‘åŒæž„ã€å¼‚æž„ç³»ç»Ÿã€‚ é€‚åˆï¼šå†…éƒ¨ç³»ç»Ÿã€‚ æœåŠ¡æ€»çº¿æ¡†æž¶ æœåŠ¡æ€»çº¿åŽŸç† åˆ†å¸ƒå¼æž¶æž„çš„é€šä¿¡æ¨¡å¼ request/response æ¨¡å¼ï¼ˆåŒæ­¥æ¨¡å¼ï¼‰ å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ä¸€ç›´é˜»å¡žåˆ°æœåŠ¡ç«¯è¿”å›žè¯·æ±‚ä¸ºæ­¢ã€‚ Callbackï¼ˆå¼‚æ­¥æ¨¡å¼ï¼‰ å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª RPC è¯·æ±‚ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡ç«¯å¤„ç†åŽå†å‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™æ¶ˆæ¯å‘é€ç«¯æä¾›çš„ callback ç«¯ç‚¹ï¼Œæ­¤ç±»æƒ…å†µéžå¸¸åˆé€‚ä»¥ä¸‹åœºæ™¯ï¼šA ç»„ä»¶å‘é€ RPC è¯·æ±‚ç»™ Bï¼ŒB å¤„ç†å®ŒæˆåŽï¼Œéœ€è¦é€šçŸ¥ A ç»„ä»¶åšåŽç»­å¤„ç†ã€‚ Future æ¨¡å¼ å®¢æˆ·ç«¯å‘é€å®Œè¯·æ±‚åŽï¼Œç»§ç»­åšè‡ªå·±çš„äº‹æƒ…ï¼Œè¿”å›žä¸€ä¸ªåŒ…å«æ¶ˆæ¯ç»“æžœçš„ Future å¯¹è±¡ã€‚å®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨è¿”å›žç»“æžœæ—¶ï¼Œä½¿ç”¨ Future å¯¹è±¡çš„.get(),å¦‚æžœæ­¤æ—¶æ²¡æœ‰ç»“æžœè¿”å›žçš„è¯ï¼Œä¼šä¸€ç›´é˜»å¡žåˆ°æœ‰ç»“æžœè¿”å›žä¸ºæ­¢ã€‚ Oneway æ¨¡å¼ å®¢æˆ·ç«¯è°ƒç”¨å®Œç»§ç»­æ‰§è¡Œï¼Œä¸ç®¡æŽ¥æ”¶ç«¯æ˜¯å¦æˆåŠŸã€‚ Reliable æ¨¡å¼ ä¸ºä¿è¯é€šä¿¡å¯é ï¼Œå°†å€ŸåŠ©äºŽæ¶ˆæ¯ä¸­å¿ƒæ¥å®žçŽ°æ¶ˆæ¯çš„å¯é é€è¾¾ï¼Œè¯·æ±‚å°†åšæŒä¹…åŒ–å­˜å‚¨ï¼Œåœ¨æŽ¥æ”¶æ–¹åœ¨çº¿æ—¶åšé€è¾¾ï¼Œå¹¶ç”±æ¶ˆæ¯ä¸­å¿ƒä¿è¯å¼‚å¸¸é‡è¯•ã€‚ èµ„æ–™ https://www.zhihu.com/question/22764869/answer/31277656]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
        <tag>distributed</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç½‘ç«™çš„ä¼¸ç¼©æ€§æž¶æž„]]></title>
    <url>%2Fblog%2F2018%2F07%2F05%2Fdesign%2Farchitecture%2F%E7%BD%91%E7%AB%99%E7%9A%84%E4%BC%B8%E7%BC%A9%E6%80%A7%E6%9E%B6%E6%9E%84%2F</url>
    <content type="text"><![CDATA[ç½‘ç«™çš„ä¼¸ç¼©æ€§æž¶æž„ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ 1. ç½‘ç«™æž¶æž„çš„ä¼¸ç¼©æ€§è®¾è®¡ 1.1. ä¸åŒåŠŸèƒ½è¿›è¡Œç‰©ç†åˆ†ç¦»å®žçŽ°ä¼¸ç¼© 1.2. å•ä¸€åŠŸèƒ½é€šè¿‡é›†ç¾¤è§„æ¨¡å®žçŽ°ä¼¸ç¼© 2. åº”ç”¨æœåŠ¡å™¨é›†ç¾¤çš„ä¼¸ç¼©æ€§è®¾è®¡ 2.1. HTTP é‡å®šå‘è´Ÿè½½å‡è¡¡ 2.2. DNS åŸŸåè§£æžè´Ÿè½½å‡è¡¡ 2.3. åå‘ä»£ç†è´Ÿè½½å‡è¡¡ 2.4. IP è´Ÿè½½å‡è¡¡ 2.5. æ•°æ®é“¾è·¯å±‚è´Ÿè½½å‡è¡¡ 2.6. è´Ÿè½½å‡è¡¡ç®—æ³• 3. åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤çš„ä¼¸ç¼©æ€§è®¾è®¡ 4. æ•°æ®å­˜å‚¨æœåŠ¡å™¨é›†ç¾¤çš„ä¼¸ç¼©æ€§è®¾è®¡ 4.1. å…³ç³»åž‹æ•°æ®åº“çš„ä¼¸ç¼©æ€§è®¾è®¡ 4.2. NoSql æ•°æ®åº“çš„ä¼¸ç¼©æ€§è®¾è®¡ 5. èµ„æ–™ 1. ç½‘ç«™æž¶æž„çš„ä¼¸ç¼©æ€§è®¾è®¡ 1.1. ä¸åŒåŠŸèƒ½è¿›è¡Œç‰©ç†åˆ†ç¦»å®žçŽ°ä¼¸ç¼© çºµå‘åˆ†ç¦»ï¼ˆåˆ†å±‚åŽåˆ†ç¦»ï¼‰ï¼šå°†ä¸šåŠ¡å¤„ç†æµç¨‹ä¸Šçš„ä¸åŒéƒ¨åˆ†åˆ†ç¦»éƒ¨ç½²ï¼Œå®žçŽ°ç³»ç»Ÿä¼¸ç¼©æ€§ã€‚ æ¨ªå‘åˆ†ç¦»ï¼ˆä¸šåŠ¡åˆ†å‰²åŽåˆ†ç¦»ï¼‰ï¼šå°†ä¸åŒçš„ä¸šåŠ¡æ¨¡å—åˆ†ç¦»éƒ¨ç½²ï¼Œå®žçŽ°ç³»ç»Ÿä¼¸ç¼©æ€§ã€‚ 1.2. å•ä¸€åŠŸèƒ½é€šè¿‡é›†ç¾¤è§„æ¨¡å®žçŽ°ä¼¸ç¼© å°†ä¸åŒåŠŸèƒ½åˆ†ç¦»éƒ¨ç½²å¯ä»¥å®žçŽ°ä¸€å®šç¨‹åº¦çš„ä¼¸ç¼©æ€§ï¼Œä½†æ˜¯éšç€ç½‘ç«™çš„è®¿é—®é‡é€æ­¥å¢žåŠ ï¼Œå³ä½¿åˆ†ç¦»åˆ°æœ€å°ç²’åº¦çš„ç‹¬ç«‹éƒ¨ç½²ï¼Œå•ä¸€çš„æœåŠ¡å™¨ä¹Ÿä¸èƒ½æ»¡è¶³ä¸šåŠ¡è§„æ¨¡çš„è¦æ±‚ã€‚å› æ­¤å¿…é¡»ä½¿ç”¨æœåŠ¡å™¨é›†ç¾¤ï¼Œå³å°†ç›¸åŒæœåŠ¡éƒ¨ç½²åœ¨å¤šæ€æœåŠ¡å™¨ä¸Šæž„æˆä¸€ä¸ªé›†ç¾¤æ•´ä½“å¯¹å¤–æä¾›æœåŠ¡ã€‚ 2. åº”ç”¨æœåŠ¡å™¨é›†ç¾¤çš„ä¼¸ç¼©æ€§è®¾è®¡ 2.1. HTTP é‡å®šå‘è´Ÿè½½å‡è¡¡ åˆ©ç”¨ HTTP é‡å®šå‘åè®®å®žçŽ°è´Ÿè½½å‡è¡¡ã€‚ è¿™ç§è´Ÿè½½å‡è¡¡æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯æ¯”è¾ƒç®€å•ã€‚ç¼ºç‚¹æ˜¯æµè§ˆå™¨éœ€è¦ä¸¤æ¬¡è¯·æ±‚æœåŠ¡å™¨æ‰èƒ½å®Œæˆä¸€æ¬¡è®¿é—®ï¼Œæ€§èƒ½è¾ƒå·®ï¼šé‡å®šå‘æœåŠ¡å™¨è‡ªèº«çš„å¤„ç†èƒ½åŠ›æœ‰å¯èƒ½æˆä¸ºç“¶é¢ˆï¼Œæ•´ä¸ªé›†ç¾¤çš„ä¼¸ç¼©æ€§è§„æ¨¡æœ‰é™ï¼›ä½¿ç”¨ HTTP 302 å“åº”ç é‡å®šå‘ï¼Œå¯èƒ½ä½¿æœç´¢å¼•æ“Žåˆ¤æ–­ä¸º SEO ä½œå¼Šï¼Œé™ä½Žæœç´¢æŽ’åã€‚ 2.2. DNS åŸŸåè§£æžè´Ÿè½½å‡è¡¡ åˆ©ç”¨ DNS å¤„ç†åŸŸåè§£æžè¯·æ±‚çš„åŒæ—¶è¿›è¡Œè´Ÿè½½å‡è¡¡å¤„ç†çš„ä¸€ç§æ–¹æ¡ˆã€‚ åœ¨ DNS æœåŠ¡å™¨ä¸­é…ç½®å¤šä¸ª A è®°å½•ï¼Œå¦‚ï¼š 114.100.40.1 www.mysite.com114.100.40.2 www.mysite.com114.100.40.3 www.mysite.com æ¯æ¬¡åŸŸåè§£æžè¯·æ±‚éƒ½ä¼šæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•è®¡ç®—ä¸€ä¸ªä¸åŒçš„ IP åœ°å€è¿”å›žï¼Œè¿™æ · A è®°å½•ä¸­é…ç½®çš„å¤šä¸ªæœåŠ¡å™¨å°±æž„æˆä¸€ä¸ªé›†ç¾¤ï¼Œå¹¶å¯ä»¥å®žçŽ°è´Ÿè½½å‡è¡¡ã€‚ DNS åŸŸåè§£æžè´Ÿè½½å‡è¡¡çš„ä¼˜ç‚¹ï¼š å°†è´Ÿè½½å‡è¡¡çš„å·¥ä½œè½¬äº¤ç»™äº† DNSï¼ŒçœæŽ‰äº†ç½‘ç«™ç®¡ç†ç»´æŠ¤çš„éº»çƒ¦ã€‚ åŒæ—¶ï¼Œè®¸å¤š DNS æœåŠ¡å™¨è¿˜æ”¯æŒåŸºäºŽåœ°ç†ä½ç½®çš„åŸŸåè§£æžï¼Œå³å°†åŸŸåè§£æžæˆè·ç¦»ç”¨æˆ·åœ°ç†æœ€è¿‘çš„ä¸€ä¸ªæœåŠ¡å™¨åœ°å€ï¼Œè¿™æ ·å¯ä»¥åŠ å¿«ç”¨æˆ·è®¿é—®é€Ÿåº¦ï¼Œæ”¹å–„æ€§èƒ½ã€‚ DNS åŸŸåè§£æžè´Ÿè½½å‡è¡¡çš„ç¼ºç‚¹ï¼š DNS æ˜¯å¤šçº§è§£æžï¼Œæ¯ä¸€çº§ DNS éƒ½å¯èƒ½ç¼“å­˜ A è®°å½•ï¼Œå½“æŸå°æœåŠ¡å™¨ä¸‹çº¿åŽï¼Œå³ä½¿ä¿®æ”¹äº† DNS çš„ A è®°å½•ï¼Œè¦ä½¿å…¶ç”Ÿæ•ˆä¹Ÿéœ€è¦è¾ƒé•¿æ—¶é—´ã€‚è¿™æ®µæ—¶é—´ï¼Œä¾ç„¶ä¼šåŸŸåè§£æžåˆ°å·²ç»ä¸‹çº¿çš„æœåŠ¡å™¨ï¼Œå¯¼è‡´ç”¨æˆ·è®¿é—®å¤±è´¥ã€‚ DNS çš„è´Ÿè½½å‡è¡¡çš„æŽ§åˆ¶æƒåœ¨åŸŸåæœåŠ¡å•†é‚£é‡Œï¼Œç½‘ç«™æ— æ³•å¯¹å…¶åšæ›´å¤šæ”¹å–„å’Œæ›´å¼ºå¤§çš„ç®¡ç†ã€‚ 2.3. åå‘ä»£ç†è´Ÿè½½å‡è¡¡ å¤§å¤šæ•°åå‘ä»£ç†æœåŠ¡å™¨åŒæ—¶æä¾›åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ã€‚ åå‘ä»£ç†æœåŠ¡å™¨çš„ä¼˜ç‚¹æ˜¯éƒ¨ç½²ç®€å•ã€‚ç¼ºç‚¹æ˜¯åå‘ä»£ç†æœåŠ¡å™¨æ—¶æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„ä¸­è½¬ç«™ï¼Œå…¶æ€§èƒ½å¯èƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚ 2.4. IP è´Ÿè½½å‡è¡¡ åœ¨ç½‘ç»œå±‚é€šè¿‡ä¿®æ”¹è¯·æ±‚ç›®æ ‡åœ°å€è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼ˆç½‘å…³æœåŠ¡å™¨ï¼‰åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸èŽ·å–ç½‘ç»œæ•°æ®åŒ…ï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•è®¡ç®—å¾—åˆ°ä¸€å°çœŸå®ž Web æœåŠ¡å™¨ 10.0.0.1ï¼Œç„¶åŽå°†ç›®çš„ IP åœ°å€ä¿®æ”¹ä¸º 10.0.0.1ï¼Œä¸éœ€è¦é€šè¿‡ç”¨æˆ·è¿›ç¨‹ã€‚çœŸå®ž Web æœåŠ¡å™¨å¤„ç†å®ŒæˆåŽï¼Œå“åº”æ•°æ®åŒ…å›žåˆ°è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨å†å°†æ•°æ®åŒ…åŽŸåœ°å€ä¿®æ”¹ä¸ºè‡ªèº«çš„ IP åœ°å€ï¼ˆ114.100.80.10ï¼‰å‘é€ç»™æµè§ˆå™¨ã€‚ IP è´Ÿè½½å‡è¡¡åœ¨å†…æ ¸å®Œæˆæ•°æ®åˆ†å‘ï¼Œæ‰€ä»¥å¤„ç†æ€§èƒ½ä¼˜äºŽåå‘ä»£ç†è´Ÿè½½å‡è¡¡ã€‚ä½†æ˜¯å› ä¸ºæ‰€æœ‰è¯·æ±‚å“åº”éƒ½è¦ç»è¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œé›†ç¾¤çš„æœ€å¤§å“åº”æ•°æ®åžåé‡å—åˆ¶äºŽè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ç½‘å¡å¸¦å®½ã€‚ 2.5. æ•°æ®é“¾è·¯å±‚è´Ÿè½½å‡è¡¡ æ•°æ®é“¾è·¯å±‚è´Ÿè½½å‡è¡¡æ˜¯æŒ‡åœ¨é€šä¿¡åè®®çš„æ•°æ®é“¾è·¯å±‚ä¿®æ”¹ mac åœ°å€è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ è¿™ç§æ–¹å¼åˆç§°ä½œä¸‰è§’ä¼ è¾“æ–¹å¼ï¼Œè´Ÿè½½å‡è¡¡æ•°æ®åˆ†å‘è¿‡ç¨‹ä¸­ä¸ä¿®æ”¹ IP åœ°å€ï¼Œåªä¿®æ”¹ç›®çš„ mac åœ°å€ï¼Œé€šè¿‡é…ç½®çœŸå®žç‰©ç†æœåŠ¡å™¨é›†ç¾¤æ‰€æœ‰æœºå™¨è™šæ‹Ÿ IP å’Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ IP åœ°å€ä¸€è‡´ï¼Œä»Žè€Œè¾¾åˆ°ä¸ä¿®æ”¹æ•°æ®åŒ…çš„æºåœ°å€å’Œç›®çš„åœ°å€å°±å¯ä»¥è¿›è¡Œæ•°æ®åˆ†å‘çš„ç›®çš„ï¼Œç”±äºŽå®žé™…å¤„ç†è¯·æ±‚çš„çœŸå®žç‰©ç†æœåŠ¡å™¨ IP å’Œæ•°æ®è¯·æ±‚ç›®çš„ IP ä¸€è‡´ï¼Œä¸éœ€è¦é€šè¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è¿›è¡Œåœ°å€è½¬æ¢ï¼Œå¯å°†å“åº”æ•°æ®åŒ…ç›´æŽ¥è¿”å›žç»™ç”¨æˆ·æµè§ˆå™¨ï¼Œé¿å…è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ç½‘å¡å¸¦å®½æˆä¸ºç“¶é¢ˆã€‚è¿™ç§è´Ÿè½½æ–¹å¼åˆç§°ä½œç›´æŽ¥è·¯ç”±æ–¹å¼ã€‚ åœ¨ Linux å¹³å°ä¸Šæœ€å¥½çš„é“¾è·¯å±‚è´Ÿè½½å‡è¡¡å¼€æºäº§å“æ˜¯ LVS(Linux Virtual Server)ã€‚ 2.6. è´Ÿè½½å‡è¡¡ç®—æ³• è´Ÿè½½å‡è¡¡æœåŠ¡å™¨çš„å®žçŽ°å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•å’Œ Web æœåŠ¡å™¨åˆ—è¡¨è®¡ç®—å¾—åˆ°é›†ç¾¤ä¸­ä¸€å° Web æœåŠ¡å™¨çš„åœ°å€ã€‚ å°†è¯·æ±‚æ•°æ®å‘é€åˆ°è¯¥åœ°å€å¯¹åº”çš„ Web æœåŠ¡å™¨ä¸Šã€‚ è´Ÿè½½å‡è¡¡ç®—æ³•é€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§ï¼š è½®è¯¢ï¼ˆRound Robinï¼‰ - æ‰€æœ‰è¯·æ±‚è¢«ä¾æ¬¡åˆ†å‘åˆ°æ¯å°åº”ç”¨æœåŠ¡å™¨ä¸Šï¼Œå³æ¯å°æœåŠ¡å™¨éœ€è¦å¤„ç†çš„è¯·æ±‚æ•°æ®éƒ½ç›¸åŒï¼Œé€‚åˆäºŽæ‰€æœ‰æœåŠ¡å™¨ç¡¬ä»¶éƒ½ç›¸åŒçš„åœºæ™¯ã€‚ åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robinï¼‰ - æ ¹æ®æœåŠ¡å™¨ç¡¬ä»¶æ€§èƒ½æƒ…å†µï¼Œåœ¨è½®è¯¢çš„åŸºç¡€ä¸Šï¼ŒæŒ‰ç…§é…ç½®æƒé‡å°†è¯·æ±‚åˆ†å‘åˆ°æ¯ä¸ªæœåŠ¡å™¨ï¼Œé«˜æ€§èƒ½æœåŠ¡å™¨èƒ½åˆ†é…æ›´å¤šè¯·æ±‚ã€‚ éšæœºï¼ˆRandomï¼‰ - è¯·æ±‚è¢«éšæœºåˆ†é…åˆ°å„ä¸ªåº”ç”¨æœåŠ¡å™¨ï¼Œåœ¨è®¸å¤šåœºåˆä¸‹ï¼Œè¿™ç§æ–¹æ¡ˆéƒ½å¾ˆç®€å•å®žç”¨ï¼Œå› ä¸ºå¥½çš„éšæœºæ•°æœ¬èº«å°±å¾ˆå¹³å‡ï¼Œå³ä½¿åº”ç”¨æœåŠ¡å™¨ç¡¬ä»¶é…ç½®ä¸åŒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŠ æƒéšæœºç®—æ³•ã€‚ æœ€å°‘è¿žæŽ¥ï¼ˆLeast Connectionï¼‰ - è®°å½•æ¯ä¸ªåº”ç”¨æœåŠ¡å™¨æ­£åœ¨å¤„ç†çš„è¿žæŽ¥æ•°ï¼Œå°†æ–°åˆ°çš„è¯·æ±‚åˆ†å‘åˆ°æœ€å°‘è¿žæŽ¥çš„æœåŠ¡å™¨ä¸Šï¼Œåº”è¯¥è¯´ï¼Œè¿™æ˜¯æœ€ç¬¦åˆè´Ÿè½½å‡è¡¡å®šä¹‰çš„ç®—æ³•ã€‚ æºåœ°å€ Hashï¼ˆSource Hashï¼‰ - æ ¹æ®è¯·æ±‚æ¥æºçš„ IP åœ°å€è¿›è¡Œ Hash è®¡ç®—ï¼Œå¾—åˆ°åº”ç”¨æœåŠ¡å™¨ï¼Œè¿™æ ·æ¥è‡ªåŒä¸€ä¸ª IP åœ°å€çš„è¯·æ±‚æ€»åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šå¤„ç†ï¼Œè¯¥è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯å¯ä»¥å­˜å‚¨åœ¨è¿™å°æœåŠ¡å™¨ä¸Šï¼Œåœ¨ä¸€ä¸ªä¼šè¯å‘¨æœŸå†…é‡å¤ä½¿ç”¨ï¼Œä»Žè€Œå®žçŽ°ä¼šè¯ç²˜æ»žã€‚ 3. åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤çš„ä¼¸ç¼©æ€§è®¾è®¡ ä¸€è‡´æ€§ HASH ç®—æ³• 4. æ•°æ®å­˜å‚¨æœåŠ¡å™¨é›†ç¾¤çš„ä¼¸ç¼©æ€§è®¾è®¡ 4.1. å…³ç³»åž‹æ•°æ®åº“çš„ä¼¸ç¼©æ€§è®¾è®¡ ä¸»ä»Žå¤åˆ¶ - ä¸»æµå…³ç³»åž‹æ•°æ®åº“ä¸€èˆ¬éƒ½æ”¯æŒä¸»ä»Žå¤åˆ¶ã€‚ åˆ†åº“ - æ ¹æ®ä¸šåŠ¡å¯¹æ•°æ®åº“è¿›è¡Œåˆ†å‰²ã€‚åˆ¶çº¦æ¡ä»¶æ˜¯è·¨åº“çš„è¡¨ä¸èƒ½è¿›è¡Œ Join æ“ä½œã€‚ åˆ†è¡¨ - ä½¿ç”¨æ•°æ®åº“åˆ†ç‰‡ä¸­é—´ä»¶ï¼Œå¦‚ Cobar ç­‰ã€‚ 4.2. NoSql æ•°æ®åº“çš„ä¼¸ç¼©æ€§è®¾è®¡ ä¸€èˆ¬è€Œè¨€ï¼ŒNosql ä¸æ”¯æŒ SQL å’Œ ACIDï¼Œä½†æ˜¯å¼ºåŒ–äº†å¯¹äºŽé«˜å¯ç”¨å’Œä¼¸ç¼©æ€§çš„æ”¯æŒã€‚ 5. èµ„æ–™ å¤§åž‹ç½‘ç«™æŠ€æœ¯æž¶æž„]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç½‘ç«™çš„é«˜å¯ç”¨æž¶æž„]]></title>
    <url>%2Fblog%2F2018%2F07%2F05%2Fdesign%2Farchitecture%2F%E7%BD%91%E7%AB%99%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84%2F</url>
    <content type="text"><![CDATA[ç½‘ç«™çš„é«˜å¯ç”¨æž¶æž„ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ 1. ç½‘ç«™å¯ç”¨æ€§çš„åº¦é‡ 2. é«˜å¯ç”¨çš„ç½‘ç«™æž¶æž„ 3. é«˜å¯ç”¨çš„åº”ç”¨ 3.1. é€šè¿‡è´Ÿè½½å‡è¡¡è¿›è¡Œæ— çŠ¶æ€æœåŠ¡çš„å¤±æ•ˆè½¬ç§» 3.2. åº”ç”¨æœåŠ¡å™¨é›†ç¾¤çš„ Session ç®¡ç† 4. é«˜å¯ç”¨çš„æœåŠ¡ 5. é«˜å¯ç”¨çš„æ•°æ® 5.1. CAP åŽŸç† 5.2. æ•°æ®å¤‡ä»½ 5.3. å¤±æ•ˆè½¬ç§» 6. é«˜å¯ç”¨ç½‘ç«™çš„è½¯ä»¶è´¨é‡ä¿è¯ 7. ç½‘ç«™ç›‘æŽ§ 8. èµ„æ–™ 1. ç½‘ç«™å¯ç”¨æ€§çš„åº¦é‡ ç½‘ç«™ä¸å¯ç”¨ä¹Ÿè¢«ç§°ä½œç½‘ç«™æ•…éšœï¼Œä¸šç•Œé€šå¸¸ç”¨å¤šä¸ª 9 æ¥è¡¡é‡ç½‘ç«™çš„å¯ç”¨æ€§ã€‚å¦‚ QQ çš„å¯ç”¨æ€§ä¸º 4 ä¸ª 9ï¼Œå³ 99.99% å¯ç”¨ã€‚ ç½‘ç«™ä¸å¯ç”¨æ—¶é—´ = æ•…éšœä¿®å¤æ—¶é—´ç‚¹ - æ•…éšœå‘çŽ°æ—¶é—´ç‚¹ç½‘ç«™å¹´åº¦å¯ç”¨æ€§æŒ‡æ ‡ = (1 - ç½‘ç«™ä¸å¯ç”¨æ—¶é—´/å¹´åº¦æ€»æ—¶é—´) * 100% 2. é«˜å¯ç”¨çš„ç½‘ç«™æž¶æž„ å¤§åž‹ç½‘ç«™çš„åˆ†å±‚æž¶æž„åŠæœåŠ¡å™¨çš„åˆ†å¸ƒå¼éƒ¨ç½²ä½¿å¾—ä½äºŽä¸åŒå±‚æ¬¡çš„æœåŠ¡å™¨å…·æœ‰ä¸åŒçš„å¯ç”¨æ€§ç‰¹ç‚¹ã€‚å…³é—­æœåŠ¡æˆ–æœåŠ¡å™¨å®•æœºæ—¶äº§ç”Ÿçš„å½±å“ä¹Ÿä¸ç›¸åŒï¼Œé«˜å¯ç”¨çš„è§£å†³æ–¹æ¡ˆä¹Ÿå·®å¼‚ç”šå¤§ã€‚ 3. é«˜å¯ç”¨çš„åº”ç”¨ 3.1. é€šè¿‡è´Ÿè½½å‡è¡¡è¿›è¡Œæ— çŠ¶æ€æœåŠ¡çš„å¤±æ•ˆè½¬ç§» åº”ç”¨å±‚ä¸»è¦å¤„ç†ç½‘ç«™åº”ç”¨çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¸€ä¸ªæ˜¾è‘—çš„ç‰¹ç‚¹æ˜¯åº”ç”¨çš„ æ— çŠ¶æ€ æ€§ã€‚ æ‰€è°“çš„ æ— çŠ¶æ€ çš„åº”ç”¨æ˜¯æŒ‡åº”ç”¨æœåŠ¡å™¨ä¸ä¿å­˜ä¸šåŠ¡çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè€Œä»…æ ¹æ®æ¯æ¬¡è¯·æ±‚æäº¤çš„æ•°æ®è¿›è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œå¤šä¸ªæœåŠ¡å®žä¾‹ä¹‹é—´å®Œå…¨å¯¹ç­‰ï¼Œè¯·æ±‚æäº¤åˆ°ä»»æ„æœåŠ¡å™¨ï¼Œå¤„ç†ç»“æžœéƒ½æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ è´Ÿè½½å‡è¡¡ï¼Œé¡¾åæ€ä¹‰ï¼Œä¸»è¦ä½¿ç”¨åœ¨ä¸šåŠ¡é‡å’Œæ•°æ®é‡è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œå½“å•å°æœåŠ¡å™¨ä¸è¶³ä»¥æ‰¿æ‹…æ‰€æœ‰çš„è´Ÿè½½åŽ‹åŠ›æ—¶ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡æ‰‹æ®µï¼Œå°†æµé‡å’Œæ•°æ®åˆ†æ‘Šåˆ°ä¸€ä¸ªé›†ç¾¤ç»„æˆçš„å¤šå°æœåŠ¡å™¨ä¸Šï¼Œä»¥æé«˜æ•´ä½“çš„è´Ÿè½½å¤„ç†èƒ½åŠ›ã€‚ 3.2. åº”ç”¨æœåŠ¡å™¨é›†ç¾¤çš„ Session ç®¡ç† åº”ç”¨æœåŠ¡å™¨çš„é«˜å¯ç”¨æž¶æž„è®¾è®¡ä¸»è¦åŸºäºŽæœåŠ¡æ— çŠ¶æ€è¿™ä¸€ç‰¹æ€§ã€‚äº‹å®žä¸Šï¼Œä¸šåŠ¡æ€»æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå¦‚è´­ç‰©è½¦è®°å½•ç”¨æˆ·çš„è´­ä¹°ä¿¡æ¯ï¼›ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼›æœ€æ–°å‘å¸ƒçš„æ¶ˆæ¯ç­‰ç­‰ã€‚ Web åº”ç”¨ä¸­å°†è¿™äº›å¤šæ¬¡è¯·æ±‚ä¿®æ”¹ä½¿ç”¨çš„ä¸Šä¸‹æ–‡å¯¹è±¡ç§°ä½œä¼šè¯ã€‚å•æœºæƒ…å†µä¸‹ï¼ŒSession å¯ç”±éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šçš„ Web å®¹å™¨ç®¡ç†ã€‚ è€Œåœ¨é›†ç¾¤çŽ¯å¢ƒä¸‹ï¼ŒSession ç®¡ç†æœ‰ä»¥ä¸‹æ‰‹æ®µï¼š Session å¤åˆ¶ Session å¤åˆ¶æ˜¯æŒ‡åº”ç”¨æœåŠ¡å™¨å¼€å‘ Web å®¹å™¨çš„ Session å¤åˆ¶åŠŸèƒ½ï¼Œåœ¨é›†ç¾¤ä¸­çš„å‡ å°æœåŠ¡å™¨ä¹‹é—´åŒæ­¥ Session å¯¹è±¡ã€‚ è¿™ç§æ–¹æ¡ˆå¾ˆç®€å•ï¼Œä½†å½“é›†ç¾¤è§„æ¨¡è¾ƒå¤§æ—¶ï¼Œé›†ç¾¤æœåŠ¡é—´éœ€è¦å¤§é‡çš„é€šä¿¡æ¥è¿›è¡Œ Session å¤åˆ¶ã€‚ Session ç»‘å®š å¯ä»¥åˆ©ç”¨è´Ÿè½½å‡è¡¡çš„æºåœ°å€ Hash ç®—æ³•å®žçŽ°ï¼Œæ€»æ˜¯å°†æ¥æºäºŽåŒä¸€ IP çš„è¯·æ±‚åˆ†å‘åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šã€‚è¿™æ ·åœ¨æ•´ä¸ªä¼šè¯æœŸé—´ï¼Œç”¨æˆ·æ‰€æœ‰çš„è¯·æ±‚éƒ½åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå¤„ç†ï¼Œå³ Session ç»‘å®šåˆ°æŸå°ç‰¹å®šæœåŠ¡å™¨ä¸Šã€‚è¿™ç§æ–¹æ³•åˆè¢«ç§°ä½œä¼šè¯ç²˜æ»žã€‚ ä½†æ˜¯è¿™ç§ç­–ç•¥ä¸ç¬¦åˆé«˜å¯ç”¨çš„éœ€æ±‚ï¼Œå› ä¸ºä¸€æ—¦æŸå°æœåŠ¡å™¨å®•æœºï¼Œé‚£ä¹ˆè¯¥æœºå™¨ä¸Šçš„ Session ä¹Ÿå°±ä¸å¤å­˜åœ¨äº†ã€‚ åˆ©ç”¨ Cookie è®°å½• Session å¯ä»¥å°† Session è®°å½•åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ Cookieï¼‰ï¼Œæ¯æ¬¡è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼Œå°† Session æ”¾åœ¨è¯·æ±‚ä¸­å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¤„ç†å®Œè¯·æ±‚åŽå†å°†ä¿®æ”¹è¿‡çš„ Session å“åº”ç»™å®¢æˆ·ç«¯ã€‚ è¿™ç§ç­–ç•¥çš„ç¼ºç‚¹æ˜¯ï¼šCookie æœ‰å¤§å°é™åˆ¶ï¼Œèƒ½è®°å½•çš„ä¿¡æ¯æœ‰é™ï¼›æ¯æ¬¡è¯·æ±‚å“åº”éƒ½éœ€è¦ä¼ è¾“ Cookieï¼Œå½±å“æ€§èƒ½ï¼›å¦‚æžœç”¨æˆ·å…³é—­ Cookieï¼Œè®¿é—®å°±ä¸èƒ½å·¥ä½œã€‚ Session æœåŠ¡å™¨ åˆ©ç”¨ç‹¬ç«‹éƒ¨ç½²çš„ Session æœåŠ¡å™¨ï¼ˆé›†ç¾¤ï¼‰ç»Ÿä¸€ç®¡ç† Sessionï¼Œåº”ç”¨æœåŠ¡å™¨æ¯æ¬¡è¯»å†™ Session æ—¶ï¼Œéƒ½è®¿é—® Session æœåŠ¡å™¨ã€‚ å®žçŽ° Session æœåŠ¡å™¨çš„ä¸€ç§ç®€å•æ–¹æ³•æ—¶ï¼šåˆ©ç”¨åˆ†å¸ƒå¼ç¼“å­˜ã€æ•°æ®åº“ç­‰ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡ŒåŒ…è£…ï¼Œä½¿å…¶ç¬¦åˆ Session çš„å­˜å‚¨å’Œè®¿é—®è¦æ±‚ã€‚ 4. é«˜å¯ç”¨çš„æœåŠ¡ é«˜å¯ç”¨çš„æœåŠ¡ç­–ç•¥ï¼š åˆ†çº§ç®¡ç† - å°†æœåŠ¡æ ¹æ®ä¸šåŠ¡é‡è¦æ€§è¿›è¡Œåˆ†çº§ç®¡ç†ï¼Œå¹¶åœ¨æœåŠ¡éƒ¨ç½²ä¸Šè¿›è¡Œéš”ç¦»ã€‚ è¶…æ—¶è®¾ç½® - ç”±äºŽæœåŠ¡å™¨å®•æœºã€çº¿ç¨‹æ­»é”ç­‰åŽŸå› ï¼Œå¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºå¯¹æœåŠ¡ç«¯çš„è°ƒç”¨å¤±åŽ»å“åº”ã€‚æ‰€ä»¥æœ‰å¿…è¦å¼•å…¥è¶…æ—¶æœºåˆ¶ï¼Œä¸€æ—¦è°ƒç”¨è¶…æ—¶ï¼ŒæœåŠ¡åŒ–æ¡†æž¶æŠ›å‡ºå¼‚å¸¸ï¼Œåº”ç”¨ç¨‹åºæ ¹æ®æœåŠ¡è°ƒåº¦ç­–ç•¥ï¼Œé€‰æ‹©é‡è¯•æˆ–è¯·æ±‚è½¬ç§»åˆ°å…¶ä»–æœºå™¨ä¸Šã€‚ å¼‚æ­¥è°ƒç”¨ - å¯¹äºŽéœ€è¦å³æ—¶å“åº”çš„ä¸šåŠ¡ï¼Œåº”ç”¨åœ¨è°ƒç”¨æœåŠ¡æ—¶å¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ç­‰å¼‚æ­¥æ–¹å¼å®Œæˆï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…æœåŠ¡å“åº”ç»“æžœã€‚ æœåŠ¡é™çº§ - ç½‘ç«™è®¿é—®é«˜å³°æœŸï¼ŒæœåŠ¡å¯èƒ½å› ä¸ºå¤§é‡å¹¶å‘è°ƒç”¨è€Œæ€§èƒ½ä¸‹é™ï¼Œä¸¥é‡æ—¶å¯èƒ½ä¼šå¯¼è‡´å®•æœºã€‚ä¸ºäº†ä¿è¯æ ¸å¿ƒåŠŸèƒ½çš„æ­£å¸¸è¿è¡Œï¼Œéœ€è¦å¯¹æœåŠ¡è¿›è¡Œé™çº§ã€‚é™çº§æœ‰ä¸¤ç§æ‰‹æ®µï¼šæ‹’ç»æœåŠ¡å’Œå…³é—­æœåŠ¡ã€‚ å¹‚ç­‰æ€§è®¾è®¡ - ä¸ºäº†é¿å…æœåŠ¡é‡å¤è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç¼–å·çš„æ–¹å¼è¿›è¡ŒæœåŠ¡è°ƒç”¨æœ‰æ•ˆæ€§æ ¡éªŒï¼Œæœ‰æ•ˆçš„æ“ä½œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ 5. é«˜å¯ç”¨çš„æ•°æ® 5.1. CAP åŽŸç† åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆCï¼šConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAï¼šAvailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼šPartition Toleranceï¼‰ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ã€‚ å¯ç”¨æ€§ å¯ç”¨æ€§æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡çš„èƒ½åŠ›ï¼Œå¯ä»¥ç”¨ç³»ç»Ÿå¯ç”¨æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼æ¥è¡¡é‡ï¼Œ4 ä¸ª 9 çš„å¯ç”¨æ€§è¡¨ç¤ºç³»ç»Ÿ 99.99% çš„æ—¶é—´æ˜¯å¯ç”¨çš„ã€‚ åœ¨å¯ç”¨æ€§æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿæä¾›çš„æœåŠ¡ä¸€ç›´å¤„äºŽå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºŽç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›žç»“æžœã€‚ åˆ†åŒºå®¹å¿æ€§ ç½‘ç»œåˆ†åŒºæŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹è¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå†…éƒ¨å¯ä»¥é€šä¿¡ï¼Œä½†æ˜¯åŒºåŸŸä¹‹é—´æ— æ³•é€šä¿¡ã€‚ åœ¨åˆ†åŒºå®¹å¿æ€§æ¡ä»¶ä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦èƒ½å¯¹å¤–æä¾›ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éžæ˜¯æ•´ä¸ªç½‘ç»œçŽ¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚ ä¸€è‡´æ€§ ä¸€è‡´æ€§æŒ‡çš„æ˜¯å¤šä¸ªæ•°æ®å‰¯æœ¬æ˜¯å¦èƒ½ä¿æŒä¸€è‡´çš„ç‰¹æ€§ã€‚ åœ¨ä¸€è‡´æ€§çš„æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿåœ¨æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œä¹‹åŽèƒ½å¤Ÿä»Žä¸€è‡´æ€§çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ æ•°æ®ä¸€è‡´æ€§åˆå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š å¼ºä¸€è‡´æ€§ - æ•°æ®æ›´æ–°æ“ä½œç»“æžœå’Œæ“ä½œå“åº”æ€»æ˜¯ä¸€è‡´çš„ï¼Œå³æ“ä½œå“åº”é€šçŸ¥æ›´æ–°å¤±è´¥ï¼Œé‚£ä¹ˆæ•°æ®ä¸€å®šæ²¡æœ‰è¢«æ›´æ–°ï¼Œè€Œä¸æ˜¯å¤„äºŽä¸ç¡®å®šçŠ¶æ€ã€‚ æœ€ç»ˆä¸€è‡´æ€§ - å³ç‰©ç†å­˜å‚¨çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼Œç»ˆç«¯ç”¨æˆ·è®¿é—®åˆ°çš„æ•°æ®å¯èƒ½ä¹Ÿæ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†ç³»ç»Ÿç»è¿‡ä¸€æ®µæ—¶é—´çš„è‡ªæˆ‘ä¿®å¤å’Œä¿®æ­£ï¼Œæ•°æ®æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´ã€‚ æƒè¡¡ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºå®¹å¿æ€§å¿…ä¸å¯å°‘ï¼Œå› ä¸ºéœ€è¦æ€»æ˜¯å‡è®¾ç½‘ç»œæ˜¯ä¸å¯é çš„ã€‚å› æ­¤ï¼ŒCAP ç†è®ºå®žé™…åœ¨æ˜¯è¦åœ¨å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´åšæƒè¡¡ã€‚ å¯ç”¨æ€§å’Œä¸€è‡´æ€§å¾€å¾€æ˜¯å†²çªçš„ï¼Œå¾ˆéš¾éƒ½ä½¿å®ƒä»¬åŒæ—¶æ»¡è¶³ã€‚åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œ ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼ˆCPï¼‰ï¼Œå°±éœ€è¦è®©æ‰€æœ‰èŠ‚ç‚¹ä¸‹çº¿æˆä¸ºä¸å¯ç”¨çš„çŠ¶æ€ï¼Œç­‰å¾…åŒæ­¥å®Œæˆï¼› ä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼ˆAPï¼‰ï¼Œåœ¨åŒæ­¥è¿‡ç¨‹ä¸­å…è®¸è¯»å–æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å¯èƒ½ä¸ä¸€è‡´ã€‚ 5.2. æ•°æ®å¤‡ä»½ å†·å¤‡ä»½ï¼šå®šæœŸå°†æ•°æ®å¤åˆ¶åˆ°æŸç§å­˜å‚¨ä»‹è´¨ã€‚ çƒ­å¤‡ä»½ å¼‚æ­¥çƒ­å¤‡æ–¹å¼ - å¼‚æ­¥æ–¹å¼æ˜¯æŒ‡å¤šä»½æ•°æ®å‰¯æœ¬çš„å†™å…¥æ“ä½œå¼‚æ­¥å®Œæˆï¼Œåº”ç”¨ç¨‹åºæ”¶åˆ°æ•°æ®æœåŠ¡ç³»ç»Ÿçš„å†™æ“ä½œæˆåŠŸå“åº”æ—¶ï¼Œåªå†™æˆåŠŸäº†ä¸€ä»½ï¼Œå­˜å‚¨ç³»ç»Ÿå°†ä¼šå¼‚æ­¥åœ°å†™å…¶ä»–å‰¯æœ¬ã€‚ åŒæ­¥çƒ­å¤‡æ–¹å¼ - åŒæ­¥æ–¹å¼æ˜¯æŒ‡å¤šä»½æ•°æ®å‰¯æœ¬çš„å†™å…¥æ“ä½œåŒæ­¥å®Œæˆï¼Œå³åº”ç”¨ç¨‹åºæ”¶åˆ°æ•°æ®æœåŠ¡ç³»ç»Ÿçš„å†™æˆåŠŸå“åº”æ—¶ï¼Œå¤šä»½æ•°æ®éƒ½å·²ç»å†™æ“ä½œæˆåŠŸã€‚ä½†æ˜¯å½“åº”ç”¨ç¨‹åºæ”¶åˆ°æ•°æ®å†™æ“ä½œå¤±è´¥çš„å“åº”å¼ï¼Œå¯èƒ½æœ‰éƒ¨åˆ†å‰¯æœ¬æˆ–è€…å…¨éƒ¨å‰¯æœ¬éƒ½å·²ç»å†™å…¥æˆåŠŸäº†ï¼ˆå› ä¸ºç½‘ç»œæˆ–è€…ç³»ç»Ÿæ•…éšœï¼Œæ— æ³•è¿”å›žæ“ä½œæˆåŠŸçš„å“åº”ï¼‰ã€‚ 5.3. å¤±æ•ˆè½¬ç§» å¤±æ•ˆç¡®è®¤ åˆ¤æ–­æœåŠ¡å™¨å®•æœºçš„æ‰‹æ®µæœ‰ä¸¤ç§ï¼šå¿ƒè·³æ£€æµ‹å’Œè®¿é—®å¤±è´¥æŠ¥å‘Šã€‚ å¯¹äºŽåº”ç”¨ç¨‹åºçš„è®¿é—®å¤±è´¥æŠ¥å‘Šï¼ŒæŽ§åˆ¶ä¸­å¿ƒè¿˜éœ€è¦å†ä¸€æ¬¡å‘é€å¿ƒè·³æ£€æµ‹è¿›è¡Œç¡®è®¤ï¼Œä»¥å…é”™è¯¯åˆ¤æ–­æœåŠ¡å™¨å®•æœºã€‚å› ä¸ºä¸€æ—¦è¿›è¡Œæ•°æ®è®¿é—®çš„å¤±æ•ˆè½¬ç§»ï¼Œæ„å‘³ç€æ•°æ®å­˜å‚¨å¤šä»½å‰¯æœ¬ä¸ä¸€è‡´ï¼Œéœ€è¦è¿›è¡ŒåŽç»­ä¸€ç³»åˆ—çš„å¤æ‚åŠ¨ä½œã€‚ è®¿é—®è½¬ç§» ç¡®è®¤æŸå°æ•°æ®æœåŠ¡å™¨å®•æœºåŽï¼Œå°±éœ€è¦å°†æ•°æ®è¯»å†™è®¿é—®é‡æ–°è·¯ç”±åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šã€‚å¯¹äºŽå®Œå…¨å¯¹ç­‰å­˜å‚¨çš„æœåŠ¡å™¨ï¼Œå½“å…¶ä¸­ä¸€å°å®•æœºåŽï¼Œåº”ç”¨ç¨‹åºæ ¹æ®é…ç½®ç›´æŽ¥åˆ‡æ¢åˆ°å¯¹ç­‰æœåŠ¡å™¨ä¸Šã€‚å¦‚æžœå­˜å‚¨ä¸å¯¹ç­‰ï¼Œå°±éœ€è¦é‡æ–°è®¡ç®—è·¯ç”±ï¼Œé€‰æ‹©å­˜å‚¨æœåŠ¡å™¨ã€‚ æ•°æ®æ¢å¤ å› ä¸ºæŸå°æœåŠ¡å™¨å®•æœºï¼Œæ‰€ä»¥æ•°æ®å­˜å‚¨çš„å‰¯æœ¬æ•°ç›®ä¼šå‡å°‘ï¼Œå¿…é¡»å°†å‰¯æœ¬çš„æ•°ç›®æ¢å¤åˆ°ç³»ç»Ÿè®¾å®šçš„å€¼ï¼Œå¦åˆ™ï¼Œå†æœ‰æœåŠ¡å™¨å®•æœºæ—¶ï¼Œå°±å¯èƒ½å‡ºçŽ°æ— æ³•è®¿é—®è½¬ç§»ï¼Œæ•°æ®æ°¸ä¹…ä¸¢å¤±çš„æƒ…å†µã€‚å› æ­¤ç³»ç»Ÿéœ€è¦ä»Žå¥åº·çš„æœåŠ¡å™¨å¤åˆ¶æ•°æ®ï¼Œå°†æ•°æ®å‰¯æœ¬æ•°ç›®æ¢å¤åˆ°è®¾å®šå€¼ã€‚ 6. é«˜å¯ç”¨ç½‘ç«™çš„è½¯ä»¶è´¨é‡ä¿è¯ é«˜å¯ç”¨ç½‘ç«™çš„è½¯ä»¶è´¨é‡ä¿è¯çš„æ‰‹æ®µï¼š è‡ªåŠ¨åŒ–å‘å¸ƒ è‡ªåŠ¨åŒ–æµ‹è¯• é¢„å‘å¸ƒéªŒè¯ ä»£ç æŽ§åˆ¶ ç°åº¦å‘å¸ƒ 7. ç½‘ç«™ç›‘æŽ§ ç›‘æŽ§æ•°æ®é‡‡é›† ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ”¶é›† æœåŠ¡å™¨æ€§èƒ½ç›‘æŽ§ è¿è¡Œæ•°æ®æŠ¥å‘Š ç›‘æŽ§ç®¡ç† ç³»ç»ŸæŠ¥è­¦ å¤±æ•ˆè½¬ç§» è‡ªåŠ¨ä¼˜é›…é™çº§ 8. èµ„æ–™ å¤§åž‹ç½‘ç«™æŠ€æœ¯æž¶æž„]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç½‘ç«™çš„å®‰å…¨æž¶æž„]]></title>
    <url>%2Fblog%2F2018%2F07%2F05%2Fdesign%2Farchitecture%2F%E7%BD%91%E7%AB%99%E7%9A%84%E5%AE%89%E5%85%A8%E6%9E%B6%E6%9E%84%2F</url>
    <content type="text"><![CDATA[ç½‘ç«™çš„å®‰å…¨æž¶æž„ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ å…³é”®è¯ï¼šXSSã€CSRFã€SQL æ³¨å…¥ã€DoSã€æ¶ˆæ¯æ‘˜è¦ã€åŠ å¯†ç®—æ³•ã€è¯ä¹¦ 1. ç½‘ç«™å®‰å…¨çš„æ”»ä¸Žé˜² 1.1. è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ 1.2. è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰ 1.3. SQL æ³¨å…¥æ”»å‡» 1.4. æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDoSï¼‰ 2. åŠ å¯†æŠ€æœ¯åŠå¯†é’¥å®‰å…¨ç®¡ç† 2.1. æ¶ˆæ¯æ‘˜è¦ 2.2. åŠ å¯†ç®—æ³• 2.3. è¯ä¹¦ 3. èµ„æ–™ 1. ç½‘ç«™å®‰å…¨çš„æ”»ä¸Žé˜² äº’è”ç½‘çŽ¯å¢ƒé±¼é¾™æ··æ‚ï¼Œç½‘ç«™è¢«æ”»å‡»æ˜¯å¸¸è§çŽ°è±¡ï¼Œæ‰€ä»¥äº†è§£ä¸€äº›å¸¸è§çš„ç½‘ç«™æ”»å‡»æ‰‹æ®µååˆ†å¿…è¦ã€‚ä¸‹é¢åˆ—ä¸¾æ¯”è¾ƒå¸¸è§çš„ 4 ç§æ”»å‡»æ‰‹æ®µï¼š 1.1. è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ æ¦‚å¿µ è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross-Site Scripting, XSSï¼‰ï¼Œæ˜¯ä¸€ç§ç½‘ç«™åº”ç”¨ç¨‹åºçš„å®‰å…¨æ¼æ´žæ”»å‡»ï¼Œæ˜¯ä»£ç æ³¨å…¥çš„ä¸€ç§ã€‚å®ƒå…è®¸æ¶æ„ç”¨æˆ·å°†ä»£ç æ³¨å…¥åˆ°ç½‘é¡µä¸Šï¼Œå…¶ä»–ç”¨æˆ·åœ¨è§‚çœ‹ç½‘é¡µæ—¶å°±ä¼šå—åˆ°å½±å“ã€‚è¿™ç±»æ”»å‡»é€šå¸¸åŒ…å«äº† HTML ä»¥åŠç”¨æˆ·ç«¯è„šæœ¬è¯­è¨€ã€‚ XSS æ”»å‡»ç¤ºä¾‹ï¼š å‡å¦‚æœ‰ä¸‹é¢ä¸€ä¸ª textbox &lt;input type="text" name="address1" value="value1from"&gt; value1from æ˜¯æ¥è‡ªç”¨æˆ·çš„è¾“å…¥ï¼Œå¦‚æžœç”¨æˆ·ä¸æ˜¯è¾“å…¥ value1from,è€Œæ˜¯è¾“å…¥ &quot;/&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&lt;!- é‚£ä¹ˆå°±ä¼šå˜æˆï¼š &lt;input type="text" name="address1" value=""/&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&lt;!- "&gt; åµŒå…¥çš„ JavaScript ä»£ç å°†ä¼šè¢«æ‰§è¡Œã€‚æ”»å‡»çš„å¨åŠ›ï¼Œå–å†³äºŽç”¨æˆ·è¾“å…¥äº†ä»€ä¹ˆæ ·çš„è„šæœ¬ã€‚ æ”»å‡»æ‰‹æ®µå’Œç›®çš„ å¸¸ç”¨çš„ XSS æ”»å‡»æ‰‹æ®µå’Œç›®çš„æœ‰ï¼š ç›—ç”¨ cookieï¼ŒèŽ·å–æ•æ„Ÿä¿¡æ¯ã€‚ åˆ©ç”¨æ¤å…¥ Flashï¼Œé€šè¿‡ crossdomain æƒé™è®¾ç½®è¿›ä¸€æ­¥èŽ·å–æ›´é«˜æƒé™ï¼›æˆ–è€…åˆ©ç”¨ Java ç­‰å¾—åˆ°ç±»ä¼¼çš„æ“ä½œã€‚ åˆ©ç”¨ iframeã€frameã€XMLHttpRequest æˆ–ä¸Šè¿° Flash ç­‰æ–¹å¼ï¼Œä»¥ï¼ˆè¢«æ”»å‡»ï¼‰ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œä¸€äº›ç®¡ç†åŠ¨ä½œï¼Œæˆ–æ‰§è¡Œä¸€äº›ä¸€èˆ¬çš„å¦‚å‘å¾®åšã€åŠ å¥½å‹ã€å‘ç§ä¿¡ç­‰æ“ä½œã€‚ åˆ©ç”¨å¯è¢«æ”»å‡»çš„åŸŸå—åˆ°å…¶ä»–åŸŸä¿¡ä»»çš„ç‰¹ç‚¹ï¼Œä»¥å—ä¿¡ä»»æ¥æºçš„èº«ä»½è¯·æ±‚ä¸€äº›å¹³æ—¶ä¸å…è®¸çš„æ“ä½œï¼Œå¦‚è¿›è¡Œä¸å½“çš„æŠ•ç¥¨æ´»åŠ¨ã€‚ åœ¨è®¿é—®é‡æžå¤§çš„ä¸€äº›é¡µé¢ä¸Šçš„ XSS å¯ä»¥æ”»å‡»ä¸€äº›å°åž‹ç½‘ç«™ï¼Œå®žçŽ° DDoS æ”»å‡»çš„æ•ˆæžœã€‚ åº”å¯¹æ‰‹æ®µ è¿‡æ»¤ç‰¹æ®Šå­—ç¬¦ - å°†ç”¨æˆ·æ‰€æä¾›çš„å†…å®¹è¿›è¡Œè¿‡æ»¤ï¼Œä»Žè€Œé¿å… HTML å’Œ Jascript ä»£ç çš„è¿è¡Œã€‚å¦‚ &gt; è½¬ä¹‰ä¸º &amp;gtã€&lt; è½¬ä¹‰ä¸º &amp;lt ç­‰ï¼Œå°±å¯ä»¥é˜²æ­¢å¤§éƒ¨åˆ†æ”»å‡»ã€‚ä¸ºäº†é¿å…å¯¹ä¸å¿…è¦çš„å†…å®¹é”™è¯¯è½¬ç§»ï¼Œå¦‚ 3&lt;5 ä¸­çš„ &lt; éœ€è¦è¿›è¡Œæ–‡æœ¬åŒ¹é…åŽå†è½¬ç§»ï¼Œå¦‚ï¼š&lt;img src= è¿™æ ·çš„ä¸Šä¸‹æ–‡ä¸­çš„ &lt; æ‰è½¬ä¹‰ã€‚ è®¾ç½® Cookie ä¸º HttpOnly - è®¾ç½®äº† HttpOnly çš„ Cookie å¯ä»¥é˜²æ­¢ JavaScript è„šæœ¬è°ƒç”¨ï¼Œå°±æ— æ³•é€šè¿‡ document.cookie èŽ·å–ç”¨æˆ· Cookie ä¿¡æ¯ã€‚ ðŸ‘‰ å‚è€ƒé˜…è¯»ï¼š Wiki è¯æ¡ - è·¨ç«™è„šæœ¬ Web å®‰å…¨æµ‹è¯•ä¹‹ XSS 1.2. è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰ æ¦‚å¿µ è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCross-site request forgeryï¼ŒCSRFï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸º one-click attack æˆ–è€… session ridingï¼Œé€šå¸¸ç¼©å†™ä¸º CSRF æˆ–è€… XSRFã€‚å®ƒ æ˜¯ä¸€ç§æŒŸåˆ¶ç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„ Web åº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéžæœ¬æ„çš„æ“ä½œçš„æ”»å‡»æ–¹æ³•ã€‚å’Œè·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰ç›¸æ¯”ï¼ŒXSS åˆ©ç”¨çš„æ˜¯ç”¨æˆ·å¯¹æŒ‡å®šç½‘ç«™çš„ä¿¡ä»»ï¼ŒCSRF åˆ©ç”¨çš„æ˜¯ç½‘ç«™å¯¹ç”¨æˆ·ç½‘é¡µæµè§ˆå™¨çš„ä¿¡ä»»ã€‚ æ”»å‡»æ‰‹æ®µå’Œç›®çš„ å¯ä»¥å¦‚æ­¤ç†è§£ CSRFï¼šæ”»å‡»è€…ç›—ç”¨äº†ä½ çš„èº«ä»½ï¼Œä»¥ä½ çš„åä¹‰å‘é€æ¶æ„è¯·æ±‚ã€‚ CSRF èƒ½åšçš„äº‹å¤ªå¤šï¼š ä»¥ä½ åä¹‰å‘é€é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ ç”¨ä½ çš„è´¦å·è´­ä¹°å•†å“ ç”¨ä½ çš„åä¹‰å®Œæˆè™šæ‹Ÿè´§å¸è½¬è´¦ æ³„éœ²ä¸ªäººéšç§ â€¦ åº”å¯¹æ‰‹æ®µ è¡¨å• Token - CSRF æ˜¯ä¸€ä¸ªä¼ªé€ ç”¨æˆ·è¯·æ±‚çš„æ“ä½œï¼Œæ‰€ä»¥éœ€è¦æž„é€ ç”¨æˆ·è¯·æ±‚çš„æ‰€æœ‰å‚æ•°æ‰å¯ä»¥ã€‚è¡¨å• Token é€šè¿‡åœ¨è¯·æ±‚å‚æ•°ä¸­æ·»åŠ éšæœºæ•°çš„åŠžæ³•æ¥é˜»æ­¢æ”»å‡»è€…èŽ·å¾—æ‰€æœ‰è¯·æ±‚å‚æ•°ã€‚ éªŒè¯ç  - è¯·æ±‚æäº¤æ˜¯ï¼Œéœ€è¦ç”¨æˆ·è¾“å…¥éªŒè¯ç ï¼Œä»¥é¿å…ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¢«æ”»å‡»è€…ä¼ªé€ è¯·æ±‚ã€‚ Referer check - HTTP è¯·æ±‚å¤´çš„ Referer åŸŸä¸­è®°å½•ç€è¯·æ±‚èµ„æºï¼Œå¯é€šè¿‡æ£€æŸ¥è¯·æ±‚æ¥æºï¼ŒéªŒè¯å…¶æ˜¯å¦åˆæ³•ã€‚ ðŸ‘‰ å‚è€ƒé˜…è¯»ï¼š Wiki è¯æ¡ - è·¨ç«™è¯·æ±‚ä¼ªé€  æµ…è°ˆ CSRF æ”»å‡»æ–¹å¼ ã€Œæ¯æ—¥ä¸€é¢˜ã€CSRF æ˜¯ä»€ä¹ˆï¼Ÿã€Œæ¯æ—¥ä¸€é¢˜ã€CSRF æ˜¯ä»€ä¹ˆï¼Ÿ WEB å®‰å…¨ä¹‹-CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ 1.3. SQL æ³¨å…¥æ”»å‡» æ¦‚å¿µ SQL æ³¨å…¥æ”»å‡»ï¼ˆSQL injectionï¼‰ï¼Œæ˜¯å‘ç”ŸäºŽåº”ç”¨ç¨‹åºä¹‹æ•°æ®å±‚çš„å®‰å…¨æ¼æ´žã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ˜¯åœ¨è¾“å…¥çš„å­—ç¬¦ä¸²ä¹‹ä¸­æ³¨å…¥ SQL æŒ‡ä»¤ï¼Œåœ¨è®¾è®¡ä¸è‰¯çš„ç¨‹åºå½“ä¸­å¿½ç•¥äº†æ£€æŸ¥ï¼Œé‚£ä¹ˆè¿™äº›æ³¨å…¥è¿›åŽ»çš„æŒ‡ä»¤å°±ä¼šè¢«æ•°æ®åº“æœåŠ¡å™¨è¯¯è®¤ä¸ºæ˜¯æ­£å¸¸çš„ SQL æŒ‡ä»¤è€Œè¿è¡Œï¼Œå› æ­¤é­åˆ°ç ´åæˆ–æ˜¯å…¥ä¾µã€‚ æ”»å‡»ç¤ºä¾‹ï¼š è€ƒè™‘ä»¥ä¸‹ç®€å•çš„ç™»å½•è¡¨å•ï¼š &lt;form action="/login" method="POST"&gt;&lt;p&gt;Username: &lt;input type="text" name="username" /&gt;&lt;/p&gt;&lt;p&gt;Password: &lt;input type="password" name="password" /&gt;&lt;/p&gt;&lt;p&gt;&lt;input type="submit" value="ç™»é™†" /&gt;&lt;/p&gt;&lt;/form&gt; æˆ‘ä»¬çš„å¤„ç†é‡Œé¢çš„ SQL å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š username:=r.Form.Get("username")password:=r.Form.Get("password")sql:="SELECT * FROM user WHERE username='"+username+"' AND password='"+password+"'" å¦‚æžœç”¨æˆ·çš„è¾“å…¥çš„ç”¨æˆ·åå¦‚ä¸‹ï¼Œå¯†ç ä»»æ„ myuser' or 'foo' = 'foo' -- é‚£ä¹ˆæˆ‘ä»¬çš„ SQL å˜æˆäº†å¦‚ä¸‹æ‰€ç¤ºï¼š SELECT * FROM user WHERE username='myuser' or 'foo' = 'foo' --'' AND password='xxx' åœ¨ SQL é‡Œé¢ -- æ˜¯æ³¨é‡Šæ ‡è®°ï¼Œæ‰€ä»¥æŸ¥è¯¢è¯­å¥ä¼šåœ¨æ­¤ä¸­æ–­ã€‚è¿™å°±è®©æ”»å‡»è€…åœ¨ä¸çŸ¥é“ä»»ä½•åˆæ³•ç”¨æˆ·åå’Œå¯†ç çš„æƒ…å†µä¸‹æˆåŠŸç™»å½•äº†ã€‚ å¯¹äºŽ MSSQL è¿˜æœ‰æ›´åŠ å±é™©çš„ä¸€ç§ SQL æ³¨å…¥ï¼Œå°±æ˜¯æŽ§åˆ¶ç³»ç»Ÿï¼Œä¸‹é¢è¿™ä¸ªå¯æ€•çš„ä¾‹å­å°†æ¼”ç¤ºå¦‚ä½•åœ¨æŸäº›ç‰ˆæœ¬çš„ MSSQL æ•°æ®åº“ä¸Šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ sql:="SELECT * FROM products WHERE name LIKE '%"+prod+"%'"Db.Exec(sql) å¦‚æžœæ”»å‡»æäº¤ a%' exec master..xp_cmdshell 'net user test testpass /ADD' -- ä½œä¸ºå˜é‡ prod çš„å€¼ï¼Œé‚£ä¹ˆ sql å°†ä¼šå˜æˆ sql:="SELECT * FROM products WHERE name LIKE '%a%' exec master..xp_cmdshell 'net user test testpass /ADD'--%'" MSSQL æœåŠ¡å™¨ä¼šæ‰§è¡Œè¿™æ¡ SQL è¯­å¥ï¼ŒåŒ…æ‹¬å®ƒåŽé¢é‚£ä¸ªç”¨äºŽå‘ç³»ç»Ÿæ·»åŠ æ–°ç”¨æˆ·çš„å‘½ä»¤ã€‚å¦‚æžœè¿™ä¸ªç¨‹åºæ˜¯ä»¥ sa è¿è¡Œè€Œ MSSQLSERVER æœåŠ¡åˆæœ‰è¶³å¤Ÿçš„æƒé™çš„è¯ï¼Œæ”»å‡»è€…å°±å¯ä»¥èŽ·å¾—ä¸€ä¸ªç³»ç»Ÿå¸å·æ¥è®¿é—®ä¸»æœºäº†ã€‚ è™½ç„¶ä»¥ä¸Šçš„ä¾‹å­æ˜¯é’ˆå¯¹æŸä¸€ç‰¹å®šçš„æ•°æ®åº“ç³»ç»Ÿçš„ï¼Œä½†æ˜¯è¿™å¹¶ä¸ä»£è¡¨ä¸èƒ½å¯¹å…¶å®ƒæ•°æ®åº“ç³»ç»Ÿå®žæ–½ç±»ä¼¼çš„æ”»å‡»ã€‚é’ˆå¯¹è¿™ç§å®‰å…¨æ¼æ´žï¼Œåªè¦ä½¿ç”¨ä¸åŒæ–¹æ³•ï¼Œå„ç§æ•°æ®åº“éƒ½æœ‰å¯èƒ½é­æ®ƒã€‚ æ”»å‡»æ‰‹æ®µå’Œç›®çš„ æ•°æ®è¡¨ä¸­çš„æ•°æ®å¤–æ³„ï¼Œä¾‹å¦‚ä¸ªäººæœºå¯†æ•°æ®ï¼Œè´¦æˆ·æ•°æ®ï¼Œå¯†ç ç­‰ã€‚ æ•°æ®ç»“æž„è¢«é»‘å®¢æŽ¢çŸ¥ï¼Œå¾—ä»¥åšè¿›ä¸€æ­¥æ”»å‡»ï¼ˆä¾‹å¦‚ SELECT * FROM sys.tablesï¼‰ã€‚ æ•°æ®åº“æœåŠ¡å™¨è¢«æ”»å‡»ï¼Œç³»ç»Ÿç®¡ç†å‘˜è´¦æˆ·è¢«çªœæ”¹ï¼ˆä¾‹å¦‚ ALTER LOGIN sa WITH PASSWORD='xxxxxx'ï¼‰ã€‚ èŽ·å–ç³»ç»Ÿè¾ƒé«˜æƒé™åŽï¼Œæœ‰å¯èƒ½å¾—ä»¥åœ¨ç½‘é¡µåŠ å…¥æ¶æ„é“¾æŽ¥ã€æ¶æ„ä»£ç ä»¥åŠ XSS ç­‰ã€‚ ç»ç”±æ•°æ®åº“æœåŠ¡å™¨æä¾›çš„æ“ä½œç³»ç»Ÿæ”¯æŒï¼Œè®©é»‘å®¢å¾—ä»¥ä¿®æ”¹æˆ–æŽ§åˆ¶æ“ä½œç³»ç»Ÿï¼ˆä¾‹å¦‚ xp_cmdshell &quot;net stop iisadmin&quot;å¯åœæ­¢æœåŠ¡å™¨çš„ IIS æœåŠ¡ï¼‰ã€‚ ç ´åç¡¬ç›˜æ•°æ®ï¼Œç˜«ç—ªå…¨ç³»ç»Ÿï¼ˆä¾‹å¦‚ xp_cmdshell â€œFORMAT C:â€ï¼‰ã€‚ åº”å¯¹æ‰‹æ®µ ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ - å»ºè®®ä½¿ç”¨æ•°æ®åº“æä¾›çš„å‚æ•°åŒ–æŸ¥è¯¢æŽ¥å£ï¼Œå‚æ•°åŒ–çš„è¯­å¥ä½¿ç”¨å‚æ•°è€Œä¸æ˜¯å°†ç”¨æˆ·è¾“å…¥å˜é‡åµŒå…¥åˆ° SQL è¯­å¥ä¸­ï¼Œå³ä¸è¦ç›´æŽ¥æ‹¼æŽ¥ SQL è¯­å¥ã€‚ä¾‹å¦‚ä½¿ç”¨ database/sql é‡Œé¢çš„æŸ¥è¯¢å‡½æ•° Prepare å’Œ Query ï¼Œæˆ–è€… Exec(query string, args ...interface{})ã€‚ å•å¼•å·è½¬æ¢ - åœ¨ç»„åˆ SQL å­—ç¬¦ä¸²æ—¶ï¼Œå…ˆé’ˆå¯¹æ‰€ä¼ å…¥çš„å‚æ•°ä½œå­—ç¬¦å–ä»£ï¼ˆå°†å•å¼•å·å­—ç¬¦å–ä»£ä¸ºè¿žç»­ 2 ä¸ªå•å¼•å·å­—ç¬¦ï¼‰ã€‚ ðŸ‘‰ å‚è€ƒé˜…è¯»ï¼š Wiki è¯æ¡ - SQL æ³¨å…¥æ”»å‡» é¿å… SQL æ³¨å…¥ å®žä¾‹è®²è§£ SQL æ³¨å…¥æ”»å‡» 1.4. æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDoSï¼‰ æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆdenial-of-service attack, DoSï¼‰äº¦ç§°æ´ªæ°´æ”»å‡»ï¼Œæ˜¯ä¸€ç§ç½‘ç»œæ”»å‡»æ‰‹æ³•ï¼Œå…¶ç›®çš„åœ¨äºŽä½¿ç›®æ ‡ç”µè„‘çš„ç½‘ç»œæˆ–ç³»ç»Ÿèµ„æºè€—å°½ï¼Œä½¿æœåŠ¡æš‚æ—¶ä¸­æ–­æˆ–åœæ­¢ï¼Œå¯¼è‡´å…¶æ­£å¸¸ç”¨æˆ·æ— æ³•è®¿é—®ã€‚ å½“é»‘å®¢ä½¿ç”¨ç½‘ç»œä¸Šä¸¤ä¸ªæˆ–ä»¥ä¸Šè¢«æ”»é™·çš„ç”µè„‘ä½œä¸ºâ€œåƒµå°¸â€å‘ç‰¹å®šçš„ç›®æ ‡å‘åŠ¨â€œæ‹’ç»æœåŠ¡â€å¼æ”»å‡»æ—¶ï¼Œç§°ä¸ºåˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆdistributed denial-of-service attackï¼Œç¼©å†™ï¼šDDoS attackã€DDoSï¼‰ã€‚ æ”»å‡»æ–¹å¼ å¸¦å®½æ¶ˆè€—åž‹æ”»å‡» èµ„æºæ¶ˆè€—åž‹æ”»å‡» åº”å¯¹æ‰‹æ®µ é˜²ç«å¢™ - å…è®¸æˆ–æ‹’ç»ç‰¹å®šé€šè®¯åè®®ï¼Œç«¯å£æˆ– IP åœ°å€ã€‚å½“æ”»å‡»ä»Žå°‘æ•°ä¸æ­£å¸¸çš„ IP åœ°å€å‘å‡ºæ—¶ï¼Œå¯ä»¥ç®€å•çš„ä½¿ç”¨æ‹’ç»è§„åˆ™é˜»æ­¢ä¸€åˆ‡ä»Žæ”»å‡»æº IP å‘å‡ºçš„é€šä¿¡ã€‚ è·¯ç”±å™¨ã€äº¤æ¢æœº - å…·æœ‰é€Ÿåº¦é™åˆ¶å’Œè®¿é—®æŽ§åˆ¶èƒ½åŠ›ã€‚ æµé‡æ¸…æ´— - é€šè¿‡é‡‡ç”¨æŠ— DDoS è½¯ä»¶å¤„ç†ï¼Œå°†æ­£å¸¸æµé‡å’Œæ¶æ„æµé‡åŒºåˆ†å¼€ã€‚ ðŸ‘‰ å‚è€ƒé˜…è¯»ï¼š æ‹’ç»æœåŠ¡æ”»å‡» 2. åŠ å¯†æŠ€æœ¯åŠå¯†é’¥å®‰å…¨ç®¡ç† å¯¹äºŽç½‘ç«™æ¥è¯´ï¼Œç”¨æˆ·ä¿¡æ¯ã€è´¦æˆ·ç­‰ç­‰æ•æ„Ÿæ•°æ®ä¸€æ—¦æ³„æ¼ï¼ŒåŽæžœä¸¥é‡ï¼Œæ‰€ä»¥ä¸ºäº†ä¿æŠ¤æ•°æ®ï¼Œåº”å¯¹è¿™äº›ä¿¡æ¯è¿›è¡ŒåŠ å¯†å¤„ç†ã€‚ ä¿¡æ¯åŠ å¯†æŠ€æœ¯ä¸€èˆ¬åˆ†ä¸ºï¼š æ¶ˆæ¯æ‘˜è¦ åŠ å¯†ç®—æ³• å¯¹ç§°åŠ å¯† éžå¯¹ç§°åŠ å¯† è¯ä¹¦ 2.1. æ¶ˆæ¯æ‘˜è¦ å¸¸ç”¨æ•°å­—ç­¾åç®—æ³•ï¼šMD5ã€SHA ç­‰ã€‚ åº”ç”¨åœºæ™¯ï¼šå°†ç”¨æˆ·å¯†ç ä»¥æ¶ˆæ¯æ‘˜è¦å½¢å¼ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ ðŸ‘‰ å‚è€ƒé˜…è¯»ï¼š æ¶ˆæ¯æ‘˜è¦ 2.2. åŠ å¯†ç®—æ³• å¯¹ç§°åŠ å¯† å¯¹ç§°åŠ å¯†æŒ‡åŠ å¯†å’Œè§£å¯†æ‰€ä½¿ç”¨çš„å¯†é’¥æ˜¯åŒä¸€ä¸ªå¯†é’¥ã€‚ å¸¸ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ï¼šDES ç­‰ã€‚ åº”ç”¨åœºæ™¯ï¼šCookie åŠ å¯†ã€é€šä¿¡æœºå¯†ç­‰ã€‚ éžå¯¹ç§°åŠ å¯† éžå¯¹ç§°åŠ å¯†æŒ‡åŠ å¯†å’Œè§£å¯†æ‰€ä½¿ç”¨çš„ä¸æ˜¯åŒä¸€ä¸ªå¯†é’¥ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¬ç§é’¥å¯¹ã€‚ç”¨å…¬é’¥åŠ å¯†çš„ä¿¡æ¯å¿…é¡»ç”¨ç§é’¥æ‰èƒ½è§£å¼€ï¼›åä¹‹ï¼Œç”¨ç§é’¥åŠ å¯†çš„ä¿¡æ¯åªæœ‰ç”¨å…¬é’¥æ‰èƒ½è§£å¼€ã€‚ å¸¸ç”¨éžå¯¹ç§°åŠ å¯†ç®—æ³•ï¼šRSA ç­‰ã€‚ åº”ç”¨åœºæ™¯ï¼šHTTPS ä¼ è¾“ä¸­æµè§ˆå™¨ä½¿ç”¨çš„æ•°å­—è¯ä¹¦å®žè´¨ä¸Šæ˜¯ç»è¿‡æƒå¨æœºæž„è®¤è¯çš„éžå¯¹ç§°åŠ å¯†å…¬é’¥ã€‚ ðŸ‘‰ å‚è€ƒé˜…è¯»ï¼š åŠ å¯† 2.3. å¯†é’¥å®‰å…¨ç®¡ç† ä¿è¯å¯†é’¥å®‰å…¨çš„æ–¹æ³•ï¼š æŠŠå¯†é’¥å’Œç®—æ³•æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šï¼Œå¯¹å¤–æä¾›åŠ å¯†å’Œè§£å¯†æœåŠ¡ï¼Œåº”ç”¨ç³»ç»Ÿé€šè¿‡è°ƒç”¨è¿™ä¸ªæœåŠ¡ï¼Œå®žçŽ°æ•°æ®çš„åŠ è§£å¯†ã€‚ æŠŠåŠ è§£å¯†ç®—æ³•æ”¾åœ¨åº”ç”¨ç³»ç»Ÿä¸­ï¼Œå¯†é’¥åˆ™æ”¾åœ¨ç‹¬ç«‹æœåŠ¡å™¨ä¸­ï¼Œä¸ºäº†æé«˜å¯†é’¥çš„å®‰å…¨æ€§ï¼Œå®žé™…å­˜å‚¨æ—¶ï¼Œå¯†é’¥è¢«åˆ‡åˆ†æˆæ•°ç‰‡ï¼ŒåŠ å¯†åŽåˆ†åˆ«ä¿å­˜åœ¨ä¸åŒå­˜å‚¨ä»‹è´¨ä¸­ã€‚ 2.3. è¯ä¹¦ è¯ä¹¦å¯ä»¥ç§°ä¸ºä¿¡æ¯å®‰å…¨åŠ å¯†çš„ç»ˆæžæ‰‹æ®µã€‚å…¬å¼€å¯†é’¥è®¤è¯ï¼ˆè‹±è¯­ï¼šPublic key certificateï¼‰ï¼Œåˆç§°å…¬å¼€å¯†é’¥è¯ä¹¦ã€å…¬é’¥è¯ä¹¦ã€æ•°å­—è¯ä¹¦ï¼ˆdigital certificateï¼‰ã€æ•°å­—è®¤è¯ã€èº«ä»½è¯ä¹¦ï¼ˆidentity certificateï¼‰ã€ç”µå­è¯ä¹¦æˆ–å®‰å…¨è¯ä¹¦ï¼Œæ˜¯ç”¨äºŽå…¬å¼€å¯†é’¥åŸºç¡€å»ºè®¾çš„ç”µå­æ–‡ä»¶ï¼Œç”¨æ¥è¯æ˜Žå…¬å¼€å¯†é’¥æ‹¥æœ‰è€…çš„èº«ä»½ã€‚æ­¤æ–‡ä»¶åŒ…å«äº†å…¬é’¥ä¿¡æ¯ã€æ‹¥æœ‰è€…èº«ä»½ä¿¡æ¯ï¼ˆä¸»ä½“ï¼‰ã€ä»¥åŠæ•°å­—è¯ä¹¦è®¤è¯æœºæž„ï¼ˆå‘è¡Œè€…ï¼‰å¯¹è¿™ä»½æ–‡ä»¶çš„æ•°å­—ç­¾åï¼Œä»¥ä¿è¯è¿™ä¸ªæ–‡ä»¶çš„æ•´ä½“å†…å®¹æ­£ç¡®æ— è¯¯ã€‚ é€è¿‡ä¿¡ä»»æƒå¨æ•°å­—è¯ä¹¦è®¤è¯æœºæž„çš„æ ¹è¯ä¹¦ã€åŠå…¶ä½¿ç”¨å…¬å¼€å¯†é’¥åŠ å¯†ä½œæ•°å­—ç­¾åæ ¸å‘çš„å…¬å¼€å¯†é’¥è®¤è¯ï¼Œå½¢æˆä¿¡ä»»é“¾æž¶æž„ï¼Œå·²åœ¨ TLS å®žçŽ°å¹¶åœ¨ä¸‡ç»´ç½‘çš„ HTTP ä»¥ HTTPSã€åœ¨ç”µå­é‚®ä»¶çš„ SMTP ä»¥ STARTTLS å¼•å…¥å¹¶å¹¿æ³›åº”ç”¨ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼Œå¸¸è§çš„åº”ç”¨å±‚åè®® HTTPã€FTPã€Telnet æœ¬èº«ä¸ä¿è¯ä¿¡æ¯å®‰å…¨ã€‚ä½†æ˜¯åŠ å…¥äº† SSL/TLS åŠ å¯†æ•°æ®åŒ…æœºåˆ¶çš„ HTTPSã€FTPSã€Telnets æ˜¯ä¿¡æ¯å®‰å…¨çš„ã€‚ æ¦‚å¿µ ä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼ˆTransport Layer Security, TLSï¼‰ï¼ŒåŠå…¶å‰èº«å®‰å…¨å¥—æŽ¥å±‚ï¼ˆSecure Sockets Layer, SSLï¼‰æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œç›®çš„æ˜¯ä¸ºäº’è”ç½‘é€šä¿¡ï¼Œæä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§ä¿éšœã€‚ è¯ä¹¦åŽŸç† SSL/TLS åè®®çš„åŸºæœ¬æ€è·¯æ˜¯é‡‡ç”¨å…¬é’¥åŠ å¯†æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å…ˆå‘æœåŠ¡å™¨ç«¯ç´¢è¦å…¬é’¥ï¼Œç„¶åŽç”¨å…¬é’¥åŠ å¯†ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯†æ–‡åŽï¼Œç”¨è‡ªå·±çš„ç§é’¥è§£å¯†ã€‚ è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š ï¼ˆ1ï¼‰å¦‚ä½•ä¿è¯å…¬é’¥ä¸è¢«ç¯¡æ”¹ï¼Ÿ è§£å†³æ–¹æ³•ï¼šå°†å…¬é’¥æ”¾åœ¨æ•°å­—è¯ä¹¦ä¸­ã€‚åªè¦è¯ä¹¦æ˜¯å¯ä¿¡çš„ï¼Œå…¬é’¥å°±æ˜¯å¯ä¿¡çš„ã€‚ ï¼ˆ2ï¼‰å…¬é’¥åŠ å¯†è®¡ç®—é‡å¤ªå¤§ï¼Œå¦‚ä½•å‡å°‘è€—ç”¨çš„æ—¶é—´ï¼Ÿ è§£å†³æ–¹æ³•ï¼šæ¯ä¸€æ¬¡å¯¹è¯ï¼ˆsessionï¼‰ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½ç”Ÿæˆä¸€ä¸ª&quot;å¯¹è¯å¯†é’¥&quot;ï¼ˆsession keyï¼‰ï¼Œç”¨å®ƒæ¥åŠ å¯†ä¿¡æ¯ã€‚ç”±äºŽ&quot;å¯¹è¯å¯†é’¥&quot;æ˜¯å¯¹ç§°åŠ å¯†ï¼Œæ‰€ä»¥è¿ç®—é€Ÿåº¦éžå¸¸å¿«ï¼Œè€ŒæœåŠ¡å™¨å…¬é’¥åªç”¨äºŽåŠ å¯†&quot;å¯¹è¯å¯†é’¥&quot;æœ¬èº«ï¼Œè¿™æ ·å°±å‡å°‘äº†åŠ å¯†è¿ç®—çš„æ¶ˆè€—æ—¶é—´ã€‚ SSL/TLS åè®®çš„åŸºæœ¬è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯ç´¢è¦å¹¶éªŒè¯å…¬é’¥ã€‚ åŒæ–¹åå•†ç”Ÿæˆ&quot;å¯¹è¯å¯†é’¥&quot;ã€‚ åŒæ–¹é‡‡ç”¨&quot;å¯¹è¯å¯†é’¥&quot;è¿›è¡ŒåŠ å¯†é€šä¿¡ã€‚ ðŸ‘‰ å‚è€ƒé˜…è¯»ï¼š ä¼ è¾“å±‚å®‰å…¨æ€§åè®® å…¬å¼€å¯†é’¥è®¤è¯ SSL/TLS åè®®è¿è¡Œæœºåˆ¶çš„æ¦‚è¿° 3. èµ„æ–™ å¤§åž‹ç½‘ç«™æŠ€æœ¯æž¶æž„ Wiki è¯æ¡ - è·¨ç«™è„šæœ¬ Web å®‰å…¨æµ‹è¯•ä¹‹ XSS Wiki è¯æ¡ - è·¨ç«™è¯·æ±‚ä¼ªé€  æµ…è°ˆ CSRF æ”»å‡»æ–¹å¼ ã€Œæ¯æ—¥ä¸€é¢˜ã€CSRF æ˜¯ä»€ä¹ˆï¼Ÿã€Œæ¯æ—¥ä¸€é¢˜ã€CSRF æ˜¯ä»€ä¹ˆï¼Ÿ WEB å®‰å…¨ä¹‹-CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ Wiki è¯æ¡ - SQL æ³¨å…¥æ”»å‡» é¿å… SQL æ³¨å…¥ å®žä¾‹è®²è§£ SQL æ³¨å…¥æ”»å‡» æ‹’ç»æœåŠ¡æ”»å‡» ä¼ è¾“å±‚å®‰å…¨æ€§åè®® å…¬å¼€å¯†é’¥è®¤è¯ SSL/TLS åè®®è¿è¡Œæœºåˆ¶çš„æ¦‚è¿°]]></content>
      <categories>
        <category>design</category>
        <category>architecture</category>
      </categories>
      <tags>
        <tag>design</tag>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€ç¯‡æ–‡ç« è®©ä½ å½»åº•æŽŒæ¡ python è¯­è¨€]]></title>
    <url>%2Fblog%2F2018%2F06%2F28%2Fprogramming%2Fpython%2F</url>
    <content type="text"><![CDATA[ä¸€ç¯‡æ–‡ç« è®©ä½ å½»åº•æŽŒæ¡ python è¯­è¨€ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ è§£é‡Šå™¨ æ³¨é‡Š æ•°æ®ç±»åž‹ æ“ä½œç¬¦ ç®—æœ¯è¿ç®—ç¬¦ æ¯”è¾ƒè¿ç®—ç¬¦ èµ‹å€¼è¿ç®—ç¬¦ ä½è¿ç®—ç¬¦ é€»è¾‘è¿ç®—ç¬¦ æˆå‘˜è¿ç®—ç¬¦ èº«ä»½è¿ç®—ç¬¦ è¿ç®—ç¬¦ä¼˜å…ˆçº§ æŽ§åˆ¶è¯­å¥ æ¡ä»¶è¯­å¥ å¾ªçŽ¯è¯­å¥ å‡½æ•° å‡½æ•°å˜é‡ä½œç”¨åŸŸ å…³é”®å­—å‚æ•° å¯å˜å‚æ•°åˆ—è¡¨ è¿”å›žå€¼ å¼‚å¸¸ å¼‚å¸¸å¤„ç† æŠ›å‡ºå¼‚å¸¸ è‡ªå®šä¹‰å¼‚å¸¸ é¢å‘å¯¹è±¡ é¢å‘å¯¹è±¡æŠ€æœ¯ç®€ä»‹ ç±»å®šä¹‰ ç±»å¯¹è±¡ ç±»çš„æ–¹æ³• ç»§æ‰¿ å¤šç»§æ‰¿ æ–¹æ³•é‡å†™ ç±»å±žæ€§ä¸Žæ–¹æ³• æ ‡å‡†åº“æ¦‚è§ˆ æ“ä½œç³»ç»ŸæŽ¥å£ æ–‡ä»¶é€šé…ç¬¦ å‘½ä»¤è¡Œå‚æ•° é”™è¯¯è¾“å‡ºé‡å®šå‘å’Œç¨‹åºç»ˆæ­¢ å­—ç¬¦ä¸²æ­£åˆ™åŒ¹é… æ•°å­¦ Python ç¼–ç¨‹ è§£é‡Šå™¨ Linux/Unix çš„ç³»ç»Ÿä¸Šï¼ŒPython è§£é‡Šå™¨é€šå¸¸è¢«å®‰è£…åœ¨ /usr/local/bin/python3.4 è¿™æ ·çš„æœ‰æ•ˆè·¯å¾„ï¼ˆç›®å½•ï¼‰é‡Œã€‚ æˆ‘ä»¬å¯ä»¥å°†è·¯å¾„ /usr/local/bin æ·»åŠ åˆ°æ‚¨çš„ Linux/Unix æ“ä½œç³»ç»Ÿçš„çŽ¯å¢ƒå˜é‡ä¸­ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥é€šè¿‡ shell ç»ˆç«¯è¾“å…¥ä¸‹é¢çš„å‘½ä»¤æ¥å¯åŠ¨ Python ã€‚ åœ¨ Linux/Unix ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥åœ¨è„šæœ¬é¡¶éƒ¨æ·»åŠ ä»¥ä¸‹å‘½ä»¤è®© Python è„šæœ¬å¯ä»¥åƒ SHELL è„šæœ¬ä¸€æ ·å¯ç›´æŽ¥æ‰§è¡Œï¼š #! /usr/bin/env python3.4 æ³¨é‡Š Python ä¸­çš„æ³¨é‡Šæœ‰ä¸‰ç§å½¢å¼ï¼š ä»¥ # å¼€å¤´ ä»¥ ''' å¼€å§‹ï¼Œä»¥ ''' ç»“å°¾ ä»¥ &quot;&quot;&quot; å¼€å§‹ï¼Œä»¥ &quot;&quot;&quot; ç»“å°¾ # å•è¡Œæ³¨é‡Š'''è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œç”¨ä¸‰ä¸ªå•å¼•å·è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œç”¨ä¸‰ä¸ªå•å¼•å·è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œç”¨ä¸‰ä¸ªå•å¼•å·'''"""è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œç”¨ä¸‰ä¸ªåŒå¼•å·è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œç”¨ä¸‰ä¸ªåŒå¼•å·è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œç”¨ä¸‰ä¸ªåŒå¼•å·""" æ•°æ®ç±»åž‹ Python3 ä¸­æœ‰å…­ä¸ªæ ‡å‡†çš„æ•°æ®ç±»åž‹ï¼š Numbersï¼ˆæ•°å­—ï¼‰ Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ Listï¼ˆåˆ—è¡¨ï¼‰ Tupleï¼ˆå…ƒç»„ï¼‰ Setsï¼ˆé›†åˆï¼‰ Dictionariesï¼ˆå­—å…¸ï¼‰ æ“ä½œç¬¦ Python è¯­è¨€æ”¯æŒä»¥ä¸‹ç±»åž‹çš„è¿ç®—ç¬¦: ç®—æœ¯è¿ç®—ç¬¦ æ¯”è¾ƒï¼ˆå…³ç³»ï¼‰è¿ç®—ç¬¦ èµ‹å€¼è¿ç®—ç¬¦ é€»è¾‘è¿ç®—ç¬¦ ä½è¿ç®—ç¬¦ æˆå‘˜è¿ç®—ç¬¦ èº«ä»½è¿ç®—ç¬¦ è¿ç®—ç¬¦ä¼˜å…ˆçº§ ç®—æœ¯è¿ç®—ç¬¦ è¿ç®—ç¬¦ æè¿° å®žä¾‹ + åŠ  - ä¸¤ä¸ªå¯¹è±¡ç›¸åŠ  a + b è¾“å‡ºç»“æžœ 31 - å‡ - å¾—åˆ°è´Ÿæ•°æˆ–æ˜¯ä¸€ä¸ªæ•°å‡åŽ»å¦ä¸€ä¸ªæ•° a - b è¾“å‡ºç»“æžœ -11 * ä¹˜ - ä¸¤ä¸ªæ•°ç›¸ä¹˜æˆ–æ˜¯è¿”å›žä¸€ä¸ªè¢«é‡å¤è‹¥å¹²æ¬¡çš„å­—ç¬¦ä¸² a * b è¾“å‡ºç»“æžœ 210 / é™¤ - x é™¤ä»¥ y b / a è¾“å‡ºç»“æžœ 2.1 % å–æ¨¡ - è¿”å›žé™¤æ³•çš„ä½™æ•° b % a è¾“å‡ºç»“æžœ 1 ** å¹‚ - è¿”å›ž x çš„ y æ¬¡å¹‚ a**b ä¸º 10 çš„ 21 æ¬¡æ–¹ // å–æ•´é™¤ - è¿”å›žå•†çš„æ•´æ•°éƒ¨åˆ† 9//2 è¾“å‡ºç»“æžœ 4 , 9.0//2.0 è¾“å‡ºç»“æžœ 4.0 æ¯”è¾ƒè¿ç®—ç¬¦ è¿ç®—ç¬¦ æè¿° å®žä¾‹ == ç­‰äºŽ - æ¯”è¾ƒå¯¹è±¡æ˜¯å¦ç›¸ç­‰ (a == b) è¿”å›ž Falseã€‚ != ä¸ç­‰äºŽ - æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ä¸ç›¸ç­‰ (a != b) è¿”å›ž True. &gt; å¤§äºŽ - è¿”å›ž x æ˜¯å¦å¤§äºŽ y (a &gt; b) è¿”å›ž Falseã€‚ &lt; å°äºŽ - è¿”å›ž x æ˜¯å¦å°äºŽ yã€‚æ‰€æœ‰æ¯”è¾ƒè¿ç®—ç¬¦è¿”å›ž 1 è¡¨ç¤ºçœŸï¼Œè¿”å›ž 0 è¡¨ç¤ºå‡ã€‚è¿™åˆ†åˆ«ä¸Žç‰¹æ®Šçš„å˜é‡ True å’Œ False ç­‰ä»·ã€‚æ³¨æ„ï¼Œè¿™äº›å˜é‡åçš„å¤§å†™ã€‚ (a &lt; b) è¿”å›ž Trueã€‚ &gt;= å¤§äºŽç­‰äºŽ - è¿”å›ž x æ˜¯å¦å¤§äºŽç­‰äºŽ yã€‚ (a &gt;= b) è¿”å›ž Falseã€‚ &lt;= å°äºŽç­‰äºŽ - è¿”å›ž x æ˜¯å¦å°äºŽç­‰äºŽ yã€‚ (a &lt;= b) è¿”å›ž Trueã€‚ èµ‹å€¼è¿ç®—ç¬¦ è¿ç®—ç¬¦ æè¿° å®žä¾‹ = ç®€å•çš„èµ‹å€¼è¿ç®—ç¬¦ c = a + b å°† a + b çš„è¿ç®—ç»“æžœèµ‹å€¼ä¸º c += åŠ æ³•èµ‹å€¼è¿ç®—ç¬¦ c += a ç­‰æ•ˆäºŽ c = c + a -= å‡æ³•èµ‹å€¼è¿ç®—ç¬¦ c -= a ç­‰æ•ˆäºŽ c = c - a *= ä¹˜æ³•èµ‹å€¼è¿ç®—ç¬¦ c _= a ç­‰æ•ˆäºŽ c = c _ a /= é™¤æ³•èµ‹å€¼è¿ç®—ç¬¦ c /= a ç­‰æ•ˆäºŽ c = c / a %= å–æ¨¡èµ‹å€¼è¿ç®—ç¬¦ c %= a ç­‰æ•ˆäºŽ c = c % a **= å¹‚èµ‹å€¼è¿ç®—ç¬¦ c **= a ç­‰æ•ˆäºŽ c = c ** a //= å–æ•´é™¤èµ‹å€¼è¿ç®—ç¬¦ c //= a ç­‰æ•ˆäºŽ c = c // a ä½è¿ç®—ç¬¦ è¿ç®—ç¬¦ æè¿° å®žä¾‹ &amp; æŒ‰ä½ä¸Žè¿ç®—ç¬¦ï¼šå‚ä¸Žè¿ç®—çš„ä¸¤ä¸ªå€¼,å¦‚æžœä¸¤ä¸ªç›¸åº”ä½éƒ½ä¸º 1,åˆ™è¯¥ä½çš„ç»“æžœä¸º 1,å¦åˆ™ä¸º 0 (a &amp; b) è¾“å‡ºç»“æžœ 12 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0000 1100 | æŒ‰ä½æˆ–è¿ç®—ç¬¦ï¼šåªè¦å¯¹åº”çš„äºŒä¸ªäºŒè¿›ä½æœ‰ä¸€ä¸ªä¸º 1 æ—¶ï¼Œç»“æžœä½å°±ä¸º 1ã€‚ (a | b) è¾“å‡ºç»“æžœ 61 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0011 1101 ^ æŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦ï¼šå½“ä¸¤å¯¹åº”çš„äºŒè¿›ä½ç›¸å¼‚æ—¶ï¼Œç»“æžœä¸º 1 (a ^ b) è¾“å‡ºç»“æžœ 49 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0011 0001 ~ æŒ‰ä½å–åè¿ç®—ç¬¦ï¼šå¯¹æ•°æ®çš„æ¯ä¸ªäºŒè¿›åˆ¶ä½å–å,å³æŠŠ 1 å˜ä¸º 0,æŠŠ 0 å˜ä¸º 1 (~a ) è¾“å‡ºç»“æžœ -61 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 1100 0011ï¼Œ åœ¨ä¸€ä¸ªæœ‰ç¬¦å·äºŒè¿›åˆ¶æ•°çš„è¡¥ç å½¢å¼ã€‚ &lt;&lt; å·¦ç§»åŠ¨è¿ç®—ç¬¦ï¼šè¿ç®—æ•°çš„å„äºŒè¿›ä½å…¨éƒ¨å·¦ç§»è‹¥å¹²ä½ï¼Œç”±&quot;&lt;&lt;&quot;å³è¾¹çš„æ•°æŒ‡å®šç§»åŠ¨çš„ä½æ•°ï¼Œé«˜ä½ä¸¢å¼ƒï¼Œä½Žä½è¡¥ 0ã€‚ a &lt;&lt; 2 è¾“å‡ºç»“æžœ 240 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 1111 0000 &gt;&gt; å³ç§»åŠ¨è¿ç®—ç¬¦ï¼šæŠŠ&quot;&gt;&gt;â€œå·¦è¾¹çš„è¿ç®—æ•°çš„å„äºŒè¿›ä½å…¨éƒ¨å³ç§»è‹¥å¹²ä½ï¼Œâ€&gt;&gt;&quot;å³è¾¹çš„æ•°æŒ‡å®šç§»åŠ¨çš„ä½æ•° a &gt;&gt; 2 è¾“å‡ºç»“æžœ 15 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0000 1111 é€»è¾‘è¿ç®—ç¬¦ è¿ç®—ç¬¦ é€»è¾‘è¡¨è¾¾å¼ æè¿° å®žä¾‹ and x and y å¸ƒå°”&quot;ä¸Ž&quot; - å¦‚æžœ x ä¸º Falseï¼Œx and y è¿”å›ž Falseï¼Œå¦åˆ™å®ƒè¿”å›ž y çš„è®¡ç®—å€¼ã€‚ (a and b) è¿”å›ž 20ã€‚ or x or y å¸ƒå°”&quot;æˆ–&quot; - å¦‚æžœ x æ˜¯ Trueï¼Œå®ƒè¿”å›ž x çš„å€¼ï¼Œå¦åˆ™å®ƒè¿”å›ž y çš„è®¡ç®—å€¼ã€‚ (a or b) è¿”å›ž 10ã€‚ not not x å¸ƒå°”&quot;éž&quot; - å¦‚æžœ x ä¸º Trueï¼Œè¿”å›ž False ã€‚å¦‚æžœ x ä¸º Falseï¼Œå®ƒè¿”å›ž Trueã€‚ not(a and b) è¿”å›ž False æˆå‘˜è¿ç®—ç¬¦ è¿ç®—ç¬¦ æè¿° å®žä¾‹ in å¦‚æžœåœ¨æŒ‡å®šçš„åºåˆ—ä¸­æ‰¾åˆ°å€¼è¿”å›ž Trueï¼Œå¦åˆ™è¿”å›ž Falseã€‚ x åœ¨ y åºåˆ—ä¸­ , å¦‚æžœ x åœ¨ y åºåˆ—ä¸­è¿”å›ž Trueã€‚ not in å¦‚æžœåœ¨æŒ‡å®šçš„åºåˆ—ä¸­æ²¡æœ‰æ‰¾åˆ°å€¼è¿”å›ž Trueï¼Œå¦åˆ™è¿”å›ž Falseã€‚ x ä¸åœ¨ y åºåˆ—ä¸­ , å¦‚æžœ x ä¸åœ¨ y åºåˆ—ä¸­è¿”å›ž Trueã€‚ èº«ä»½è¿ç®—ç¬¦ è¿ç®—ç¬¦ æè¿° å®žä¾‹ is is æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸æ˜¯å¼•ç”¨è‡ªä¸€ä¸ªå¯¹è±¡ x is y, å¦‚æžœ id(x) ç­‰äºŽ id(y) , is è¿”å›žç»“æžœ 1 is not is not æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸æ˜¯å¼•ç”¨è‡ªä¸åŒå¯¹è±¡ x is not y, å¦‚æžœ id(x) ä¸ç­‰äºŽ id(y). is not è¿”å›žç»“æžœ 1 è¿ç®—ç¬¦ä¼˜å…ˆçº§ è¿ç®—ç¬¦ æè¿° ** æŒ‡æ•° (æœ€é«˜ä¼˜å…ˆçº§) ~ + - æŒ‰ä½ç¿»è½¬, ä¸€å…ƒåŠ å·å’Œå‡å· (æœ€åŽä¸¤ä¸ªçš„æ–¹æ³•åä¸º +@ å’Œ -@) * / % // ä¹˜ï¼Œé™¤ï¼Œå–æ¨¡å’Œå–æ•´é™¤ + - åŠ æ³•å‡æ³• &gt;&gt; &lt;&lt; å³ç§»ï¼Œå·¦ç§»è¿ç®—ç¬¦ &amp; ä½ â€˜ANDâ€™ ^ | ä½è¿ç®—ç¬¦ &lt;= &lt; &gt; &gt;= æ¯”è¾ƒè¿ç®—ç¬¦ &lt;&gt; == != ç­‰äºŽè¿ç®—ç¬¦ = %= /= //= -= += *= **= èµ‹å€¼è¿ç®—ç¬¦ is is not èº«ä»½è¿ç®—ç¬¦ in not in æˆå‘˜è¿ç®—ç¬¦ not or and é€»è¾‘è¿ç®—ç¬¦ æŽ§åˆ¶è¯­å¥ æ¡ä»¶è¯­å¥ if condition_1: statement_block_1elif condition_2: statement_block_2else: statement_block_3 å¾ªçŽ¯è¯­å¥ while while åˆ¤æ–­æ¡ä»¶ï¼š statements for for &lt;variable&gt; in &lt;sequence&gt;: &lt;statements&gt; range() for i in range(0, 10, 3) : print(i) break å’Œ continue break è¯­å¥å¯ä»¥è·³å‡º for å’Œ while çš„å¾ªçŽ¯ä½“ã€‚ continue è¯­å¥è¢«ç”¨æ¥å‘Šè¯‰ Python è·³è¿‡å½“å‰å¾ªçŽ¯å—ä¸­çš„å‰©ä½™è¯­å¥ï¼Œç„¶åŽç»§ç»­è¿›è¡Œä¸‹ä¸€è½®å¾ªçŽ¯ã€‚ pass pass è¯­å¥ä»€ä¹ˆéƒ½ä¸åšã€‚å®ƒåªåœ¨è¯­æ³•ä¸Šéœ€è¦ä¸€æ¡è¯­å¥ä½†ç¨‹åºä¸éœ€è¦ä»»ä½•æ“ä½œæ—¶ä½¿ç”¨.ä¾‹å¦‚: while True: pass # ç­‰å¾…é”®ç›˜ä¸­æ–­ (Ctrl+C) å‡½æ•° Python å®šä¹‰å‡½æ•°ä½¿ç”¨ def å…³é”®å­—ï¼Œä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼š def å‡½æ•°åï¼ˆå‚æ•°åˆ—è¡¨ï¼‰ï¼š å‡½æ•°ä½“ å‡½æ•°å˜é‡ä½œç”¨åŸŸ #!/usr/bin/env python3a = 4 # å…¨å±€å˜é‡def print_func1(): a = 17 # å±€éƒ¨å˜é‡ print("in print_func a = ", a)def print_func2(): print("in print_func a = ", a)print_func1()print_func2()print("a = ", a) ä»¥ä¸Šå®žä¾‹è¿è¡Œç»“æžœå¦‚ä¸‹ï¼š in print_func a = 17in print_func a = 4a = 4 å…³é”®å­—å‚æ•° å‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨ kwarg=value çš„å…³é”®å­—å‚æ•°å½¢å¼è¢«è°ƒç”¨.ä¾‹å¦‚,ä»¥ä¸‹å‡½æ•°: def parrot(voltage, state='a stiff', action='voom', type='Norwegian Blue'): print("-- This parrot wouldn't", action, end=' ') print("if you put", voltage, "volts through it.") print("-- Lovely plumage, the", type) print("-- It's", state, "!") å¯ä»¥ä»¥ä¸‹å‡ ç§æ–¹å¼è¢«è°ƒç”¨: parrot(1000) # 1 positional argumentparrot(voltage=1000) # 1 keyword argumentparrot(voltage=1000000, action='VOOOOOM') # 2 keyword argumentsparrot(action='VOOOOOM', voltage=1000000) # 2 keyword argumentsparrot('a million', 'bereft of life', 'jump') # 3 positional argumentsparrot('a thousand', state='pushing up the daisies') # 1 positional, 1 keyword ä»¥ä¸‹ä¸ºé”™è¯¯è°ƒç”¨æ–¹æ³•ï¼š parrot() # required argument missingparrot(voltage=5.0, 'dead') # non-keyword argument after a keyword argumentparrot(110, voltage=220) # duplicate value for the same argumentparrot(actor='John Cleese') # unknown keyword argument å¯å˜å‚æ•°åˆ—è¡¨ æœ€åŽ,ä¸€ä¸ªæœ€ä¸å¸¸ç”¨çš„é€‰æ‹©æ˜¯å¯ä»¥è®©å‡½æ•°è°ƒç”¨å¯å˜ä¸ªæ•°çš„å‚æ•°.è¿™äº›å‚æ•°è¢«åŒ…è£…è¿›ä¸€ä¸ªå…ƒç»„(æŸ¥çœ‹å…ƒç»„å’Œåºåˆ—).åœ¨è¿™äº›å¯å˜ä¸ªæ•°çš„å‚æ•°ä¹‹å‰,å¯ä»¥æœ‰é›¶åˆ°å¤šä¸ªæ™®é€šçš„å‚æ•°: def arithmetic_mean(*args): sum = 0 for x in args: sum += x return sum è¿”å›žå€¼ Python çš„å‡½æ•°çš„è¿”å›žå€¼ä½¿ç”¨ return è¯­å¥ï¼Œå¯ä»¥å°†å‡½æ•°ä½œä¸ºä¸€ä¸ªå€¼èµ‹å€¼ç»™æŒ‡å®šå˜é‡ï¼š def return_sum(x,y): c = x + y return c å¼‚å¸¸ å¼‚å¸¸å¤„ç† try è¯­å¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼å·¥ä½œï¼› é¦–å…ˆï¼Œæ‰§è¡Œ try å­å¥ï¼ˆåœ¨å…³é”®å­— try å’Œå…³é”®å­— except ä¹‹é—´çš„è¯­å¥ï¼‰ å¦‚æžœæ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œå¿½ç•¥ except å­å¥ï¼Œtry å­å¥æ‰§è¡ŒåŽç»“æŸã€‚ å¦‚æžœåœ¨æ‰§è¡Œ try å­å¥çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆ try å­å¥ä½™ä¸‹çš„éƒ¨åˆ†å°†è¢«å¿½ç•¥ã€‚å¦‚æžœå¼‚å¸¸çš„ç±»åž‹å’Œ except ä¹‹åŽçš„åç§°ç›¸ç¬¦ï¼Œé‚£ä¹ˆå¯¹åº”çš„ except å­å¥å°†è¢«æ‰§è¡Œã€‚æœ€åŽæ‰§è¡Œ try è¯­å¥ä¹‹åŽçš„ä»£ç ã€‚ å¦‚æžœä¸€ä¸ªå¼‚å¸¸æ²¡æœ‰ä¸Žä»»ä½•çš„ except åŒ¹é…ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼‚å¸¸å°†ä¼šä¼ é€’ç»™ä¸Šå±‚çš„ try ä¸­ã€‚ ä¸ç®¡ try å­å¥é‡Œé¢æœ‰æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œfinally å­å¥éƒ½ä¼šæ‰§è¡Œã€‚ import systry: f = open('myfile.txt') s = f.readline() i = int(s.strip())except OSError as err: print("OS error: &#123;0&#125;".format(err))except ValueError: print("Could not convert data to an integer.")except: print("Unexpected error:", sys.exc_info()[0]) raisefinally: # æ¸…ç†è¡Œä¸º æŠ›å‡ºå¼‚å¸¸ Python ä½¿ç”¨ raise è¯­å¥æŠ›å‡ºä¸€ä¸ªæŒ‡å®šçš„å¼‚å¸¸ã€‚ä¾‹å¦‚: &gt;&gt;&gt; raise NameError('HiThere')Traceback (most recent call last): File "&lt;stdin&gt;", line 1, in ?NameError: HiThere è‡ªå®šä¹‰å¼‚å¸¸ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„ exception ç±»æ¥æ‹¥æœ‰è‡ªå·±çš„å¼‚å¸¸ã€‚å¼‚å¸¸åº”è¯¥ç»§æ‰¿è‡ª Exception ç±»ï¼Œæˆ–è€…ç›´æŽ¥ç»§æ‰¿ï¼Œæˆ–è€…é—´æŽ¥ç»§æ‰¿ã€‚ å½“åˆ›å»ºä¸€ä¸ªæ¨¡å—æœ‰å¯èƒ½æŠ›å‡ºå¤šç§ä¸åŒçš„å¼‚å¸¸æ—¶ï¼Œä¸€ç§é€šå¸¸çš„åšæ³•æ˜¯ä¸ºè¿™ä¸ªåŒ…å»ºç«‹ä¸€ä¸ªåŸºç¡€å¼‚å¸¸ç±»ï¼Œç„¶åŽåŸºäºŽè¿™ä¸ªåŸºç¡€ç±»ä¸ºä¸åŒçš„é”™è¯¯æƒ…å†µåˆ›å»ºä¸åŒçš„å­ç±»ï¼š class Error(Exception): """Base class for exceptions in this module.""" passclass InputError(Error): """Exception raised for errors in the input. Attributes: expression -- input expression in which the error occurred message -- explanation of the error """ def __init__(self, expression, message): self.expression = expression self.message = messageclass TransitionError(Error): """Raised when an operation attempts a state transition that's not allowed. Attributes: previous -- state at beginning of transition next -- attempted new state message -- explanation of why the specific transition is not allowed """ def __init__(self, previous, next, message): self.previous = previous self.next = next self.message = message å¤§å¤šæ•°çš„å¼‚å¸¸çš„åå­—éƒ½ä»¥&quot;Error&quot;ç»“å°¾ï¼Œå°±è·Ÿæ ‡å‡†çš„å¼‚å¸¸å‘½åä¸€æ ·ã€‚ é¢å‘å¯¹è±¡ é¢å‘å¯¹è±¡æŠ€æœ¯ç®€ä»‹ ç±»(Class): ç”¨æ¥æè¿°å…·æœ‰ç›¸åŒçš„å±žæ€§å’Œæ–¹æ³•çš„å¯¹è±¡çš„é›†åˆã€‚å®ƒå®šä¹‰äº†è¯¥é›†åˆä¸­æ¯ä¸ªå¯¹è±¡æ‰€å…±æœ‰çš„å±žæ€§å’Œæ–¹æ³•ã€‚å¯¹è±¡æ˜¯ç±»çš„å®žä¾‹ã€‚ **ç±»å˜é‡ï¼š**ç±»å˜é‡åœ¨æ•´ä¸ªå®žä¾‹åŒ–çš„å¯¹è±¡ä¸­æ˜¯å…¬ç”¨çš„ã€‚ç±»å˜é‡å®šä¹‰åœ¨ç±»ä¸­ä¸”åœ¨å‡½æ•°ä½“ä¹‹å¤–ã€‚ç±»å˜é‡é€šå¸¸ä¸ä½œä¸ºå®žä¾‹å˜é‡ä½¿ç”¨ã€‚ **æ•°æ®æˆå‘˜ï¼š**ç±»å˜é‡æˆ–è€…å®žä¾‹å˜é‡ç”¨äºŽå¤„ç†ç±»åŠå…¶å®žä¾‹å¯¹è±¡çš„ç›¸å…³çš„æ•°æ®ã€‚ **æ–¹æ³•é‡å†™ï¼š**å¦‚æžœä»Žçˆ¶ç±»ç»§æ‰¿çš„æ–¹æ³•ä¸èƒ½æ»¡è¶³å­ç±»çš„éœ€æ±‚ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œæ”¹å†™ï¼Œè¿™ä¸ªè¿‡ç¨‹å«æ–¹æ³•çš„è¦†ç›–ï¼ˆoverrideï¼‰ï¼Œä¹Ÿç§°ä¸ºæ–¹æ³•çš„é‡å†™ã€‚ **å®žä¾‹å˜é‡ï¼š**å®šä¹‰åœ¨æ–¹æ³•ä¸­çš„å˜é‡ï¼Œåªä½œç”¨äºŽå½“å‰å®žä¾‹çš„ç±»ã€‚ **ç»§æ‰¿ï¼š**å³ä¸€ä¸ªæ´¾ç”Ÿç±»ï¼ˆderived classï¼‰ç»§æ‰¿åŸºç±»ï¼ˆbase classï¼‰çš„å­—æ®µå’Œæ–¹æ³•ã€‚ç»§æ‰¿ä¹Ÿå…è®¸æŠŠä¸€ä¸ªæ´¾ç”Ÿç±»çš„å¯¹è±¡ä½œä¸ºä¸€ä¸ªåŸºç±»å¯¹è±¡å¯¹å¾…ã€‚ä¾‹å¦‚ï¼Œæœ‰è¿™æ ·ä¸€ä¸ªè®¾è®¡ï¼šä¸€ä¸ª Dog ç±»åž‹çš„å¯¹è±¡æ´¾ç”Ÿè‡ª Animal ç±»ï¼Œè¿™æ˜¯æ¨¡æ‹Ÿ&quot;æ˜¯ä¸€ä¸ªï¼ˆis-aï¼‰&quot;å…³ç³»ï¼ˆä¾‹å›¾ï¼ŒDog æ˜¯ä¸€ä¸ª Animalï¼‰ã€‚ **å®žä¾‹åŒ–ï¼š**åˆ›å»ºä¸€ä¸ªç±»çš„å®žä¾‹ï¼Œç±»çš„å…·ä½“å¯¹è±¡ã€‚ **æ–¹æ³•ï¼š**ç±»ä¸­å®šä¹‰çš„å‡½æ•°ã€‚ **å¯¹è±¡ï¼š**é€šè¿‡ç±»å®šä¹‰çš„æ•°æ®ç»“æž„å®žä¾‹ã€‚å¯¹è±¡åŒ…æ‹¬ä¸¤ä¸ªæ•°æ®æˆå‘˜ï¼ˆç±»å˜é‡å’Œå®žä¾‹å˜é‡ï¼‰å’Œæ–¹æ³•ã€‚ ç±»å®šä¹‰ è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š class ClassName: &lt;statement-1&gt; . . . &lt;statement-N&gt; ç±»å®žä¾‹åŒ–åŽï¼Œå¯ä»¥ä½¿ç”¨å…¶å±žæ€§ï¼Œå®žé™…ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªç±»ä¹‹åŽï¼Œå¯ä»¥é€šè¿‡ç±»åè®¿é—®å…¶å±žæ€§ã€‚ ç±»å¯¹è±¡ ç±»å¯¹è±¡æ”¯æŒä¸¤ç§æ“ä½œï¼šå±žæ€§å¼•ç”¨å’Œå®žä¾‹åŒ–ã€‚ å±žæ€§å¼•ç”¨ä½¿ç”¨å’Œ Python ä¸­æ‰€æœ‰çš„å±žæ€§å¼•ç”¨ä¸€æ ·çš„æ ‡å‡†è¯­æ³•ï¼šobj.nameã€‚ ç±»å¯¹è±¡åˆ›å»ºåŽï¼Œç±»å‘½åç©ºé—´ä¸­æ‰€æœ‰çš„å‘½åéƒ½æ˜¯æœ‰æ•ˆå±žæ€§åã€‚æ‰€ä»¥å¦‚æžœç±»å®šä¹‰æ˜¯è¿™æ ·: #!/usr/bin/python3class MyClass: """ä¸€ä¸ªç®€å•çš„ç±»å®žä¾‹""" i = 12345 def f(self): return 'hello world'# å®žä¾‹åŒ–ç±»x = MyClass()# è®¿é—®ç±»çš„å±žæ€§å’Œæ–¹æ³•print("MyClass ç±»çš„å±žæ€§ i ä¸ºï¼š", x.i)print("MyClass ç±»çš„æ–¹æ³• f è¾“å‡ºä¸ºï¼š", x.f()) å®žä¾‹åŒ–ç±»ï¼š # å®žä¾‹åŒ–ç±»x = MyClass()# è®¿é—®ç±»çš„å±žæ€§å’Œæ–¹æ³• ä»¥ä¸Šåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±»å®žä¾‹å¹¶å°†è¯¥å¯¹è±¡èµ‹ç»™å±€éƒ¨å˜é‡ xï¼Œx ä¸ºç©ºçš„å¯¹è±¡ã€‚ æ‰§è¡Œä»¥ä¸Šç¨‹åºè¾“å‡ºç»“æžœä¸ºï¼š MyClass ç±»çš„å±žæ€§ i ä¸ºï¼š 12345MyClass ç±»çš„æ–¹æ³• f è¾“å‡ºä¸ºï¼š hello world å¾ˆå¤šç±»éƒ½å€¾å‘äºŽå°†å¯¹è±¡åˆ›å»ºä¸ºæœ‰åˆå§‹çŠ¶æ€çš„ã€‚å› æ­¤ç±»å¯èƒ½ä¼šå®šä¹‰ä¸€ä¸ªåä¸º init() çš„ç‰¹æ®Šæ–¹æ³•ï¼ˆæž„é€ æ–¹æ³•ï¼‰ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š def __init__(self): self.data = [] ç±»å®šä¹‰äº† init() æ–¹æ³•çš„è¯ï¼Œç±»çš„å®žä¾‹åŒ–æ“ä½œä¼šè‡ªåŠ¨è°ƒç”¨ init() æ–¹æ³•ã€‚æ‰€ä»¥åœ¨ä¸‹ä¾‹ä¸­ï¼Œå¯ä»¥è¿™æ ·åˆ›å»ºä¸€ä¸ªæ–°çš„å®žä¾‹: x = MyClass() å½“ç„¶ï¼Œ init() æ–¹æ³•å¯ä»¥æœ‰å‚æ•°ï¼Œå‚æ•°é€šè¿‡ init() ä¼ é€’åˆ°ç±»çš„å®žä¾‹åŒ–æ“ä½œä¸Šã€‚ä¾‹å¦‚: &gt;&gt;&gt; class Complex:... def __init__(self, realpart, imagpart):... self.r = realpart... self.i = imagpart...&gt;&gt;&gt; x = Complex(3.0, -4.5)&gt;&gt;&gt; x.r, x.i(3.0, -4.5) ç±»çš„æ–¹æ³• åœ¨ç±»åœ°å†…éƒ¨ï¼Œä½¿ç”¨ def å…³é”®å­—å¯ä»¥ä¸ºç±»å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œä¸Žä¸€èˆ¬å‡½æ•°å®šä¹‰ä¸åŒï¼Œç±»æ–¹æ³•å¿…é¡»åŒ…å«å‚æ•° self,ä¸”ä¸ºç¬¬ä¸€ä¸ªå‚æ•°: #!/usr/bin/python3#ç±»å®šä¹‰class people: #å®šä¹‰åŸºæœ¬å±žæ€§ name = '' age = 0 #å®šä¹‰ç§æœ‰å±žæ€§,ç§æœ‰å±žæ€§åœ¨ç±»å¤–éƒ¨æ— æ³•ç›´æŽ¥è¿›è¡Œè®¿é—® __weight = 0 #å®šä¹‰æž„é€ æ–¹æ³• def __init__(self,n,a,w): self.name = n self.age = a self.__weight = w def speak(self): print("%s è¯´: æˆ‘ %d å²ã€‚" %(self.name,self.age))# å®žä¾‹åŒ–ç±»p = people('W3Cschool',10,30)p.speak() æ‰§è¡Œä»¥ä¸Šç¨‹åºè¾“å‡ºç»“æžœä¸ºï¼š W3Cschool è¯´: æˆ‘ 10 å²ã€‚ ç»§æ‰¿ Python åŒæ ·æ”¯æŒç±»çš„ç»§æ‰¿ï¼Œå¦‚æžœä¸€ç§è¯­è¨€ä¸æ”¯æŒç»§æ‰¿å°±ï¼Œç±»å°±æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚æ´¾ç”Ÿç±»çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤º: class DerivedClassName(BaseClassName1): &lt;statement-1&gt; . . . &lt;statement-N&gt; éœ€è¦æ³¨æ„åœ†æ‹¬å·ä¸­åŸºç±»çš„é¡ºåºï¼Œè‹¥æ˜¯åŸºç±»ä¸­æœ‰ç›¸åŒçš„æ–¹æ³•åï¼Œè€Œåœ¨å­ç±»ä½¿ç”¨æ—¶æœªæŒ‡å®šï¼Œpython ä»Žå·¦è‡³å³æœç´¢ å³æ–¹æ³•åœ¨å­ç±»ä¸­æœªæ‰¾åˆ°æ—¶ï¼Œä»Žå·¦åˆ°å³æŸ¥æ‰¾åŸºç±»ä¸­æ˜¯å¦åŒ…å«æ–¹æ³•ã€‚ BaseClassNameï¼ˆç¤ºä¾‹ä¸­çš„åŸºç±»åï¼‰å¿…é¡»ä¸Žæ´¾ç”Ÿç±»å®šä¹‰åœ¨ä¸€ä¸ªä½œç”¨åŸŸå†…ã€‚é™¤äº†ç±»ï¼Œè¿˜å¯ä»¥ç”¨è¡¨è¾¾å¼ï¼ŒåŸºç±»å®šä¹‰åœ¨å¦ä¸€ä¸ªæ¨¡å—ä¸­æ—¶è¿™ä¸€ç‚¹éžå¸¸æœ‰ç”¨: class DerivedClassName(modname.BaseClassName): å®žä¾‹ #!/usr/bin/python3#ç±»å®šä¹‰class people: #å®šä¹‰åŸºæœ¬å±žæ€§ name = '' age = 0 #å®šä¹‰ç§æœ‰å±žæ€§,ç§æœ‰å±žæ€§åœ¨ç±»å¤–éƒ¨æ— æ³•ç›´æŽ¥è¿›è¡Œè®¿é—® __weight = 0 #å®šä¹‰æž„é€ æ–¹æ³• def __init__(self,n,a,w): self.name = n self.age = a self.__weight = w def speak(self): print("%s è¯´: æˆ‘ %d å²ã€‚" %(self.name,self.age))#å•ç»§æ‰¿ç¤ºä¾‹class student(people): grade = '' def __init__(self,n,a,w,g): #è°ƒç”¨çˆ¶ç±»çš„æž„å‡½ people.__init__(self,n,a,w) self.grade = g #è¦†å†™çˆ¶ç±»çš„æ–¹æ³• def speak(self): print("%s è¯´: æˆ‘ %d å²äº†ï¼Œæˆ‘åœ¨è¯» %d å¹´çº§"%(self.name,self.age,self.grade))s = student('ken',10,60,3)s.speak() æ‰§è¡Œä»¥ä¸Šç¨‹åºè¾“å‡ºç»“æžœä¸ºï¼š ken è¯´: æˆ‘ 10 å²äº†ï¼Œæˆ‘åœ¨è¯» 3 å¹´çº§ å¤šç»§æ‰¿ Python åŒæ ·æœ‰é™çš„æ”¯æŒå¤šç»§æ‰¿å½¢å¼ã€‚å¤šç»§æ‰¿çš„ç±»å®šä¹‰å½¢å¦‚ä¸‹ä¾‹: class DerivedClassName(Base1, Base2, Base3): &lt;statement-1&gt; . . . &lt;statement-N&gt; éœ€è¦æ³¨æ„åœ†æ‹¬å·ä¸­çˆ¶ç±»çš„é¡ºåºï¼Œè‹¥æ˜¯çˆ¶ç±»ä¸­æœ‰ç›¸åŒçš„æ–¹æ³•åï¼Œè€Œåœ¨å­ç±»ä½¿ç”¨æ—¶æœªæŒ‡å®šï¼Œpython ä»Žå·¦è‡³å³æœç´¢ å³æ–¹æ³•åœ¨å­ç±»ä¸­æœªæ‰¾åˆ°æ—¶ï¼Œä»Žå·¦åˆ°å³æŸ¥æ‰¾çˆ¶ç±»ä¸­æ˜¯å¦åŒ…å«æ–¹æ³•ã€‚ #!/usr/bin/python3#ç±»å®šä¹‰class people: #å®šä¹‰åŸºæœ¬å±žæ€§ name = '' age = 0 #å®šä¹‰ç§æœ‰å±žæ€§,ç§æœ‰å±žæ€§åœ¨ç±»å¤–éƒ¨æ— æ³•ç›´æŽ¥è¿›è¡Œè®¿é—® __weight = 0 #å®šä¹‰æž„é€ æ–¹æ³• def __init__(self,n,a,w): self.name = n self.age = a self.__weight = w def speak(self): print("%s è¯´: æˆ‘ %d å²ã€‚" %(self.name,self.age))#å•ç»§æ‰¿ç¤ºä¾‹class student(people): grade = '' def __init__(self,n,a,w,g): #è°ƒç”¨çˆ¶ç±»çš„æž„å‡½ people.__init__(self,n,a,w) self.grade = g #è¦†å†™çˆ¶ç±»çš„æ–¹æ³• def speak(self): print("%s è¯´: æˆ‘ %d å²äº†ï¼Œæˆ‘åœ¨è¯» %d å¹´çº§"%(self.name,self.age,self.grade))#å¦ä¸€ä¸ªç±»ï¼Œå¤šé‡ç»§æ‰¿ä¹‹å‰çš„å‡†å¤‡class speaker(): topic = '' name = '' def __init__(self,n,t): self.name = n self.topic = t def speak(self): print("æˆ‘å« %sï¼Œæˆ‘æ˜¯ä¸€ä¸ªæ¼”è¯´å®¶ï¼Œæˆ‘æ¼”è®²çš„ä¸»é¢˜æ˜¯ %s"%(self.name,self.topic))#å¤šé‡ç»§æ‰¿class sample(speaker,student): a ='' def __init__(self,n,a,w,g,t): student.__init__(self,n,a,w,g) speaker.__init__(self,n,t)test = sample("Tim",25,80,4,"Python")test.speak() #æ–¹æ³•ååŒï¼Œé»˜è®¤è°ƒç”¨çš„æ˜¯åœ¨æ‹¬å·ä¸­æŽ’å‰åœ°çˆ¶ç±»çš„æ–¹æ³• æ‰§è¡Œä»¥ä¸Šç¨‹åºè¾“å‡ºç»“æžœä¸ºï¼š æˆ‘å« Timï¼Œæˆ‘æ˜¯ä¸€ä¸ªæ¼”è¯´å®¶ï¼Œæˆ‘æ¼”è®²çš„ä¸»é¢˜æ˜¯ Python æ–¹æ³•é‡å†™ å¦‚æžœä½ çš„çˆ¶ç±»æ–¹æ³•çš„åŠŸèƒ½ä¸èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä½ å¯ä»¥åœ¨å­ç±»é‡å†™ä½ çˆ¶ç±»çš„æ–¹æ³•ï¼Œå®žä¾‹å¦‚ä¸‹ï¼š #!/usr/bin/python3class Parent: # å®šä¹‰çˆ¶ç±» def myMethod(self): print ('è°ƒç”¨çˆ¶ç±»æ–¹æ³•')class Child(Parent): # å®šä¹‰å­ç±» def myMethod(self): print ('è°ƒç”¨å­ç±»æ–¹æ³•')c = Child() # å­ç±»å®žä¾‹c.myMethod() # å­ç±»è°ƒç”¨é‡å†™æ–¹æ³• æ‰§è¡Œä»¥ä¸Šç¨‹åºè¾“å‡ºç»“æžœä¸ºï¼š è°ƒç”¨å­ç±»æ–¹æ³• ç±»å±žæ€§ä¸Žæ–¹æ³• ç±»çš„ç§æœ‰å±žæ€§ __private_attrsï¼šä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼Œå£°æ˜Žè¯¥å±žæ€§ä¸ºç§æœ‰ï¼Œä¸èƒ½åœ¨ç±»åœ°å¤–éƒ¨è¢«ä½¿ç”¨æˆ–ç›´æŽ¥è®¿é—®ã€‚åœ¨ç±»å†…éƒ¨çš„æ–¹æ³•ä¸­ä½¿ç”¨æ—¶self.__private_attrsã€‚ ç±»çš„æ–¹æ³• åœ¨ç±»åœ°å†…éƒ¨ï¼Œä½¿ç”¨ def å…³é”®å­—å¯ä»¥ä¸ºç±»å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œä¸Žä¸€èˆ¬å‡½æ•°å®šä¹‰ä¸åŒï¼Œç±»æ–¹æ³•å¿…é¡»åŒ…å«å‚æ•° self,ä¸”ä¸ºç¬¬ä¸€ä¸ªå‚æ•° ç±»çš„ç§æœ‰æ–¹æ³• __private_methodï¼šä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼Œå£°æ˜Žè¯¥æ–¹æ³•ä¸ºç§æœ‰æ–¹æ³•ï¼Œä¸èƒ½åœ¨ç±»åœ°å¤–éƒ¨è°ƒç”¨ã€‚åœ¨ç±»çš„å†…éƒ¨è°ƒç”¨ slef.__private_methodsã€‚ å®žä¾‹å¦‚ä¸‹ï¼š #!/usr/bin/python3class JustCounter: __secretCount = 0 # ç§æœ‰å˜é‡ publicCount = 0 # å…¬å¼€å˜é‡ def count(self): self.__secretCount += 1 self.publicCount += 1 print (self.__secretCount)counter = JustCounter()counter.count()counter.count()print (counter.publicCount)print (counter.__secretCount) # æŠ¥é”™ï¼Œå®žä¾‹ä¸èƒ½è®¿é—®ç§æœ‰å˜é‡ æ‰§è¡Œä»¥ä¸Šç¨‹åºè¾“å‡ºç»“æžœä¸ºï¼š 122Traceback (most recent call last): File "test.py", line 16, in &lt;module&gt; print (counter.__secretCount) # æŠ¥é”™ï¼Œå®žä¾‹ä¸èƒ½è®¿é—®ç§æœ‰å˜é‡AttributeError: 'JustCounter' object has no attribute '__secretCount' ç±»çš„ä¸“æœ‰æ–¹æ³•ï¼š **init ðŸ˜—* æž„é€ å‡½æ•°ï¼Œåœ¨ç”Ÿæˆå¯¹è±¡æ—¶è°ƒç”¨ **del ðŸ˜—* æžæž„å‡½æ•°ï¼Œé‡Šæ”¾å¯¹è±¡æ—¶ä½¿ç”¨ **repr ðŸ˜—* æ‰“å°ï¼Œè½¬æ¢ **setitem ðŸ˜—* æŒ‰ç…§ç´¢å¼•èµ‹å€¼ **getitemðŸ˜—* æŒ‰ç…§ç´¢å¼•èŽ·å–å€¼ **lenðŸ˜—* èŽ·å¾—é•¿åº¦ **cmpðŸ˜—* æ¯”è¾ƒè¿ç®— **callðŸ˜—* å‡½æ•°è°ƒç”¨ **addðŸ˜—* åŠ è¿ç®— **subðŸ˜—* å‡è¿ç®— **mulðŸ˜—* ä¹˜è¿ç®— **divðŸ˜—* é™¤è¿ç®— **modðŸ˜—* æ±‚ä½™è¿ç®— **powðŸ˜—* ä¹˜æ–¹ è¿ç®—ç¬¦é‡è½½ Python åŒæ ·æ”¯æŒè¿ç®—ç¬¦é‡è½½ï¼Œæˆ‘ä¹ˆå¯ä»¥å¯¹ç±»çš„ä¸“æœ‰æ–¹æ³•è¿›è¡Œé‡è½½ï¼Œå®žä¾‹å¦‚ä¸‹ï¼š #!/usr/bin/python3class Vector: def __init__(self, a, b): self.a = a self.b = b def __str__(self): return 'Vector (%d, %d)' % (self.a, self.b) def __add__(self,other): return Vector(self.a + other.a, self.b + other.b)v1 = Vector(2,10)v2 = Vector(5,-2)print (v1 + v2) ä»¥ä¸Šä»£ç æ‰§è¡Œç»“æžœå¦‚ä¸‹æ‰€ç¤º: Vector(7,8) æ ‡å‡†åº“æ¦‚è§ˆ æ“ä½œç³»ç»ŸæŽ¥å£ os æ¨¡å—æä¾›äº†ä¸å°‘ä¸Žæ“ä½œç³»ç»Ÿç›¸å…³è”çš„å‡½æ•°ã€‚ &gt;&gt;&gt; import os&gt;&gt;&gt; os.getcwd() # è¿”å›žå½“å‰çš„å·¥ä½œç›®å½•'C:\\Python34'&gt;&gt;&gt; os.chdir('/server/accesslogs') # ä¿®æ”¹å½“å‰çš„å·¥ä½œç›®å½•&gt;&gt;&gt; os.system('mkdir today') # æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ mkdir0 æ–‡ä»¶é€šé…ç¬¦ glob æ¨¡å—æä¾›äº†ä¸€ä¸ªå‡½æ•°ç”¨äºŽä»Žç›®å½•é€šé…ç¬¦æœç´¢ä¸­ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨: &gt;&gt;&gt; import glob&gt;&gt;&gt; glob.glob('*.py')['primes.py', 'random.py', 'quote.py'] å‘½ä»¤è¡Œå‚æ•° é€šç”¨å·¥å…·è„šæœ¬ç»å¸¸è°ƒç”¨å‘½ä»¤è¡Œå‚æ•°ã€‚è¿™äº›å‘½ä»¤è¡Œå‚æ•°ä»¥é“¾è¡¨å½¢å¼å­˜å‚¨äºŽ sys æ¨¡å—çš„ argv å˜é‡ã€‚ä¾‹å¦‚åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ python demo.py one two three åŽå¯ä»¥å¾—åˆ°ä»¥ä¸‹è¾“å‡ºç»“æžœ: &gt;&gt;&gt; import sys&gt;&gt;&gt; print(sys.argv)['demo.py', 'one', 'two', 'three'] é”™è¯¯è¾“å‡ºé‡å®šå‘å’Œç¨‹åºç»ˆæ­¢ sys è¿˜æœ‰ stdinï¼Œstdout å’Œ stderr å±žæ€§ï¼Œå³ä½¿åœ¨ stdout è¢«é‡å®šå‘æ—¶ï¼ŒåŽè€…ä¹Ÿå¯ä»¥ç”¨äºŽæ˜¾ç¤ºè­¦å‘Šå’Œé”™è¯¯ä¿¡æ¯ã€‚ &gt;&gt;&gt; sys.stderr.write('Warning, log file not found starting a new one\n')Warning, log file not found starting a new one å­—ç¬¦ä¸²æ­£åˆ™åŒ¹é… re æ¨¡å—ä¸ºé«˜çº§å­—ç¬¦ä¸²å¤„ç†æä¾›äº†æ­£åˆ™è¡¨è¾¾å¼å·¥å…·ã€‚å¯¹äºŽå¤æ‚çš„åŒ¹é…å’Œå¤„ç†ï¼Œæ­£åˆ™è¡¨è¾¾å¼æä¾›äº†ç®€æ´ã€ä¼˜åŒ–çš„è§£å†³æ–¹æ¡ˆ: &gt;&gt;&gt; import re&gt;&gt;&gt; re.findall(r'\bf[a-z]*', 'which foot or hand fell fastest')['foot', 'fell', 'fastest']&gt;&gt;&gt; re.sub(r'(\b[a-z]+) \1', r'\1', 'cat in the the hat')'cat in the hat' æ•°å­¦ math æ¨¡å—ä¸ºæµ®ç‚¹è¿ç®—æä¾›äº†å¯¹åº•å±‚ C å‡½æ•°åº“çš„è®¿é—®: &gt;&gt;&gt; import math&gt;&gt;&gt; math.cos(math.pi / 4)0.70710678118654757&gt;&gt;&gt; math.log(1024, 2)10.0 èµ„æ–™ https://github.com/vinta/awesome-python - èµ„æºå¤§å…¨ https://github.com/jobbole/awesome-python-cn - èµ„æºå¤§å…¨ https://github.com/scrapy/scrapy - python çˆ¬è™«æ¡†æž¶ https://github.com/faif/python-patterns - python è®¾è®¡æ¨¡å¼ https://github.com/kennethreitz/python-guide - python æœ€ä½³å®žè·µ]]></content>
      <categories>
        <category>programming</category>
      </categories>
      <tags>
        <tag>programming</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€]]></title>
    <url>%2Fblog%2F2018%2F01%2F05%2Fprogramming%2Fprogramming-guide%2F</url>
    <content type="text"><![CDATA[å¦‚ä½•å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ å‰è¨€ å­¦ä¹ ç¼–ç¨‹è¯­è¨€çš„æ­¥éª¤ åŸºæœ¬è¯­æ³• æ•°ç»„ã€æžšä¸¾ã€é›†åˆ å¸¸ç”¨ç±» è¯­è¨€ç‰¹æ€§ ä»£ç ç»„ç»‡ã€æ¨¡å—åŠ è½½ã€åº“ç®¡ç† å®¹é”™å¤„ç† è¾“å…¥è¾“å‡ºå’Œæ–‡ä»¶å¤„ç† å›žè°ƒæœºåˆ¶ åºåˆ—åŒ–å’Œååºåˆ—åŒ– è¿›é˜¶ç‰¹æ€§ åº“å’Œæ¡†æž¶ å°ç»“ å‰è¨€ å¾ˆå¤šäººå–œæ¬¢äº‰è®ºä»€ä¹ˆä»€ä¹ˆç¼–ç¨‹è¯­è¨€å¥½ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªè¯é¢˜å¦‚æžœä¸é™å®šåº”ç”¨èŒƒå›´ï¼Œå°±æ¯«æ— æ„ä¹‰ã€‚ æ¯ç§ç¼–ç¨‹è¯­è¨€å¿…ç„¶æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œè¿™ä¹Ÿå†³å®šäº†å®ƒæœ‰é€‚åˆçš„åº”ç”¨åœºæ™¯å’Œä¸é€‚åˆçš„åº”ç”¨åœºæ™¯ã€‚çŽ°ä»£è½¯ä»¶è¡Œä¸šï¼Œæƒ³ä¸€é—¨ç¼–ç¨‹è¯­è¨€åŒ…æ‰“å¤©ä¸‹æ˜¯ä¸çŽ°å®žçš„ã€‚è¿™ä¸­çŽ°çŠ¶ä¹Ÿé€ æˆäº†ä¸€ç§çŽ°è±¡ï¼Œä¸€ä¸ªç¨‹åºå‘˜å¾€å¾€è¦æŽŒæ¡å¤šç§ç¼–ç¨‹è¯­è¨€ã€‚ å­¦ä¹ ä»»ä½•ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œéƒ½ä¼šé¢ä¸´çš„ç¬¬ä¸€ä¸ªé—®é¢˜éƒ½æ˜¯ï¼šå¦‚ä½•å­¦ä¹  XX è¯­è¨€ï¼Ÿ æˆ‘ä¸æƒ³è¯´ä»€ä¹ˆå¤šçœ‹ã€å¤šå­¦ã€å¤šå†™ã€å¤šç»ƒä¹‹ç±»çš„åºŸè¯ã€‚ä¸–ä¸Šäº‹æœ‰éš¾æ˜“ä¹Žï¼Ÿæ— ä»–ï¼Œå”¯æ‰‹ç†Ÿå°”ã€‚è°ä¸çŸ¥é“ç†Ÿèƒ½ç”Ÿå·§çš„é“ç†ï¼Ÿ æˆ‘è§‰å¾—æœ‰å¿…è¦è°ˆè°ˆçš„æ˜¯ï¼šå¦‚ä½•ç”±æµ…å…¥æ·±çš„å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Ÿå­¦ä¹ æ‰€æœ‰ç¼–ç¨‹è¯­è¨€æœ‰æ²¡æœ‰ä¸€ä¸ªç›¸å¯¹ç»Ÿä¸€çš„å­¦ä¹ æ–¹æ³•ï¼Ÿ æ›¾å‡ ä½•æ—¶ï¼Œå½“æˆ‘è¿˜æ˜¯ä¸€åå°èœé¸Ÿæ—¶ï¼Œæ€»æ˜¯å¹æœé‚£äº›å¤§ç¥žæŽŒæ¡å¤šé—¨ç¼–ç¨‹è¯­è¨€ã€‚åŽæ¥ï¼Œåœ¨å¤šå¹´ç¼–ç¨‹å·¥ä½œå’Œå­¦ä¹ ä¸­ï¼Œæˆ‘é™†é™†ç»­ç»­ä¹ŸæŽ¥è§¦è¿‡ä¸å°‘ç¼–ç¨‹è¯­è¨€ï¼šCã€C++ã€Javaã€C#ã€Javascriptã€shell ç­‰ç­‰ã€‚æ¯æ¬¡å­¦ä¹ ä¸€é—¨æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼ŒæŽŒæ¡ç¨‹åº¦æˆ–æ·±æˆ–æµ…ï¼Œä½†æ˜¯å­¦ä¹ çš„æ›²çº¿å´å¤§æŠµç›¸ä¼¼ã€‚ ä¸‹é¢ï¼Œæˆ‘æŒ‰ç…§ä¸ªäººçš„å­¦ä¹ ç»éªŒæ€»ç»“ä¸€ä¸‹ï¼Œå­¦ä¹ ç¼–ç¨‹è¯­è¨€çš„åŸºæœ¬æ­¥éª¤ã€‚ å­¦ä¹ ç¼–ç¨‹è¯­è¨€çš„æ­¥éª¤ åŸºæœ¬è¯­æ³• é¦–å…ˆå½“ç„¶æ˜¯äº†è§£è¯­è¨€çš„æœ€åŸºæœ¬è¯­æ³•ã€‚ æŽ§åˆ¶å°è¾“å‡ºï¼Œå¦‚ C çš„ printfï¼ŒJava çš„ System.out.println ç­‰ã€‚ æ™®é€šç¨‹åºå‘˜çš„ç¬¬ä¸€è¡Œä»£ç ä¸€èˆ¬éƒ½æ˜¯è¾“å‡º â€œHello Worldâ€ å§ã€‚ åŸºæœ¬æ•°æ®ç±»åž‹ ä¸åŒç¼–ç¨‹è¯­è¨€çš„åŸºæœ¬æ•°æ®ç±»åž‹ä¸åŒã€‚åŸºæœ¬æ•°æ®ç±»åž‹æ˜¯çš„ç”³è¯·å†…å­˜ç©ºé—´å˜å¾—æ–¹ä¾¿ã€è§„èŒƒåŒ–ã€‚ å˜é‡ ä¸åŒç¼–ç¨‹è¯­è¨€çš„å£°æ˜Žå˜é‡æ–¹å¼æœ‰å¾ˆå¤§ä¸åŒã€‚æœ‰çš„å¦‚ Java ã€C++ éœ€è¦æ˜Žç¡®æŒ‡å®šå˜é‡æ•°æ®ç±»åž‹ï¼Œè¿™ç§å«å¼ºç±»åž‹å®šä¹‰è¯­è¨€ã€‚æœ‰çš„è¯­è¨€ï¼ˆä¸»è¦æ˜¯è„šæœ¬è¯­è¨€ï¼‰ï¼Œå¦‚ Javascriptã€Shell ç­‰ï¼Œä¸éœ€è¦æ˜Žç¡®æŒ‡å®šæ•°æ®ç±»åž‹ï¼Œè¿™ç§å«å¼±ç±»åž‹å®šä¹‰è¯­è¨€ã€‚ è¿˜éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯å˜é‡çš„ä½œç”¨åŸŸèŒƒå›´å’Œç”Ÿå‘½å‘¨æœŸã€‚ä¸åŒè¯­è¨€å˜é‡çš„ä½œç”¨åŸŸèŒƒå›´å’Œç”Ÿå‘½å‘¨æœŸä¸ä¸€å®šä¸€æ ·ï¼Œè¿™ä¸ªéœ€è¦åœ¨ä»£ç ä¸­ç»†ç»†ä½“ä¼šï¼Œæœ‰æ—¶ä¼šä¸ºæ­¤åŸ‹é›·ã€‚ é€»è¾‘æŽ§åˆ¶è¯­å¥ ç¼–ç¨‹è¯­è¨€éƒ½ä¼šæœ‰é€»è¾‘æŽ§åˆ¶è¯­å¥ï¼Œå“ªæ€•æ˜¯æ±‡ç¼–è¯­è¨€ã€‚ æŽŒæ¡æ¡ä»¶è¯­å¥ã€å¾ªçŽ¯è¯­å¥ã€ä¸­æ–­å¾ªçŽ¯è¯­å¥ï¼ˆbreakã€continueï¼‰ã€é€‰æ‹©è¯­å¥ã€‚ä¸€èˆ¬åŒºåˆ«ä»…ä»…åœ¨äºŽå…³é”®å­—ã€è¯­æ³•æ ¼å¼ç•¥æœ‰ä¸åŒã€‚ è¿ç®—ç¬¦ æŽŒæ¡åŸºæœ¬è¿ç®—ç¬¦ï¼Œå¦‚ç®—æœ¯è¿ç®—ç¬¦ã€å…³ç³»è¿ç®—ç¬¦ã€é€»è¾‘è¿ç®—ç¬¦ã€èµ‹å€¼è¿ç®—ç¬¦ç­‰ã€‚ æœ‰äº›è¯­è¨€è¿˜æä¾›ä½è¿ç®—ç¬¦ã€ç‰¹æ®Šè¿ç®—ç¬¦ï¼Œè§†æƒ…èŠ‚æŽŒæ¡ã€‚ æ³¨é‡Šï¼ˆæ²¡å•¥å¥½è¯´çš„ï¼‰ å‡½æ•° ç¼–ç¨‹è¯­è¨€åŸºæœ¬éƒ½æœ‰å‡½æ•°ã€‚æ³¨æ„è¯­æ³•æ ¼å¼ï¼šæ˜¯å¦æ”¯æŒå‡ºå‚ï¼›æ”¯æŒå“ªäº›æ•°æ®ä½œä¸ºå…¥å‚ï¼Œæœ‰äº›è¯­è¨€å…è®¸å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªå‚æ•°ï¼ˆå³å›žè°ƒï¼‰ï¼›è¿”å›žå€¼ï¼›å¦‚ä½•é€€å‡ºå‡½æ•°ï¼ˆå¦‚ Javaã€C++çš„ returnï¼Œï¼‰ã€‚ æ•°ç»„ã€æžšä¸¾ã€é›†åˆ æžšä¸¾åªæœ‰éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€æœ‰ï¼Œå¦‚ Javaã€C++ã€C#ã€‚ ä½†æ˜¯æ•°ç»„å’Œé›†åˆï¼ˆæœ‰äº›è¯­è¨€å«å®¹å™¨ï¼‰ä¸€èˆ¬ç¼–ç¨‹è¯­è¨€éƒ½æœ‰ï¼Œåªæ˜¯æœ‰çš„ç¼–ç¨‹è¯­è¨€æä¾›çš„é›†åˆæ¯”è¾ƒä¸°å¯Œã€‚ä½¿ç”¨æ–¹æ³•åŸºæœ¬ç±»ä¼¼ã€‚ å¸¸ç”¨ç±» æ¯”è¾ƒå¸¸ç”¨çš„ç±»ï¼ˆå½“ç„¶æœ‰äº›è¯­è¨€ä¸­ä¸å«ç±»ï¼Œå«å¯¹è±¡æˆ–è€…å…¶ä»–ä»€ä¹ˆï¼Œè¿™ä¸ªä¸é‡è¦ï¼Œé¢†ä¼šç²¾ç¥žï¼‰è¯·äº†è§£å…¶ API ç”¨æ³•ï¼Œå¦‚ï¼šå­—ç¬¦ä¸²ã€æ—¥æœŸã€æ•°å­¦è®¡ç®—ç­‰ç­‰ã€‚ è¯­è¨€ç‰¹æ€§ è¯­è¨€ç‰¹æ€§è¿™ä¸ªç‰¹å­—åæ˜ çš„å°±æ˜¯å„ä¸ªç¼–ç¨‹è¯­è¨€è‡ªèº«çš„&quot;ç‹¬ç‰¹ä¸ªæ€§&quot;ï¼Œè¿™æ¶‰åŠçš„ç‚¹æ¯”è¾ƒå¤šï¼Œç®€å•åˆ—ä¸¾ä¸€äº›ã€‚ ç¼–ç¨‹æ¨¡å¼ æ¯”è¾ƒæµè¡Œçš„ç¼–ç¨‹æ¨¡å¼å¤§æ¦‚æœ‰ï¼š é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œä¸»è¦æ˜¯å°è£…ã€ç»§æ‰¿ã€å¤šæ€ï¼›å‡½æ•°å¼ç¼–ç¨‹ï¼Œä¸»è¦æ˜¯åº”ç”¨ Lambdaï¼›è¿‡ç¨‹å¼ç¼–ç¨‹ï¼Œå¯ä»¥ç†è§£ä¸ºå®žçŽ°éœ€æ±‚åŠŸèƒ½çš„ç‰¹å®šæ­¥éª¤ã€‚ æ¯ç§ç¼–ç¨‹æ¨¡å¼éƒ½æœ‰ä¸€å®šçš„é“ç†ï¼Œæˆ‘ä»Žä¸è®¤ä¸ºåªæœ‰é¢å‘å¯¹è±¡ç¼–ç¨‹æ‰æ˜¯çŽ‹é“ã€‚ Java æ˜¯é¢å‘å¯¹è±¡è¯­è¨€ï¼Œä»Ž Java8 å¼€å§‹ä¹Ÿæ”¯æŒå‡½æ•°ç¼–ç¨‹ï¼ˆå¼•å…¥ Lambda è¡¨è¾¾å¼ï¼‰ï¼›C++ å¯ä»¥ç®—æ˜¯åŠé¢å‘å¯¹è±¡ï¼ŒåŠé¢å‘è¿‡ç¨‹å¼è¯­è¨€ã€‚ è¯­è¨€è‡ªèº«ç‰¹æ€§ æ¯ä¸ªè¯­è¨€è‡ªèº«éƒ½æœ‰ä¸€äº›é‡è¦ç‰¹æ€§éœ€è¦äº†è§£ã€‚ä¾‹å¦‚ï¼Œå­¦ä¹  Cã€C++ï¼Œä½ å¿…é¡»äº†è§£å†…å­˜çš„ç”³è¯·å’Œé‡Šæ”¾ï¼Œäº†è§£æŒ‡é’ˆã€å¼•ç”¨ã€‚è€Œå­¦ä¹  Javaï¼Œä½ éœ€è¦äº†è§£ JVMï¼Œåžƒåœ¾å›žæ”¶æœºåˆ¶ã€‚å­¦ä¹  Javascriptï¼Œä½ éœ€è¦äº†è§£ DOM æ“ä½œç­‰ã€‚ ä»£ç ç»„ç»‡ã€æ¨¡å—åŠ è½½ã€åº“ç®¡ç† ä¸€ä¸ªç¨‹åºä¸€èˆ¬éƒ½æœ‰å¾ˆå¤šä¸ªæºä»£ç æ–‡ä»¶ã€‚è¿™å°±ä¼šå¼•å…¥è¿™äº›é—®é¢˜ï¼šå¦‚ä½•å°†ä»£ç æ–‡ä»¶ç»„ç»‡èµ·æ¥ï¼Ÿå¦‚ä½•æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œé€‰æ‹©å°†éƒ¨åˆ†æ¨¡å—å¯åŠ¨æ—¶è¿›è¡ŒåŠ è½½ï¼Œéƒ¨åˆ†æ¨¡å—ä½¿ç”¨æ‡’åŠ è½½ï¼ˆæˆ–è€…çƒ­åŠ è½½ï¼‰ï¼Ÿ æœ€åŸºæœ¬çš„å¼•ç”¨æ–‡ä»¶å°±ä¸æäº†ï¼Œå¦‚ Cã€C++çš„#includeï¼ŒJava çš„ import ç­‰ã€‚ é’ˆå¯¹ä»£ç ç»„ç»‡ã€æ¨¡å—åŠ è½½ã€åº“ç®¡ç†è¿™äº›é—®é¢˜ï¼Œä¸åŒè¯­è¨€ä¼šæœ‰ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚ å¦‚ Java å¯ä»¥ç”¨ mavenã€gradle ç®¡ç†é¡¹ç›®ä¾èµ–ã€ç»„ç»‡ä»£ç ç»“æž„ï¼›Javascript ï¼ˆåŒ…æ‹¬ Nodejsã€jqueryã€react ç­‰ç­‰åº“ï¼‰å¯ä»¥ç”¨ npmã€yarn ç®¡ç†ä¾èµ–ï¼Œç”¨ webpack ç­‰å·¥å…·ç®¡ç†æ¨¡å—åŠ è½½ã€‚ å®¹é”™å¤„ç† ç¨‹åºæ€»éš¾å…ä¼šæœ‰ bugã€‚ æ‰€ä»¥ä¸ºäº†ä»£ç å¥å£®æ€§ä¹Ÿå¥½ï¼Œä¸ºäº†æ–¹ä¾¿å®šä½é—®é¢˜ä¹Ÿå¥½ï¼Œä»£ç ä¸­éœ€è¦æœ‰å®¹é”™å¤„ç†ã€‚å¸¸è§çš„æ‰‹æ®µæœ‰ï¼š å¼‚å¸¸ æ–­è¨€ æ—¥å¿— è°ƒè¯• å•å…ƒæµ‹è¯• è¾“å…¥è¾“å‡ºå’Œæ–‡ä»¶å¤„ç† è¿™å—çŸ¥è¯†æ¯”è¾ƒç¹æ‚ã€‚å»ºè®®æçº²æŒˆé¢†çš„å­¦ä¹ ä¸€ä¸‹ï¼Œç†è§£åŸºæœ¬æ¦‚å¿µï¼Œæ¯”å¦‚è¾“å…¥è¾“å‡ºæµã€ç®¡é“ç­‰ç­‰ã€‚è‡³äºŽ APIï¼Œç”¨åˆ°çš„æ—¶å€™å†æŸ¥ä¸€ä¸‹å³å¯ã€‚ å›žè°ƒæœºåˆ¶ æ¯ç§è¯­è¨€å®žçŽ°å›žè°ƒçš„æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œå¦‚ .Net çš„ delegate ï¼ˆå¤§é‡è¢«ç”¨äºŽ WinForm ç¨‹åºï¼‰ï¼›Javascript ä¸­å‡½æ•°å¤©ç„¶æ”¯æŒå›žè°ƒï¼šJavascript å‡½æ•°å…è®¸ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå…¥å‚ï¼Œç„¶åŽåœ¨æ–¹æ³•ä¸­è°ƒç”¨å®ƒã€‚å…¶å®ƒè¯­è¨€çš„å›žè°ƒæ–¹å¼ä¸ä¸€ä¸€åˆ—ä¸¾ã€‚ åºåˆ—åŒ–å’Œååºåˆ—åŒ– é¦–å…ˆéœ€è¦äº†è§£çš„æ˜¯ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ä½œç”¨æ˜¯ä¸ºäº†åœ¨ä¸åŒå¹³å°ä¹‹é—´ä¼ è¾“å¯¹è±¡ã€‚ å…¶æ¬¡ï¼Œè¦çŸ¥é“åºåˆ—åŒ–å­˜åœ¨å¤šç§æ–¹å¼ï¼Œä¸åŒç¼–ç¨‹è¯­è¨€å¯èƒ½æœ‰å¤šç§æ–¹æ¡ˆã€‚æ ¹æ®åº”ç”¨çš„åºåˆ—åŒ–æ–¹å¼ï¼Œé€‰æ‹©æ€§äº†è§£å³å¯ã€‚ è¿›é˜¶ç‰¹æ€§ ä»¥ä¸‹å­¦ä¹ å†…å®¹å±žäºŽè¿›é˜¶æ€§å†…å®¹ã€‚å¯ä»¥æ ¹æ®å¼€å‘éœ€è¦åŽ»å­¦ä¹ ã€æŽŒæ¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­¦ä¹ è¿™äº›ç‰¹æ€§çš„æ€åº¦åº”è¯¥æ˜¯ä¸å­¦åˆ™å·²ï¼Œå­¦åˆ™æ­»ç£•ã€‚å› ä¸ºåŠæ‡‚åŠä¸æ‡‚ï¼Œç‰¹åˆ«å®¹æ˜“å¼•å…¥é—®é¢˜ã€‚ å¯¹äºŽåŠæ¡¶æ°´çš„åŒå­¦ï¼Œæˆ‘æƒ³è¯´ï¼šæ”¾è¿‡è‡ªå·±ï¼Œä¹Ÿæ”¾è¿‡åˆ«äººï¼Œæ´»ç€ä¸å¥½å—ï¼Ÿ **å¹¶å‘ç¼–ç¨‹ï¼š**å¥½å¤„å¤šå¤šï¼Œååˆ†é‡è¦ï¼Œä½†æ˜¯å¹¶å‘ä»£ç å®¹æ˜“å‡ºé”™ï¼Œä¸”å‡ºé”™éš¾ä»¥å®šä½ã€‚è¦å­¦ä¹ è¿˜æ˜¯è¦èŠ±å¾ˆå¤§åŠ›æ°”çš„ï¼Œéœ€è¦äº†è§£å¤§é‡çŸ¥è¯†ï¼Œå¦‚ï¼šè¿›ç¨‹ã€çº¿ç¨‹ã€åŒæ­¥ã€å¼‚æ­¥ã€è¯»å†™é”ç­‰ç­‰ã€‚ åå°„ - è®©ä½ å¯ä»¥åŠ¨æ€ç¼–ç¨‹ï¼ˆæ…Žç”¨ï¼‰ã€‚ æ³›åž‹ - é›†åˆï¼ˆæˆ–è€…å«å®¹å™¨ï¼‰çš„åŸºçŸ³ã€‚ç²¾é€šæ³›åž‹ï¼Œèƒ½å¤§å¤§æé«˜ä½ çš„ä»£ç æ•ˆçŽ‡ã€‚ å…ƒæ•°æ® - æè¿°æ•°æ®çš„æ•°æ®ã€‚Java ä¸­å«åšæ³¨è§£ã€‚ åº“å’Œæ¡†æž¶ å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œéš¾å…éœ€è¦ç”¨åˆ°å›´ç»•å®ƒæž„å»ºçš„æŠ€æœ¯ç”Ÿæ€åœˆâ€”â€”åº“å’Œæ¡†æž¶ã€‚è¿™æ–¹é¢çŸ¥è¯†èŒƒå›´å¤ªåºžå¤§ï¼Œæ ¹æ®å®žé™…åº”ç”¨é¢†åŸŸåŽ»å­¦ä¹ å§ã€‚æ¯”å¦‚æž JavaWebï¼Œä½ å¤šå¤šå°‘å°‘è‚¯å®šè¦ç”¨åˆ° Springã€Mybatisã€Hibernateã€Shiro ç­‰å¤§é‡å¼€å‘æ¡†æž¶ï¼›å¦‚æžœåš Javascript å‰ç«¯ï¼Œä½ å¯èƒ½ä¼šç”¨åˆ° Reactã€Vueã€Angular ã€jQuery ç­‰åº“æˆ–æ¡†æž¶ã€‚ å°ç»“ æ€»ç»“ä»¥ä¸Šï¼Œç¼–ç¨‹è¯­è¨€å­¦ä¹ çš„é“è·¯æ˜¯ä»»é‡è€Œé“è¿œçš„ï¼Œæœªæ¥æ˜¯å…‰æ˜Žçš„ã€‚ æœ€åŽä¸€å¥è¯ä¸Žå›å…±å‹‰ï¼šè·¯æ¼«æ¼«å…®å…¶ä¿®è¿œï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚]]></content>
      <categories>
        <category>programming</category>
      </categories>
      <tags>
        <tag>programming</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Git ä»Žå…¥é—¨åˆ°ç²¾é€š]]></title>
    <url>%2Fblog%2F2017%2F12%2F09%2Ftools%2Fgit%2F</url>
    <content type="text"><![CDATA[Git ä»Žå…¥é—¨åˆ°ç²¾é€š ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ ç®€ä»‹ Git æ˜¯ä»€ä¹ˆï¼Ÿ ä»€ä¹ˆæ˜¯ç‰ˆæœ¬æŽ§åˆ¶ï¼Ÿ ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿï¼Ÿ ä¸ºä»€ä¹ˆä½¿ç”¨ Gitï¼Ÿ å®‰è£… é…ç½® ç”¨æˆ·ä¿¡æ¯ .gitignore åŽŸç† ç‰ˆæœ¬åº“ å“ˆå¸Œå€¼ æ–‡ä»¶çŠ¶æ€ å·¥ä½œåŒºåŸŸ å‘½ä»¤ åˆ›å»ºä»“åº“ æ·»åŠ ä¿®æ”¹ æ’¤é”€ä¿®æ”¹ æ›´æ–°ä¸ŽæŽ¨é€ æŸ¥çœ‹ä¿¡æ¯ åˆ†æ”¯ æ ‡ç­¾ åˆå¹¶ä¸Žé‡ç½® Github æœ€ä½³å®žè·µ Git Flow å¸¸è§é—®é¢˜ ç¼–è¾‘æäº¤(editting commits) æš‚å­˜(Staging) æœªæš‚å­˜(Unstaged)çš„å†…å®¹ åˆ†æ”¯(Branches) Rebasing å’Œåˆå¹¶(Merging) æ‚é¡¹(Miscellaneous Objects) è·Ÿè¸ªæ–‡ä»¶(Tracking Files) é…ç½®(Configuration) æˆ‘ä¸çŸ¥é“æˆ‘åšé”™äº†äº›ä»€ä¹ˆ å°ç»“ å‚è€ƒèµ„æ–™ ç®€ä»‹ Git æ˜¯ä»€ä¹ˆï¼Ÿ Git æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿã€‚ ä»€ä¹ˆæ˜¯ç‰ˆæœ¬æŽ§åˆ¶ï¼Ÿ ç‰ˆæœ¬æŽ§åˆ¶æ˜¯ä¸€ç§è®°å½•ä¸€ä¸ªæˆ–è‹¥å¹²æ–‡ä»¶å†…å®¹å˜åŒ–ï¼Œä»¥ä¾¿å°†æ¥æŸ¥é˜…ç‰¹å®šç‰ˆæœ¬ä¿®è®¢æƒ…å†µçš„ç³»ç»Ÿã€‚ ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿï¼Ÿ ä»‹ç»åˆ†å¸ƒå¼ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿå‰ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹ä¼ ç»Ÿçš„é›†ä¸­å¼ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿã€‚ é›†ä¸­åŒ–çš„ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿï¼Œè¯¸å¦‚ CVSï¼ŒSubversion ç­‰ï¼Œéƒ½æœ‰ä¸€ä¸ªå•ä¸€çš„é›†ä¸­ç®¡ç†çš„æœåŠ¡å™¨ï¼Œä¿å­˜æ‰€æœ‰æ–‡ä»¶çš„ä¿®è®¢ç‰ˆæœ¬ï¼Œè€ŒååŒå·¥ä½œçš„äººä»¬éƒ½é€šè¿‡å®¢æˆ·ç«¯è¿žåˆ°è¿™å°æœåŠ¡å™¨ï¼Œå–å‡ºæœ€æ–°çš„æ–‡ä»¶æˆ–è€…æäº¤æ›´æ–°ã€‚ è¿™ä¹ˆåšæœ€æ˜¾è€Œæ˜“è§çš„ç¼ºç‚¹æ˜¯ä¸­å¤®æœåŠ¡å™¨çš„å•ç‚¹æ•…éšœã€‚å¦‚æžœå®•æœºä¸€å°æ—¶ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸€å°æ—¶å†…ï¼Œè°éƒ½æ— æ³•æäº¤æ›´æ–°ï¼Œä¹Ÿå°±æ— æ³•ååŒå·¥ä½œã€‚è¦æ˜¯ä¸­å¤®æœåŠ¡å™¨çš„ç£ç›˜å‘ç”Ÿæ•…éšœï¼Œç¢°å·§æ²¡åšå¤‡ä»½ï¼Œæˆ–è€…å¤‡ä»½ä¸å¤ŸåŠæ—¶ï¼Œå°±ä¼šæœ‰ä¸¢å¤±æ•°æ®çš„é£Žé™©ã€‚æœ€åçš„æƒ…å†µæ˜¯å½»åº•ä¸¢å¤±æ•´ä¸ªé¡¹ç›®çš„æ‰€æœ‰åŽ†å²æ›´æ”¹è®°å½•ã€‚ åˆ†å¸ƒå¼ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿçš„å®¢æˆ·ç«¯å¹¶ä¸åªæå–æœ€æ–°ç‰ˆæœ¬çš„æ–‡ä»¶å¿«ç…§ï¼Œè€Œæ˜¯æŠŠä»£ç ä»“åº“å®Œæ•´åœ°é•œåƒä¸‹æ¥ã€‚è¿™ä¹ˆä¸€æ¥ï¼Œä»»ä½•ä¸€å¤„ååŒå·¥ä½œç”¨çš„æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œäº‹åŽéƒ½å¯ä»¥ç”¨ä»»ä½•ä¸€ä¸ªé•œåƒå‡ºæ¥çš„æœ¬åœ°ä»“åº“æ¢å¤ã€‚å› ä¸ºæ¯ä¸€æ¬¡çš„æå–æ“ä½œï¼Œå®žé™…ä¸Šéƒ½æ˜¯ä¸€æ¬¡å¯¹ä»£ç ä»“åº“çš„å®Œæ•´å¤‡ä»½ã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨ Gitï¼Ÿ Git æ˜¯åˆ†å¸ƒå¼çš„ã€‚è¿™æ˜¯ Git å’Œå…¶å®ƒéžåˆ†å¸ƒå¼çš„ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿï¼Œä¾‹å¦‚ svnï¼Œcvs ç­‰ï¼Œæœ€æ ¸å¿ƒçš„åŒºåˆ«ã€‚åˆ†å¸ƒå¼å¸¦æ¥ä»¥ä¸‹å¥½å¤„ï¼š å·¥ä½œæ—¶ä¸éœ€è¦è”ç½‘ é¦–å…ˆï¼Œåˆ†å¸ƒå¼ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿæ ¹æœ¬æ²¡æœ‰â€œä¸­å¤®æœåŠ¡å™¨â€ï¼Œæ¯ä¸ªäººçš„ç”µè„‘ä¸Šéƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç‰ˆæœ¬åº“ï¼Œè¿™æ ·ï¼Œä½ å·¥ä½œçš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦è”ç½‘äº†ï¼Œå› ä¸ºç‰ˆæœ¬åº“å°±åœ¨ä½ è‡ªå·±çš„ç”µè„‘ä¸Šã€‚æ—¢ç„¶æ¯ä¸ªäººç”µè„‘ä¸Šéƒ½æœ‰ä¸€ä¸ªå®Œæ•´çš„ç‰ˆæœ¬åº“ï¼Œé‚£å¤šä¸ªäººå¦‚ä½•åä½œå‘¢ï¼Ÿæ¯”æ–¹è¯´ä½ åœ¨è‡ªå·±ç”µè„‘ä¸Šæ”¹äº†æ–‡ä»¶ Aï¼Œä½ çš„åŒäº‹ä¹Ÿåœ¨ä»–çš„ç”µè„‘ä¸Šæ”¹äº†æ–‡ä»¶ Aï¼Œè¿™æ—¶ï¼Œä½ ä»¬ä¿©ä¹‹é—´åªéœ€æŠŠå„è‡ªçš„ä¿®æ”¹æŽ¨é€ç»™å¯¹æ–¹ï¼Œå°±å¯ä»¥äº’ç›¸çœ‹åˆ°å¯¹æ–¹çš„ä¿®æ”¹äº†ã€‚ æ›´åŠ å®‰å…¨ é›†ä¸­å¼ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿï¼Œä¸€æ—¦ä¸­å¤®æœåŠ¡å™¨å‡ºäº†é—®é¢˜ï¼Œæ‰€æœ‰äººéƒ½æ— æ³•å·¥ä½œã€‚ åˆ†å¸ƒå¼ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿï¼Œæ¯ä¸ªäººç”µè„‘ä¸­éƒ½æœ‰å®Œæ•´çš„ç‰ˆæœ¬åº“ï¼Œæ‰€ä»¥æŸäººçš„æœºå™¨æŒ‚äº†ï¼Œå¹¶ä¸å½±å“å…¶å®ƒäººã€‚ å®‰è£… Debian/Ubuntu çŽ¯å¢ƒå®‰è£… å¦‚æžœä½ ä½¿ç”¨çš„ç³»ç»Ÿæ˜¯ Debian/Ubuntu ï¼Œ å®‰è£…å‘½ä»¤ä¸ºï¼š $ apt-get install libcurl4-gnutls-dev libexpat1-dev gettext \&gt; libz-dev libssl-dev$ apt-get install git-core$ git --versiongit version 1.8.1.2 Centos/RedHat çŽ¯å¢ƒå®‰è£… å¦‚æžœä½ ä½¿ç”¨çš„ç³»ç»Ÿæ˜¯ Centos/RedHat ï¼Œå®‰è£…å‘½ä»¤ä¸ºï¼š $ yum install curl-devel expat-devel gettext-devel \&gt; openssl-devel zlib-devel$ yum -y install git-core$ git --versiongit version 1.7.1 Windows çŽ¯å¢ƒå®‰è£… åœ¨Git å®˜æ–¹ä¸‹è½½åœ°å€ä¸‹è½½ exe å®‰è£…åŒ…ã€‚æŒ‰ç…§å®‰è£…å‘å¯¼å®‰è£…å³å¯ã€‚ å»ºè®®å®‰è£… Git Bash è¿™ä¸ª git çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ Mac çŽ¯å¢ƒå®‰è£… åœ¨Git å®˜æ–¹ä¸‹è½½åœ°å€ä¸‹è½½ mac å®‰è£…åŒ…ã€‚æŒ‰ç…§å®‰è£…å‘å¯¼å®‰è£…å³å¯ã€‚ é…ç½® Git è‡ªå¸¦ä¸€ä¸ª git config çš„å·¥å…·æ¥å¸®åŠ©è®¾ç½®æŽ§åˆ¶ Git å¤–è§‚å’Œè¡Œä¸ºçš„é…ç½®å˜é‡ã€‚ è¿™äº›å˜é‡å­˜å‚¨åœ¨ä¸‰ä¸ªä¸åŒçš„ä½ç½®ï¼š /etc/gitconfig æ–‡ä»¶: åŒ…å«ç³»ç»Ÿä¸Šæ¯ä¸€ä¸ªç”¨æˆ·åŠä»–ä»¬ä»“åº“çš„é€šç”¨é…ç½®ã€‚ å¦‚æžœä½¿ç”¨å¸¦æœ‰ --system é€‰é¡¹çš„ git config æ—¶ï¼Œå®ƒä¼šä»Žæ­¤æ–‡ä»¶è¯»å†™é…ç½®å˜é‡ã€‚ \~/.gitconfig æˆ– \~/.config/git/config æ–‡ä»¶ï¼šåªé’ˆå¯¹å½“å‰ç”¨æˆ·ã€‚ å¯ä»¥ä¼ é€’ --global é€‰é¡¹è®© Git è¯»å†™æ­¤æ–‡ä»¶ã€‚ å½“å‰ä½¿ç”¨ä»“åº“çš„ Git ç›®å½•ä¸­çš„ config æ–‡ä»¶ï¼ˆå°±æ˜¯ .git/configï¼‰ï¼šé’ˆå¯¹è¯¥ä»“åº“ã€‚ æ¯ä¸€ä¸ªçº§åˆ«è¦†ç›–ä¸Šä¸€çº§åˆ«çš„é…ç½®ï¼Œæ‰€ä»¥ .git/config çš„é…ç½®å˜é‡ä¼šè¦†ç›– /etc/gitconfig ä¸­çš„é…ç½®å˜é‡ã€‚ åœ¨ Windows ç³»ç»Ÿä¸­ï¼ŒGit ä¼šæŸ¥æ‰¾ $HOME ç›®å½•ä¸‹ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ C:\Users\$USERï¼‰çš„ .gitconfig æ–‡ä»¶ã€‚ Git åŒæ ·ä¹Ÿä¼šå¯»æ‰¾ /etc/gitconfig æ–‡ä»¶ï¼Œä½†åªé™äºŽ MSys çš„æ ¹ç›®å½•ä¸‹ï¼Œå³å®‰è£… Git æ—¶æ‰€é€‰çš„ç›®æ ‡ä½ç½®ã€‚ ç”¨æˆ·ä¿¡æ¯ å½“å®‰è£…å®Œ Git åº”è¯¥åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è®¾ç½®ä½ çš„ç”¨æˆ·åç§°ä¸Žé‚®ä»¶åœ°å€ã€‚ è¿™æ ·åšå¾ˆé‡è¦ï¼Œå› ä¸ºæ¯ä¸€ä¸ª Git çš„æäº¤éƒ½ä¼šä½¿ç”¨è¿™äº›ä¿¡æ¯ï¼Œå¹¶ä¸”å®ƒä¼šå†™å…¥åˆ°ä½ çš„æ¯ä¸€æ¬¡æäº¤ä¸­ï¼Œä¸å¯æ›´æ”¹ï¼š $ git config --global user.name "John Doe"$ git config --global user.email johndoe@example.com å†æ¬¡å¼ºè°ƒï¼Œå¦‚æžœä½¿ç”¨äº† --global é€‰é¡¹ï¼Œé‚£ä¹ˆè¯¥å‘½ä»¤åªéœ€è¦è¿è¡Œä¸€æ¬¡ï¼Œå› ä¸ºä¹‹åŽæ— è®ºä½ åœ¨è¯¥ç³»ç»Ÿä¸Šåšä»»ä½•äº‹æƒ…ï¼Œ Git éƒ½ä¼šä½¿ç”¨é‚£äº›ä¿¡æ¯ã€‚ å½“ä½ æƒ³é’ˆå¯¹ç‰¹å®šé¡¹ç›®ä½¿ç”¨ä¸åŒçš„ç”¨æˆ·åç§°ä¸Žé‚®ä»¶åœ°å€æ—¶ï¼Œå¯ä»¥åœ¨é‚£ä¸ªé¡¹ç›®ç›®å½•ä¸‹è¿è¡Œæ²¡æœ‰ --global é€‰é¡¹çš„å‘½ä»¤æ¥é…ç½®ã€‚ å¾ˆå¤š GUI å·¥å…·éƒ½ä¼šåœ¨ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶å¸®åŠ©ä½ é…ç½®è¿™äº›ä¿¡æ¯ã€‚ .gitignore .gitignore æ–‡ä»¶å¯èƒ½ä»Žå­—é¢å«ä¹‰ä¹Ÿä¸éš¾çŒœå‡ºï¼šè¿™ä¸ªæ–‡ä»¶é‡Œé…ç½®çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¼šè‡ªåŠ¨è¢« git æ‰€å¿½ç•¥ï¼Œä¸çº³å…¥ç‰ˆæœ¬æŽ§åˆ¶ã€‚ åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ç»å¸¸ä¼šäº§ç”Ÿä¸€äº›ä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚ç¼–è¯‘ Java äº§ç”Ÿçš„ *.class æ–‡ä»¶ï¼Œåˆæˆ–æ˜¯ IDE è‡ªåŠ¨ç”Ÿæˆçš„éšè—ç›®å½•ï¼ˆIntellij çš„ .idea ç›®å½•ã€Eclipse çš„ .settings ç›®å½•ç­‰ï¼‰ç­‰ç­‰ã€‚è¿™äº›æ–‡ä»¶æˆ–ç›®å½•å®žåœ¨æ²¡å¿…è¦çº³å…¥ç‰ˆæœ¬ç®¡ç†ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä½ å°±éœ€è¦ç”¨åˆ° .gitignore é…ç½®æ¥è¿‡æ»¤è¿™äº›æ–‡ä»¶æˆ–ç›®å½•ã€‚ é…ç½®çš„è§„åˆ™å¾ˆç®€å•ï¼Œä¹Ÿæ²¡ä»€ä¹ˆå¯è¯´çš„ï¼Œçœ‹å‡ ä¸ªä¾‹å­ï¼Œè‡ªç„¶å°±æ˜Žç™½äº†ã€‚ è¿™é‡ŒæŽ¨èä¸€ä¸‹ Github çš„å¼€æºé¡¹ç›®ï¼šhttps://github.com/github/gitignore åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥æ‰¾åˆ°å¾ˆå¤šå¸¸ç”¨çš„æ¨¡æ¿ï¼Œå¦‚ï¼šJavaã€Nodejsã€C++ çš„ .gitignore æ¨¡æ¿ç­‰ç­‰ã€‚ åŽŸç† ä¸ªäººè®¤ä¸ºï¼Œå¯¹äºŽ Git è¿™ä¸ªç‰ˆæœ¬å·¥å…·ï¼Œå†ä¸äº†è§£åŽŸç†çš„æƒ…å†µä¸‹ï¼Œç›´æŽ¥åŽ»å­¦ä¹ å‘½ä»¤è¡Œï¼Œå¯èƒ½ä¼šä¸€å¤´é›¾æ°´ã€‚æ‰€ä»¥ï¼Œæœ¬æ–‡ç‰¹æ„å°†åŽŸç†æ”¾åœ¨å‘½ä»¤ä½¿ç”¨ç« èŠ‚ä¹‹å‰è®²è§£ã€‚ ç‰ˆæœ¬åº“ å½“ä½ ä¸€ä¸ªé¡¹ç›®åˆ°æœ¬åœ°æˆ–åˆ›å»ºä¸€ä¸ª git é¡¹ç›®ï¼Œé¡¹ç›®ç›®å½•ä¸‹ä¼šæœ‰ä¸€ä¸ªéšè—çš„ .git å­ç›®å½•ã€‚è¿™ä¸ªç›®å½•æ˜¯ git ç”¨æ¥è·Ÿè¸ªç®¡ç†ç‰ˆæœ¬åº“çš„ï¼Œåƒä¸‡ä¸è¦æ‰‹åŠ¨ä¿®æ”¹ã€‚ å“ˆå¸Œå€¼ Git ä¸­æ‰€æœ‰æ•°æ®åœ¨å­˜å‚¨å‰éƒ½è®¡ç®—æ ¡éªŒå’Œï¼Œç„¶åŽä»¥æ ¡éªŒå’Œæ¥å¼•ç”¨ã€‚ è¿™æ„å‘³ç€ä¸å¯èƒ½åœ¨ Git ä¸çŸ¥æƒ…æ—¶æ›´æ”¹ä»»ä½•æ–‡ä»¶å†…å®¹æˆ–ç›®å½•å†…å®¹ã€‚ è¿™ä¸ªåŠŸèƒ½å»ºæž„åœ¨ Git åº•å±‚ï¼Œæ˜¯æž„æˆ Git å“²å­¦ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚ è‹¥ä½ åœ¨ä¼ é€è¿‡ç¨‹ä¸­ä¸¢å¤±ä¿¡æ¯æˆ–æŸåæ–‡ä»¶ï¼ŒGit å°±èƒ½å‘çŽ°ã€‚ Git ç”¨ä»¥è®¡ç®—æ ¡éªŒå’Œçš„æœºåˆ¶å«åš SHA-1 æ•£åˆ—ï¼ˆhashï¼Œå“ˆå¸Œï¼‰ã€‚ è¿™æ˜¯ä¸€ä¸ªç”± 40 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼ˆ0-9 å’Œ a-fï¼‰ç»„æˆå­—ç¬¦ä¸²ï¼ŒåŸºäºŽ Git ä¸­æ–‡ä»¶çš„å†…å®¹æˆ–ç›®å½•ç»“æž„è®¡ç®—å‡ºæ¥ã€‚ SHA-1 å“ˆå¸Œçœ‹èµ·æ¥æ˜¯è¿™æ ·ï¼š 24b9da6552252987aa493b52f8696cd6d3b00373 Git ä¸­ä½¿ç”¨è¿™ç§å“ˆå¸Œå€¼çš„æƒ…å†µå¾ˆå¤šï¼Œä½ å°†ç»å¸¸çœ‹åˆ°è¿™ç§å“ˆå¸Œå€¼ã€‚ å®žé™…ä¸Šï¼ŒGit æ•°æ®åº“ä¸­ä¿å­˜çš„ä¿¡æ¯éƒ½æ˜¯ä»¥æ–‡ä»¶å†…å®¹çš„å“ˆå¸Œå€¼æ¥ç´¢å¼•ï¼Œè€Œä¸æ˜¯æ–‡ä»¶åã€‚ æ–‡ä»¶çŠ¶æ€ åœ¨ GIt ä¸­ï¼Œä½ çš„æ–‡ä»¶å¯èƒ½ä¼šå¤„äºŽä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š å·²ä¿®æ”¹ï¼ˆmodifiedï¼‰ - å·²ä¿®æ”¹è¡¨ç¤ºä¿®æ”¹äº†æ–‡ä»¶ï¼Œä½†è¿˜æ²¡ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ å·²æš‚å­˜ï¼ˆstagedï¼‰ - å·²æš‚å­˜è¡¨ç¤ºå¯¹ä¸€ä¸ªå·²ä¿®æ”¹æ–‡ä»¶çš„å½“å‰ç‰ˆæœ¬åšäº†æ ‡è®°ï¼Œä½¿ä¹‹åŒ…å«åœ¨ä¸‹æ¬¡æäº¤çš„å¿«ç…§ä¸­ã€‚ å·²æäº¤ï¼ˆcommittedï¼‰ - å·²æäº¤è¡¨ç¤ºæ•°æ®å·²ç»å®‰å…¨çš„ä¿å­˜åœ¨æœ¬åœ°æ•°æ®åº“ä¸­ã€‚ å·¥ä½œåŒºåŸŸ ä¸Žæ–‡ä»¶çŠ¶æ€å¯¹åº”çš„ï¼Œä¸åŒçŠ¶æ€çš„æ–‡ä»¶åœ¨ Git ä¸­å¤„äºŽä¸åŒçš„å·¥ä½œåŒºåŸŸã€‚ å·¥ä½œåŒºï¼ˆworkingï¼‰ - å½“ä½  git clone ä¸€ä¸ªé¡¹ç›®åˆ°æœ¬åœ°ï¼Œç›¸å½“äºŽåœ¨æœ¬åœ°å…‹éš†äº†é¡¹ç›®çš„ä¸€ä¸ªå‰¯æœ¬ã€‚å·¥ä½œåŒºæ˜¯å¯¹é¡¹ç›®çš„æŸä¸ªç‰ˆæœ¬ç‹¬ç«‹æå–å‡ºæ¥çš„å†…å®¹ã€‚ è¿™äº›ä»Ž Git ä»“åº“çš„åŽ‹ç¼©æ•°æ®åº“ä¸­æå–å‡ºæ¥çš„æ–‡ä»¶ï¼Œæ”¾åœ¨ç£ç›˜ä¸Šä¾›ä½ ä½¿ç”¨æˆ–ä¿®æ”¹ã€‚ æš‚å­˜åŒºï¼ˆstagingï¼‰ - æš‚å­˜åŒºæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¿å­˜äº†ä¸‹æ¬¡å°†æäº¤çš„æ–‡ä»¶åˆ—è¡¨ä¿¡æ¯ï¼Œä¸€èˆ¬åœ¨ Git ä»“åº“ç›®å½•ä¸­ã€‚ æœ‰æ—¶å€™ä¹Ÿè¢«ç§°ä½œ`â€˜ç´¢å¼•â€™â€™ï¼Œä¸è¿‡ä¸€èˆ¬è¯´æ³•è¿˜æ˜¯å«æš‚å­˜åŒºã€‚ æœ¬åœ°ä»“åº“ï¼ˆlocalï¼‰ - æäº¤æ›´æ–°ï¼Œæ‰¾åˆ°æš‚å­˜åŒºåŸŸçš„æ–‡ä»¶ï¼Œå°†å¿«ç…§æ°¸ä¹…æ€§å­˜å‚¨åˆ° Git æœ¬åœ°ä»“åº“ã€‚ è¿œç¨‹ä»“åº“ï¼ˆremoteï¼‰ - ä»¥ä¸Šå‡ ä¸ªå·¥ä½œåŒºéƒ½æ˜¯åœ¨æœ¬åœ°ã€‚ä¸ºäº†è®©åˆ«äººå¯ä»¥çœ‹åˆ°ä½ çš„ä¿®æ”¹ï¼Œä½ éœ€è¦å°†ä½ çš„æ›´æ–°æŽ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚åŒç†ï¼Œå¦‚æžœä½ æƒ³åŒæ­¥åˆ«äººçš„ä¿®æ”¹ï¼Œä½ éœ€è¦ä»Žè¿œç¨‹ä»“åº“æ‹‰å–æ›´æ–°ã€‚ å‘½ä»¤ å›½å¤–ç½‘å‹åˆ¶ä½œäº†ä¸€å¼  Git Cheat Sheetï¼Œæ€»ç»“å¾ˆç²¾ç‚¼ï¼Œå„ä½ä¸å¦¨æ”¶è—ä¸€ä¸‹ã€‚ æœ¬èŠ‚é€‰æ‹©æ€§ä»‹ç» git ä¸­æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤è¡Œåœºæ™¯ã€‚ åˆ›å»ºä»“åº“ å…‹éš†ä¸€ä¸ªå·²åˆ›å»ºçš„ä»“åº“ï¼š # é€šè¿‡ SSH$ git clone ssh://user@domain.com/repo.git#é€šè¿‡ HTTP$ git clone http://domain.com/user/repo.git åˆ›å»ºä¸€ä¸ªæ–°çš„æœ¬åœ°ä»“åº“ï¼š $ git init æ·»åŠ ä¿®æ”¹ æ·»åŠ ä¿®æ”¹åˆ°æš‚å­˜åŒºï¼š # æŠŠæŒ‡å®šæ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº$ git add xxx# æŠŠå½“å‰æ‰€æœ‰ä¿®æ”¹æ·»åŠ åˆ°æš‚å­˜åŒº$ git add .# æŠŠæ‰€æœ‰ä¿®æ”¹æ·»åŠ åˆ°æš‚å­˜åŒº$ git add -A æäº¤ä¿®æ”¹åˆ°æœ¬åœ°ä»“åº“ï¼š # æäº¤æœ¬åœ°çš„æ‰€æœ‰ä¿®æ”¹$ git commit -a# æäº¤ä¹‹å‰å·²æ ‡è®°çš„å˜åŒ–$ git commit# é™„åŠ æ¶ˆæ¯æäº¤$ git commit -m 'commit message' å‚¨è— æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åŒä¸€ä¸ªé¡¹ç›®çš„ä¸åŒåˆ†æ”¯ä¸Šå·¥ä½œã€‚å½“éœ€è¦åˆ‡æ¢åˆ†æ”¯æ—¶ï¼Œååæœ¬åœ°çš„å·¥ä½œè¿˜æ²¡æœ‰å®Œæˆï¼Œæ­¤æ—¶ï¼Œæäº¤ä¿®æ”¹æ˜¾å¾—ä¸ä¸¥è°¨ï¼Œä½†æ˜¯ä¸æäº¤ä»£ç åˆæ— æ³•åˆ‡æ¢åˆ†æ”¯ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ git stash å°†æœ¬åœ°çš„ä¿®æ”¹å†…å®¹ä½œä¸ºè‰ç¨¿å‚¨è—èµ·æ¥ã€‚ å®˜æ–¹ç§°ä¹‹ä¸ºå‚¨è—ï¼Œä½†æˆ‘ä¸ªäººæ›´å–œæ¬¢ç§°ä¹‹ä¸ºå­˜è‰ç¨¿ã€‚ # 1. å°†ä¿®æ”¹ä½œä¸ºå½“å‰åˆ†æ”¯çš„è‰ç¨¿ä¿å­˜$ git stash# 2. æŸ¥çœ‹è‰ç¨¿åˆ—è¡¨$ git stash liststash@&#123;0&#125;: WIP on master: 6fae349 :memo: Writing docs.# 3.1 åˆ é™¤è‰ç¨¿$ git stash drop stash@&#123;0&#125;# 3.2 è¯»å–è‰ç¨¿$ git stash apply stash@&#123;0&#125; æ’¤é”€ä¿®æ”¹ æ’¤é”€æœ¬åœ°ä¿®æ”¹ï¼š # ç§»é™¤ç¼“å­˜åŒºçš„æ‰€æœ‰æ–‡ä»¶ï¼ˆi.e. æ’¤é”€ä¸Šæ¬¡git addï¼‰$ git reset HEAD# å°†HEADé‡ç½®åˆ°ä¸Šä¸€æ¬¡æäº¤çš„ç‰ˆæœ¬ï¼Œå¹¶å°†ä¹‹åŽçš„ä¿®æ”¹æ ‡è®°ä¸ºæœªæ·»åŠ åˆ°ç¼“å­˜åŒºçš„ä¿®æ”¹$ git reset &lt;commit&gt;# å°†HEADé‡ç½®åˆ°ä¸Šä¸€æ¬¡æäº¤çš„ç‰ˆæœ¬ï¼Œå¹¶ä¿ç•™æœªæäº¤çš„æœ¬åœ°ä¿®æ”¹$ git reset --keep &lt;commit&gt;# æ”¾å¼ƒå·¥ä½œç›®å½•ä¸‹çš„æ‰€æœ‰ä¿®æ”¹$ git reset --hard HEAD# å°†HEADé‡ç½®åˆ°æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå¹¶æŠ›å¼ƒè¯¥ç‰ˆæœ¬ä¹‹åŽçš„æ‰€æœ‰ä¿®æ”¹$ git reset --hard &lt;commit-hash&gt;# ç”¨è¿œç«¯åˆ†æ”¯å¼ºåˆ¶è¦†ç›–æœ¬åœ°åˆ†æ”¯$ git reset --hard &lt;remote/branch&gt; e.g., upstream/master, origin/my-feature# æ”¾å¼ƒæŸä¸ªæ–‡ä»¶çš„æ‰€æœ‰æœ¬åœ°ä¿®æ”¹$ git checkout HEAD &lt;file&gt; åˆ é™¤æ·»åŠ .gitignoreæ–‡ä»¶å‰é”™è¯¯æäº¤çš„æ–‡ä»¶ï¼š $ git rm -r --cached .$ git add .$ git commit -m "remove xyz file" æ’¤é”€è¿œç¨‹ä¿®æ”¹ï¼ˆåˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ï¼Œå¹¶å›žæ»šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼‰ï¼š $ git revert &lt;commit-hash&gt; å½»åº•åˆ é™¤æŒ‡å®šç‰ˆæœ¬ï¼š # æ‰§è¡Œä¸‹é¢å‘½ä»¤åŽï¼Œcommit-hash æäº¤åŽçš„è®°å½•éƒ½ä¼šè¢«å½»åº•åˆ é™¤ï¼Œä½¿ç”¨éœ€è°¨æ…Ž$ git reset --hard &lt;commit-hash&gt;$ git push -f æ›´æ–°ä¸ŽæŽ¨é€ æ›´æ–°ï¼š # ä¸‹è½½è¿œç¨‹ç«¯ç‰ˆæœ¬ï¼Œä½†ä¸åˆå¹¶åˆ°HEADä¸­$ git fetch &lt;remote&gt;# å°†è¿œç¨‹ç«¯ç‰ˆæœ¬åˆå¹¶åˆ°æœ¬åœ°ç‰ˆæœ¬ä¸­$ git pull origin master# ä»¥rebaseæ–¹å¼å°†è¿œç«¯åˆ†æ”¯ä¸Žæœ¬åœ°åˆå¹¶$ git pull --rebase &lt;remote&gt; &lt;branch&gt; æŽ¨é€ï¼š # å°†æœ¬åœ°ç‰ˆæœ¬æŽ¨é€åˆ°è¿œç¨‹ç«¯$ git push remote &lt;remote&gt; &lt;branch&gt;# åˆ é™¤è¿œç¨‹ç«¯åˆ†æ”¯$ git push &lt;remote&gt; :&lt;branch&gt; (since Git v1.5.0)$ git push &lt;remote&gt; --delete &lt;branch&gt; (since Git v1.7.0)# å‘å¸ƒæ ‡ç­¾$ git push --tags æŸ¥çœ‹ä¿¡æ¯ æ˜¾ç¤ºå·¥ä½œè·¯å¾„ä¸‹å·²ä¿®æ”¹çš„æ–‡ä»¶ï¼š $ git status æ˜¾ç¤ºä¸Žä¸Šæ¬¡æäº¤ç‰ˆæœ¬æ–‡ä»¶çš„ä¸åŒï¼š $ git diff æ˜¾ç¤ºæäº¤åŽ†å²ï¼š # ä»Žæœ€æ–°æäº¤å¼€å§‹ï¼Œæ˜¾ç¤ºæ‰€æœ‰çš„æäº¤è®°å½•ï¼ˆæ˜¾ç¤ºhashï¼Œ ä½œè€…ä¿¡æ¯ï¼Œæäº¤çš„æ ‡é¢˜å’Œæ—¶é—´ï¼‰$ git log# æ˜¾ç¤ºæŸä¸ªç”¨æˆ·çš„æ‰€æœ‰æäº¤$ git log --author="username"# æ˜¾ç¤ºæŸä¸ªæ–‡ä»¶çš„æ‰€æœ‰ä¿®æ”¹$ git log -p &lt;file&gt; æ˜¾ç¤ºæœç´¢å†…å®¹ï¼š # ä»Žå½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶ä¸­æŸ¥æ‰¾æ–‡æœ¬å†…å®¹$ git grep "Hello"# åœ¨æŸä¸€ç‰ˆæœ¬ä¸­æœç´¢æ–‡æœ¬$ git grep "Hello" v2.5 åˆ†æ”¯ å¢žåˆ æŸ¥åˆ†æ”¯ï¼š # åˆ—å‡ºæ‰€æœ‰çš„åˆ†æ”¯$ git branch# åˆ—å‡ºæ‰€æœ‰çš„è¿œç«¯åˆ†æ”¯$ git branch -r# åŸºäºŽå½“å‰åˆ†æ”¯åˆ›å»ºæ–°åˆ†æ”¯$ git branch &lt;new-branch&gt;# åŸºäºŽè¿œç¨‹åˆ†æ”¯åˆ›å»ºæ–°çš„å¯è¿½æº¯çš„åˆ†æ”¯$ git branch --track &lt;new-branch&gt; &lt;remote-branch&gt;# åˆ é™¤æœ¬åœ°åˆ†æ”¯$ git branch -d &lt;branch&gt;# å¼ºåˆ¶åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼Œå°†ä¼šä¸¢å¤±æœªåˆå¹¶çš„ä¿®æ”¹$ git branch -D &lt;branch&gt; åˆ‡æ¢åˆ†æ”¯ï¼š # åˆ‡æ¢åˆ†æ”¯$ git checkout &lt;branch&gt;# åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯$ git checkout -b &lt;branch&gt; æ ‡ç­¾ # ç»™å½“å‰ç‰ˆæœ¬æ‰“æ ‡ç­¾$ git tag &lt;tag-name&gt;# ç»™å½“å‰ç‰ˆæœ¬æ‰“æ ‡ç­¾å¹¶é™„åŠ æ¶ˆæ¯$ git tag -a &lt;tag-name&gt; åˆå¹¶ä¸Žé‡ç½® merge ä¸Ž rebase è™½ç„¶æ˜¯ git å¸¸ç”¨åŠŸèƒ½ï¼Œä½†æ˜¯å¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ git å‘½ä»¤æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚ å› ä¸ºå¦‚æžœå‡ºçŽ°ä»£ç å†²çªï¼Œåœ¨æ²¡æœ‰ä»£ç æ¯”å¯¹å·¥å…·çš„æƒ…å†µä¸‹ï¼Œå®žåœ¨å¤ªè‰°éš¾äº†ã€‚ ä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨å„ç§ Git GUI å·¥å…·ã€‚ åˆå¹¶ï¼š # å°†åˆ†æ”¯åˆå¹¶åˆ°å½“å‰HEADä¸­$ git merge &lt;branch&gt; é‡ç½®ï¼š # å°†å½“å‰HEADç‰ˆæœ¬é‡ç½®åˆ°åˆ†æ”¯ä¸­ï¼Œè¯·å‹¿é‡ç½®å·²å‘å¸ƒçš„æäº¤$ git rebase &lt;branch&gt; Github Github ä½œä¸ºæœ€è‘—åçš„ä»£ç å¼€æºåä½œç¤¾åŒºï¼Œåœ¨ç¨‹åºå‘˜åœˆæƒ³å¿…æ— äººä¸çŸ¥ï¼Œæ— äººä¸æ™“ã€‚ è¿™é‡Œä¸èµ˜è¿° Github çš„ç”¨æ³•ï¼Œç¡®å®žæœ‰ä¸ä¼šç”¨çš„æ–°æ‰‹åŒå­¦ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ•™ç¨‹ï¼šhttps://guides.github.com/ clone æ–¹å¼ Git æ”¯æŒä¸‰ç§åè®®ï¼šHTTPS / SSH / GIT è€Œ Github ä¸Šæ”¯æŒ HTTPS å’Œ SSHã€‚ HTTPS è¿™ç§æ–¹å¼è¦æ±‚ä½ æ¯æ¬¡ push æ—¶éƒ½è¦è¾“å…¥ç”¨æˆ·åã€å¯†ç ï¼Œæœ‰äº›ç¹çã€‚ è€Œ SSH è¦æ±‚ä½ æœ¬åœ°ç”Ÿæˆè¯ä¹¦ï¼Œç„¶åŽåœ¨ä½ çš„ Github è´¦æˆ·ä¸­æ³¨å†Œã€‚ç¬¬ä¸€æ¬¡é…ç½®éº»çƒ¦æ˜¯éº»çƒ¦äº†ç‚¹ï¼Œä½†æ˜¯ä»¥åŽå°±å…åŽ»äº†æ¯æ¬¡ push éœ€è¦è¾“å…¥ç”¨æˆ·åã€å¯†ç çš„ç¹çã€‚ ä»¥ä¸‹ä»‹ç»ä»¥ä¸‹ï¼Œå¦‚ä½•ç”Ÿæˆè¯ä¹¦ï¼Œä»¥åŠåœ¨ Github ä¸­æ³¨å†Œã€‚ ç”Ÿæˆ SSH å…¬é’¥ å¦‚å‰æ‰€è¿°ï¼Œè®¸å¤š Git æœåŠ¡å™¨éƒ½ä½¿ç”¨ SSH å…¬é’¥è¿›è¡Œè®¤è¯ã€‚ ä¸ºäº†å‘ Git æœåŠ¡å™¨æä¾› SSH å…¬é’¥ï¼Œå¦‚æžœæŸç³»ç»Ÿç”¨æˆ·å°šæœªæ‹¥æœ‰å¯†é’¥ï¼Œå¿…é¡»äº‹å…ˆä¸ºå…¶ç”Ÿæˆä¸€ä»½ã€‚ è¿™ä¸ªè¿‡ç¨‹åœ¨æ‰€æœ‰æ“ä½œç³»ç»Ÿä¸Šéƒ½æ˜¯ç›¸ä¼¼çš„ã€‚ é¦–å…ˆï¼Œä½ éœ€è¦ç¡®è®¤è‡ªå·±æ˜¯å¦å·²ç»æ‹¥æœ‰å¯†é’¥ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„ SSH å¯†é’¥å­˜å‚¨åœ¨å…¶ \~/.ssh ç›®å½•ä¸‹ã€‚ è¿›å…¥è¯¥ç›®å½•å¹¶åˆ—å‡ºå…¶ä¸­å†…å®¹ï¼Œä½ ä¾¿å¯ä»¥å¿«é€Ÿç¡®è®¤è‡ªå·±æ˜¯å¦å·²æ‹¥æœ‰å¯†é’¥ï¼š $ cd ~/.ssh$ lsauthorized_keys2 id_dsa known_hostsconfig id_dsa.pub æˆ‘ä»¬éœ€è¦å¯»æ‰¾ä¸€å¯¹ä»¥ id_dsa æˆ– id_rsa å‘½åçš„æ–‡ä»¶ï¼Œå…¶ä¸­ä¸€ä¸ªå¸¦æœ‰ .pub æ‰©å±•åã€‚ .pub æ–‡ä»¶æ˜¯ä½ çš„å…¬é’¥ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯ç§é’¥ã€‚ å¦‚æžœæ‰¾ä¸åˆ°è¿™æ ·çš„æ–‡ä»¶ï¼ˆæˆ–è€…æ ¹æœ¬æ²¡æœ‰ .ssh ç›®å½•ï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡è¿è¡Œ ssh-keygen ç¨‹åºæ¥åˆ›å»ºå®ƒä»¬ã€‚åœ¨ Linux/Mac ç³»ç»Ÿä¸­ï¼Œssh-keygen éš SSH è½¯ä»¶åŒ…æä¾›ï¼›åœ¨ Windows ä¸Šï¼Œè¯¥ç¨‹åºåŒ…å«äºŽ MSysGit è½¯ä»¶åŒ…ä¸­ã€‚ $ ssh-keygenGenerating public/private rsa key pair.Enter file in which to save the key (/home/schacon/.ssh/id_rsa):Created directory '/home/schacon/.ssh'.Enter passphrase (empty for no passphrase):Enter same passphrase again:Your identification has been saved in /home/schacon/.ssh/id_rsa.Your public key has been saved in /home/schacon/.ssh/id_rsa.pub.The key fingerprint is:d0:82:24:8e:d7:f1:bb:9b:33:53:96:93:49:da:9b:e3 schacon@mylaptop.local é¦–å…ˆ ssh-keygen ä¼šç¡®è®¤å¯†é’¥çš„å­˜å‚¨ä½ç½®ï¼ˆé»˜è®¤æ˜¯ .ssh/id_rsaï¼‰ï¼Œç„¶åŽå®ƒä¼šè¦æ±‚ä½ è¾“å…¥ä¸¤æ¬¡å¯†é’¥å£ä»¤ã€‚å¦‚æžœä½ ä¸æƒ³åœ¨ä½¿ç”¨å¯†é’¥æ—¶è¾“å…¥å£ä»¤ï¼Œå°†å…¶ç•™ç©ºå³å¯ã€‚ çŽ°åœ¨ï¼Œè¿›è¡Œäº†ä¸Šè¿°æ“ä½œçš„ç”¨æˆ·éœ€è¦å°†å„è‡ªçš„å…¬é’¥å‘é€ç»™ä»»æ„ä¸€ä¸ª Git æœåŠ¡å™¨ç®¡ç†å‘˜ï¼ˆå‡è®¾æœåŠ¡å™¨æ­£åœ¨ä½¿ç”¨åŸºäºŽå…¬é’¥çš„ SSH éªŒè¯è®¾ç½®ï¼‰ã€‚ ä»–ä»¬æ‰€è¦åšçš„å°±æ˜¯å¤åˆ¶å„è‡ªçš„ .pub æ–‡ä»¶å†…å®¹ï¼Œå¹¶å°†å…¶é€šè¿‡é‚®ä»¶å‘é€ã€‚ å…¬é’¥çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š $ cat ~/.ssh/id_rsa.pubssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAklOUpkDHrfHY17SbrmTIpNLTGK9Tjom/BWDSUGPl+nafzlHDTYW7hdI4yZ5ew18JH4JW9jbhUFrviQzM7xlELEVf4h9lFX5QVkbPppSwg0cda3Pbv7kOdJ/MTyBlWXFCR+HAo3FXRitBqxiX1nKhXpHAZsMciLq8V6RjsNAQwdsdMFvSlVK/7XAt3FaoJoAsncM1Q9x5+3V0Ww68/eIFmb1zuUFljQJKprrX88XypNDvjYNby6vw/Pb0rwert/EnmZ+AW4OZPnTPI89ZPmVMLuayrD2cE86Z/il8b+gw3r3+1nKatmIkjn2so1d01QraTlMqVSsbxNrRFi9wrf+M7Q== schacon@mylaptop.local åœ¨ä½ çš„ Github è´¦æˆ·ä¸­ï¼Œä¾æ¬¡ç‚¹å‡» Settings &gt; SSH and GPG keys &gt; New SSH key ç„¶åŽï¼Œå°†ä¸Šé¢ç”Ÿæˆçš„å…¬é’¥å†…å®¹ç²˜è´´åˆ° Key ç¼–è¾‘æ¡†å¹¶ä¿å­˜ã€‚è‡³æ­¤å¤§åŠŸå‘Šæˆã€‚ åŽé¢ï¼Œä½ åœ¨å…‹éš†ä½ çš„ Github é¡¹ç›®æ—¶ä½¿ç”¨ SSH æ–¹å¼å³å¯ã€‚ å¦‚æžœè§‰å¾—æˆ‘çš„è®²è§£è¿˜ä¸å¤Ÿç»†è‡´ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://help.github.com/articles/adding-a-new-ssh-key-to-your-github-account/ æœ€ä½³å®žè·µ Git Flow è¯¦ç»†å†…å®¹ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šGit åœ¨å›¢é˜Ÿä¸­çš„æœ€ä½³å®žè·µâ€“å¦‚ä½•æ­£ç¡®ä½¿ç”¨ Git Flow Git åœ¨å®žé™…å¼€å‘ä¸­çš„æœ€ä½³å®žè·µç­–ç•¥ Git Flow å¯ä»¥å½’çº³ä¸ºä»¥ä¸‹ï¼š master åˆ†æ”¯ - ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ä¸»çº¿åˆ†æ”¯ï¼Œè¿™ä¸ªåˆ†æ”¯æ˜¯æœ€è¿‘å‘å¸ƒåˆ°ç”Ÿäº§çŽ¯å¢ƒçš„ä»£ç ï¼Œè¿™ä¸ªåˆ†æ”¯åªèƒ½ä»Žå…¶ä»–åˆ†æ”¯åˆå¹¶ï¼Œä¸èƒ½åœ¨è¿™ä¸ªåˆ†æ”¯ç›´æŽ¥ä¿®æ”¹ã€‚ develop åˆ†æ”¯ - è¿™ä¸ªåˆ†æ”¯æ˜¯æˆ‘ä»¬çš„ä¸»å¼€å‘åˆ†æ”¯ï¼ŒåŒ…å«æ‰€æœ‰è¦å‘å¸ƒåˆ°ä¸‹ä¸€ä¸ª release çš„ä»£ç ï¼Œè¿™ä¸ªåˆ†æ”¯ä¸»è¦æ˜¯ä»Žå…¶ä»–åˆ†æ”¯åˆå¹¶ä»£ç è¿‡æ¥ï¼Œæ¯”å¦‚ feature åˆ†æ”¯ã€‚ feature åˆ†æ”¯ - è¿™ä¸ªåˆ†æ”¯ä¸»è¦æ˜¯ç”¨æ¥å¼€å‘ä¸€ä¸ªæ–°çš„åŠŸèƒ½ï¼Œä¸€æ—¦å¼€å‘å®Œæˆï¼Œæˆ‘ä»¬åˆå¹¶å›ž develop åˆ†æ”¯è¿›å…¥ä¸‹ä¸€ä¸ª releaseã€‚ release åˆ†æ”¯ - å½“ä½ éœ€è¦ä¸€ä¸ªå‘å¸ƒä¸€ä¸ªæ–° release çš„æ—¶å€™ï¼Œæˆ‘ä»¬åŸºäºŽ Develop åˆ†æ”¯åˆ›å»ºä¸€ä¸ª release åˆ†æ”¯ï¼Œå®Œæˆ release åŽï¼Œæˆ‘ä»¬åˆå¹¶åˆ° master å’Œ develop åˆ†æ”¯ã€‚ hotfix åˆ†æ”¯ - å½“æˆ‘ä»¬åœ¨ master å‘çŽ°æ–°çš„ Bug æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª hotfix, å®Œæˆ hotfix åŽï¼Œæˆ‘ä»¬åˆå¹¶å›ž master å’Œ develop åˆ†æ”¯ï¼Œæ‰€ä»¥ hotfix çš„æ”¹åŠ¨ä¼šè¿›å…¥ä¸‹ä¸€ä¸ª releaseã€‚ å¸¸è§é—®é¢˜ ç¼–è¾‘æäº¤(editting commits) æˆ‘åˆšæ‰æäº¤äº†ä»€ä¹ˆ å¦‚æžœä½ ç”¨ git commit -a æäº¤äº†ä¸€æ¬¡å˜åŒ–(changes)ï¼Œè€Œä½ åˆä¸ç¡®å®šåˆ°åº•è¿™æ¬¡æäº¤äº†å“ªäº›å†…å®¹ã€‚ ä½ å°±å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æ˜¾ç¤ºå½“å‰HEADä¸Šçš„æœ€è¿‘ä¸€æ¬¡çš„æäº¤(commit): (master)$ git show æˆ–è€… $ git log -n1 -p æˆ‘çš„æäº¤ä¿¡æ¯(commit message)å†™é”™äº† å¦‚æžœä½ çš„æäº¤ä¿¡æ¯(commit message)å†™é”™äº†ä¸”è¿™æ¬¡æäº¤(commit)è¿˜æ²¡æœ‰æŽ¨(push), ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ¥ä¿®æ”¹æäº¤ä¿¡æ¯(commit message): $ git commit --amend è¿™ä¼šæ‰“å¼€ä½ çš„é»˜è®¤ç¼–è¾‘å™¨, åœ¨è¿™é‡Œä½ å¯ä»¥ç¼–è¾‘ä¿¡æ¯. å¦ä¸€æ–¹é¢, ä½ ä¹Ÿå¯ä»¥ç”¨ä¸€æ¡å‘½ä»¤ä¸€æ¬¡å®Œæˆ: $ git commit --amend -m 'xxxxxxx' å¦‚æžœä½ å·²ç»æŽ¨(push)äº†è¿™æ¬¡æäº¤(commit), ä½ å¯ä»¥ä¿®æ”¹è¿™æ¬¡æäº¤(commit)ç„¶åŽå¼ºæŽ¨(force push), ä½†æ˜¯ä¸æŽ¨èè¿™ä¹ˆåšã€‚ æˆ‘æäº¤(commit)é‡Œçš„ç”¨æˆ·åå’Œé‚®ç®±ä¸å¯¹ å¦‚æžœè¿™åªæ˜¯å•ä¸ªæäº¤(commit)ï¼Œä¿®æ”¹å®ƒï¼š $ git commit --amend --author "New Authorname &lt;authoremail@mydomain.com&gt;" å¦‚æžœä½ éœ€è¦ä¿®æ”¹æ‰€æœ‰åŽ†å², å‚è€ƒ 'git filter-branchâ€™çš„æŒ‡å—é¡µ. æˆ‘æƒ³ä»Žä¸€ä¸ªæäº¤(commit)é‡Œç§»é™¤ä¸€ä¸ªæ–‡ä»¶ é€šè¿‡ä¸‹é¢çš„æ–¹æ³•ï¼Œä»Žä¸€ä¸ªæäº¤(commit)é‡Œç§»é™¤ä¸€ä¸ªæ–‡ä»¶: $ git checkout HEAD^ myfile$ git add -A$ git commit --amend è¿™å°†éžå¸¸æœ‰ç”¨ï¼Œå½“ä½ æœ‰ä¸€ä¸ªå¼€æ”¾çš„è¡¥ä¸(open patch)ï¼Œä½ å¾€ä¸Šé¢æäº¤äº†ä¸€ä¸ªä¸å¿…è¦çš„æ–‡ä»¶ï¼Œä½ éœ€è¦å¼ºæŽ¨(force push)åŽ»æ›´æ–°è¿™ä¸ªè¿œç¨‹è¡¥ä¸ã€‚ æˆ‘æƒ³åˆ é™¤æˆ‘çš„çš„æœ€åŽä¸€æ¬¡æäº¤(commit) å¦‚æžœä½ éœ€è¦åˆ é™¤æŽ¨äº†çš„æäº¤(pushed commits)ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ã€‚å¯æ˜¯ï¼Œè¿™ä¼šä¸å¯é€†çš„æ”¹å˜ä½ çš„åŽ†å²ï¼Œä¹Ÿä¼šæžä¹±é‚£äº›å·²ç»ä»Žè¯¥ä»“åº“æ‹‰å–(pulled)äº†çš„äººçš„åŽ†å²ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¦‚æžœä½ ä¸æ˜¯å¾ˆç¡®å®šï¼Œåƒä¸‡ä¸è¦è¿™ä¹ˆåšã€‚ $ git reset HEAD^ --hard$ git push -f [remote] [branch] å¦‚æžœä½ è¿˜æ²¡æœ‰æŽ¨åˆ°è¿œç¨‹, æŠŠ Git é‡ç½®(reset)åˆ°ä½ æœ€åŽä¸€æ¬¡æäº¤å‰çš„çŠ¶æ€å°±å¯ä»¥äº†(åŒæ—¶ä¿å­˜æš‚å­˜çš„å˜åŒ–): (my-branch*)$ git reset --soft HEAD@&#123;1&#125; è¿™åªèƒ½åœ¨æ²¡æœ‰æŽ¨é€ä¹‹å‰æœ‰ç”¨. å¦‚æžœä½ å·²ç»æŽ¨äº†, å”¯ä¸€å®‰å…¨èƒ½åšçš„æ˜¯ git revert SHAofBadCommitï¼Œ é‚£ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤(commit)ç”¨äºŽæ’¤æ¶ˆå‰ä¸€ä¸ªæäº¤çš„æ‰€æœ‰å˜åŒ–(changes)ï¼› æˆ–è€…, å¦‚æžœä½ æŽ¨çš„è¿™ä¸ªåˆ†æ”¯æ˜¯ rebase-safe çš„ (ä¾‹å¦‚ï¼š å…¶å®ƒå¼€å‘è€…ä¸ä¼šä»Žè¿™ä¸ªåˆ†æ”¯æ‹‰), åªéœ€è¦ä½¿ç”¨ git push -fï¼› æ›´å¤š, è¯·å‚è€ƒ the above sectionã€‚ åˆ é™¤ä»»æ„æäº¤(commit) åŒæ ·çš„è­¦å‘Šï¼šä¸åˆ°ä¸‡ä¸å¾—å·²çš„æ—¶å€™ä¸è¦è¿™ä¹ˆåš. $ git rebase --onto SHA1_OF_BAD_COMMIT^ SHA1_OF_BAD_COMMIT$ git push -f [remote] [branch] æˆ–è€…åšä¸€ä¸ª äº¤äº’å¼ rebase åˆ é™¤é‚£äº›ä½ æƒ³è¦åˆ é™¤çš„æäº¤(commit)é‡Œæ‰€å¯¹åº”çš„è¡Œã€‚ æˆ‘å°è¯•æŽ¨ä¸€ä¸ªä¿®æ­£åŽçš„æäº¤(amended commit)åˆ°è¿œç¨‹ï¼Œä½†æ˜¯æŠ¥é”™ï¼š To https://github.com/yourusername/repo.git! [rejected] mybranch -&gt; mybranch (non-fast-forward)error: failed to push some refs to 'https://github.com/tanay1337/webmaker.org.git'hint: Updates were rejected because the tip of your current branch is behindhint: its remote counterpart. Integrate the remote changes (e.g.hint: 'git pull ...') before pushing again.hint: See the 'Note about fast-forwards' in 'git push --help' for details. æ³¨æ„, rebasing(è§ä¸‹é¢)å’Œä¿®æ­£(amending)ä¼šç”¨ä¸€ä¸ªæ–°çš„æäº¤(commit)ä»£æ›¿æ—§çš„, æ‰€ä»¥å¦‚æžœä¹‹å‰ä½ å·²ç»å¾€è¿œç¨‹ä»“åº“ä¸ŠæŽ¨è¿‡ä¸€æ¬¡ä¿®æ­£å‰çš„æäº¤(commit)ï¼Œé‚£ä½ çŽ°åœ¨å°±å¿…é¡»å¼ºæŽ¨(force push) (-f)ã€‚ æ³¨æ„ â€“ æ€»æ˜¯ ç¡®ä¿ä½ æŒ‡æ˜Žä¸€ä¸ªåˆ†æ”¯! (my-branch)$ git push origin mybranch -f ä¸€èˆ¬æ¥è¯´, è¦é¿å…å¼ºæŽ¨. æœ€å¥½æ˜¯åˆ›å»ºå’ŒæŽ¨(push)ä¸€ä¸ªæ–°çš„æäº¤(commit)ï¼Œè€Œä¸æ˜¯å¼ºæŽ¨ä¸€ä¸ªä¿®æ­£åŽçš„æäº¤ã€‚åŽè€…ä¼šä½¿é‚£äº›ä¸Žè¯¥åˆ†æ”¯æˆ–è¯¥åˆ†æ”¯çš„å­åˆ†æ”¯å·¥ä½œçš„å¼€å‘è€…ï¼Œåœ¨æºåŽ†å²ä¸­äº§ç”Ÿå†²çªã€‚ æˆ‘æ„å¤–çš„åšäº†ä¸€æ¬¡ç¡¬é‡ç½®(hard reset)ï¼Œæˆ‘æƒ³æ‰¾å›žæˆ‘çš„å†…å®¹ å¦‚æžœä½ æ„å¤–çš„åšäº† git reset --hard, ä½ é€šå¸¸èƒ½æ‰¾å›žä½ çš„æäº¤(commit), å› ä¸º Git å¯¹æ¯ä»¶äº‹éƒ½ä¼šæœ‰æ—¥å¿—ï¼Œä¸”éƒ½ä¼šä¿å­˜å‡ å¤©ã€‚ (master)$ git reflog ä½ å°†ä¼šçœ‹åˆ°ä¸€ä¸ªä½ è¿‡åŽ»æäº¤(commit)çš„åˆ—è¡¨, å’Œä¸€ä¸ªé‡ç½®çš„æäº¤ã€‚ é€‰æ‹©ä½ æƒ³è¦å›žåˆ°çš„æäº¤(commit)çš„ SHAï¼Œå†é‡ç½®ä¸€æ¬¡: (master)$ git reset --hard SHA1234 è¿™æ ·å°±å®Œæˆäº†ã€‚ æš‚å­˜(Staging) æˆ‘éœ€è¦æŠŠæš‚å­˜çš„å†…å®¹æ·»åŠ åˆ°ä¸Šä¸€æ¬¡çš„æäº¤(commit) (my-branch*)$ git commit --amend æˆ‘æƒ³è¦æš‚å­˜ä¸€ä¸ªæ–°æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯è¿™ä¸ªæ–‡ä»¶çš„å…¨éƒ¨ ä¸€èˆ¬æ¥è¯´, å¦‚æžœä½ æƒ³æš‚å­˜ä¸€ä¸ªæ–‡ä»¶çš„ä¸€éƒ¨åˆ†, ä½ å¯è¿™æ ·åš: $ git add --patch filename.x -p ç®€å†™ã€‚è¿™ä¼šæ‰“å¼€äº¤äº’æ¨¡å¼ï¼Œ ä½ å°†èƒ½å¤Ÿç”¨ s é€‰é¡¹æ¥åˆ†éš”æäº¤(commit)ï¼› ç„¶è€Œ, å¦‚æžœè¿™ä¸ªæ–‡ä»¶æ˜¯æ–°çš„, ä¼šæ²¡æœ‰è¿™ä¸ªé€‰æ‹©ï¼Œ æ·»åŠ ä¸€ä¸ªæ–°æ–‡ä»¶æ—¶, è¿™æ ·åš: $ git add -N filename.x ç„¶åŽ, ä½ éœ€è¦ç”¨ e é€‰é¡¹æ¥æ‰‹åŠ¨é€‰æ‹©éœ€è¦æ·»åŠ çš„è¡Œï¼Œæ‰§è¡Œ git diff --cached å°†ä¼šæ˜¾ç¤ºå“ªäº›è¡Œæš‚å­˜äº†å“ªäº›è¡Œåªæ˜¯ä¿å­˜åœ¨æœ¬åœ°äº†ã€‚ æˆ‘æƒ³æŠŠåœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œçš„å˜åŒ–(changes)åŠ åˆ°ä¸¤ä¸ªæäº¤(commit)é‡Œ git add ä¼šæŠŠæ•´ä¸ªæ–‡ä»¶åŠ å…¥åˆ°ä¸€ä¸ªæäº¤. git add -p å…è®¸äº¤äº’å¼çš„é€‰æ‹©ä½ æƒ³è¦æäº¤çš„éƒ¨åˆ†. æˆ‘æƒ³æŠŠæš‚å­˜çš„å†…å®¹å˜æˆæœªæš‚å­˜ï¼ŒæŠŠæœªæš‚å­˜çš„å†…å®¹æš‚å­˜èµ·æ¥ è¿™ä¸ªæœ‰ç‚¹å›°éš¾ï¼Œ æˆ‘èƒ½æƒ³åˆ°çš„æœ€å¥½çš„æ–¹æ³•æ˜¯å…ˆ stash æœªæš‚å­˜çš„å†…å®¹ï¼Œ ç„¶åŽé‡ç½®(reset)ï¼Œå† pop ç¬¬ä¸€æ­¥ stashed çš„å†…å®¹, æœ€åŽå† add å®ƒä»¬ã€‚ $ git stash -k$ git reset --hard$ git stash pop$ git add -A æœªæš‚å­˜(Unstaged)çš„å†…å®¹ æˆ‘æƒ³æŠŠæœªæš‚å­˜çš„å†…å®¹ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯ $ git checkout -b my-branch æˆ‘æƒ³æŠŠæœªæš‚å­˜çš„å†…å®¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå·²å­˜åœ¨çš„åˆ†æ”¯ $ git stash$ git checkout my-branch$ git stash pop æˆ‘æƒ³ä¸¢å¼ƒæœ¬åœ°æœªæäº¤çš„å˜åŒ–(uncommitted changes) å¦‚æžœä½ åªæ˜¯æƒ³é‡ç½®æº(origin)å’Œä½ æœ¬åœ°(local)ä¹‹é—´çš„ä¸€äº›æäº¤(commit)ï¼Œä½ å¯ä»¥ï¼š ## one commit(my-branch)$ git reset --hard HEAD^## two commits(my-branch)$ git reset --hard HEAD^^## four commits(my-branch)$ git reset --hard HEAD~4## or(master)$ git checkout -f é‡ç½®æŸä¸ªç‰¹æ®Šçš„æ–‡ä»¶, ä½ å¯ä»¥ç”¨æ–‡ä»¶ååšä¸ºå‚æ•°: $ git reset filename æˆ‘æƒ³ä¸¢å¼ƒæŸäº›æœªæš‚å­˜çš„å†…å®¹ å¦‚æžœä½ æƒ³ä¸¢å¼ƒå·¥ä½œæ‹·è´ä¸­çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ã€‚ ç­¾å‡º(checkout)ä¸éœ€è¦çš„å†…å®¹ï¼Œä¿ç•™éœ€è¦çš„ã€‚ $ git checkout -p## Answer y to all of the snippets you want to drop å¦å¤–ä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨ stashï¼Œ Stash æ‰€æœ‰è¦ä¿ç•™ä¸‹çš„å†…å®¹, é‡ç½®å·¥ä½œæ‹·è´, é‡æ–°åº”ç”¨ä¿ç•™çš„éƒ¨åˆ†ã€‚ $ git stash -p## Select all of the snippets you want to save$ git reset --hard$ git stash pop æˆ–è€…, stash ä½ ä¸éœ€è¦çš„éƒ¨åˆ†, ç„¶åŽ stash dropã€‚ $ git stash -p## Select all of the snippets you don't want to save$ git stash drop åˆ†æ”¯(Branches) æˆ‘ä»Žé”™è¯¯çš„åˆ†æ”¯æ‹‰å–äº†å†…å®¹ï¼Œæˆ–æŠŠå†…å®¹æ‹‰å–åˆ°äº†é”™è¯¯çš„åˆ†æ”¯ è¿™æ˜¯å¦å¤–ä¸€ç§ä½¿ç”¨ git reflog æƒ…å†µï¼Œæ‰¾åˆ°åœ¨è¿™æ¬¡é”™è¯¯æ‹‰(pull) ä¹‹å‰ HEAD çš„æŒ‡å‘ã€‚ (master)$ git reflogab7555f HEAD@&#123;0&#125;: pull origin wrong-branch: Fast-forwardc5bc55a HEAD@&#123;1&#125;: checkout: checkout message goes here é‡ç½®åˆ†æ”¯åˆ°ä½ æ‰€éœ€çš„æäº¤(desired commit): $ git reset --hard c5bc55a å®Œæˆã€‚ æˆ‘æƒ³æ‰”æŽ‰æœ¬åœ°çš„æäº¤(commit)ï¼Œä»¥ä¾¿æˆ‘çš„åˆ†æ”¯ä¸Žè¿œç¨‹çš„ä¿æŒä¸€è‡´ å…ˆç¡®è®¤ä½ æ²¡æœ‰æŽ¨(push)ä½ çš„å†…å®¹åˆ°è¿œç¨‹ã€‚ git status ä¼šæ˜¾ç¤ºä½ é¢†å…ˆ(ahead)æº(origin)å¤šå°‘ä¸ªæäº¤: (my-branch)$ git status## On branch my-branch## Your branch is ahead of 'origin/my-branch' by 2 commits.## (use "git push" to publish your local commits)# ä¸€ç§æ–¹æ³•æ˜¯: (master)$ git reset --hard origin/my-branch æˆ‘éœ€è¦æäº¤åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œä½†é”™è¯¯çš„æäº¤åˆ°äº† master åœ¨ master ä¸‹åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œä¸åˆ‡æ¢åˆ°æ–°åˆ†æ”¯,ä»åœ¨ master ä¸‹: (master)$ git branch my-branch æŠŠ master åˆ†æ”¯é‡ç½®åˆ°å‰ä¸€ä¸ªæäº¤: (master)$ git reset --hard HEAD^ HEAD^ æ˜¯ HEAD^1 çš„ç®€å†™ï¼Œä½ å¯ä»¥é€šè¿‡æŒ‡å®šè¦è®¾ç½®çš„HEADæ¥è¿›ä¸€æ­¥é‡ç½®ã€‚ æˆ–è€…, å¦‚æžœä½ ä¸æƒ³ä½¿ç”¨ HEAD^, æ‰¾åˆ°ä½ æƒ³é‡ç½®åˆ°çš„æäº¤(commit)çš„ hash(git log èƒ½å¤Ÿå®Œæˆ)ï¼Œ ç„¶åŽé‡ç½®åˆ°è¿™ä¸ª hashã€‚ ä½¿ç”¨git push åŒæ­¥å†…å®¹åˆ°è¿œç¨‹ã€‚ ä¾‹å¦‚, master åˆ†æ”¯æƒ³é‡ç½®åˆ°çš„æäº¤çš„ hash ä¸ºa13b85e: (master)$ git reset --hard a13b85eHEAD is now at a13b85e ç­¾å‡º(checkout)åˆšæ‰æ–°å»ºçš„åˆ†æ”¯ç»§ç»­å·¥ä½œ: (master)$ git checkout my-branch æˆ‘æƒ³ä¿ç•™æ¥è‡ªå¦å¤–ä¸€ä¸ª ref-ish çš„æ•´ä¸ªæ–‡ä»¶ å‡è®¾ä½ æ­£åœ¨åšä¸€ä¸ªåŽŸåž‹æ–¹æ¡ˆ(åŽŸæ–‡ä¸º working spike (see note)), æœ‰æˆç™¾çš„å†…å®¹ï¼Œæ¯ä¸ªéƒ½å·¥ä½œå¾—å¾ˆå¥½ã€‚çŽ°åœ¨, ä½ æäº¤åˆ°äº†ä¸€ä¸ªåˆ†æ”¯ï¼Œä¿å­˜å·¥ä½œå†…å®¹: (solution)$ git add -A &amp;&amp; git commit -m "Adding all changes from this spike into one big commit." å½“ä½ æƒ³è¦æŠŠå®ƒæ”¾åˆ°ä¸€ä¸ªåˆ†æ”¯é‡Œ (å¯èƒ½æ˜¯feature, æˆ–è€… develop), ä½ å…³å¿ƒæ˜¯ä¿æŒæ•´ä¸ªæ–‡ä»¶çš„å®Œæ•´ï¼Œä½ æƒ³è¦ä¸€ä¸ªå¤§çš„æäº¤åˆ†éš”æˆæ¯”è¾ƒå°ã€‚ å‡è®¾ä½ æœ‰: åˆ†æ”¯ solution, æ‹¥æœ‰åŽŸåž‹æ–¹æ¡ˆï¼Œ é¢†å…ˆ develop åˆ†æ”¯ã€‚ åˆ†æ”¯ develop, åœ¨è¿™é‡Œä½ åº”ç”¨åŽŸåž‹æ–¹æ¡ˆçš„ä¸€äº›å†…å®¹ã€‚ æˆ‘åŽ»å¯ä»¥é€šè¿‡æŠŠå†…å®¹æ‹¿åˆ°ä½ çš„åˆ†æ”¯é‡Œï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜: (develop)$ git checkout solution -- file1.txt è¿™ä¼šæŠŠè¿™ä¸ªæ–‡ä»¶å†…å®¹ä»Žåˆ†æ”¯ solution æ‹¿åˆ°åˆ†æ”¯ develop é‡Œæ¥: ## On branch develop## Your branch is up-to-date with 'origin/develop'.## Changes to be committed:## (use "git reset HEAD &lt;file&gt;..." to unstage)### modified: file1.txt ç„¶åŽ, æ­£å¸¸æäº¤ã€‚ Note: Spike solutions are made to analyze or solve the problem. These solutions are used for estimation and discarded once everyone gets clear visualization of the problem. ~ Wikipedia. æˆ‘æŠŠå‡ ä¸ªæäº¤(commit)æäº¤åˆ°äº†åŒä¸€ä¸ªåˆ†æ”¯ï¼Œè€Œè¿™äº›æäº¤åº”è¯¥åˆ†å¸ƒåœ¨ä¸åŒçš„åˆ†æ”¯é‡Œ å‡è®¾ä½ æœ‰ä¸€ä¸ªmasteråˆ†æ”¯ï¼Œ æ‰§è¡Œgit log, ä½ çœ‹åˆ°ä½ åšè¿‡ä¸¤æ¬¡æäº¤: (master)$ git logcommit e3851e817c451cc36f2e6f3049db528415e3c114Author: Alex Lee &lt;alexlee@example.com&gt;Date: Tue Jul 22 15:39:27 2014 -0400 Bug #21 - Added CSRF protectioncommit 5ea51731d150f7ddc4a365437931cd8be3bf3131Author: Alex Lee &lt;alexlee@example.com&gt;Date: Tue Jul 22 15:39:12 2014 -0400 Bug #14 - Fixed spacing on titlecommit a13b85e984171c6e2a1729bb061994525f626d14Author: Aki Rose &lt;akirose@example.com&gt;Date: Tue Jul 21 01:12:48 2014 -0400 First commit è®©æˆ‘ä»¬ç”¨æäº¤ hash(commit hash)æ ‡è®° bug (e3851e8 for #21, 5ea5173 for #14). é¦–å…ˆ, æˆ‘ä»¬æŠŠmasteråˆ†æ”¯é‡ç½®åˆ°æ­£ç¡®çš„æäº¤(a13b85e): (master)$ git reset --hard a13b85eHEAD is now at a13b85e çŽ°åœ¨, æˆ‘ä»¬å¯¹ bug #21 åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯: (master)$ git checkout -b 21(21)$ æŽ¥ç€, æˆ‘ä»¬ç”¨ cherry-pick æŠŠå¯¹ bug #21 çš„æäº¤æ”¾å…¥å½“å‰åˆ†æ”¯ã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬å°†åº”ç”¨(apply)è¿™ä¸ªæäº¤(commit)ï¼Œä»…ä»…è¿™ä¸€ä¸ªæäº¤(commit)ï¼Œç›´æŽ¥åœ¨ HEAD ä¸Šé¢ã€‚ (21)$ git cherry-pick e3851e8 è¿™æ—¶å€™, è¿™é‡Œå¯èƒ½ä¼šäº§ç”Ÿå†²çªï¼Œ å‚è§äº¤äº’å¼ rebasing ç«  å†²çªèŠ‚ è§£å†³å†²çª. å†è€…ï¼Œ æˆ‘ä»¬ä¸º bug #14 åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯, ä¹ŸåŸºäºŽmasteråˆ†æ”¯ (21)$ git checkout master(master)$ git checkout -b 14(14)$ æœ€åŽ, ä¸º bug #14 æ‰§è¡Œ cherry-pick: (14)$ git cherry-pick 5ea5173 æˆ‘æƒ³åˆ é™¤ä¸Šæ¸¸(upstream)åˆ†æ”¯è¢«åˆ é™¤äº†çš„æœ¬åœ°åˆ†æ”¯ ä¸€æ—¦ä½ åœ¨ github ä¸Šé¢åˆå¹¶(merge)äº†ä¸€ä¸ª pull request, ä½ å°±å¯ä»¥åˆ é™¤ä½  fork é‡Œè¢«åˆå¹¶çš„åˆ†æ”¯ã€‚ å¦‚æžœä½ ä¸å‡†å¤‡ç»§ç»­åœ¨è¿™ä¸ªåˆ†æ”¯é‡Œå·¥ä½œ, åˆ é™¤è¿™ä¸ªåˆ†æ”¯çš„æœ¬åœ°æ‹·è´ä¼šæ›´å¹²å‡€ï¼Œä½¿ä½ ä¸ä¼šé™·å…¥å·¥ä½œåˆ†æ”¯å’Œä¸€å †é™ˆæ—§åˆ†æ”¯çš„æ··ä¹±ä¹‹ä¸­ã€‚ $ git fetch -p æˆ‘ä¸å°å¿ƒåˆ é™¤äº†æˆ‘çš„åˆ†æ”¯ å¦‚æžœä½ å®šæœŸæŽ¨é€åˆ°è¿œç¨‹, å¤šæ•°æƒ…å†µä¸‹åº”è¯¥æ˜¯å®‰å…¨çš„ï¼Œä½†æœ‰äº›æ—¶å€™è¿˜æ˜¯å¯èƒ½åˆ é™¤äº†è¿˜æ²¡æœ‰æŽ¨åˆ°è¿œç¨‹çš„åˆ†æ”¯ã€‚ è®©æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªåˆ†æ”¯å’Œä¸€ä¸ªæ–°çš„æ–‡ä»¶: (master)$ git checkout -b my-branch(my-branch)$ git branch(my-branch)$ touch foo.txt(my-branch)$ lsREADME.md foo.txt æ·»åŠ æ–‡ä»¶å¹¶åšä¸€æ¬¡æäº¤ (my-branch)$ git add .(my-branch)$ git commit -m 'foo.txt added'(my-branch)$ foo.txt added 1 files changed, 1 insertions(+) create mode 100644 foo.txt(my-branch)$ git logcommit 4e3cd85a670ced7cc17a2b5d8d3d809ac88d5012Author: siemiatj &lt;siemiatj@example.com&gt;Date: Wed Jul 30 00:34:10 2014 +0200 foo.txt addedcommit 69204cdf0acbab201619d95ad8295928e7f411d5Author: Kate Hudson &lt;katehudson@example.com&gt;Date: Tue Jul 29 13:14:46 2014 -0400 Fixes #6: Force pushing after amending commits çŽ°åœ¨æˆ‘ä»¬åˆ‡å›žåˆ°ä¸»(master)åˆ†æ”¯ï¼Œâ€˜ä¸å°å¿ƒçš„â€™åˆ é™¤my-branchåˆ†æ”¯ (my-branch)$ git checkout masterSwitched to branch 'master'Your branch is up-to-date with 'origin/master'.(master)$ git branch -D my-branchDeleted branch my-branch (was 4e3cd85).(master)$ echo oh noes, deleted my branch!oh noes, deleted my branch! åœ¨è¿™æ—¶å€™ä½ åº”è¯¥æƒ³èµ·äº†reflog, ä¸€ä¸ªå‡çº§ç‰ˆçš„æ—¥å¿—ï¼Œå®ƒå­˜å‚¨äº†ä»“åº“(repo)é‡Œé¢æ‰€æœ‰åŠ¨ä½œçš„åŽ†å²ã€‚ (master)$ git reflog69204cd HEAD@&#123;0&#125;: checkout: moving from my-branch to master4e3cd85 HEAD@&#123;1&#125;: commit: foo.txt added69204cd HEAD@&#123;2&#125;: checkout: moving from master to my-branch æ­£å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ¥è‡ªåˆ é™¤åˆ†æ”¯çš„æäº¤ hash(commit hash)ï¼ŒæŽ¥ä¸‹æ¥çœ‹çœ‹æ˜¯å¦èƒ½æ¢å¤åˆ é™¤äº†çš„åˆ†æ”¯ã€‚ (master)$ git checkout -b my-branch-helpSwitched to a new branch 'my-branch-help'(my-branch-help)$ git reset --hard 4e3cd85HEAD is now at 4e3cd85 foo.txt added(my-branch-help)$ lsREADME.md foo.txt çœ‹! æˆ‘ä»¬æŠŠåˆ é™¤çš„æ–‡ä»¶æ‰¾å›žæ¥äº†ã€‚ Git çš„ reflog åœ¨ rebasing å‡ºé”™çš„æ—¶å€™ä¹Ÿæ˜¯åŒæ ·æœ‰ç”¨çš„ã€‚ æˆ‘æƒ³åˆ é™¤ä¸€ä¸ªåˆ†æ”¯ åˆ é™¤ä¸€ä¸ªè¿œç¨‹åˆ†æ”¯: (master)$ git push origin --delete my-branch ä½ ä¹Ÿå¯ä»¥: (master)$ git push origin :my-branch åˆ é™¤ä¸€ä¸ªæœ¬åœ°åˆ†æ”¯: (master)$ git branch -D my-branch æˆ‘æƒ³ä»Žåˆ«äººæ­£åœ¨å·¥ä½œçš„è¿œç¨‹åˆ†æ”¯ç­¾å‡º(checkout)ä¸€ä¸ªåˆ†æ”¯ é¦–å…ˆ, ä»Žè¿œç¨‹æ‹‰å–(fetch) æ‰€æœ‰åˆ†æ”¯: (master)$ git fetch --all å‡è®¾ä½ æƒ³è¦ä»Žè¿œç¨‹çš„davesåˆ†æ”¯ç­¾å‡ºåˆ°æœ¬åœ°çš„daves (master)$ git checkout --track origin/davesBranch daves set up to track remote branch daves from origin.Switched to a new branch 'daves' (--track æ˜¯ git checkout -b [branch] [remotename]/[branch] çš„ç®€å†™) è¿™æ ·å°±å¾—åˆ°äº†ä¸€ä¸ªdavesåˆ†æ”¯çš„æœ¬åœ°æ‹·è´, ä»»ä½•æŽ¨è¿‡(pushed)çš„æ›´æ–°ï¼Œè¿œç¨‹éƒ½èƒ½çœ‹åˆ°. Rebasing å’Œåˆå¹¶(Merging) æˆ‘æƒ³æ’¤é”€ rebase/merge ä½ å¯ä»¥åˆå¹¶(merge)æˆ– rebase äº†ä¸€ä¸ªé”™è¯¯çš„åˆ†æ”¯, æˆ–è€…å®Œæˆä¸äº†ä¸€ä¸ªè¿›è¡Œä¸­çš„ rebase/mergeã€‚ Git åœ¨è¿›è¡Œå±é™©æ“ä½œçš„æ—¶å€™ä¼šæŠŠåŽŸå§‹çš„ HEAD ä¿å­˜åœ¨ä¸€ä¸ªå« ORIG_HEAD çš„å˜é‡é‡Œ, æ‰€ä»¥è¦æŠŠåˆ†æ”¯æ¢å¤åˆ° rebase/merge å‰çš„çŠ¶æ€æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ (my-branch)$ git reset --hard ORIG_HEAD æˆ‘å·²ç» rebase è¿‡, ä½†æ˜¯æˆ‘ä¸æƒ³å¼ºæŽ¨(force push) ä¸å¹¸çš„æ˜¯ï¼Œå¦‚æžœä½ æƒ³æŠŠè¿™äº›å˜åŒ–(changes)ååº”åˆ°è¿œç¨‹åˆ†æ”¯ä¸Šï¼Œä½ å°±å¿…é¡»å¾—å¼ºæŽ¨(force push)ã€‚ æ˜¯å› ä½ å¿«è¿›(Fast forward)äº†æäº¤ï¼Œæ”¹å˜äº† Git åŽ†å², è¿œç¨‹åˆ†æ”¯ä¸ä¼šæŽ¥å—å˜åŒ–(changes)ï¼Œé™¤éžå¼ºæŽ¨(force push)ã€‚è¿™å°±æ˜¯è®¸å¤šäººä½¿ç”¨ merge å·¥ä½œæµ, è€Œä¸æ˜¯ rebasing å·¥ä½œæµçš„ä¸»è¦åŽŸå› ä¹‹ä¸€ï¼Œ å¼€å‘è€…çš„å¼ºæŽ¨(force push)ä¼šä½¿å¤§çš„å›¢é˜Ÿé™·å…¥éº»çƒ¦ã€‚ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ï¼Œä¸€ç§å®‰å…¨ä½¿ç”¨ rebase çš„æ–¹æ³•æ˜¯ï¼Œä¸è¦æŠŠä½ çš„å˜åŒ–(changes)åæ˜ åˆ°è¿œç¨‹åˆ†æ”¯ä¸Š, è€Œæ˜¯æŒ‰ä¸‹é¢çš„åš: (master)$ git checkout my-branch(my-branch)$ git rebase -i master(my-branch)$ git checkout master(master)$ git merge --ff-only my-branch æ›´å¤š, å‚è§ this SO thread. æˆ‘éœ€è¦ç»„åˆ(combine)å‡ ä¸ªæäº¤(commit) å‡è®¾ä½ çš„å·¥ä½œåˆ†æ”¯å°†ä¼šåšå¯¹äºŽ master çš„ pull-requestã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ä½ ä¸å…³å¿ƒæäº¤(commit)çš„æ—¶é—´æˆ³ï¼Œåªæƒ³ç»„åˆ æ‰€æœ‰ æäº¤(commit) åˆ°ä¸€ä¸ªå•ç‹¬çš„é‡Œé¢, ç„¶åŽé‡ç½®(reset)é‡æäº¤(recommit)ã€‚ ç¡®ä¿ä¸»(master)åˆ†æ”¯æ˜¯æœ€æ–°çš„å’Œä½ çš„å˜åŒ–éƒ½å·²ç»æäº¤äº†, ç„¶åŽ: (my-branch)$ git reset --soft master(my-branch)$ git commit -am "New awesome feature" å¦‚æžœä½ æƒ³è¦æ›´å¤šçš„æŽ§åˆ¶, æƒ³è¦ä¿ç•™æ—¶é—´æˆ³, ä½ éœ€è¦åšäº¤äº’å¼ rebase (interactive rebase): (my-branch)$ git rebase -i master å¦‚æžœæ²¡æœ‰ç›¸å¯¹çš„å…¶å®ƒåˆ†æ”¯ï¼Œ ä½ å°†ä¸å¾—ä¸ç›¸å¯¹è‡ªå·±çš„HEAD è¿›è¡Œ rebaseã€‚ ä¾‹å¦‚ï¼šä½ æƒ³ç»„åˆæœ€è¿‘çš„ä¸¤æ¬¡æäº¤(commit), ä½ å°†ç›¸å¯¹äºŽHEAD\~2 è¿›è¡Œ rebaseï¼Œ ç»„åˆæœ€è¿‘ 3 æ¬¡æäº¤(commit), ç›¸å¯¹äºŽHEAD\~3, ç­‰ç­‰ã€‚ (master)$ git rebase -i HEAD~2 åœ¨ä½ æ‰§è¡Œäº†äº¤äº’å¼ rebase çš„å‘½ä»¤(interactive rebase command)åŽ, ä½ å°†åœ¨ä½ çš„ç¼–è¾‘å™¨é‡Œçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹: pick a9c8a1d Some refactoringpick 01b2fd8 New awesome featurepick b729ad5 fixuppick e3851e8 another fix## Rebase 8074d12..b729ad5 onto 8074d12### Commands:## p, pick = use commit## r, reword = use commit, but edit the commit message## e, edit = use commit, but stop for amending## s, squash = use commit, but meld into previous commit## f, fixup = like "squash", but discard this commit's log message## x, exec = run command (the rest of the line) using shell### These lines can be re-ordered; they are executed from top to bottom.### If you remove a line here THAT COMMIT WILL BE LOST.### However, if you remove everything, the rebase will be aborted.### Note that empty commits are commented out æ‰€æœ‰ä»¥ # å¼€å¤´çš„è¡Œéƒ½æ˜¯æ³¨é‡Š, ä¸ä¼šå½±å“ rebase. ç„¶åŽï¼Œä½ å¯ä»¥ç”¨ä»»ä½•ä¸Šé¢å‘½ä»¤åˆ—è¡¨çš„å‘½ä»¤æ›¿æ¢ pick, ä½ ä¹Ÿå¯ä»¥é€šè¿‡åˆ é™¤å¯¹åº”çš„è¡Œæ¥åˆ é™¤ä¸€ä¸ªæäº¤(commit)ã€‚ ä¾‹å¦‚, å¦‚æžœä½ æƒ³ å•ç‹¬ä¿ç•™æœ€æ—§(first)çš„æäº¤(commit),ç»„åˆæ‰€æœ‰å‰©ä¸‹çš„åˆ°ç¬¬äºŒä¸ªé‡Œé¢, ä½ å°±åº”è¯¥ç¼–è¾‘ç¬¬äºŒä¸ªæäº¤(commit)åŽé¢çš„æ¯ä¸ªæäº¤(commit) å‰çš„å•è¯ä¸º f: pick a9c8a1d Some refactoringpick 01b2fd8 New awesome featuref b729ad5 fixupf e3851e8 another fix å¦‚æžœä½ æƒ³ç»„åˆè¿™äº›æäº¤(commit) å¹¶é‡å‘½åè¿™ä¸ªæäº¤(commit), ä½ åº”è¯¥åœ¨ç¬¬äºŒä¸ªæäº¤(commit)æ—è¾¹æ·»åŠ ä¸€ä¸ªrï¼Œæˆ–è€…æ›´ç®€å•çš„ç”¨s æ›¿ä»£ f: pick a9c8a1d Some refactoringpick 01b2fd8 New awesome features b729ad5 fixups e3851e8 another fix ä½ å¯ä»¥åœ¨æŽ¥ä¸‹æ¥å¼¹å‡ºçš„æ–‡æœ¬æç¤ºæ¡†é‡Œé‡å‘½åæäº¤(commit)ã€‚ Newer, awesomer features## Please enter the commit message for your changes. Lines starting## with '#' will be ignored, and an empty message aborts the commit.## rebase in progress; onto 8074d12## You are currently editing a commit while rebasing branch 'master' on '8074d12'.### Changes to be committed:# modified: README.md# å¦‚æžœæˆåŠŸäº†, ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹: (master)$ Successfully rebased and updated refs/heads/master. å®‰å…¨åˆå¹¶(merging)ç­–ç•¥ --no-commit æ‰§è¡Œåˆå¹¶(merge)ä½†ä¸è‡ªåŠ¨æäº¤, ç»™ç”¨æˆ·åœ¨åšæäº¤å‰æ£€æŸ¥å’Œä¿®æ”¹çš„æœºä¼šã€‚ no-ff ä¼šä¸ºç‰¹æ€§åˆ†æ”¯(feature branch)çš„å­˜åœ¨è¿‡ç•™ä¸‹è¯æ®, ä¿æŒé¡¹ç›®åŽ†å²ä¸€è‡´ã€‚ (master)$ git merge --no-ff --no-commit my-branch æˆ‘éœ€è¦å°†ä¸€ä¸ªåˆ†æ”¯åˆå¹¶æˆä¸€ä¸ªæäº¤(commit) (master)$ git merge --squash my-branch æˆ‘åªæƒ³ç»„åˆ(combine)æœªæŽ¨çš„æäº¤(unpushed commit) æœ‰æ—¶å€™ï¼Œåœ¨å°†æ•°æ®æŽ¨å‘ä¸Šæ¸¸ä¹‹å‰ï¼Œä½ æœ‰å‡ ä¸ªæ­£åœ¨è¿›è¡Œçš„å·¥ä½œæäº¤(commit)ã€‚è¿™æ—¶å€™ä¸å¸Œæœ›æŠŠå·²ç»æŽ¨(push)è¿‡çš„ç»„åˆè¿›æ¥ï¼Œå› ä¸ºå…¶ä»–äººå¯èƒ½å·²ç»æœ‰æäº¤(commit)å¼•ç”¨å®ƒä»¬äº†ã€‚ (master)$ git rebase -i @&#123;u&#125; è¿™ä¼šäº§ç”Ÿä¸€æ¬¡äº¤äº’å¼çš„ rebase(interactive rebase), åªä¼šåˆ—å‡ºæ²¡æœ‰æŽ¨(push)çš„æäº¤(commit)ï¼Œ åœ¨è¿™ä¸ªåˆ—è¡¨æ—¶è¿›è¡Œ reorder/fix/squash éƒ½æ˜¯å®‰å…¨çš„ã€‚ æ£€æŸ¥æ˜¯å¦åˆ†æ”¯ä¸Šçš„æ‰€æœ‰æäº¤(commit)éƒ½åˆå¹¶(merge)è¿‡äº† æ£€æŸ¥ä¸€ä¸ªåˆ†æ”¯ä¸Šçš„æ‰€æœ‰æäº¤(commit)æ˜¯å¦éƒ½å·²ç»åˆå¹¶(merge)åˆ°äº†å…¶å®ƒåˆ†æ”¯, ä½ åº”è¯¥åœ¨è¿™äº›åˆ†æ”¯çš„ head(æˆ–ä»»ä½• commits)ä¹‹é—´åšä¸€æ¬¡ diff: (master)$ git log --graph --left-right --cherry-pick --oneline HEAD...feature/120-on-scroll è¿™ä¼šå‘Šè¯‰ä½ åœ¨ä¸€ä¸ªåˆ†æ”¯é‡Œæœ‰è€Œå¦ä¸€ä¸ªåˆ†æ”¯æ²¡æœ‰çš„æ‰€æœ‰æäº¤(commit), å’Œåˆ†æ”¯ä¹‹é—´ä¸å…±äº«çš„æäº¤(commit)çš„åˆ—è¡¨ã€‚ å¦ä¸€ä¸ªåšæ³•å¯ä»¥æ˜¯: (master)$ git log master ^feature/120-on-scroll --no-merges äº¤äº’å¼ rebase(interactive rebase)å¯èƒ½å‡ºçŽ°çš„é—®é¢˜ è¿™ä¸ª rebase ç¼–è¾‘å±å¹•å‡ºçŽ°â€™noopâ€™ å¦‚æžœä½ çœ‹åˆ°çš„æ˜¯è¿™æ ·: noop è¿™æ„å‘³ç€ä½  rebase çš„åˆ†æ”¯å’Œå½“å‰åˆ†æ”¯åœ¨åŒä¸€ä¸ªæäº¤(commit)ä¸Š, æˆ–è€… é¢†å…ˆ(ahead) å½“å‰åˆ†æ”¯ã€‚ ä½ å¯ä»¥å°è¯•: æ£€æŸ¥ç¡®ä¿ä¸»(master)åˆ†æ”¯æ²¡æœ‰é—®é¢˜ rebase HEAD\~2 æˆ–è€…æ›´æ—© æœ‰å†²çªçš„æƒ…å†µ å¦‚æžœä½ ä¸èƒ½æˆåŠŸçš„å®Œæˆ rebase, ä½ å¯èƒ½å¿…é¡»è¦è§£å†³å†²çªã€‚ é¦–å…ˆæ‰§è¡Œ git status æ‰¾å‡ºå“ªäº›æ–‡ä»¶æœ‰å†²çª: (my-branch)$ git statusOn branch my-branchChanges not staged for commit: (use "git add &lt;file&gt;..." to update what will be committed) (use "git checkout -- &lt;file&gt;..." to discard changes in working directory) modified: README.md åœ¨è¿™ä¸ªä¾‹å­é‡Œé¢, README.md æœ‰å†²çªã€‚ æ‰“å¼€è¿™ä¸ªæ–‡ä»¶æ‰¾åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹: &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEADsome code=========some code&gt;&gt;&gt;&gt;&gt;&gt;&gt; new-commit ä½ éœ€è¦è§£å†³æ–°æäº¤çš„ä»£ç (ç¤ºä¾‹é‡Œ, ä»Žä¸­é—´==çº¿åˆ°new-commitçš„åœ°æ–¹)ä¸ŽHEAD ä¹‹é—´ä¸ä¸€æ ·çš„åœ°æ–¹. æœ‰æ—¶å€™è¿™äº›åˆå¹¶éžå¸¸å¤æ‚ï¼Œä½ åº”è¯¥ä½¿ç”¨å¯è§†åŒ–çš„å·®å¼‚ç¼–è¾‘å™¨(visual diff editor): (master*)$ git mergetool -t opendiff åœ¨ä½ è§£å†³å®Œæ‰€æœ‰å†²çªå’Œæµ‹è¯•è¿‡åŽ, git add å˜åŒ–äº†çš„(changed)æ–‡ä»¶, ç„¶åŽç”¨git rebase --continue ç»§ç»­ rebaseã€‚ (my-branch)$ git add README.md(my-branch)$ git rebase --continue å¦‚æžœåœ¨è§£å†³å®Œæ‰€æœ‰çš„å†²çªè¿‡åŽï¼Œå¾—åˆ°äº†ä¸Žæäº¤å‰ä¸€æ ·çš„ç»“æžœ, å¯ä»¥æ‰§è¡Œgit rebase --skipã€‚ ä»»ä½•æ—¶å€™ä½ æƒ³ç»“æŸæ•´ä¸ª rebase è¿‡ç¨‹ï¼Œå›žæ¥ rebase å‰çš„åˆ†æ”¯çŠ¶æ€, ä½ å¯ä»¥åš: (my-branch)$ git rebase --abort æ‚é¡¹(Miscellaneous Objects) å…‹éš†æ‰€æœ‰å­æ¨¡å— $ git clone --recursive git://github.com/foo/bar.git å¦‚æžœå·²ç»å…‹éš†äº†: $ git submodule update --init --recursive åˆ é™¤æ ‡ç­¾(tag) $ git tag -d &lt;tag_name&gt;$ git push &lt;remote&gt; :refs/tags/&lt;tag_name&gt; æ¢å¤å·²åˆ é™¤æ ‡ç­¾(tag) å¦‚æžœä½ æƒ³æ¢å¤ä¸€ä¸ªå·²åˆ é™¤æ ‡ç­¾(tag), å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤: é¦–å…ˆ, éœ€è¦æ‰¾åˆ°æ— æ³•è®¿é—®çš„æ ‡ç­¾(unreachable tag): $ git fsck --unreachable | grep tag è®°ä¸‹è¿™ä¸ªæ ‡ç­¾(tag)çš„ hashï¼Œç„¶åŽç”¨ Git çš„ update-ref: $ git update-ref refs/tags/&lt;tag_name&gt; &lt;hash&gt; è¿™æ—¶ä½ çš„æ ‡ç­¾(tag)åº”è¯¥å·²ç»æ¢å¤äº†ã€‚ å·²åˆ é™¤è¡¥ä¸(patch) å¦‚æžœæŸäººåœ¨ GitHub ä¸Šç»™ä½ å‘äº†ä¸€ä¸ª pull request, ä½†æ˜¯ç„¶åŽä»–åˆ é™¤äº†ä»–è‡ªå·±çš„åŽŸå§‹ fork, ä½ å°†æ²¡æ³•å…‹éš†ä»–ä»¬çš„æäº¤(commit)æˆ–ä½¿ç”¨ git amã€‚åœ¨è¿™ç§æƒ…å†µä¸‹, æœ€å¥½æ‰‹åŠ¨çš„æŸ¥çœ‹ä»–ä»¬çš„æäº¤(commit)ï¼Œå¹¶æŠŠå®ƒä»¬æ‹·è´åˆ°ä¸€ä¸ªæœ¬åœ°æ–°åˆ†æ”¯ï¼Œç„¶åŽåšæäº¤ã€‚ åšå®Œæäº¤åŽ, å†ä¿®æ”¹ä½œè€…ï¼Œå‚è§å˜æ›´ä½œè€…ã€‚ ç„¶åŽ, åº”ç”¨å˜åŒ–, å†å‘èµ·ä¸€ä¸ªæ–°çš„ pull requestã€‚ è·Ÿè¸ªæ–‡ä»¶(Tracking Files) æˆ‘åªæƒ³æ”¹å˜ä¸€ä¸ªæ–‡ä»¶åå­—çš„å¤§å°å†™ï¼Œè€Œä¸ä¿®æ”¹å†…å®¹ (master)$ git mv --force myfile MyFile æˆ‘æƒ³ä»Ž Git åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†ä¿ç•™è¯¥æ–‡ä»¶ (master)$ git rm --cached log.txt é…ç½®(Configuration) æˆ‘æƒ³ç»™ä¸€äº› Git å‘½ä»¤æ·»åŠ åˆ«å(alias) åœ¨ OS X å’Œ Linux ä¸‹, ä½ çš„ Git çš„é…ç½®æ–‡ä»¶å‚¨å­˜åœ¨ \~/.gitconfigã€‚æˆ‘åœ¨[alias] éƒ¨åˆ†æ·»åŠ äº†ä¸€äº›å¿«æ·åˆ«å(å’Œä¸€äº›æˆ‘å®¹æ˜“æ‹¼å†™é”™è¯¯çš„)ï¼Œå¦‚ä¸‹: [alias] a = add amend = commit --amend c = commit ca = commit --amend ci = commit -a co = checkout d = diff dc = diff --changed ds = diff --staged f = fetch loll = log --graph --decorate --pretty=oneline --abbrev-commit m = merge one = log --pretty=oneline outstanding = rebase -i @&#123;u&#125; s = status unpushed = log @&#123;u&#125; wc = whatchanged wip = rebase -i @&#123;u&#125; zap = fetch -p æˆ‘æƒ³ç¼“å­˜ä¸€ä¸ªä»“åº“(repository)çš„ç”¨æˆ·åå’Œå¯†ç  ä½ å¯èƒ½æœ‰ä¸€ä¸ªä»“åº“éœ€è¦æŽˆæƒï¼Œè¿™æ—¶ä½ å¯ä»¥ç¼“å­˜ç”¨æˆ·åå’Œå¯†ç ï¼Œè€Œä¸ç”¨æ¯æ¬¡æŽ¨/æ‹‰(push/pull)çš„æ—¶å€™éƒ½è¾“å…¥ï¼ŒCredential helper èƒ½å¸®ä½ ã€‚ $ git config --global credential.helper cache## Set git to use the credential memory cache $ git config --global credential.helper 'cache --timeout=3600'## Set the cache to timeout after 1 hour (setting is in seconds) æˆ‘ä¸çŸ¥é“æˆ‘åšé”™äº†äº›ä»€ä¹ˆ ä½ æŠŠäº‹æƒ…æžç ¸äº†ï¼šä½  é‡ç½®(reset) äº†ä¸€äº›ä¸œè¥¿, æˆ–è€…ä½ åˆå¹¶äº†é”™è¯¯çš„åˆ†æ”¯, äº¦æˆ–ä½ å¼ºæŽ¨äº†åŽæ‰¾ä¸åˆ°ä½ è‡ªå·±çš„æäº¤(commit)äº†ã€‚æœ‰äº›æ—¶å€™, ä½ ä¸€ç›´éƒ½åšå¾—å¾ˆå¥½, ä½†ä½ æƒ³å›žåˆ°ä»¥å‰çš„æŸä¸ªçŠ¶æ€ã€‚ è¿™å°±æ˜¯ git reflog çš„ç›®çš„ï¼Œ reflog è®°å½•å¯¹åˆ†æ”¯é¡¶ç«¯(the tip of a branch)çš„ä»»ä½•æ”¹å˜, å³ä½¿é‚£ä¸ªé¡¶ç«¯æ²¡æœ‰è¢«ä»»ä½•åˆ†æ”¯æˆ–æ ‡ç­¾å¼•ç”¨ã€‚åŸºæœ¬ä¸Š, æ¯æ¬¡ HEAD çš„æ”¹å˜, ä¸€æ¡æ–°çš„è®°å½•å°±ä¼šå¢žåŠ åˆ°reflogã€‚é—æ†¾çš„æ˜¯ï¼Œè¿™åªå¯¹æœ¬åœ°åˆ†æ”¯èµ·ä½œç”¨ï¼Œä¸”å®ƒåªè·Ÿè¸ªåŠ¨ä½œ (ä¾‹å¦‚ï¼Œä¸ä¼šè·Ÿè¸ªä¸€ä¸ªæ²¡æœ‰è¢«è®°å½•çš„æ–‡ä»¶çš„ä»»ä½•æ”¹å˜)ã€‚ (master)$ git reflog0a2e358 HEAD@&#123;0&#125;: reset: moving to HEAD\~20254ea7 HEAD@&#123;1&#125;: checkout: moving from 2.2 to masterc10f740 HEAD@&#123;2&#125;: checkout: moving from master to 2.2 ä¸Šé¢çš„ reflog å±•ç¤ºäº†ä»Ž master åˆ†æ”¯ç­¾å‡º(checkout)åˆ° 2.2 åˆ†æ”¯ï¼Œç„¶åŽå†ç­¾å›žã€‚ é‚£é‡Œï¼Œè¿˜æœ‰ä¸€ä¸ªç¡¬é‡ç½®(hard reset)åˆ°ä¸€ä¸ªè¾ƒæ—§çš„æäº¤ã€‚æœ€æ–°çš„åŠ¨ä½œå‡ºçŽ°åœ¨æœ€ä¸Šé¢ä»¥ HEAD@{0}æ ‡è¯†. å¦‚æžœäº‹å®žè¯æ˜Žä½ ä¸å°å¿ƒå›žç§»(move back)äº†æäº¤(commit), reflog ä¼šåŒ…å«ä½ ä¸å°å¿ƒå›žç§»å‰ master ä¸ŠæŒ‡å‘çš„æäº¤(0254ea7)ã€‚ $ git reset --hard 0254ea7 ç„¶åŽä½¿ç”¨ git reset å°±å¯ä»¥æŠŠ master æ”¹å›žåˆ°ä¹‹å‰çš„ commitï¼Œè¿™æä¾›äº†ä¸€ä¸ªåœ¨åŽ†å²è¢«æ„å¤–æ›´æ”¹æƒ…å†µä¸‹çš„å®‰å…¨ç½‘ã€‚ å°ç»“ æœ€åŽï¼Œæ”¾ä¸€å¼ æˆ‘æ€»ç»“çš„è„‘å›¾æ€»ç»“ä¸€ä¸‹ä»¥ä¸Šçš„çŸ¥è¯†ç‚¹ã€‚ å‚è€ƒèµ„æ–™ å®˜æ–¹èµ„æº Git å®˜ç½‘ Git Github æ¨¡æ¿ gitignore æ¨¡æ¿ - .gitignore æ–‡ä»¶æ¨¡æ¿ gitattributes æ¨¡æ¿ - .gitattributes æ–‡ä»¶æ¨¡æ¿ github-cheat-sheet - git å‘½ä»¤ç®€ç•¥å›¾è¡¨ Git ä¹¦ Git å®˜æ–¹æŽ¨èæ•™ç¨‹ - Scott Chacon çš„ Git ä¹¦ã€‚ Git æ•™ç¨‹ Git ä¸­æ–‡æ•™ç¨‹ å»–é›ªå³°çš„ Git æ•™ç¨‹ æœ‰å…³ git çš„å­¦ä¹ èµ„æº æ–‡ç«  Git Cookbook Git å¥‡æŠ€æ·«å·§ Git é£Žæ ¼æŒ‡å— Git åœ¨å›¢é˜Ÿä¸­çš„æœ€ä½³å®žè·µâ€“å¦‚ä½•æ­£ç¡®ä½¿ç”¨ Git Flow Git å·¥å…· guis - Git å®˜ç½‘å±•ç¤ºçš„å®¢æˆ·ç«¯å·¥å…·åˆ—è¡¨ã€‚ gogs - æžæ˜“æ­å»ºçš„è‡ªåŠ© Git æœåŠ¡ã€‚ gitflow - åº”ç”¨ fit-flow æ¨¡åž‹çš„å·¥å…·ã€‚ firstaidgit.io ä¸€ä¸ªå¯æœç´¢çš„æœ€å¸¸è¢«é—®åˆ°çš„ Git çš„é—®é¢˜ git-extra-commands - ä¸€å †æœ‰ç”¨çš„é¢å¤–çš„ Git è„šæœ¬ git-extras - GIT å·¥å…·é›† â€“ repo summary, repl, changelog population, author commit percentages and more git-fire - git-fire æ˜¯ä¸€ä¸ª Git æ’ä»¶ï¼Œç”¨äºŽå¸®åŠ©åœ¨ç´§æ€¥æƒ…å†µä¸‹æ·»åŠ æ‰€æœ‰å½“å‰æ–‡ä»¶, åšæäº¤(committing), å’ŒæŽ¨(push)åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯(é˜»æ­¢åˆå¹¶å†²çª)ã€‚ git-tips - Git å°æç¤º git-town - é€šç”¨ï¼Œé«˜çº§ Git å·¥ä½œæµæ”¯æŒï¼ http://www.git-town.com GUI å®¢æˆ·ç«¯(GUI Clients) GitKraken - è±ªåŽçš„ Git å®¢æˆ·ç«¯ Windows, Mac &amp; Linux git-cola - å¦å¤–ä¸€ä¸ª Git å®¢æˆ·ç«¯ Windows &amp; OS X GitUp - ä¸€ä¸ªæ–°çš„ Git å®¢æˆ·ç«¯ï¼Œåœ¨å¤„ç† Git çš„å¤æ‚æ€§ä¸Šæœ‰è‡ªå·±çš„ç‰¹ç‚¹ gitx-dev - å›¾å½¢åŒ–çš„ Git å®¢æˆ·ç«¯ OS X Source Tree - å…è´¹çš„å›¾å½¢åŒ– Git å®¢æˆ·ç«¯ Windows &amp; OS X Tower - å›¾å½¢åŒ– Git å®¢æˆ·ç«¯ OS X(ä»˜è´¹) git cheat sheet github-git-cheat-sheet]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>tools</tag>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è½¯ä»¶å·¥ç¨‹ä¸Žé¡¹ç›®ç®¡ç†]]></title>
    <url>%2Fblog%2F2017%2F11%2F20%2Fmethod%2Fsoftware-engineering%2F</url>
    <content type="text"><![CDATA[è½¯ä»¶å·¥ç¨‹ä¸Žé¡¹ç›®ç®¡ç† ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ è½¯ä»¶å·¥ç¨‹æ˜¯ä¸€é—¨ç ”ç©¶ç”¨å·¥ç¨‹åŒ–æ–¹æ³•æž„å»ºå’Œç»´æŠ¤æœ‰æ•ˆçš„ã€å®žç”¨çš„å’Œé«˜è´¨é‡çš„è½¯ä»¶çš„å­¦ç§‘ã€‚å®ƒæ¶‰åŠç¨‹åºè®¾è®¡è¯­è¨€ã€æ•°æ®åº“ã€è½¯ä»¶å¼€å‘å·¥å…·ã€ç³»ç»Ÿå¹³å°ã€æ ‡å‡†ã€è®¾è®¡æ¨¡å¼ç­‰æ–¹é¢ã€‚ è½¯ä»¶å·¥ç¨‹çš„ç›®æ ‡ è½¯ä»¶å·¥ç¨‹çš„åŽŸç† è½¯ä»¶å·¥ç¨‹çš„æ–¹æ³• è½¯ä»¶éœ€æ±‚ è½¯ä»¶éœ€æ±‚è¯´æ˜Žä¹¦ï¼ˆ SRS ï¼‰ è½¯ä»¶ç”Ÿå‘½å‘¨æœŸ è½¯ä»¶ç”Ÿå‘½å‘¨æœŸæ¨¡åž‹ ç€‘å¸ƒæ¨¡åž‹ èžºæ—‹æ¨¡åž‹ è½¯ä»¶å·¥ç¨‹æœ¯è¯­ æ›´å¤šå†…å®¹ ä¹¦ æ–‡ç«  å·¥å…· æ–‡æ¡£æ¨¡æ¿ è½¯ä»¶å·¥ç¨‹çš„ç›®æ ‡ è½¯ä»¶å·¥ç¨‹çš„ç›®æ ‡æ˜¯ï¼šåœ¨ç»™å®šæˆæœ¬ã€è¿›åº¦çš„å‰æä¸‹ï¼Œå¼€å‘å‡ºå…·æœ‰é€‚ç”¨æ€§ã€æœ‰æ•ˆæ€§ã€å¯ä¿®æ”¹æ€§ã€å¯é æ€§ã€å¯ç†è§£æ€§ã€å¯ç»´æŠ¤æ€§ã€å¯é‡ç”¨æ€§ã€å¯ç§»æ¤æ€§ã€å¯è¿½è¸ªæ€§ã€å¯äº’æ“ä½œæ€§å’Œæ»¡è¶³ç”¨æˆ·éœ€æ±‚çš„è½¯ä»¶äº§å“ã€‚ é€‚ç”¨æ€§ - è½¯ä»¶åœ¨ä¸åŒçš„ç³»ç»Ÿçº¦æŸæ¡ä»¶ä¸‹ï¼Œä½¿ç”¨æˆ·éœ€æ±‚å¾—åˆ°æ»¡è¶³çš„éš¾æ˜“ç¨‹åº¦ã€‚ æœ‰æ•ˆæ€§ - è½¯ä»¶ç³»ç»Ÿèƒ½æœ€æœ‰æ•ˆçš„åˆ©ç”¨è®¡ç®—æœºçš„æ—¶é—´å’Œç©ºé—´èµ„æºã€‚å„ç§è½¯ä»¶æ— ä¸æŠŠç³»ç»Ÿçš„æ—¶/ç©ºå¼€é”€ä½œä¸ºè¡¡é‡è½¯ä»¶è´¨é‡çš„ä¸€é¡¹é‡è¦æŠ€æœ¯æŒ‡æ ‡ã€‚å¾ˆå¤šåœºåˆï¼Œåœ¨è¿½æ±‚æ—¶é—´æœ‰æ•ˆæ€§å’Œç©ºé—´æœ‰æ•ˆæ€§æ—¶ä¼šå‘ç”ŸçŸ›ç›¾ï¼Œè¿™æ—¶ä¸å¾—ä¸ç‰ºç‰²æ—¶é—´æœ‰æ•ˆæ€§æ¢å–ç©ºé—´æœ‰æ•ˆæ€§æˆ–ç‰ºç‰²ç©ºé—´æœ‰æ•ˆæ€§æ¢å–æ—¶é—´æœ‰æ•ˆæ€§ã€‚æ—¶/ç©ºæŠ˜è¡·æ˜¯ç»å¸¸é‡‡ç”¨çš„æŠ€å·§ã€‚ å¯ä¿®æ”¹æ€§ - å…è®¸å¯¹ç³»ç»Ÿè¿›è¡Œä¿®æ”¹è€Œä¸å¢žåŠ åŽŸç³»ç»Ÿçš„å¤æ‚æ€§ã€‚å®ƒæ”¯æŒè½¯ä»¶çš„è°ƒè¯•å’Œç»´æŠ¤ï¼Œæ˜¯ä¸€ä¸ªéš¾ä»¥è¾¾åˆ°çš„ç›®æ ‡ã€‚ å¯é æ€§ - èƒ½é˜²æ­¢å› æ¦‚å¿µã€è®¾è®¡å’Œç»“æž„ç­‰æ–¹é¢çš„ä¸å®Œå–„é€ æˆçš„è½¯ä»¶ç³»ç»Ÿå¤±æ•ˆï¼Œå…·æœ‰æŒ½å›žå› æ“ä½œä¸å½“é€ æˆè½¯ä»¶ç³»ç»Ÿå¤±æ•ˆçš„èƒ½åŠ›ã€‚ å¯ç†è§£æ€§ - ç³»ç»Ÿå…·æœ‰æ¸…æ™°çš„ç»“æž„ï¼Œèƒ½ç›´æŽ¥åæ˜ é—®é¢˜çš„éœ€æ±‚ã€‚å¯ç†è§£æ€§æœ‰åŠ©äºŽæŽ§åˆ¶ç³»ç»Ÿè½¯ä»¶å¤æ‚æ€§ï¼Œå¹¶æ”¯æŒè½¯ä»¶çš„ç»´æŠ¤ã€ç§»æ¤æˆ–é‡ç”¨ã€‚ å¯ç»´æŠ¤æ€§ - è½¯ä»¶äº¤ä»˜ä½¿ç”¨åŽï¼Œèƒ½å¤Ÿå¯¹å®ƒè¿›è¡Œä¿®æ”¹ï¼Œä»¥æ”¹æ­£æ½œä¼çš„é”™è¯¯ï¼Œæ”¹è¿›æ€§èƒ½å’Œå…¶å®ƒå±žæ€§ï¼Œä½¿è½¯ä»¶äº§å“é€‚åº”çŽ¯å¢ƒçš„å˜åŒ–ç­‰ã€‚è½¯ä»¶ç»´æŠ¤è´¹ç”¨åœ¨è½¯ä»¶å¼€å‘è´¹ç”¨ä¸­å æœ‰å¾ˆå¤§çš„æ¯”é‡ã€‚å¯ç»´æŠ¤æ€§æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­ä¸€é¡¹ååˆ†é‡è¦çš„ç›®æ ‡ã€‚ å¯é‡ç”¨æ€§ - æŠŠæ¦‚å¿µæˆ–åŠŸèƒ½ç›¸å¯¹ç‹¬ç«‹çš„ä¸€ä¸ªæˆ–ä¸€ç»„ç›¸å…³æ¨¡å—å®šä¹‰ä¸ºä¸€ä¸ªè½¯éƒ¨ä»¶ã€‚å¯ç»„è£…åœ¨ç³»ç»Ÿçš„ä»»ä½•ä½ç½®ï¼Œé™ä½Žå·¥ä½œé‡ã€‚ å¯ç§»æ¤æ€§ - è½¯ä»¶ä»Žä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿæˆ–çŽ¯å¢ƒæ¬åˆ°å¦ä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿæˆ–çŽ¯å¢ƒçš„éš¾æ˜“ç¨‹åº¦ã€‚ å¯è¿½è¸ªæ€§ - æ ¹æ®è½¯ä»¶éœ€æ±‚å¯¹è½¯ä»¶è®¾è®¡ã€ç¨‹åºè¿›è¡Œæ­£å‘è¿½è¸ªï¼Œæˆ–æ ¹æ®è½¯ä»¶è®¾è®¡ã€ç¨‹åºå¯¹è½¯ä»¶éœ€æ±‚çš„é€†å‘è¿½è¸ªçš„èƒ½åŠ›ã€‚ å¯äº’æ“ä½œæ€§ - å¤šä¸ªè½¯ä»¶å…ƒç´ ç›¸äº’é€šä¿¡å¹¶ååŒå®Œæˆä»»åŠ¡çš„èƒ½åŠ›ã€‚ è½¯ä»¶å·¥ç¨‹çš„åŽŸç† è½¯ä»¶å·¥ç¨‹çš„ä¸ƒæ¡åŸºæœ¬åŽŸç†ï¼š ç”¨åˆ†é˜¶æ®µçš„ç”Ÿå­˜å‘¨æœŸè®¡åˆ’è¿›è¡Œä¸¥æ ¼çš„ç®¡ç†ã€‚ åšæŒè¿›è¡Œé˜¶æ®µè¯„å®¡ã€‚ å®žè¡Œä¸¥æ ¼çš„äº§å“æŽ§åˆ¶ã€‚ é‡‡ç”¨çŽ°ä»£ç¨‹åºè®¾è®¡æŠ€æœ¯ã€‚ è½¯ä»¶å·¥ç¨‹ç»“æžœåº”èƒ½æ¸…æ¥šåœ°å®¡æŸ¥ã€‚ å¼€å‘å°ç»„çš„äººå‘˜åº”è¯¥å°‘è€Œç²¾ã€‚ æ‰¿è®¤ä¸æ–­æ”¹è¿›è½¯ä»¶å·¥ç¨‹å®žè·µçš„å¿…è¦æ€§ã€‚ è½¯ä»¶å·¥ç¨‹çš„æ–¹æ³• è‘—åçš„é‡é‡çº§å¼€å‘æ–¹æ³•ï¼š ISO9000 - ISO 9000 ç³»åˆ—æ ‡å‡†æ˜¯å›½é™…æ ‡å‡†åŒ–ç»„ç»‡è®¾ç«‹çš„æ ‡å‡†ï¼Œä¸Žå“è´¨ç®¡ç†ç³»ç»Ÿæœ‰å…³ã€‚ èƒ½åŠ›æˆç†Ÿåº¦æ¨¡åž‹ï¼ˆCMMï¼‰ - CMM æ¶µç›–ä¸€ä¸ªæˆç†Ÿçš„è½¯ä»¶å‘å±•ç»„ç»‡æ‰€åº”å…·å¤‡çš„é‡è¦åŠŸèƒ½ä¸Žé¡¹ç›®ï¼Œå®ƒæè¿°äº†è½¯ä»¶å‘å±•çš„æ¼”è¿›è¿‡ç¨‹ï¼Œä»Žæ¯«æ— ç« æ³•ã€ä¸æˆç†Ÿçš„è½¯ä»¶å¼€å‘é˜¶æ®µåˆ°æˆç†Ÿè½¯ä»¶å¼€å‘é˜¶æ®µçš„è¿‡ç¨‹ã€‚ ç»Ÿä¸€è½¯ä»¶å¼€å‘è¿‡ç¨‹ï¼ˆRUPï¼‰ - RUP æ˜¯ä¸€ç§è½¯ä»¶å·¥ç¨‹æ–¹æ³•ï¼Œä¸ºè¿­ä»£å¼è½¯ä»¶å¼€å‘æµç¨‹ã€‚ è‘—åçš„è½»é‡çº§å¼€å‘æ–¹æ³•ï¼š æ•æ·å¼€å‘ï¼ˆAgile Developmentï¼‰ - æ˜¯ä¸€ç§åº”å¯¹å¿«é€Ÿå˜åŒ–çš„éœ€æ±‚çš„ä¸€ç§è½¯ä»¶å¼€å‘èƒ½åŠ›ã€‚å®ƒä»¬çš„å…·ä½“åç§°ã€ç†å¿µã€è¿‡ç¨‹ã€æœ¯è¯­éƒ½ä¸å°½ç›¸åŒï¼Œç›¸å¯¹äºŽâ€œéžæ•æ·â€ï¼Œæ›´å¼ºè°ƒç¨‹åºå‘˜å›¢é˜Ÿä¸Žä¸šåŠ¡ä¸“å®¶ä¹‹é—´çš„ç´§å¯†åä½œã€é¢å¯¹é¢çš„æ²Ÿé€šï¼ˆè®¤ä¸ºæ¯”ä¹¦é¢çš„æ–‡æ¡£æ›´æœ‰æ•ˆï¼‰ã€é¢‘ç¹äº¤ä»˜æ–°çš„è½¯ä»¶ç‰ˆæœ¬ã€ç´§å‡‘è€Œè‡ªæˆ‘ç»„ç»‡åž‹çš„å›¢é˜Ÿã€èƒ½å¤Ÿå¾ˆå¥½åœ°é€‚åº”éœ€æ±‚å˜åŒ–çš„ä»£ç ç¼–å†™å’Œå›¢é˜Ÿç»„ç»‡æ–¹æ³•ï¼Œä¹Ÿæ›´æ³¨é‡è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­äººçš„ä½œç”¨ã€‚ æžé™ç¼–ç¨‹ï¼ˆXPï¼‰ - æžé™ç¼–ç¨‹æ˜¯æ•æ·è½¯ä»¶å¼€å‘ä¸­æœ€æœ‰æˆæ•ˆçš„æ–¹æ³•å­¦ä¹‹ä¸€ã€‚æžé™ç¼–ç¨‹æŠ€æœ¯ä»¥æ²Ÿé€šï¼ˆCommunicationï¼‰ã€ç®€å•ï¼ˆSimplicityï¼‰ã€åé¦ˆï¼ˆFeedbackï¼‰ã€å‹‡æ°”ï¼ˆCourageï¼‰å’Œå°Šé‡ï¼ˆRespectï¼‰ä¸ºä»·å€¼æ ‡å‡†ã€‚ è½¯ä»¶éœ€æ±‚ è½¯ä»¶éœ€æ±‚åŒ…æ‹¬ä¸‰ä¸ªä¸åŒçš„å±‚æ¬¡ï¼šä¸šåŠ¡éœ€æ±‚ã€ç”¨æˆ·éœ€æ±‚å’ŒåŠŸèƒ½éœ€æ±‚ã€‚ **ä¸šåŠ¡éœ€æ±‚ï¼ˆBusiness requirementï¼‰**è¡¨ç¤ºç»„ç»‡æˆ–å®¢æˆ·é«˜å±‚æ¬¡çš„ç›®æ ‡ã€‚ä¸šåŠ¡éœ€æ±‚é€šå¸¸æ¥è‡ªé¡¹ç›®æŠ•èµ„äººã€è´­ä¹°äº§å“çš„å®¢æˆ·ã€å®žé™…ç”¨æˆ·çš„ç®¡ç†è€…ã€å¸‚åœºè¥é”€éƒ¨é—¨æˆ–äº§å“ç­–åˆ’éƒ¨é—¨ã€‚ä¸šåŠ¡éœ€æ±‚æè¿°äº†ç»„ç»‡ä¸ºä»€ä¹ˆè¦å¼€å‘ä¸€ä¸ªç³»ç»Ÿï¼Œå³ç»„ç»‡å¸Œæœ›è¾¾åˆ°çš„ç›®æ ‡ã€‚ä½¿ç”¨å‰æ™¯å’ŒèŒƒå›´ï¼ˆ vision and scope ï¼‰æ–‡æ¡£æ¥è®°å½•ä¸šåŠ¡éœ€æ±‚ï¼Œè¿™ä»½æ–‡æ¡£æœ‰æ—¶ä¹Ÿè¢«ç§°ä½œé¡¹ç›®è½®å»“å›¾æˆ–å¸‚åœºéœ€æ±‚ï¼ˆ project charter æˆ– market requirement ï¼‰æ–‡æ¡£ã€‚ **ç”¨æˆ·éœ€æ±‚ï¼ˆuser requirementï¼‰**æè¿°çš„æ˜¯ç”¨æˆ·çš„ç›®æ ‡ï¼Œæˆ–ç”¨æˆ·è¦æ±‚ç³»ç»Ÿå¿…é¡»èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚ç”¨ä¾‹ã€åœºæ™¯æè¿°å’Œäº‹ä»¶â€•â€•å“åº”è¡¨éƒ½æ˜¯è¡¨è¾¾ç”¨æˆ·éœ€æ±‚çš„æœ‰æ•ˆé€”å¾„ã€‚ä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·éœ€æ±‚æè¿°äº†ç”¨æˆ·èƒ½ä½¿ç”¨ç³»ç»Ÿæ¥åšäº›ä»€ä¹ˆã€‚ **åŠŸèƒ½éœ€æ±‚ï¼ˆfunctional requirementï¼‰**è§„å®šå¼€å‘äººå‘˜å¿…é¡»åœ¨äº§å“ä¸­å®žçŽ°çš„è½¯ä»¶åŠŸèƒ½ï¼Œç”¨æˆ·åˆ©ç”¨è¿™äº›åŠŸèƒ½æ¥å®Œæˆä»»åŠ¡ï¼Œæ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚åŠŸèƒ½éœ€æ±‚æœ‰æ—¶ä¹Ÿè¢«ç§°ä½œè¡Œä¸ºéœ€æ±‚ï¼ˆ behavioral requirement ï¼‰ï¼Œå› ä¸ºä¹ æƒ¯ä¸Šæ€»æ˜¯ç”¨â€œåº”è¯¥â€å¯¹å…¶è¿›è¡Œæè¿°ï¼šâ€œç³»ç»Ÿåº”è¯¥å‘é€ç”µå­é‚®ä»¶æ¥é€šçŸ¥ç”¨æˆ·å·²æŽ¥å—å…¶é¢„å®šâ€ã€‚åŠŸèƒ½éœ€æ±‚æè¿°æ˜¯å¼€å‘äººå‘˜éœ€è¦å®žçŽ°ä»€ä¹ˆã€‚ **ç³»ç»Ÿéœ€æ±‚ï¼ˆsystem requirementï¼‰**ç”¨äºŽæè¿°åŒ…å«å¤šä¸ªå­ç³»ç»Ÿçš„äº§å“ï¼ˆå³ç³»ç»Ÿï¼‰çš„é¡¶çº§éœ€æ±‚ã€‚ç³»ç»Ÿå¯ä»¥åªåŒ…å«è½¯ä»¶ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥æ—¢åŒ…å«è½¯ä»¶åˆåŒ…å«ç¡¬ä»¶å­ç³»ç»Ÿã€‚äººä¹Ÿå¯ä»¥æ˜¯ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æŸäº›ç³»ç»ŸåŠŸèƒ½å¯èƒ½è¦ç”±äººæ¥æ‰¿æ‹…ã€‚ è½¯ä»¶éœ€æ±‚è¯´æ˜Žä¹¦ï¼ˆ SRS ï¼‰ è½¯ä»¶éœ€æ±‚è¯´æ˜Žä¹¦ï¼ˆ SRS ï¼‰å®Œæ•´åœ°æè¿°äº†è½¯ä»¶ç³»ç»Ÿçš„é¢„æœŸç‰¹æ€§ã€‚å¼€å‘ã€æµ‹è¯•ã€è´¨é‡ä¿è¯ã€é¡¹ç›®ç®¡ç†å’Œå…¶ä»–ç›¸å…³çš„é¡¹ç›®åŠŸèƒ½éƒ½è¦ç”¨åˆ° SRS ã€‚ é™¤äº†åŠŸèƒ½éœ€æ±‚å¤–ï¼Œ SRS ä¸­è¿˜åŒ…å«éžåŠŸèƒ½éœ€æ±‚ï¼ŒåŒ…æ‹¬æ€§èƒ½æŒ‡æ ‡å’Œå¯¹è´¨é‡å±žæ€§çš„æè¿°ã€‚ **è´¨é‡å±žæ€§ï¼ˆquality attributeï¼‰**å¯¹äº§å“çš„åŠŸèƒ½æè¿°ä½œäº†è¡¥å……ï¼Œå®ƒä»Žä¸åŒæ–¹é¢æè¿°äº†äº§å“çš„å„ç§ç‰¹æ€§ã€‚è¿™äº›ç‰¹æ€§åŒ…æ‹¬å¯ç”¨æ€§ã€å¯ç§»æ¤æ€§ã€å®Œæ•´æ€§ã€æ•ˆçŽ‡å’Œå¥å£®æ€§ï¼Œå®ƒä»¬å¯¹ç”¨æˆ·æˆ–å¼€å‘äººå‘˜éƒ½å¾ˆé‡è¦ã€‚å…¶ä»–çš„éžåŠŸèƒ½éœ€æ±‚åŒ…æ‹¬ç³»ç»Ÿä¸Žå¤–éƒ¨ä¸–ç•Œçš„å¤–éƒ¨ç•Œé¢ï¼Œä»¥åŠå¯¹è®¾è®¡ä¸Žå®žçŽ°çš„çº¦æŸã€‚ **çº¦æŸï¼ˆconstraintï¼‰**é™åˆ¶äº†å¼€å‘äººå‘˜è®¾è®¡å’Œæž„å»ºç³»ç»Ÿæ—¶çš„é€‰æ‹©èŒƒå›´ã€‚ è½¯ä»¶ç”Ÿå‘½å‘¨æœŸ è½¯ä»¶ç”Ÿå‘½å‘¨æœŸï¼ˆSoftware Life Cycle,SLCï¼‰æ˜¯è½¯ä»¶çš„äº§ç”Ÿç›´åˆ°æŠ¥åºŸæˆ–åœæ­¢ä½¿ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€‚ é—®é¢˜å®šä¹‰ - è¦æ±‚ç³»ç»Ÿåˆ†æžå‘˜ä¸Žç”¨æˆ·è¿›è¡Œäº¤æµï¼Œå¼„æ¸…â€œç”¨æˆ·éœ€è¦è®¡ç®—æœºè§£å†³ä»€ä¹ˆé—®é¢˜â€ç„¶åŽæå‡ºå…³äºŽâ€œç³»ç»Ÿç›®æ ‡ä¸ŽèŒƒå›´çš„è¯´æ˜Žâ€ï¼Œæäº¤ç”¨æˆ·å®¡æŸ¥å’Œç¡®è®¤ã€‚ å¯è¡Œæ€§ç ”ç©¶ - ä¸€æ–¹é¢åœ¨äºŽæŠŠå¾…å¼€å‘çš„ç³»ç»Ÿçš„ç›®æ ‡ä»¥æ˜Žç¡®çš„è¯­è¨€æè¿°å‡ºæ¥ï¼›å¦ä¸€æ–¹é¢ä»Žç»æµŽã€æŠ€æœ¯ã€æ³•å¾‹ç­‰å¤šæ–¹é¢è¿›è¡Œå¯è¡Œæ€§åˆ†æžã€‚ éœ€æ±‚åˆ†æž - å¼„æ¸…ç”¨æˆ·å¯¹è½¯ä»¶ç³»ç»Ÿçš„å…¨éƒ¨éœ€æ±‚ï¼Œç¼–å†™éœ€æ±‚è§„æ ¼è¯´æ˜Žä¹¦å’Œåˆæ­¥çš„ç”¨æˆ·æ‰‹å†Œï¼Œæäº¤è¯„å®¡ã€‚ å¼€å‘é˜¶æ®µ æ¦‚è¦è®¾è®¡ è¯¦ç»†è®¾è®¡ ç¼–ç å®žçŽ° è½¯ä»¶æµ‹è¯• - æµ‹è¯•çš„è¿‡ç¨‹åˆ†å•å…ƒæµ‹è¯•ã€ç»„è£…æµ‹è¯•ä»¥åŠç³»ç»Ÿæµ‹è¯•ä¸‰ä¸ªé˜¶æ®µè¿›è¡Œã€‚æµ‹è¯•çš„æ–¹æ³•ä¸»è¦æœ‰ç™½ç›’æµ‹è¯•å’Œé»‘ç›’æµ‹è¯•ä¸¤ç§ã€‚ ç»´æŠ¤ è½¯ä»¶ç”Ÿå‘½å‘¨æœŸæ¨¡åž‹ ç€‘å¸ƒæ¨¡åž‹ ç€‘å¸ƒæ¨¡åž‹ï¼ˆWaterfall Modelï¼‰å¼ºè°ƒç³»ç»Ÿå¼€å‘åº”æœ‰å®Œæ•´çš„å‘¨æœŸï¼Œä¸”å¿…é¡»å®Œæ•´çš„ç»åŽ†å‘¨æœŸçš„æ¯ä¸€å¼€å‘é˜¶æ®µï¼Œå¹¶ç³»ç»ŸåŒ–çš„è€ƒé‡åˆ†æžä¸Žè®¾è®¡çš„æŠ€æœ¯ã€æ—¶é—´ä¸Žèµ„æºä¹‹æŠ•å…¥ç­‰ã€‚ æ ¸å¿ƒæ€æƒ³ ç€‘å¸ƒæ¨¡åž‹æ ¸å¿ƒæ€æƒ³æ˜¯æŒ‰å·¥åºå°†é—®é¢˜æ‹†åˆ†ï¼Œå°†åŠŸèƒ½çš„å®žçŽ°ä¸Žè®¾è®¡åˆ†å¼€ï¼Œä¾¿äºŽåˆ†å·¥åä½œï¼Œå³é‡‡ç”¨ç»“æž„åŒ–çš„åˆ†æžä¸Žè®¾è®¡æ–¹æ³•å°†é€»è¾‘å®žçŽ°ä¸Žç‰©ç†å®žçŽ°åˆ†å¼€ã€‚å°†è½¯ä»¶ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ä¸ºåˆ¶å®šè®¡åˆ’ã€éœ€æ±‚åˆ†æžã€è½¯ä»¶è®¾è®¡ã€ç¨‹åºç¼–å†™ã€è½¯ä»¶æµ‹è¯•å’Œè¿è¡Œç»´æŠ¤ç­‰å…­ä¸ªåŸºæœ¬æ´»åŠ¨ï¼Œå¹¶ä¸”è§„å®šäº†å®ƒä»¬è‡ªä¸Šè€Œä¸‹ã€ç›¸äº’è¡”æŽ¥çš„å›ºå®šæ¬¡åºï¼Œå¦‚åŒç€‘å¸ƒæµæ°´ï¼Œé€çº§ä¸‹è½ã€‚ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ ä¸ºé¡¹ç›®æä¾›äº†æŒ‰é˜¶æ®µåˆ’åˆ†çš„æ£€æŸ¥ç‚¹ã€‚ å½“å‰ä¸€é˜¶æ®µå®ŒæˆåŽï¼Œæ‚¨åªéœ€è¦åŽ»å…³æ³¨åŽç»­é˜¶æ®µã€‚ å¯åœ¨è¿­ä»£æ¨¡åž‹ä¸­åº”ç”¨ç€‘å¸ƒæ¨¡åž‹ã€‚ å®ƒæä¾›äº†ä¸€ä¸ªæ¨¡æ¿ï¼Œè¿™ä¸ªæ¨¡æ¿ä½¿å¾—åˆ†æžã€è®¾è®¡ã€ç¼–ç ã€æµ‹è¯•å’Œæ”¯æŒçš„æ–¹æ³•å¯ä»¥åœ¨è¯¥æ¨¡æ¿ä¸‹æœ‰ä¸€ä¸ªå…±åŒçš„æŒ‡å¯¼ã€‚ ç¼ºç‚¹ å„ä¸ªé˜¶æ®µçš„åˆ’åˆ†å®Œå…¨å›ºå®šï¼Œé˜¶æ®µä¹‹é—´äº§ç”Ÿå¤§é‡çš„æ–‡æ¡£ï¼Œæžå¤§åœ°å¢žåŠ äº†å·¥ä½œé‡ã€‚ ç”±äºŽå¼€å‘æ¨¡åž‹æ˜¯çº¿æ€§çš„ï¼Œç”¨æˆ·åªæœ‰ç­‰åˆ°æ•´ä¸ªè¿‡ç¨‹çš„æœ«æœŸæ‰èƒ½è§åˆ°å¼€å‘æˆæžœï¼Œä»Žè€Œå¢žåŠ äº†å¼€å‘é£Žé™©ã€‚ é€šè¿‡è¿‡å¤šçš„å¼ºåˆ¶å®Œæˆæ—¥æœŸå’Œé‡Œç¨‹ç¢‘æ¥è·Ÿè¸ªå„ä¸ªé¡¹ç›®é˜¶æ®µã€‚ ç€‘å¸ƒæ¨¡åž‹çš„çªå‡ºç¼ºç‚¹æ˜¯ä¸é€‚åº”ç”¨æˆ·éœ€æ±‚çš„å˜åŒ–ã€‚ é€‚ç”¨åœºæ™¯ æ˜¯å¦ä½¿ç”¨è¿™ä¸€æ¨¡åž‹ä¸»è¦å–å†³äºŽæ˜¯å¦èƒ½ç†è§£å®¢æˆ·çš„éœ€æ±‚ä»¥åŠåœ¨é¡¹ç›®çš„è¿›ç¨‹ä¸­è¿™äº›éœ€æ±‚çš„å˜åŒ–ç¨‹åº¦ã€‚å¯¹äºŽéœ€æ±‚ç»å¸¸å˜åŒ–çš„é¡¹ç›®ï¼Œä¸è¦é€‚ç”¨ç€‘å¸ƒæ¨¡åž‹ã€‚ èžºæ—‹æ¨¡åž‹ èžºæ—‹æ¨¡åž‹åŸºæœ¬åšæ³•æ˜¯åœ¨â€œç€‘å¸ƒæ¨¡åž‹â€çš„æ¯ä¸€ä¸ªå¼€å‘é˜¶æ®µå‰å¼•å…¥ä¸€ä¸ªéžå¸¸ä¸¥æ ¼çš„é£Žé™©è¯†åˆ«ã€é£Žé™©åˆ†æžå’Œé£Žé™©æŽ§åˆ¶ï¼Œå®ƒæŠŠè½¯ä»¶é¡¹ç›®åˆ†è§£æˆä¸€ä¸ªä¸ªå°é¡¹ç›®ã€‚æ¯ä¸ªå°é¡¹ç›®éƒ½æ ‡è¯†ä¸€ä¸ªæˆ–å¤šä¸ªä¸»è¦é£Žé™©ï¼Œç›´åˆ°æ‰€æœ‰çš„ä¸»è¦é£Žé™©å› ç´ éƒ½è¢«ç¡®å®šã€‚ æ ¸å¿ƒæ€æƒ³ èžºæ—‹æ¨¡åž‹æ²¿ç€èžºçº¿è¿›è¡Œè‹¥å¹²æ¬¡è¿­ä»£ï¼Œå›¾ä¸­çš„å››ä¸ªè±¡é™ä»£è¡¨äº†ä»¥ä¸‹æ´»åŠ¨ï¼š åˆ¶å®šè®¡åˆ’ - ç¡®å®šè½¯ä»¶ç›®æ ‡ï¼Œé€‰å®šå®žæ–½æ–¹æ¡ˆï¼Œå¼„æ¸…é¡¹ç›®å¼€å‘çš„é™åˆ¶æ¡ä»¶ï¼› é£Žé™©åˆ†æž - åˆ†æžè¯„ä¼°æ‰€é€‰æ–¹æ¡ˆï¼Œè€ƒè™‘å¦‚ä½•è¯†åˆ«å’Œæ¶ˆé™¤é£Žé™©ï¼› å®žæ–½å·¥ç¨‹ - å®žæ–½è½¯ä»¶å¼€å‘å’ŒéªŒè¯ï¼› å®¢æˆ·è¯„ä¼° - è¯„ä»·å¼€å‘å·¥ä½œï¼Œæå‡ºä¿®æ­£å»ºè®®ï¼Œåˆ¶å®šä¸‹ä¸€æ­¥è®¡åˆ’ã€‚ èžºæ—‹æ¨¡åž‹ç”±é£Žé™©é©±åŠ¨ï¼Œå¼ºè°ƒå¯é€‰æ–¹æ¡ˆå’Œçº¦æŸæ¡ä»¶ä»Žè€Œæ”¯æŒè½¯ä»¶çš„é‡ç”¨ï¼Œæœ‰åŠ©äºŽå°†è½¯ä»¶è´¨é‡ä½œä¸ºç‰¹æ®Šç›®æ ‡èžå…¥äº§å“å¼€å‘ä¹‹ä¸­ã€‚ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ è®¾è®¡ä¸Šçš„çµæ´»æ€§,å¯ä»¥åœ¨é¡¹ç›®çš„å„ä¸ªé˜¶æ®µè¿›è¡Œå˜æ›´ã€‚ ä»¥å°çš„åˆ†æ®µæ¥æž„å»ºå¤§åž‹ç³»ç»Ÿ,ä½¿æˆæœ¬è®¡ç®—å˜å¾—ç®€å•å®¹æ˜“ã€‚ å®¢æˆ·å§‹ç»ˆå‚ä¸Žæ¯ä¸ªé˜¶æ®µçš„å¼€å‘,ä¿è¯äº†é¡¹ç›®ä¸åç¦»æ­£ç¡®æ–¹å‘ä»¥åŠé¡¹ç›®çš„å¯æŽ§æ€§ã€‚ éšç€é¡¹ç›®æŽ¨è¿›,å®¢æˆ·å§‹ç»ˆæŽŒæ¡é¡¹ç›®çš„æœ€æ–°ä¿¡æ¯, ä»Žè€Œä»–æˆ–å¥¹èƒ½å¤Ÿå’Œç®¡ç†å±‚æœ‰æ•ˆåœ°äº¤äº’ã€‚ å®¢æˆ·è®¤å¯è¿™ç§å…¬å¸å†…éƒ¨çš„å¼€å‘æ–¹å¼å¸¦æ¥çš„è‰¯å¥½çš„æ²Ÿé€šå’Œé«˜è´¨é‡çš„äº§å“ã€‚ ç¼ºç‚¹ å¾ˆéš¾è®©ç”¨æˆ·ç¡®ä¿¡è¿™ç§æ¼”åŒ–æ–¹æ³•çš„ç»“æžœæ˜¯å¯ä»¥æŽ§åˆ¶çš„ã€‚å»ºè®¾å‘¨æœŸé•¿ï¼Œè€Œè½¯ä»¶æŠ€æœ¯å‘å±•æ¯”è¾ƒå¿«ï¼Œæ‰€ä»¥ç»å¸¸å‡ºçŽ°è½¯ä»¶å¼€å‘å®Œæ¯•åŽï¼Œå’Œå½“å‰çš„æŠ€æœ¯æ°´å¹³æœ‰äº†è¾ƒå¤§çš„å·®è·ï¼Œæ— æ³•æ»¡è¶³å½“å‰ç”¨æˆ·éœ€æ±‚ã€‚ é€‚ç”¨åœºæ™¯ å¯¹äºŽæ–°é¡¹ç›®ï¼Œéœ€æ±‚ä¸æ˜Žç¡®çš„æƒ…å†µä¸‹ï¼Œé€‚åˆç”¨èžºæ—‹æ¨¡åž‹è¿›è¡Œå¼€å‘ï¼Œä¾¿äºŽé£Žé™©æŽ§åˆ¶å’Œéœ€æ±‚å˜æ›´ã€‚ è½¯ä»¶å·¥ç¨‹æœ¯è¯­ é‡Œç¨‹ç¢‘ï¼ˆMilestoneï¼‰ - åœ¨åˆ¶å®šé¡¹ç›®è¿›åº¦è®¡åˆ’æ—¶ï¼Œåœ¨è¿›åº¦æ—¶é—´è¡¨ä¸Šè®¾ç«‹ä¸€äº›é‡è¦çš„æ—¶é—´æ£€æŸ¥ç‚¹ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥åœ¨é¡¹ç›®æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ©ç”¨è¿™äº›é‡è¦çš„æ—¶é—´æ£€æŸ¥ç‚¹æ¥å¯¹é¡¹ç›®çš„è¿›ç¨‹è¿›è¡Œæ£€æŸ¥å’ŒæŽ§åˆ¶ã€‚è¿™äº›é‡è¦çš„æ—¶é—´æ£€æŸ¥ç‚¹è¢«ç§°ä½œé¡¹ç›®çš„é‡Œç¨‹ç¢‘ã€‚ äººæœˆ - è½¯ä»¶å¼€å‘çš„å·¥ä½œé‡å•ä½ã€‚å¦‚ 200 äººæœˆï¼Œ10 ä¸ªäººå¼€å‘ï¼Œé‚£ç®—æ¥å°±æ˜¯èŠ± 20 ä¸ªæœˆå°±å¯å®Œå·¥ã€‚ åŸºçº¿ - åŸºçº¿æ˜¯é¡¹ç›®å‚¨å­˜åº“ä¸­æ¯ä¸ªå·¥ä»¶ç‰ˆæœ¬åœ¨ç‰¹å®šæ—¶æœŸçš„ä¸€ä¸ªâ€œå¿«ç…§â€ã€‚å®ƒæä¾›ä¸€ä¸ªæ­£å¼æ ‡å‡†ï¼ŒéšåŽçš„å·¥ä½œåŸºäºŽæ­¤æ ‡å‡†ï¼Œå¹¶ä¸”åªæœ‰ç»è¿‡æŽˆæƒåŽæ‰èƒ½å˜æ›´è¿™ä¸ªæ ‡å‡†ã€‚å»ºç«‹ä¸€ä¸ªåˆå§‹åŸºçº¿åŽï¼Œä»¥åŽæ¯æ¬¡å¯¹å…¶è¿›è¡Œçš„å˜æ›´éƒ½å°†è®°å½•ä¸ºä¸€ä¸ªå·®å€¼ï¼Œç›´åˆ°å»ºæˆä¸‹ä¸€ä¸ªåŸºçº¿ã€‚ æ›´å¤šå†…å®¹ ä¹¦ äººæœˆç¥žè¯ ä»£ç å¤§å…¨ æ–‡ç«  ä½¿ç”¨ç”˜ç‰¹å›¾åšé¡¹ç›®ç®¡ç† ä½¿ç”¨ç‡ƒå°½å›¾ç›‘æŽ§é¡¹ç›®æ•´ä½“è¿›åº¦ å·¥å…· 10 å¤§å¼€æºå…è´¹çš„é¡¹ç›®ç®¡ç†è½¯ä»¶æŽ¨è http://www.ruanyifeng.com/blog/2017/08/issue.html æ–‡æ¡£æ¨¡æ¿ è½¯ä»¶å·¥ç¨‹æ–‡æ¡£æ ‡å‡†æ¨¡æ¿ç™¾åº¦ç½‘ç›˜ä¸‹è½½ - ä¸‹è½½å¯†ç ï¼šuu1f]]></content>
      <categories>
        <category>method</category>
        <category>è½¯ä»¶å·¥ç¨‹</category>
      </categories>
      <tags>
        <tag>method</tag>
        <tag>è½¯ä»¶å·¥ç¨‹</tag>
        <tag>é¡¹ç›®ç®¡ç†</tag>
        <tag>æ–¹æ³•è®º</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨ Gitbook æ‰“é€ ä½ çš„ç”µå­ä¹¦]]></title>
    <url>%2Fblog%2F2017%2F09%2F04%2Ftools%2Fgitbook%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨ Gitbook æ‰“é€ ä½ çš„ç”µå­ä¹¦ æœ¬æ–‡è¯¦ç»†è®²è§£äº† Gitbook ç”Ÿæˆç”µå­ä¹¦çš„å®Œæ•´è¿‡ç¨‹ï¼Œå†…å®¹åŒ…æ‹¬ï¼šå®‰è£…ã€å‘½ä»¤ã€é…ç½®ã€æ–‡æ¡£ç»“æž„ã€ç”Ÿæˆç”µå­ä¹¦ã€éƒ¨ç½²ã€‚ é™äºŽç¯‡å¹…ï¼Œæœ¬æ–‡ä¸ä»‹ç»ä»»ä½• Gitbook å®šåˆ¶åŒ–é¡µé¢çš„å†…å®¹ã€‚ æƒ³çœ‹çœ‹ Gitbook åœ¨çº¿ç”µå­ä¹¦æ•ˆæžœï¼Œè¯·çŒ›æˆ³è¿™é‡Œï¼šgitbook-notes ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ æ¦‚è¿° GitBook å®‰è£… GitBook å‘½ä»¤ Gitbook ç›®å½•ç»“æž„ Gitbook é…ç½® ç”Ÿæˆç”µå­ä¹¦ Gitbook éƒ¨ç½² å‚è€ƒèµ„æ–™ æ¦‚è¿° GitBook æ˜¯ä½¿ç”¨ GitHub / Git å’Œ Markdownï¼ˆæˆ– AsciiDocï¼‰æž„å»ºæ¼‚äº®ä¹¦ç±çš„å‘½ä»¤è¡Œå·¥å…·ï¼ˆå’Œ Node.js åº“ï¼‰ã€‚ GitBook å¯ä»¥å°†æ‚¨çš„å†…å®¹ä½œä¸ºç½‘ç«™ï¼ˆå¯å®šåˆ¶å’Œå¯æ‰©å±•ï¼‰æˆ–ç”µå­ä¹¦ï¼ˆPDFï¼ŒePub æˆ– Mobiï¼‰è¾“å‡ºã€‚ GitBook.com æ˜¯ä½¿ç”¨ GitBook æ ¼å¼åˆ›å»ºå’Œæ‰˜ç®¡å›¾ä¹¦çš„åœ¨çº¿å¹³å°ã€‚å®ƒæä¾›æ‰˜ç®¡ï¼Œåä½œåŠŸèƒ½å’Œæ˜“äºŽä½¿ç”¨çš„ç¼–è¾‘å™¨ã€‚ GitBook å®‰è£… æœ¬åœ°å®‰è£… çŽ¯å¢ƒè¦æ±‚ å®‰è£… GitBook æ˜¯å¾ˆç®€å•çš„ã€‚æ‚¨çš„ç³»ç»Ÿåªéœ€è¦æ»¡è¶³è¿™ä¸¤ä¸ªè¦æ±‚ï¼š NodeJSï¼ˆæŽ¨èä½¿ç”¨ v4.0.0 åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰ Windowsï¼ŒLinuxï¼ŒUnix æˆ– Mac OS X é€šè¿‡ NPM å®‰è£… å®‰è£… GitBook çš„æœ€å¥½åŠžæ³•æ˜¯é€šè¿‡ NPMã€‚åœ¨ç»ˆç«¯æç¤ºç¬¦ä¸‹ï¼Œåªéœ€è¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯å®‰è£… GitBookï¼š $ npm install gitbook-cli -g gitbook-cli æ˜¯ GitBook çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒå°†è‡ªåŠ¨å®‰è£…æ‰€éœ€ç‰ˆæœ¬çš„ GitBook æ¥æž„å»ºä¸€æœ¬ä¹¦ã€‚ æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹ GitBook ç‰ˆæœ¬ï¼Œä»¥éªŒè¯å®‰è£…æˆåŠŸã€‚ $ gitbook -V å®‰è£…åŽ†å²ç‰ˆæœ¬ gitbook-cli å¯ä»¥è½»æ¾ä¸‹è½½å¹¶å®‰è£…å…¶ä»–ç‰ˆæœ¬çš„ GitBook æ¥æµ‹è¯•æ‚¨çš„ä¹¦ç±ï¼š $ gitbook fetch beta ä½¿ç”¨ gitbook ls-remote ä¼šåˆ—ä¸¾å¯ä»¥ä¸‹è½½çš„ç‰ˆæœ¬ã€‚ åˆ›å»ºä¸€æœ¬ä¹¦ åˆå§‹åŒ– GitBook å¯ä»¥è®¾ç½®ä¸€ä¸ªæ ·æ¿ä¹¦ï¼š $ gitbook init å¦‚æžœæ‚¨å¸Œæœ›å°†ä¹¦ç±åˆ›å»ºåˆ°ä¸€ä¸ªæ–°ç›®å½•ä¸­ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œ gitbook init ./directory è¿™æ ·åšã€‚ æž„å»º ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œä¼šåœ¨é¡¹ç›®çš„ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª _book ç›®å½•ï¼Œé‡Œé¢çš„å†…å®¹ä¸ºé™æ€ç«™ç‚¹çš„èµ„æºæ–‡ä»¶ï¼š $ gitbook build Debugging æ‚¨å¯ä»¥ä½¿ç”¨é€‰é¡¹ --log=debug å’Œ --debug æ¥èŽ·å–æ›´å¥½çš„é”™è¯¯æ¶ˆæ¯ï¼ˆä½¿ç”¨å †æ ˆè·Ÿè¸ªï¼‰ã€‚ä¾‹å¦‚ï¼š $ gitbook build ./ --log=debug --debug å¯åŠ¨æœåŠ¡ ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤ä¼šè¿è¡Œä¸€ä¸ª web æœåŠ¡, é€šè¿‡ http://localhost:4000/ å¯ä»¥é¢„è§ˆä¹¦ç± $ gitbook serve GitBook å‘½ä»¤ è¿™é‡Œä¸»è¦ä»‹ç»ä¸€ä¸‹ GitBook çš„å‘½ä»¤è¡Œå·¥å…· gitbook-cli çš„ä¸€äº›å‘½ä»¤, é¦–å…ˆè¯´æ˜Žä¸¤ç‚¹: gitbook-cli å’Œ gitbook æ˜¯ä¸¤ä¸ªè½¯ä»¶ gitbook-cli ä¼šå°†ä¸‹è½½çš„ gitbook çš„ä¸åŒç‰ˆæœ¬æ”¾åˆ° \~/.gitbookä¸­, å¯ä»¥é€šè¿‡è®¾ç½®GITBOOK_DIRçŽ¯å¢ƒå˜é‡æ¥æŒ‡å®šå¦å¤–çš„æ–‡ä»¶å¤¹ åˆ—å‡º gitbook æ‰€æœ‰çš„å‘½ä»¤ gitbook help è¾“å‡º gitbook-cli çš„å¸®åŠ©ä¿¡æ¯ gitbook --help ç”Ÿæˆé™æ€ç½‘é¡µ gitbook build ç”Ÿæˆé™æ€ç½‘é¡µå¹¶è¿è¡ŒæœåŠ¡å™¨ gitbook serve ç”Ÿæˆæ—¶æŒ‡å®š gitbook çš„ç‰ˆæœ¬, æœ¬åœ°æ²¡æœ‰ä¼šå…ˆä¸‹è½½ gitbook build --gitbook=2.0.1 åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„ gitbook ç‰ˆæœ¬ gitbook ls åˆ—å‡ºè¿œç¨‹å¯ç”¨çš„ gitbook ç‰ˆæœ¬ gitbook ls-remote å®‰è£…å¯¹åº”çš„ gitbook ç‰ˆæœ¬ gitbook fetch æ ‡ç­¾/ç‰ˆæœ¬å· æ›´æ–°åˆ° gitbook çš„æœ€æ–°ç‰ˆæœ¬ gitbook update å¸è½½å¯¹åº”çš„ gitbook ç‰ˆæœ¬ gitbook uninstall 2.0.1 æŒ‡å®š log çš„çº§åˆ« gitbook build --log=debug è¾“å‡ºé”™è¯¯ä¿¡æ¯ gitbook builid --debug Gitbook ç›®å½•ç»“æž„ GitBook é¡¹ç›®ç»“æž„ GitBook ä½¿ç”¨ç®€å•çš„ç›®å½•ç»“æž„ã€‚åœ¨ SUMMARY ï¼ˆå³ SUMMARY.md æ–‡ä»¶ï¼‰ä¸­åˆ—å‡ºçš„æ‰€æœ‰ Markdown / Asciidoc æ–‡ä»¶å°†è¢«è½¬æ¢ä¸º HTMLã€‚å¤šè¯­è¨€ä¹¦ç±ç»“æž„ç•¥æœ‰ä¸åŒã€‚ ä¸€ä¸ªåŸºæœ¬çš„ GitBook ç”µå­ä¹¦ç»“æž„é€šå¸¸å¦‚ä¸‹ï¼š .â”œâ”€â”€ book.jsonâ”œâ”€â”€ README.mdâ”œâ”€â”€ SUMMARY.mdâ”œâ”€â”€ chapter-1/| â”œâ”€â”€ README.md| â””â”€â”€ something.mdâ””â”€â”€ chapter-2/ â”œâ”€â”€ README.md â””â”€â”€ something.md GitBook ç‰¹æ®Šæ–‡ä»¶çš„åŠŸèƒ½ï¼š æ–‡ä»¶ æè¿° book.json é…ç½®æ•°æ® (optional) README.md ç”µå­ä¹¦çš„å‰è¨€æˆ–ç®€ä»‹ (required) SUMMARY.md ç”µå­ä¹¦ç›®å½• (optional) GLOSSARY.md è¯æ±‡/æ³¨é‡Šæœ¯è¯­åˆ—è¡¨ (optional) é™æ€æ–‡ä»¶å’Œå›¾ç‰‡ é™æ€æ–‡ä»¶æ˜¯åœ¨ SUMMARY.md ä¸­æœªåˆ—å‡ºçš„æ–‡ä»¶ã€‚é™¤éžè¢«å¿½ç•¥ï¼Œå¦åˆ™æ‰€æœ‰é™æ€æ–‡ä»¶éƒ½å°†å¤åˆ¶åˆ°è¾“å‡ºè·¯å¾„ã€‚ å¿½ç•¥æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ GitBook å°†è¯»å– .gitignoreï¼Œ.bookignore å’Œ .ignore æ–‡ä»¶ï¼Œä»¥èŽ·å–è¦è¿‡æ»¤çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚è¿™äº›æ–‡ä»¶ä¸­çš„æ ¼å¼éµå¾ª .gitignore çš„è§„åˆ™ï¼š # This is a comment# Ignore the file test.mdtest.md# Ignore everything in the directory "bin"bin/* é¡¹ç›®ä¸Žå­ç›®å½•é›†æˆ å¯¹äºŽè½¯ä»¶é¡¹ç›®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å­ç›®å½•ï¼ˆå¦‚ docs/ ï¼‰æ¥å­˜å‚¨é¡¹ç›®æ–‡æ¡£çš„å›¾ä¹¦ã€‚æ‚¨å¯ä»¥é…ç½®æ ¹é€‰é¡¹æ¥æŒ‡ç¤º GitBook å¯ä»¥æ‰¾åˆ°è¯¥å›¾ä¹¦æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼š .â”œâ”€â”€ book.jsonâ””â”€â”€ docs/ â”œâ”€â”€ README.md â””â”€â”€ SUMMARY.md åœ¨ book.json ä¸­é…ç½®ä»¥ä¸‹å†…å®¹ï¼š &#123; "root": "./docs"&#125; Summary GitBook ä½¿ç”¨ SUMMARY.md æ–‡ä»¶æ¥å®šä¹‰æœ¬ä¹¦çš„ç« èŠ‚å’Œå­ç« èŠ‚çš„ç»“æž„ã€‚ SUMMARY.md æ–‡ä»¶ç”¨äºŽç”Ÿæˆæœ¬ä¹¦çš„ç›®å½•ã€‚ SUMMARY.md çš„æ ¼å¼æ˜¯ä¸€ä¸ªé“¾æŽ¥åˆ—è¡¨ã€‚é“¾æŽ¥çš„æ ‡é¢˜å°†ä½œä¸ºç« èŠ‚çš„æ ‡é¢˜ï¼Œé“¾æŽ¥çš„ç›®æ ‡æ˜¯è¯¥ç« èŠ‚æ–‡ä»¶çš„è·¯å¾„ã€‚ å‘çˆ¶ç« èŠ‚æ·»åŠ åµŒå¥—åˆ—è¡¨å°†åˆ›å»ºå­ç« èŠ‚ã€‚ ç®€å•ç¤ºä¾‹ï¼š # Summary* [Part I](part1/README.md) * [Writing is nice](part1/writing.md) * [GitBook is nice](part1/gitbook.md)* [Part II](part2/README.md) * [We love feedback](part2/feedback_please.md) * [Better tools for authors](part2/better_tools.md) æ¯ç« éƒ½æœ‰ä¸€ä¸ªä¸“ç”¨é¡µé¢ï¼ˆpart#/README.mdï¼‰ï¼Œå¹¶åˆ†ä¸ºå­ç« èŠ‚ã€‚ é”šç‚¹ ç›®å½•ä¸­çš„ç« èŠ‚å¯ä»¥ä½¿ç”¨é”šç‚¹æŒ‡å‘æ–‡ä»¶çš„ç‰¹å®šéƒ¨åˆ†ã€‚ # Summary### Part I* [Part I](part1/README.md) * [Writing is nice](part1/README.md#writing) * [GitBook is nice](part1/README.md#gitbook)* [Part II](part2/README.md) * [We love feedback](part2/README.md#feedback) * [Better tools for authors](part2/README.md#tools) éƒ¨åˆ† ç›®å½•å¯ä»¥åˆ†ä¸ºä»¥æ ‡é¢˜æˆ–æ°´å¹³çº¿ ---- åˆ†éš”çš„éƒ¨åˆ†ï¼š # Summary### Part I* [Writing is nice](part1/writing.md)* [GitBook is nice](part1/gitbook.md)### Part II* [We love feedback](part2/feedback_please.md)* [Better tools for authors](part2/better_tools.md)----* [Last part without title](part3/title.md) Parts åªæ˜¯ç« èŠ‚ç»„ï¼Œæ²¡æœ‰ä¸“ç”¨é¡µé¢ï¼Œä½†æ ¹æ®ä¸»é¢˜ï¼Œå®ƒå°†åœ¨å¯¼èˆªä¸­æ˜¾ç¤ºã€‚ é¡µé¢ Markdown è¯­æ³• é»˜è®¤æƒ…å†µä¸‹ï¼ŒGitBook çš„å¤§å¤šæ•°æ–‡ä»¶éƒ½ä½¿ç”¨ Markdown è¯­æ³•ã€‚ GitBook æŽ¨èä½¿ç”¨è¿™ç§è¯­æ³•ã€‚æ‰€ä½¿ç”¨çš„è¯­æ³•ç±»ä¼¼äºŽ GitHub Flavored Markdown syntax ã€‚ æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥é€‰æ‹© AsciiDoc è¯­æ³•ã€‚ é¡µé¢å†…å®¹ç¤ºä¾‹ï¼š # Title of the chapterThis is a great introduction.## Section 1Markdown will dictates _most_ of your **book's structure**## Section 2... é¡µé¢å‰è¨€ é¡µé¢å¯ä»¥åŒ…å«ä¸€ä¸ªå¯é€‰çš„å‰è¨€ã€‚å®ƒå¯ä»¥ç”¨äºŽå®šä¹‰é¡µé¢çš„æè¿°ã€‚å‰é¢çš„äº‹æƒ…å¿…é¡»æ˜¯æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä»¶äº‹ï¼Œå¿…é¡»é‡‡å–åœ¨ä¸‰è™šçº¿ä¹‹é—´è®¾ç½®çš„æœ‰æ•ˆ YAML çš„å½¢å¼ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­ï¼š ---description: This is a short description of my page---# The content of my page... Glossary å…è®¸æ‚¨æŒ‡å®šè¦æ˜¾ç¤ºä¸ºæ³¨é‡Šçš„æœ¯è¯­åŠå…¶å„è‡ªçš„å®šä¹‰ã€‚æ ¹æ®è¿™äº›æœ¯è¯­ï¼ŒGitBook å°†è‡ªåŠ¨æž„å»ºç´¢å¼•å¹¶çªå‡ºæ˜¾ç¤ºè¿™äº›æœ¯è¯­ã€‚ GLOSSARY.md çš„æ ¼å¼æ˜¯ h2 æ ‡é¢˜çš„åˆ—è¡¨ï¼Œä»¥åŠæè¿°æ®µè½ï¼š ## TermDefinition for this term## Another termWith it's definition, this can contain bold textand all other kinds of inline markup ... Gitbook é…ç½® GitBook å…è®¸æ‚¨ä½¿ç”¨çµæ´»çš„é…ç½®è‡ªå®šä¹‰æ‚¨çš„ç”µå­ä¹¦ã€‚ è¿™äº›é€‰é¡¹åœ¨ book.json æ–‡ä»¶ä¸­æŒ‡å®šã€‚å¯¹äºŽä¸ç†Ÿæ‚‰ JSON è¯­æ³•çš„ä½œè€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ JSONlint ç­‰å·¥å…·éªŒè¯è¯­æ³•ã€‚ å¸¸è§„è®¾ç½® å˜é‡ æè¿° root åŒ…å«æ‰€æœ‰å›¾ä¹¦æ–‡ä»¶çš„æ ¹æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼Œé™¤äº† book.json structure æŒ‡å®šè‡ªè¿°æ–‡ä»¶ï¼Œæ‘˜è¦ï¼Œè¯æ±‡è¡¨ç­‰çš„è·¯å¾„ï¼Œå‚è€ƒ Structure paragraph. title æ‚¨çš„ä¹¦åï¼Œé»˜è®¤å€¼æ˜¯ä»Ž README ä¸­æå–å‡ºæ¥çš„ã€‚åœ¨ GitBook.com ä¸Šï¼Œè¿™ä¸ªå­—æ®µæ˜¯é¢„å¡«çš„ã€‚ description æ‚¨çš„ä¹¦ç±çš„æè¿°ï¼Œé»˜è®¤å€¼æ˜¯ä»Ž README ä¸­æå–å‡ºæ¥çš„ã€‚åœ¨ GitBook.com ä¸Šï¼Œè¿™ä¸ªå­—æ®µæ˜¯é¢„å¡«çš„ã€‚ author ä½œè€…åã€‚åœ¨ GitBook.com ä¸Šï¼Œè¿™ä¸ªå­—æ®µæ˜¯é¢„å¡«çš„ã€‚ isbn å›½é™…æ ‡å‡†ä¹¦å· ISBN language æœ¬ä¹¦çš„è¯­è¨€ç±»åž‹ â€”â€” ISO code ã€‚é»˜è®¤å€¼æ˜¯ en direction æ–‡æœ¬é˜…è¯»é¡ºåºã€‚å¯ä»¥æ˜¯ rtl ï¼ˆä»Žå³å‘å·¦ï¼‰æˆ– ltr ï¼ˆä»Žå·¦å‘å³ï¼‰ï¼Œé»˜è®¤å€¼ä¾èµ–äºŽ language çš„å€¼ã€‚ gitbook åº”è¯¥ä½¿ç”¨çš„ GitBook ç‰ˆæœ¬ã€‚ä½¿ç”¨ SemVer è§„èŒƒï¼Œå¹¶æŽ¥å—ç±»ä¼¼äºŽ â€œ&gt; = 3.0.0â€ çš„æ¡ä»¶ã€‚ author ä½œè€…å§“åï¼Œåœ¨ GitBook.com ä¸Šï¼Œè¿™ä¸ªå­—æ®µæ˜¯é¢„å…ˆå¡«å†™çš„ã€‚ ä¾‹ï¼š "author" : "victor zhang" description ç”µå­ä¹¦çš„æè¿°ï¼Œé»˜è®¤å€¼æ˜¯ä»Ž README ä¸­æå–å‡ºæ¥çš„ã€‚åœ¨ GitBook.com ä¸Šï¼Œè¿™ä¸ªå­—æ®µæ˜¯é¢„å…ˆå¡«å†™çš„ã€‚ ä¾‹ï¼š "description" : "Gitbook æ•™ç¨‹" direction æ–‡æœ¬çš„æ–¹å‘ã€‚å¯ä»¥æ˜¯ rtl æˆ– ltrï¼Œé»˜è®¤å€¼å–å†³äºŽè¯­è¨€çš„å€¼ã€‚ ä¾‹ï¼š "direction" : "ltr" gitbook åº”è¯¥ä½¿ç”¨çš„ GitBook ç‰ˆæœ¬ã€‚ä½¿ç”¨ SemVer è§„èŒƒï¼ŒæŽ¥å—ç±»ä¼¼äºŽ &gt;=3.0.0 çš„æ¡ä»¶ã€‚ ä¾‹ï¼š "gitbook" : "3.0.0","gitbook" : "&gt;=3.0.0" language Gitbook ä½¿ç”¨çš„è¯­è¨€, ç‰ˆæœ¬ 2.6.4 ä¸­å¯é€‰çš„è¯­è¨€å¦‚ä¸‹ï¼š en, ar, bn, cs, de, en, es, fa, fi, fr, he, it, ja, ko, no, pl, pt, ro, ru, sv, uk, vi, zh-hans, zh-tw ä¾‹ï¼š "language" : "zh-hans", links åœ¨å·¦ä¾§å¯¼èˆªæ æ·»åŠ é“¾æŽ¥ä¿¡æ¯ ä¾‹ï¼š "links" : &#123; "sidebar" : &#123; "Home" : "https://github.com/dunwu/gitbook-notes" &#125;&#125; root åŒ…å«æ‰€æœ‰å›¾ä¹¦æ–‡ä»¶çš„æ ¹æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼Œ book.json æ–‡ä»¶é™¤å¤–ã€‚ ä¾‹ï¼š "root" : "./docs", structure æŒ‡å®š Readmeã€Summaryã€Glossary å’Œ Languages å¯¹åº”çš„æ–‡ä»¶åã€‚ styles è‡ªå®šä¹‰é¡µé¢æ ·å¼ï¼Œ é»˜è®¤æƒ…å†µä¸‹å„ generator å¯¹åº”çš„ css æ–‡ä»¶ ä¾‹ï¼š "styles": &#123; "website": "styles/website.css", "ebook": "styles/ebook.css", "pdf": "styles/pdf.css", "mobi": "styles/mobi.css", "epub": "styles/epub.css"&#125; ä¾‹å¦‚è¦ä½¿ h1ã€h2 æ ‡ç­¾æœ‰ä¸‹è¾¹æ¡†ï¼Œ å¯ä»¥åœ¨ website.css ä¸­è®¾ç½® h1,h2 &#123; border-bottom: 1px solid #efeaea;&#125; title ç”µå­ä¹¦çš„ä¹¦åï¼Œé»˜è®¤å€¼æ˜¯ä»Ž README ä¸­æå–å‡ºæ¥çš„ã€‚åœ¨ GitBook.com ä¸Šï¼Œè¿™ä¸ªå­—æ®µæ˜¯é¢„å…ˆå¡«å†™çš„ã€‚ ä¾‹ï¼š "title" : "gitbook-notes", plugins æ’ä»¶åŠå…¶é…ç½®åœ¨ book.json ä¸­æŒ‡å®šã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ã€‚ è‡ª 3.0.0 ç‰ˆæœ¬å¼€å§‹ï¼ŒGitBook å¯ä»¥ä½¿ç”¨ä¸»é¢˜ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… the theming section ã€‚ å˜é‡ æè¿° plugins è¦åŠ è½½çš„æ’ä»¶åˆ—è¡¨ pluginsConfig æ’ä»¶çš„é…ç½® æ·»åŠ æ’ä»¶ "plugins": [ "splitter"] æ·»åŠ æ–°æ’ä»¶ä¹‹åŽéœ€è¦è¿è¡Œ gitbook install æ¥å®‰è£…æ–°çš„æ’ä»¶ åŽ»é™¤è‡ªå¸¦æ’ä»¶ Gitbook é»˜è®¤å¸¦æœ‰ 5 ä¸ªæ’ä»¶ï¼š highlight search sharing font-settings livereload "plugins": [ "-search"] structure é™¤äº† root å±žæ€§ä¹‹å¤–ï¼Œæ‚¨å¯ä»¥æŒ‡å®š Readmeï¼ŒSummaryï¼ŒGlossary å’Œ Languages çš„åç§°ï¼ˆè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤åç§°ï¼Œå¦‚ README.mdï¼‰ã€‚è¿™äº›æ–‡ä»¶å¿…é¡»åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼ˆæˆ– root çš„æ ¹ç›®å½•ï¼Œå¦‚æžœä½ åœ¨ book.json ä¸­é…ç½®äº† root å±žæ€§ï¼‰ã€‚ä¸æŽ¥å—çš„è·¯å¾„ï¼Œå¦‚ï¼šdir / MY_README.mdã€‚ å˜é‡ æè¿° structure.readme Readme æ–‡ä»¶åï¼ˆé»˜è®¤å€¼æ˜¯ README.md ï¼‰ structure.summary Summary æ–‡ä»¶åï¼ˆé»˜è®¤å€¼æ˜¯ SUMMARY.md ï¼‰ structure.glossary Glossary æ–‡ä»¶åï¼ˆé»˜è®¤å€¼æ˜¯ GLOSSARY.md ï¼‰ structure.languages Languages æ–‡ä»¶åï¼ˆé»˜è®¤å€¼æ˜¯ LANGS.md ï¼‰ pdf å¯ä»¥ä½¿ç”¨ book.json ä¸­çš„ä¸€ç»„é€‰é¡¹æ¥å®šåˆ¶ PDF è¾“å‡ºï¼š Variable Description pdf.pageNumbers å°†é¡µç æ·»åŠ åˆ°æ¯ä¸ªé¡µé¢çš„åº•éƒ¨ï¼ˆé»˜è®¤ä¸º trueï¼‰ pdf.fontSize åŸºæœ¬å­—ä½“å¤§å°ï¼ˆé»˜è®¤æ˜¯ 12ï¼‰ pdf.fontFamily åŸºæœ¬å­—ä½“æ ·å¼ï¼ˆé»˜è®¤æ˜¯ Arialï¼‰ pdf.paperSize é¡µé¢å°ºå¯¸ï¼Œé€‰é¡¹æœ‰ï¼š 'a0', 'a1', 'a2', 'a3', 'a4', 'a5', 'a6', 'b0', 'b1', 'b2', 'b3', 'b4', 'b5', 'b6', 'legal', 'letter' ï¼ˆé»˜è®¤å€¼æ˜¯ a4ï¼‰ pdf.margin.top ä¸Šè¾¹ç•Œï¼ˆé»˜è®¤å€¼æ˜¯ 56ï¼‰ pdf.margin.bottom ä¸‹è¾¹ç•Œï¼ˆé»˜è®¤å€¼æ˜¯ 56ï¼‰ pdf.margin.right å³è¾¹ç•Œï¼ˆé»˜è®¤å€¼æ˜¯ 62ï¼‰ pdf.margin.left å·¦è¾¹ç•Œï¼ˆé»˜è®¤å€¼æ˜¯ 62ï¼‰ ç”Ÿæˆç”µå­ä¹¦ GitBook å¯ä»¥ç”Ÿæˆä¸€ä¸ªç½‘ç«™ï¼Œä½†ä¹Ÿå¯ä»¥è¾“å‡ºå†…å®¹ä½œä¸ºç”µå­ä¹¦ï¼ˆePubï¼ŒMobiï¼ŒPDFï¼‰ã€‚ # Generate a PDF file$ gitbook pdf ./ ./mybook.pdf# Generate an ePub file$ gitbook epub ./ ./mybook.epub# Generate a Mobi file$ gitbook mobi ./ ./mybook.mobi å®‰è£… ebook-convert ebook-convert å¯ä»¥ç”¨æ¥ç”Ÿæˆç”µå­ä¹¦ï¼ˆepubï¼Œmobiï¼Œpdfï¼‰ã€‚ GNU/Linux å®‰è£… Calibre application. $ sudo aptitude install calibre åœ¨ä¸€äº› GNU / Linux å‘è¡Œç‰ˆä¸­ï¼ŒèŠ‚ç‚¹è¢«å®‰è£…ä¸º nodejsï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æŽ¥ï¼š $sudo ln -s /usr/bin/nodejs /usr/bin/node OS X ä¸‹è½½ Calibre applicationã€‚å°† calibre.app ç§»åŠ¨åˆ°åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹åŽï¼Œåˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æŽ¥åˆ° ebook-convert å·¥å…·ï¼š $ sudo ln -s ~/Applications/calibre.app/Contents/MacOS/ebook-convert /usr/bin æ‚¨å¯ä»¥ä½¿ç”¨ $PATH ä¸­çš„ä»»ä½•ç›®å½•æ›¿æ¢ /usr/bin ã€‚ å°é¢ å°é¢ç”¨äºŽæ‰€æœ‰ç”µå­ä¹¦æ ¼å¼ã€‚æ‚¨å¯ä»¥è‡ªå·±æä¾›ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ autocover plugin ç”Ÿæˆä¸€ä¸ªã€‚ è¦æä¾›å°é¢ï¼Œè¯·å°† cover.jpg æ–‡ä»¶æ”¾åœ¨ä¹¦æœ¬çš„æ ¹ç›®å½•ä¸‹ã€‚æ·»åŠ ä¸€ä¸ª cover_small.jpg å°†æŒ‡å®šä¸€ä¸ªè¾ƒå°ç‰ˆæœ¬çš„å°é¢ã€‚å°é¢åº”ä¸º JPEG æ–‡ä»¶ã€‚ å¥½çš„å°é¢åº”è¯¥éµå®ˆä»¥ä¸‹å‡†åˆ™ï¼š cover.jpg çš„å°ºå¯¸ä¸º 1800x2360 åƒç´ ï¼Œcover_small.jpg ä¸º 200x262 æ²¡æœ‰è¾¹ç•Œ æ¸…æ™°å¯è§çš„ä¹¦å ä»»ä½•é‡è¦çš„æ–‡å­—åº”è¯¥åœ¨å°ç‰ˆæœ¬ä¸­å¯è§ Gitbook éƒ¨ç½² æ‰˜ç®¡åˆ° gitbook.com GitBook.com æ˜¯ä½¿ç”¨ GitBook æ ¼å¼åˆ›å»ºå’Œæ‰˜ç®¡å›¾ä¹¦çš„åœ¨çº¿å¹³å°ã€‚å®ƒæä¾›æ‰˜ç®¡ï¼Œåä½œåŠŸèƒ½å’Œæ˜“äºŽä½¿ç”¨çš„ç¼–è¾‘å™¨ã€‚ åˆ›å»ºæ–°ä¹¦ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ ¹æ®ä¸ªäººéœ€æ±‚ï¼Œé€‰æ‹©ä¸€ä¸ªæ¨¡æ¿åˆ›å»ºä½ çš„ç”µå­ä¹¦ã€‚ è®¾ç½®ä¹¦çš„åŸºæœ¬ä¿¡æ¯ clone åˆ°æœ¬åœ° Gitbook.com ä¼šä¸ºæ¯æœ¬ä¹¦åˆ›å»ºä¸€ä¸ª git ä»“åº“ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ‹·è´ git åœ°å€ï¼Œç„¶åŽ git clone åˆ°æœ¬åœ°ã€‚ å‘å¸ƒ åœ¨æœ¬åœ°æŒ‰ç…§ Gitbook è§„èŒƒç¼–è¾‘ç”µå­ä¹¦ï¼Œç„¶åŽ git push åˆ° Gitbook çš„è¿œç¨‹ä»“åº“ã€‚ é»˜è®¤è®¿é—®åœ°å€æ˜¯ï¼šhttps://ç”¨æˆ·å.gitbooks.io/é¡¹ç›®å/content/ ä¾‹å¦‚ï¼šæˆ‘çš„ç”¨æˆ·åä¸º dunwuï¼Œä¸€ä¸ªç”µå­ä¹¦é¡¹ç›®åä¸º testï¼Œåˆ™è®¿é—®è·¯å¾„æ˜¯ï¼š https://dunwu.gitbooks.io/test/content/ å½“ç„¶ï¼Œå¦‚æžœä½ æœ‰è‡ªå·±çš„åŸŸåï¼Œä¹Ÿå¯ä»¥è®¾ç½® Domains é€‰é¡¹ï¼Œæ¥æŒ‡å®šè®¿é—®è·¯å¾„ä¸ºä½ çš„åŸŸã€‚ æ‰˜ç®¡åˆ° Github å¦‚æžœä½ ä¸å¸Œæœ›ä½¿ç”¨ Gitbook çš„ä»“åº“ï¼Œè€Œæ˜¯æƒ³ç›´æŽ¥ä½¿ç”¨ Github çš„ä»“åº“ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ é¦–å…ˆï¼Œä½ éœ€è¦ç»‘å®šä½ çš„ Github è´¦å·ã€‚æœ€ç®€å•çš„æ–¹å¼å½“ç„¶å°±æ˜¯ç™»å½• Gitbook.com æ—¶ä½¿ç”¨ Github è´¦å·ç™»å½•æ–¹å¼äº†ã€‚å¦åˆ™ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ Account Settings ä¸­çš„ Github è®¾ç½®é€‰é¡¹ä¸­åŽ»è¿›è¡Œç»‘å®šã€‚ ç»‘å®šäº† Github è´¦å·åŽï¼Œä½ å¯ä»¥åœ¨æ–°å»ºç”µå­ä¹¦æ—¶ï¼Œé€‰æ‹©ä»Žä¸€ä¸ªæŒ‡å®šçš„ Github ä»“åº“å¯¼å…¥ç”µå­ä¹¦é¡¹ç›®ã€‚å‚è€ƒä¸‹å›¾ï¼š åªè¦ä½ æŒ‡å®šçš„ Github ä»“åº“ä¸­çš„æ–‡æ¡£å†…å®¹ç¬¦åˆ Gitbook è§„èŒƒï¼ŒGitbook å°±ä¼šè‡ªåŠ¨æ ¹æ®ä½ çš„æ¯æ¬¡æ›´æ–°åŽ»æž„å»ºç”Ÿæˆç”µå­ä¹¦ç½‘ç«™ã€‚ é»˜è®¤è®¿é—®åœ°å€æ˜¯ï¼š https://Githubç”¨æˆ·å.gitbooks.io/Github ä»“åº“/content/ ä¾‹å¦‚ï¼šæˆ‘çš„ç”¨æˆ·åä¸º dunwuï¼ŒGithub ä»“åº“åä¸º gitbook-notesï¼Œåˆ™è®¿é—®è·¯å¾„æ˜¯ï¼š https://dunwu.gitbooks.io/gitbook-notes/content/ æ‰˜ç®¡åˆ° Github Pages ä¹Ÿè®¸ä½ ä»¥å‰ä¹Ÿäº†è§£ Github çš„ä¸€ä¸ªåŠŸèƒ½ï¼š GitHub Pages ã€‚å®ƒå…è®¸ç”¨æˆ·åœ¨ GitHub ä»“åº“æ‰˜ç®¡ä½ çš„ä¸ªäººã€ç»„ç»‡æˆ–é¡¹ç›®çš„é™æ€é¡µé¢ï¼ˆè‡ªåŠ¨è¯†åˆ« htmlã€cssã€javascriptï¼‰ã€‚ å»ºç«‹ xxx.github.io ä»“åº“ è¦ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œé¦–å…ˆï¼Œä½ å¿…é¡»å»ºç«‹ä¸€ä¸ªä¸¥æ ¼éµå¾ªä»¥ä¸‹å‘½åè¦æ±‚çš„ä»“åº“ï¼šGithubè´¦å·å.github.ioä¸¾ä¾‹ï¼Œæˆ‘çš„ Github è´¦å·ä¸º dunwuï¼Œåˆ™è¿™ä¸ªä»“åº“åº”è¯¥å« dunwu.github.ioã€‚é€šå¸¸ï¼Œè¿™ä¸ªä»“åº“è¢«ç”¨æ¥ä½œä¸ºä¸ªäººæˆ–ç»„ç»‡çš„åšå®¢ã€‚ å»ºç«‹ gh-pages åˆ†æ”¯ å®Œæˆç¬¬ 1 æ­¥åŽï¼Œåœ¨ä»»æ„ä¸€ä¸ª Github ä»“åº“ä¸­å»ºç«‹ä¸€ä¸ªåä¸º gh-pages çš„åˆ†æ”¯ã€‚åªè¦ gh-pages ä¸­çš„å†…å®¹ç¬¦åˆä¸€ä¸ªé™æ€ç«™ç‚¹è¦æ±‚ï¼Œå°±å¯ä»¥åœ¨å¦‚ä¸‹åœ°å€ä¸­è¿›è¡Œè®¿é—®ï¼šhttps://Githubç”¨æˆ·å.gitbooks.io/Github ä»“åº“ ã€‚ä¾‹å¦‚ï¼šæˆ‘çš„ä¸€ä¸ª Github ä»“åº“åä¸º react-notesï¼Œåˆ™è®¿é—®è·¯å¾„æ˜¯ï¼šhttps://dunwu.github.io/react-notes è‡ªåŠ¨åŒ–å‘å¸ƒåˆ° gh-pages å¦‚æžœæ¯æ¬¡éƒ½æ‰‹åŠ¨ git push åˆ°è¿œç¨‹ gh-pages åˆ†æ”¯ï¼Œç•¥æœ‰ç‚¹éº»çƒ¦ã€‚ æ€Žä¹ˆå®žçŽ°è‡ªåŠ¨åŒ–å‘å¸ƒå‘¢ï¼Ÿ æœ‰ä¸¤ç§æ–¹æ³•ï¼š ä½¿ç”¨ gh-pages æ’ä»¶ å¦‚æžœä½ äº†è§£ Nodejsï¼Œé‚£ä¹ˆæœ€ç®€å•çš„å‘å¸ƒæ–¹å¼å°±æ˜¯ä½¿ç”¨ gh-pages æ’ä»¶ã€‚ å…ˆåœ¨æœ¬åœ°å®‰è£…æ’ä»¶ $ npm i -D gh-pages ç„¶åŽï¼Œåœ¨ package.json æ–‡ä»¶ä¸­æ·»åŠ è„šæœ¬å‘½ä»¤ï¼š å¦‚ä¸‹ï¼š-d å‘½ä»¤å‚æ•°åŽé¢æ˜¯è¦å‘å¸ƒçš„é™æ€ç«™ç‚¹å†…å®¹çš„ç›®å½• "scripts": &#123; "deploy": "gh-pages -d build"&#125;, è„šæœ¬ å†™ä¸€ä¸ªæ‰§è¡Œ git å‘½ä»¤çš„è„šæœ¬å°±æžå®šäº†ã€‚ ä¸‹é¢çš„è„šæœ¬æ— è®ºæ˜¯åœ¨ bat æˆ– sh è„šæœ¬ä¸­éƒ½å¯ä»¥æ‰§è¡Œã€‚ cd buildgit initgit checkout -b gh-pagesgit add .git commit -am "Update"git push git@github.com:dunwu/gitbook-notes gh-pages --force" å‚è€ƒèµ„æ–™ å®˜æ–¹èµ„æº Gitbook Github Gitbook å®˜ç½‘ Gitbook Toolchain æ–‡æ¡£ Gitbook å¸®åŠ©ä¸­å¿ƒ æ•™ç¨‹èµ„æº gitbook-use by zhangjikai å·¥å…· Gitbook ç¼–è¾‘å™¨]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>tools</tag>
        <tag>gitbook</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ­£åˆ™è¡¨è¾¾å¼]]></title>
    <url>%2Fblog%2F2016%2F10%2F10%2Ftools%2Fregex%2F</url>
    <content type="text"><![CDATA[æ­£åˆ™è¡¨è¾¾å¼ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ ç®€ä»‹ åŸºæœ¬å…ƒå­—ç¬¦ ç­‰ä»·å­—ç¬¦ å…ƒå­—ç¬¦ä¼˜å…ˆçº§é¡ºåº æ•èŽ·ä¸Žéžæ•èŽ· åå‘å¼•ç”¨ éžæ•èŽ·ç»„ é›¶å®½æ–­è¨€ è´ªå©ªä¸Žæ‡’æƒ° æœ€å®žç”¨çš„æ­£åˆ™ é€ŸæŸ¥å…ƒå­—ç¬¦å­—å…¸ å‚è€ƒèµ„æ–™ ç®€ä»‹ ä¸ºäº†ç†è§£ä¸‹é¢ç« èŠ‚çš„å†…å®¹ï¼Œä½ éœ€è¦å…ˆäº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚ æ­£åˆ™è¡¨è¾¾å¼ - æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¯¹å­—ç¬¦ä¸²æ“ä½œçš„ä¸€ç§é€»è¾‘å…¬å¼ï¼Œå°±æ˜¯ç”¨äº‹å…ˆå®šä¹‰å¥½çš„ä¸€äº›ç‰¹å®šå­—ç¬¦ã€åŠè¿™äº›ç‰¹å®šå­—ç¬¦çš„ç»„åˆï¼Œç»„æˆä¸€ä¸ªâ€œè§„åˆ™å­—ç¬¦ä¸²â€ï¼Œè¿™ä¸ªâ€œè§„åˆ™å­—ç¬¦ä¸²â€ç”¨æ¥è¡¨è¾¾å¯¹å­—ç¬¦ä¸²çš„ä¸€ç§è¿‡æ»¤é€»è¾‘ã€‚ å…ƒå­—ç¬¦ - å…ƒå­—ç¬¦(metacharacters)å°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­å…·æœ‰ç‰¹æ®Šæ„ä¹‰çš„ä¸“ç”¨å­—ç¬¦ã€‚ æ™®é€šå­—ç¬¦ - æ™®é€šå­—ç¬¦åŒ…æ‹¬æ²¡æœ‰æ˜¾å¼æŒ‡å®šä¸ºå…ƒå­—ç¬¦çš„æ‰€æœ‰å¯æ‰“å°å’Œä¸å¯æ‰“å°å­—ç¬¦ã€‚è¿™åŒ…æ‹¬æ‰€æœ‰å¤§å†™å’Œå°å†™å­—æ¯ã€æ‰€æœ‰æ•°å­—ã€æ‰€æœ‰æ ‡ç‚¹ç¬¦å·å’Œä¸€äº›å…¶ä»–ç¬¦å·ã€‚ åŸºæœ¬å…ƒå­—ç¬¦ æ­£åˆ™è¡¨è¾¾å¼çš„å…ƒå­—ç¬¦éš¾ä»¥è®°å¿†ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å› ä¸ºæœ‰å¾ˆå¤šä¸ºäº†ç®€åŒ–è¡¨è¾¾è€Œå‡ºçŽ°çš„ç­‰ä»·å­—ç¬¦ã€‚ è€Œå®žé™…ä¸Šæœ€åŸºæœ¬çš„å…ƒå­—ç¬¦ï¼Œå¹¶æ²¡æœ‰é‚£ä¹ˆå¤šã€‚å¯¹äºŽå¤§éƒ¨åˆ†çš„åœºæ™¯ï¼ŒåŸºæœ¬å…ƒå­—ç¬¦éƒ½å¯ä»¥æžå®šã€‚ è®©æˆ‘ä»¬ä»Žä¸€ä¸ªä¸ªå®žä¾‹å‡ºå‘ï¼Œç”±æµ…å…¥æ·±çš„åŽ»ä½“ä¼šæ­£åˆ™çš„å¥¥å¦™ã€‚ å¤šé€‰ - | ä¾‹ åŒ¹é…ä¸€ä¸ªç¡®å®šçš„å­—ç¬¦ä¸² checkMatches("abc", "abc"); å¦‚æžœè¦åŒ¹é…ä¸€ä¸ªç¡®å®šçš„å­—ç¬¦ä¸²ï¼Œéžå¸¸ç®€å•ï¼Œå¦‚ä¾‹ 1 æ‰€ç¤ºã€‚ å¦‚æžœä½ ä¸ç¡®å®šè¦åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œå¸Œæœ›æœ‰å¤šä¸ªé€‰æ‹©ï¼Œæ€Žä¹ˆåŠžï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šä½¿ç”¨å…ƒå­—ç¬¦| ï¼Œå®ƒçš„å«ä¹‰æ˜¯æˆ–ã€‚ ä¾‹ åŒ¹é…å¤šä¸ªå¯é€‰çš„å­—ç¬¦ä¸² // æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ï¼š|Assert.assertTrue(checkMatches("yes|no", "yes"));Assert.assertTrue(checkMatches("yes|no", "no"));Assert.assertFalse(checkMatches("yes|no", "right")); è¾“å‡º yes matchesï¼š yes|nono matchesï¼š yes|noright not matchesï¼š yes|no åˆ†ç»„ - () å¦‚æžœä½ å¸Œæœ›è¡¨è¾¾å¼ç”±å¤šä¸ªå­è¡¨è¾¾å¼ç»„æˆï¼Œä½ å¯ä»¥ä½¿ç”¨ ()ã€‚ ä¾‹ åŒ¹é…ç»„åˆå­—ç¬¦ä¸² Assert.assertTrue(checkMatches("(play|end)(ing|ed)", "ended"));Assert.assertTrue(checkMatches("(play|end)(ing|ed)", "ending"));Assert.assertTrue(checkMatches("(play|end)(ing|ed)", "playing"));Assert.assertTrue(checkMatches("(play|end)(ing|ed)", "played")); è¾“å‡º ended matchesï¼š (play|end)(ing|ed)ending matchesï¼š (play|end)(ing|ed)playing matchesï¼š (play|end)(ing|ed)played matchesï¼š (play|end)(ing|ed) æŒ‡å®šå•å­—ç¬¦æœ‰æ•ˆèŒƒå›´ - [] å‰é¢å±•ç¤ºäº†å¦‚ä½•åŒ¹é…å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™ä½ éœ€è¦ç²¾ç¡®çš„åŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨[] ã€‚ ä¾‹ å­—ç¬¦åœ¨æŒ‡å®šèŒƒå›´ // æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ï¼š[]Assert.assertTrue(checkMatches("[abc]", "b")); // å­—ç¬¦åªèƒ½æ˜¯aã€bã€cAssert.assertTrue(checkMatches("[a-z]", "m")); // å­—ç¬¦åªèƒ½æ˜¯a - zAssert.assertTrue(checkMatches("[A-Z]", "O")); // å­—ç¬¦åªèƒ½æ˜¯A - ZAssert.assertTrue(checkMatches("[a-zA-Z]", "K")); // å­—ç¬¦åªèƒ½æ˜¯a - zå’ŒA - ZAssert.assertTrue(checkMatches("[a-zA-Z]", "k"));Assert.assertTrue(checkMatches("[0-9]", "5")); // å­—ç¬¦åªèƒ½æ˜¯0 - 9 è¾“å‡º b matchesï¼š [abc]m matchesï¼š [a-z]O matchesï¼š [A-Z]K matchesï¼š [a-zA-Z]k matchesï¼š [a-zA-Z]5 matchesï¼š [0-9] æŒ‡å®šå•å­—ç¬¦æ— æ•ˆèŒƒå›´ - [^] ä¾‹ å­—ç¬¦ä¸èƒ½åœ¨æŒ‡å®šèŒƒå›´ å¦‚æžœéœ€è¦åŒ¹é…ä¸€ä¸ªå­—ç¬¦çš„é€†æ“ä½œï¼Œå³å­—ç¬¦ä¸èƒ½åœ¨æŒ‡å®šèŒƒå›´ï¼Œå¯ä»¥ä½¿ç”¨[^]ã€‚ // æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ï¼š[^]Assert.assertFalse(checkMatches("[^abc]", "b")); // å­—ç¬¦ä¸èƒ½æ˜¯aã€bã€cAssert.assertFalse(checkMatches("[^a-z]", "m")); // å­—ç¬¦ä¸èƒ½æ˜¯a - zAssert.assertFalse(checkMatches("[^A-Z]", "O")); // å­—ç¬¦ä¸èƒ½æ˜¯A - ZAssert.assertFalse(checkMatches("[^a-zA-Z]", "K")); // å­—ç¬¦ä¸èƒ½æ˜¯a - zå’ŒA - ZAssert.assertFalse(checkMatches("[^a-zA-Z]", "k"));Assert.assertFalse(checkMatches("[^0-9]", "5")); // å­—ç¬¦ä¸èƒ½æ˜¯0 - 9 è¾“å‡º b not matchesï¼š [^abc]m not matchesï¼š [^a-z]O not matchesï¼š [^A-Z]K not matchesï¼š [^a-zA-Z]k not matchesï¼š [^a-zA-Z]5 not matchesï¼š [^0-9] é™åˆ¶å­—ç¬¦æ•°é‡ - {} å¦‚æžœæƒ³è¦æŽ§åˆ¶å­—ç¬¦å‡ºçŽ°çš„æ¬¡æ•°ï¼Œå¯ä»¥ä½¿ç”¨{}ã€‚ å­—ç¬¦ æè¿° {n} n æ˜¯ä¸€ä¸ªéžè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„ n æ¬¡ã€‚ {n,} n æ˜¯ä¸€ä¸ªéžè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é… n æ¬¡ã€‚ {n,m} m å’Œ n å‡ä¸ºéžè´Ÿæ•´æ•°ï¼Œå…¶ä¸­ n &lt;= mã€‚æœ€å°‘åŒ¹é… n æ¬¡ä¸”æœ€å¤šåŒ¹é… m æ¬¡ã€‚ ä¾‹ é™åˆ¶å­—ç¬¦å‡ºçŽ°æ¬¡æ•° // &#123;n&#125;: n æ˜¯ä¸€ä¸ªéžè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„ n æ¬¡ã€‚checkMatches("ap&#123;1&#125;", "a");checkMatches("ap&#123;1&#125;", "ap");checkMatches("ap&#123;1&#125;", "app");checkMatches("ap&#123;1&#125;", "apppppppppp");// &#123;n,&#125;: n æ˜¯ä¸€ä¸ªéžè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é… n æ¬¡ã€‚checkMatches("ap&#123;1,&#125;", "a");checkMatches("ap&#123;1,&#125;", "ap");checkMatches("ap&#123;1,&#125;", "app");checkMatches("ap&#123;1,&#125;", "apppppppppp");// &#123;n,m&#125;: m å’Œ n å‡ä¸ºéžè´Ÿæ•´æ•°ï¼Œå…¶ä¸­ n &lt;= mã€‚æœ€å°‘åŒ¹é… n æ¬¡ä¸”æœ€å¤šåŒ¹é… m æ¬¡ã€‚checkMatches("ap&#123;2,5&#125;", "a");checkMatches("ap&#123;2,5&#125;", "ap");checkMatches("ap&#123;2,5&#125;", "app");checkMatches("ap&#123;2,5&#125;", "apppppppppp"); è¾“å‡º a not matchesï¼š ap&#123;1&#125;ap matchesï¼š ap&#123;1&#125;app not matchesï¼š ap&#123;1&#125;apppppppppp not matchesï¼š ap&#123;1&#125;a not matchesï¼š ap&#123;1,&#125;ap matchesï¼š ap&#123;1,&#125;app matchesï¼š ap&#123;1,&#125;apppppppppp matchesï¼š ap&#123;1,&#125;a not matchesï¼š ap&#123;2,5&#125;ap not matchesï¼š ap&#123;2,5&#125;app matchesï¼š ap&#123;2,5&#125;apppppppppp not matchesï¼š ap&#123;2,5&#125; è½¬ä¹‰å­—ç¬¦ - / å¦‚æžœæƒ³è¦æŸ¥æ‰¾å…ƒå­—ç¬¦æœ¬èº«ï¼Œä½ éœ€è¦ä½¿ç”¨è½¬ä¹‰ç¬¦ï¼Œä½¿å¾—æ­£åˆ™å¼•æ“Žå°†å…¶è§†ä½œä¸€ä¸ªæ™®é€šå­—ç¬¦ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…ƒå­—ç¬¦åŽ»å¤„ç†ã€‚ * çš„è½¬ä¹‰å­—ç¬¦ï¼š\*+ çš„è½¬ä¹‰å­—ç¬¦ï¼š\+? çš„è½¬ä¹‰å­—ç¬¦ï¼š\?^ çš„è½¬ä¹‰å­—ç¬¦ï¼š\^$ çš„è½¬ä¹‰å­—ç¬¦ï¼š\$. çš„è½¬ä¹‰å­—ç¬¦ï¼š\. å¦‚æžœæ˜¯è½¬ä¹‰ç¬¦\æœ¬èº«ï¼Œä½ ä¹Ÿéœ€è¦ä½¿ç”¨\\ ã€‚ æŒ‡å®šè¡¨è¾¾å¼å­—ç¬¦ä¸²çš„å¼€å§‹å’Œç»“å°¾ - ^ã€$ å¦‚æžœå¸Œæœ›åŒ¹é…çš„å­—ç¬¦ä¸²å¿…é¡»ä»¥ç‰¹å®šå­—ç¬¦ä¸²å¼€å¤´ï¼Œå¯ä»¥ä½¿ç”¨^ ã€‚ æ³¨ï¼šè¯·ç‰¹åˆ«ç•™æ„ï¼Œè¿™é‡Œçš„^ ä¸€å®šè¦å’Œ [^] ä¸­çš„ â€œ^â€ åŒºåˆ†ã€‚ ä¾‹ é™åˆ¶å­—ç¬¦ä¸²å¤´éƒ¨ Assert.assertTrue(checkMatches("^app[a-z]&#123;0,&#125;", "apple")); // å­—ç¬¦ä¸²å¿…é¡»ä»¥appå¼€å¤´Assert.assertFalse(checkMatches("^app[a-z]&#123;0,&#125;", "aplause")); è¾“å‡º apple matchesï¼š ^app[a-z]&#123;0,&#125;aplause not matchesï¼š ^app[a-z]&#123;0,&#125; å¦‚æžœå¸Œæœ›åŒ¹é…çš„å­—ç¬¦ä¸²å¿…é¡»ä»¥ç‰¹å®šå­—ç¬¦ä¸²å¼€å¤´ï¼Œå¯ä»¥ä½¿ç”¨$ ã€‚ ä¾‹ é™åˆ¶å­—ç¬¦ä¸²å°¾éƒ¨ Assert.assertTrue(checkMatches("[a-z]&#123;0,&#125;ing$", "playing")); // å­—ç¬¦ä¸²å¿…é¡»ä»¥ingç»“å°¾Assert.assertFalse(checkMatches("[a-z]&#123;0,&#125;ing$", "long")); è¾“å‡º playing matchesï¼š [a-z]&#123;0,&#125;ing$long not matchesï¼š [a-z]&#123;0,&#125;ing$ ç­‰ä»·å­—ç¬¦ ç­‰ä»·å­—ç¬¦ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¯¹äºŽåŸºæœ¬å…ƒå­—ç¬¦è¡¨è¾¾çš„ä¸€ç§ç®€åŒ–ï¼ˆç­‰ä»·å­—ç¬¦çš„åŠŸèƒ½éƒ½å¯ä»¥é€šè¿‡åŸºæœ¬å…ƒå­—ç¬¦æ¥å®žçŽ°ï¼‰ã€‚ åœ¨æ²¡æœ‰æŽŒæ¡åŸºæœ¬å…ƒå­—ç¬¦ä¹‹å‰ï¼Œå¯ä»¥å…ˆä¸ç”¨ç†ä¼šï¼Œå› ä¸ºå¾ˆå®¹æ˜“æŠŠäººç»•æ™•ã€‚ ç­‰ä»·å­—ç¬¦çš„å¥½å¤„åœ¨äºŽç®€åŒ–äº†åŸºæœ¬å…ƒå­—ç¬¦çš„å†™æ³•ã€‚ è¡¨ç¤ºæŸä¸€ç±»åž‹å­—ç¬¦çš„ç­‰ä»·å­—ç¬¦ ä¸‹è¡¨ä¸­çš„ç­‰ä»·å­—ç¬¦éƒ½è¡¨ç¤ºæŸä¸€ç±»åž‹çš„å­—ç¬¦ã€‚ å­—ç¬¦ æè¿° . åŒ¹é…é™¤â€œ\nâ€ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚ \d åŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äºŽ[0-9]ã€‚ \D åŒ¹é…ä¸€ä¸ªéžæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äºŽ[^0-9]ã€‚ \w åŒ¹é…åŒ…æ‹¬ä¸‹åˆ’çº¿çš„ä»»ä½•å•è¯å­—ç¬¦ã€‚ç±»ä¼¼ä½†ä¸ç­‰ä»·äºŽâ€œ[A-Za-z0-9_]â€ï¼Œè¿™é‡Œçš„å•è¯å­—ç¬¦æŒ‡çš„æ˜¯ Unicode å­—ç¬¦é›†ã€‚ \W åŒ¹é…ä»»ä½•éžå•è¯å­—ç¬¦ã€‚ \s åŒ¹é…ä»»ä½•ä¸å¯è§å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äºŽ[ \f\n\r\t\v]ã€‚ \S åŒ¹é…ä»»ä½•å¯è§å­—ç¬¦ã€‚ç­‰ä»·äºŽ[ \f\n\r\t\v]ã€‚ æ¡ˆä¾‹ åŸºæœ¬ç­‰ä»·å­—ç¬¦çš„ç”¨æ³• // åŒ¹é…é™¤â€œ\nâ€ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦Assert.assertTrue(checkMatches(".&#123;1,&#125;", "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"));Assert.assertTrue(checkMatches(".&#123;1,&#125;", "~!@#$%^&amp;*()+`-=[]&#123;&#125;;:&lt;&gt;,./?|\\"));Assert.assertFalse(checkMatches(".", "\n"));Assert.assertFalse(checkMatches("[^\n]", "\n"));// åŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äºŽ[0-9]Assert.assertTrue(checkMatches("\\d&#123;1,&#125;", "0123456789"));// åŒ¹é…ä¸€ä¸ªéžæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äºŽ[^0-9]Assert.assertFalse(checkMatches("\\D&#123;1,&#125;", "0123456789"));// åŒ¹é…åŒ…æ‹¬ä¸‹åˆ’çº¿çš„ä»»ä½•å•è¯å­—ç¬¦ã€‚ç±»ä¼¼ä½†ä¸ç­‰ä»·äºŽâ€œ[A-Za-z0-9_]â€ï¼Œè¿™é‡Œçš„å•è¯å­—ç¬¦æŒ‡çš„æ˜¯Unicodeå­—ç¬¦é›†Assert.assertTrue(checkMatches("\\w&#123;1,&#125;", "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"));Assert.assertFalse(checkMatches("\\w&#123;1,&#125;", "~!@#$%^&amp;*()+`-=[]&#123;&#125;;:&lt;&gt;,./?|\\"));// åŒ¹é…ä»»ä½•éžå•è¯å­—ç¬¦Assert.assertFalse(checkMatches("\\W&#123;1,&#125;", "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"));Assert.assertTrue(checkMatches("\\W&#123;1,&#125;", "~!@#$%^&amp;*()+`-=[]&#123;&#125;;:&lt;&gt;,./?|\\"));// åŒ¹é…ä»»ä½•ä¸å¯è§å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äºŽ[ \f\n\r\t\v]Assert.assertTrue(checkMatches("\\s&#123;1,&#125;", " \f\r\n\t"));// åŒ¹é…ä»»ä½•å¯è§å­—ç¬¦ã€‚ç­‰ä»·äºŽ[^ \f\n\r\t\v]Assert.assertFalse(checkMatches("\\S&#123;1,&#125;", " \f\r\n\t")); è¾“å‡º ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_ matchesï¼š .&#123;1,&#125;~!@#$%^&amp;*()+`-=[]&#123;&#125;;:&lt;&gt;,./?|\\ matchesï¼š .&#123;1,&#125;\n not matchesï¼š .\n not matchesï¼š [^\n]0123456789 matchesï¼š \\d&#123;1,&#125;0123456789 not matchesï¼š \\D&#123;1,&#125;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_ matchesï¼š \\w&#123;1,&#125;~!@#$%^&amp;*()+`-=[]&#123;&#125;;:&lt;&gt;,./?|\\ not matchesï¼š \\w&#123;1,&#125;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_ not matchesï¼š \\W&#123;1,&#125;~!@#$%^&amp;*()+`-=[]&#123;&#125;;:&lt;&gt;,./?|\\ matchesï¼š \\W&#123;1,&#125; \f\r\n\t matchesï¼š \\s&#123;1,&#125; \f\r\n\t not matchesï¼š \\S&#123;1,&#125; é™åˆ¶å­—ç¬¦æ•°é‡çš„ç­‰ä»·å­—ç¬¦ åœ¨åŸºæœ¬å…ƒå­—ç¬¦ç« èŠ‚ä¸­ï¼Œå·²ç»ä»‹ç»äº†é™åˆ¶å­—ç¬¦æ•°é‡çš„åŸºæœ¬å…ƒå­—ç¬¦ - {} ã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ *ã€+ã€? è¿™ä¸ªä¸‰ä¸ªä¸ºäº†ç®€åŒ–å†™æ³•è€Œå‡ºçŽ°çš„ç­‰ä»·å­—ç¬¦ï¼Œæˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹ã€‚ å­—ç¬¦ æè¿° * åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ç­‰ä»·äºŽ{0,}ã€‚ + åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ç­‰ä»·äºŽ{1,}ã€‚ ? åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚ç­‰ä»·äºŽ {0,1}ã€‚ æ¡ˆä¾‹ é™åˆ¶å­—ç¬¦æ•°é‡çš„ç­‰ä»·å­—ç¬¦ // *: åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚* ç­‰ä»·äºŽ&#123;0,&#125;ã€‚checkMatches("ap*", "a");checkMatches("ap*", "ap");checkMatches("ap*", "app");checkMatches("ap*", "apppppppppp");// +: åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚+ ç­‰ä»·äºŽ &#123;1,&#125;ã€‚checkMatches("ap+", "a");checkMatches("ap+", "ap");checkMatches("ap+", "app");checkMatches("ap+", "apppppppppp");// ?: åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚? ç­‰ä»·äºŽ &#123;0,1&#125;ã€‚checkMatches("ap?", "a");checkMatches("ap?", "ap");checkMatches("ap?", "app");checkMatches("ap?", "apppppppppp"); è¾“å‡º a matchesï¼š ap*ap matchesï¼š ap*app matchesï¼š ap*apppppppppp matchesï¼š ap*a not matchesï¼š ap+ap matchesï¼š ap+app matchesï¼š ap+apppppppppp matchesï¼š ap+a matchesï¼š ap?ap matchesï¼š ap?app not matchesï¼š ap?apppppppppp not matchesï¼š ap? å…ƒå­—ç¬¦ä¼˜å…ˆçº§é¡ºåº æ­£åˆ™è¡¨è¾¾å¼ä»Žå·¦åˆ°å³è¿›è¡Œè®¡ç®—ï¼Œå¹¶éµå¾ªä¼˜å…ˆçº§é¡ºåºï¼Œè¿™ä¸Žç®—æœ¯è¡¨è¾¾å¼éžå¸¸ç±»ä¼¼ã€‚ ä¸‹è¡¨ä»Žæœ€é«˜åˆ°æœ€ä½Žè¯´æ˜Žäº†å„ç§æ­£åˆ™è¡¨è¾¾å¼è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é¡ºåºï¼š è¿ç®—ç¬¦ è¯´æ˜Ž \ è½¬ä¹‰ç¬¦ (), (?ðŸ˜ƒ, (?=), [] æ‹¬å·å’Œä¸­æ‹¬å· *, +, ?, {n}, {n,}, {n,m} é™å®šç¬¦ ^, $, *ä»»ä½•å…ƒå­—ç¬¦ã€ä»»ä½•å­—ç¬¦* å®šä½ç‚¹å’Œåºåˆ— | æ›¿æ¢ å­—ç¬¦å…·æœ‰é«˜äºŽæ›¿æ¢è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ï¼Œä½¿å¾—â€œm|foodâ€åŒ¹é…â€œmâ€æˆ–â€œfoodâ€ã€‚è‹¥è¦åŒ¹é…â€œmoodâ€æˆ–â€œfoodâ€ï¼Œè¯·ä½¿ç”¨æ‹¬å·åˆ›å»ºå­è¡¨è¾¾å¼ï¼Œä»Žè€Œäº§ç”Ÿâ€œ(m|f)oodâ€ã€‚ åˆ†ç»„æž„é€  åœ¨åŸºæœ¬å…ƒå­—ç¬¦ç« èŠ‚ï¼Œæåˆ°äº† () å­—ç¬¦å¯ä»¥ç”¨æ¥å¯¹è¡¨è¾¾å¼åˆ†ç»„ã€‚å®žé™…ä¸Šåˆ†ç»„è¿˜æœ‰æ›´å¤šå¤æ‚çš„ç”¨æ³•ã€‚ æ‰€è°“åˆ†ç»„æž„é€ ï¼Œæ˜¯ç”¨æ¥æè¿°æ­£åˆ™è¡¨è¾¾å¼çš„å­è¡¨è¾¾å¼ï¼Œç”¨äºŽæ•èŽ·å­—ç¬¦ä¸²ä¸­çš„å­å­—ç¬¦ä¸²ã€‚ æ•èŽ·ä¸Žéžæ•èŽ· ä¸‹è¡¨ä¸ºåˆ†ç»„æž„é€ ä¸­çš„æ•èŽ·å’Œéžæ•èŽ·åˆ†ç±»ã€‚ è¡¨è¾¾å¼ æè¿° æ•èŽ·æˆ–éžæ•èŽ· (exp) åŒ¹é…çš„å­è¡¨è¾¾å¼ æ•èŽ· (?&lt;name&gt;exp) å‘½åçš„åå‘å¼•ç”¨ æ•èŽ· (?:exp) éžæ•èŽ·ç»„ éžæ•èŽ· (?=exp) é›¶å®½åº¦æ­£é¢„æµ‹å…ˆè¡Œæ–­è¨€ éžæ•èŽ· (?!exp) é›¶å®½åº¦è´Ÿé¢„æµ‹å…ˆè¡Œæ–­è¨€ éžæ•èŽ· (?&lt;=exp) é›¶å®½åº¦æ­£å›žé¡¾åŽå‘æ–­è¨€ éžæ•èŽ· (?&lt;!exp) é›¶å®½åº¦è´Ÿå›žé¡¾åŽå‘æ–­è¨€ éžæ•èŽ· æ³¨ï¼šJava æ­£åˆ™å¼•æ“Žä¸æ”¯æŒå¹³è¡¡ç»„ã€‚ åå‘å¼•ç”¨ å¸¦ç¼–å·çš„åå‘å¼•ç”¨ å¸¦ç¼–å·çš„åå‘å¼•ç”¨ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š\number å…¶ä¸­number æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­æ•èŽ·ç»„çš„åºå·ä½ç½®ã€‚ ä¾‹å¦‚ï¼Œ\4 åŒ¹é…ç¬¬å››ä¸ªæ•èŽ·ç»„çš„å†…å®¹ã€‚ å¦‚æžœæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­æœªå®šä¹‰numberï¼Œåˆ™å°†å‘ç”Ÿåˆ†æžé”™è¯¯ ä¾‹ åŒ¹é…é‡å¤çš„å•è¯å’Œç´§éšæ¯ä¸ªé‡å¤çš„å•è¯çš„å•è¯(ä¸å‘½åå­è¡¨è¾¾å¼) // (\w+)\s\1\W(\w+) åŒ¹é…é‡å¤çš„å•è¯å’Œç´§éšæ¯ä¸ªé‡å¤çš„å•è¯çš„å•è¯Assert.assertTrue(findAll("(\\w+)\\s\\1\\W(\\w+)", "He said that that was the the correct answer.") &gt; 0); è¾“å‡º regex = (\w+)\s\1\W(\w+), content: He said that that was the the correct answer.[1th] start: 8, end: 21, group: that that was[2th] start: 22, end: 37, group: the the correct è¯´æ˜Ž (\w+): åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯å­—ç¬¦ã€‚ \s: ä¸Žç©ºç™½å­—ç¬¦åŒ¹é…ã€‚ \1: åŒ¹é…ç¬¬ä¸€ä¸ªç»„ï¼Œå³(\w+)ã€‚ \W: åŒ¹é…åŒ…æ‹¬ç©ºæ ¼å’Œæ ‡ç‚¹ç¬¦å·çš„ä¸€ä¸ªéžå•è¯å­—ç¬¦ã€‚ è¿™æ ·å¯ä»¥é˜²æ­¢æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…ä»Žç¬¬ä¸€ä¸ªæ•èŽ·ç»„çš„å•è¯å¼€å¤´çš„å•è¯ã€‚ å‘½åçš„åå‘å¼•ç”¨ å‘½ååŽå‘å¼•ç”¨é€šè¿‡ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•è¿›è¡Œå®šä¹‰ï¼š\k&lt;name &gt; ä¾‹ åŒ¹é…é‡å¤çš„å•è¯å’Œç´§éšæ¯ä¸ªé‡å¤çš„å•è¯çš„å•è¯(å‘½åå­è¡¨è¾¾å¼) // (?&lt;duplicateWord&gt;\w+)\s\k&lt;duplicateWord&gt;\W(?&lt;nextWord&gt;\w+) åŒ¹é…é‡å¤çš„å•è¯å’Œç´§éšæ¯ä¸ªé‡å¤çš„å•è¯çš„å•è¯Assert.assertTrue(findAll("(?&lt;duplicateWord&gt;\\w+)\\s\\k&lt;duplicateWord&gt;\\W(?&lt;nextWord&gt;\\w+)", "He said that that was the the correct answer.") &gt; 0); è¾“å‡º regex = (?&lt;duplicateWord&gt;\w+)\s\k&lt;duplicateWord&gt;\W(?&lt;nextWord&gt;\w+), content: He said that that was the the correct answer.[1th] start: 8, end: 21, group: that that was[2th] start: 22, end: 37, group: the the correct è¯´æ˜Ž (?\w+): åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯å­—ç¬¦ã€‚ å‘½åæ­¤æ•èŽ·ç»„ duplicateWordã€‚ \s: ä¸Žç©ºç™½å­—ç¬¦åŒ¹é…ã€‚ \k: åŒ¹é…åä¸º duplicateWord çš„æ•èŽ·çš„ç»„ã€‚ \W: åŒ¹é…åŒ…æ‹¬ç©ºæ ¼å’Œæ ‡ç‚¹ç¬¦å·çš„ä¸€ä¸ªéžå•è¯å­—ç¬¦ã€‚ è¿™æ ·å¯ä»¥é˜²æ­¢æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…ä»Žç¬¬ä¸€ä¸ªæ•èŽ·ç»„çš„å•è¯å¼€å¤´çš„å•è¯ã€‚ (?\w+): åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯å­—ç¬¦ã€‚ å‘½åæ­¤æ•èŽ·ç»„ nextWordã€‚ éžæ•èŽ·ç»„ (?:exp) è¡¨ç¤ºå½“ä¸€ä¸ªé™å®šç¬¦åº”ç”¨åˆ°ä¸€ä¸ªç»„ï¼Œä½†ç»„æ•èŽ·çš„å­å­—ç¬¦ä¸²å¹¶éžæ‰€éœ€æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨éžæ•èŽ·ç»„æž„é€ ã€‚ ä¾‹ åŒ¹é…ä»¥.ç»“æŸçš„è¯­å¥ã€‚ // åŒ¹é…ç”±å¥å·ç»ˆæ­¢çš„è¯­å¥ã€‚Assert.assertTrue(findAll("(?:\\b(?:\\w+)\\W*)+\\.", "This is a short sentence. Never end") &gt; 0); è¾“å‡º regex = (?:\b(?:\w+)\W*)+\., content: This is a short sentence. Never end[1th] start: 0, end: 25, group: This is a short sentence. é›¶å®½æ–­è¨€ ç”¨äºŽæŸ¥æ‰¾åœ¨æŸäº›å†…å®¹(ä½†å¹¶ä¸åŒ…æ‹¬è¿™äº›å†…å®¹)ä¹‹å‰æˆ–ä¹‹åŽçš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬åƒ\b,^,$é‚£æ ·ç”¨äºŽæŒ‡å®šä¸€ä¸ªä½ç½®ï¼Œè¿™ä¸ªä½ç½®åº”è¯¥æ»¡è¶³ä¸€å®šçš„æ¡ä»¶(å³æ–­è¨€)ï¼Œå› æ­¤å®ƒä»¬ä¹Ÿè¢«ç§°ä¸ºé›¶å®½æ–­è¨€ã€‚ è¡¨è¾¾å¼ æè¿° (?=exp) åŒ¹é… exp å‰é¢çš„ä½ç½® (?&lt;=exp) åŒ¹é… exp åŽé¢çš„ä½ç½® (?!exp) åŒ¹é…åŽé¢è·Ÿçš„ä¸æ˜¯ exp çš„ä½ç½® (?&lt;!exp) åŒ¹é…å‰é¢ä¸æ˜¯ exp çš„ä½ç½® åŒ¹é… exp å‰é¢çš„ä½ç½® (?=exp) è¡¨ç¤ºè¾“å…¥å­—ç¬¦ä¸²å¿…é¡»åŒ¹é…å­è¡¨è¾¾å¼ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼Œå°½ç®¡åŒ¹é…çš„å­å­—ç¬¦ä¸²æœªåŒ…å«åœ¨åŒ¹é…ç»“æžœä¸­ã€‚ // \b\w+(?=\sis\b) è¡¨ç¤ºè¦æ•èŽ·isä¹‹å‰çš„å•è¯Assert.assertTrue(findAll("\\b\\w+(?=\\sis\\b)", "The dog is a Malamute.") &gt; 0);Assert.assertFalse(findAll("\\b\\w+(?=\\sis\\b)", "The island has beautiful birds.") &gt; 0);Assert.assertFalse(findAll("\\b\\w+(?=\\sis\\b)", "The pitch missed home plate.") &gt; 0);Assert.assertTrue(findAll("\\b\\w+(?=\\sis\\b)", "Sunday is a weekend day.") &gt; 0); è¾“å‡º regex = \b\w+(?=\sis\b), content: The dog is a Malamute.[1th] start: 4, end: 7, group: dogregex = \b\w+(?=\sis\b), content: The island has beautiful birds.not foundregex = \b\w+(?=\sis\b), content: The pitch missed home plate.not foundregex = \b\w+(?=\sis\b), content: Sunday is a weekend day.[1th] start: 0, end: 6, group: Sunday è¯´æ˜Ž \b: åœ¨å•è¯è¾¹ç•Œå¤„å¼€å§‹åŒ¹é…ã€‚ \w+: åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯å­—ç¬¦ã€‚ (?=\sis\b): ç¡®å®šå•è¯å­—ç¬¦æ˜¯å¦åŽæŽ¥ç©ºç™½å­—ç¬¦å’Œå­—ç¬¦ä¸²â€œisâ€ï¼Œå…¶åœ¨å•è¯è¾¹ç•Œå¤„ç»“æŸã€‚ å¦‚æžœå¦‚æ­¤ï¼Œåˆ™åŒ¹é…æˆåŠŸã€‚ åŒ¹é… exp åŽé¢çš„ä½ç½® (?&lt;=exp) è¡¨ç¤ºå­è¡¨è¾¾å¼ä¸å¾—åœ¨è¾“å…¥å­—ç¬¦ä¸²å½“å‰ä½ç½®å·¦ä¾§å‡ºçŽ°ï¼Œå°½ç®¡å­è¡¨è¾¾å¼æœªåŒ…å«åœ¨åŒ¹é…ç»“æžœä¸­ã€‚é›¶å®½åº¦æ­£å›žé¡¾åŽå‘æ–­è¨€ä¸ä¼šå›žæº¯ã€‚ // (?&lt;=\b20)\d&#123;2&#125;\b è¡¨ç¤ºè¦æ•èŽ·ä»¥20å¼€å¤´çš„æ•°å­—çš„åŽé¢éƒ¨åˆ†Assert.assertTrue(findAll("(?&lt;=\\b20)\\d&#123;2&#125;\\b", "2010 1999 1861 2140 2009") &gt; 0); è¾“å‡º regex = (?&lt;=\b20)\d&#123;2&#125;\b, content: 2010 1999 1861 2140 2009[1th] start: 2, end: 4, group: 10[2th] start: 22, end: 24, group: 09 è¯´æ˜Ž \d{2}: åŒ¹é…ä¸¤ä¸ªåè¿›åˆ¶æ•°å­—ã€‚ {?&lt;=\b20): å¦‚æžœä¸¤ä¸ªåè¿›åˆ¶æ•°å­—çš„å­—è¾¹ç•Œä»¥å°æ•°ä½æ•°â€œ20â€å¼€å¤´ï¼Œåˆ™ç»§ç»­åŒ¹é…ã€‚ \b: åœ¨å•è¯è¾¹ç•Œå¤„ç»“æŸåŒ¹é…ã€‚ åŒ¹é…åŽé¢è·Ÿçš„ä¸æ˜¯ exp çš„ä½ç½® (?!exp) è¡¨ç¤ºè¾“å…¥å­—ç¬¦ä¸²ä¸å¾—åŒ¹é…å­è¡¨è¾¾å¼ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼Œå°½ç®¡åŒ¹é…çš„å­å­—ç¬¦ä¸²æœªåŒ…å«åœ¨åŒ¹é…ç»“æžœä¸­ã€‚ ä¾‹ æ•èŽ·æœªä»¥â€œunâ€å¼€å¤´çš„å•è¯ // \b(?!un)\w+\b è¡¨ç¤ºè¦æ•èŽ·æœªä»¥â€œunâ€å¼€å¤´çš„å•è¯Assert.assertTrue(findAll("\\b(?!un)\\w+\\b", "unite one unethical ethics use untie ultimate") &gt; 0); è¾“å‡º regex = \b(?!un)\w+\b, content: unite one unethical ethics use untie ultimate[1th] start: 6, end: 9, group: one[2th] start: 20, end: 26, group: ethics[3th] start: 27, end: 30, group: use[4th] start: 37, end: 45, group: ultimate è¯´æ˜Ž \b: åœ¨å•è¯è¾¹ç•Œå¤„å¼€å§‹åŒ¹é…ã€‚ (?!un): ç¡®å®šæŽ¥ä¸‹æ¥çš„ä¸¤ä¸ªçš„å­—ç¬¦æ˜¯å¦ä¸ºâ€œunâ€ã€‚ å¦‚æžœæ²¡æœ‰ï¼Œåˆ™å¯èƒ½åŒ¹é…ã€‚ \w+: åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯å­—ç¬¦ã€‚ \b: åœ¨å•è¯è¾¹ç•Œå¤„ç»“æŸåŒ¹é…ã€‚ åŒ¹é…å‰é¢ä¸æ˜¯ exp çš„ä½ç½® (?&lt;!exp) è¡¨ç¤ºå­è¡¨è¾¾å¼ä¸å¾—åœ¨è¾“å…¥å­—ç¬¦ä¸²å½“å‰ä½ç½®çš„å·¦ä¾§å‡ºçŽ°ã€‚ ä½†æ˜¯ï¼Œä»»ä½•ä¸åŒ¹é…å­è¡¨è¾¾å¼ çš„å­å­—ç¬¦ä¸²ä¸åŒ…å«åœ¨åŒ¹é…ç»“æžœä¸­ã€‚ ä¾‹ æ•èŽ·ä»»æ„å·¥ä½œæ—¥ // (?&lt;!(Saturday|Sunday) )\b\w+ \d&#123;1,2&#125;, \d&#123;4&#125;\b è¡¨ç¤ºè¦æ•èŽ·ä»»æ„å·¥ä½œæ—¥ï¼ˆå³å‘¨ä¸€åˆ°å‘¨äº”ï¼‰Assert.assertTrue(findAll("(?&lt;!(Saturday|Sunday) )\\b\\w+ \\d&#123;1,2&#125;, \\d&#123;4&#125;\\b", "Monday February 1, 2010") &gt; 0);Assert.assertTrue(findAll("(?&lt;!(Saturday|Sunday) )\\b\\w+ \\d&#123;1,2&#125;, \\d&#123;4&#125;\\b", "Wednesday February 3, 2010") &gt; 0);Assert.assertFalse(findAll("(?&lt;!(Saturday|Sunday) )\\b\\w+ \\d&#123;1,2&#125;, \\d&#123;4&#125;\\b", "Saturday February 6, 2010") &gt; 0);Assert.assertFalse(findAll("(?&lt;!(Saturday|Sunday) )\\b\\w+ \\d&#123;1,2&#125;, \\d&#123;4&#125;\\b", "Sunday February 7, 2010") &gt; 0);Assert.assertTrue(findAll("(?&lt;!(Saturday|Sunday) )\\b\\w+ \\d&#123;1,2&#125;, \\d&#123;4&#125;\\b", "Monday, February 8, 2010") &gt; 0); è¾“å‡º regex = (?&lt;!(Saturday|Sunday) )\b\w+ \d&#123;1,2&#125;, \d&#123;4&#125;\b, content: Monday February 1, 2010[1th] start: 7, end: 23, group: February 1, 2010regex = (?&lt;!(Saturday|Sunday) )\b\w+ \d&#123;1,2&#125;, \d&#123;4&#125;\b, content: Wednesday February 3, 2010[1th] start: 10, end: 26, group: February 3, 2010regex = (?&lt;!(Saturday|Sunday) )\b\w+ \d&#123;1,2&#125;, \d&#123;4&#125;\b, content: Saturday February 6, 2010not foundregex = (?&lt;!(Saturday|Sunday) )\b\w+ \d&#123;1,2&#125;, \d&#123;4&#125;\b, content: Sunday February 7, 2010not foundregex = (?&lt;!(Saturday|Sunday) )\b\w+ \d&#123;1,2&#125;, \d&#123;4&#125;\b, content: Monday, February 8, 2010[1th] start: 8, end: 24, group: February 8, 2010 è´ªå©ªä¸Žæ‡’æƒ° å½“æ­£åˆ™è¡¨è¾¾å¼ä¸­åŒ…å«èƒ½æŽ¥å—é‡å¤çš„é™å®šç¬¦æ—¶ï¼Œé€šå¸¸çš„è¡Œä¸ºæ˜¯ï¼ˆåœ¨ä½¿æ•´ä¸ªè¡¨è¾¾å¼èƒ½å¾—åˆ°åŒ¹é…çš„å‰æä¸‹ï¼‰åŒ¹é…å°½å¯èƒ½å¤šçš„å­—ç¬¦ã€‚ä»¥è¿™ä¸ªè¡¨è¾¾å¼ä¸ºä¾‹ï¼ša.*bï¼Œå®ƒå°†ä¼šåŒ¹é…æœ€é•¿çš„ä»¥ a å¼€å§‹ï¼Œä»¥ b ç»“æŸçš„å­—ç¬¦ä¸²ã€‚å¦‚æžœç”¨å®ƒæ¥æœç´¢ aabab çš„è¯ï¼Œå®ƒä¼šåŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸² aababã€‚è¿™è¢«ç§°ä¸ºè´ªå©ªåŒ¹é…ã€‚ æœ‰æ—¶ï¼Œæˆ‘ä»¬æ›´éœ€è¦æ‡’æƒ°åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯åŒ¹é…å°½å¯èƒ½å°‘çš„å­—ç¬¦ã€‚å‰é¢ç»™å‡ºçš„é™å®šç¬¦éƒ½å¯ä»¥è¢«è½¬åŒ–ä¸ºæ‡’æƒ°åŒ¹é…æ¨¡å¼ï¼Œåªè¦åœ¨å®ƒåŽé¢åŠ ä¸Šä¸€ä¸ªé—®å·?ã€‚è¿™æ ·.*?å°±æ„å‘³ç€åŒ¹é…ä»»æ„æ•°é‡çš„é‡å¤ï¼Œä½†æ˜¯åœ¨èƒ½ä½¿æ•´ä¸ªåŒ¹é…æˆåŠŸçš„å‰æä¸‹ä½¿ç”¨æœ€å°‘çš„é‡å¤ã€‚ è¡¨è¾¾å¼ æè¿° *? é‡å¤ä»»æ„æ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤ +? é‡å¤ 1 æ¬¡æˆ–æ›´å¤šæ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤ ?? é‡å¤ 0 æ¬¡æˆ– 1 æ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤ {n,m}? é‡å¤ n åˆ° m æ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤ {n,}? é‡å¤ n æ¬¡ä»¥ä¸Šï¼Œä½†å°½å¯èƒ½å°‘é‡å¤ ä¾‹ Java æ­£åˆ™ä¸­è´ªå©ªä¸Žæ‡’æƒ°çš„ç¤ºä¾‹ // è´ªå©ªåŒ¹é…Assert.assertTrue(findAll("a\\w*b", "abaabaaabaaaab") &gt; 0);// æ‡’æƒ°åŒ¹é…Assert.assertTrue(findAll("a\\w*?b", "abaabaaabaaaab") &gt; 0);Assert.assertTrue(findAll("a\\w+?b", "abaabaaabaaaab") &gt; 0);Assert.assertTrue(findAll("a\\w??b", "abaabaaabaaaab") &gt; 0);Assert.assertTrue(findAll("a\\w&#123;0,4&#125;?b", "abaabaaabaaaab") &gt; 0);Assert.assertTrue(findAll("a\\w&#123;3,&#125;?b", "abaabaaabaaaab") &gt; 0); è¾“å‡º regex = a\w*b, content: abaabaaabaaaab[1th] start: 0, end: 14, group: abaabaaabaaaabregex = a\w*?b, content: abaabaaabaaaab[1th] start: 0, end: 2, group: ab[2th] start: 2, end: 5, group: aab[3th] start: 5, end: 9, group: aaab[4th] start: 9, end: 14, group: aaaabregex = a\w+?b, content: abaabaaabaaaab[1th] start: 0, end: 5, group: abaab[2th] start: 5, end: 9, group: aaab[3th] start: 9, end: 14, group: aaaabregex = a\w??b, content: abaabaaabaaaab[1th] start: 0, end: 2, group: ab[2th] start: 2, end: 5, group: aab[3th] start: 6, end: 9, group: aab[4th] start: 11, end: 14, group: aabregex = a\w&#123;0,4&#125;?b, content: abaabaaabaaaab[1th] start: 0, end: 2, group: ab[2th] start: 2, end: 5, group: aab[3th] start: 5, end: 9, group: aaab[4th] start: 9, end: 14, group: aaaabregex = a\w&#123;3,&#125;?b, content: abaabaaabaaaab[1th] start: 0, end: 5, group: abaab[2th] start: 5, end: 14, group: aaabaaaab è¯´æ˜Ž æœ¬ä¾‹ä¸­ä»£ç å±•ç¤ºçš„æ˜¯ä½¿ç”¨ä¸åŒè´ªå©ªæˆ–æ‡’æƒ°ç­–ç•¥åŽ»æŸ¥æ‰¾å­—ç¬¦ä¸²&quot;abaabaaabaaaab&quot; ä¸­åŒ¹é…ä»¥&quot;a&quot;å¼€å¤´ï¼Œä»¥&quot;b&quot;ç»“å°¾çš„æ‰€æœ‰å­å­—ç¬¦ä¸²ã€‚ è¯·ä»Žè¾“å‡ºç»“æžœä¸­ï¼Œç»†ç»†ä½“å‘³ä½¿ç”¨ä¸åŒçš„è´ªå©ªæˆ–æ‡’æƒ°ç­–ç•¥ï¼Œå¯¹äºŽåŒ¹é…å­å­—ç¬¦ä¸²æœ‰ä»€ä¹ˆå½±å“ã€‚ æœ€å®žç”¨çš„æ­£åˆ™ æ ¡éªŒä¸­æ–‡ **æè¿°ï¼š**æ ¡éªŒå­—ç¬¦ä¸²ä¸­åªèƒ½æœ‰ä¸­æ–‡å­—ç¬¦ï¼ˆä¸åŒ…æ‹¬ä¸­æ–‡æ ‡ç‚¹ç¬¦å·ï¼‰ã€‚ä¸­æ–‡å­—ç¬¦çš„ Unicode ç¼–ç èŒƒå›´æ˜¯\u4e00 åˆ° \u9fa5ã€‚ å¦‚æœ‰å…´è¶£ï¼Œå¯ä»¥å‚è€ƒç™¾åº¦ç™¾ç§‘-Unicode ã€‚ ^[\u4e00-\u9fa5]+$ åŒ¹é…ï¼š æ˜¥çœ ä¸è§‰æ™“ **ä¸åŒ¹é…ï¼š**æ˜¥çœ ä¸è§‰æ™“ï¼Œ æ ¡éªŒèº«ä»½è¯å·ç  **æè¿°ï¼š**èº«ä»½è¯ä¸º 15 ä½æˆ– 18 ä½ã€‚15 ä½æ˜¯ç¬¬ä¸€ä»£èº«ä»½è¯ã€‚ä»Ž 1999 å¹´ 10 æœˆ 1 æ—¥èµ·ï¼Œå…¨å›½å®žè¡Œå…¬æ°‘èº«ä»½è¯å·ç åˆ¶åº¦ï¼Œå±…æ°‘èº«ä»½è¯ç¼–å·ç”±åŽŸ 15 ä½å‡è‡³ 18 ä½ã€‚ 15 ä½èº«ä»½è¯ **æè¿°ï¼š**ç”± 15 ä½æ•°å­—ç»„æˆã€‚æŽ’åˆ—é¡ºåºä»Žå·¦è‡³å³ä¾æ¬¡ä¸ºï¼šå…­ä½æ•°å­—åœ°åŒºç ï¼›å…­ä½æ•°å­—å‡ºç”Ÿæ—¥æœŸï¼›ä¸‰ä½é¡ºåºå·ï¼Œå…¶ä¸­ 15 ä½ç”·ä¸ºå•æ•°ï¼Œå¥³ä¸ºåŒæ•°ã€‚ 18 ä½èº«ä»½è¯ **æè¿°ï¼š**ç”±åä¸ƒä½æ•°å­—æœ¬ä½“ç å’Œä¸€ä½æ•°å­—æ ¡éªŒç ç»„æˆã€‚æŽ’åˆ—é¡ºåºä»Žå·¦è‡³å³ä¾æ¬¡ä¸ºï¼šå…­ä½æ•°å­—åœ°åŒºç ï¼›å…«ä½æ•°å­—å‡ºç”Ÿæ—¥æœŸï¼›ä¸‰ä½æ•°å­—é¡ºåºç å’Œä¸€ä½æ•°å­—æ ¡éªŒç ï¼ˆä¹Ÿå¯èƒ½æ˜¯ Xï¼‰ã€‚ èº«ä»½è¯å·å«ä¹‰è¯¦æƒ…è¯·è§ï¼šç™¾åº¦ç™¾ç§‘-å±…æ°‘èº«ä»½è¯å·ç  åœ°åŒºç ï¼ˆ6 ä½ï¼‰ (1[1-5]|2[1-3]|3[1-7]|4[1-3]|5[0-4]|6[1-5])\d&#123;4&#125; å‡ºç”Ÿæ—¥æœŸï¼ˆ8 ä½ï¼‰ æ³¨ï¼šä¸‹é¢çš„æ˜¯ 18 ä½èº«ä»½è¯çš„æœ‰æ•ˆå‡ºç”Ÿæ—¥æœŸï¼Œå¦‚æžœæ˜¯ 15 ä½èº«ä»½è¯ï¼Œåªè¦å°†ç¬¬ä¸€ä¸ª\d{4}æ”¹ä¸º\d{2}å³å¯ã€‚ ((\d&#123;4&#125;((0[13578]|1[02])(0[1-9]|[12]\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\d|30)|02(0[1-9]|1\d|2[0-8])))|([02468][048]|[13579][26])0229) 15 ä½æœ‰æ•ˆèº«ä»½è¯ ^((1[1-5]|2[1-3]|3[1-7]|4[1-3]|5[0-4]|6[1-5])\d&#123;4&#125;)((\d&#123;2&#125;((0[13578]|1[02])(0[1-9]|[12]\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\d|30)|02(0[1-9]|1\d|2[0-8])))|([02468][048]|[13579][26])0229)(\d&#123;3&#125;)$ **åŒ¹é…ï¼š**110001700101031 **ä¸åŒ¹é…ï¼š**110001701501031 18 ä½æœ‰æ•ˆèº«ä»½è¯ ^((1[1-5]|2[1-3]|3[1-7]|4[1-3]|5[0-4]|6[1-5])\d&#123;4&#125;)((\d&#123;4&#125;((0[13578]|1[02])(0[1-9]|[12]\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\d|30)|02(0[1-9]|1\d|2[0-8])))|([02468][048]|[13579][26])0229)(\d&#123;3&#125;(\d|X))$ **åŒ¹é…ï¼š**110001199001010310 | 11000019900101015X **ä¸åŒ¹é…ï¼š**990000199001010310 | 110001199013010310 æ ¡éªŒæœ‰æ•ˆç”¨æˆ·åã€å¯†ç  **æè¿°ï¼š**é•¿åº¦ä¸º 6-18 ä¸ªå­—ç¬¦ï¼Œå…è®¸è¾“å…¥å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼Œé¦–å­—ç¬¦å¿…é¡»ä¸ºå­—æ¯ã€‚ ^[a-zA-Z]\w&#123;5,17&#125;$ **åŒ¹é…ï¼š**he_llo@worl.d.com | hel.l-o@wor-ld.museum | h1ello@123.com **ä¸åŒ¹é…ï¼š**hello@worl_d.com | he&amp;llo@world.co1 | .hello@wor#.co.uk æ ¡éªŒé‚®ç®± **æè¿°ï¼š**ä¸å…è®¸ä½¿ç”¨ IP ä½œä¸ºåŸŸåï¼Œå¦‚ : hello@154.145.68.12 @ç¬¦å·å‰çš„é‚®ç®±ç”¨æˆ·å’Œ.ç¬¦å·å‰çš„åŸŸå(domain)å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š å­—ç¬¦åªèƒ½æ˜¯è‹±æ–‡å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿_ã€.ã€- ï¼› é¦–å­—ç¬¦å¿…é¡»ä¸ºå­—æ¯æˆ–æ•°å­—ï¼› _ã€.ã€- ä¸èƒ½è¿žç»­å‡ºçŽ°ã€‚ åŸŸåçš„æ ¹åŸŸåªèƒ½ä¸ºå­—æ¯ï¼Œä¸”è‡³å°‘ä¸ºä¸¤ä¸ªå­—ç¬¦ã€‚ ^[A-Za-z0-9](([_\.\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\.\-]?[a-zA-Z0-9]+)*)\.([A-Za-z]&#123;2,&#125;)$ **åŒ¹é…ï¼š**he_llo@worl.d.com | hel.l-o@wor-ld.museum | h1ello@123.com **ä¸åŒ¹é…ï¼š**hello@worl_d.com | he&amp;llo@world.co1 | .hello@wor#.co.uk æ ¡éªŒ URL **æè¿°ï¼š**æ ¡éªŒ URLã€‚æ”¯æŒ httpã€httpsã€ftpã€ftpsã€‚ ^(ht|f)(tp|tps)\://[a-zA-Z0-9\-\.]+\.([a-zA-Z]&#123;2,3&#125;)?(/\S*)?$ **åŒ¹é…ï¼š**http://google.com/help/me | http://www.google.com/help/me/ | https://www.google.com/help.asp | ftp://www.google.com | ftps://google.org **ä¸åŒ¹é…ï¼š**http://un/www.google.com/index.asp æ ¡éªŒæ—¶é—´ **æè¿°ï¼š**æ ¡éªŒæ—¶é—´ã€‚æ—¶ã€åˆ†ã€ç§’å¿…é¡»æ˜¯æœ‰æ•ˆæ•°å­—ï¼Œå¦‚æžœæ•°å€¼ä¸æ˜¯ä¸¤ä½æ•°ï¼Œåä½éœ€è¦è¡¥é›¶ã€‚ ^([0-1][0-9]|[2][0-3]):([0-5][0-9])$ **åŒ¹é…ï¼š**00:00:00 | 23:59:59 | 17:06:30 **ä¸åŒ¹é…ï¼š**17:6:30 | 24:16:30 æ ¡éªŒæ—¥æœŸ **æè¿°ï¼š**æ ¡éªŒæ—¥æœŸã€‚æ—¥æœŸæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š æ ¼å¼ yyyy-MM-dd æˆ– yyyy-M-d è¿žå­—ç¬¦å¯ä»¥æ²¡æœ‰æˆ–æ˜¯â€œ-â€ã€â€œ/â€ã€â€œ.â€ä¹‹ä¸€ é—°å¹´çš„äºŒæœˆå¯ä»¥æœ‰ 29 æ—¥ï¼›è€Œå¹³å¹´ä¸å¯ä»¥ã€‚ ä¸€ã€ä¸‰ã€äº”ã€ä¸ƒã€å…«ã€åã€åäºŒæœˆä¸º 31 æ—¥ã€‚å››ã€å…­ã€ä¹ã€åä¸€æœˆä¸º 30 æ—¥ã€‚ ^(?:(?!0000)[0-9]&#123;4&#125;([-/.]?)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]&#123;2&#125;(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))$ **åŒ¹é…ï¼š**2016/1/1 | 2016/01/01 | 20160101 | 2016-01-01 | 2016.01.01 | 2000-02-29 **ä¸åŒ¹é…ï¼š**2001-02-29 | 2016/12/32 | 2016/6/31 | 2016/13/1 | 2016/0/1 æ ¡éªŒä¸­å›½æ‰‹æœºå·ç  **æè¿°ï¼š**ä¸­å›½æ‰‹æœºå·ç æ­£ç¡®æ ¼å¼ï¼š11 ä½æ•°å­—ã€‚ ç§»åŠ¨æœ‰ 16 ä¸ªå·æ®µï¼š134ã€135ã€136ã€137ã€138ã€139ã€147ã€150ã€151ã€152ã€157ã€158ã€159ã€182ã€187ã€188ã€‚å…¶ä¸­ 147ã€157ã€188 æ˜¯ 3G å·æ®µï¼Œå…¶ä»–éƒ½æ˜¯ 2G å·æ®µã€‚è”é€šæœ‰ 7 ç§å·æ®µï¼š130ã€131ã€132ã€155ã€156ã€185ã€186ã€‚å…¶ä¸­ 186 æ˜¯ 3Gï¼ˆWCDMAï¼‰å·æ®µï¼Œå…¶ä½™ä¸º 2G å·æ®µã€‚ç”µä¿¡æœ‰ 4 ä¸ªå·æ®µï¼š133ã€153ã€180ã€189ã€‚å…¶ä¸­ 189 æ˜¯ 3G å·æ®µï¼ˆCDMA2000ï¼‰ï¼Œ133 å·æ®µä¸»è¦ç”¨ä½œæ— çº¿ç½‘å¡å·ã€‚æ€»ç»“ï¼š13 å¼€å¤´æ‰‹æœºå· 0-9ï¼›15 å¼€å¤´æ‰‹æœºå· 0-3ã€5-9ï¼›18 å¼€å¤´æ‰‹æœºå· 0ã€2ã€5-9ã€‚ æ­¤å¤–ï¼Œä¸­å›½åœ¨å›½é™…ä¸Šçš„åŒºå·ä¸º 86ï¼Œæ‰€ä»¥æ‰‹æœºå·å¼€å¤´æœ‰+86ã€86 ä¹Ÿæ˜¯åˆæ³•çš„ã€‚ ä»¥ä¸Šä¿¡æ¯æ¥æºäºŽ ç™¾åº¦ç™¾ç§‘-æ‰‹æœºå· ^((\+)?86\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\d&#123;8&#125;$ åŒ¹é…ï¼š+86 18012345678 | 86 18012345678 | 15812345678 **ä¸åŒ¹é…ï¼š**15412345678 | 12912345678 | 180123456789 æ ¡éªŒä¸­å›½å›ºè¯å·ç  **æè¿°ï¼š**å›ºè¯å·ç ï¼Œå¿…é¡»åŠ åŒºå·ï¼ˆä»¥ 0 å¼€å¤´ï¼‰ã€‚ 3 ä½æœ‰æ•ˆåŒºå·ï¼š010ã€020~029ï¼Œå›ºè¯ä½æ•°ä¸º 8 ä½ã€‚ 4 ä½æœ‰æ•ˆåŒºå·ï¼š03xx å¼€å¤´åˆ° 09xxï¼Œå›ºè¯ä½æ•°ä¸º 7ã€‚ å¦‚æžœæƒ³äº†è§£æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ ç™¾åº¦ç™¾ç§‘-ç”µè¯åŒºå· ã€‚ ^(010|02[0-9])(\s|-)\d&#123;8&#125;|(0[3-9]\d&#123;2&#125;)(\s|-)\d&#123;7&#125;$ **åŒ¹é…ï¼š**010-12345678 | 010 12345678 | 0512-1234567 | 0512 1234567 **ä¸åŒ¹é…ï¼š**1234567 | 12345678 æ ¡éªŒ IPv4 åœ°å€ **æè¿°ï¼š**IP åœ°å€æ˜¯ä¸€ä¸ª 32 ä½çš„äºŒè¿›åˆ¶æ•°ï¼Œé€šå¸¸è¢«åˆ†å‰²ä¸º 4 ä¸ªâ€œ8 ä½äºŒè¿›åˆ¶æ•°â€ï¼ˆä¹Ÿå°±æ˜¯ 4 ä¸ªå­—èŠ‚ï¼‰ã€‚IP åœ°å€é€šå¸¸ç”¨â€œç‚¹åˆ†åè¿›åˆ¶â€è¡¨ç¤ºæˆï¼ˆa.b.c.dï¼‰çš„å½¢å¼ï¼Œå…¶ä¸­ï¼Œa,b,c,d éƒ½æ˜¯ 0~255 ä¹‹é—´çš„åè¿›åˆ¶æ•´æ•°ã€‚ ^([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])$ **åŒ¹é…ï¼š**0.0.0.0 | 255.255.255.255 | 127.0.0.1 **ä¸åŒ¹é…ï¼š**10.10.10 | 10.10.10.256 æ ¡éªŒ IPv6 åœ°å€ **æè¿°ï¼š**IPv6 çš„ 128 ä½åœ°å€é€šå¸¸å†™æˆ 8 ç»„ï¼Œæ¯ç»„ä¸ºå››ä¸ªåå…­è¿›åˆ¶æ•°çš„å½¢å¼ã€‚ IPv6 åœ°å€å¯ä»¥è¡¨ç¤ºä¸ºä»¥ä¸‹å½¢å¼ï¼š IPv6 åœ°å€ é›¶åŽ‹ç¼© IPv6 åœ°å€(section 2.2 of rfc5952) å¸¦æœ‰æœ¬åœ°é“¾æŽ¥åŒºåŸŸç´¢å¼•çš„ IPv6 åœ°å€ (section 11 of rfc4007) åµŒå…¥ IPv4 çš„ IPv6 åœ°å€(section 2 of rfc6052 æ˜ å°„ IPv4 çš„ IPv6 åœ°å€ (section 2.1 of rfc2765) ç¿»è¯‘ IPv4 çš„ IPv6 åœ°å€ (section 2.1 of rfc2765) æ˜¾ç„¶ï¼ŒIPv6 åœ°å€çš„è¡¨ç¤ºæ–¹å¼å¾ˆå¤æ‚ã€‚ä½ ä¹Ÿå¯ä»¥å‚è€ƒ ç™¾åº¦ç™¾ç§‘-IPv6 Stack overflow ä¸Šçš„ IPv6 æ­£åˆ™è¡¨è¾¾é«˜ç¥¨ç­”æ¡ˆ (([0-9a-fA-F]&#123;1,4&#125;:)&#123;7,7&#125;[0-9a-fA-F]&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,7&#125;:|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,6&#125;:[0-9a-fA-F]&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,5&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,2&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,4&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,3&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,3&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,2&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,5&#125;|[0-9a-fA-F]&#123;1,4&#125;:((:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,6&#125;)|:((:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,7&#125;|:)|fe80:(:[0-9a-fA-F]&#123;0,4&#125;)&#123;0,4&#125;%[0-9a-zA-Z]&#123;1,&#125;|::(ffff(:0&#123;1,4&#125;)&#123;0,1&#125;:)&#123;0,1&#125;((25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])\.)&#123;3,3&#125;(25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,4&#125;:((25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])\.)&#123;3,3&#125;(25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])) **åŒ¹é…ï¼š**1:2:3:4:5:6:7:8 | 1:: | 1::8 | 1::6:7:8 | 1::5:6:7:8 | 1::4:5:6:7:8 | 1::3:4:5:6:7:8 | ::2:3:4:5:6:7:8 | 1:2:3:4:5:6:7:: | 1:2:3:4:5:6::8 | 1:2:3:4:5::8 | 1:2:3:4::8 | 1:2:3::8 | 1:2::8 | 1::8 | ::8 | fe80::7:8%1 | ::255.255.255.255 | 2001:db8:3:4::192.0.2.33 | 64:ff9b::192.0.2.33 **ä¸åŒ¹é…ï¼š**1.2.3.4.5.6.7.8 | 1::2::3 ç‰¹å®šå­—ç¬¦ åŒ¹é…é•¿åº¦ä¸º 3 çš„å­—ç¬¦ä¸²ï¼š^.{3}$ã€‚ åŒ¹é…ç”± 26 ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^[A-Za-z]+$ã€‚ åŒ¹é…ç”± 26 ä¸ªå¤§å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^[A-Z]+$ã€‚ åŒ¹é…ç”± 26 ä¸ªå°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^[a-z]+$ã€‚ åŒ¹é…ç”±æ•°å­—å’Œ 26 ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^[A-Za-z0-9]+$ã€‚ åŒ¹é…ç”±æ•°å­—ã€26 ä¸ªè‹±æ–‡å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^\w+$ã€‚ ç‰¹å®šæ•°å­— åŒ¹é…æ­£æ•´æ•°ï¼š^[1-9]\d*$ åŒ¹é…è´Ÿæ•´æ•°ï¼š^-[1-9]\d*$ åŒ¹é…æ•´æ•°ï¼š^(-?[1-9]\d*)|0$ åŒ¹é…æ­£æµ®ç‚¹æ•°ï¼š^[1-9]\d*\.\d+|0\.\d+$ åŒ¹é…è´Ÿæµ®ç‚¹æ•°ï¼š^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$ åŒ¹é…æµ®ç‚¹æ•°ï¼š^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$ é€ŸæŸ¥å…ƒå­—ç¬¦å­—å…¸ ä¸ºäº†æ–¹ä¾¿å¿«æŸ¥æ­£åˆ™çš„å…ƒå­—ç¬¦å«ä¹‰ï¼Œåœ¨æœ¬èŠ‚æ ¹æ®å…ƒå­—ç¬¦çš„åŠŸèƒ½é›†ä¸­ç½—åˆ—æ­£åˆ™çš„å„ç§å…ƒå­—ç¬¦ã€‚ é™å®šç¬¦ å­—ç¬¦ æè¿° * åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œzo* èƒ½åŒ¹é… â€œzâ€ ä»¥åŠ â€œzooâ€ã€‚* ç­‰ä»·äºŽ{0,}ã€‚ + åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€˜zo+â€™ èƒ½åŒ¹é… â€œzoâ€ ä»¥åŠ â€œzooâ€ï¼Œä½†ä¸èƒ½åŒ¹é… â€œzâ€ã€‚+ ç­‰ä»·äºŽ {1,}ã€‚ ? åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€œdo(es)?â€ å¯ä»¥åŒ¹é… â€œdoâ€ æˆ– â€œdoesâ€ ä¸­çš„&quot;do&quot; ã€‚? ç­‰ä»·äºŽ {0,1}ã€‚ {n} n æ˜¯ä¸€ä¸ªéžè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„ n æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€˜o{2}â€™ ä¸èƒ½åŒ¹é… â€œBobâ€ ä¸­çš„ â€˜oâ€™ï¼Œä½†æ˜¯èƒ½åŒ¹é… â€œfoodâ€ ä¸­çš„ä¸¤ä¸ª oã€‚ {n,} n æ˜¯ä¸€ä¸ªéžè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é… n æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€˜o{2,}â€™ ä¸èƒ½åŒ¹é… â€œBobâ€ ä¸­çš„ â€˜oâ€™ï¼Œä½†èƒ½åŒ¹é… â€œfooooodâ€ ä¸­çš„æ‰€æœ‰ oã€‚â€˜o{1,}â€™ ç­‰ä»·äºŽ â€˜o+â€™ã€‚â€˜o{0,}â€™ åˆ™ç­‰ä»·äºŽ â€˜o*â€™ã€‚ {n,m} m å’Œ n å‡ä¸ºéžè´Ÿæ•´æ•°ï¼Œå…¶ä¸­ n &lt;= mã€‚æœ€å°‘åŒ¹é… n æ¬¡ä¸”æœ€å¤šåŒ¹é… m æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€œo{1,3}â€ å°†åŒ¹é… â€œfoooooodâ€ ä¸­çš„å‰ä¸‰ä¸ª oã€‚â€˜o{0,1}â€™ ç­‰ä»·äºŽ â€˜o?â€™ã€‚è¯·æ³¨æ„åœ¨é€—å·å’Œä¸¤ä¸ªæ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚ å®šä½ç¬¦ å­—ç¬¦ æè¿° ^ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²å¼€å§‹çš„ä½ç½®ã€‚å¦‚æžœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±žæ€§ï¼Œ^ è¿˜ä¼šä¸Ž \n æˆ– \r ä¹‹åŽçš„ä½ç½®åŒ¹é…ã€‚ $ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²ç»“å°¾çš„ä½ç½®ã€‚å¦‚æžœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±žæ€§ï¼Œ$ è¿˜ä¼šä¸Ž \n æˆ– \r ä¹‹å‰çš„ä½ç½®åŒ¹é…ã€‚ \b åŒ¹é…ä¸€ä¸ªå­—è¾¹ç•Œï¼Œå³å­—ä¸Žç©ºæ ¼é—´çš„ä½ç½®ã€‚ \B éžå­—è¾¹ç•ŒåŒ¹é…ã€‚ éžæ‰“å°å­—ç¬¦ å­—ç¬¦ æè¿° \cx åŒ¹é…ç”± x æŒ‡æ˜Žçš„æŽ§åˆ¶å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ \cM åŒ¹é…ä¸€ä¸ª Control-M æˆ–å›žè½¦ç¬¦ã€‚x çš„å€¼å¿…é¡»ä¸º A-Z æˆ– a-z ä¹‹ä¸€ã€‚å¦åˆ™ï¼Œå°† c è§†ä¸ºä¸€ä¸ªåŽŸä¹‰çš„ â€˜câ€™ å­—ç¬¦ã€‚ \f åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦ã€‚ç­‰ä»·äºŽ \x0c å’Œ \cLã€‚ \n åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ç­‰ä»·äºŽ \x0a å’Œ \cJã€‚ \r åŒ¹é…ä¸€ä¸ªå›žè½¦ç¬¦ã€‚ç­‰ä»·äºŽ \x0d å’Œ \cMã€‚ \s åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äºŽ [ \f\n\r\t\v]ã€‚ \S åŒ¹é…ä»»ä½•éžç©ºç™½å­—ç¬¦ã€‚ç­‰ä»·äºŽ [ \f\n\r\t\v]ã€‚ \t åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äºŽ \x09 å’Œ \cIã€‚ \v åŒ¹é…ä¸€ä¸ªåž‚ç›´åˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äºŽ \x0b å’Œ \cKã€‚ åˆ†ç»„ è¡¨è¾¾å¼ æè¿° (exp) åŒ¹é…çš„å­è¡¨è¾¾å¼ã€‚()ä¸­çš„å†…å®¹å°±æ˜¯å­è¡¨è¾¾å¼ã€‚ (?&lt;name&gt;exp) å‘½åçš„å­è¡¨è¾¾å¼ï¼ˆåå‘å¼•ç”¨ï¼‰ã€‚ (?:exp) éžæ•èŽ·ç»„ï¼Œè¡¨ç¤ºå½“ä¸€ä¸ªé™å®šç¬¦åº”ç”¨åˆ°ä¸€ä¸ªç»„ï¼Œä½†ç»„æ•èŽ·çš„å­å­—ç¬¦ä¸²å¹¶éžæ‰€éœ€æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨éžæ•èŽ·ç»„æž„é€ ã€‚ (?=exp) åŒ¹é… exp å‰é¢çš„ä½ç½®ã€‚ (?&lt;=exp) åŒ¹é… exp åŽé¢çš„ä½ç½®ã€‚ (?!exp) åŒ¹é…åŽé¢è·Ÿçš„ä¸æ˜¯ exp çš„ä½ç½®ã€‚ (?&lt;!exp) åŒ¹é…å‰é¢ä¸æ˜¯ exp çš„ä½ç½®ã€‚ ç‰¹æ®Šç¬¦å· å­—ç¬¦ æè¿° \ å°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºæˆ–ç‰¹æ®Šå­—ç¬¦ã€æˆ–åŽŸä¹‰å­—ç¬¦ã€æˆ–å‘åŽå¼•ç”¨ã€æˆ–å…«è¿›åˆ¶è½¬ä¹‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œ â€˜nâ€™ åŒ¹é…å­—ç¬¦ â€˜nâ€™ã€‚â€™\nâ€™ åŒ¹é…æ¢è¡Œç¬¦ã€‚åºåˆ— â€˜\â€™ åŒ¹é… â€œâ€ï¼Œè€Œ â€˜(â€™ åˆ™åŒ¹é… â€œ(â€ã€‚ \| æŒ‡æ˜Žä¸¤é¡¹ä¹‹é—´çš„ä¸€ä¸ªé€‰æ‹©ã€‚ [] åŒ¹é…æ–¹æ‹¬å·èŒƒå›´å†…çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚å½¢å¼å¦‚ï¼š[xyz]ã€[xyz]ã€[a-z]ã€[a-z]ã€[x,y,z] å‚è€ƒèµ„æ–™ æ­£åˆ™è¡¨è¾¾å¼ 30 åˆ†é’Ÿå…¥é—¨æ•™ç¨‹ msdn æ­£åˆ™è¡¨è¾¾å¼æ•™ç¨‹ æ­£åˆ™åº”ç”¨ä¹‹â€”â€”æ—¥æœŸæ­£åˆ™è¡¨è¾¾å¼ http://www.regexlib.com/]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>tools</tag>
        <tag>regex</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginx æžç®€æ•™ç¨‹]]></title>
    <url>%2Fblog%2F2016%2F10%2F10%2Ftools%2Fnginx%2F</url>
    <content type="text"><![CDATA[Nginx æžç®€æ•™ç¨‹ æœ¬æ–‡æ˜¯ä¸€ä¸ª Nginx æžç®€æ•™ç¨‹ï¼Œç›®çš„åœ¨äºŽå¸®åŠ©æ–°æ‰‹å¿«é€Ÿå…¥é—¨ Nginxã€‚ æˆ‘åœ¨ Github ä¸Šåˆ›å»ºäº†ä¸€ä¸ª Nginx æ•™ç¨‹é¡¹ç›®ï¼š nginx-tutorialã€‚æ•™ç¨‹ä¸­æä¾›äº†ä¸€äº›å¸¸ç”¨åœºæ™¯çš„ Nginx ç¤ºä¾‹ï¼Œç¤ºä¾‹å¯ä»¥é€šè¿‡è„šæœ¬ä¸€é”®å¼å¯åŠ¨ï¼Œæ–¹ä¾¿æ–°æ‰‹å­¦ä¹ ã€‚ ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ æ¦‚è¿° å®‰è£… Windows å®‰è£… Linux å®‰è£… Linux å¼€æœºè‡ªå¯åŠ¨ ä½¿ç”¨ nginx é…ç½®å®žæˆ˜ http åå‘ä»£ç†é…ç½® è´Ÿè½½å‡è¡¡é…ç½® ç½‘ç«™æœ‰å¤šä¸ª webapp çš„é…ç½® https åå‘ä»£ç†é…ç½® é™æ€ç«™ç‚¹é…ç½® æ­å»ºæ–‡ä»¶æœåŠ¡å™¨ è·¨åŸŸè§£å†³æ–¹æ¡ˆ å‚è€ƒèµ„æ–™ æ¦‚è¿° ä»€ä¹ˆæ˜¯ Nginx? Nginx (engine x) æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ Web æœåŠ¡å™¨ ã€åå‘ä»£ç†æœåŠ¡å™¨åŠç”µå­é‚®ä»¶ï¼ˆIMAP/POP3ï¼‰ä»£ç†æœåŠ¡å™¨ã€‚ ä»€ä¹ˆæ˜¯åå‘ä»£ç†ï¼Ÿ åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æŽ¥å— internet ä¸Šçš„è¿žæŽ¥è¯·æ±‚ï¼Œç„¶åŽå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»ŽæœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æžœè¿”å›žç»™ internet ä¸Šè¯·æ±‚è¿žæŽ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨çŽ°ä¸ºä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚ å®‰è£… Windows å®‰è£… ï¼ˆ1ï¼‰è¿›å…¥å®˜æ–¹ä¸‹è½½åœ°å€ï¼Œé€‰æ‹©åˆé€‚ç‰ˆæœ¬ï¼ˆnginx/Windows-xxxï¼‰ã€‚ ï¼ˆ2ï¼‰è§£åŽ‹åˆ°æœ¬åœ° ï¼ˆ3ï¼‰å¯åŠ¨ ä¸‹é¢ä»¥ C ç›˜æ ¹ç›®å½•ä¸ºä¾‹è¯´æ˜Žä¸‹ï¼š cd C:cd C:\nginx-0.8.54 start nginx æ³¨ï¼šNginx / Win32 æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªæŽ§åˆ¶å°ç¨‹åºï¼Œè€Œéž windows æœåŠ¡æ–¹å¼çš„ã€‚æœåŠ¡å™¨æ–¹å¼ç›®å‰è¿˜æ˜¯å¼€å‘å°è¯•ä¸­ã€‚ Linux å®‰è£… rpm åŒ…æ–¹å¼ï¼ˆæŽ¨èï¼‰ ï¼ˆ1ï¼‰è¿›å…¥ä¸‹è½½é¡µé¢ï¼Œé€‰æ‹©åˆé€‚ç‰ˆæœ¬ä¸‹è½½ã€‚ $ wget http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm ï¼ˆ2ï¼‰å®‰è£… nginx rpm åŒ… nginx rpm åŒ…å®žé™…ä¸Šå®‰è£…çš„æ˜¯ nginx çš„ yum æºã€‚ $ rpm -ivh nginx-*.rpm ï¼ˆ3ï¼‰æ­£å¼å®‰è£… rpm åŒ… $ yum install nginx ï¼ˆ4ï¼‰å…³é—­é˜²ç«å¢™ $ firewall-cmd --zone=public --add-port=80/tcp --permanent$ firewall-cmd --reload æºç ç¼–è¯‘æ–¹å¼ å®‰è£…ç¼–è¯‘å·¥å…·åŠåº“æ–‡ä»¶ Nginx æºç çš„ç¼–è¯‘ä¾èµ–äºŽ gcc ä»¥åŠä¸€äº›åº“æ–‡ä»¶ï¼Œæ‰€ä»¥å¿…é¡»æå‰å®‰è£…ã€‚ $ yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel Nginx ä¾èµ– pcre åº“ï¼Œå®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š ï¼ˆ1ï¼‰ä¸‹è½½è§£åŽ‹åˆ°æœ¬åœ° è¿›å…¥pcre å®˜ç½‘ä¸‹è½½é¡µé¢ï¼Œé€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ä¸‹è½½ã€‚ æˆ‘é€‰æ‹©çš„æ˜¯ 8.35 ç‰ˆæœ¬ï¼š wget -O /opt/pcre/pcre-8.35.tar.gz http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gzcd /opt/pcretar zxvf pcre-8.35.tar.gz ï¼ˆ2ï¼‰ç¼–è¯‘å®‰è£… æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š cd /opt/pcre/pcre-8.35./configuremake &amp;&amp; make install ï¼ˆ3ï¼‰æ£€éªŒæ˜¯å¦å®‰è£…æˆåŠŸ æ‰§è¡Œ pcre-config --version å‘½ä»¤ã€‚ å®‰è£… Nginx å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š ï¼ˆ1ï¼‰ä¸‹è½½è§£åŽ‹åˆ°æœ¬åœ° è¿›å…¥å®˜ç½‘ä¸‹è½½åœ°å€ï¼šhttp://nginx.org/en/download.html ï¼Œé€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ä¸‹è½½ã€‚ æˆ‘é€‰æ‹©çš„æ˜¯ 1.12.2 ç‰ˆæœ¬ï¼šhttp://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz wget -O /opt/nginx/nginx-1.12.2.tar.gz http://nginx.org/download/nginx-1.12.2.tar.gzcd /opt/nginxtar zxvf nginx-1.12.2.tar.gz ï¼ˆ2ï¼‰ç¼–è¯‘å®‰è£… æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š cd /opt/nginx/nginx-1.12.2./configure --with-http_stub_status_module --with-http_ssl_module --with-pcre=/opt/pcre/pcre-8.35 ï¼ˆ3ï¼‰å…³é—­é˜²ç«å¢™ $ firewall-cmd --zone=public --add-port=80/tcp --permanent$ firewall-cmd --reload ï¼ˆ4ï¼‰ å¯åŠ¨ Nginx å®‰è£…æˆåŠŸåŽï¼Œç›´æŽ¥æ‰§è¡Œ nginx å‘½ä»¤å³å¯å¯åŠ¨ nginxã€‚ Linux å¼€æœºè‡ªå¯åŠ¨ Centos7 ä»¥ä¸Šæ˜¯ç”¨ Systemd è¿›è¡Œç³»ç»Ÿåˆå§‹åŒ–çš„ï¼ŒSystemd æ˜¯ Linux ç³»ç»Ÿä¸­æœ€æ–°çš„åˆå§‹åŒ–ç³»ç»Ÿï¼ˆinitï¼‰ï¼Œå®ƒä¸»è¦çš„è®¾è®¡ç›®æ ‡æ˜¯å…‹æœ sysvinit å›ºæœ‰çš„ç¼ºç‚¹ï¼Œæé«˜ç³»ç»Ÿçš„å¯åŠ¨é€Ÿåº¦ã€‚Systemd æœåŠ¡æ–‡ä»¶ä»¥ .service ç»“å°¾ã€‚ rpm åŒ…æ–¹å¼ å¦‚æžœæ˜¯é€šè¿‡ rpm åŒ…å®‰è£…çš„ï¼Œä¼šè‡ªåŠ¨åˆ›å»º nginx.service æ–‡ä»¶ã€‚ ç›´æŽ¥ç”¨å‘½ä»¤ï¼š $ systemctl enable nginx.service è®¾ç½®å¼€æœºå¯åŠ¨å³å¯ã€‚ æºç ç¼–è¯‘æ–¹å¼ å¦‚æžœé‡‡ç”¨æºç ç¼–è¯‘æ–¹å¼ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»º nginx.service æ–‡ä»¶ã€‚ ä½¿ç”¨ nginx çš„ä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å‡ æ¡å‘½ä»¤ã€‚ å¸¸ç”¨åˆ°çš„å‘½ä»¤å¦‚ä¸‹ï¼š nginx -s stop å¿«é€Ÿå…³é—­Nginxï¼Œå¯èƒ½ä¸ä¿å­˜ç›¸å…³ä¿¡æ¯ï¼Œå¹¶è¿…é€Ÿç»ˆæ­¢webæœåŠ¡ã€‚nginx -s quit å¹³ç¨³å…³é—­Nginxï¼Œä¿å­˜ç›¸å…³ä¿¡æ¯ï¼Œæœ‰å®‰æŽ’çš„ç»“æŸwebæœåŠ¡ã€‚nginx -s reload å› æ”¹å˜äº†Nginxç›¸å…³é…ç½®ï¼Œéœ€è¦é‡æ–°åŠ è½½é…ç½®è€Œé‡è½½ã€‚nginx -s reopen é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚nginx -c filename ä¸º Nginx æŒ‡å®šä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¥ä»£æ›¿ç¼ºçœçš„ã€‚nginx -t ä¸è¿è¡Œï¼Œè€Œä»…ä»…æµ‹è¯•é…ç½®æ–‡ä»¶ã€‚nginx å°†æ£€æŸ¥é…ç½®æ–‡ä»¶çš„è¯­æ³•çš„æ­£ç¡®æ€§ï¼Œå¹¶å°è¯•æ‰“å¼€é…ç½®æ–‡ä»¶ä¸­æ‰€å¼•ç”¨åˆ°çš„æ–‡ä»¶ã€‚nginx -v æ˜¾ç¤º nginx çš„ç‰ˆæœ¬ã€‚nginx -V æ˜¾ç¤º nginx çš„ç‰ˆæœ¬ï¼Œç¼–è¯‘å™¨ç‰ˆæœ¬å’Œé…ç½®å‚æ•°ã€‚ å¦‚æžœä¸æƒ³æ¯æ¬¡éƒ½æ•²å‘½ä»¤ï¼Œå¯ä»¥åœ¨ nginx å®‰è£…ç›®å½•ä¸‹æ–°æ·»ä¸€ä¸ªå¯åŠ¨æ‰¹å¤„ç†æ–‡ä»¶startup.batï¼ŒåŒå‡»å³å¯è¿è¡Œã€‚å†…å®¹å¦‚ä¸‹ï¼š @echo offrem å¦‚æžœå¯åŠ¨å‰å·²ç»å¯åŠ¨nginxå¹¶è®°å½•ä¸‹pidæ–‡ä»¶ï¼Œä¼škillæŒ‡å®šè¿›ç¨‹nginx.exe -s stoprem æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®æ€§nginx.exe -t -c conf/nginx.confrem æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯nginx.exe -vrem æŒ‰ç…§æŒ‡å®šé…ç½®åŽ»å¯åŠ¨nginxnginx.exe -c conf/nginx.conf å¦‚æžœæ˜¯è¿è¡Œåœ¨ Linux ä¸‹ï¼Œå†™ä¸€ä¸ª shell è„šæœ¬ï¼Œå¤§åŒå°å¼‚ã€‚ nginx é…ç½®å®žæˆ˜ æˆ‘å§‹ç»ˆè®¤ä¸ºï¼Œå„ç§å¼€å‘å·¥å…·çš„é…ç½®è¿˜æ˜¯ç»“åˆå®žæˆ˜æ¥è®²è¿°ï¼Œä¼šè®©äººæ›´æ˜“ç†è§£ã€‚ http åå‘ä»£ç†é…ç½® æˆ‘ä»¬å…ˆå®žçŽ°ä¸€ä¸ªå°ç›®æ ‡ï¼šä¸è€ƒè™‘å¤æ‚çš„é…ç½®ï¼Œä»…ä»…æ˜¯å®Œæˆä¸€ä¸ª http åå‘ä»£ç†ã€‚ nginx.conf é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š æ³¨ï¼šconf / nginx.conf æ˜¯ nginx çš„é»˜è®¤é…ç½®æ–‡ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ nginx -c æŒ‡å®šä½ çš„é…ç½®æ–‡ä»¶ #è¿è¡Œç”¨æˆ·#user somebody;#å¯åŠ¨è¿›ç¨‹,é€šå¸¸è®¾ç½®æˆå’Œcpuçš„æ•°é‡ç›¸ç­‰worker_processes 1;#å…¨å±€é”™è¯¯æ—¥å¿—error_log D:/Tools/nginx-1.10.1/logs/error.log;error_log D:/Tools/nginx-1.10.1/logs/notice.log notice;error_log D:/Tools/nginx-1.10.1/logs/info.log info;#PIDæ–‡ä»¶ï¼Œè®°å½•å½“å‰å¯åŠ¨çš„nginxçš„è¿›ç¨‹IDpid D:/Tools/nginx-1.10.1/logs/nginx.pid;#å·¥ä½œæ¨¡å¼åŠè¿žæŽ¥æ•°ä¸Šé™events &#123; worker_connections 1024; #å•ä¸ªåŽå°worker processè¿›ç¨‹çš„æœ€å¤§å¹¶å‘é“¾æŽ¥æ•°&#125;#è®¾å®šhttpæœåŠ¡å™¨ï¼Œåˆ©ç”¨å®ƒçš„åå‘ä»£ç†åŠŸèƒ½æä¾›è´Ÿè½½å‡è¡¡æ”¯æŒhttp &#123; #è®¾å®šmimeç±»åž‹(é‚®ä»¶æ”¯æŒç±»åž‹),ç±»åž‹ç”±mime.typesæ–‡ä»¶å®šä¹‰ include D:/Tools/nginx-1.10.1/conf/mime.types; default_type application/octet-stream; #è®¾å®šæ—¥å¿— log_format main '[$remote_addr] - [$remote_user] [$time_local] "$request" ' '$status $body_bytes_sent "$http_referer" ' '"$http_user_agent" "$http_x_forwarded_for"'; access_log D:/Tools/nginx-1.10.1/logs/access.log main; rewrite_log on; #sendfile æŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨ sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºŽæ™®é€šåº”ç”¨ï¼Œ #å¿…é¡»è®¾ä¸º on,å¦‚æžœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸º offï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸Žç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½Žç³»ç»Ÿçš„uptime. sendfile on; #tcp_nopush on; #è¿žæŽ¥è¶…æ—¶æ—¶é—´ keepalive_timeout 120; tcp_nodelay on; #gzipåŽ‹ç¼©å¼€å…³ #gzip on; #è®¾å®šå®žé™…çš„æœåŠ¡å™¨åˆ—è¡¨ upstream zp_server1&#123; server 127.0.0.1:8089; &#125; #HTTPæœåŠ¡å™¨ server &#123; #ç›‘å¬80ç«¯å£ï¼Œ80ç«¯å£æ˜¯çŸ¥åç«¯å£å·ï¼Œç”¨äºŽHTTPåè®® listen 80; #å®šä¹‰ä½¿ç”¨www.xx.comè®¿é—® server_name www.helloworld.com; #é¦–é¡µ index index.html #æŒ‡å‘webappçš„ç›®å½• root D:\01_Workspace\Project\github\zp\SpringNotes\spring-security\spring-shiro\src\main\webapp; #ç¼–ç æ ¼å¼ charset utf-8; #ä»£ç†é…ç½®å‚æ•° proxy_connect_timeout 180; proxy_send_timeout 180; proxy_read_timeout 180; proxy_set_header Host $host; proxy_set_header X-Forwarder-For $remote_addr; #åå‘ä»£ç†çš„è·¯å¾„ï¼ˆå’Œupstreamç»‘å®šï¼‰ï¼Œlocation åŽé¢è®¾ç½®æ˜ å°„çš„è·¯å¾„ location / &#123; proxy_pass http://zp_server1; &#125; #é™æ€æ–‡ä»¶ï¼Œnginxè‡ªå·±å¤„ç† location ~ ^/(images|javascript|js|css|flash|media|static)/ &#123; root D:\01_Workspace\Project\github\zp\SpringNotes\spring-security\spring-shiro\src\main\webapp\views; #è¿‡æœŸ30å¤©ï¼Œé™æ€æ–‡ä»¶ä¸æ€Žä¹ˆæ›´æ–°ï¼Œè¿‡æœŸå¯ä»¥è®¾å¤§ä¸€ç‚¹ï¼Œå¦‚æžœé¢‘ç¹æ›´æ–°ï¼Œåˆ™å¯ä»¥è®¾ç½®å¾—å°ä¸€ç‚¹ã€‚ expires 30d; &#125; #è®¾å®šæŸ¥çœ‹NginxçŠ¶æ€çš„åœ°å€ location /NginxStatus &#123; stub_status on; access_log on; auth_basic "NginxStatus"; auth_basic_user_file conf/htpasswd; &#125; #ç¦æ­¢è®¿é—® .htxxx æ–‡ä»¶ location ~ /\.ht &#123; deny all; &#125; #é”™è¯¯å¤„ç†é¡µé¢ï¼ˆå¯é€‰æ‹©æ€§é…ç½®ï¼‰ #error_page 404 /404.html; #error_page 500 502 503 504 /50x.html; #location = /50x.html &#123; # root html; #&#125; &#125;&#125; å¥½äº†ï¼Œè®©æˆ‘ä»¬æ¥è¯•è¯•å§ï¼š å¯åŠ¨ webappï¼Œæ³¨æ„å¯åŠ¨ç»‘å®šçš„ç«¯å£è¦å’Œ nginx ä¸­çš„ upstream è®¾ç½®çš„ç«¯å£ä¿æŒä¸€è‡´ã€‚ æ›´æ”¹ hostï¼šåœ¨ C:\Windows\System32\drivers\etc ç›®å½•ä¸‹çš„ host æ–‡ä»¶ä¸­æ·»åŠ ä¸€æ¡ DNS è®°å½• 127.0.0.1 www.helloworld.com å¯åŠ¨å‰æ–‡ä¸­ startup.bat çš„å‘½ä»¤ åœ¨æµè§ˆå™¨ä¸­è®¿é—® www.helloworld.comï¼Œä¸å‡ºæ„å¤–ï¼Œå·²ç»å¯ä»¥è®¿é—®äº†ã€‚ è´Ÿè½½å‡è¡¡é…ç½® ä¸Šä¸€ä¸ªä¾‹å­ä¸­ï¼Œä»£ç†ä»…ä»…æŒ‡å‘ä¸€ä¸ªæœåŠ¡å™¨ã€‚ ä½†æ˜¯ï¼Œç½‘ç«™åœ¨å®žé™…è¿è¥è¿‡ç¨‹ä¸­ï¼Œå¤šåŠéƒ½æ˜¯æœ‰å¤šå°æœåŠ¡å™¨è¿è¡Œç€åŒæ ·çš„ appï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨è´Ÿè½½å‡è¡¡æ¥åˆ†æµã€‚ nginx ä¹Ÿå¯ä»¥å®žçŽ°ç®€å•çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚ å‡è®¾è¿™æ ·ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šå°†åº”ç”¨éƒ¨ç½²åœ¨ 192.168.1.11:80ã€192.168.1.12:80ã€192.168.1.13:80 ä¸‰å° linux çŽ¯å¢ƒçš„æœåŠ¡å™¨ä¸Šã€‚ç½‘ç«™åŸŸåå« www.helloworld.comï¼Œå…¬ç½‘ IP ä¸º 192.168.1.11ã€‚åœ¨å…¬ç½‘ IP æ‰€åœ¨çš„æœåŠ¡å™¨ä¸Šéƒ¨ç½² nginxï¼Œå¯¹æ‰€æœ‰è¯·æ±‚åšè´Ÿè½½å‡è¡¡å¤„ç†ã€‚ nginx.conf é…ç½®å¦‚ä¸‹ï¼š http &#123; #è®¾å®šmimeç±»åž‹,ç±»åž‹ç”±mime.typeæ–‡ä»¶å®šä¹‰ include /etc/nginx/mime.types; default_type application/octet-stream; #è®¾å®šæ—¥å¿—æ ¼å¼ access_log /var/log/nginx/access.log; #è®¾å®šè´Ÿè½½å‡è¡¡çš„æœåŠ¡å™¨åˆ—è¡¨ upstream load_balance_server &#123; #weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ çŽ‡è¶Šå¤§ server 192.168.1.11:80 weight=5; server 192.168.1.12:80 weight=1; server 192.168.1.13:80 weight=6; &#125; #HTTPæœåŠ¡å™¨ server &#123; #ä¾¦å¬80ç«¯å£ listen 80; #å®šä¹‰ä½¿ç”¨www.xx.comè®¿é—® server_name www.helloworld.com; #å¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œè´Ÿè½½å‡è¡¡è¯·æ±‚ location / &#123; root /root; #å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½® index index.html index.htm; #å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§° proxy_pass http://load_balance_server ;#è¯·æ±‚è½¬å‘load_balance_server å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨ #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®(å¯é€‰æ‹©æ€§é…ç½®) #proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; #åŽç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-ForèŽ·å–ç”¨æˆ·çœŸå®žIP proxy_set_header X-Forwarded-For $remote_addr; proxy_connect_timeout 90; #nginxè·ŸåŽç«¯æœåŠ¡å™¨è¿žæŽ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿žæŽ¥è¶…æ—¶) proxy_send_timeout 90; #åŽç«¯æœåŠ¡å™¨æ•°æ®å›žä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶) proxy_read_timeout 90; #è¿žæŽ¥æˆåŠŸåŽï¼ŒåŽç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æŽ¥æ”¶è¶…æ—¶) proxy_buffer_size 4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å° proxy_buffers 4 32k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½® proxy_busy_buffers_size 64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰ proxy_temp_file_write_size 64k; #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºŽè¿™ä¸ªå€¼ï¼Œå°†ä»ŽupstreamæœåŠ¡å™¨ä¼  client_max_body_size 10m; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•° client_body_buffer_size 128k; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•° &#125; &#125;&#125; ç½‘ç«™æœ‰å¤šä¸ª webapp çš„é…ç½® å½“ä¸€ä¸ªç½‘ç«™åŠŸèƒ½è¶Šæ¥è¶Šä¸°å¯Œæ—¶ï¼Œå¾€å¾€éœ€è¦å°†ä¸€äº›åŠŸèƒ½ç›¸å¯¹ç‹¬ç«‹çš„æ¨¡å—å‰¥ç¦»å‡ºæ¥ï¼Œç‹¬ç«‹ç»´æŠ¤ã€‚è¿™æ ·çš„è¯ï¼Œé€šå¸¸ï¼Œä¼šæœ‰å¤šä¸ª webappã€‚ ä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚ www.helloworld.com ç«™ç‚¹æœ‰å¥½å‡ ä¸ª webappï¼Œfinanceï¼ˆé‡‘èžï¼‰ã€productï¼ˆäº§å“ï¼‰ã€adminï¼ˆç”¨æˆ·ä¸­å¿ƒï¼‰ã€‚è®¿é—®è¿™äº›åº”ç”¨çš„æ–¹å¼é€šè¿‡ä¸Šä¸‹æ–‡(context)æ¥è¿›è¡ŒåŒºåˆ†: www.helloworld.com/finance/ www.helloworld.com/product/ www.helloworld.com/admin/ æˆ‘ä»¬çŸ¥é“ï¼Œhttp çš„é»˜è®¤ç«¯å£å·æ˜¯ 80ï¼Œå¦‚æžœåœ¨ä¸€å°æœåŠ¡å™¨ä¸ŠåŒæ—¶å¯åŠ¨è¿™ 3 ä¸ª webapp åº”ç”¨ï¼Œéƒ½ç”¨ 80 ç«¯å£ï¼Œè‚¯å®šæ˜¯ä¸æˆçš„ã€‚æ‰€ä»¥ï¼Œè¿™ä¸‰ä¸ªåº”ç”¨éœ€è¦åˆ†åˆ«ç»‘å®šä¸åŒçš„ç«¯å£å·ã€‚ é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ï¼Œç”¨æˆ·åœ¨å®žé™…è®¿é—® www.helloworld.com ç«™ç‚¹æ—¶ï¼Œè®¿é—®ä¸åŒ webappï¼Œæ€»ä¸ä¼šè¿˜å¸¦ç€å¯¹åº”çš„ç«¯å£å·åŽ»è®¿é—®å§ã€‚æ‰€ä»¥ï¼Œä½ å†æ¬¡éœ€è¦ç”¨åˆ°åå‘ä»£ç†æ¥åšå¤„ç†ã€‚ é…ç½®ä¹Ÿä¸éš¾ï¼Œæ¥çœ‹çœ‹æ€Žä¹ˆåšå§ï¼š http &#123; #æ­¤å¤„çœç•¥ä¸€äº›åŸºæœ¬é…ç½® upstream product_server&#123; server www.helloworld.com:8081; &#125; upstream admin_server&#123; server www.helloworld.com:8082; &#125; upstream finance_server&#123; server www.helloworld.com:8083; &#125; server &#123; #æ­¤å¤„çœç•¥ä¸€äº›åŸºæœ¬é…ç½® #é»˜è®¤æŒ‡å‘productçš„server location / &#123; proxy_pass http://product_server; &#125; location /product/&#123; proxy_pass http://product_server; &#125; location /admin/ &#123; proxy_pass http://admin_server; &#125; location /finance/ &#123; proxy_pass http://finance_server; &#125; &#125;&#125; https åå‘ä»£ç†é…ç½® ä¸€äº›å¯¹å®‰å…¨æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„ç«™ç‚¹ï¼Œå¯èƒ½ä¼šä½¿ç”¨ HTTPSï¼ˆä¸€ç§ä½¿ç”¨ ssl é€šä¿¡æ ‡å‡†çš„å®‰å…¨ HTTP åè®®ï¼‰ã€‚ è¿™é‡Œä¸ç§‘æ™® HTTP åè®®å’Œ SSL æ ‡å‡†ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ nginx é…ç½® https éœ€è¦çŸ¥é“å‡ ç‚¹ï¼š HTTPS çš„å›ºå®šç«¯å£å·æ˜¯ 443ï¼Œä¸åŒäºŽ HTTP çš„ 80 ç«¯å£ SSL æ ‡å‡†éœ€è¦å¼•å…¥å®‰å…¨è¯ä¹¦ï¼Œæ‰€ä»¥åœ¨ nginx.conf ä¸­ä½ éœ€è¦æŒ‡å®šè¯ä¹¦å’Œå®ƒå¯¹åº”çš„ key å…¶ä»–å’Œ http åå‘ä»£ç†åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯åœ¨ Server éƒ¨åˆ†é…ç½®æœ‰äº›ä¸åŒã€‚ #HTTPæœåŠ¡å™¨server &#123; #ç›‘å¬443ç«¯å£ã€‚443ä¸ºçŸ¥åç«¯å£å·ï¼Œä¸»è¦ç”¨äºŽHTTPSåè®® listen 443 ssl; #å®šä¹‰ä½¿ç”¨www.xx.comè®¿é—® server_name www.helloworld.com; #sslè¯ä¹¦æ–‡ä»¶ä½ç½®(å¸¸è§è¯ä¹¦æ–‡ä»¶æ ¼å¼ä¸ºï¼šcrt/pem) ssl_certificate cert.pem; #sslè¯ä¹¦keyä½ç½® ssl_certificate_key cert.key; #sslé…ç½®å‚æ•°ï¼ˆé€‰æ‹©æ€§é…ç½®ï¼‰ ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; #æ•°å­—ç­¾åï¼Œæ­¤å¤„ä½¿ç”¨MD5 ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / &#123; root /root; index index.html index.htm; &#125;&#125; é™æ€ç«™ç‚¹é…ç½® æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®é™æ€ç«™ç‚¹(å³ html æ–‡ä»¶å’Œä¸€å †é™æ€èµ„æº)ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼šå¦‚æžœæ‰€æœ‰çš„é™æ€èµ„æºéƒ½æ”¾åœ¨äº† /app/dist ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ nginx.conf ä¸­æŒ‡å®šé¦–é¡µä»¥åŠè¿™ä¸ªç«™ç‚¹çš„ host å³å¯ã€‚ é…ç½®å¦‚ä¸‹ï¼š worker_processes 1;events &#123; worker_connections 1024;&#125;http &#123; include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; gzip on; gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/javascript image/jpeg image/gif image/png; gzip_vary on; server &#123; listen 80; server_name static.zp.cn; location / &#123; root /app/dist; index index.html; #è½¬å‘ä»»ä½•è¯·æ±‚åˆ° index.html &#125; &#125;&#125; ç„¶åŽï¼Œæ·»åŠ  HOSTï¼š 127.0.0.1 static.zp.cn æ­¤æ—¶ï¼Œåœ¨æœ¬åœ°æµè§ˆå™¨è®¿é—® static.zp.cn ï¼Œå°±å¯ä»¥è®¿é—®é™æ€ç«™ç‚¹äº†ã€‚ æ­å»ºæ–‡ä»¶æœåŠ¡å™¨ æœ‰æ—¶å€™ï¼Œå›¢é˜Ÿéœ€è¦å½’æ¡£ä¸€äº›æ•°æ®æˆ–èµ„æ–™ï¼Œé‚£ä¹ˆæ–‡ä»¶æœåŠ¡å™¨å¿…ä¸å¯å°‘ã€‚ä½¿ç”¨ Nginx å¯ä»¥éžå¸¸å¿«é€Ÿä¾¿æ·çš„æ­å»ºä¸€ä¸ªç®€æ˜“çš„æ–‡ä»¶æœåŠ¡ã€‚ Nginx ä¸­çš„é…ç½®è¦ç‚¹ï¼š å°† autoindex å¼€å¯å¯ä»¥æ˜¾ç¤ºç›®å½•ï¼Œé»˜è®¤ä¸å¼€å¯ã€‚ å°† autoindex_exact_size å¼€å¯å¯ä»¥æ˜¾ç¤ºæ–‡ä»¶çš„å¤§å°ã€‚ å°† autoindex_localtime å¼€å¯å¯ä»¥æ˜¾ç¤ºæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ã€‚ root ç”¨æ¥è®¾ç½®å¼€æ”¾ä¸ºæ–‡ä»¶æœåŠ¡çš„æ ¹è·¯å¾„ã€‚ charset è®¾ç½®ä¸º charset utf-8,gbk;ï¼Œå¯ä»¥é¿å…ä¸­æ–‡ä¹±ç é—®é¢˜ï¼ˆwindows æœåŠ¡å™¨ä¸‹è®¾ç½®åŽï¼Œä¾ç„¶ä¹±ç ï¼Œæœ¬äººæš‚æ—¶æ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ³•ï¼‰ã€‚ ä¸€ä¸ªæœ€ç®€åŒ–çš„é…ç½®å¦‚ä¸‹ï¼š autoindex on;# æ˜¾ç¤ºç›®å½•autoindex_exact_size on;# æ˜¾ç¤ºæ–‡ä»¶å¤§å°autoindex_localtime on;# æ˜¾ç¤ºæ–‡ä»¶æ—¶é—´server &#123; charset utf-8,gbk; # windows æœåŠ¡å™¨ä¸‹è®¾ç½®åŽï¼Œä¾ç„¶ä¹±ç ï¼Œæš‚æ—¶æ— è§£ listen 9050 default_server; listen [::]:9050 default_server; server_name _; root /share/fs;&#125; è·¨åŸŸè§£å†³æ–¹æ¡ˆ web é¢†åŸŸå¼€å‘ä¸­ï¼Œç»å¸¸é‡‡ç”¨å‰åŽç«¯åˆ†ç¦»æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œå‰ç«¯å’ŒåŽç«¯åˆ†åˆ«æ˜¯ç‹¬ç«‹çš„ web åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ï¼šåŽç«¯æ˜¯ Java ç¨‹åºï¼Œå‰ç«¯æ˜¯ React æˆ– Vue åº”ç”¨ã€‚ å„è‡ªç‹¬ç«‹çš„ web app åœ¨äº’ç›¸è®¿é—®æ—¶ï¼ŒåŠ¿å¿…å­˜åœ¨è·¨åŸŸé—®é¢˜ã€‚è§£å†³è·¨åŸŸé—®é¢˜ä¸€èˆ¬æœ‰ä¸¤ç§æ€è·¯ï¼š CORS åœ¨åŽç«¯æœåŠ¡å™¨è®¾ç½® HTTP å“åº”å¤´ï¼ŒæŠŠä½ éœ€è¦è¿è¡Œè®¿é—®çš„åŸŸååŠ å…¥åŠ å…¥ Access-Control-Allow-Origin ä¸­ã€‚ jsonp æŠŠåŽç«¯æ ¹æ®è¯·æ±‚ï¼Œæž„é€  json æ•°æ®ï¼Œå¹¶è¿”å›žï¼Œå‰ç«¯ç”¨ jsonp è·¨åŸŸã€‚ è¿™ä¸¤ç§æ€è·¯ï¼Œæœ¬æ–‡ä¸å±•å¼€è®¨è®ºã€‚ éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œnginx æ ¹æ®ç¬¬ä¸€ç§æ€è·¯ï¼Œä¹Ÿæä¾›äº†ä¸€ç§è§£å†³è·¨åŸŸçš„è§£å†³æ–¹æ¡ˆã€‚ ä¸¾ä¾‹ï¼šwww.helloworld.com ç½‘ç«™æ˜¯ç”±ä¸€ä¸ªå‰ç«¯ app ï¼Œä¸€ä¸ªåŽç«¯ app ç»„æˆçš„ã€‚å‰ç«¯ç«¯å£å·ä¸º 9000ï¼Œ åŽç«¯ç«¯å£å·ä¸º 8080ã€‚ å‰ç«¯å’ŒåŽç«¯å¦‚æžœä½¿ç”¨ http è¿›è¡Œäº¤äº’æ—¶ï¼Œè¯·æ±‚ä¼šè¢«æ‹’ç»ï¼Œå› ä¸ºå­˜åœ¨è·¨åŸŸé—®é¢˜ã€‚æ¥çœ‹çœ‹ï¼Œnginx æ˜¯æ€Žä¹ˆè§£å†³çš„å§ï¼š é¦–å…ˆï¼Œåœ¨ enable-cors.conf æ–‡ä»¶ä¸­è®¾ç½® cors ï¼š # allow origin listset $ACAO '*';# set single originif ($http_origin ~* (www.helloworld.com)$) &#123; set $ACAO $http_origin;&#125;if ($cors = "trueget") &#123; add_header 'Access-Control-Allow-Origin' "$http_origin"; add_header 'Access-Control-Allow-Credentials' 'true'; add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS'; add_header 'Access-Control-Allow-Headers' 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type';&#125;if ($request_method = 'OPTIONS') &#123; set $cors "$&#123;cors&#125;options";&#125;if ($request_method = 'GET') &#123; set $cors "$&#123;cors&#125;get";&#125;if ($request_method = 'POST') &#123; set $cors "$&#123;cors&#125;post";&#125; æŽ¥ä¸‹æ¥ï¼Œåœ¨ä½ çš„æœåŠ¡å™¨ä¸­ include enable-cors.conf æ¥å¼•å…¥è·¨åŸŸé…ç½®ï¼š # ----------------------------------------------------# æ­¤æ–‡ä»¶ä¸ºé¡¹ç›® nginx é…ç½®ç‰‡æ®µ# å¯ä»¥ç›´æŽ¥åœ¨ nginx config ä¸­ includeï¼ˆæŽ¨èï¼‰# æˆ–è€… copy åˆ°çŽ°æœ‰ nginx ä¸­ï¼Œè‡ªè¡Œé…ç½®# www.helloworld.com åŸŸåéœ€é…åˆ dns hosts è¿›è¡Œé…ç½®# å…¶ä¸­ï¼Œapi å¼€å¯äº† corsï¼Œéœ€é…åˆæœ¬ç›®å½•ä¸‹å¦ä¸€ä»½é…ç½®æ–‡ä»¶# ----------------------------------------------------upstream front_server&#123; server www.helloworld.com:9000;&#125;upstream api_server&#123; server www.helloworld.com:8080;&#125;server &#123; listen 80; server_name www.helloworld.com; location ~ ^/api/ &#123; include enable-cors.conf; proxy_pass http://api_server; rewrite "^/api/(.*)$" /$1 break; &#125; location ~ ^/ &#123; proxy_pass http://front_server; &#125;&#125; åˆ°æ­¤ï¼Œå°±å®Œæˆäº†ã€‚ å‚è€ƒèµ„æ–™ Nginx çš„ä¸­æ–‡ç»´åŸº]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>load balance</tag>
        <tag>proxy</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç½‘ç»œåè®®ä¹‹ HTTP]]></title>
    <url>%2Fblog%2F2016%2F01%2F08%2Fcommunication%2Fhttp%2F</url>
    <content type="text"><![CDATA[ç½‘ç»œåè®®ä¹‹ HTTP ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ HTTP æ˜¯ä»€ä¹ˆï¼Ÿ å®žä¾‹ å·¥ä½œåŽŸç† ç‰¹ç‚¹ å®¢æˆ·ç«¯è¯·æ±‚æ¶ˆæ¯ æœåŠ¡å™¨å“åº”æ¶ˆæ¯ HTTP çŠ¶æ€ç  æ›´å¤šå†…å®¹ HTTP æ˜¯ä»€ä¹ˆï¼Ÿ HTTPï¼ˆHyperText Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯ WWW (World Wide Web)å®žçŽ°æ•°æ®é€šä¿¡çš„åŸºçŸ³ã€‚ HTTP æ˜¯ç”± IETF(Internet Engineering Task Forceï¼Œäº’è”ç½‘å·¥ç¨‹å·¥ä½œå°ç»„) å’Œ W3C(World Wide Web Consortiumï¼Œä¸‡ç»´ç½‘åä¼š) å…±åŒåˆä½œåˆ¶è®¢çš„ï¼Œå®ƒä»¬å‘å¸ƒäº†ä¸€ç³»åˆ—çš„RFC(Request For Comments)ï¼Œå…¶ä¸­æœ€è‘—åçš„æ˜¯ RFC 2616ï¼Œå®ƒå®šä¹‰äº†HTTP /1.1ã€‚ å®ƒæ˜¯ä¸€ç§åº”ç”¨å±‚åè®®ï¼ˆOSI ä¸ƒå±‚æ¨¡åž‹çš„æœ€é¡¶å±‚ï¼‰ï¼Œå®ƒåŸºäºŽ TCP/IP é€šä¿¡åè®®æ¥ä¼ é€’æ•°æ®ï¼ˆHTML æ–‡ä»¶, å›¾ç‰‡æ–‡ä»¶, æŸ¥è¯¢ç»“æžœç­‰ï¼‰ã€‚ å®žä¾‹ å¦‚æžœä½ å­¦ä¹ è¿‡è®¡ç®—æœºç½‘ç»œï¼Œç†Ÿæ‚‰ OSI æ¨¡åž‹ï¼Œé‚£ä¹ˆä½ å¯ä»¥è·³è¿‡è¿™ä¸ªå®žä¾‹äº†ã€‚ è€Œä¸äº†è§£ OSI æ¨¡åž‹çš„æœ‹å‹ï¼Œä¸å¦¨é€šè¿‡ä¸€ä¸ªå®žä¾‹æ¥å¯¹ HTTP æŠ¥æ–‡æœ‰ä¸€ä¸ªæ„Ÿæ€§çš„è®¤è¯†ã€‚ ä»¥ä¸‹æ˜¯ä½¿ç”¨ wireshark æŠ“å–çš„ä¸€ä¸ªå®žé™…è®¿é—®ç™¾åº¦é¦–é¡µçš„ HTTP GET æŠ¥æ–‡ï¼š å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°å®ƒçš„å±‚çº§ç»“æž„å¦‚ä¸‹å›¾ï¼Œç»è¿‡äº†å±‚å±‚çš„åŒ…è£…ã€‚ å·¥ä½œåŽŸç† HTTP å·¥ä½œäºŽ Client/Server æ¨¡åž‹ä¸Šã€‚ å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡é‡‡ç”¨ request/response æœºåˆ¶ã€‚ å®¢æˆ·ç«¯æ˜¯ç»ˆç«¯ï¼ˆå¯ä»¥æ˜¯æµè§ˆå™¨ã€çˆ¬è™«ç¨‹åºç­‰ï¼‰ï¼ŒæœåŠ¡å™¨æ˜¯ç½‘ç«™çš„ Web æœåŠ¡å™¨ã€‚ ä¸€æ¬¡ HTTP æ“ä½œç§°ä¸ºä¸€ä¸ªäº‹åŠ¡ï¼Œå…¶å·¥ä½œè¿‡ç¨‹å¤§è‡´å¯åˆ†ä¸ºå››æ­¥ï¼š å»ºç«‹è¿žæŽ¥ - é¦–å…ˆï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€è¦å»ºç«‹ä¸€ä¸ªåˆ°æœåŠ¡å™¨æŒ‡å®šç«¯å£ï¼ˆé»˜è®¤ç«¯å£å·ä¸º 80ï¼‰çš„ TCP è¿žæŽ¥ï¼ˆæ³¨ï¼šè™½ç„¶ HTTP é‡‡ç”¨ TCP è¿žæŽ¥æ˜¯æœ€æµè¡Œçš„æ–¹å¼ï¼Œä½†æ˜¯ RFC å¹¶æ²¡æœ‰æŒ‡å®šä¸€å®šè¦é‡‡ç”¨è¿™ç§ç½‘ç»œä¼ è¾“æ–¹å¼ã€‚ï¼‰ã€‚ å‘é€è¯·æ±‚ä¿¡æ¯ - å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚è¯·æ±‚æ–¹å¼çš„æ ¼å¼ä¸ºï¼Œç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ã€åè®®ç‰ˆæœ¬å·ï¼ŒåŽè¾¹æ˜¯ MIME ä¿¡æ¯åŒ…æ‹¬è¯·æ±‚ä¿®é¥°ç¬¦ å‘é€å“åº”ä¿¡æ¯ - æœåŠ¡å™¨ç›‘å¬æŒ‡å®šæŽ¥å£æ˜¯å¦æ”¶åˆ°è¯·æ±‚ï¼Œä¸€æ—¦å‘çŽ°è¯·æ±‚ï¼Œå¤„ç†åŽï¼Œè¿”å›žå“åº”ç»“æžœç»™å®¢æˆ·ç«¯ã€‚å…¶æ ¼å¼ä¸ºä¸€ä¸ªçŠ¶æ€è¡ŒåŒ…æ‹¬ä¿¡æ¯çš„åè®®ç‰ˆæœ¬å·ã€ä¸€ä¸ªæˆåŠŸæˆ–é”™è¯¯çš„ä»£ç ï¼ŒåŽè¾¹æ˜¯ MIME ä¿¡æ¯åŒ…æ‹¬æœåŠ¡å™¨ä¿¡æ¯ã€å®žä½“ä¿¡æ¯å’Œå¯èƒ½çš„å†…å®¹ã€‚ å…³é—­è¿žæŽ¥ - å®¢æˆ·ç«¯æ ¹æ®å“åº”ï¼Œæ˜¾ç¤ºç»“æžœç»™ç”¨æˆ·ï¼Œæœ€åŽå…³é—­è¿žæŽ¥ã€‚ ç‰¹ç‚¹ æ— è¿žæŽ¥çš„ - æ— è¿žæŽ¥çš„å«ä¹‰æ˜¯é™åˆ¶æ¯æ¬¡è¿žæŽ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åŽï¼Œå³æ–­å¼€è¿žæŽ¥ã€‚é‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´ã€‚ æ— çŠ¶æ€çš„ - HTTP åè®®æ˜¯æ— çŠ¶æ€åè®®ã€‚æ— çŠ¶æ€æ˜¯æŒ‡åè®®å¯¹äºŽäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚ç¼ºå°‘çŠ¶æ€æ„å‘³ç€å¦‚æžœåŽç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å®ƒå¿…é¡»é‡ä¼ ï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´æ¯æ¬¡è¿žæŽ¥ä¼ é€çš„æ•°æ®é‡å¢žå¤§ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æœåŠ¡å™¨ä¸éœ€è¦å…ˆå‰ä¿¡æ¯æ—¶å®ƒçš„åº”ç­”å°±è¾ƒå¿«ã€‚ åª’ä½“ç‹¬ç«‹çš„ - è¿™æ„å‘³ç€ï¼Œåªè¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çŸ¥é“å¦‚ä½•å¤„ç†çš„æ•°æ®å†…å®¹ï¼Œä»»ä½•ç±»åž‹çš„æ•°æ®éƒ½å¯ä»¥é€šè¿‡ HTTP å‘é€ã€‚å®¢æˆ·ç«¯ä»¥åŠæœåŠ¡å™¨æŒ‡å®šä½¿ç”¨é€‚åˆçš„ MIME-type å†…å®¹ç±»åž‹ã€‚ C/S æ¨¡åž‹çš„ - åŸºäºŽ Client/Server æ¨¡åž‹å·¥ä½œã€‚ HTTP æ¶ˆæ¯ç»“æž„ HTTP æ˜¯åŸºäºŽå®¢æˆ·ç«¯/æœåŠ¡ç«¯ï¼ˆC/Sï¼‰çš„æž¶æž„æ¨¡åž‹ï¼Œé€šè¿‡ä¸€ä¸ªå¯é çš„é“¾æŽ¥æ¥äº¤æ¢ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„è¯·æ±‚/å“åº”åè®®ã€‚ ä¸€ä¸ª HTTP&quot;å®¢æˆ·ç«¯&quot;æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ˆWeb æµè§ˆå™¨æˆ–å…¶ä»–ä»»ä½•å®¢æˆ·ç«¯ï¼‰ï¼Œé€šè¿‡è¿žæŽ¥åˆ°æœåŠ¡å™¨è¾¾åˆ°å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªæˆ–å¤šä¸ª HTTP çš„è¯·æ±‚çš„ç›®çš„ã€‚ ä¸€ä¸ª HTTP&quot;æœåŠ¡å™¨&quot;åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ª Web æœåŠ¡ï¼Œå¦‚ Apache Web æœåŠ¡å™¨æˆ– IIS æœåŠ¡å™¨ç­‰ï¼‰ï¼Œé€šè¿‡æŽ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶å‘å®¢æˆ·ç«¯å‘é€ HTTP å“åº”æ•°æ®ã€‚ HTTP ä½¿ç”¨ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆUniform Resource Identifiers, URIï¼‰æ¥ä¼ è¾“æ•°æ®å’Œå»ºç«‹è¿žæŽ¥ã€‚ ä¸€æ—¦å»ºç«‹è¿žæŽ¥åŽï¼Œæ•°æ®æ¶ˆæ¯å°±é€šè¿‡ç±»ä¼¼ Internet é‚®ä»¶æ‰€ä½¿ç”¨çš„æ ¼å¼[RFC5322]å’Œå¤šç”¨é€” Internet é‚®ä»¶æ‰©å±•ï¼ˆMIMEï¼‰[RFC2045]æ¥ä¼ é€ã€‚ å®¢æˆ·ç«¯è¯·æ±‚æ¶ˆæ¯ å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª HTTP è¯·æ±‚åˆ°æœåŠ¡å™¨çš„è¯·æ±‚æ¶ˆæ¯åŒ…æ‹¬ä»¥ä¸‹æ ¼å¼ï¼šè¯·æ±‚è¡Œï¼ˆrequest lineï¼‰ã€è¯·æ±‚å¤´éƒ¨ï¼ˆheaderï¼‰ã€ç©ºè¡Œå’Œè¯·æ±‚æ•°æ®å››ä¸ªéƒ¨åˆ†ç»„æˆï¼Œä¸‹å›¾ç»™å‡ºäº†è¯·æ±‚æŠ¥æ–‡çš„ä¸€èˆ¬æ ¼å¼ã€‚ æœåŠ¡å™¨å“åº”æ¶ˆæ¯ HTTP å“åº”ä¹Ÿç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šçŠ¶æ€è¡Œã€æ¶ˆæ¯æŠ¥å¤´ã€ç©ºè¡Œå’Œå“åº”æ­£æ–‡ã€‚ HTTP è¯·æ±‚ æ ¹æ® HTTP æ ‡å‡†ï¼ŒHTTP è¯·æ±‚å¯ä»¥ä½¿ç”¨å¤šç§è¯·æ±‚æ–¹æ³•ã€‚ HTTP1.0å®šä¹‰äº†ä¸‰ç§è¯·æ±‚æ–¹æ³•ï¼š GET, POST å’Œ HEADæ–¹æ³•ã€‚ HTTP1.1æ–°å¢žäº†äº”ç§è¯·æ±‚æ–¹æ³•ï¼šOPTIONS, PUT, DELETE, TRACE å’Œ CONNECTæ–¹æ³•ã€‚ æ–¹æ³• æè¿° GET è¯·æ±‚æŒ‡å®šçš„é¡µé¢ä¿¡æ¯ï¼Œå¹¶è¿”å›žå®žä½“ä¸»ä½“ã€‚ HEAD ç±»ä¼¼äºŽ get è¯·æ±‚ï¼Œåªä¸è¿‡è¿”å›žçš„å“åº”ä¸­æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œç”¨äºŽèŽ·å–æŠ¥å¤´ POST å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚ä½“ä¸­ã€‚POST è¯·æ±‚å¯èƒ½ä¼šå¯¼è‡´æ–°çš„èµ„æºçš„å»ºç«‹å’Œ/æˆ–å·²æœ‰èµ„æºçš„ä¿®æ”¹ã€‚ PUT ä»Žå®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€çš„æ•°æ®å–ä»£æŒ‡å®šçš„æ–‡æ¡£çš„å†…å®¹ã€‚ DELETE è¯·æ±‚æœåŠ¡å™¨åˆ é™¤æŒ‡å®šçš„é¡µé¢ã€‚ CONNECT HTTP/1.1 åè®®ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿žæŽ¥æ”¹ä¸ºç®¡é“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚ OPTIONS å…è®¸å®¢æˆ·ç«¯æŸ¥çœ‹æœåŠ¡å™¨çš„æ€§èƒ½ã€‚ TRACE å›žæ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºŽæµ‹è¯•æˆ–è¯Šæ–­ã€‚ HTTP è¯·æ±‚æ¶ˆæ¯å¤´ è¯·æ±‚æ¶ˆæ¯å¤´ è¯´æ˜Ž Accept æµè§ˆå™¨æ”¯æŒçš„æ ¼å¼ Accept-Encoding æ”¯æŒçš„ç¼–ç æ ¼å¼ï¼Œå¦‚ï¼ˆUTF-8ï¼ŒGBKï¼‰ Accept-Language æ”¯æŒçš„è¯­è¨€ç±»åž‹ User-Agent æµè§ˆå™¨ä¿¡æ¯ Cookie è®°å½•çš„æ˜¯ç”¨æˆ·å½“å‰çš„çŠ¶æ€ Referer æŒ‡ä»Žå“ªä¸ªé¡µé¢å•å‡»é“¾æŽ¥è¿›å…¥çš„é¡µé¢ HOST ç›®çš„åœ°å€å¯¹åº”çš„ä¸»æœºå Connection è¿žæŽ¥ç±»åž‹ã€‚å¦‚ Keep-Alive è¡¨ç¤ºé•¿è¿žæŽ¥ï¼Œä¸ä¼šæ–­å¼€ Content-Length å†…å®¹é•¿åº¦ Content-Type å†…å®¹ç±»åž‹ HTTP å“åº” å“åº”æ¶ˆæ¯å¤´ è¯´æ˜Ž Allow æœåŠ¡å™¨æ”¯æŒå“ªäº›è¯·æ±‚æ–¹æ³•ï¼ˆå¦‚ GETã€POST ç­‰ï¼‰ã€‚ Content-Encoding æ–‡æ¡£çš„ç¼–ç ï¼ˆEncodeï¼‰æ–¹æ³•ã€‚åªæœ‰åœ¨è§£ç ä¹‹åŽæ‰å¯ä»¥å¾—åˆ° Content-Type å¤´æŒ‡å®šçš„å†…å®¹ç±»åž‹ã€‚åˆ©ç”¨ gzip åŽ‹ç¼©æ–‡æ¡£èƒ½å¤Ÿæ˜¾è‘—åœ°å‡å°‘ HTML æ–‡æ¡£çš„ä¸‹è½½æ—¶é—´ã€‚Java çš„ GZIPOutputStream å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œ gzip åŽ‹ç¼©ï¼Œä½†åªæœ‰ Unix ä¸Šçš„ Netscape å’Œ Windows ä¸Šçš„ IE 4ã€IE 5 æ‰æ”¯æŒå®ƒã€‚å› æ­¤ï¼ŒServlet åº”è¯¥é€šè¿‡æŸ¥çœ‹ Accept-Encoding å¤´ï¼ˆå³ request.getHeader(â€œAccept-Encodingâ€)ï¼‰æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ gzipï¼Œä¸ºæ”¯æŒ gzip çš„æµè§ˆå™¨è¿”å›žç» gzip åŽ‹ç¼©çš„ HTML é¡µé¢ï¼Œä¸ºå…¶ä»–æµè§ˆå™¨è¿”å›žæ™®é€šé¡µé¢ã€‚ Content-Length è¡¨ç¤ºå†…å®¹é•¿åº¦ã€‚åªæœ‰å½“æµè§ˆå™¨ä½¿ç”¨æŒä¹… HTTP è¿žæŽ¥æ—¶æ‰éœ€è¦è¿™ä¸ªæ•°æ®ã€‚å¦‚æžœä½ æƒ³è¦åˆ©ç”¨æŒä¹…è¿žæŽ¥çš„ä¼˜åŠ¿ï¼Œå¯ä»¥æŠŠè¾“å‡ºæ–‡æ¡£å†™å…¥ ByteArrayOutputStramï¼Œå®ŒæˆåŽæŸ¥çœ‹å…¶å¤§å°ï¼Œç„¶åŽæŠŠè¯¥å€¼æ”¾å…¥ Content-Length å¤´ï¼Œæœ€åŽé€šè¿‡byteArrayStream.writeTo(response.getOutputStream() å‘é€å†…å®¹ã€‚ Content-Type è¡¨ç¤ºåŽé¢çš„æ–‡æ¡£å±žäºŽä»€ä¹ˆ MIME ç±»åž‹ã€‚Servlet é»˜è®¤ä¸º text/plainï¼Œä½†é€šå¸¸éœ€è¦æ˜¾å¼åœ°æŒ‡å®šä¸º text/htmlã€‚ç”±äºŽç»å¸¸è¦è®¾ç½® Content-Typeï¼Œå› æ­¤ HttpServletResponse æä¾›äº†ä¸€ä¸ªä¸“ç”¨çš„æ–¹æ³• setContentTypeã€‚ Date å½“å‰çš„ GMT æ—¶é—´ã€‚ä½ å¯ä»¥ç”¨ setDateHeader æ¥è®¾ç½®è¿™ä¸ªå¤´ä»¥é¿å…è½¬æ¢æ—¶é—´æ ¼å¼çš„éº»çƒ¦ã€‚ Expires åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™è®¤ä¸ºæ–‡æ¡£å·²ç»è¿‡æœŸï¼Œä»Žè€Œä¸å†ç¼“å­˜å®ƒï¼Ÿ Last-Modified æ–‡æ¡£çš„æœ€åŽæ”¹åŠ¨æ—¶é—´ã€‚å®¢æˆ·å¯ä»¥é€šè¿‡ If-Modified-Since è¯·æ±‚å¤´æä¾›ä¸€ä¸ªæ—¥æœŸï¼Œè¯¥è¯·æ±‚å°†è¢«è§†ä¸ºä¸€ä¸ªæ¡ä»¶ GETï¼Œåªæœ‰æ”¹åŠ¨æ—¶é—´è¿ŸäºŽæŒ‡å®šæ—¶é—´çš„æ–‡æ¡£æ‰ä¼šè¿”å›žï¼Œå¦åˆ™è¿”å›žä¸€ä¸ª 304ï¼ˆNot Modifiedï¼‰çŠ¶æ€ã€‚Last-Modified ä¹Ÿå¯ç”¨ setDateHeader æ–¹æ³•æ¥è®¾ç½®ã€‚ Location è¡¨ç¤ºå®¢æˆ·åº”å½“åˆ°å“ªé‡ŒåŽ»æå–æ–‡æ¡£ã€‚Location é€šå¸¸ä¸æ˜¯ç›´æŽ¥è®¾ç½®çš„ï¼Œè€Œæ˜¯é€šè¿‡ HttpServletResponse çš„ sendRedirect æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŒæ—¶è®¾ç½®çŠ¶æ€ä»£ç ä¸º 302ã€‚ Refresh è¡¨ç¤ºæµè§ˆå™¨åº”è¯¥åœ¨å¤šå°‘æ—¶é—´ä¹‹åŽåˆ·æ–°æ–‡æ¡£ï¼Œä»¥ç§’è®¡ã€‚é™¤äº†åˆ·æ–°å½“å‰æ–‡æ¡£ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡ response.setHeader(&quot;Refresh&quot;, &quot;5;URL=http://host/path&quot;)è®©æµè§ˆå™¨è¯»å–æŒ‡å®šçš„é¡µé¢ã€‚ æ³¨æ„è¿™ç§åŠŸèƒ½é€šå¸¸æ˜¯é€šè¿‡è®¾ç½® HTML é¡µé¢ HEAD åŒºçš„ &lt;META HTTP-EQUIV=&quot;Refresh&quot; CONTENT=&quot;5;URL=http://host/path&quot;&gt;å®žçŽ°ï¼Œè¿™æ˜¯å› ä¸ºï¼Œè‡ªåŠ¨åˆ·æ–°æˆ–é‡å®šå‘å¯¹äºŽé‚£äº›ä¸èƒ½ä½¿ç”¨ CGI æˆ– Servlet çš„ HTML ç¼–å†™è€…ååˆ†é‡è¦ã€‚ä½†æ˜¯ï¼Œå¯¹äºŽ Servlet æ¥è¯´ï¼Œç›´æŽ¥è®¾ç½® Refresh å¤´æ›´åŠ æ–¹ä¾¿ã€‚ æ³¨æ„ Refresh çš„æ„ä¹‰æ˜¯&quot;N ç§’ä¹‹åŽåˆ·æ–°æœ¬é¡µé¢æˆ–è®¿é—®æŒ‡å®šé¡µé¢&quot;ï¼Œè€Œä¸æ˜¯&quot;æ¯éš” N ç§’åˆ·æ–°æœ¬é¡µé¢æˆ–è®¿é—®æŒ‡å®šé¡µé¢&quot;ã€‚å› æ­¤ï¼Œè¿žç»­åˆ·æ–°è¦æ±‚æ¯æ¬¡éƒ½å‘é€ä¸€ä¸ª Refresh å¤´ï¼Œè€Œå‘é€ 204 çŠ¶æ€ä»£ç åˆ™å¯ä»¥é˜»æ­¢æµè§ˆå™¨ç»§ç»­åˆ·æ–°ï¼Œä¸ç®¡æ˜¯ä½¿ç”¨ Refresh å¤´è¿˜æ˜¯ &lt;META HTTP-EQUIV=&quot;Refresh&quot; ...&gt;ã€‚ æ³¨æ„ Refresh å¤´ä¸å±žäºŽ HTTP 1.1 æ­£å¼è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ä¸€ä¸ªæ‰©å±•ï¼Œä½† Netscape å’Œ IE éƒ½æ”¯æŒå®ƒã€‚ Server æœåŠ¡å™¨åå­—ã€‚Servlet ä¸€èˆ¬ä¸è®¾ç½®è¿™ä¸ªå€¼ï¼Œè€Œæ˜¯ç”± Web æœåŠ¡å™¨è‡ªå·±è®¾ç½®ã€‚ Set-Cookie è®¾ç½®å’Œé¡µé¢å…³è”çš„ Cookieã€‚Servlet ä¸åº”ä½¿ç”¨response.setHeader(&quot;Set-Cookie&quot;, ...)ï¼Œè€Œæ˜¯åº”ä½¿ç”¨ HttpServletResponse æä¾›çš„ä¸“ç”¨æ–¹æ³• addCookieã€‚å‚è§ä¸‹æ–‡æœ‰å…³ Cookie è®¾ç½®çš„è®¨è®ºã€‚ WWW-Authenticate å®¢æˆ·åº”è¯¥åœ¨ Authorization å¤´ä¸­æä¾›ä»€ä¹ˆç±»åž‹çš„æŽˆæƒä¿¡æ¯ï¼Ÿåœ¨åŒ…å« 401ï¼ˆUnauthorizedï¼‰çŠ¶æ€è¡Œçš„åº”ç­”ä¸­è¿™ä¸ªå¤´æ˜¯å¿…éœ€çš„ã€‚ä¾‹å¦‚ï¼Œresponse.setHeader(&quot;WWW-Authenticate&quot;, &quot;BASIC realm=ï¼¼&quot;executivesï¼¼&quot;&quot;)ã€‚ æ³¨æ„ Servlet ä¸€èˆ¬ä¸è¿›è¡Œè¿™æ–¹é¢çš„å¤„ç†ï¼Œè€Œæ˜¯è®© Web æœåŠ¡å™¨çš„ä¸“é—¨æœºåˆ¶æ¥æŽ§åˆ¶å—å¯†ç ä¿æŠ¤é¡µé¢çš„è®¿é—®ï¼ˆä¾‹å¦‚.htaccessï¼‰ã€‚ HTTP çŠ¶æ€ç  å½“æµè§ˆè€…è®¿é—®ä¸€ä¸ªç½‘é¡µæ—¶ï¼Œæµè§ˆè€…çš„æµè§ˆå™¨ä¼šå‘ç½‘é¡µæ‰€åœ¨æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ã€‚å½“æµè§ˆå™¨æŽ¥æ”¶å¹¶æ˜¾ç¤ºç½‘é¡µå‰ï¼Œæ­¤ç½‘é¡µæ‰€åœ¨çš„æœåŠ¡å™¨ä¼šè¿”å›žä¸€ä¸ªåŒ…å« HTTP çŠ¶æ€ç çš„ä¿¡æ¯å¤´ï¼ˆserver headerï¼‰ç”¨ä»¥å“åº”æµè§ˆå™¨çš„è¯·æ±‚ã€‚ HTTP çŠ¶æ€ç çš„è‹±æ–‡ä¸º HTTP Status Codeã€‚ ä¸‹é¢æ˜¯å¸¸è§çš„ HTTP çŠ¶æ€ç ï¼š 200 - è¯·æ±‚æˆåŠŸ 301 - èµ„æºï¼ˆç½‘é¡µç­‰ï¼‰è¢«æ°¸ä¹…è½¬ç§»åˆ°å…¶å®ƒ URL 404 - è¯·æ±‚çš„èµ„æºï¼ˆç½‘é¡µç­‰ï¼‰ä¸å­˜åœ¨ 500 - å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ HTTP çŠ¶æ€ç åˆ†ç±» HTTP çŠ¶æ€ç ç”±ä¸‰ä¸ªåè¿›åˆ¶æ•°å­—ç»„æˆï¼Œç¬¬ä¸€ä¸ªåè¿›åˆ¶æ•°å­—å®šä¹‰äº†çŠ¶æ€ç çš„ç±»åž‹ï¼ŒåŽä¸¤ä¸ªæ•°å­—æ²¡æœ‰åˆ†ç±»çš„ä½œç”¨ã€‚HTTP çŠ¶æ€ç å…±åˆ†ä¸º 5 ç§ç±»åž‹ï¼š åˆ†ç±» åˆ†ç±»æè¿° 1 ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œéœ€è¦è¯·æ±‚è€…ç»§ç»­æ‰§è¡Œæ“ä½œ 2 æˆåŠŸï¼Œæ“ä½œè¢«æˆåŠŸæŽ¥æ”¶å¹¶å¤„ç† 3 é‡å®šå‘ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œä»¥å®Œæˆè¯·æ±‚ 4 å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚åŒ…å«è¯­æ³•é”™è¯¯æˆ–æ— æ³•å®Œæˆè¯·æ±‚ 5 æœåŠ¡å™¨é”™è¯¯ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ HTTP çŠ¶æ€åˆ—è¡¨ï¼š çŠ¶æ€ç  çŠ¶æ€ç è‹±æ–‡åç§° 100 Continue 101 Switching Protocols 200 OK 201 Created 202 Accepted 203 Non-Authoritative Information 204 No Content 205 Reset Content 206 Partial Content 300 Multiple Choices 301 Moved Permanently 302 Found 303 See Other 304 Not Modified 305 Use Proxy 306 Unused 307 Temporary Redirect 400 Bad Request 401 Unauthorized 402 Payment Required 403 Forbidden 404 Not Found 405 Method Not Allowed 406 Not Acceptable 407 Proxy Authentication Required 408 Request Time-out 409 Conflict 410 Gone 411 Length Required 412 Precondition Failed 413 Request Entity Too Large 414 Request-URI Too Large 415 Unsupported Media Type 416 Requested range not satisfiable 417 Expectation Failed 500 Internal Server Error 501 Not Implemented 502 Bad Gateway 503 Service Unavailable 504 Gateway Time-out 505 HTTP Version not supported æ›´å¤šå†…å®¹ http://blog.csdn.net/gueter/article/details/1524447 http://www.runoob.com/http/http-intro.html https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol]]></content>
      <categories>
        <category>communication</category>
      </categories>
      <tags>
        <tag>communication</tag>
        <tag>network</tag>
        <tag>protocol</tag>
        <tag>application</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ICMP]]></title>
    <url>%2Fblog%2F2014%2F07%2F02%2Fcommunication%2Ficmp%2F</url>
    <content type="text"><![CDATA[ICMP ðŸ““ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œblogã€ ICMP ç®€ä»‹ ICMP ç±»åž‹ ç›®çš„ä¸å¯è¾¾(Destination Unreachable Message) è¶…æ—¶(Time Exceeded Message) å‚æ•°é”™è¯¯æŠ¥æ–‡(Parameter Problem Message) æºå†·å´(Source Quench Message) é‡å®šå‘(Redirect Message) è¯·æ±‚å›žæ˜¾æˆ–å›žæ˜¾åº”ç­”(Echo or Echo Reply Message) æ—¶é—´æˆ³æˆ–æ—¶é—´æˆ³è¯·æ±‚(Timestamp or Timestamp Reply Message) ä¿¡æ¯è¯·æ±‚æˆ–ä¿¡æ¯å“åº” æ€»ç»“ å‚è€ƒ ICMP ç®€ä»‹ ICMP å…¨åä¸º(INTERNET CONTROL MESSAGE PROTOCOL)ç½‘ç»œæŽ§åˆ¶æ¶ˆæ¯åè®®ã€‚ ICMP çš„åè®®å·ä¸º1ã€‚ ICMP æŠ¥æ–‡å°±åƒæ˜¯ IP æŠ¥æ–‡çš„å°å¼Ÿï¼Œæ€»é¡¶ç€ IP æŠ¥æ–‡çš„åå¤´å‡ºæ¥æ··ã€‚å› ä¸º ICMP æŠ¥æ–‡æ˜¯åœ¨ IP æŠ¥æ–‡å†…éƒ¨çš„ï¼Œå¦‚å›¾ï¼š å›¾ï¼šIP æ•°æ®æŠ¥ ICMP ç±»åž‹ ICMP æŠ¥æ–‡ä¸»è¦æœ‰ä¸¤å¤§åŠŸèƒ½ï¼šæŸ¥è¯¢æŠ¥æ–‡å’Œå·®é”™æŠ¥æ–‡ã€‚ ç›®çš„ä¸å¯è¾¾(Destination Unreachable Message) 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Type | Code | Checksum | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | unused | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Internet Header + 64 bits of Original Data Datagram | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œé‚®å¯„åŒ…è£¹ä¼šç»è¿‡å¤šä¸ªä¼ é€’çŽ¯èŠ‚ï¼Œä»»æ„ä¸€çŽ¯å¦‚æžœæ— æ³•ä¼ ä¸‹åŽ»ï¼Œéƒ½ä¼šè¿”å›žå¯„ä»¶äººï¼Œå¹¶é™„ä¸Šæ— æ³•é‚®å¯„çš„åŽŸå› ã€‚åŒç†ï¼Œå½“è·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªæ— æ³•ä¼ é€’ä¸‹åŽ»çš„ IP æŠ¥æ–‡æ—¶ï¼Œä¼šå‘é€ ICMPç›®çš„ä¸å¯è¾¾æŠ¥æ–‡ï¼ˆType ä¸º 3ï¼‰ç»™ IP æŠ¥æ–‡çš„æºå‘é€æ–¹ã€‚æŠ¥æ–‡ä¸­çš„ Code å°±è¡¨ç¤ºå‘é€å¤±è´¥çš„åŽŸå› ã€‚ Code 0 = net unreachable; 1 = host unreachable; 2 = protocol unreachable; 3 = port unreachable; 4 = fragmentation needed and DF set; 5 = source route failed. è¶…æ—¶(Time Exceeded Message) 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Type | Code | Checksum | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | unused | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Internet Header + 64 bits of Original Data Datagram | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ ç½‘ç»œä¼ è¾“ IP æ•°æ®æŠ¥çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æžœ IP æ•°æ®åŒ…çš„ TTL å€¼é€æ¸é€’å‡ä¸º 0 æ—¶ï¼Œéœ€è¦ä¸¢å¼ƒæ•°æ®æŠ¥ã€‚è¿™æ—¶ï¼Œè·¯ç”±å™¨éœ€è¦å‘æºå‘é€æ–¹å‘é€ ICMP è¶…æ—¶æŠ¥æ–‡(Type ä¸º 11)ï¼ŒCode ä¸º 0ï¼Œè¡¨ç¤ºä¼ è¾“è¿‡ç¨‹ä¸­è¶…æ—¶äº†ã€‚ ä¸€ä¸ª IP æ•°æ®æŠ¥å¯èƒ½ä¼šå› ä¸ºè¿‡å¤§è€Œè¢«åˆ†ç‰‡ï¼Œç„¶åŽåœ¨ç›®çš„ä¸»æœºä¾§æŠŠæ‰€æœ‰çš„åˆ†ç‰‡é‡ç»„ã€‚å¦‚æžœä¸»æœºè¿Ÿè¿Ÿæ²¡æœ‰ç­‰åˆ°æ‰€æœ‰çš„åˆ†ç‰‡æŠ¥æ–‡ï¼Œå°±ä¼šå‘æºå‘é€æ–¹å‘é€ä¸€ä¸ª ICMP è¶…æ—¶æŠ¥æ–‡ï¼ŒCode ä¸º 1ï¼Œè¡¨ç¤ºåˆ†ç‰‡é‡ç»„è¶…æ—¶äº†ã€‚ å‚æ•°é”™è¯¯æŠ¥æ–‡(Parameter Problem Message) 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Type | Code | Checksum | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Pointer | unused | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Internet Header + 64 bits of Original Data Datagram | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ å½“è·¯ç”±å™¨æˆ–ä¸»æœºå¤„ç†æ•°æ®æŠ¥æ—¶ï¼Œå‘çŽ°å› ä¸ºæŠ¥æ–‡å¤´çš„å‚æ•°é”™è¯¯è€Œä¸å¾—ä¸ä¸¢å¼ƒæŠ¥æ–‡æ—¶ï¼Œéœ€è¦å‘æºå‘é€æ–¹å‘é€å‚æ•°é”™è¯¯æŠ¥æ–‡(Type ä¸º 12)ã€‚å½“ Code ä¸º 0 æ—¶ï¼ŒæŠ¥æ–‡ä¸­çš„ Pointer è¡¨ç¤ºé”™è¯¯çš„å­—èŠ‚ä½ç½®ã€‚ æºå†·å´(Source Quench Message) 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Type | Code | Checksum | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | unused | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Internet Header + 64 bits of Original Data Datagram | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ è·¯ç”±å™¨åœ¨å¤„ç†æŠ¥æ–‡æ—¶ä¼šæœ‰ä¸€ä¸ªç¼“å­˜é˜Ÿåˆ—ã€‚å¦‚æžœè¶…è¿‡æœ€å¤§ç¼“å­˜é˜Ÿåˆ—ï¼Œå°†æ— æ³•å¤„ç†ï¼Œä»Žè€Œä¸¢å¼ƒæŠ¥æ–‡ã€‚å¹¶å‘æºå‘é€æ–¹å‘ä¸€ä¸ª ICMP æºå†·å´æŠ¥æ–‡(Type ä¸º 4)ï¼Œå‘Šè¯‰å¯¹æ–¹ï¼šâ€œå˜¿ï¼Œæˆ‘è¿™é‡Œå®¢æ»¡äº†ï¼Œä½ è¿Ÿç‚¹å†æ¥ã€‚â€ é‡å®šå‘(Redirect Message) 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Type | Code | Checksum | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Gateway Internet Address | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Internet Header + 64 bits of Original Data Datagram | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ æƒ³åƒä¸€ä¸‹ï¼Œåœ¨å…¬å¸ä¸­ï¼Œæœ‰äººæ¥ä½ çš„é¡¹ç›®ç»„é—®ä½ æŸæŸæŸåœ¨å“ªå„¿ã€‚ä½ ä¸€æƒ³ï¼Œæˆ‘ä»¬ç»„æ²¡æœ‰è¿™äººå•Šã€‚ä½ è‚¯å®šå°±ä¼šè¯´ï¼Œæˆ‘ä»¬ç»„æ²¡æœ‰è¿™å·äººï¼Œä½ åŽ»å…¶ä»–ç»„çœ‹çœ‹ã€‚å½“è·¯ç”±æ”¶åˆ° IP æ•°æ®æŠ¥ï¼Œå‘çŽ°æ•°æ®æŠ¥çš„ç›®çš„åœ°å€åœ¨è·¯ç”±è¡¨ä¸Šæ²¡æœ‰ï¼Œå®ƒå°±ä¼šå‘ ICMP é‡å®šå‘æŠ¥æ–‡(Type ä¸º 5)ç»™æºå‘é€æ–¹ï¼Œæé†’å®ƒæƒ³è¦å‘é€çš„åœ°å€ä¸åœ¨ï¼ŒåŽ»å…¶ä»–åœ°æ–¹æ‰¾æ‰¾å§ã€‚ è¯·æ±‚å›žæ˜¾æˆ–å›žæ˜¾åº”ç­”(Echo or Echo Reply Message) 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Type | Code | Checksum | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Identifier | Sequence Number | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Data â€¦ Â±Â±Â±Â±Â± Type(8)æ˜¯è¯·æ±‚å›žæ˜¾æŠ¥æ–‡(Echo)ï¼›Type(0)æ˜¯å›žæ˜¾åº”ç­”æŠ¥æ–‡(Echo Reply)ã€‚ è¯·æ±‚å›žæ˜¾æˆ–å›žæ˜¾åº”ç­”æŠ¥æ–‡å±žäºŽæŸ¥è¯¢æŠ¥æ–‡ã€‚Ping å°±æ˜¯ç”¨è¿™ç§æŠ¥æ–‡è¿›è¡ŒæŸ¥è¯¢å’Œå›žåº”ã€‚ æ—¶é—´æˆ³æˆ–æ—¶é—´æˆ³è¯·æ±‚(Timestamp or Timestamp Reply Message) 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Type | Code | Checksum | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Identifier | Sequence Number | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Originate Timestamp | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Receive Timestamp | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Transmit Timestamp | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ æ—¶é—´æˆ³æŠ¥æ–‡æ˜¯ç”¨æ¥è®°å½•æ”¶å‘ä»¥åŠä¼ è¾“æ—¶é—´çš„æŠ¥æ–‡ã€‚Originate Timestamp è®°å½•çš„æ˜¯å‘é€æ–¹å‘é€æŠ¥æ–‡çš„æ—¶åˆ»ï¼›Receive Timestampè®°å½•çš„æ˜¯æŽ¥æ”¶æ–¹æ”¶åˆ°æŠ¥æ–‡çš„æ—¶åˆ»ï¼›Transmit Timestampè¡¨ç¤ºå›žæ˜¾è¿™æœ€åŽå‘é€æŠ¥æ–‡çš„æ—¶åˆ»ã€‚ ä¿¡æ¯è¯·æ±‚æˆ–ä¿¡æ¯å“åº” 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Type | Code | Checksum | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ | Identifier | Sequence Number | Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±+ è¿™ç§æŠ¥æ–‡æ˜¯ç”¨æ¥æ‰¾å‡ºä¸€ä¸ªä¸»æœºæ‰€åœ¨çš„ç½‘ç»œä¸ªæ•°ï¼ˆä¸€ä¸ªä¸»æœºå¯èƒ½ä¼šåœ¨å¤šä¸ªç½‘ç»œä¸­ï¼‰ã€‚æŠ¥æ–‡çš„ IP æ¶ˆæ¯å¤´çš„ç›®çš„åœ°å€ä¼šå¡«ä¸ºå…¨ 0ï¼Œè¡¨ç¤º thisï¼Œæºåœ°å€ä¼šå¡«ä¸ºæº IP æ‰€åœ¨çš„ç½‘ç»œ IPã€‚ æ€»ç»“ å›¾ï¼šICMP çŸ¥è¯†ç‚¹æ€ç»´å¯¼å›¾ å‚è€ƒ RFC792]]></content>
      <categories>
        <category>communication</category>
      </categories>
      <tags>
        <tag>communication</tag>
        <tag>network</tag>
        <tag>protocol</tag>
      </tags>
  </entry>
</search>
